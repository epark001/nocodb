import{C as ge,f as he,d as _e,E as we,h as be,b as ye,c as ke,v as xe,g as Ce,q as Ie}from"./index.5263eb1d.js";import{o as f,c as A,a as x,h as Re,$ as p,r as d,i as h,c1 as Me,B as Se,g1 as E,k as G,aq as Q,fC as Y,J as Oe,K as Le,ac as Ee,b4 as Ae,E as t,b5 as j,aj as ee,cp as te,C as I,w as k,fI as R,I as M,t as $,m as je,W as le,cF as ae,b as $e,D as Ve,F as Ke,d as Te,H as qe,f as ze,eX as De}from"./entry.13466615.js";import{u as Be,a as Ne}from"./useMetas.223da623.js";import{u as se}from"./index.a6329415.js";import{_ as Pe}from"./index.a1080274.js";import{S as He,_ as Fe}from"./index.4385a501.js";import{_ as Ue}from"./_plugin-vue_export-helper.c27b6911.js";import"./toArray.f6fa5a71.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.4991ab9d.js";import"./useMergedState.1cc2a884.js";import"./useState.a6853ebd.js";import"./DownOutlined.9cfe3e0c.js";import"./CheckOutlined.80115d65.js";import"./SearchOutlined.c1eed30a.js";import"./FormItemContext.27b2e5db.js";const We={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Je=x("path",{fill:"currentColor",d:"M12 2c5.53 0 10 4.47 10 10s-4.47 10-10 10S2 17.53 2 12S6.47 2 12 2m3.59 5L12 10.59L8.41 7L7 8.41L10.59 12L7 15.59L8.41 17L12 13.41L15.59 17L17 15.59L13.41 12L17 8.41L15.59 7Z"},null,-1),Xe=[Je];function Ze(_,B){return f(),A("svg",We,Xe)}const Ge={name:"mdi-close-circle",render:Ze},Qe={class:"flex gap-2 text-gray-500 items-center h-full"},Ye={class:"text-xs whitespace-normal"},et=Re({__name:"MultiSelect",props:{modelValue:{},rowIndex:{},disableOptionCreation:{type:Boolean},location:{}},emits:["update:modelValue"],setup(_,{emit:B}){const i=p(ge),V=p(he),K=p(_e,d(!1)),oe=p(we,d(!1)),N=p(be,d(!1)),T=h(()=>N.value||oe.value),P=p(ye,d(!1)),ne=p(ke,d(!1)),ie=p(xe,d(void 0)),q=d([]),C=d(),r=d(!1),z=p(Ce,d(!1)),u=d(),{$api:ce}=ze(),{getMeta:re}=Be(),{hasRole:v}=Me(),{isPg:ue,isMysql:H}=Ne(),S=Se([]),c=h(()=>{var e;if(i!=null&&i.value.colOptions){const l=i.value.colOptions?i.value.colOptions.options.filter(a=>a.title!=="")||[]:[];for(const a of l.filter(o=>o.order===null))a.title=(e=a.title)==null?void 0:e.replace(/^'/,"").replace(/'$/,"");return l.map(a=>({...a,value:a.title}))}return[]}),F=h(()=>(c.value??[]).every(e=>e.title!==u.value)),U=h(()=>v("owner",!0)||v("creator",!0)||v("editor",!0)||v(E.OWNER,!0)||v(E.CREATOR,!0)||v(E.EDITOR,!0)),m=h(()=>(U.value||ne.value)&&T.value),w=h({get:()=>{const e=q.value.reduce((l,a)=>{var n;const o=(n=c.value.find(s=>s.id===a)||c.value.find(s=>s.title===a))==null?void 0:n.title;return o&&l.push(o),l},[]);return S.length&&e.push(...S),e},set:e=>{if(F.value&&e.length&&e[e.length-1]===u.value)return de();B("update:modelValue",e.length===0?null:e.join(","))}}),W=h(()=>_.modelValue?typeof _.modelValue=="string"?H(i.value.base_id)?_.modelValue.split(",").sort((e,l)=>{const a=c.value.find(n=>n.title===e),o=c.value.find(n=>n.title===l);return a&&o?a.order-o.order:0}):_.modelValue.split(","):_.modelValue:[]);G(()=>{q.value=W.value.flatMap(e=>{const l=c.value.find(o=>o.title===e),a=(l==null?void 0:l.id)||(l==null?void 0:l.title);return a?[a]:[]})}),Q(()=>_.modelValue,()=>{q.value=W.value.flatMap(e=>{const l=c.value.find(a=>a.title===e);return l&&(l.id||l.title)?[l.id||l.title]:[]})}),Q(r,(e,l)=>{var a,o,n,s,y,L;e||(u.value=""),m.value&&(e?(L=(y=(s=C.value)==null?void 0:s.$el)==null?void 0:y.querySelector("input"))==null||L.focus():(n=(o=(a=C.value)==null?void 0:a.$el)==null?void 0:o.querySelector("input"))==null||n.blur())}),se(N,e=>{var l;switch(e.key){case"Escape":r.value=!1;break;case"Enter":m.value&&T.value&&!r.value&&(r.value=!0);break;case" ":break;case"ArrowUp":case"ArrowDown":case"ArrowRight":case"ArrowLeft":case"Delete":break;default:if(!m.value){e.preventDefault();break}!(e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)&&((l=e.key)==null?void 0:l.length)===1&&!De()&&(e.stopPropagation(),r.value=!0);break}}),se(r,e=>{e.key==="Escape"&&(r.value=!1)});const O=d(0);async function de(){var e,l;if(!u.value||P.value)return!1;try{S.push(u.value);const a=u==null?void 0:u.value;if(u.value="",O.value++,a&&!c.value.some(o=>o.title===a)){const o=[...c.value];o.push({title:a,value:a,color:Y.light[(c.value.length+1)%Y.light.length]}),i.value.colOptions={options:o.map(({value:s,...y})=>y)};const n={...i.value};n.cdf&&(ue(i.value.base_id)&&(n.cdf=n.cdf.substring(n.cdf.indexOf("'")+1,n.cdf.lastIndexOf("'"))),H(i.value.base_id)||(n.cdf=n.cdf.replace(/''/g,"'"))),await ce.dbTableColumn.update(((e=i.value)==null?void 0:e.fk_column_id)||((l=i.value)==null?void 0:l.id),n),O.value--,O.value||(await re(i.value.fk_model_id,!0),w.value=[...w.value],S.splice(0,S.length))}else O.value--}catch(a){console.log(a),O.value--,Oe.error(await Le(a))}}const fe=()=>{var e,l,a;u.value=(a=(l=(e=C.value)==null?void 0:e.$el)==null?void 0:l.querySelector(".ant-select-selection-search-input"))==null?void 0:a.value},ve=(e,l)=>{var a,o;((a=e.target)!=null&&a.classList.contains("ant-tag-close-icon")||(o=e.target)!=null&&o.closest(".ant-tag-close-icon"))&&(e.stopPropagation(),l())},b=p(Ie,null),pe=()=>{b||(r.value=m.value&&!r.value)},J=()=>{r.value=m.value&&!r.value};G(()=>{b==null||b.on(J)}),Ee(()=>{b==null||b.on(J)}),Ae(document,"click",e=>{var l;r.value&&C.value&&!C.value.$el.contains(e.target)&&!((l=document.querySelector(".nc-dropdown-multi-select-cell.active"))!=null&&l.contains(e.target))&&(r.value=!1)},!0);const me=h(()=>w.value.reduce((e,l)=>{const a=c.value.find(o=>o.value===l);return a&&e.push(a),e},[]));return(e,l)=>{const a=Pe,o=He,n=Fe;return f(),A("div",{class:M(["nc-multi-select h-full w-full flex items-center",{"read-only":t(V)||t(K)}]),onClick:pe},[t(T)?(f(),I(n,{key:1,ref_key:"aselect",ref:C,value:t(w),"onUpdate:value":l[1]||(l[1]=s=>qe(w)?w.value=s:null),mode:"multiple",class:M(["w-full overflow-hidden",{"caret-transparent":!t(U)}]),bordered:!1,"clear-icon":"","show-search":"","show-arrow":t(m)&&!(t(V)||t(K)),open:t(r)&&t(m),disabled:t(V)||!t(m)||t(K),"dropdown-class-name":`nc-dropdown-multi-select-cell ${t(r)?"active":""}`,onSearch:fe,onKeydown:l[2]||(l[2]=ae(()=>{},["stop"]))},{tagRender:k(({value:s,onClose:y})=>{var L,X;return[t(c).find(g=>g.title===s)?(f(),I(a,{key:0,class:"rounded-tag nc-selected-option",style:{display:"flex",alignItems:"center"},color:(L=t(c).find(g=>g.title===s))==null?void 0:L.color,closable:t(m)&&(t(w).length>1||!((X=t(i))!=null&&X.rqd)),"close-icon":t(je)(t(Ge),{class:["ms-close-icon"]}),onClick:g=>ve(g,y),onClose:y},{default:k(()=>{var g,Z;return[x("span",{style:j({color:t(R).isReadable(((g=t(c).find(D=>D.title===s))==null?void 0:g.color)||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(R).mostReadable(((Z=t(c).find(D=>D.title===s))==null?void 0:Z.color)||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:M({"text-sm":t(z)})},$(s),7)]}),_:2},1032,["color","closable","close-icon","onClick","onClose"])):le("",!0)]}),default:k(()=>[(f(!0),A(ee,null,te(t(c),s=>(f(),I(o,{key:s.id||s.title,value:s.title,"data-testid":`select-option-${t(i).title}-${e.location==="filter"?"filter":e.rowIndex}`,class:M(`nc-select-option-${t(i).title}-${s.title}`),onClick:l[0]||(l[0]=ae(()=>{},["stop"]))},{default:k(()=>[$e(a,{class:"rounded-tag",color:s.color},{default:k(()=>[x("span",{style:j({color:t(R).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(R).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:M({"text-sm":t(z)})},$(s.title),7)]),_:2},1032,["color"])]),_:2},1032,["value","data-testid","class"]))),128)),t(u)&&t(F)&&!t(P)&&!e.disableOptionCreation&&(t(v)("owner",!0)||t(v)("creator",!0)||t(v)(t(E).OWNER,!0)||t(v)(t(E).CREATOR,!0))?(f(),I(o,{key:t(u),value:t(u)},{default:k(()=>[x("div",Qe,[(f(),I(Ve(t(Ke).plusThick),{class:"min-w-4"})),x("div",Ye,[Te(" Create new option named "),x("strong",null,$(t(u)),1)])])]),_:1},8,["value"])):le("",!0)]),_:1},8,["value","show-arrow","open","disabled","class","dropdown-class-name"])):(f(),A("div",{key:0,class:"flex flex-wrap",style:j({display:"-webkit-box","max-width":"100%","-webkit-line-clamp":t(ie)||1,"-webkit-box-orient":"vertical",overflow:"hidden"})},[(f(!0),A(ee,null,te(t(me),s=>(f(),I(a,{key:s.value,class:"rounded-tag",color:s.color},{default:k(()=>[x("span",{style:j({color:t(R).isReadable(s.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":t(R).mostReadable(s.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"13px"}),class:M({"text-sm":t(z)})},$(s.title),7)]),_:2},1032,["color"]))),128))],4))],2)}}});const wt=Ue(et,[["__scopeId","data-v-aa6ead90"]]);export{wt as default};
