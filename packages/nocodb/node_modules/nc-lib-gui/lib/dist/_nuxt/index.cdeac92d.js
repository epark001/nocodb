import{h as q,cZ as J,r as C,T as Q,A as Z,z as X,B as ee,i as te,fb as m,e4 as oe,aq as U,dy as le,cd as E,ap as ae,o as _,C as A,w as p,a as n,b as l,E as i,d as F,t as D,b6 as ie,W as O,H as se,J as ne,$ as z,cb as S,g as re,c4 as de,c as R,I as G,Q as K,R as W,p as ce,e as ue,f as me}from"./entry.51f4e399.js";import{_ as fe}from"./ViewIcon.vue.9fe867dc.js";import{_ as Y}from"./Button.vue.793bcd1d.js";import{_ as pe}from"./Modal.vue.d8394846.js";import"./index.e760d172.js";import{I as _e}from"./Input.7cb175ff.js";import{F as ve}from"./index.de92142d.js";import{_ as we}from"./FormItem.cda40628.js";import{_ as ge}from"./index.5e746f62.js";import{_ as he}from"./Icon.vue.1162f18b.js";import{_ as be}from"./Tooltip.vue.f55045dc.js";import{u as ye}from"./tab.da86c3fb.js";import{d as xe,a as ke,b as $e}from"./useMetas.ba7abae7.js";import{u as Ce}from"./sidebar.e289f4e1.js";import{M as Ie,A as Ve}from"./index.5263eb1d.js";import{u as Fe}from"./index.277e21b7.js";import{u as Ae}from"./index.9e760c64.js";import{u as Ne}from"./views.28a76d89.js";import{_ as Se}from"./Input.c36cd06d.js";import{_ as Re}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.0db47614.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isSymbol.b53bd26f.js";import"./SearchOutlined.dec109ce.js";import"./isPlainObject.ecf52d25.js";import"./_getPrototype.ec1165af.js";import"./TextArea.442a25cb.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.e001cd7c.js";import"./Password.d493e47a.js";import"./useSize.3b3f469f.js";import"./identity.dd5da9ba.js";import"./_flatRest.ff2d3d5c.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./toArray.06afb623.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./useSharedView.0db5f32b.js";const De={class:"flex flex-row items-center gap-x-1.5"},Te={class:"capitalize"},Be={class:"mt-2"},Me={class:"flex flex-row w-full justify-end gap-x-2 mt-7"},Pe=q({__name:"ViewCreate",props:{modelValue:{type:Boolean},type:{},title:{},selectedViewId:{},groupingFieldColumnId:{},geoDataFieldColumnId:{},views:{default:()=>[]},meta:{}},emits:["update:modelValue","created"],setup(r,{emit:T}){const w=J(r,["views","meta","selectedViewId","groupingFieldColumnId","geoDataFieldColumnId"]),v=C(),I=C(),y=Q(w,"modelValue",T),{t:g}=Z(),{api:x}=X(),V=C(!1),o=ee({title:w.title||"",type:w.type,copy_from_id:null,fk_grp_col_id:null,fk_geo_data_col_id:null}),k=C([]),P=[{required:!0,message:`${g("labels.viewName")} ${g("general.required")}`},{validator:(u,d)=>new Promise((e,a)=>{r.views.every(t=>t.title!==d)?e(!0):a(new Error("View name should be unique"))}),message:"View name should be unique"}],j=[{required:!0,message:`${g("general.groupingField")} ${g("general.required")}`}],N=[{required:!0,message:`${g("general.geoDataField")} ${g("general.required")}`}],B=te(()=>({[m.GRID]:"grid",[m.GALLERY]:"gallery",[m.FORM]:"form",[m.KANBAN]:"kanban",[m.MAP]:"map"})[w.type]);oe(L),U(()=>w.type,u=>{o.type=u});function L(){var d,e,a,t;o.title=`Untitled ${le(B.value)}`;const u=r.views.filter(s=>s.title.startsWith(o.title)).length;u&&(o.title=`${o.title} ${u}`),r.selectedViewId&&(o.copy_from_id=r.selectedViewId),w.type===m.KANBAN&&(k.value=r.meta.columns.filter(s=>s.uidt===E.SingleSelect).map(s=>({value:s.id,label:s.title})),r.groupingFieldColumnId?o.fk_grp_col_id=r.groupingFieldColumnId:o.fk_grp_col_id=(e=(d=k.value)==null?void 0:d[0])==null?void 0:e.value),w.type===m.MAP&&(k.value=r.meta.columns.filter(s=>s.uidt===E.GeoData).map(s=>({value:s.id,label:s.title})),r.geoDataFieldColumnId?o.fk_geo_data_col_id=r.geoDataFieldColumnId:o.fk_geo_data_col_id=(t=(a=k.value)==null?void 0:a[0])==null?void 0:t.value),ae(()=>{var f;const s=(f=v.value)==null?void 0:f.$el;s&&(s.focus(),s.select())})}async function $(){var d;let u=null;try{u=await((d=I.value)==null?void 0:d.validateFields())}catch(e){console.error(e)}if(u&&o.type){const e=i(r.meta);if(!e||!e.id)return;try{let a=null;switch(V.value=!0,o.type){case m.GRID:a=await x.dbView.gridCreate(e.id,o);break;case m.GALLERY:a=await x.dbView.galleryCreate(e.id,o);break;case m.FORM:a=await x.dbView.formCreate(e.id,o);break;case m.KANBAN:a=await x.dbView.kanbanCreate(e.id,o);break;case m.MAP:a=await x.dbView.mapCreate(e.id,o)}a&&T("created",a)}catch(a){ne.error(a.message)}y.value=!1,setTimeout(()=>{V.value=!1},500)}}return(u,d)=>{const e=fe,a=_e,t=we,s=ge,f=ve,h=Y,b=pe;return _(),A(b,{visible:i(y),"onUpdate:visible":d[4]||(d[4]=c=>se(y)?y.value=c:null),size:"small"},{header:p(()=>[n("div",De,[l(e,{meta:{type:i(o).type},class:"nc-view-icon !text-xl"},null,8,["meta"]),F(" "+D(u.$t(`general.${u.selectedViewId?"duplicate":"create"}`))+" ",1),n("span",Te,D(i(B)),1),F(" "+D(u.$t("objects.view")),1)])]),default:p(()=>[n("div",Be,[l(f,{ref_key:"formValidator",ref:I,layout:"vertical",model:i(o)},{default:p(()=>[l(t,{name:"title",rules:P},{default:p(()=>[l(a,{ref_key:"inputEl",ref:v,value:i(o).title,"onUpdate:value":d[0]||(d[0]=c=>i(o).title=c),class:"nc-input-md",autofocus:"",placeholder:u.$t("labels.viewName"),onKeydown:ie($,["enter"])},null,8,["value","placeholder","onKeydown"])]),_:1}),i(o).type===i(m).KANBAN?(_(),A(t,{key:0,label:u.$t("general.groupingField"),name:"fk_grp_col_id",rules:j},{default:p(()=>[l(s,{value:i(o).fk_grp_col_id,"onUpdate:value":d[1]||(d[1]=c=>i(o).fk_grp_col_id=c),class:"w-full nc-kanban-grouping-field-select",options:i(k),disabled:u.groupingFieldColumnId,placeholder:"Select a Grouping Field","not-found-content":"No Single Select Field can be found. Please create one first."},null,8,["value","options","disabled"])]),_:1},8,["label"])):O("",!0),i(o).type===i(m).MAP?(_(),A(t,{key:1,label:u.$t("general.geoDataField"),name:"fk_geo_data_col_id",rules:N},{default:p(()=>[l(s,{value:i(o).fk_geo_data_col_id,"onUpdate:value":d[2]||(d[2]=c=>i(o).fk_geo_data_col_id=c),class:"w-full",options:i(k),disabled:u.geoDataFieldColumnId,placeholder:"Select a GeoData Field","not-found-content":"No GeoData Field can be found. Please create one first."},null,8,["value","options","disabled"])]),_:1},8,["label"])):O("",!0)]),_:1},8,["model"]),n("div",Me,[l(h,{type:"secondary",onClick:d[3]||(d[3]=c=>y.value=!1)},{default:p(()=>[F(D(u.$t("general.cancel")),1)]),_:1}),l(h,{type:"primary",loading:i(V),onClick:$},{loading:p(()=>[F(" Creating View ")]),default:p(()=>[F(" Create View ")]),_:1},8,["loading"])])])]),_:1},8,["visible"])}}}),je=K(()=>W(()=>import("./MenuTop.494c2555.js"),["./MenuTop.494c2555.js","./ViewIcon.vue.9fe867dc.js","./entry.51f4e399.js","./entry.0f786d51.css","./ViewIcon.fd2d300a.css","./DeleteModal.vue.909e0964.js","./Icon.vue.1162f18b.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./Modal.vue.b59a28af.js","./DeleteModal.7ab6f524.css","./Dropdown.vue.97a9d1a0.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./index.5263eb1d.js","./sidebar.e289f4e1.js","./index.9e760c64.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./FormItemContext.e001cd7c.js","./SearchOutlined.dec109ce.js","./isPlainObject.ecf52d25.js","./_getPrototype.ec1165af.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./domUtils.b0dc23e8.js","./useMetas.ba7abae7.js","./index.277e21b7.js","./sortable.esm.9c3c89c5.js","./MenuTop.c30df832.css"],import.meta.url).then(r=>r.default||r)),Le=K(()=>W(()=>import("./MenuBottom.c48ae360.js"),["./MenuBottom.c48ae360.js","./ViewIcon.vue.9fe867dc.js","./entry.51f4e399.js","./entry.0f786d51.css","./ViewIcon.fd2d300a.css","./useBetaFeatureToggle.5dbba600.js","./useSmartsheetStore.1784ce8b.js","./views.28a76d89.js","./useMetas.ba7abae7.js","./useSharedView.0db5f32b.js","./index.5263eb1d.js","./index.b9981e09.js","./_plugin-vue_export-helper.c27b6911.js","./MenuBottom.29983ea0.css"],import.meta.url).then(r=>r.default||r)),H=r=>(ce("data-v-aa9f5371"),r=r(),ue(),r),Oe={class:"relative nc-view-sidebar flex flex-col border-l-1 border-gray-200 relative h-full w-full bg-white"},Ee=H(()=>n("div",{class:"flex text-gray-600 ml-1.75"},"Views",-1)),ze={class:"flex items-center text-inherit"},Ge={class:"flex-1 flex flex-col min-h-0"},qe={class:"flex flex-col h-full justify-between w-full"},Ue={class:"flex flex-grow nc-scrollbar-md pr-1.75 mr-0.5"},Ke={key:0,class:"flex flex-col w-full"},We={class:"flex flex-row items-center w-full mt-1.5 ml-5 gap-x-3"},Ye={class:"flex flex-row items-center w-full mt-4 ml-5 gap-x-3"},He={class:"flex flex-row items-center w-full mt-4 ml-5 gap-x-3"},Je={key:0,class:"flex flex-col"},Qe=H(()=>n("div",{class:"!mb-3 w-full border-b-1 border-gray-200"},null,-1)),Ze={key:0,class:"flex flex-col pt-2 pb-5 px-6"},Xe={class:"flex flex-row justify-between items-center w-full mt-4.75"},et={class:"flex flex-row items-center flex-grow gap-x-3"},tt={class:"flex"},ot={class:"flex flex-row justify-between items-center w-full mt-3.75"},lt={class:"flex flex-row items-center flex-grow gap-x-3"},at={class:"flex"},it={class:"flex flex-row justify-between items-center w-full mt-3.75"},st={class:"flex flex-row items-center flex-grow gap-x-3"},nt={class:"flex"},rt={class:"flex flex-row justify-between items-center w-full mt-3.75"},dt={class:"flex flex-row items-center flex-grow gap-x-3"},ct={class:"flex"},ut=q({__name:"index",setup(r){const{refreshCommandPalette:T}=xe(),w=z(Ie,C()),v=z(Ve,C()),{activeTab:I}=S(ye()),y=Ne(),{loadViews:g}=y,{isViewsLoading:x,views:V}=S(y),{lastOpenedViewMap:o}=S(ke()),{activeTable:k}=S($e()),P=e=>{var a,t;e&&((a=I.value)!=null&&a.id)&&(o.value[(t=I.value)==null?void 0:t.id]=e)},{isUIAllowed:j}=Ae(),N=re(),B=de(),{$e:L}=me(),{isRightSidebarOpen:$}=S(Ce()),u=C(null);U([V,()=>B.params.viewTitle],([e,a])=>{var f,h,b;const t=((f=I.value)==null?void 0:f.id)&&o.value[(h=I.value)==null?void 0:h.id],s=e.find(c=>c.id===t);if(a){let c=e.find(M=>M.title===a);c?(v.value=c,P((b=v.value)==null?void 0:b.id)):(c=e.find(M=>M.id===a),c&&N.replace({params:{viewTitle:c.id}}))}else s?N.replace({params:{viewTitle:s.id}}):e!=null&&e.length&&v.value!==e[0]&&(v.value=e[0]);e!=null&&e.length&&(!v.value||!e.includes(v.value))&&(v.value=e[0])},{immediate:!0});function d({title:e="",type:a,copyViewId:t,groupingFieldColumnId:s}){const f=C(!0),{close:h}=Fe(Pe,{modelValue:f,title:e,type:a,meta:w,selectedViewId:t,groupingFieldColumnId:s,views:V,"onUpdate:modelValue":b,onCreated:async c=>{b(),T(),await g(),N.push({params:{viewTitle:c.id||""}}),L("a:view:create",{view:c.type})}});function b(){f.value=!1,h(1e3)}}return(e,a)=>{const t=Se,s=he,f=Y,h=be,b=je,c=Le;return _(),R("div",Oe,[i(x)?(_(),A(t,{key:0,active:!0,class:"!h-8 !rounded overflow-hidden ml-3 mr-3 mt-3.75 mb-3.75"})):(_(),R("div",{key:1,ref_key:"tabBtnsContainerRef",ref:u,class:"flex flex-row group py-1 mx-3.25 mt-1.25 mb-2.75 rounded-md gap-x-2 nc-view-sidebar-tab items-center justify-between"},[Ee,l(h,{placement:"bottomLeft","hide-on-click":"",class:G(["flex opacity-0 group-hover:opacity-100 transition-all duration-50",{"!w-8 !opacity-100":!i($)}])},{title:p(()=>[F(D(i($)?`${e.$t("general.hide")} ${e.$t("objects.sidebar").toLowerCase()}`:`${e.$t("general.show")} ${e.$t("objects.sidebar").toLowerCase()}`),1)]),default:p(()=>[l(f,{type:"text",size:"small",class:"nc-sidebar-left-toggle-icon !text-gray-600 !hover:text-gray-800",onClick:a[0]||(a[0]=M=>$.value=!i($))},{default:p(()=>[n("div",ze,[l(s,{icon:"doubleRightArrow",class:G(["duration-150 transition-all",{"transform rotate-180":!i($)}])},null,8,["class"])])]),_:1})]),_:1},8,["class"])],512)),n("div",Ge,[n("div",qe,[n("div",Ue,[i(x)?(_(),R("div",Ke,[n("div",We,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),l(t,{active:!0,class:"!w-1/2 !h-4 !rounded overflow-hidden"})]),n("div",Ye,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),l(t,{active:!0,class:"!w-1/2 !h-4 !rounded overflow-hidden"})]),n("div",He,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),l(t,{active:!0,class:"!w-1/2 !h-4 !rounded overflow-hidden"})])])):(_(),A(b,{key:1,views:i(V),onOpenModal:d,onDeleted:i(g)},null,8,["views","onDeleted"]))]),i(j)("virtualViewsCreateOrEdit")?(_(),R("div",Je,[Qe,i(k)?(_(),A(c,{key:1,onOpenModal:d})):(_(),R("div",Ze,[l(t,{active:!0,class:"!w-3/5 !h-4 !rounded overflow-hidden"}),n("div",Xe,[n("div",et,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),l(t,{active:!0,class:"!w-3/5 !h-4 !rounded overflow-hidden"})]),n("div",tt,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"})])]),n("div",ot,[n("div",lt,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),l(t,{active:!0,class:"!w-3/5 !h-4 !rounded overflow-hidden"})]),n("div",at,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"})])]),n("div",it,[n("div",st,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),l(t,{active:!0,class:"!w-3/5 !h-4 !rounded overflow-hidden"})]),n("div",nt,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"})])]),n("div",rt,[n("div",dt,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"}),l(t,{active:!0,class:"!w-3/5 !h-4 !rounded overflow-hidden"})]),n("div",ct,[l(t,{active:!0,class:"!w-4 !h-4 !rounded overflow-hidden"})])])]))])):O("",!0)])])])}}});const oo=Re(ut,[["__scopeId","data-v-aa9f5371"]]);export{oo as default};
