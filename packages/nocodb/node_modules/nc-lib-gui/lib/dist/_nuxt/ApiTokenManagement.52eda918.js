import{h as q,A as Q,cb as X,r as k,k as Y,o as i,c as p,b as o,w as s,a as t,d as x,t as a,E as r,H as D,I as Z,C as _,D as h,F as g,aj as ee,cp as te,W as oe,J as v,K as N,O as se,L as le,P as ne,_ as ae,M as ie,N as re,f as ce}from"./entry.51f4e399.js";import{u as de}from"./useCopy.3e897b55.js";import{a as pe}from"./useMetas.ba7abae7.js";import{_ as me}from"./baseline-more-vert.0a68af2c.js";import{_ as fe,a as ue}from"./visibility-off.ec93a16f.js";import"./index.e760d172.js";import{I as _e}from"./Input.7cb175ff.js";import{F as ve}from"./index.de92142d.js";import{D as xe}from"./index.252dc7b4.js";import{_ as ye}from"./Title.e76f8bdd.js";import"./SearchOutlined.dec109ce.js";import"./isPlainObject.ecf52d25.js";import"./_getPrototype.ec1165af.js";import"./TextArea.442a25cb.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.e001cd7c.js";import"./Password.d493e47a.js";import"./FormItem.cda40628.js";import"./identity.dd5da9ba.js";import"./isSymbol.b53bd26f.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./toArray.06afb623.js";import"./toNumber.9dc54e53.js";import"./useSize.3b3f469f.js";import"./_flatRest.ff2d3d5c.js";import"./debounce.7d32c110.js";import"./Dropdown.dc69c0a4.js";import"./RightOutlined.90e8180f.js";import"./CheckOutlined.ef30fafc.js";import"./useMergedState.5e6500b1.js";const we={class:"relative flex flex-col h-full"},ke={class:"flex flex-row justify-start w-full -mt-1 mb-3"},he={class:"flex flex-row justify-end"},ge={class:"flex flex-col h-full"},be=t("div",{class:"flex flex-row justify-center mt-2 text-center w-full text-base"},"This action will remove this API Token",-1),$e={class:"flex mt-6 justify-end space-x-2"},Ce={class:"flex flex-col px-10"},Te={class:"flex flex-row justify-end"},je={class:"flex flex-row space-x-1"},Me={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},De={class:"text-gray-500"},Ne={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},Ie={key:0,class:"w-full flex flex-col mt-2 px-1"},Ve={class:"flex flex-row border-b-1 text-gray-600 text-xs pb-2 pt-2"},ze={class:"flex w-4/10 pl-2"},Be={class:"flex w-4/10 justify-center"},Se={class:"flex w-2/10 justify-end pr-2"},Ae={class:"flex flex-row border-b-1 items-center px-2 py-2"},Fe={class:"flex flex-row w-4/10 flex-wrap overflow-ellipsis"},Re={class:"flex w-4/10 justify-center flex-wrap overflow-ellipsis"},Ee={key:0},Pe={key:1},Ue={class:"flex flex-row w-2/10 justify-end"},Le={key:0},Oe={key:1},Ge={class:"flex flex-row items-center"},He={class:"flex flex-row items-center h-[1.2rem]"},Je=["onClick"],Ke={class:"text-xs pl-2"},Tt=q({__name:"ApiTokenManagement",setup(We){const{t:b}=Q(),{$api:$,$e:y}=ce(),I=pe(),{project:f}=X(I),{copy:V}=de(),C=k([]),m=k(!1),u=k(!1),d=k({}),w=async()=>{var e;(e=f.value)!=null&&e.id&&(C.value=(await $.apiToken.list(f.value.id)).list)},z=()=>{m.value=!0,y("c:api-token:generate")},B=async e=>{if(e){try{await V(e),v.info(b("msg.info.copiedToClipboard"))}catch(l){v.error(l.message)}y("c:api-token:copy")}},S=async()=>{var e;try{if(!((e=f.value)!=null&&e.id))return;await $.apiToken.create(f.value.id,d.value),m.value=!1,v.success(b("msg.success.tokenGenerated")),d.value={},await w()}catch(l){v.error(await N(l))}y("a:api-token:generate")},A=async()=>{var e;try{if(!((e=f.value)!=null&&e.id)||!d.value.token)return;await $.apiToken.delete(f.value.id,d.value.token),v.success(b("msg.success.tokenDeleted")),await w(),u.value=!1}catch(l){v.error(await N(l))}y("a:api-token:delete")},F=e=>{d.value=e,u.value=!0};return Y(()=>{w()}),(e,l)=>{const R=se,c=le,E=ye,P=_e,U=ve,T=ne,L=fe,O=ue,j=ae,G=me,H=ie,J=re,K=xe;return i(),p("div",null,[o(T,{visible:r(m),"onUpdate:visible":l[2]||(l[2]=n=>D(m)?m.value=n:null),class:Z({active:r(m)}),closable:!1,width:"28rem",centered:"",footer:null,"wrap-class-name":"nc-modal-generate-token"},{default:s(()=>[t("div",we,[o(c,{type:"text",class:"!absolute top-0 right-0 rounded-md -mt-2 -mr-3",onClick:l[0]||(l[0]=n=>m.value=!1)},{icon:s(()=>[o(R,{class:"flex mx-auto"})]),_:1}),t("div",ke,[o(E,{level:5},{default:s(()=>[x(a(e.$t("title.generateToken")),1)]),_:1})]),o(U,{ref:"form",model:r(d),name:"basic",layout:"vertical",class:"flex flex-col justify-center space-y-3","no-style":"",autocomplete:"off",onFinish:S},{default:s(()=>[o(P,{value:r(d).description,"onUpdate:value":l[1]||(l[1]=n=>r(d).description=n),size:"middle",placeholder:e.$t("labels.description")},null,8,["value","placeholder"]),t("div",he,[o(c,{type:"primary","html-type":"submit",class:"!rounded-md"},{default:s(()=>[x(a(e.$t("general.generate")),1)]),_:1})])]),_:1},8,["model"])])]),_:1},8,["visible","class"]),o(T,{visible:r(u),"onUpdate:visible":l[5]||(l[5]=n=>D(u)?u.value=n:null),closable:!1,width:"28rem",centered:"",footer:null,"wrap-class-name":"nc-modal-delete-token"},{default:s(()=>[t("div",ge,[be,t("div",$e,[o(c,{class:"!rounded-md",onClick:l[3]||(l[3]=n=>u.value=!1)},{default:s(()=>[x(a(e.$t("general.cancel")),1)]),_:1}),o(c,{class:"!rounded-md",type:"primary",danger:"",onClick:l[4]||(l[4]=n=>A())},{default:s(()=>[x(a(e.$t("general.confirm")),1)]),_:1})])])]),_:1},8,["visible"]),t("div",Ce,[t("div",Te,[t("div",je,[o(c,{size:"middle",type:"text",onClick:l[6]||(l[6]=n=>w())},{default:s(()=>[t("div",Me,[(i(),_(h(r(g).reload),{class:"text-gray-500"})),t("div",De,a(e.$t("general.reload")),1)])]),_:1}),o(c,{type:"primary",size:"middle",class:"!rounded-md",onClick:z},{default:s(()=>[t("div",Ne,[(i(),_(h(r(g).plus))),t("div",null,a(e.$t("activity.newToken")),1)])]),_:1})])]),r(C)?(i(),p("div",Ie,[t("div",Ve,[t("div",ze,a(e.$t("labels.description")),1),t("div",Be,a(e.$t("labels.token")),1),t("div",Se,a(e.$t("labels.action")),1)]),(i(!0),p(ee,null,te(r(C),(n,W)=>(i(),p("div",{key:W,class:"flex flex-col"},[t("div",Ae,[t("div",Fe,a(n.description),1),t("div",Re,[n.show?(i(),p("span",Ee,a(n.token),1)):(i(),p("span",Pe,"****************************************"))]),t("div",Ue,[o(j,{placement:"bottom"},{title:s(()=>[n.show?(i(),p("span",Le,a(e.$t("general.hide")),1)):(i(),p("span",Oe,a(e.$t("general.show")),1))]),default:s(()=>[o(c,{type:"text",class:"!rounded-md",onClick:M=>n.show=!n.show},{icon:s(()=>[n.show?(i(),_(L,{key:0,class:"flex mx-auto h-[1.1rem]"})):(i(),_(O,{key:1,class:"flex mx-auto h-[1rem]"}))]),_:2},1032,["onClick"])]),_:2},1024),o(j,{placement:"bottom"},{title:s(()=>[x(a(e.$t("general.copy")),1)]),default:s(()=>[o(c,{type:"text",class:"!rounded-md",onClick:M=>B(n.token)},{icon:s(()=>[(i(),_(h(r(g).copy),{class:"flex mx-auto h-[1rem]"}))]),_:2},1032,["onClick"])]),_:2},1024),o(K,{trigger:["click"],class:"flex",placement:"bottomRight","overlay-class-name":"nc-dropdown-api-token-mgmt"},{overlay:s(()=>[o(J,null,{default:s(()=>[o(H,null,{default:s(()=>[t("div",{class:"flex flex-row items-center py-4 h-[1rem]",onClick:M=>F(n)},[(i(),_(h(r(g).delete),{class:"flex"})),t("div",Ke,a(e.$t("general.remove")),1)],8,Je)]),_:2},1024)]),_:2},1024)]),default:s(()=>[t("div",Ge,[o(c,{type:"text",class:"!px-0"},{default:s(()=>[t("div",He,[o(G)])]),_:1})])]),_:2},1024)])])]))),128))])):oe("",!0)])])}}});export{Tt as default};
