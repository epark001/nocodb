import{h as B,S as F,$ as s,r as i,i as b,cq as m,aq as N,fp as z,k as G,ac as H,o as K,C as X,w as J,E as a,H as Q,I as T,eX as L}from"./entry.51f4e399.js";import{C as W,f as Z,d as ee,h as te,E as ae,q as le}from"./index.5263eb1d.js";import{p as ce}from"./useMetas.ba7abae7.js";import{u as re}from"./index.82c42c24.js";import{D as ne}from"./dayjs.5e586ea0.js";import{_ as oe}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.f911c8dd.js";import"./createForOfIteratorHelper.12419aa5.js";import"./index.d05e87a9.js";import"./useMergedState.5e6500b1.js";import"./useMemo.b13a9257.js";import"./useState.6010d8b6.js";import"./FormItemContext.e001cd7c.js";const se=B({__name:"DatePicker",props:{modelValue:{},isPk:{type:Boolean}},emits:["update:modelValue"],setup(o,{emit:S}){const{showNull:h}=F(),f=s(W,null),w=s(Z,i(!1)),$=s(ee,i(!1)),k=s(te,i(!1)),v=s(ae,i(!1)),q=i(!1),A=b(()=>{var e,c;return((c=ce((e=f==null?void 0:f.value)==null?void 0:e.meta))==null?void 0:c.date_format)??"YYYY-MM-DD"}),l=b({get(){if(o.modelValue){if(!m(o.modelValue).isValid()){q.value=!0;return}return/^\d+$/.test(o.modelValue)?m(+o.modelValue):m(o.modelValue)}},set(e){if(!e){S("update:modelValue",null);return}e.isValid()&&S("update:modelValue",e==null?void 0:e.format("YYYY-MM-DD"))}}),t=i(!1),E=`picker_${Math.floor(Math.random()*99999)}`;N(t,e=>{e?z(document.querySelector(`.${E}`),()=>t.value=!1):v.value=!1},{flush:"post"});const R=b(()=>o.modelValue===null&&h.value?"NULL":q.value?"Invalid date":"");re(k,e=>{var c,d,p,D,V,x,I,_,C,P,g,M,j,Y;switch(e.key){case"Enter":if(e.stopPropagation(),L())return;if(!t.value)t.value=!0;else{const r=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected");r&&(r.click(),t.value=!1)}break;case"Escape":if(L())return;t.value&&(e.stopPropagation(),t.value=!1);break;case"ArrowLeft":if(!l.value)(c=document.querySelector(".nc-picker-date.active .ant-picker-header-prev-btn"))==null||c.click();else{const r=(d=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected"))==null?void 0:d.previousElementSibling;if(r)r.click();else{const u=(V=(D=(p=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected"))==null?void 0:p.closest("tr"))==null?void 0:D.previousElementSibling)==null?void 0:V.querySelector("td:last-child");u?u.click():(x=document.querySelector(".nc-picker-date.active .ant-picker-header-prev-btn"))==null||x.click()}}break;case"ArrowRight":if(!l.value)(I=document.querySelector(".nc-picker-date.active .ant-picker-header-next-btn"))==null||I.click();else{const r=(_=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected"))==null?void 0:_.nextElementSibling;if(r)r.click();else{const u=(g=(P=(C=document.querySelector(".nc-picker-date.active .ant-picker-cell-selected"))==null?void 0:C.closest("tr"))==null?void 0:P.nextElementSibling)==null?void 0:g.querySelector("td:first-child");u?u.click():(M=document.querySelector(".nc-picker-date.active .ant-picker-header-next-btn"))==null||M.click()}}break;case"ArrowUp":l.value||(j=document.querySelector(".nc-picker-date.active .ant-picker-header-super-prev-btn"))==null||j.click();break;case"ArrowDown":l.value||(Y=document.querySelector(".nc-picker-date.active .ant-picker-header-super-next-btn"))==null||Y.click();break;case";":l.value=m(new Date);break}});const U=e=>{t.value&&!e&&(t.value=!1)},n=s(le,null),y=()=>{t.value=(k.value||v.value)&&!t.value};G(()=>{n==null||n.on(y)}),H(()=>{n==null||n.on(y)});const O=()=>{n||y()};return(e,c)=>{const d=ne;return K(),X(d,{value:a(l),"onUpdate:value":c[0]||(c[0]=p=>Q(l)?l.value=p:null),bordered:!1,class:T(["!w-full !px-0 !border-none",{"nc-null":e.modelValue===null&&a(h)}]),format:a(A),placeholder:a(R),"allow-clear":!a(w)&&!a(l)&&!e.isPk,"input-read-only":!0,"dropdown-class-name":`${E} nc-picker-date ${a(t)?"active":""}`,open:(a(w)||a(l)&&e.isPk)&&!a(k)&&!a(v)||a($)?!1:a(t),onClick:O,"onUpdate:open":U},{suffixIcon:J(()=>[]),_:1},8,["value","class","format","placeholder","allow-clear","dropdown-class-name","open"])}}});const qe=oe(se,[["__scopeId","data-v-8551149e"]]);export{qe as default};
