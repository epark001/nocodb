/*! For license information please see main.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.libs=t():e.libs=t()}("undefined"!=typeof self?self:this,(()=>(()=>{"use strict";var __webpack_modules__={68281:(e,t,a)=>{var i,n,s;a.r(t),a.d(t,{AllowedColumnTypesForQrAndBarcodes:()=>y,Api:()=>m,AppEvents:()=>Z,AuditOperationSubTypes:()=>q,AuditOperationTypes:()=>$,ClickhouseTables:()=>ee,ContentType:()=>o,CustomAPI:()=>fe,ErrorMessages:()=>L,ExportTypes:()=>P,HttpClient:()=>p,ModelTypes:()=>U,MssqlUi:()=>S,MysqlUi:()=>v,OracleUi:()=>I,OrderedProjectRoles:()=>oe,OrderedWorkspaceRoles:()=>se,OrgUserRoles:()=>Y,PgUi:()=>O,PluginCategory:()=>D,ProjectRoles:()=>X,ProjectStatus:()=>B,ProjectTypes:()=>M,RelationTypes:()=>N,RoleColors:()=>ne,RoleLabels:()=>ie,SnowflakeUi:()=>x,SqlUiFactory:()=>R,SqliteUi:()=>C,TemplateGenerator:()=>he,TiptapMarksTypes:()=>V,TiptapNodesTypes:()=>F,UITypes:()=>b,ViewTypes:()=>A,WorkspacePlan:()=>ae,WorkspaceStatus:()=>te,WorkspaceUserRoles:()=>Q,XcActionType:()=>n,XcNotificationType:()=>s,XcType:()=>i,extractRolesObj:()=>J,filterOutSystemColumns:()=>G,getSystemColumns:()=>W,getSystemColumnsIds:()=>H,isLinksOrLTAR:()=>_,isNumericCol:()=>h,isSystemColumn:()=>z,isVirtualCol:()=>g,jsepCurlyHook:()=>de,jsepTreeToFormula:()=>me,mergeSwaggerSchema:()=>_e,numericUITypes:()=>f,stringifyRolesObj:()=>K,substituteColumnAliasWithIdInFormula:()=>ue,substituteColumnIdWithAliasInFormula:()=>pe,validatePassword:()=>ge}),function(e){e.ID="ID",e.ForeignKey="ForeignKey",e.SingleLineText="SingleLineText",e.LongText="LongText",e.Attachment="Attachment",e.Checkbox="Checkbox",e.MultiSelect="MultiSelect",e.SingleSelect="SingleSelect",e.Collaborator="Collaborator",e.Date="Date",e.Year="Year",e.Time="Time",e.PhoneNumber="PhoneNumber",e.Email="Email",e.URL="URL",e.Number="Number",e.Decimal="Decimal",e.Currency="Currency",e.Percent="Percent",e.Duration="Duration",e.Rating="Rating",e.Formula="Formula",e.Rollup="Rollup",e.Count="Count",e.Lookup="Lookup",e.DateTime="DateTime",e.CreateTime="CreateTime",e.LastModifiedTime="LastModifiedTime",e.AutoNumber="AutoNumber",e.Barcode="Barcode",e.Button="Button",e.Password="Password"}(i||(i={})),function(e){e.SUBMIT="SUBMIT",e.TEST="TEST",e.CLEAR="CLEAR",e.CANCEL="CANCEL"}(n||(n={})),function(e){e.EMAIL="Email",e.URL="URL",e.DISCORD="Discord",e.TELEGRAM="Telegram",e.SLACK="Slack",e.WHATSAPP="Whatsapp",e.TWILIO="Twilio"}(s||(s={}));var o,r,l=a(52167),c=a.n(l),d=function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((i=i.apply(e,t||[])).next())}))},u=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};!function(e){e.Json="application/json",e.FormData="multipart/form-data",e.UrlEncoded="application/x-www-form-urlencoded"}(o||(o={}));class p{constructor(e={}){var{securityWorker:t,secure:a,format:i}=e,n=u(e,["securityWorker","secure","format"]);this.securityData=null,this.setSecurityData=e=>{this.securityData=e},this.request=e=>d(this,void 0,void 0,(function*(){var{secure:t,path:a,type:i,query:n,format:s,wrapped:r,body:l}=e,c=u(e,["secure","path","type","query","format","wrapped","body"]);const d=("boolean"==typeof t?t:this.secure)&&this.securityWorker&&(yield this.securityWorker(this.securityData))||{},p=this.mergeRequestParams(c,d),m=s&&this.format||void 0;return i===o.FormData&&l&&null!==l&&"object"==typeof l&&(p.headers.common={Accept:"*/*"},p.headers.post={},p.headers.put={},l=this.createFormData(l)),this.instance.request(Object.assign(Object.assign({},p),{headers:Object.assign(Object.assign({},i&&i!==o.FormData?{"Content-Type":i}:{}),p.headers||{}),params:n,responseType:m,data:l,url:a})).then((e=>r?e:e.data))})),this.instance=c().create(Object.assign(Object.assign({},n),{baseURL:n.baseURL||"http://localhost:8080"})),this.secure=a,this.format=i,this.securityWorker=t}mergeRequestParams(e,t){return Object.assign(Object.assign(Object.assign(Object.assign({},this.instance.defaults),e),t||{}),{headers:Object.assign(Object.assign(Object.assign({},this.instance.defaults.headers||{}),e.headers||{}),t&&t.headers||{})})}createFormData(e){return e instanceof FormData?e:Object.keys(e||{}).reduce(((t,a)=>{const i=e[a];if(i instanceof Blob)t.append(a,i);else if("object"==typeof i&&null!==i)if(Array.isArray(i))for(const e of i)t.append(`${a}[]`,e);else t.append(a,JSON.stringify(i));else t.append(a,`${i}`);return t}),new FormData)}}class m extends p{constructor(){super(...arguments),this.auth={signup:(e,t={})=>this.request(Object.assign({path:"/api/v1/auth/user/signup",method:"POST",body:e,type:o.Json,format:"json"},t)),signout:(e={})=>this.request(Object.assign({path:"/api/v1/auth/user/signout",method:"POST",format:"json"},e)),signin:(e,t={})=>this.request(Object.assign({path:"/api/v1/auth/user/signin",method:"POST",body:e,type:o.Json,format:"json"},t)),me:(e,t={})=>this.request(Object.assign({path:"/api/v1/auth/user/me",method:"GET",query:e,format:"json"},t)),passwordForgot:(e,t={})=>this.request(Object.assign({path:"/api/v1/auth/password/forgot",method:"POST",body:e,type:o.Json,format:"json"},t)),passwordChange:(e,t={})=>this.request(Object.assign({path:"/api/v1/auth/password/change",method:"POST",body:e,type:o.Json,format:"json"},t)),passwordResetTokenValidate:(e,t={})=>this.request(Object.assign({path:`/api/v1/auth/token/validate/${e}`,method:"POST",format:"json"},t)),emailValidate:(e,t={})=>this.request(Object.assign({path:`/api/v1/auth/email/validate/${e}`,method:"POST",format:"json"},t)),passwordReset:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/auth/password/reset/${e}`,method:"POST",body:t,type:o.Json,format:"json"},a)),tokenRefresh:(e={})=>this.request(Object.assign({path:"/api/v1/auth/token/refresh",method:"POST",format:"json"},e)),projectUserList:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/users`,method:"GET",format:"json"},t)),projectUserAdd:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/users`,method:"POST",body:t,type:o.Json,format:"json"},a)),projectUserUpdate:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/users/${t}`,method:"PATCH",body:a,type:o.Json,format:"json"},i)),projectUserRemove:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/users/${t}`,method:"DELETE",format:"json"},a)),projectUserResendInvite:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/users/${t}/resend-invite`,method:"POST",format:"json"},a))},this.orgTokens={list:(e={})=>this.request(Object.assign({path:"/api/v1/tokens",method:"GET",format:"json"},e)),create:(e,t={})=>this.request(Object.assign({path:"/api/v1/tokens",method:"POST",body:e,type:o.Json,format:"json"},t)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/tokens/${e}`,method:"DELETE",format:"json"},t))},this.orgLicense={get:(e={})=>this.request(Object.assign({path:"/api/v1/license",method:"GET",format:"json"},e)),set:(e,t={})=>this.request(Object.assign({path:"/api/v1/license",method:"POST",body:e,type:o.Json,format:"json"},t))},this.orgAppSettings={get:(e={})=>this.request(Object.assign({path:"/api/v1/app-settings",method:"GET",format:"json"},e)),set:(e,t={})=>this.request(Object.assign({path:"/api/v1/app-settings",method:"POST",body:e,type:o.Json,format:"json"},t))},this.orgUsers={list:(e={})=>this.request(Object.assign({path:"/api/v1/users",method:"GET",format:"json"},e)),add:(e,t={})=>this.request(Object.assign({path:"/api/v1/users",method:"POST",body:e,type:o.Json,format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/users/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/users/${e}`,method:"DELETE",format:"json"},t)),getByUsername:(e,t={})=>this.request(Object.assign({path:`/api/v1/users/${e}`,method:"GET",format:"json"},t)),resendInvite:(e,t={})=>this.request(Object.assign({path:`/api/v1/users/${e}/resend-invite`,method:"POST",format:"json"},t)),profileCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/users/${e}/profile`,method:"POST",body:t,type:o.Json},a)),profileGet:(e,t={})=>this.request(Object.assign({path:`/api/v1/users/${e}/profile`,method:"GET"},t)),profileUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/users/${e}/profile`,method:"PATCH",body:t,type:o.Json},a)),followerCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/users/${e}/follower`,method:"POST",body:t,type:o.Json},a)),followerList:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/users/${e}/follower`,method:"GET",body:t,type:o.Json},a)),followerDelete:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/users/${e}/follower`,method:"DELETE",body:t,type:o.Json},a)),followingList:(e,t={})=>this.request(Object.assign({path:`/api/v1/users/${e}/following`,method:"GET"},t)),isFollowing:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/users/${e}/isFollowing/${t}`,method:"GET"},a)),generatePasswordResetToken:(e,t={})=>this.request(Object.assign({path:`/api/v1/users/${e}/generate-reset-url`,method:"POST",format:"json"},t))},this.project={metaGet:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/info`,method:"GET",format:"json"},t)),modelVisibilityList:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/visibility-rules`,method:"GET",query:t,format:"json"},a)),modelVisibilitySet:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/visibility-rules`,method:"POST",body:t,type:o.Json,format:"json"},a)),list:(e={})=>this.request(Object.assign({path:"/api/v1/db/meta/projects/",method:"GET",format:"json"},e)),create:(e,t={})=>this.request(Object.assign({path:"/api/v1/db/meta/projects/",method:"POST",body:e,type:o.Json,format:"json"},t)),baseDuplicate:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/duplicate/${e}/${a}`,method:"POST",body:t,type:o.Json,format:"json"},i)),duplicate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/duplicate/${e}`,method:"POST",body:t,type:o.Json,format:"json"},a)),read:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}`,method:"GET",format:"json"},t)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}`,method:"DELETE",format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),userMetaUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/user`,method:"PATCH",body:t,type:o.Json},a)),sharedBaseGet:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/shared`,method:"GET",format:"json"},t)),sharedBaseDisable:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/shared`,method:"DELETE",format:"json"},t)),sharedBaseCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/shared`,method:"POST",body:t,type:o.Json,format:"json"},a)),sharedBaseUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/shared`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),cost:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/cost`,method:"GET",format:"json"},t)),metaDiffSync:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/meta-diff`,method:"POST",format:"json"},t)),metaDiffGet:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/meta-diff`,method:"GET",format:"json"},t)),hasEmptyOrNullFilters:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/has-empty-or-null-filters`,method:"GET",format:"json"},t)),auditList:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/audits`,method:"GET",query:t,format:"json"},a))},this.base={read:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/bases/${t}`,method:"GET",format:"json"},a)),delete:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/bases/${t}`,method:"DELETE",format:"json"},a)),update:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/bases/${t}`,method:"PATCH",body:a,type:o.Json,format:"json"},i)),createSqlView:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/bases/${t}/sqlView`,method:"POST",body:a,type:o.Json,format:"json"},i)),list:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/bases/`,method:"GET",format:"json"},t)),create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/bases/`,method:"POST",body:t,type:o.Json,format:"json"},a)),shareErd:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/bases/${t}/share/erd`,method:"POST",format:"json"},a)),disableShareErd:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/bases/${t}/share/erd`,method:"DELETE"},a)),tableList:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/${t}/tables`,method:"GET",query:a},i)),tableCreate:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/${t}/tables`,method:"POST",body:a,type:o.Json,format:"json"},i)),metaDiffSync:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/meta-diff/${t}`,method:"POST",format:"json"},a)),metaDiffGet:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/meta-diff/${t}`,method:"GET",format:"json"},a))},this.dbTable={create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/tables`,method:"POST",body:t,type:o.Json,format:"json"},a)),list:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/tables`,method:"GET",query:t},a)),read:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}`,method:"GET",format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}`,method:"DELETE",format:"json"},t)),duplicate:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/duplicate/${e}/table/${t}`,method:"POST",body:a,type:o.Json,format:"json"},i)),reorder:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/reorder`,method:"POST",body:t,type:o.Json,format:"json"},a))},this.dbTableColumn={create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/columns`,method:"POST",body:t,type:o.Json},a)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/columns/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/columns/${e}`,method:"DELETE"},t)),get:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/columns/${e}`,method:"GET"},t)),primaryColumnSet:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/columns/${e}/primary`,method:"POST",format:"json"},t)),hash:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/columns/hash`,method:"GET",format:"json"},t)),bulk:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/columns/bulk`,method:"POST",body:t,type:o.Json,format:"json"},a))},this.dbView={list:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/views`,method:"GET",format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}`,method:"DELETE",format:"json"},t)),showAllColumn:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/show-all`,method:"POST",query:t,format:"json"},a)),hideAllColumn:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/hide-all`,method:"POST",query:t,format:"json"},a)),gridCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/grids`,method:"POST",body:t,type:o.Json,format:"json"},a)),formCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/forms`,method:"POST",body:t,type:o.Json,format:"json"},a)),formUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/forms/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),formRead:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/forms/${e}`,method:"GET",format:"json"},t)),formColumnUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/form-columns/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),gridUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/grids/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),gridColumnsList:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/grids/${e}/grid-columns`,method:"GET",format:"json"},t)),gridColumnUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/grid-columns/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),galleryCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/galleries`,method:"POST",body:t,type:o.Json,format:"json"},a)),galleryUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/galleries/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),galleryRead:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/galleries/${e}`,method:"GET",format:"json"},t)),kanbanCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/kanbans`,method:"POST",body:t,type:o.Json,format:"json"},a)),kanbanUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/kanbans/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),kanbanRead:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/kanbans/${e}`,method:"GET",format:"json"},t)),mapCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/maps`,method:"POST",body:t,type:o.Json,format:"json"},a)),mapUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/maps/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),mapRead:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/maps/${e}`,method:"GET",format:"json"},t))},this.dbViewShare={list:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/share`,method:"GET",format:"json"},t)),create:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/share`,method:"POST",format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/share`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/share`,method:"DELETE",format:"json"},t))},this.dbViewColumn={list:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/columns`,method:"GET",format:"json"},t)),create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/columns`,method:"POST",body:t,type:o.Json,format:"json"},a)),update:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/columns/${t}`,method:"PATCH",body:a,type:o.Json,format:"json"},i))},this.dbTableSort={list:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/sorts`,method:"GET",format:"json"},t)),create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/sorts`,method:"POST",body:t,type:o.Json,format:"json"},a)),get:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/sorts/${e}`,method:"GET",format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/sorts/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/sorts/${e}`,method:"DELETE",format:"json"},t))},this.dbTableFilter={read:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/filters`,method:"GET",format:"json"},t)),create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/views/${e}/filters`,method:"POST",body:t,type:o.Json,format:"json"},a)),get:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/filters/${e}`,method:"GET",format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/filters/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/filters/${e}`,method:"DELETE",format:"json"},t)),childrenRead:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/filters/${e}/children`,method:"GET",format:"json"},t))},this.dbTableWebhookFilter={read:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/hooks/${e}/filters`,method:"GET",format:"json"},t)),create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/hooks/${e}/filters`,method:"POST",body:t,type:o.Json,format:"json"},a))},this.dbTableWebhookLogs={list:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/hooks/${e}/logs`,method:"GET",query:t,format:"json"},a))},this.dbTableRow={list:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}`,method:"GET",query:i,format:"json"},n)),create:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}`,method:"POST",body:i,type:o.Json,format:"json"},n)),findOne:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/find-one`,method:"GET",query:i,format:"json"},n)),groupBy:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/groupby`,method:"GET",query:i,format:"json"},n)),groupedDataList:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/group/${i}`,method:"GET",query:n,format:"json"},s)),read:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/${i}`,method:"GET",query:n,format:"json"},s)),update:(e,t,a,i,n,s,r={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/${i}`,method:"PATCH",query:s,body:n,type:o.Json,format:"json"},r)),delete:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/${i}`,method:"DELETE",query:n,format:"json"},s)),exist:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/${i}/exist`,method:"GET",format:"json"},n)),bulkCreate:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/bulk/${e}/${t}/${a}`,method:"POST",body:i,type:o.Json,format:"json"},n)),bulkUpdate:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/bulk/${e}/${t}/${a}`,method:"PATCH",body:i,type:o.Json,format:"json"},n)),bulkDelete:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/bulk/${e}/${t}/${a}`,method:"DELETE",body:i,type:o.Json,format:"json"},n)),bulkUpdateAll:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/bulk/${e}/${t}/${a}/all`,method:"PATCH",query:n,body:i,type:o.Json,format:"json"},s)),bulkDeleteAll:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/bulk/${e}/${t}/${a}/all`,method:"DELETE",query:n,body:i,type:o.Json,format:"json"},s)),csvExport:(e,t,a,i,n={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/export/${i}`,method:"GET",wrapped:!0},n)),nestedList:(e,t,a,i,n,s,o,r={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/${i}/${n}/${s}`,method:"GET",query:o,format:"json"},r)),nestedAdd:(e,t,a,i,n,s,o,r,l={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/${i}/${n}/${s}/${o}`,method:"POST",query:r,format:"json"},l)),nestedRemove:(e,t,a,i,n,s,o,r={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/${i}/${n}/${s}/${o}`,method:"DELETE",format:"json"},r)),nestedChildrenExcludedList:(e,t,a,i,n,s,o,r={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/${i}/${n}/${s}/exclude`,method:"GET",query:o,format:"json"},r))},this.dbViewRow={groupedDataList:(e,t,a,i,n,s,o={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/group/${n}`,method:"GET",query:s,format:"json"},o)),list:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}`,method:"GET",query:n,format:"json"},s)),create:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}`,method:"POST",body:n,type:o.Json,format:"json"},s)),findOne:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/find-one`,method:"GET",query:n,format:"json"},s)),groupBy:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/groupby`,method:"GET",query:n,format:"json"},s)),count:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/count`,method:"GET",query:n,format:"json"},s)),read:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/${n}`,method:"GET",format:"json"},s)),update:(e,t,a,i,n,s,r={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/${n}`,method:"PATCH",body:s,type:o.Json,format:"json"},r)),delete:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/${n}`,method:"DELETE",format:"json"},s)),exist:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/${n}/exist`,method:"GET",format:"json"},s)),export:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/data/${e}/${t}/${a}/views/${i}/export/${n}`,method:"GET",wrapped:!0},s))},this.public={groupedDataList:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-view/${e}/group/${t}`,method:"GET",query:a,format:"json"},i)),dataList:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-view/${e}/rows`,method:"GET",query:t,format:"json"},a)),dataCreate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-view/${e}/rows`,method:"POST",body:t,type:o.FormData,format:"json"},a)),dataGroupBy:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-view/${e}/groupby`,method:"GET",query:t,format:"json"},a)),dataNestedList:(e,t,a,i,n,s={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-view/${e}/rows/${t}/${a}/${i}`,method:"GET",query:n,format:"json"},s)),csvExport:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-view/${e}/rows/export/${t}`,method:"GET",wrapped:!0},a)),dataRelationList:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-view/${e}/nested/${t}`,method:"GET",query:a,format:"json"},i)),sharedBaseGet:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-base/${e}/meta`,method:"GET",format:"json"},t)),sharedViewMetaGet:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-view/${e}/meta`,method:"GET",format:"json"},t)),sharedErdMetaGet:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/public/shared-erd/${e}/meta`,method:"GET"},t))},this.utils={commentList:(e,t={})=>this.request(Object.assign({path:"/api/v1/db/meta/audits/comments",method:"GET",query:e,format:"json"},t)),commentRow:(e,t={})=>this.request(Object.assign({path:"/api/v1/db/meta/audits/comments",method:"POST",body:e,type:o.Json,format:"json"},t)),commentUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/audits/${e}/comment`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),commentCount:(e,t={})=>this.request(Object.assign({path:"/api/v1/db/meta/audits/comments/count",method:"GET",query:e,format:"json"},t)),auditRowUpdate:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/audits/rows/${e}/update`,method:"POST",body:t,type:o.Json,format:"json"},a)),testConnection:(e,t={})=>this.request(Object.assign({path:"/api/v1/db/meta/connection/test",method:"POST",body:e,type:o.Json,format:"json"},t)),selectQuery:(e,t={})=>this.request(Object.assign({path:"/api/v1/db/meta/connection/select",method:"POST",body:e,type:o.Json,format:"json"},t)),urlToConfig:(e,t={})=>this.request(Object.assign({path:"/api/v1/url_to_config",method:"POST",body:e,type:o.Json,format:"json"},t)),appInfo:(e={})=>this.request(Object.assign({path:"/api/v1/db/meta/nocodb/info",method:"GET",format:"json"},e)),axiosRequestMake:(e,t={})=>this.request(Object.assign({path:"/api/v1/db/meta/axiosRequestMake",method:"POST",body:e,type:o.Json,format:"json"},t)),appVersion:(e={})=>this.request(Object.assign({path:"/api/v1/version",method:"GET",format:"json"},e)),appHealth:(e={})=>this.request(Object.assign({path:"/api/v1/health",method:"GET",format:"json"},e)),aggregatedMetaInfo:(e={})=>this.request(Object.assign({path:"/api/v1/aggregated-meta-info",method:"GET",format:"json"},e)),cacheGet:(e={})=>this.request(Object.assign({path:"/api/v1/db/meta/cache",method:"GET"},e)),cacheDelete:(e={})=>this.request(Object.assign({path:"/api/v1/db/meta/cache",method:"DELETE",format:"json"},e))},this.dbTableWebhook={list:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/hooks`,method:"GET",format:"json"},t)),create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/hooks`,method:"POST",body:t,type:o.Json,format:"json"},a)),test:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/hooks/test`,method:"POST",body:t,type:o.Json,format:"json"},a)),samplePayloadGet:(e,t,a,i={})=>this.request(Object.assign({path:`/api/v1/db/meta/tables/${e}/hooks/samplePayload/${t}/${a}`,method:"GET",format:"json"},i)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/hooks/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/hooks/${e}`,method:"DELETE",format:"json"},t))},this.plugin={list:(e={})=>this.request(Object.assign({path:"/api/v1/db/meta/plugins",method:"GET",format:"json"},e)),webhookList:(e={})=>this.request(Object.assign({path:"/api/v1/db/meta/plugins/webhook",method:"GET",format:"json"},e)),status:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/plugins/${e}/status`,method:"GET",format:"json"},t)),test:(e,t={})=>this.request(Object.assign({path:"/api/v1/db/meta/plugins/test",method:"POST",body:e,type:o.Json,format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/plugins/${e}`,method:"PATCH",body:t,type:o.Json,format:"json"},a)),read:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/plugins/${e}`,method:"GET",format:"json"},t))},this.apiToken={list:(e,t={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/api-tokens`,method:"GET",format:"json"},t)),create:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/api-tokens`,method:"POST",body:t,type:o.Json,format:"json"},a)),delete:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/db/meta/projects/${e}/api-tokens/${t}`,method:"DELETE",format:"json"},a))},this.storage={upload:(e,t,a={})=>this.request(Object.assign({path:"/api/v1/db/storage/upload",method:"POST",query:e,body:t,type:o.FormData},a)),uploadByUrl:(e,t,a={})=>this.request(Object.assign({path:"/api/v1/db/storage/upload-by-url",method:"POST",query:e,body:t,type:o.Json},a))},this.notification={list:(e,t={})=>this.request(Object.assign({path:"/api/v1/notifications",method:"GET",query:e,format:"json"},t)),update:(e,t,a={})=>this.request(Object.assign({path:`/api/v1/notifications/${e}`,method:"PATCH",body:t,type:o.Json},a)),delete:(e,t={})=>this.request(Object.assign({path:`/api/v1/notifications/${e}`,method:"DELETE"},t)),markAllAsRead:(e={})=>this.request(Object.assign({path:"/api/v1/notifications/mark-all-read",method:"POST"},e))}}}!function(e){e.ID="ID",e.LinkToAnotherRecord="LinkToAnotherRecord",e.ForeignKey="ForeignKey",e.Lookup="Lookup",e.SingleLineText="SingleLineText",e.LongText="LongText",e.Attachment="Attachment",e.Checkbox="Checkbox",e.MultiSelect="MultiSelect",e.SingleSelect="SingleSelect",e.Collaborator="Collaborator",e.Date="Date",e.Year="Year",e.Time="Time",e.PhoneNumber="PhoneNumber",e.GeoData="GeoData",e.Email="Email",e.URL="URL",e.Number="Number",e.Decimal="Decimal",e.Currency="Currency",e.Percent="Percent",e.Duration="Duration",e.Rating="Rating",e.Formula="Formula",e.Rollup="Rollup",e.Count="Count",e.DateTime="DateTime",e.CreateTime="CreateTime",e.LastModifiedTime="LastModifiedTime",e.AutoNumber="AutoNumber",e.Geometry="Geometry",e.JSON="JSON",e.SpecificDBType="SpecificDBType",e.Barcode="Barcode",e.QrCode="QrCode",e.Button="Button",e.Links="Links"}(r||(r={}));const f=[r.Duration,r.Currency,r.Percent,r.Number,r.Decimal,r.Rating,r.Rollup,r.Year,r.Links];function h(e){return f.includes("object"==typeof e?null==e?void 0:e.uidt:e)}function g(e){return[r.LinkToAnotherRecord,r.Formula,r.QrCode,r.Barcode,r.Rollup,r.Lookup,r.Links].includes("object"==typeof e?null==e?void 0:e.uidt:e)}function _(e){return[r.LinkToAnotherRecord,r.Links].includes("object"==typeof e?null==e?void 0:e.uidt:e)}const b=r,y=[b.Formula,b.SingleLineText,b.LongText,b.PhoneNumber,b.URL,b.Email,b.Decimal,b.Number,b.AutoNumber,b.ID],w=["int","smallint","mediumint","bigint","bit","boolean","float","decimal","double","serial","tinyint","date","datetime","timestamp","time","year","char","varchar","nchar","text","tinytext","mediumtext","longtext","binary","varbinary","blob","tinyblob","mediumblob","longblob","enum","set","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","json"];class v{static getNewTableColumns(){return[{column_name:"id",title:"Id",dt:"int",dtx:"integer",ct:"int(11)",nrqd:!1,rqd:!0,ck:!1,pk:!0,un:!0,ai:!0,cdf:null,clen:null,np:11,ns:0,dtxp:"11",dtxs:"",altered:1,uidt:"ID",uip:"",uicn:""},{column_name:"title",title:"Title",dt:"varchar",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""},{column_name:"created_at",title:"CreatedAt",dt:"timestamp",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:"CURRENT_TIMESTAMP",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""},{column_name:"updated_at",title:"UpdatedAt",dt:"timestamp",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""}]}static getNewColumn(e){return{column_name:"title"+e,dt:"varchar",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""}}static getDefaultLengthForDatatype(e){switch(e){case"int":return 11;case"tinyint":return 1;case"smallint":return 5;case"mediumint":return 9;case"bigint":case"serial":return 20;case"bit":return 64;case"boolean":case"date":case"datetime":case"timestamp":case"time":case"year":case"text":case"tinytext":case"mediumtext":case"longtext":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":case"json":return"";case"float":return 12;case"decimal":return 10;case"double":return 22;case"char":case"varchar":case"nchar":case"binary":return 255;case"varbinary":return 65500}}static getDefaultLengthIsDisabled(e){switch(e){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"serial":case"datetime":case"timestamp":case"char":case"varchar":case"nchar":case"binary":case"varbinary":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":case"json":case"bit":return!1;case"boolean":case"date":case"time":case"year":case"text":case"tinytext":case"mediumtext":case"longtext":case"blob":case"tinyblob":case"mediumblob":case"longblob":return!0}}static getDefaultValueForDatatype(e){switch(e){case"int":case"smallint":case"mediumint":case"float":case"decimal":case"double":return"eg : 10";case"tinyint":case"bit":case"boolean":case"binary":return"eg : 1";case"bigint":case"serial":return"eg : 100";case"date":return"eg : 2020-09-09";case"datetime":case"timestamp":return"eg : now()\n\nCURRENT_TIMESTAMP\n\nCURRENT_TIMESTAMP on update CURRENT_TIMESTAMP\n\n1992-10-12 00:00:00";case"time":return"eg : 00:00:00";case"year":return"eg : 2020";case"char":case"enum":case"set":return"eg : a";case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":return"eg : hey";case"geometry":return"geometry can't have default value";case"point":return"point can't have default value";case"linestring":return"linestring can't have default value";case"polygon":return"polygon can't have default value";case"multipoint":return"multipoint can't have default value";case"multilinestring":return"multilinestring can't have default value";case"multipolygon":return"multipolygon can't have default value";case"json":return"JSON can't have default value"}}static getDefaultScaleForDatatype(e){switch(e){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"bit":case"boolean":case"serial":case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":case"json":return" ";case"float":case"decimal":case"double":return"2"}}static colPropAIDisabled(e,t){if("int"===e.dt||"tinyint"===e.dt||"bigint"===e.dt||"smallint"===e.dt){for(let a=0;a<t.length;++a)if(t[a].cn!==e.cn&&t[a].ai)return!0;return!1}return!0}static colPropUNDisabled(e){return"int"!==e.dt&&"tinyint"!==e.dt&&"smallint"!==e.dt&&"mediumint"!==e.dt&&"bigint"!==e.dt}static onCheckboxChangeAI(e){"int"!==e.dt&&"bigint"!==e.dt&&"smallint"!==e.dt&&"tinyint"!==e.dt||(e.altered=e.altered||2)}static onCheckboxChangeAU(e){console.log(e),e.altered=e.altered||2}static showScale(e){return"float"===e.dt||"decimal"===e.dt||"double"===e.dt||"real"===e.dt}static removeUnsigned(e){for(let t=0;t<e.length;++t)1===e[t].altered&&"int"!==e[t].dt&&"bigint"!==e[t].dt&&"tinyint"!==e[t].dt&&"smallint"!==e[t].dt&&"mediumint"!==e[t].dt&&(e[t].un=!1,console.log(">> resetting unsigned value",e[t].cn)),console.log(e[t].cn)}static columnEditable(e){return"_evolutions"!==e.tn||"nc_evolutions"!==e.tn}static colPropAuDisabled(e){return!0}static getUIType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"json":return"LongText";case"blob":return"Attachment";case"enum":return"SingleSelect";case"set":return"MultiSelect"}}static getAbstractType(e){var t;switch(null===(t=e.dt)||void 0===t?void 0:t.toLowerCase()){case"int":case"smallint":case"mediumint":case"bigint":case"bit":return"integer";case"boolean":return"boolean";case"float":case"decimal":case"double":case"serial":return"float";case"tinyint":return"1"==e.dtxp?"boolean":"integer";case"date":return"date";case"datetime":case"timestamp":return"datetime";case"time":return"time";case"year":return"year";case"char":case"varchar":case"nchar":case"binary":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":return"string";case"text":case"tinytext":case"mediumtext":case"longtext":case"varbinary":return"text";case"blob":case"tinyblob":case"mediumblob":case"longblob":return"blob";case"enum":return"enum";case"set":return"set";case"json":return"json"}}static getDataTypeForUiType(e,t){var a,i;const n={};switch(e.uidt){case"ID":{const e="AI"===t,a="AG"===t;n.dt=a?"varchar":"int",n.pk=!0,n.un=e,n.ai=e,n.rqd=!0,n.meta=a?{ag:"nc"}:void 0}break;case"ForeignKey":case"SingleLineText":case"Collaborator":case"Date":case"Formula":case"Rollup":case"Lookup":case"Barcode":case"Button":default:n.dt="varchar";break;case"LongText":case"Attachment":case"GeoData":n.dt="text";break;case"Checkbox":n.dt="tinyint",n.dtxp=1,n.cdf="0";break;case"MultiSelect":n.dt="set",((null===(a=e.colOptions)||void 0===a?void 0:a.options.length)>64||(null===(i=e.dtxp)||void 0===i?void 0:i.split(",").length)>64)&&(n.dt="text");break;case"SingleSelect":n.dt="enum";break;case"Year":n.dt="year";break;case"Time":n.dt="time";break;case"PhoneNumber":n.dt="varchar",n.validate={func:["isMobilePhone"],args:[""],msg:["Validation failed : isMobilePhone ({cn})"]};break;case"Email":n.dt="varchar",n.validate={func:["isEmail"],args:[""],msg:["Validation failed : isEmail ({cn})"]};break;case"URL":n.dt="varchar",n.validate={func:["isURL"],args:[""],msg:["Validation failed : isURL ({cn})"]};break;case"Number":n.dt="bigint";break;case"Decimal":case"Duration":n.dt="decimal";break;case"Currency":n.dt="decimal",n.validate={func:["isCurrency"],args:[""],msg:["Validation failed : isCurrency"]};break;case"Percent":n.dt="double";break;case"Rating":n.dt="int",n.cdf="0";break;case"Count":case"AutoNumber":n.dt="int";break;case"DateTime":case"CreateTime":case"LastModifiedTime":n.dt="datetime";break;case"JSON":n.dt="json"}return n}static getDataTypeListForUiType(e,t){switch(e.uidt){case"ID":return"AG"===t?["varchar","char","nchar"]:"AI"===t?["int","smallint","mediumint","bigint","bit","serial"]:w;case"ForeignKey":case"Button":default:return w;case"SingleLineText":case"LongText":case"Collaborator":case"GeoData":case"Formula":return["char","varchar","nchar","text","tinytext","mediumtext","longtext"];case"Attachment":return["json","char","varchar","nchar","text","tinytext","mediumtext","longtext"];case"JSON":return["json","text","tinytext","mediumtext","longtext"];case"Checkbox":return["int","smallint","mediumint","bigint","bit","boolean","serial","tinyint"];case"MultiSelect":return["set","text","tinytext","mediumtext","longtext"];case"SingleSelect":return["enum","text","tinytext","mediumtext","longtext"];case"Year":return["year"];case"Time":return["time"];case"PhoneNumber":case"Email":case"Rollup":case"Lookup":case"Barcode":return["varchar"];case"URL":return["text","tinytext","mediumtext","longtext","varchar"];case"Number":return["int","smallint","mediumint","bigint","bit","float","decimal","double","serial"];case"Decimal":return["float","decimal","double","serial"];case"Currency":case"Percent":case"Duration":case"Rating":return["decimal","float","double","serial","int","smallint","mediumint","bigint","bit"];case"Count":return["int","smallint","mediumint","bigint","serial"];case"Date":return["date","datetime","timestamp","varchar"];case"DateTime":case"CreateTime":case"LastModifiedTime":return["datetime","timestamp","varchar"];case"AutoNumber":return["int","smallint","mediumint","bigint"];case"Geometry":return["geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon"]}}static getUnsupportedFnList(){return[]}}const T=["int","integer","bigint","bigserial","char","int2","int4","int8","int4range","int8range","serial","serial2","serial8","character","bit","bool","boolean","date","double precision","event_trigger","fdw_handler","float4","float8","uuid","smallint","smallserial","character varying","text","real","time","time without time zone","timestamp","timestamp without time zone","timestamptz","timestamp with time zone","timetz","time with time zone","daterange","json","jsonb","gtsvector","index_am_handler","anyenum","anynonarray","anyrange","box","bpchar","bytea","cid","cidr","circle","cstring","inet","internal","interval","language_handler","line","lsec","macaddr","money","name","numeric","numrange","oid","opaque","path","pg_ddl_command","pg_lsn","pg_node_tree","point","polygon","record","refcursor","regclass","regconfig","regdictionary","regnamespace","regoper","regoperator","regproc","regpreocedure","regrole","regtype","reltime","smgr","tid","tinterval","trigger","tsm_handler","tsquery","tsrange","tstzrange","tsvector","txid_snapshot","unknown","void","xid","xml"];class O{static getNewTableColumns(){return[{column_name:"id",title:"Id",dt:"int4",dtx:"integer",ct:"int(11)",nrqd:!1,rqd:!0,ck:!1,pk:!0,un:!1,ai:!0,cdf:null,clen:null,np:11,ns:0,dtxp:"11",dtxs:"",altered:1,uidt:"ID",uip:"",uicn:""},{column_name:"title",title:"Title",dt:"character varying",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""},{column_name:"created_at",title:"CreatedAt",dt:"timestamp",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:"now()",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""},{column_name:"updated_at",title:"UpdatedAt",dt:"timestamp",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,au:!0,cdf:"now()",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""}]}static getNewColumn(e){return{column_name:"title"+e,dt:"character varying",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""}}static getDefaultLengthForDatatype(e){switch(e){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"bit":case"boolean":case"float":case"decimal":case"double":case"serial":case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":case"json":return""}}static getDefaultLengthIsDisabled(e){switch(e){case"anyenum":case"anynonarray":case"anyrange":case"bigint":case"bigserial":case"bit":case"bool":case"box":case"bpchar":case"bytea":case"char":case"character":case"cid":case"cidr":case"circle":case"cstring":case"date":case"daterange":case"double precision":case"event_trigger":case"fdw_handler":case"float4":case"float8":case"gtsvector":case"index_am_handler":case"inet":case"int":case"int2":case"int4":case"int8":case"int4range":case"int8range":case"integer":case"internal":case"interval":case"jsonb":case"language_handler":case"line":case"lsec":case"macaddr":case"money":case"name":case"numeric":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"real":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":case"smgr":case"text":case"tid":case"time":case"time without time zone":case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"timetz":case"time with time zone":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"xml":case"character varying":case"tinyint":case"mediumint":case"float":case"decimal":case"double":case"boolean":case"datetime":case"uuid":case"year":case"varchar":case"nchar":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":case"json":return!0}}static getDefaultValueForDatatype(e){switch(e){case"anyenum":case"anynonarray":case"anyrange":case"bigint":case"bigserial":case"bit":case"bool":case"box":case"bpchar":case"bytea":case"char":case"cid":case"cidr":case"circle":case"cstring":case"daterange":case"event_trigger":case"fdw_handler":case"gtsvector":case"index_am_handler":case"inet":case"int":case"int2":case"int4":case"int8":case"int4range":case"int8range":case"integer":case"internal":case"interval":case"json":case"jsonb":case"language_handler":case"line":case"lsec":case"macaddr":case"money":case"name":case"numeric":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"point":case"polygon":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":case"smgr":case"tid":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"xml":case"tinyint":case"mediumint":case"float":case"decimal":case"datetime":case"uuid":case"year":case"varchar":case"nchar":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":case"set":case"geometry":case"linestring":case"multipoint":case"multilinestring":case"multipolygon":return"eg: ";case"character":return"eg: 'sample'";case"date":return"eg: '2020-09-09'";case"double precision":case"float4":case"float8":case"real":case"double":return"eg: 1.2";case"text":case"character varying":return"eg: 'sample text'";case"time":case"time without time zone":return"eg: now()\n\n'04:05:06.789'";case"timestamp":case"timestamp without time zone":case"timestamp with time zone":return"eg: now()\n\n'2016-06-22 19:10:25-07'";case"timestamptz":return"eg: timezone('America/New_York','2016-06-01 00:00')\n\nnow()\n\n'2016-06-22 19:10:25-07'";case"timetz":case"time with time zone":return"eg: now()";case"boolean":return"eg: true\n\nfalse"}}static getDefaultScaleForDatatype(e){switch(e){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"bit":case"boolean":case"serial":case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":case"json":return" ";case"float":case"decimal":case"double":return"2"}}static colPropAIDisabled(e,t){if("int4"===e.dt||"integer"===e.dt||"bigint"===e.dt||"smallint"===e.dt){for(let a=0;a<t.length;++a)if(t[a].cn!==e.cn&&t[a].ai)return!0;return!1}return!0}static colPropUNDisabled(e){return!0}static onCheckboxChangeAI(e){console.log(e),"int"!==e.dt&&"bigint"!==e.dt&&"smallint"!==e.dt&&"tinyint"!==e.dt||(e.altered=e.altered||2)}static onCheckboxChangeAU(e){console.log(e),e.altered=e.altered||2,e.au&&(e.cdf="now()")}static showScale(e){return!1}static removeUnsigned(e){for(let t=0;t<e.length;++t)1===e[t].altered&&"int"!==e[t].dt&&"bigint"!==e[t].dt&&"tinyint"!==e[t].dt&&"smallint"!==e[t].dt&&"mediumint"!==e[t].dt&&(e[t].un=!1,console.log(">> resetting unsigned value",e[t].cn)),console.log(e[t].cn)}static columnEditable(e){return"_evolutions"!==e.tn||"nc_evolutions"!==e.tn}static colPropAuDisabled(e){if(1!==e.altered)return!0;switch(e.dt){case"time":case"time without time zone":case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"timetz":case"time with time zone":return!1;default:return!0}}static getAbstractType(e){var t;switch(null===(t=e.dt)||void 0===t?void 0:t.toLowerCase()){case"anyenum":case"enum":return"enum";case"anynonarray":case"anyrange":case"box":case"bpchar":case"bytea":case"char":case"character":case"cid":case"cidr":case"circle":case"cstring":case"daterange":case"double precision":case"event_trigger":case"fdw_handler":case"gtsvector":case"index_am_handler":case"inet":case"int4range":case"int8range":case"internal":case"interval":case"language_handler":case"line":case"lsec":case"macaddr":case"money":case"name":case"numeric":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"point":case"polygon":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"smgr":case"tid":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"character varying":case"xml":case"uuid":case"year":case"varchar":case"nchar":case"binary":case"varbinary":case"geometry":case"linestring":case"multipoint":case"multilinestring":case"multipolygon":return"string";case"bit":case"int":case"int2":case"int4":case"int8":case"integer":case"bigint":case"bigserial":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":case"tinyint":case"mediumint":return"integer";case"bool":case"boolean":return"boolean";case"date":return"date";case"float4":case"float8":case"real":case"float":case"decimal":case"double":return"float";case"text":case"tinytext":case"mediumtext":case"longtext":return"text";case"time":case"time without time zone":case"timetz":case"time with time zone":return"time";case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"datetime":return"datetime";case"blob":case"tinyblob":case"mediumblob":case"longblob":return"blob";case"set":return"set";case"json":case"jsonb":return"json"}}static getUIType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"CreateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"json":return"LongText";case"blob":return"Attachment";case"enum":return"SingleSelect";case"set":return"MultiSelect"}}static getDataTypeForUiType(e,t){const a={};switch(e.uidt){case"ID":{const e="AI"===t,i="AG"===t;a.dt=i?"character varying":"int4",a.pk=!0,a.un=e,a.ai=e,a.rqd=!0,a.meta=i?{ag:"nc"}:void 0}break;case"ForeignKey":case"SingleLineText":case"Collaborator":case"Formula":case"Rollup":case"Lookup":case"Barcode":case"Button":default:a.dt="character varying";break;case"LongText":case"Attachment":case"GeoData":case"MultiSelect":case"SingleSelect":a.dt="text";break;case"Checkbox":a.dt="bool",a.cdf="false";break;case"Date":a.dt="date";break;case"Year":case"AutoNumber":a.dt="int";break;case"Time":a.dt="time";break;case"PhoneNumber":a.dt="character varying",a.validate={func:["isMobilePhone"],args:[""],msg:["Validation failed : isMobilePhone"]};break;case"Email":a.dt="character varying",a.validate={func:["isEmail"],args:[""],msg:["Validation failed : isEmail"]};break;case"URL":a.dt="character varying",a.validate={func:["isURL"],args:[""],msg:["Validation failed : isURL"]};break;case"Number":a.dt="bigint";break;case"Decimal":case"Duration":a.dt="decimal";break;case"Currency":a.dt="decimal",a.validate={func:["isCurrency"],args:[""],msg:["Validation failed : isCurrency"]};break;case"Percent":a.dt="double precision";break;case"Rating":a.dt="smallint",a.cdf="0";break;case"Count":a.dt="int8";break;case"DateTime":case"CreateTime":case"LastModifiedTime":a.dt="timestamp";break;case"JSON":a.dt="json"}return a}static getDataTypeListForUiType(e,t){switch(e.uidt){case"ID":return"AG"===t?["char","character","character varying"]:"AI"===t?["int","integer","bigint","bigserial","int2","int4","int8","serial","serial2","serial8","smallint","smallserial"]:T;case"ForeignKey":case"Button":default:return T;case"SingleLineText":case"LongText":case"Collaborator":case"GeoData":return["char","character","character varying","text"];case"Attachment":return["json","char","character","character varying","text"];case"JSON":return["json","jsonb","text"];case"Checkbox":return["bit","bool","int2","int4","int8","boolean","smallint","int","integer","bigint","bigserial","char","int4range","int8range","serial","serial2","serial8"];case"MultiSelect":case"SingleSelect":return["text"];case"Year":return["int"];case"Time":return["time","time without time zone","timestamp","timestamp without time zone","timestamptz","timestamp with time zone","timetz","time with time zone"];case"PhoneNumber":case"Email":case"Rollup":case"Lookup":case"Barcode":return["character varying"];case"URL":return["character varying","text"];case"Number":case"Percent":case"Duration":case"Rating":return["int","integer","bigint","bigserial","int2","int4","int8","serial","serial2","serial8","double precision","float4","float8","smallint","smallserial","numeric"];case"Decimal":return["double precision","float4","float8","numeric"];case"Currency":return["int","integer","bigint","bigserial","int2","int4","int8","serial","serial2","serial8","double precision","money","float4","float8","numeric"];case"Formula":return["text","character varying"];case"Count":case"AutoNumber":return["int","integer","bigint","bigserial","int2","int4","int8","serial","serial2","serial8","smallint","smallserial"];case"Date":return["date","timestamp","timestamp without time zone","timestamptz","timestamp with time zone"];case"DateTime":case"CreateTime":case"LastModifiedTime":return["timestamp","timestamp without time zone","timestamptz","timestamp with time zone"];case"Geometry":return["polygon","point","circle","box","line","lseg","path","circle"]}}static getUnsupportedFnList(){return[]}}const E=["bigint","binary","bit","char","date","datetime","datetime2","datetimeoffset","decimal","float","geography","geometry","heirarchyid","image","int","money","nchar","ntext","numeric","nvarchar","real","json","smalldatetime","smallint","smallmoney","sql_variant","sysname","text","time","timestamp","tinyint","uniqueidentifier","varbinary","xml","varchar"];class S{static getNewTableColumns(){return[{column_name:"id",title:"Id",dt:"int",dtx:"integer",ct:"int(11)",nrqd:!1,rqd:!0,ck:!1,pk:!0,un:!1,ai:!0,cdf:null,clen:null,np:null,ns:0,dtxp:"",dtxs:"",altered:1,uidt:"ID",uip:"",uicn:""},{column_name:"title",title:"Title",dt:"varchar",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""},{column_name:"created_at",title:"CreatedAt",dt:"datetime",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:"GETDATE()",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""},{column_name:"updated_at",title:"UpdatedAt",dt:"datetime",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,au:!0,cdf:"GETDATE()",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""}]}static getNewColumn(e){return{column_name:"title"+e,dt:"varchar",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""}}static getDefaultLengthForDatatype(e){switch(e){case"decimal":return 10;case"varchar":return 255;default:return""}}static getDefaultLengthIsDisabled(e){switch(e){case"nvarchar":case"numeric":case"decimal":case"varchar":return!1;default:return!0}}static getDefaultValueForDatatype(e){switch(e){case"bigint":case"binary":case"bit":case"char":case"date":case"datetime":case"datetime2":case"datetimeoffset":case"decimal":case"float":case"geography":case"geometry":case"heirarchyid":case"image":case"int":case"money":case"nchar":case"ntext":case"numeric":case"nvarchar":case"real":case"json":case"smalldatetime":case"smallint":case"smallmoney":case"sql_variant":case"sysname":case"text":case"time":case"timestamp":case"tinyint":case"uniqueidentifier":case"varbinary":case"xml":case"varchar":return"eg: ";default:return""}}static getDefaultScaleForDatatype(e){switch(e){case"decimal":case"numeric":return"2";default:return""}}static colPropAIDisabled(e,t){if("int4"===e.dt||"integer"===e.dt||"bigint"===e.dt||"smallint"===e.dt){for(let a=0;a<t.length;++a)if(t[a].cn!==e.cn&&t[a].ai)return!0;return!1}return!0}static colPropUNDisabled(e){return!0}static onCheckboxChangeAI(e){console.log(e),"int"!==e.dt&&"bigint"!==e.dt&&"smallint"!==e.dt&&"tinyint"!==e.dt||(e.altered=e.altered||2)}static showScale(e){return"decimal"===e.dt||"numeric"===e.dt}static removeUnsigned(e){for(let t=0;t<e.length;++t)1===e[t].altered&&"int"!==e[t].dt&&"bigint"!==e[t].dt&&"tinyint"!==e[t].dt&&"smallint"!==e[t].dt&&"mediumint"!==e[t].dt&&(e[t].un=!1,console.log(">> resetting unsigned value",e[t].cn)),console.log(e[t].cn)}static columnEditable(e){return"_evolutions"!==e.tn||"nc_evolutions"!==e.tn}static onCheckboxChangeAU(e){console.log(e),e.altered=e.altered||2,e.au&&(e.cdf="GETDATE()")}static colPropAuDisabled(e){if(1!==e.altered)return!0;switch(e.dt){case"date":case"datetime":case"datetime2":case"datetimeoffset":case"time":case"timestamp":return!1;default:return!0}}static getAbstractType(e){var t;switch(null===(t=e.dt)||void 0===t?void 0:t.toLowerCase()){case"bigint":case"smallint":case"bit":case"tinyint":case"int":return"integer";case"binary":case"char":case"geography":case"geometry":case"heirarchyid":case"image":case"money":case"nchar":case"nvarchar":case"smallmoney":case"sql_variant":case"sysname":case"uniqueidentifier":case"varbinary":case"xml":case"varchar":return"string";case"date":return"date";case"datetime":case"datetime2":case"smalldatetime":case"datetimeoffset":return"datetime";case"decimal":case"float":case"numeric":case"real":return"float";case"ntext":case"text":return"text";case"json":return"json";case"time":return"time";case"timestamp":return"timestamp"}return"string"}static getUIType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"CreateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"json":return"LongText";case"blob":return"Attachment";case"enum":return"SingleSelect";case"set":return"MultiSelect"}}static getDataTypeForUiType(e,t){const a={};switch(e.uidt){case"ID":{const e="AI"===t,i="AG"===t;a.dt=i?"varchar":"int",a.pk=!0,a.un=e,a.ai=e,a.rqd=!0,a.meta=i?{ag:"nc"}:void 0}break;case"ForeignKey":case"SingleLineText":case"Collaborator":case"GeoData":case"Formula":case"Rollup":case"Lookup":case"Barcode":case"Button":default:a.dt="varchar";break;case"LongText":case"Attachment":case"MultiSelect":case"SingleSelect":a.dt="text";break;case"Checkbox":a.dt="tinyint",a.dtxp=1,a.cdf="0";break;case"Date":a.dt="date";break;case"Year":case"Number":case"Count":case"AutoNumber":a.dt="int";break;case"Time":a.dt="time";break;case"PhoneNumber":a.dt="varchar",a.validate={func:["isMobilePhone"],args:[""],msg:["Validation failed : isMobilePhone"]};break;case"Email":a.dt="varchar",a.validate={func:["isEmail"],args:[""],msg:["Validation failed : isEmail"]};break;case"URL":a.dt="varchar",a.validate={func:["isURL"],args:[""],msg:["Validation failed : isURL"]};break;case"Decimal":case"Duration":a.dt="decimal";break;case"Currency":a.dt="decimal",a.validate={func:["isCurrency"],args:[""],msg:["Validation failed : isCurrency"]};break;case"Percent":a.dt="double";break;case"Rating":a.dt="int",a.cdf="0";break;case"DateTime":a.dt="datetimeoffset";break;case"CreateTime":case"LastModifiedTime":a.dt="datetime"}return a}static getDataTypeListForUiType(e,t){switch(e.uidt){case"ID":return"AG"===t?["char","ntext","text","varchar","nvarchar"]:"AI"===t?["int","bigint","bit","smallint","tinyint"]:E;case"ForeignKey":case"Button":default:return E;case"SingleLineText":case"LongText":case"Attachment":case"Collaborator":case"GeoData":return["char","ntext","text","varchar","nvarchar"];case"JSON":case"MultiSelect":case"SingleSelect":return["text","ntext"];case"Checkbox":return["bigint","bit","int","tinyint"];case"Year":return["int"];case"Time":return["time"];case"PhoneNumber":case"Email":case"Rollup":case"Lookup":case"Barcode":return["varchar"];case"URL":return["varchar","text"];case"Number":case"Percent":case"Duration":case"Rating":return["int","bigint","bit","decimal","float","numeric","real","smallint","tinyint"];case"Decimal":return["decimal","float"];case"Currency":return["int","bigint","bit","decimal","float","numeric","real","smallint","tinyint","money"];case"Formula":return["text","ntext","varchar","nvarchar"];case"Count":case"AutoNumber":return["int","bigint","smallint","tinyint"];case"Date":return["date"];case"DateTime":case"CreateTime":case"LastModifiedTime":return["datetimeoffset","datetime2"];case"Geometry":return["geometry"]}}static getUnsupportedFnList(){return[]}}class I{static getNewTableColumns(){return[{column_name:"id",title:"Id",dt:"integer",dtx:"integer",ct:"int(11)",nrqd:!1,rqd:!0,ck:!1,pk:!0,un:!1,ai:!1,cdf:null,clen:null,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:"ID",uip:"",uicn:""},{column_name:"title",title:"Title",dt:"varchar",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""}]}static getNewColumn(e){return{column_name:"title"+e,dt:"varchar",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""}}static getDefaultLengthForDatatype(e){return""}static getDefaultLengthIsDisabled(e){switch(e){case"integer":return!0;case"bfile":case"binary rowid":case"binary double":case"binary_float":case"blob":case"canoical":case"cfile":case"char":case"clob":case"content pointer":case"contigous array":case"date":case"decimal":case"double precision":case"float":case"interval day to second":case"interval year to month":case"lob pointer":case"long":case"long raw":case"named collection":case"named object":case"nchar":case"nclob":case"number":case"nvarchar2":case"octet":case"oid":case"pointer":case"raw":case"real":case"ref":case"ref cursor":case"rowid":case"signed binary integer":case"smallint":case"table":case"time":case"time with tz":case"timestamp":case"timestamp with local time zone":case"timestamp with local tz":case"timestamp with timezone":case"timestamp with tz":case"unsigned binary integer":case"urowid":case"varchar":case"varchar2":case"varray":case"varying array":return!1}}static getDefaultValueForDatatype(e){return""}static getDefaultScaleForDatatype(e){switch(e){case"integer":case"bfile":case"binary rowid":case"binary double":case"binary_float":case"blob":case"canoical":case"cfile":case"char":case"clob":case"content pointer":case"contigous array":case"date":case"decimal":case"double precision":case"float":case"interval day to second":case"interval year to month":case"lob pointer":case"long":case"long raw":case"named collection":case"named object":case"nchar":case"nclob":case"number":case"nvarchar2":case"octet":case"oid":case"pointer":case"raw":case"real":case"ref":case"ref cursor":case"rowid":case"signed binary integer":case"smallint":case"table":case"time":case"time with tz":case"timestamp":case"timestamp with local time zone":case"timestamp with local tz":case"timestamp with timezone":case"timestamp with tz":case"unsigned binary integer":case"urowid":case"varchar":case"varchar2":case"varray":case"varying array":return" "}}static colPropAIDisabled(e,t){if("int4"===e.dt||"integer"===e.dt||"bigint"===e.dt||"smallint"===e.dt){for(let a=0;a<t.length;++a)if(t[a].cn!==e.cn&&t[a].ai)return!0;return!1}return!0}static colPropUNDisabled(e){return!0}static onCheckboxChangeAI(e){console.log(e),"int"!==e.dt&&"bigint"!==e.dt&&"smallint"!==e.dt&&"tinyint"!==e.dt||(e.altered=e.altered||2)}static showScale(e){return!1}static removeUnsigned(e){for(let t=0;t<e.length;++t)1===e[t].altered&&"int"!==e[t].dt&&"bigint"!==e[t].dt&&"tinyint"!==e[t].dt&&"smallint"!==e[t].dt&&"mediumint"!==e[t].dt&&(e[t].un=!1,console.log(">> resetting unsigned value",e[t].cn)),console.log(e[t].cn)}static columnEditable(e){return"_evolutions"!==e.tn||"nc_evolutions"!==e.tn}static extractFunctionName(e){const t=e.match(/^\s*CREATE\s+(?:OR\s+REPLACE\s*)?\s*FUNCTION\s+(?:[\w\d_]+\.)?([\w_\d]+)/i);return t&&t[1]}static extractProcedureName(e){const t=e.match(/^\s*CREATE\s+(?:OR\s+REPLACE\s*)?\s*PROCEDURE\s+(?:[\w\d_]+\.)?([\w_\d]+)/i);return t&&t[1]}static splitQueries(e){return e.match(/\b("[^"]*;[^"]*"|'[^']*;[^']*'|[^;])*;/g)}static onCheckboxChangeAU(e){console.log(e),e.altered=e.altered||2}sanitiseQuery(e){let t=e.query.trim().split(";");if(t[0].startsWith("Select"))t=t[0]+` LIMIT 0,${e.limit?e.limit:100};`;else if(t[0].startsWith("select"))t=t[0]+` LIMIT 0,${e.limit?e.limit:100};`;else{if(!t[0].startsWith("SELECT"))return e.query;t=t[0]+` LIMIT 0,${e.limit?e.limit:100};`}return t}getColumnsFromJson(e,t){const a=[];try{if("object"==typeof e&&!Array.isArray(e)){const i=Object.keys(e);for(let n=0;n<i.length;++n)switch(typeof e[i[n]]){case"number":Number.isInteger(e[i[n]])?a.push({dp:null,tn:t,column_name:i[n],cno:i[n],dt:"int",np:10,ns:0,clen:null,cop:1,pk:!1,nrqd:!1,rqd:!1,un:!1,ct:"int(11) unsigned",ai:!1,unique:!1,cdf:null,cc:"",csn:null,dtx:"specificType",dtxp:"11",dtxs:0,altered:1}):a.push({dp:null,tn:t,column_name:i[n],cno:i[n],dt:"float",np:10,ns:2,clen:null,cop:1,pk:!1,nrqd:!1,rqd:!1,un:!1,ct:"int(11) unsigned",ai:!1,unique:!1,cdf:null,cc:"",csn:null,dtx:"specificType",dtxp:"11",dtxs:2,altered:1});break;case"string":e[i[n]].length<=255?a.push({dp:null,tn:t,column_name:i[n],cno:i[n],dt:"varchar",np:45,ns:0,clen:null,cop:1,pk:!1,nrqd:!1,rqd:!1,un:!1,ct:"int(11) unsigned",ai:!1,unique:!1,cdf:null,cc:"",csn:null,dtx:"specificType",dtxp:"45",dtxs:0,altered:1}):a.push({dp:null,tn:t,column_name:i[n],cno:i[n],dt:"text",np:null,ns:0,clen:null,cop:1,pk:!1,nrqd:!1,rqd:!1,un:!1,ct:"int(11) unsigned",ai:!1,unique:!1,cdf:null,cc:"",csn:null,dtx:"specificType",dtxp:null,dtxs:0,altered:1});break;case"boolean":a.push({dp:null,tn:t,column_name:i[n],cno:i[n],dt:"boolean",np:3,ns:0,clen:null,cop:1,pk:!1,nrqd:!1,rqd:!1,un:!1,ct:"int(11) unsigned",ai:!1,unique:!1,cdf:null,cc:"",csn:null,dtx:"specificType",dtxp:"1",dtxs:0,altered:1});break;case"object":a.push({dp:null,tn:t,column_name:i[n],cno:i[n],dt:"json",np:3,ns:0,clen:null,cop:1,pk:!1,nrqd:!1,rqd:!1,un:!1,ct:"int(11) unsigned",ai:!1,unique:!1,cdf:null,cc:"",csn:null,dtx:"specificType",dtxp:null,dtxs:0,altered:1})}}}catch(e){console.log("Error in getColumnsFromJson",e)}return a}static colPropAuDisabled(e){return!0}static getAbstractType(e){var t;switch(null===(t=e.dt)||void 0===t?void 0:t.toLowerCase()){case"integer":case"long":case"smallint":return"integer";case"bfile":case"binary rowid":case"binary double":case"binary_float":case"canoical":case"cfile":case"char":case"clob":case"content pointer":case"contigous array":case"interval day to second":case"interval year to month":case"lob pointer":case"long raw":case"named collection":case"named object":case"nchar":case"nclob":case"nvarchar2":case"octet":case"oid":case"pointer":case"raw":case"ref":case"ref cursor":case"rowid":case"signed binary integer":case"table":case"unsigned binary integer":case"urowid":case"varchar":case"varchar2":case"varray":case"varying array":return"string";case"blob":return"blob";case"date":return"date";case"decimal":case"double precision":case"float":case"real":case"number":return"float";case"time":case"time with tz":return"time";case"timestamp":case"timestamp with local time zone":case"timestamp with local tz":case"timestamp with timezone":case"timestamp with tz":return"datetime"}}static getUIType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"CreateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"json":return"LongText";case"blob":return"Attachment";case"enum":return"SingleSelect";case"set":return"MultiSelect"}}static getDataTypeForUiType(e,t){const a={};switch(e.uidt){case"ID":{const e="AI"===t,i="AG"===t;a.dt=i?"varchar":"integer",a.pk=!0,a.un=e,a.ai=e,a.rqd=!0,a.meta=i?{ag:"nc"}:void 0}break;case"ForeignKey":case"SingleLineText":case"GeoData":case"Collaborator":case"Date":case"Formula":case"Rollup":case"Lookup":case"Barcode":case"Button":default:a.dt="varchar";break;case"LongText":case"Attachment":a.dt="clob";break;case"Checkbox":a.dt="tinyint",a.dtxp=1,a.cdf="0";break;case"MultiSelect":case"SingleSelect":a.dt="varchar2";break;case"Year":a.dt="year";break;case"Time":a.dt="time";break;case"PhoneNumber":a.dt="varchar",a.validate={func:["isMobilePhone"],args:[""],msg:["Validation failed : isMobilePhone"]};break;case"Email":a.dt="varchar",a.validate={func:["isEmail"],args:[""],msg:["Validation failed : isEmail"]};break;case"URL":a.dt="varchar",a.validate={func:["isURL"],args:[""],msg:["Validation failed : isURL"]};break;case"Number":case"Duration":case"Count":case"AutoNumber":a.dt="integer";break;case"Decimal":a.dt="decimal";break;case"Currency":a.dt="decimal",a.validate={func:["isCurrency"],args:[""],msg:["Validation failed : isCurrency"]};break;case"Percent":a.dt="double";break;case"Rating":a.dt="integer",a.cdf="0";break;case"DateTime":case"CreateTime":case"LastModifiedTime":a.dt="timestamp"}return a}static getUnsupportedFnList(){return[]}}const k=["int","integer","tinyint","smallint","mediumint","bigint","int2","int8","character","blob sub_type text","blob","real","double","double precision","float","numeric","boolean","date","datetime","text","varchar","timestamp"];class C{static getNewTableColumns(){return[{column_name:"id",title:"Id",dt:"integer",dtx:"integer",ct:"int(11)",nrqd:!1,rqd:!0,ck:!1,pk:!0,un:!1,ai:!0,cdf:null,clen:null,np:null,ns:0,dtxp:"",dtxs:"",altered:1,uidt:"ID",uip:"",uicn:""},{column_name:"title",title:"Title",dt:"varchar",dtx:"specificType",ct:"varchar",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""},{column_name:"created_at",title:"CreatedAt",dt:"datetime",dtx:"specificType",ct:"varchar",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:"CURRENT_TIMESTAMP",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""},{column_name:"updated_at",title:"UpdatedAt",dt:"datetime",dtx:"specificType",ct:"varchar",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:"CURRENT_TIMESTAMP",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""}]}static getNewColumn(e){return{column_name:"title"+e,dt:"varchar",dtx:"specificType",ct:"varchar",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""}}static getDefaultLengthForDatatype(e){return""}static getDefaultLengthIsDisabled(e){switch(e){case"integer":case"blob":case"real":case"numeric":return!0;case"text":return!1}}static getDefaultValueForDatatype(e){switch(e){case"integer":case"numeric":case"real":return"eg : 10";case"text":return"eg : hey";case"blob":return"eg : 100"}}static getDefaultScaleForDatatype(e){switch(e){case"integer":case"text":case"numeric":case"real":case"blob":return" "}}static colPropAIDisabled(e,t){if("integer"===e.dt){for(let a=0;a<t.length;++a)if(t[a].cn!==e.cn&&t[a].ai)return!0;return!1}return!0}static colPropUNDisabled(e){return!0}static onCheckboxChangeAI(e){console.log(e),"int"!==e.dt&&"bigint"!==e.dt&&"smallint"!==e.dt&&"tinyint"!==e.dt||(e.altered=e.altered||2)}static showScale(e){return!1}static removeUnsigned(e){for(let t=0;t<e.length;++t)1===e[t].altered&&"int"!==e[t].dt&&"bigint"!==e[t].dt&&"tinyint"!==e[t].dt&&"smallint"!==e[t].dt&&"mediumint"!==e[t].dt&&(e[t].un=!1,console.log(">> resetting unsigned value",e[t].cn)),console.log(e[t].cn)}static onCheckboxChangeAU(e){console.log(e),e.altered=e.altered||2}static colPropAuDisabled(e){if(1!==e.altered)return!0;switch(e.dt){case"date":case"datetime":case"timestamp":case"time":return!1;default:return!0}}static getAbstractType(e){var t;switch(null===(t=e.dt)||void 0===t?void 0:t.replace(/\(\d+\)$/).toLowerCase()){case"date":return"date";case"datetime":case"timestamp":return"datetime";case"integer":case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"int2":case"int8":return"integer";case"text":return"text";case"boolean":return"boolean";case"real":case"double":case"double precision":case"float":case"decimal":case"numeric":return"float";case"blob sub_type text":case"blob":return"blob";case"character":case"varchar":return"string"}return"string"}static getUIType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"CreateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"json":return"LongText";case"blob":return"Attachment";case"enum":return"SingleSelect";case"set":return"MultiSelect"}}static getDataTypeForUiType(e,t){const a={};switch(e.uidt){case"ID":{const e="AI"===t,i="AG"===t;a.dt=i?"varchar":"integer",a.pk=!0,a.un=e,a.ai=e,a.rqd=!0,a.meta=i?{ag:"nc"}:void 0}break;case"ForeignKey":case"SingleLineText":case"Collaborator":case"Formula":case"Rollup":case"Lookup":case"Barcode":case"Button":default:a.dt="varchar";break;case"LongText":case"Attachment":case"GeoData":case"MultiSelect":case"SingleSelect":case"JSON":a.dt="text";break;case"Checkbox":a.dt="boolean",a.cdf="0";break;case"Date":a.dt="date";break;case"Year":a.dt="year";break;case"Time":a.dt="time";break;case"PhoneNumber":a.dt="varchar",a.validate={func:["isMobilePhone"],args:[""],msg:["Validation failed : isMobilePhone"]};break;case"Email":a.dt="varchar",a.validate={func:["isEmail"],args:[""],msg:["Validation failed : isEmail"]};break;case"URL":a.dt="varchar",a.validate={func:["isURL"],args:[""],msg:["Validation failed : isURL"]};break;case"Number":case"Count":case"AutoNumber":a.dt="integer";break;case"Decimal":case"Duration":a.dt="decimal";break;case"Currency":a.dt="double precision",a.validate={func:["isCurrency"],args:[""],msg:["Validation failed : isCurrency"]};break;case"Percent":a.dt="double";break;case"Rating":a.dt="integer",a.cdf="0";break;case"DateTime":case"CreateTime":case"LastModifiedTime":a.dt="datetime"}return a}static getDataTypeListForUiType(e,t){switch(e.uidt){case"ID":return"AG"===t?["character","text","varchar"]:"AI"===t?["int","integer","tinyint","smallint","mediumint","bigint","int2","int8"]:k;case"ForeignKey":case"Button":default:return k;case"SingleLineText":case"LongText":case"Attachment":case"Collaborator":case"GeoData":return["character","text","varchar"];case"Checkbox":return["int","integer","tinyint","smallint","mediumint","bigint","int2","int8","boolean"];case"MultiSelect":case"SingleSelect":case"Formula":return["text","varchar"];case"Year":case"Time":case"Duration":case"Count":case"AutoNumber":return["int","integer","tinyint","smallint","mediumint","bigint","int2","int8"];case"PhoneNumber":case"Email":case"URL":return["varchar","text"];case"Number":case"Rating":return["int","integer","tinyint","smallint","mediumint","bigint","int2","int8","numeric","real","double","double precision","float"];case"Decimal":return["real","double","double precision","float","numeric"];case"Currency":case"Percent":return["real","double","double precision","float","int","integer","tinyint","smallint","mediumint","bigint","int2","int8","numeric"];case"Rollup":case"Lookup":case"Barcode":return["varchar"];case"Date":return["date","varchar"];case"DateTime":case"CreateTime":case"LastModifiedTime":return["datetime","timestamp"];case"Geometry":case"JSON":return["text"]}}static getUnsupportedFnList(){return["LOG","EXP","POWER","SQRT"]}}const j=["NUMBER","DECIMAL","NUMERIC","INT","INTEGER","BIGINT","SMALLINT","TINYINT","BYTEINT","FLOAT","FLOAT4","FLOAT8","DOUBLE","DOUBLE PRECISION","REAL","VARCHAR","CHAR","CHARACTER","STRING","TEXT","BINARY","VARBINARY","BOOLEAN","DATE","DATETIME","TIME","TIMESTAMP","TIMESTAMP_LTZ","TIMESTAMP_NTZ","TIMESTAMP_TZ","VARIANT","OBJECT","ARRAY","GEOGRAPHY"];class x{static getNewTableColumns(){return[{column_name:"id",title:"Id",dt:"int",dtx:"integer",ct:"int(11)",nrqd:!1,rqd:!0,ck:!1,pk:!0,un:!1,ai:!0,cdf:null,clen:null,np:11,ns:0,dtxp:"11",dtxs:"",altered:1,uidt:"ID",uip:"",uicn:""},{column_name:"title",title:"Title",dt:"varchar",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""},{column_name:"created_at",title:"CreatedAt",dt:"timestamp",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:"current_timestamp()",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""},{column_name:"updated_at",title:"UpdatedAt",dt:"timestamp",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,au:!0,cdf:"current_timestamp()",clen:45,np:null,ns:null,dtxp:"",dtxs:"",altered:1,uidt:b.DateTime,uip:"",uicn:""}]}static getNewColumn(e){return{column_name:"title"+e,dt:"varchar",dtx:"specificType",ct:"varchar(45)",nrqd:!0,rqd:!1,ck:!1,pk:!1,un:!1,ai:!1,cdf:null,clen:45,np:null,ns:null,dtxp:"45",dtxs:"",altered:1,uidt:"SingleLineText",uip:"",uicn:""}}static getDefaultLengthForDatatype(e){switch(e){case"VARCHAR":case"CHAR":case"CHARACTER":case"STRING":return 255;case"NUMBER":case"DECIMAL":case"NUMERIC":case"INT":case"INTEGER":case"BIGINT":case"SMALLINT":case"TINYINT":case"BYTEINT":case"FLOAT":case"FLOAT4":case"FLOAT8":case"DOUBLE":case"DOUBLE PRECISION":case"REAL":return 38}}static getDefaultLengthIsDisabled(e){switch(e){case"VARCHAR":case"CHAR":case"CHARACTER":case"STRING":case"NUMBER":case"DECIMAL":case"NUMERIC":case"INT":case"INTEGER":case"BIGINT":case"SMALLINT":case"TINYINT":case"BYTEINT":case"FLOAT":case"FLOAT4":case"FLOAT8":case"DOUBLE":case"DOUBLE PRECISION":case"REAL":return!1;case"TEXT":case"BINARY":case"VARBINARY":case"BOOLEAN":case"DATE":case"DATETIME":case"TIME":case"TIMESTAMP":case"TIMESTAMP_LTZ":case"TIMESTAMP_NTZ":case"TIMESTAMP_TZ":case"VARIANT":case"OBJECT":case"ARRAY":case"GEOGRAPHY":return!0}}static getDefaultValueForDatatype(e){return"eg: "}static getDefaultScaleForDatatype(e){switch(e){case"NUMBER":case"DECIMAL":case"NUMERIC":case"INT":case"INTEGER":case"BIGINT":case"SMALLINT":case"TINYINT":case"BYTEINT":case"FLOAT":case"FLOAT4":case"FLOAT8":case"DOUBLE":case"DOUBLE PRECISION":case"REAL":case"VARCHAR":case"CHAR":case"CHARACTER":case"STRING":case"TEXT":case"BINARY":case"VARBINARY":case"BOOLEAN":case"DATE":case"DATETIME":case"TIME":case"TIMESTAMP":case"TIMESTAMP_LTZ":case"TIMESTAMP_NTZ":case"TIMESTAMP_TZ":case"VARIANT":case"OBJECT":case"ARRAY":case"GEOGRAPHY":return" "}}static colPropAIDisabled(e,t){if("NUMBER"===e.dt||"DECIMAL"===e.dt||"NUMERIC"===e.dt||"INT"===e.dt||"INTEGER"===e.dt||"BIGINT"===e.dt||"SMALLINT"===e.dt){for(let a=0;a<t.length;++a)if(t[a].cn!==e.cn&&t[a].ai)return!0;return!1}return!0}static colPropUNDisabled(e){return!0}static onCheckboxChangeAI(e){console.log(e),"NUMBER"!==e.dt&&"DECIMAL"!==e.dt&&"NUMERIC"!==e.dt&&"INT"!==e.dt&&"INTEGER"!==e.dt&&"BIGINT"!==e.dt&&"SMALLINT"!==e.dt||(e.altered=e.altered||2)}static onCheckboxChangeAU(e){console.log(e),e.altered=e.altered||2,e.au&&(e.cdf="current_timestamp()")}static showScale(e){return!1}static removeUnsigned(e){for(let t=0;t<e.length;++t)1===e[t].altered&&"INT"!==e[t].dt&&"BIGINT"!==e[t].dt&&"SMALLINT"!==e[t].dt&&"TINYINT"!==e[t].dt&&(e[t].un=!1,console.log(">> resetting unsigned value",e[t].cn)),console.log(e[t].cn)}static columnEditable(e){return"_evolutions"!==e.tn||"nc_evolutions"!==e.tn}static colPropAuDisabled(e){if(1!==e.altered)return!0;switch(e.dt.toUpperCase()){case"DATE":case"DATETIME":case"TIME":case"TIMESTAMP":case"TIMESTAMP_LTZ":case"TIMESTAMP_NTZ":case"TIMESTAMP_TZ":return!1;default:return!0}}static getAbstractType(e){var t;switch(null===(t=e.dt)||void 0===t?void 0:t.toUpperCase()){case"NUMBER":case"DECIMAL":case"NUMERIC":case"INT":case"INTEGER":case"BIGINT":case"SMALLINT":case"TINYINT":case"BYTEINT":return"integer";case"FLOAT":case"FLOAT4":case"FLOAT8":case"DOUBLE":case"DOUBLE PRECISION":case"REAL":return"float";case"VARCHAR":case"CHAR":case"CHARACTER":case"STRING":case"BINARY":case"VARBINARY":case"DATETIME":case"TIME":case"TIMESTAMP":case"TIMESTAMP_LTZ":case"TIMESTAMP_NTZ":case"TIMESTAMP_TZ":case"VARIANT":case"GEOGRAPHY":default:return"string";case"TEXT":return"text";case"BOOLEAN":return"boolean";case"DATE":return"date";case"OBJECT":return"json";case"ARRAY":return"enum"}}static getUIType(e){switch(this.getAbstractType(e)){case"NUMBER":case"DECIMAL":case"NUMERIC":case"INT":case"INTEGER":case"BIGINT":case"SMALLINT":case"TINYINT":case"BYTEINT":return"Number";case"FLOAT":case"FLOAT4":case"FLOAT8":case"DOUBLE":case"DOUBLE PRECISION":case"REAL":return"Decimal";case"VARCHAR":case"CHAR":case"CHARACTER":case"STRING":return"SingleLineText";case"TEXT":return"LongText";case"BOOLEAN":return"Checkbox";case"DATE":return"Date";case"DATETIME":return"DateTime"}}static getDataTypeForUiType(e,t){const a={};switch(e.uidt){case"ID":{const e="AI"===t,i="AG"===t;a.dt=i?"VARCHAR":"int4",a.pk=!0,a.un=e,a.ai=e,a.rqd=!0,a.meta=i?{ag:"nc"}:void 0}break;case"ForeignKey":case"SingleLineText":case"Collaborator":case"Time":case"Formula":case"Rollup":case"Lookup":case"Barcode":case"Button":default:a.dt="VARCHAR";break;case"LongText":case"Attachment":case"GeoData":case"MultiSelect":case"SingleSelect":case"JSON":a.dt="TEXT";break;case"Checkbox":a.dt="BOOLEAN",a.cdf="0";break;case"Date":a.dt="DATE";break;case"Year":case"Count":case"AutoNumber":a.dt="INT";break;case"PhoneNumber":a.dt="VARCHAR",a.validate={func:["isMobilePhone"],args:[""],msg:["Validation failed : isMobilePhone"]};break;case"Email":a.dt="VARCHAR",a.validate={func:["isEmail"],args:[""],msg:["Validation failed : isEmail"]};break;case"URL":a.dt="VARCHAR",a.validate={func:["isURL"],args:[""],msg:["Validation failed : isURL"]};break;case"Number":a.dt="BIGINT";break;case"Decimal":case"Duration":a.dt="DECIMAL";break;case"Currency":a.dt="DECIMAL",a.validate={func:["isCurrency"],args:[""],msg:["Validation failed : isCurrency"]};break;case"Percent":a.dt="DOUBLE PRECISION";break;case"Rating":a.dt="SMALLINT",a.cdf="0";break;case"DateTime":case"CreateTime":case"LastModifiedTime":a.dt="TIMESTAMP"}return a}static getDataTypeListForUiType(e,t){switch(e.uidt){case"ID":return"AG"===t?["VARCHAR"]:"AI"===t?["NUMBER"]:j;case"ForeignKey":case"Button":default:return j;case"SingleLineText":case"LongText":case"Collaborator":case"GeoData":return["CHAR","CHARACTER","VARCHAR","TEXT"];case"Attachment":return["TEXT","CHAR","CHARACTER","VARCHAR","text"];case"JSON":case"MultiSelect":case"SingleSelect":case"Geometry":return["TEXT"];case"Checkbox":return["BIT","BOOLEAN","TINYINT","INT","BIGINT"];case"Year":return["INT"];case"Time":return["TIMESTAMP","VARCHAR"];case"PhoneNumber":case"Email":case"Rollup":case"Lookup":case"Barcode":return["VARCHAR"];case"URL":return["VARCHAR","TEXT"];case"Number":return["NUMBER","DECIMAL","NUMERIC","INT","INTEGER","BIGINT","SMALLINT","TINYINT","BYTEINT","FLOAT","FLOAT4","FLOAT8","DOUBLE","DOUBLE PRECISION","REAL"];case"Decimal":return["DOUBLE","DOUBLE PRECISION","FLOAT","FLOAT4","FLOAT8","NUMERIC"];case"Currency":case"Percent":case"Duration":case"Rating":return["NUMBER","DECIMAL","NUMERIC","INT","INTEGER","BIGINT","FLOAT","FLOAT4","FLOAT8","DOUBLE","DOUBLE PRECISION"];case"Formula":return["TEXT","VARCHAR"];case"Count":case"AutoNumber":return["NUMBER","INT","INTEGER","BIGINT"];case"Date":return["DATE","TIMESTAMP"];case"DateTime":case"CreateTime":case"LastModifiedTime":return["TIMESTAMP"]}}static getUnsupportedFnList(){return[]}}class R{static create(e){if("mysql"===e.client||"mysql2"===e.client)return v;if("sqlite3"===e.client)return C;if("mssql"===e.client)return S;if("oracledb"===e.client)return I;if("pg"===e.client)return O;if("snowflake"===e.client)return x;throw new Error("Database not supported")}}var A,M,N,P,L,$,q,D,U,B,F,V;!function(e){e[e.FORM=1]="FORM",e[e.GALLERY=2]="GALLERY",e[e.GRID=3]="GRID",e[e.KANBAN=4]="KANBAN",e[e.MAP=5]="MAP"}(A||(A={})),function(e){e.DATABASE="database",e.DOCUMENTATION="documentation",e.COWRITER="cowriter",e.DASHBOARD="dashboard"}(M||(M={})),function(e){e.HAS_MANY="hm",e.BELONGS_TO="bt",e.MANY_TO_MANY="mm"}(N||(N={})),function(e){e.EXCEL="excel",e.CSV="csv"}(P||(P={})),function(e){e.INVALID_SHARED_VIEW_PASSWORD="INVALID_SHARED_VIEW_PASSWORD",e.NOT_IMPLEMENTED="NOT_IMPLEMENTED"}(L||(L={})),function(e){e.COMMENT="COMMENT",e.DATA="DATA",e.PROJECT="PROJECT",e.VIRTUAL_RELATION="VIRTUAL_RELATION",e.RELATION="RELATION",e.TABLE_VIEW="TABLE_VIEW",e.TABLE="TABLE",e.VIEW="VIEW",e.META="META",e.WEBHOOKS="WEBHOOKS",e.AUTHENTICATION="AUTHENTICATION",e.TABLE_COLUMN="TABLE_COLUMN",e.ORG_USER="ORG_USER"}($||($={})),function(e){e.UPDATE="UPDATE",e.INSERT="INSERT",e.BULK_INSERT="BULK_INSERT",e.BULK_UPDATE="BULK_UPDATE",e.BULK_DELETE="BULK_DELETE",e.LINK_RECORD="LINK_RECORD",e.UNLINK_RECORD="UNLINK_RECORD",e.DELETE="DELETE",e.CREATE="CREATE",e.RENAME="RENAME",e.IMPORT_FROM_ZIP="IMPORT_FROM_ZIP",e.EXPORT_TO_FS="EXPORT_TO_FS",e.EXPORT_TO_ZIP="EXPORT_TO_ZIP",e.SIGNIN="SIGNIN",e.SIGNUP="SIGNUP",e.PASSWORD_RESET="PASSWORD_RESET",e.PASSWORD_FORGOT="PASSWORD_FORGOT",e.PASSWORD_CHANGE="PASSWORD_CHANGE",e.EMAIL_VERIFICATION="EMAIL_VERIFICATION",e.ROLES_MANAGEMENT="ROLES_MANAGEMENT",e.INVITE="INVITE",e.RESEND_INVITE="RESEND_INVITE"}(q||(q={})),function(e){e.STORAGE="Storage",e.EMAIL="Email"}(D||(D={})),function(e){e.TABLE="table",e.VIEW="view"}(U||(U={})),function(e){e.JOB="job"}(B||(B={})),function(e){e.doc="doc",e.sec="sec",e.paragraph="paragraph",e.text="text",e.heading="heading",e.bullet="bullet",e.ordered="ordered",e.task="task",e.quote="quote",e.divider="divider",e.codeBlock="codeBlock",e.image="image",e.callout="callout",e.tipCallout="tipCallout",e.table="table",e.tableRow="tableRow",e.tableCell="tableCell",e.embed="embed",e.collapsable="collapsable",e.collapsableContent="collapsable_content",e.collapsableHeader="collapsable_header",e.column="column",e.columnContent="columnContent",e.linkToPage="linkToPage",e.attachment="attachment"}(F||(F={})),function(e){e.strike="strike",e.bold="bold",e.italic="italic",e.link="link",e.code="code",e.underline="underline"}(V||(V={}));const G=e=>e&&e.filter((e=>!z(e)))||[],H=e=>(e&&e.filter(z)||[]).map((e=>e.id)),W=e=>e.filter(z)||[],z=e=>e&&(e.uidt===b.ForeignKey||"created_at"===e.column_name||"updated_at"===e.column_name||e.pk&&(e.ai||e.cdf)||e.pk&&e.meta&&e.meta.ag||e.system),J=e=>e?"object"!=typeof e||Array.isArray(e)?("string"==typeof e&&(e=e.split(",")),0===e.length?null:e.reduce(((e,t)=>(e[t]=!0,e)),{})):e:null,K=e=>Object.keys(e).filter((t=>e[t])).join(",");var Y,X,Q,Z,ee,te,ae;!function(e){e.SUPER_ADMIN="super",e.CREATOR="org-level-creator",e.VIEWER="org-level-viewer"}(Y||(Y={})),function(e){e.OWNER="owner",e.CREATOR="creator",e.EDITOR="editor",e.COMMENTER="commenter",e.VIEWER="viewer",e.NO_ACCESS="no-access"}(X||(X={})),function(e){e.OWNER="workspace-level-owner",e.CREATOR="workspace-level-creator",e.VIEWER="workspace-level-viewer",e.EDITOR="workspace-level-editor",e.COMMENTER="workspace-level-commenter"}(Q||(Q={})),function(e){e.PROJECT_CREATE="project.create",e.PROJECT_INVITE="project.invite",e.PROJECT_USER_UPDATE="project.user.update",e.PROJECT_USER_RESEND_INVITE="project.user.resend.invite",e.PROJECT_DELETE="project.delete",e.PROJECT_UPDATE="project.update",e.PROJECT_CLONE="project.clone",e.WELCOME="app.welcome",e.WORKSPACE_CREATE="workspace.create",e.WORKSPACE_INVITE="workspace.invite",e.WORKSPACE_DELETE="workspace.delete",e.WORKSPACE_UPDATE="workspace.update",e.USER_SIGNUP="user.signup",e.USER_SIGNIN="user.signin",e.USER_UPDATE="user.update",e.USER_PASSWORD_RESET="user.password.reset",e.USER_PASSWORD_CHANGE="user.password.change",e.USER_PASSWORD_FORGOT="user.password.forgot",e.USER_DELETE="user.delete",e.USER_EMAIL_VERIFICATION="user.email.verification",e.TABLE_CREATE="table.create",e.TABLE_DELETE="table.delete",e.TABLE_UPDATE="table.update",e.VIEW_CREATE="view.create",e.VIEW_DELETE="view.delete",e.VIEW_UPDATE="view.update",e.SHARED_VIEW_CREATE="shared.view.create",e.SHARED_VIEW_DELETE="shared.view.delete",e.SHARED_VIEW_UPDATE="shared.view.update",e.FILTER_CREATE="filter.create",e.FILTER_DELETE="filter.delete",e.FILTER_UPDATE="filter.update",e.SORT_CREATE="sort.create",e.SORT_DELETE="sort.delete",e.SORT_UPDATE="sort.update",e.COLUMN_CREATE="column.create",e.COLUMN_DELETE="column.delete",e.COLUMN_UPDATE="column.update",e.DATA_CREATE="data.create",e.DATA_DELETE="data.delete",e.DATA_UPDATE="data.update",e.ORG_USER_INVITE="org.user.invite",e.ORG_USER_RESEND_INVITE="org.user.resend.invite",e.VIEW_COLUMN_CREATE="view.column.create",e.VIEW_COLUMN_UPDATE="view.column.update",e.API_TOKEN_CREATE="api.token.create",e.API_TOKEN_DELETE="api.token.delete",e.IMAGE_UPLOAD="image.upload",e.BASE_CREATE="base.create",e.BASE_DELETE="base.delete",e.BASE_UPDATE="base.update",e.FORM_COLUMN_UPDATE="form.column.update",e.FORM_CREATE="form.create",e.FORM_UPDATE="form.update",e.GALLERY_CREATE="gallery.create",e.GALLERY_UPDATE="gallery.update",e.KANBAN_CREATE="kanban.create",e.KANBAN_UPDATE="kanban.update",e.MAP_CREATE="map.create",e.MAP_UPDATE="map.update",e.META_DIFF_SYNC="meta.diff.sync",e.GRID_CREATE="grid.create",e.GRID_UPDATE="grid.update",e.GRID_COLUMN_UPDATE="grid.column.update",e.WEBHOOK_CREATE="webhook.create",e.WEBHOOK_UPDATE="webhook.update",e.WEBHOOK_DELETE="webhook.delete",e.WEBHOOK_TEST="webhook.test",e.UI_ACL_UPDATE="ui.acl.update",e.ORG_API_TOKEN_CREATE="org.api.token.create",e.ORG_API_TOKEN_DELETE="org.api.token.delete",e.PLUGIN_TEST="plugin.test",e.PLUGIN_INSTALL="plugin.install",e.PLUGIN_UNINSTALL="plugin.uninstall",e.SYNC_SOURCE_CREATE="sync.source.create",e.SYNC_SOURCE_UPDATE="sync.source.update",e.SYNC_SOURCE_DELETE="sync.source.delete",e.RELATION_DELETE="relation.delete",e.RELATION_CREATE="relation.create",e.SHARED_BASE_GENERATE_LINK="shared.base.generate.link",e.SHARED_BASE_DELETE_LINK="shared.base.delete.link",e.ATTACHMENT_UPLOAD="attachment.upload",e.APIS_CREATED="apis.created"}(Z||(Z={})),function(e){e.API_CALLS="usage_api_calls",e.API_COUNT="usage_api_count",e.NOTIFICATION="nc_notification",e.PAGE_SNAPSHOT="docs_page_snapshot",e.TELEMETRY="usage_telemetry",e.AUDIT="nc_audit"}(ee||(ee={})),function(e){e[e.CREATING=0]="CREATING",e[e.CREATED=1]="CREATED",e[e.DELETING=2]="DELETING",e[e.DELETED=3]="DELETED",e[e.FAILED=4]="FAILED"}(te||(te={})),function(e){e.FREE="free",e.PAID="paid"}(ae||(ae={}));const ie={[Q.OWNER]:"Owner",[Q.CREATOR]:"Creator",[Q.EDITOR]:"Editor",[Q.COMMENTER]:"Commenter",[Q.VIEWER]:"Viewer",[X.OWNER]:"Owner",[X.CREATOR]:"Creator",[X.EDITOR]:"Editor",[X.COMMENTER]:"Commenter",[X.VIEWER]:"Viewer",[X.NO_ACCESS]:"No Access",[Y.SUPER_ADMIN]:"Super",[Y.CREATOR]:"Creator",[Y.VIEWER]:"Viewer"},ne={[Q.OWNER]:"purple",[Q.CREATOR]:"blue",[Q.EDITOR]:"green",[Q.COMMENTER]:"orange",[Q.VIEWER]:"yellow",[X.OWNER]:"purple",[X.CREATOR]:"blue",[X.EDITOR]:"green",[X.COMMENTER]:"orange",[X.VIEWER]:"yellow",[Y.SUPER_ADMIN]:"purple",[X.NO_ACCESS]:"red",[Y.CREATOR]:"blue",[Y.VIEWER]:"yellow"},se=[Q.OWNER,Q.CREATOR,Q.EDITOR,Q.COMMENTER,Q.VIEWER,null],oe=[X.OWNER,X.CREATOR,X.EDITOR,X.COMMENTER,X.VIEWER,X.NO_ACCESS];var re=a(64923),le=a.n(re),ce=function(e,t,a,i){return new(a||(a=Promise))((function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((i=i.apply(e,t||[])).next())}))};const de={name:"curly",init(e){e.hooks.add("gobble-token",(function(t){let a=-1;const{context:i}=t;if(!e.isIdentifierStart(i.code)&&123===i.code){if(-1==a&&(a=i.index),i.index+=1,i.gobbleExpressions(125),125===i.code)return i.index+=1,t.node={type:e.IDENTIFIER,name:/{{(.*?)}}/.test(i.expr)?i.expr.slice(a+2,i.index-1):i.expr.slice(a+1,i.index-1)},t.node;i.throwError("Unclosed }")}}))}};function ue(e,t){return ce(this,void 0,void 0,(function*(){const a=e=>ce(this,void 0,void 0,(function*(){if("CallExpression"===e.type)for(const t of e.arguments||[])yield a(t);else{if("Literal"===e.type)return;if("Identifier"===e.type){const a=e.name,i=t.find((e=>e.id===a||e.column_name===a||e.title===a));e.name="{"+i.id+"}"}else"BinaryExpression"===e.type&&(yield a(e.left),yield a(e.right))}}));le().plugins.register(de);const i=le()(e);return yield a(i),me(i)}))}function pe(e,t,a){const i=(e,a)=>{var n;if("CallExpression"===e.type){let t=0;for(const s of e.arguments||[])i(s,null===(n=null==a?void 0:a.arguments)||void 0===n?void 0:n[t++])}else{if("Literal"===e.type)return;if("Identifier"===e.type){const i=null==e?void 0:e.name,n=t.find((e=>e.id===i||e.column_name===i||e.title===i));e.name=(null==n?void 0:n.title)||(null==a?void 0:a.name)||(null==e?void 0:e.name)}else"BinaryExpression"===e.type&&(i(e.left,null==a?void 0:a.left),i(e.right,null==a?void 0:a.right))}};le().plugins.register(de);const n=le()(e),s=a&&le()(a);return i(n,s),me(n)}function me(e){if("BinaryExpression"===e.type||"LogicalExpression"===e.type)return"("+me(e.left)+" "+e.operator+" "+me(e.right)+")";if("UnaryExpression"===e.type)return e.operator+me(e.argument);if("MemberExpression"===e.type)return me(e.object)+"["+me(e.property)+"]";if("Identifier"===e.type){return["AVG","ADD","DATEADD","DATETIME_DIFF","WEEKDAY","AND","OR","CONCAT","TRIM","UPPER","LOWER","LEN","MIN","MAX","CEILING","FLOOR","ROUND","MOD","REPEAT","LOG","EXP","POWER","SQRT","SQRT","ABS","NOW","REPLACE","SEARCH","INT","RIGHT","LEFT","SUBSTR","MID","IF","SWITCH","URL"].includes(e.name.toUpperCase())?e.name:"{"+e.name+"}"}return"Literal"===e.type?"string"==typeof e.value?String.raw`"${t=e.value,t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'")}"`:""+e.value:"CallExpression"===e.type?me(e.callee)+"("+e.arguments.map(me).join(", ")+")":"ArrayExpression"===e.type?"["+e.elements.map(me).join(", ")+"]":"Compound"===e.type?e.body.map((e=>me(e))).join(" "):"ConditionalExpression"===e.type?me(e.test)+" ? "+me(e.consequent)+" : "+me(e.alternate):"";var t}const fe=class extends m{};class he{}function ge(e){let t="";let a=!0;return e?e.length>=8||(t+="At least 8 letters. ",a=!1):(t="At least 8 letters",a=!1),{error:t,valid:a,hint:null}}function _e(e,t){return Object.assign(Object.assign(Object.assign({},e),t),{paths:Object.assign(Object.assign({},e.paths),t.paths),components:Object.assign(Object.assign(Object.assign({},e.components),t.components),{schemas:Object.assign(Object.assign({},e.components.schemas),t.components.schemas),responses:Object.assign(Object.assign({},e.components.responses),t.components.responses)})})}},27552:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(a(71017)),l=s(a(9856)),c=a(26481),d=a(50143),u=o(a(10308)),p=s(a(66860)),m=o(a(58890)),f=a(87049),h=a(25828),g=o(a(25142)),_=a(65715),b=o(a(52316)),y=o(a(79710)),w=a(13609),v=a(91707),T=a(95506);g.default.config();class O{static get dashboardUrl(){var e,t;return`${`http://localhost:${process.env.PORT||8080}`}${null===(t=null===(e=O._this)||void 0===e?void 0:e.config)||void 0===t?void 0:t.dashboardPath}`}constructor(){process.env.PORT=process.env.PORT||"8080","true"===process.env.NC_MINIMAL_DBS&&(process.env.NC_CONNECT_TO_EXTERNAL_DB_DISABLED="true"),this.router=p.Router(),this.projectRouter=p.Router(),(0,u.default)()}getConfig(){return this.config}getToolDir(){var e;return null===(e=this.getConfig())||void 0===e?void 0:e.toolDir}addToContext(e){this.requestContext=e}static get ncMeta(){return this._ncMeta}get ncMeta(){return O._ncMeta}static getConfig(){return O.config}static isEE(){return O.ee||"true"===process.env.NC_CLOUD}static async loadEEState(){try{return O.ee=T.isEE}catch(e){}return O.ee=!1}static async init(e,t,a){var i;const n=await d.NestFactory.create(v.AppModule);n.useWebSocketAdapter(new _.IoAdapter(t)),this._httpServer=n.getHttpAdapter().getInstance(),this._server=a,n.use(b.default.mw()),n.use((0,y.default)()),this.initSentry(n),n.useWebSocketAdapter(new _.IoAdapter(t)),n.use(p.json({limit:process.env.NC_REQUEST_BODY_SIZE||"50mb"})),await n.init();const s=null!==(i=process.env.NC_DASHBOARD_URL)&&void 0!==i?i:"/dashboard";return a.use(m.default.expressMiddleware(s)),a.use(p.static(r.default.join(__dirname,"public"))),"/"!==s&&""!==s&&a.get("/",((e,t)=>t.redirect(s))),this.initSentryErrorHandler(a),n.getHttpAdapter().getInstance()}static get httpServer(){return O._httpServer}static get server(){return O._server}static async initJwt(){var e,t,a,i,n,s;if(null===(t=null===(e=this.config)||void 0===e?void 0:e.auth)||void 0===t?void 0:t.jwt){if(!this.config.auth.jwt.secret){let e=null===(a=await O._ncMeta.metaGet("","",w.MetaTable.STORE,{key:"nc_auth_jwt_secret"}))||void 0===a?void 0:a.value;e||await O._ncMeta.metaInsert("","",w.MetaTable.STORE,{key:"nc_auth_jwt_secret",value:e=(0,h.v4)()}),this.config.auth.jwt.secret=e}this.config.auth.jwt.options=this.config.auth.jwt.options||{},(null===(i=this.config.auth.jwt.options)||void 0===i?void 0:i.expiresIn)||(this.config.auth.jwt.options.expiresIn=null!==(n=process.env.NC_JWT_EXPIRES_IN)&&void 0!==n?n:"10h")}let o=null===(s=await O._ncMeta.metaGet("","",w.MetaTable.STORE,{key:"nc_server_id"}))||void 0===s?void 0:s.value;o||await O._ncMeta.metaInsert("","",w.MetaTable.STORE,{key:"nc_server_id",value:o=f.T.id}),process.env.NC_SERVER_UUID=o}static initSentryErrorHandler(e){process.env.NC_SENTRY_DSN&&e.use(l.Handlers.errorHandler())}static initSentry(e){process.env.NC_SENTRY_DSN&&(l.default.init({dsn:process.env.NC_SENTRY_DSN}),e.use(l.Handlers.requestHandler()))}}t.default=O,O.env="_noco",O.logger=new c.Logger(O.name)},24882:(e,t)=>{var a,i,n,s;Object.defineProperty(t,"__esModule",{value:!0});const o={throttler:{ttl:60,max_apis:1e4,calc_execution_time:!0},basicAuth:{username:null!==(a=process.env.NC_HTTP_BASIC_USER)&&void 0!==a?a:"defaultusername",password:null!==(i=process.env.NC_HTTP_BASIC_PASS)&&void 0!==i?i:"defaultpassword"},auth:{emailPattern:process.env.NC_EMAIL_PATTERN&&new RegExp(process.env.NC_EMAIL_PATTERN),disableEmailAuth:!!process.env.NC_DISABLE_EMAIL_AUTH},mainSubDomain:null!==(n=process.env.NC_MAIN_SUBDOMAIN)&&void 0!==n?n:"app",dashboardPath:null!==(s=process.env.NC_DASHBOARD_URL)&&void 0!==s?s:"/dashboard"};t.default=o},91707:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=t.ceModuleConfig=void 0;const s=a(26481),o=a(50143),r=a(35793),l=a(47020),c=a(39099),d=a(93768),u=a(59633),p=a(33792),m=a(74781),f=a(12874),h=a(9551),g=a(55037),_=a(85059),b=a(286),y=a(60375),w=a(60191),v=a(25700),T=n(a(24882)),O=a(68382),E=a(17276),S=a(54077),I=a(76670);t.ceModuleConfig={imports:[g.GlobalModule,I.UsersModule,..."true"===process.env.PLAYWRIGHT_TEST?[h.TestModule]:[],w.MetasModule,p.DatasModule,m.EventEmitterModule,v.JobsModule,l.EventEmitterModule.forRoot(),r.ConfigModule.forRoot({load:[()=>T.default],isGlobal:!0}),h.TestModule],providers:[f.AuthService,{provide:o.APP_FILTER,useClass:c.GlobalExceptionFilter},{provide:o.APP_GUARD,useClass:O.ExtractIdsMiddleware},_.LocalStrategy,b.AuthTokenStrategy,y.BaseViewStrategy,E.HookHandlerService,S.BasicStrategy]};let k=class{configure(e){e.apply(u.GuiMiddleware).forRoutes({path:"*",method:s.RequestMethod.GET}).apply(d.GlobalMiddleware).forRoutes({path:"*",method:s.RequestMethod.ALL})}};k=i([(0,s.Module)(t.ceModuleConfig)],k),t.AppModule=k},82349:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=class{}},37912:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(98964)),s=i(a(27830)),o=a(13609);t.default=class{static init(){if(this.cacheDisabled="true"===(process.env.NC_DISABLE_CACHE||!1),this.cacheDisabled)return;process.env.NC_REDIS_URL?this.client=new n.default(process.env.NC_REDIS_URL):this.client=new s.default;this.prefix="nc:noco"}static async set(e,t){return this.cacheDisabled?Promise.resolve(!0):this.client.set(`${this.prefix}:${e}`,t)}static async get(e,t){return this.cacheDisabled?t===o.CacheGetType.TYPE_ARRAY?Promise.resolve([]):(o.CacheGetType.TYPE_OBJECT,Promise.resolve(null)):this.client.get(`${this.prefix}:${e}`,t)}static async getAll(e){return this.cacheDisabled?Promise.resolve([]):this.client.getAll(`${this.prefix}:${e}`)}static async del(e){return this.cacheDisabled?Promise.resolve(!0):this.client.del(`${this.prefix}:${e}`)}static async delAll(e,t){return this.cacheDisabled?Promise.resolve([]):this.client.delAll(e,t)}static async getList(e,t){return this.cacheDisabled?Promise.resolve({list:[],isNoneList:!1}):this.client.getList(e,t)}static async setList(e,t,a){return this.cacheDisabled?Promise.resolve(!0):this.client.setList(e,t,a)}static async deepDel(e,t,a){return this.cacheDisabled?Promise.resolve(!0):this.client.deepDel(e,t,a)}static async appendToList(e,t,a){return this.cacheDisabled?Promise.resolve(!0):this.client.appendToList(e,t,`${this.prefix}:${a}`)}static async destroy(){return this.cacheDisabled?Promise.resolve(!0):this.client.destroy()}static async export(){return this.cacheDisabled?Promise.resolve({}):this.client.export()}}},98964:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(96974)),s=i(a(41495)),o=i(a(82349)),r=a(13609),l=(0,n.default)("nc:cache");class c extends o.default{constructor(e){super(),this.getCircularReplacer=()=>{const e=new WeakSet;return(t,a)=>{if("object"==typeof a&&null!==a){if(e.has(a))return;e.add(a)}return a}},this.client=new s.default(e),"true"!==process.env.NC_WORKER_CONTAINER&&this.client.flushdb();this.prefix="nc:noco"}async del(e){return l(`RedisCacheMgr::del: deleting key ${e}`),this.client.del(e)}async get(e,t){if(l(`RedisCacheMgr::get: getting key ${e} with type ${t}`),t===r.CacheGetType.TYPE_ARRAY)return this.client.smembers(e);if(t===r.CacheGetType.TYPE_OBJECT){const t=await this.client.get(e);try{const e=JSON.parse(t);if("object"==typeof e)return e&&0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype&&l("RedisCacheMgr::get: object is empty!"),Promise.resolve(e)}catch(e){return Promise.resolve(t)}return Promise.resolve(t)}return t===r.CacheGetType.TYPE_STRING?await this.client.get(e):(l(`Invalid CacheGetType: ${t}`),Promise.resolve(!1))}async set(e,t){return void 0!==t&&t?(l(`RedisCacheMgr::set: setting key ${e} with value ${t}`),"object"==typeof t?Array.isArray(t)&&t.length?this.client.sadd(e,t):this.client.set(e,JSON.stringify(t,this.getCircularReplacer())):this.client.set(e,t)):(l(`RedisCacheMgr::set: value is empty for ${e}. Skipping ...`),Promise.resolve(!0))}async getAll(e){return this.client.hgetall(e)}async delAll(e,t){const a=await this.client.keys(`${this.prefix}:${e}:${t}`);return l(`RedisCacheMgr::delAll: deleting all keys with pattern ${this.prefix}:${e}:${t}`),await Promise.all(a.map((async t=>{await this.deepDel(e,t,r.CacheDelDirection.CHILD_TO_PARENT)}))),Promise.all(a.map((async e=>{await this.del(e)})))}async getList(e,t){const a=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`,i=await this.get(a,r.CacheGetType.TYPE_ARRAY)||[];l(`RedisCacheMgr::getList: getting list with key ${a}`);const n=i.length&&i.includes("NONE");return n?Promise.resolve({list:[],isNoneList:n}):{list:await Promise.all(i.map((async e=>await this.get(e,r.CacheGetType.TYPE_OBJECT)))),isNoneList:n}}async setList(e,t,a){const i=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`;if(!a.length)return this.set(i,["NONE"]);const n=await this.get(i,r.CacheGetType.TYPE_ARRAY)||[];for(const t of a){let a=`${this.prefix}:${e}:${t.id}`;e===r.CacheScope.MODEL_ROLE_VISIBILITY&&(a=`${this.prefix}:${e}:${t.fk_view_id}:${t.role}`),l(`RedisCacheMgr::setList: setting key ${a}`),await this.set(a,JSON.stringify(t,this.getCircularReplacer())),n.push(a)}return l(`RedisCacheMgr::setList: setting list with key ${i}`),this.set(i,n)}async deepDel(e,t,a){if(t=`${this.prefix}:${t}`,l(`RedisCacheMgr::deepDel: choose direction ${a}`),a===r.CacheDelDirection.CHILD_TO_PARENT){const a=await this.client.keys(`${this.prefix}:${e}*list`);for(const e of a){let a=await this.get(e,r.CacheGetType.TYPE_ARRAY)||[];a.length&&(a=a.filter((e=>e!==t)),l(`RedisCacheMgr::deepDel: remove listKey ${e}`),await this.del(e),a.length&&(l(`RedisCacheMgr::deepDel: set key ${e}`),await this.del(e),await this.set(e,a)))}return l(`RedisCacheMgr::deepDel: remove key ${t}`),await this.del(t)}if(a===r.CacheDelDirection.PARENT_TO_CHILD){const e=await this.get(t,r.CacheGetType.TYPE_ARRAY);return await Promise.all(e.map((async e=>await this.del(e)))),await this.del(t)}return l(`Invalid deepDel direction found : ${a}`),Promise.resolve(!1)}async appendToList(e,t,a){const i=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`;l(`RedisCacheMgr::appendToList: append key ${a} to ${i}`);let n=await this.get(i,r.CacheGetType.TYPE_ARRAY)||[];return n.length&&n.includes("NONE")&&(n=[],await this.del(i)),n.push(a),this.set(i,n)}async destroy(){return l("RedisCacheMgr::destroy: destroy redis"),this.client.flushdb()}async export(){l("RedisCacheMgr::export: export data");const e=await this.client.keys("*"),t={};return await Promise.all(e.map((async e=>{t[e]=await this.get(e,"list"===e.slice(-4)?r.CacheGetType.TYPE_ARRAY:r.CacheGetType.TYPE_OBJECT)}))).then((()=>t))}}t.default=c},27830:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(96974)),s=i(a(992)),o=i(a(82349)),r=a(13609),l=(0,n.default)("nc:cache");class c extends o.default{constructor(){super(),this.getCircularReplacer=()=>{const e=new WeakSet;return(t,a)=>{if("object"==typeof a&&null!==a){if(e.has(a))return;e.add(a)}return a}},this.client=new s.default,this.client.flushdb();this.prefix="nc:noco"}async del(e){return l(`RedisMockCacheMgr::del: deleting key ${e}`),this.client.del(e)}async get(e,t){if(l(`RedisMockCacheMgr::get: getting key ${e} with type ${t}`),t===r.CacheGetType.TYPE_ARRAY)return this.client.smembers(e);if(t===r.CacheGetType.TYPE_OBJECT){const t=await this.client.get(e);try{const e=JSON.parse(t);if("object"==typeof e)return e&&0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype&&l("RedisMockCacheMgr::get: object is empty!"),Promise.resolve(e)}catch(e){return Promise.resolve(t)}return Promise.resolve(t)}return t===r.CacheGetType.TYPE_STRING?await this.client.get(e):(l(`Invalid CacheGetType: ${t}`),Promise.resolve(!1))}async set(e,t){return void 0!==t&&t?(l(`RedisMockCacheMgr::set: setting key ${e} with value ${t}`),"object"==typeof t?Array.isArray(t)&&t.length?this.client.sadd(e,t):this.client.set(e,JSON.stringify(t,this.getCircularReplacer())):this.client.set(e,t)):(l(`RedisMockCacheMgr::set: value is empty for ${e}. Skipping ...`),Promise.resolve(!0))}async getAll(e){return this.client.hgetall(e)}async delAll(e,t){const a=await this.client.keys(`${this.prefix}:${e}:${t}`);return l(`RedisMockCacheMgr::delAll: deleting all keys with pattern ${this.prefix}:${e}:${t}`),await Promise.all(a.map((async t=>await this.deepDel(e,t,r.CacheDelDirection.CHILD_TO_PARENT)))),Promise.all(a.map((async e=>{await this.del(e)})))}async getList(e,t){const a=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`,i=await this.get(a,r.CacheGetType.TYPE_ARRAY)||[];l(`RedisMockCacheMgr::getList: getting list with key ${a}`);const n=i.length&&"NONE"===i[0];return n?Promise.resolve({list:[],isNoneList:n}):{list:await Promise.all(i.map((async e=>await this.get(e,r.CacheGetType.TYPE_OBJECT)))),isNoneList:n}}async setList(e,t,a){const i=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`;if(!a.length)return this.set(i,["NONE"]);const n=await this.get(i,r.CacheGetType.TYPE_ARRAY)||[];for(const t of a){let a=`${this.prefix}:${e}:${t.id}`;e===r.CacheScope.MODEL_ROLE_VISIBILITY&&(a=`${this.prefix}:${e}:${t.fk_view_id}:${t.role}`),l(`RedisMockCacheMgr::setList: setting key ${a}`),await this.set(a,JSON.stringify(t,this.getCircularReplacer())),n.push(a)}return l(`RedisMockCacheMgr::setList: setting list with key ${i}`),this.set(i,n)}async deepDel(e,t,a){if(t=`${this.prefix}:${t}`,l(`RedisMockCacheMgr::deepDel: choose direction ${a}`),a===r.CacheDelDirection.CHILD_TO_PARENT){const a=await this.client.keys(`${this.prefix}:${e}*list`);for(const e of a){let a=await this.get(e,r.CacheGetType.TYPE_ARRAY)||[];a.length&&(a=a.filter((e=>e!==t)),l(`RedisMockCacheMgr::deepDel: remove listKey ${e}`),await this.del(e),a.length&&(l(`RedisMockCacheMgr::deepDel: set key ${e}`),await this.del(e),await this.set(e,a)))}return l(`RedisMockCacheMgr::deepDel: remove key ${t}`),await this.del(t)}if(a===r.CacheDelDirection.PARENT_TO_CHILD){const e=await this.get(t,r.CacheGetType.TYPE_ARRAY);return await Promise.all(e.map((async e=>await this.del(e)))),await this.del(t)}return l(`Invalid deepDel direction found : ${a}`),Promise.resolve(!1)}async appendToList(e,t,a){const i=0===(t=t.filter((e=>e))).length?`${this.prefix}:${e}:list`:`${this.prefix}:${e}:${t.join(":")}:list`;l(`RedisMockCacheMgr::appendToList: append key ${a} to ${i}`);let n=await this.get(i,r.CacheGetType.TYPE_ARRAY)||[];return n.length&&"NONE"===n[0]&&(n=[],await this.del(i)),n.push(a),this.set(i,n)}async destroy(){return l("RedisMockCacheMgr::destroy: destroy redis"),this.client.flushdb()}async export(){l("RedisMockCacheMgr::export: export data");const e=await this.client.keys("*"),t={};return await Promise.all(e.map((async e=>{t[e]=await this.get(e,"list"===e.slice(-4)?r.CacheGetType.TYPE_ARRAY:r.CacheGetType.TYPE_OBJECT)}))).then((()=>t))}}t.default=c},94647:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NC_ATTACHMENT_FIELD_SIZE=t.NC_APP_SETTINGS=t.NC_LICENSE_KEY=void 0,t.NC_LICENSE_KEY="nc-license-key",t.NC_APP_SETTINGS="nc-app-settings",t.NC_ATTACHMENT_FIELD_SIZE=+process.env.NC_ATTACHMENT_FIELD_SIZE||20971520},55213:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiDocsController=void 0;const l=a(26481),c=r(a(6241)),d=r(a(50328)),u=a(66310),p=a(68382),m=a(67259);let f=class{constructor(e){this.apiDocsService=e}async swaggerJson(e,t){return await this.apiDocsService.swaggerJson({projectId:e,siteUrl:t.ncSiteUrl})}swaggerHtml(e,t){t.send((0,c.default)({ncSiteUrl:process.env.NC_PUBLIC_URL||""}))}redocHtml(e,t){t.send((0,d.default)({ncSiteUrl:process.env.NC_PUBLIC_URL||""}))}};n([(0,l.Get)("/api/v1/db/meta/projects/:projectId/swagger.json"),(0,l.UseGuards)(u.GlobalGuard),(0,p.Acl)("swaggerJson"),o(0,(0,l.Param)("projectId")),o(1,(0,l.Request)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],f.prototype,"swaggerJson",null),n([(0,l.Get)("/api/v1/db/meta/projects/:projectId/swagger"),o(0,(0,l.Param)("projectId")),o(1,(0,l.Response)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",void 0)],f.prototype,"swaggerHtml",null),n([(0,l.Get)("/api/v1/db/meta/projects/:projectId/redoc"),o(0,(0,l.Param)("projectId")),o(1,(0,l.Response)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",void 0)],f.prototype,"redocHtml",null),f=n([(0,l.Controller)(),s("design:paramtypes",["function"==typeof(i=void 0!==m.ApiDocsService&&m.ApiDocsService)?i:Object])],f),t.ApiDocsController=f},50328:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=({ncSiteUrl:e})=>`<!DOCTYPE html>\n<html>\n<head>\n    <title>NocoDB API Documentation</title>\n    \x3c!-- needed for adaptive design --\x3e\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n    <link href="${e}/css/fonts.montserrat.css" rel="stylesheet">\n    \x3c!--\n    Redoc doesn't change outer page styles\n    --\x3e\n    <style>\n        body {\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n<div id="redoc"></div>\n<script src="${e}/js/redoc.standalone.min.js"><\/script>\n<script>\n  let initialLocalStorage = {}\n  \n  try {\n    initialLocalStorage = JSON.parse(localStorage.getItem('nocodb-gui-v2') || '{}');\n  } catch (e) {\n    console.error('Failed to parse local storage', e);\n  }\n\n  const xhttp = new XMLHttpRequest();\n  \n  xhttp.open("GET", "./swagger.json");\n  xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");\n  xhttp.setRequestHeader("xc-auth", initialLocalStorage && initialLocalStorage.token);\n\n  xhttp.onload = function () {\n      const swaggerJson = this.responseText;\n      const swagger = JSON.parse(swaggerJson);\n      Redoc.init(swagger, {\n        scrollYOffset: 50\n      }, document.getElementById('redoc'))\n  };\n  \n  xhttp.send();\n<\/script>\n<script>\n console.log('%c We are Hiring!!! %c\\n%cJoin the forces http://careers.nocodb.com', 'color:#1348ba;font-size:3rem;padding:20px;', 'display:none', 'font-size:1.5rem;padding:20px')\n   const linkEl = document.createElement('a')\n  linkEl.setAttribute('href', "http://careers.nocodb.com")\n  linkEl.setAttribute('target', '_blank')\n  linkEl.setAttribute('class', 'we-are-hiring')\n  linkEl.innerHTML = ' We are Hiring!!! '\n  const styleEl = document.createElement('style');\n  styleEl.innerHTML = \`\n.we-are-hiring {\n  position: fixed;\n  bottom: 50px;\n  right: -250px;\n  opacity: 0;\n  background: orange;\n  border-radius: 4px;\n  padding: 19px;\n  z-index: 200;\n  text-decoration: none; \n  text-transform: uppercase;\n  color: black;\n  transition: 1s opacity, 1s right;\n  display: block;\n  font-weight: bold;\n}        \n\n.we-are-hiring.active {\n  opacity: 1;\n  right:25px;\n}\n\n@media only screen and (max-width: 600px) {\n  .we-are-hiring {\n    display: none;\n  }\n}\n        \`\n  document.body.appendChild(linkEl, document.body.firstChild)\n  document.body.appendChild(styleEl, document.body.firstChild)\n  setTimeout(() => linkEl.classList.add('active'), 2000)\n<\/script>\n</body>\n</html>`},6241:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=({ncSiteUrl:e})=>`<!DOCTYPE html>\n<html>\n<head>\n    <title>NocoDB : API Docs</title>\n    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">\n    <link rel="shortcut icon" href="${e}/favicon.ico" />\n    <link rel="stylesheet" href="${e}/css/swagger-ui-bundle.4.5.2.min.css"/>\n    <script src="${e}/js/swagger-ui-bundle.4.5.2.min.js"><\/script>\n</head>\n<body>\n<div id="app"></div>\n<script>\n\nlet initialLocalStorage = {}\n\ntry {\n  initialLocalStorage = JSON.parse(localStorage.getItem('nocodb-gui-v2') || '{}');\n} catch (e) {\n  console.error('Failed to parse local storage', e);\n}\n\nvar xmlhttp = new XMLHttpRequest();   // new HttpRequest instance \nxmlhttp.open("GET", "./swagger.json");\nxmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");\nxmlhttp.setRequestHeader("xc-auth", initialLocalStorage && initialLocalStorage.token);\nxmlhttp.onload = function () {\n\n  const ui = SwaggerUIBundle({\n    // url: ,\n    spec: JSON.parse(xmlhttp.responseText),\n    dom_id: '#app',\n    presets: [\n      SwaggerUIBundle.presets.apis,\n      SwaggerUIBundle.SwaggerUIStandalonePreset\n    ],\n  })\n}\nxmlhttp.send();\n\n  \n  console.log('%c We are Hiring!!! %c\\n%cJoin the forces http://careers.nocodb.com', 'color:#1348ba;font-size:3rem;padding:20px;', 'display:none', 'font-size:1.5rem;padding:20px');\n    const linkEl = document.createElement('a')\n  linkEl.setAttribute('href', "http://careers.nocodb.com")\n  linkEl.setAttribute('target', '_blank')\n  linkEl.setAttribute('class', 'we-are-hiring')\n  linkEl.innerHTML = ' We are Hiring!!! '\n  const styleEl = document.createElement('style');\n  styleEl.innerHTML = \`\n.we-are-hiring {\n  position: fixed;\n  bottom: 50px;\n  right: -250px;\n  opacity: 0;\n  background: orange;\n  border-radius: 4px;\n  padding: 19px;\n  z-index: 200;\n  text-decoration: none; \n  text-transform: uppercase;\n  color: black;\n  transition: 1s opacity, 1s right;\n  display: block;\n  font-weight: bold;\n}        \n\n.we-are-hiring.active {\n  opacity: 1;\n  right:25px;\n}\n\n@media only screen and (max-width: 600px) {\n  .we-are-hiring {\n    display: none;\n  }\n}\n        \`\n  document.body.appendChild(linkEl, document.body.firstChild)\n  document.body.appendChild(styleEl, document.body.firstChild)\n  setTimeout(() => linkEl.classList.add('active'), 2000)\n<\/script>\n</body>\n</html>\n`},46909:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiTokensController=void 0;const r=a(26481),l=a(66310),c=a(60498),d=a(46460),u=a(68382);let p=class{constructor(e){this.apiTokensService=e}async apiTokenList(e){return new c.PagedResponseImpl(await this.apiTokensService.apiTokenList({userId:e.user.id}))}async apiTokenCreate(e,t){return await this.apiTokensService.apiTokenCreate({tokenBody:t,userId:e.user.id})}async apiTokenDelete(e,t){return await this.apiTokensService.apiTokenDelete({token:t,user:e.user})}};n([(0,r.Get)("/api/v1/db/meta/projects/:projectId/api-tokens"),(0,u.Acl)("projectApiTokenList"),o(0,(0,r.Request)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],p.prototype,"apiTokenList",null),n([(0,r.Post)("/api/v1/db/meta/projects/:projectId/api-tokens"),(0,r.HttpCode)(200),(0,u.Acl)("projectApiTokenCreate"),o(0,(0,r.Request)()),o(1,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],p.prototype,"apiTokenCreate",null),n([(0,r.Delete)("/api/v1/db/meta/projects/:projectId/api-tokens/:token"),(0,u.Acl)("projectApiTokenDelete"),o(0,(0,r.Request)()),o(1,(0,r.Param)("token")),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],p.prototype,"apiTokenDelete",null),p=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==d.ApiTokensService&&d.ApiTokensService)?i:Object])],p),t.ApiTokensController=p},42694:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentsController=void 0;const c=l(a(71017)),d=a(26481),u=a(36188),p=a(31001),m=a(66310),f=a(76696);let h=class{constructor(e){this.attachmentsService=e}async upload(e,t,a){var i;return await this.attachmentsService.upload({files:e,path:null===(i=a.query)||void 0===i?void 0:i.path})}async uploadViaURL(e,t){return await this.attachmentsService.uploadViaURL({urls:e,path:t})}async fileRead(e,t){try{const{img:a,type:i}=await this.attachmentsService.fileRead({path:c.default.join("nc","uploads",e)});t.writeHead(200,{"Content-Type":i}),t.end(a,"binary")}catch(e){console.log(e),t.status(404).send("Not found")}}async fileReadv2(e,t,a,i){try{const{img:n,type:s}=await this.attachmentsService.fileRead({path:c.default.join("nc",e,t,"uploads",...a.split("/"))});i.writeHead(200,{"Content-Type":s}),i.end(n,"binary")}catch(e){i.status(404).send("Not found")}}};s([(0,d.UseGuards)(m.GlobalGuard),(0,d.Post)("/api/v1/db/storage/upload"),(0,d.HttpCode)(200),(0,d.UseInterceptors)(p.UploadAllowedInterceptor,(0,u.AnyFilesInterceptor)()),r(0,(0,d.UploadedFiles)()),r(1,(0,d.Body)()),r(2,(0,d.Request)()),o("design:type",Function),o("design:paramtypes",["function"==typeof(n="undefined"!=typeof Array&&Array)?n:Object,Object,Object]),o("design:returntype",Promise)],h.prototype,"upload",null),s([(0,d.Post)("/api/v1/db/storage/upload-by-url"),(0,d.HttpCode)(200),(0,d.UseInterceptors)(p.UploadAllowedInterceptor),(0,d.UseGuards)(m.GlobalGuard),r(0,(0,d.Body)()),r(1,(0,d.Query)("path")),o("design:type",Function),o("design:paramtypes",[Object,String]),o("design:returntype",Promise)],h.prototype,"uploadViaURL",null),s([(0,d.Get)("/download/:filename(*)"),r(0,(0,d.Param)("filename")),r(1,(0,d.Response)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],h.prototype,"fileRead",null),s([(0,d.Get)("/dl/:param1([a-zA-Z0-9_-]+)/:param2([a-zA-Z0-9_-]+)/:filename(*)"),r(0,(0,d.Param)("param1")),r(1,(0,d.Param)("param2")),r(2,(0,d.Param)("filename")),r(3,(0,d.Response)()),o("design:type",Function),o("design:paramtypes",[String,String,String,Object]),o("design:returntype",Promise)],h.prototype,"fileReadv2",null),h=s([(0,d.Controller)(),o("design:paramtypes",["function"==typeof(i=void 0!==f.AttachmentsService&&f.AttachmentsService)?i:Object])],h),t.AttachmentsController=h},43735:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuditsController=void 0;const r=a(26481),l=a(66310),c=a(60498),d=a(82897),u=a(68382);let p=class{constructor(e){this.auditsService=e}async commentRow(e){return await this.auditsService.commentRow({user:e.user,body:e.body})}async auditRowUpdate(e,t){return await this.auditsService.auditRowUpdate({rowId:e,body:t})}async commentList(e){return new c.PagedResponseImpl(await this.auditsService.commentList({query:e.query}))}async commentUpdate(e,t,a){var i;return await this.auditsService.commentUpdate({auditId:e,userEmail:null===(i=t.user)||void 0===i?void 0:i.email,body:a})}async auditList(e,t){return new c.PagedResponseImpl(await this.auditsService.auditList({query:e.query,projectId:t}),Object.assign({count:this.auditsService.auditCount({projectId:t})},e.query))}async commentsCount(e,t){return await this.auditsService.commentsCount({fk_model_id:e,ids:t})}};n([(0,r.Post)("/api/v1/db/meta/audits/comments"),(0,r.HttpCode)(200),(0,u.Acl)("commentRow"),o(0,(0,r.Request)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],p.prototype,"commentRow",null),n([(0,r.Post)("/api/v1/db/meta/audits/rows/:rowId/update"),(0,r.HttpCode)(200),(0,u.Acl)("auditRowUpdate"),o(0,(0,r.Param)("rowId")),o(1,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],p.prototype,"auditRowUpdate",null),n([(0,r.Get)("/api/v1/db/meta/audits/comments"),(0,u.Acl)("commentList"),o(0,(0,r.Request)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],p.prototype,"commentList",null),n([(0,r.Patch)("/api/v1/db/meta/audits/:auditId/comment"),(0,u.Acl)("commentUpdate"),o(0,(0,r.Param)("auditId")),o(1,(0,r.Request)()),o(2,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object,Object]),s("design:returntype",Promise)],p.prototype,"commentUpdate",null),n([(0,r.Get)("/api/v1/db/meta/projects/:projectId/audits/"),(0,u.Acl)("auditList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectId")),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],p.prototype,"auditList",null),n([(0,r.Get)("/api/v1/db/meta/audits/comments/count"),(0,u.Acl)("commentsCount"),o(0,(0,r.Query)("fk_model_id")),o(1,(0,r.Query)("ids")),s("design:type",Function),s("design:paramtypes",[String,Array]),s("design:returntype",Promise)],p.prototype,"commentsCount",null),p=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==d.AuditsService&&d.AuditsService)?i:Object])],p),t.AuditsController=p},32235:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BasesController=void 0;const c=a(26481),d=a(68281),u=a(66310),p=a(60498),m=a(68382),f=a(45239);let h=class{constructor(e){this.basesService=e}async baseGet(e){const t=await this.basesService.baseGetWithConfig({baseId:e});return t.isMeta()&&delete t.config,t}async baseUpdate(e,t,a){return await this.basesService.baseUpdate({baseId:e,base:a,projectId:t})}async baseList(e){const t=await this.basesService.baseList({projectId:e});for(const e of t)e.isMeta()&&delete e.config;return new p.PagedResponseImpl(t,{count:t.length,limit:t.length})}async baseDelete(e){return await this.basesService.baseDelete({baseId:e})}async baseCreate(e,t){const a=await this.basesService.baseCreate({projectId:e,base:t});return a.isMeta()&&delete a.config,a}};o([(0,c.Get)("/api/v1/db/meta/projects/:projectId/bases/:baseId"),(0,m.Acl)("baseGet"),l(0,(0,c.Param)("baseId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],h.prototype,"baseGet",null),o([(0,c.Patch)("/api/v1/db/meta/projects/:projectId/bases/:baseId"),(0,m.Acl)("baseUpdate"),l(0,(0,c.Param)("baseId")),l(1,(0,c.Param)("projectId")),l(2,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[String,String,"function"==typeof(n=void 0!==d.BaseReqType&&d.BaseReqType)?n:Object]),r("design:returntype",Promise)],h.prototype,"baseUpdate",null),o([(0,c.Get)("/api/v1/db/meta/projects/:projectId/bases"),(0,m.Acl)("baseList"),l(0,(0,c.Param)("projectId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],h.prototype,"baseList",null),o([(0,c.Delete)("/api/v1/db/meta/projects/:projectId/bases/:baseId"),(0,m.Acl)("baseDelete"),l(0,(0,c.Param)("baseId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],h.prototype,"baseDelete",null),o([(0,c.Post)("/api/v1/db/meta/projects/:projectId/bases"),(0,c.HttpCode)(200),(0,m.Acl)("baseCreate"),l(0,(0,c.Param)("projectId")),l(1,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(s=void 0!==d.BaseReqType&&d.BaseReqType)?s:Object]),r("design:returntype",Promise)],h.prototype,"baseCreate",null),h=o([(0,c.Controller)(),(0,c.UseGuards)(u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==f.BasesService&&f.BasesService)?i:Object])],h),t.BasesController=h},15131:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BulkDataAliasController=void 0;const r=a(26481),l=a(66310),c=a(69905),d=a(68382);let u=class{constructor(e){this.bulkDataAliasService=e}async bulkDataInsert(e,t,a,i,n){const s=await this.bulkDataAliasService.bulkDataInsert({body:n,cookie:e,projectName:a,tableName:i});t.json(s)}async bulkDataUpdate(e,t,a,i){return await this.bulkDataAliasService.bulkDataUpdate({body:i,cookie:e,projectName:t,tableName:a})}async bulkDataUpdateAll(e,t,a,i){return await this.bulkDataAliasService.bulkDataUpdateAll({body:i,cookie:e,projectName:t,tableName:a,query:e.query})}async bulkDataDelete(e,t,a,i){return await this.bulkDataAliasService.bulkDataDelete({body:i,cookie:e,projectName:t,tableName:a})}async bulkDataDeleteAll(e,t,a){return await this.bulkDataAliasService.bulkDataDeleteAll({projectName:t,tableName:a,query:e.query})}};n([(0,r.Post)("/api/v1/db/data/bulk/:orgs/:projectName/:tableName"),(0,r.HttpCode)(200),(0,d.Acl)("bulkDataInsert"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectName")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,Object]),s("design:returntype",Promise)],u.prototype,"bulkDataInsert",null),n([(0,r.Patch)("/api/v1/db/data/bulk/:orgs/:projectName/:tableName"),(0,d.Acl)("bulkDataUpdate"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],u.prototype,"bulkDataUpdate",null),n([(0,r.Patch)("/api/v1/db/data/bulk/:orgs/:projectName/:tableName/all"),(0,d.Acl)("bulkDataUpdateAll"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],u.prototype,"bulkDataUpdateAll",null),n([(0,r.Delete)("/api/v1/db/data/bulk/:orgs/:projectName/:tableName"),(0,d.Acl)("bulkDataDelete"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],u.prototype,"bulkDataDelete",null),n([(0,r.Delete)("/api/v1/db/data/bulk/:orgs/:projectName/:tableName/all"),(0,d.Acl)("bulkDataDeleteAll"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),s("design:type",Function),s("design:paramtypes",[Object,String,String]),s("design:returntype",Promise)],u.prototype,"bulkDataDeleteAll",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==c.BulkDataAliasService&&c.BulkDataAliasService)?i:Object])],u),t.BulkDataAliasController=u},72550:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CachesController=void 0;const o=a(26481),r=a(68281),l=a(35987),c=a(66310),d=a(68382);let u=class{constructor(e){this.cachesService=e}async cacheGet(e,t){const a=await this.cachesService.cacheGet();return t.set({"Content-Type":"application/json","Content-Disposition":'attachment; filename="cache-export.json"'}),JSON.stringify(a)}async cacheDelete(){return await this.cachesService.cacheDelete()}};n([(0,o.Get)("/api/v1/db/meta/cache"),(0,d.Acl)("cacheGet",{scope:"org",allowedRoles:[r.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],u.prototype,"cacheGet",null),n([(0,o.Delete)("/api/v1/db/meta/cache"),(0,d.Acl)("cacheDelete",{scope:"org",allowedRoles:[r.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],u.prototype,"cacheDelete",null),u=n([(0,o.Controller)(),(0,o.UseGuards)(c.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==l.CachesService&&l.CachesService)?i:Object])],u),t.CachesController=u},52868:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnsController=void 0;const c=a(26481),d=a(68281),u=a(66310),p=a(27695),m=a(68382);let f=class{constructor(e){this.columnsService=e}async columnAdd(e,t,a){return await this.columnsService.columnAdd({tableId:e,column:t,req:a,user:a.user})}async columnUpdate(e,t,a){return await this.columnsService.columnUpdate({columnId:e,column:t,req:a,user:a.user})}async columnDelete(e,t){return await this.columnsService.columnDelete({columnId:e,req:t,user:t.user})}async columnGet(e){return await this.columnsService.columnGet({columnId:e})}async columnSetAsPrimary(e){return await this.columnsService.columnSetAsPrimary({columnId:e})}async columnsHash(e){return await this.columnsService.columnsHash(e)}async columnBulk(e,t,a){return await this.columnsService.columnBulk(e,t,a)}};o([(0,c.Post)("/api/v1/db/meta/tables/:tableId/columns/"),(0,c.HttpCode)(200),(0,m.Acl)("columnAdd"),l(0,(0,c.Param)("tableId")),l(1,(0,c.Body)()),l(2,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(n=void 0!==d.ColumnReqType&&d.ColumnReqType)?n:Object,Object]),r("design:returntype",Promise)],f.prototype,"columnAdd",null),o([(0,c.Patch)("/api/v1/db/meta/columns/:columnId"),(0,m.Acl)("columnUpdate"),l(0,(0,c.Param)("columnId")),l(1,(0,c.Body)()),l(2,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(s=void 0!==d.ColumnReqType&&d.ColumnReqType)?s:Object,Object]),r("design:returntype",Promise)],f.prototype,"columnUpdate",null),o([(0,c.Delete)("/api/v1/db/meta/columns/:columnId"),(0,m.Acl)("columnDelete"),l(0,(0,c.Param)("columnId")),l(1,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],f.prototype,"columnDelete",null),o([(0,c.Get)("/api/v1/db/meta/columns/:columnId"),(0,m.Acl)("columnGet"),l(0,(0,c.Param)("columnId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],f.prototype,"columnGet",null),o([(0,c.Post)("/api/v1/db/meta/columns/:columnId/primary"),(0,c.HttpCode)(200),(0,m.Acl)("columnSetAsPrimary"),l(0,(0,c.Param)("columnId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],f.prototype,"columnSetAsPrimary",null),o([(0,c.Get)("/api/v1/db/meta/tables/:tableId/columns/hash"),(0,m.Acl)("columnsHash"),l(0,(0,c.Param)("tableId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],f.prototype,"columnsHash",null),o([(0,c.Post)("/api/v1/db/meta/tables/:tableId/columns/bulk"),(0,c.HttpCode)(200),(0,m.Acl)("columnBulk"),l(0,(0,c.Param)("tableId")),l(1,(0,c.Body)()),l(2,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,Object,Object]),r("design:returntype",Promise)],f.prototype,"columnBulk",null),f=o([(0,c.Controller)(),(0,c.UseGuards)(u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==p.ColumnsService&&p.ColumnsService)?i:Object])],f),t.ColumnsController=f},42801:function(e,t,a){var i,n=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return s(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataAliasExportController=void 0;const d=a(26481),u=r(a(6302)),p=a(66310),m=a(68349),f=a(7214),h=a(15147),g=a(68382);let _=class{constructor(e){this.datasService=e}async excelDataExport(e,t){const{model:a,view:i}=await this.datasService.getViewAndModelFromRequestByAliasOrId(e);let n=i;n||(n=await h.View.getDefaultView(a.id));const{offset:s,elapsed:o,data:r}=await(0,f.extractXlsxData)(n,e),l=u.utils.book_new();u.utils.book_append_sheet(l,r,n.title);const c=u.write(l,{type:"base64",bookType:"xlsx"});t.set({"Access-Control-Expose-Headers":"nc-export-offset","nc-export-offset":s,"nc-export-elapsed-time":o,"Content-Disposition":`attachment; filename="${encodeURI(n.title)}-export.xlsx"`}),t.end(c)}async csvDataExport(e,t){const{model:a,view:i}=await this.datasService.getViewAndModelFromRequestByAliasOrId(e);let n=i;n||(n=await h.View.getDefaultView(a.id));const{offset:s,elapsed:o,data:r}=await(0,f.extractCsvData)(n,e);t.set({"Access-Control-Expose-Headers":"nc-export-offset","nc-export-offset":s,"nc-export-elapsed-time":o,"Content-Disposition":`attachment; filename="${encodeURI(n.title)}-export.csv"`}),t.send(r)}};o([(0,d.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName/export/excel","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/export/excel"]),(0,g.Acl)("exportExcel"),c(0,(0,d.Request)()),c(1,(0,d.Response)()),l("design:type",Function),l("design:paramtypes",[Object,Object]),l("design:returntype",Promise)],_.prototype,"excelDataExport",null),o([(0,d.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/export/csv","/api/v1/db/data/:orgs/:projectName/:tableName/export/csv"]),(0,g.Acl)("exportCsv"),c(0,(0,d.Request)()),c(1,(0,d.Response)()),l("design:type",Function),l("design:paramtypes",[Object,Object]),l("design:returntype",Promise)],_.prototype,"csvDataExport",null),_=o([(0,d.Controller)(),(0,d.UseGuards)(p.GlobalGuard),l("design:paramtypes",["function"==typeof(i=void 0!==m.DatasService&&m.DatasService)?i:Object])],_),t.DataAliasExportController=_},85564:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataAliasNestedController=void 0;const r=a(26481),l=a(26234),c=a(66310),d=a(68382);let u=class{constructor(e){this.dataAliasNestedService=e}async mmList(e,t,a,i,n){return await this.dataAliasNestedService.mmList({query:e.query,columnName:t,rowId:a,projectName:i,tableName:n})}async mmExcludedList(e,t,a,i,n){return await this.dataAliasNestedService.mmExcludedList({query:e.query,columnName:t,rowId:a,projectName:i,tableName:n})}async hmExcludedList(e,t,a,i,n){return await this.dataAliasNestedService.hmExcludedList({query:e.query,columnName:t,rowId:a,projectName:i,tableName:n})}async btExcludedList(e,t,a,i,n){return await this.dataAliasNestedService.btExcludedList({query:e.query,columnName:t,rowId:a,projectName:i,tableName:n})}async hmList(e,t,a,i,n){return await this.dataAliasNestedService.hmList({query:e.query,columnName:t,rowId:a,projectName:i,tableName:n})}async relationDataRemove(e,t,a,i,n,s){return await this.dataAliasNestedService.relationDataRemove({columnName:t,rowId:a,projectName:i,tableName:n,cookie:e,refRowId:s}),{msg:"The relation data has been deleted successfully"}}async relationDataAdd(e,t,a,i,n,s){return await this.dataAliasNestedService.relationDataAdd({columnName:t,rowId:a,projectName:i,tableName:n,cookie:e,refRowId:s}),{msg:"The relation data has been created successfully"}}};n([(0,r.Get)("/api/v1/db/data/:orgs/:projectName/:tableName/:rowId/mm/:columnName"),(0,d.Acl)("mmList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("columnName")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("projectName")),o(4,(0,r.Param)("tableName")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"mmList",null),n([(0,r.Get)("/api/v1/db/data/:orgs/:projectName/:tableName/:rowId/mm/:columnName/exclude"),(0,d.Acl)("mmExcludedList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("columnName")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("projectName")),o(4,(0,r.Param)("tableName")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"mmExcludedList",null),n([(0,r.Get)("/api/v1/db/data/:orgs/:projectName/:tableName/:rowId/hm/:columnName/exclude"),(0,d.Acl)("hmExcludedList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("columnName")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("projectName")),o(4,(0,r.Param)("tableName")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"hmExcludedList",null),n([(0,r.Get)("/api/v1/db/data/:orgs/:projectName/:tableName/:rowId/bt/:columnName/exclude"),(0,d.Acl)("btExcludedList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("columnName")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("projectName")),o(4,(0,r.Param)("tableName")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"btExcludedList",null),n([(0,r.Get)("/api/v1/db/data/:orgs/:projectName/:tableName/:rowId/hm/:columnName"),(0,d.Acl)("hmList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("columnName")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("projectName")),o(4,(0,r.Param)("tableName")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"hmList",null),n([(0,r.Delete)("/api/v1/db/data/:orgs/:projectName/:tableName/:rowId/:relationType/:columnName/:refRowId"),(0,d.Acl)("relationDataRemove"),o(0,(0,r.Request)()),o(1,(0,r.Param)("columnName")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("projectName")),o(4,(0,r.Param)("tableName")),o(5,(0,r.Param)("refRowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"relationDataRemove",null),n([(0,r.Post)("/api/v1/db/data/:orgs/:projectName/:tableName/:rowId/:relationType/:columnName/:refRowId"),(0,d.Acl)("relationDataAdd"),(0,r.HttpCode)(200),o(0,(0,r.Request)()),o(1,(0,r.Param)("columnName")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("projectName")),o(4,(0,r.Param)("tableName")),o(5,(0,r.Param)("refRowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"relationDataAdd",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(c.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==l.DataAliasNestedService&&l.DataAliasNestedService)?i:Object])],u),t.DataAliasNestedController=u},34684:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataAliasController=void 0;const r=a(26481),l=a(66310),c=a(78829),d=a(68382),u=a(68349);let p=class{constructor(e){this.datasService=e}async dataList(e,t,a,i,n,s){const o=process.hrtime(),r=await this.datasService.dataList({query:e.query,projectName:a,tableName:i,viewName:n,disableOptimization:"false"===s}),l=(0,c.parseHrtimeToMilliSeconds)(process.hrtime(o));t.setHeader("xc-db-response",l),t.json(r)}async dataFindOne(e,t,a,i){return await this.datasService.dataFindOne({query:e.query,projectName:t,tableName:a,viewName:i})}async dataGroupBy(e,t,a,i){return await this.datasService.dataGroupBy({query:e.query,projectName:t,tableName:a,viewName:i})}async dataCount(e,t,a,i,n){const s=await this.datasService.dataCount({query:e.query,projectName:a,tableName:i,viewName:n});t.json(s)}async dataInsert(e,t,a,i,n,s){return await this.datasService.dataInsert({projectName:t,tableName:a,viewName:i,body:n,cookie:e,disableOptimization:"false"===s})}async dataUpdate(e,t,a,i,n,s){return await this.datasService.dataUpdate({projectName:t,tableName:a,viewName:i,body:e.body,cookie:e,rowId:n,disableOptimization:"false"===s})}async dataDelete(e,t,a,i,n){return await this.datasService.dataDelete({projectName:t,tableName:a,viewName:i,cookie:e,rowId:n})}async dataRead(e,t,a,i,n,s,o){return await this.datasService.dataRead({projectName:t,tableName:a,viewName:i,rowId:n,query:e.query,disableOptimization:"false"===s,getHiddenColumn:o})}async dataExist(e,t,a,i,n,s){const o=await this.datasService.dataExist({projectName:a,tableName:i,viewName:n,rowId:s,query:e.query});t.json(o)}async groupedDataList(e,t,a,i,n,s){const o=process.hrtime(),r=await this.datasService.groupedDataList({projectName:a,tableName:i,viewName:n,query:e.query,columnId:s}),l=(0,c.parseHrtimeToMilliSeconds)(process.hrtime(o));t.setHeader("xc-db-response",l),t.json(r)}};n([(0,r.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName"]),(0,d.Acl)("dataList"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectName")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Param)("viewName")),o(5,(0,r.Query)("opt")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataList",null),n([(0,r.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName/find-one","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/find-one"]),(0,d.Acl)("dataFindOne"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Param)("viewName")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataFindOne",null),n([(0,r.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName/groupby","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/groupby"]),(0,d.Acl)("dataGroupBy"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Param)("viewName")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataGroupBy",null),n([(0,r.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName/count","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/count"]),(0,d.Acl)("dataCount"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectName")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Param)("viewName")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataCount",null),n([(0,r.Post)(["/api/v1/db/data/:orgs/:projectName/:tableName","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName"]),(0,r.HttpCode)(200),(0,d.Acl)("dataInsert"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Param)("viewName")),o(4,(0,r.Body)()),o(5,(0,r.Query)("opt")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,Object,String]),s("design:returntype",Promise)],p.prototype,"dataInsert",null),n([(0,r.Patch)(["/api/v1/db/data/:orgs/:projectName/:tableName/:rowId","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/:rowId"]),(0,d.Acl)("dataUpdate"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Param)("viewName")),o(4,(0,r.Param)("rowId")),o(5,(0,r.Query)("opt")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataUpdate",null),n([(0,r.Delete)(["/api/v1/db/data/:orgs/:projectName/:tableName/:rowId","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/:rowId"]),(0,d.Acl)("dataDelete"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Param)("viewName")),o(4,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataDelete",null),n([(0,r.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName/:rowId","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/:rowId"]),(0,d.Acl)("dataRead"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectName")),o(2,(0,r.Param)("tableName")),o(3,(0,r.Param)("viewName")),o(4,(0,r.Param)("rowId")),o(5,(0,r.Query)("opt")),o(6,(0,r.Query)("getHiddenColumn")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String,String,Boolean]),s("design:returntype",Promise)],p.prototype,"dataRead",null),n([(0,r.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName/:rowId/exist","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/:rowId/exist"]),(0,d.Acl)("dataExist"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectName")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Param)("viewName")),o(5,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataExist",null),n([(0,r.Get)(["/api/v1/db/data/:orgs/:projectName/:tableName/group/:columnId","/api/v1/db/data/:orgs/:projectName/:tableName/views/:viewName/group/:columnId"]),(0,d.Acl)("groupedDataList"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectName")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Param)("viewName")),o(5,(0,r.Param)("columnId")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,String,String]),s("design:returntype",Promise)],p.prototype,"groupedDataList",null),p=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==u.DatasService&&u.DatasService)?i:Object])],p),t.DataAliasController=p},89214:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataTableController=void 0;const r=a(26481),l=a(66310),c=a(68382),d=a(39371),u=a(78829);let p=class{constructor(e){this.dataTableService=e}async dataList(e,t,a,i){const n=process.hrtime(),s=await this.dataTableService.dataList({query:e.query,modelId:a,viewId:i}),o=(0,u.parseHrtimeToMilliSeconds)(process.hrtime(n));t.setHeader("xc-db-response",o),t.json(s)}async dataCount(e,t,a,i){const n=await this.dataTableService.dataCount({query:e.query,modelId:a,viewId:i});t.json(n)}async dataInsert(e,t,a,i){return await this.dataTableService.dataInsert({modelId:t,body:i,viewId:a,cookie:e})}async dataUpdate(e,t,a,i){return await this.dataTableService.dataUpdate({modelId:t,body:e.body,cookie:e,viewId:a})}async dataDelete(e,t,a,i){return await this.dataTableService.dataDelete({modelId:t,cookie:e,viewId:a,body:e.body})}async dataRead(e,t,a,i){return await this.dataTableService.dataRead({modelId:t,rowId:i,query:e.query,viewId:a})}async nestedDataList(e,t,a,i,n){return await this.dataTableService.nestedDataList({modelId:t,rowId:n,query:e.query,viewId:a,columnId:i})}async nestedLink(e,t,a,i,n,s){return await this.dataTableService.nestedLink({modelId:t,rowId:n,query:e.query,viewId:a,columnId:i,refRowIds:s,cookie:e})}async nestedUnlink(e,t,a,i,n,s){return await this.dataTableService.nestedUnlink({modelId:t,rowId:n,query:e.query,viewId:a,columnId:i,refRowIds:s,cookie:e})}};n([(0,r.Get)("/api/v1/tables/:modelId/rows"),(0,c.Acl)("dataList"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("modelId")),o(3,(0,r.Query)("viewId")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String]),s("design:returntype",Promise)],p.prototype,"dataList",null),n([(0,r.Get)(["/api/v1/tables/:modelId/rows/count"]),(0,c.Acl)("dataCount"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("modelId")),o(3,(0,r.Query)("viewId")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String]),s("design:returntype",Promise)],p.prototype,"dataCount",null),n([(0,r.Post)(["/api/v1/tables/:modelId/rows"]),(0,r.HttpCode)(200),(0,c.Acl)("dataInsert"),o(0,(0,r.Request)()),o(1,(0,r.Param)("modelId")),o(2,(0,r.Query)("viewId")),o(3,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],p.prototype,"dataInsert",null),n([(0,r.Patch)(["/api/v1/tables/:modelId/rows"]),(0,c.Acl)("dataUpdate"),o(0,(0,r.Request)()),o(1,(0,r.Param)("modelId")),o(2,(0,r.Query)("viewId")),o(3,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataUpdate",null),n([(0,r.Delete)(["/api/v1/tables/:modelId/rows"]),(0,c.Acl)("dataDelete"),o(0,(0,r.Request)()),o(1,(0,r.Param)("modelId")),o(2,(0,r.Query)("viewId")),o(3,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataDelete",null),n([(0,r.Get)(["/api/v1/tables/:modelId/rows/:rowId"]),(0,c.Acl)("dataRead"),o(0,(0,r.Request)()),o(1,(0,r.Param)("modelId")),o(2,(0,r.Query)("viewId")),o(3,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],p.prototype,"dataRead",null),n([(0,r.Get)(["/api/v1/tables/:modelId/links/:columnId/rows/:rowId"]),(0,c.Acl)("nestedDataList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("modelId")),o(2,(0,r.Query)("viewId")),o(3,(0,r.Param)("columnId")),o(4,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String]),s("design:returntype",Promise)],p.prototype,"nestedDataList",null),n([(0,r.Post)(["/api/v1/tables/:modelId/links/:columnId/rows/:rowId"]),(0,c.Acl)("nestedDataLink"),o(0,(0,r.Request)()),o(1,(0,r.Param)("modelId")),o(2,(0,r.Query)("viewId")),o(3,(0,r.Param)("columnId")),o(4,(0,r.Param)("rowId")),o(5,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String,Object]),s("design:returntype",Promise)],p.prototype,"nestedLink",null),n([(0,r.Delete)(["/api/v1/tables/:modelId/links/:columnId/rows/:rowId"]),(0,c.Acl)("nestedDataUnlink"),o(0,(0,r.Request)()),o(1,(0,r.Param)("modelId")),o(2,(0,r.Query)("viewId")),o(3,(0,r.Param)("columnId")),o(4,(0,r.Param)("rowId")),o(5,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String,Object]),s("design:returntype",Promise)],p.prototype,"nestedUnlink",null),p=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==d.DataTableService&&d.DataTableService)?i:Object])],p),t.DataTableController=p},20727:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasController=void 0;const r=a(26481),l=a(66310),c=a(68349),d=a(68382);let u=class{constructor(e){this.datasService=e}async dataList(e,t){return await this.datasService.dataListByViewId({viewId:t,query:e.query})}async mmList(e,t,a,i){return await this.datasService.mmList({viewId:t,colId:a,rowId:i,query:e.query})}async mmExcludedList(e,t,a,i){return await this.datasService.mmExcludedList({viewId:t,colId:a,rowId:i,query:e.query})}async hmExcludedList(e,t,a,i){await this.datasService.hmExcludedList({viewId:t,colId:a,rowId:i,query:e.query})}async btExcludedList(e,t,a,i){return await this.datasService.btExcludedList({viewId:t,colId:a,rowId:i,query:e.query})}async hmList(e,t,a,i){return await this.datasService.hmList({viewId:t,colId:a,rowId:i,query:e.query})}async dataRead(e,t,a){return await this.datasService.dataReadByViewId({viewId:t,rowId:a,query:e.query})}async dataInsert(e,t,a){return await this.datasService.dataInsertByViewId({viewId:t,body:a,cookie:e})}async dataUpdate(e,t,a,i){return await this.datasService.dataUpdateByViewId({viewId:t,rowId:a,body:i,cookie:e})}async dataDelete(e,t,a){return await this.datasService.dataDeleteByViewId({viewId:t,rowId:a,cookie:e})}async relationDataDelete(e,t,a,i,n,s){return await this.datasService.relationDataDelete({viewId:t,colId:n,childId:s,rowId:a,cookie:e}),{msg:"The relation data has been deleted successfully"}}async relationDataAdd(e,t,a,i,n,s){return await this.datasService.relationDataAdd({viewId:t,colId:n,childId:s,rowId:a,cookie:e}),{msg:"The relation data has been created successfully"}}};n([(0,r.Get)("/data/:viewId/"),(0,d.Acl)("dataList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],u.prototype,"dataList",null),n([(0,r.Get)("/data/:viewId/:rowId/mm/:colId"),(0,d.Acl)("mmList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("colId")),o(3,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],u.prototype,"mmList",null),n([(0,r.Get)("/data/:viewId/:rowId/mm/:colId/exclude"),(0,d.Acl)("mmExcludedList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("colId")),o(3,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],u.prototype,"mmExcludedList",null),n([(0,r.Get)("/data/:viewId/:rowId/hm/:colId/exclude"),(0,d.Acl)("hmExcludedList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("colId")),o(3,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],u.prototype,"hmExcludedList",null),n([(0,r.Get)("/data/:viewId/:rowId/bt/:colId/exclude"),(0,d.Acl)("btExcludedList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("colId")),o(3,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],u.prototype,"btExcludedList",null),n([(0,r.Get)("/data/:viewId/:rowId/hm/:colId"),(0,d.Acl)("hmList"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("colId")),o(3,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],u.prototype,"hmList",null),n([(0,r.Get)("/data/:viewId/:rowId"),(0,d.Acl)("dataRead"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String]),s("design:returntype",Promise)],u.prototype,"dataRead",null),n([(0,r.Post)("/data/:viewId/"),(0,r.HttpCode)(200),(0,d.Acl)("dataInsert"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,Object]),s("design:returntype",Promise)],u.prototype,"dataInsert",null),n([(0,r.Patch)("/data/:viewId/:rowId"),(0,d.Acl)("dataUpdate"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],u.prototype,"dataUpdate",null),n([(0,r.Delete)("/data/:viewId/:rowId"),(0,d.Acl)("dataDelete"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,String,String]),s("design:returntype",Promise)],u.prototype,"dataDelete",null),n([(0,r.Delete)("/data/:viewId/:rowId/:relationType/:colId/:childId"),(0,d.Acl)("relationDataDelete"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("relationType")),o(4,(0,r.Param)("colId")),o(5,(0,r.Param)("childId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"relationDataDelete",null),n([(0,r.Post)("/data/:viewId/:rowId/:relationType/:colId/:childId"),(0,r.HttpCode)(200),(0,d.Acl)("relationDataAdd"),o(0,(0,r.Request)()),o(1,(0,r.Param)("viewId")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("relationType")),o(4,(0,r.Param)("colId")),o(5,(0,r.Param)("childId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String,String,String]),s("design:returntype",Promise)],u.prototype,"relationDataAdd",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==c.DatasService&&c.DatasService)?i:Object])],u),t.DatasController=u},90083:function(e,t,a){var i,n,s,o,r=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.FiltersController=void 0;const d=a(26481),u=a(68281),p=a(66310),m=a(60498),f=a(3272),h=a(68382);let g=class{constructor(e){this.filtersService=e}async filterList(e){return new m.PagedResponseImpl(await this.filtersService.filterList({viewId:e}))}async filterCreate(e,t,a){return await this.filtersService.filterCreate({filter:t,viewId:e,user:a.user})}async hookFilterCreate(e,t,a){return await this.filtersService.hookFilterCreate({filter:t,hookId:e,user:a.user})}async filterGet(e){return await this.filtersService.filterGet({filterId:e})}async filterChildrenRead(e){return new m.PagedResponseImpl(await this.filtersService.filterChildrenList({filterId:e}))}async filterUpdate(e,t,a){return await this.filtersService.filterUpdate({filterId:e,filter:t,user:a.user})}async filterDelete(e,t){return await this.filtersService.filterDelete({filterId:e})}async hookFilterList(e){return new m.PagedResponseImpl(await this.filtersService.hookFilterList({hookId:e}))}};r([(0,d.Get)("/api/v1/db/meta/views/:viewId/filters"),(0,h.Acl)("filterList"),c(0,(0,d.Param)("viewId")),l("design:type",Function),l("design:paramtypes",[String]),l("design:returntype",Promise)],g.prototype,"filterList",null),r([(0,d.Post)("/api/v1/db/meta/views/:viewId/filters"),(0,d.HttpCode)(200),(0,h.Acl)("filterCreate"),c(0,(0,d.Param)("viewId")),c(1,(0,d.Body)()),c(2,(0,d.Req)()),l("design:type",Function),l("design:paramtypes",[String,"function"==typeof(n=void 0!==u.FilterReqType&&u.FilterReqType)?n:Object,Object]),l("design:returntype",Promise)],g.prototype,"filterCreate",null),r([(0,d.Post)("/api/v1/db/meta/hooks/:hookId/filters"),(0,d.HttpCode)(200),(0,h.Acl)("hookFilterCreate"),c(0,(0,d.Param)("hookId")),c(1,(0,d.Body)()),c(2,(0,d.Req)()),l("design:type",Function),l("design:paramtypes",[String,"function"==typeof(s=void 0!==u.FilterReqType&&u.FilterReqType)?s:Object,Object]),l("design:returntype",Promise)],g.prototype,"hookFilterCreate",null),r([(0,d.Get)("/api/v1/db/meta/filters/:filterId"),(0,h.Acl)("filterGet"),c(0,(0,d.Param)("filterId")),l("design:type",Function),l("design:paramtypes",[String]),l("design:returntype",Promise)],g.prototype,"filterGet",null),r([(0,d.Get)("/api/v1/db/meta/filters/:filterParentId/children"),(0,h.Acl)("filterChildrenList"),c(0,(0,d.Param)("filterParentId")),l("design:type",Function),l("design:paramtypes",[String]),l("design:returntype",Promise)],g.prototype,"filterChildrenRead",null),r([(0,d.Patch)("/api/v1/db/meta/filters/:filterId"),(0,h.Acl)("filterUpdate"),c(0,(0,d.Param)("filterId")),c(1,(0,d.Body)()),c(2,(0,d.Req)()),l("design:type",Function),l("design:paramtypes",[String,"function"==typeof(o=void 0!==u.FilterReqType&&u.FilterReqType)?o:Object,Object]),l("design:returntype",Promise)],g.prototype,"filterUpdate",null),r([(0,d.Delete)("/api/v1/db/meta/filters/:filterId"),(0,h.Acl)("filterDelete"),c(0,(0,d.Param)("filterId")),c(1,(0,d.Req)()),l("design:type",Function),l("design:paramtypes",[String,Object]),l("design:returntype",Promise)],g.prototype,"filterDelete",null),r([(0,d.Get)("/api/v1/db/meta/hooks/:hookId/filters"),(0,h.Acl)("hookFilterList"),c(0,(0,d.Param)("hookId")),l("design:type",Function),l("design:paramtypes",[String]),l("design:returntype",Promise)],g.prototype,"hookFilterList",null),g=r([(0,d.Controller)(),(0,d.UseGuards)(p.GlobalGuard),l("design:paramtypes",["function"==typeof(i=void 0!==f.FiltersService&&f.FiltersService)?i:Object])],g),t.FiltersController=g},976:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormColumnsController=void 0;const r=a(26481),l=a(66310),c=a(74500),d=a(68382);let u=class{constructor(e){this.formColumnsService=e}async columnUpdate(e,t){return await this.formColumnsService.columnUpdate({formViewColumnId:e,formViewColumn:t})}};n([(0,r.Patch)("/api/v1/db/meta/form-columns/:formViewColumnId"),(0,d.Acl)("columnUpdate"),o(0,(0,r.Param)("formViewColumnId")),o(1,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[String,class{}]),s("design:returntype",Promise)],u.prototype,"columnUpdate",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==c.FormColumnsService&&c.FormColumnsService)?i:Object])],u),t.FormColumnsController=u},17822:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.FormsController=void 0;const l=a(26481),c=a(68281),d=a(66310),u=a(42934),p=a(68382);let m=class{constructor(e){this.formsService=e}async formViewGet(e){return await this.formsService.formViewGet({formViewId:e})}async formViewCreate(e,t,a){return await this.formsService.formViewCreate({body:t,tableId:e,user:a.user})}async formViewUpdate(e,t){return await this.formsService.formViewUpdate({formViewId:e,form:t})}};s([(0,l.Get)("/api/v1/db/meta/forms/:formViewId"),(0,p.Acl)("formViewGet"),r(0,(0,l.Param)("formViewId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],m.prototype,"formViewGet",null),s([(0,l.Post)("/api/v1/db/meta/tables/:tableId/forms"),(0,l.HttpCode)(200),(0,p.Acl)("formViewCreate"),r(0,(0,l.Param)("tableId")),r(1,(0,l.Body)()),r(2,(0,l.Req)()),o("design:type",Function),o("design:paramtypes",[String,"function"==typeof(n=void 0!==c.ViewCreateReqType&&c.ViewCreateReqType)?n:Object,Object]),o("design:returntype",Promise)],m.prototype,"formViewCreate",null),s([(0,l.Patch)("/api/v1/db/meta/forms/:formViewId"),(0,p.Acl)("formViewUpdate"),r(0,(0,l.Param)("formViewId")),r(1,(0,l.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],m.prototype,"formViewUpdate",null),m=s([(0,l.Controller)(),(0,l.UseGuards)(d.GlobalGuard),o("design:paramtypes",["function"==typeof(i=void 0!==u.FormsService&&u.FormsService)?i:Object])],m),t.FormsController=m},62421:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GalleriesController=void 0;const c=a(26481),d=a(68281),u=a(66310),p=a(99155),m=a(68382);let f=class{constructor(e){this.galleriesService=e}async galleryViewGet(e){return await this.galleriesService.galleryViewGet({galleryViewId:e})}async galleryViewCreate(e,t,a){return await this.galleriesService.galleryViewCreate({gallery:t,tableId:e,user:a.user})}async galleryViewUpdate(e,t){return await this.galleriesService.galleryViewUpdate({galleryViewId:e,gallery:t})}};o([(0,c.Get)("/api/v1/db/meta/galleries/:galleryViewId"),(0,m.Acl)("galleryViewGet"),l(0,(0,c.Param)("galleryViewId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],f.prototype,"galleryViewGet",null),o([(0,c.Post)("/api/v1/db/meta/tables/:tableId/galleries"),(0,c.HttpCode)(200),(0,m.Acl)("galleryViewCreate"),l(0,(0,c.Param)("tableId")),l(1,(0,c.Body)()),l(2,(0,c.Req)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(n=void 0!==d.ViewCreateReqType&&d.ViewCreateReqType)?n:Object,Object]),r("design:returntype",Promise)],f.prototype,"galleryViewCreate",null),o([(0,c.Patch)("/api/v1/db/meta/galleries/:galleryViewId"),(0,m.Acl)("galleryViewUpdate"),l(0,(0,c.Param)("galleryViewId")),l(1,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(s=void 0!==d.GalleryUpdateReqType&&d.GalleryUpdateReqType)?s:Object]),r("design:returntype",Promise)],f.prototype,"galleryViewUpdate",null),f=o([(0,c.Controller)(),(0,c.UseGuards)(u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==p.GalleriesService&&p.GalleriesService)?i:Object])],f),t.GalleriesController=f},58858:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GridColumnsController=void 0;const l=a(26481),c=a(68281),d=a(66310),u=a(58946),p=a(68382);let m=class{constructor(e){this.gridColumnsService=e}async columnList(e){return await this.gridColumnsService.columnList({gridViewId:e})}async gridColumnUpdate(e,t){return this.gridColumnsService.gridColumnUpdate({gridViewColumnId:e,grid:t})}};s([(0,l.Get)("/api/v1/db/meta/grids/:gridViewId/grid-columns"),(0,p.Acl)("columnList"),r(0,(0,l.Param)("gridViewId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],m.prototype,"columnList",null),s([(0,l.Patch)("/api/v1/db/meta/grid-columns/:gridViewColumnId"),(0,p.Acl)("gridColumnUpdate"),r(0,(0,l.Param)("gridViewColumnId")),r(1,(0,l.Body)()),o("design:type",Function),o("design:paramtypes",[String,"function"==typeof(n=void 0!==c.GridColumnReqType&&c.GridColumnReqType)?n:Object]),o("design:returntype",Promise)],m.prototype,"gridColumnUpdate",null),m=s([(0,l.Controller)(),(0,l.UseGuards)(d.GlobalGuard),o("design:paramtypes",["function"==typeof(i=void 0!==u.GridColumnsService&&u.GridColumnsService)?i:Object])],m),t.GridColumnsController=m},9886:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.GridsController=void 0;const l=a(26481),c=a(68281),d=a(66310),u=a(1180),p=a(68382);let m=class{get"/api/v1/db/meta/tables/:tableId/grids/"(){return this["_/api/v1/db/meta/tables/:tableId/grids/"]}constructor(e){this.gridsService=e}async gridViewCreate(e,t,a){return await this.gridsService.gridViewCreate({grid:t,tableId:e})}async gridViewUpdate(e,t){return await this.gridsService.gridViewUpdate({viewId:e,grid:t})}};s([(0,l.Post)("/api/v1/db/meta/tables/:tableId/grids/"),(0,l.HttpCode)(200),(0,p.Acl)("gridViewCreate"),r(0,(0,l.Param)("tableId")),r(1,(0,l.Body)()),r(2,(0,l.Req)()),o("design:type",Function),o("design:paramtypes",[String,"function"==typeof(n=void 0!==c.ViewCreateReqType&&c.ViewCreateReqType)?n:Object,Object]),o("design:returntype",Promise)],m.prototype,"gridViewCreate",null),s([(0,l.Patch)("/api/v1/db/meta/grids/:viewId"),(0,p.Acl)("gridViewUpdate"),r(0,(0,l.Param)("viewId")),r(1,(0,l.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],m.prototype,"gridViewUpdate",null),m=s([(0,l.Controller)(),(0,l.UseGuards)(d.GlobalGuard),o("design:paramtypes",["function"==typeof(i=void 0!==u.GridsService&&u.GridsService)?i:Object])],m),t.GridsController=m},44610:function(e,t,a){var i,n,s,o,r=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.HooksController=void 0;const d=a(26481),u=a(68281),p=a(66310),m=a(60498),f=a(27556),h=a(68382);let g=class{constructor(e){this.hooksService=e}async hookList(e){return new m.PagedResponseImpl(await this.hooksService.hookList({tableId:e}))}async hookCreate(e,t){return await this.hooksService.hookCreate({hook:t,tableId:e})}async hookDelete(e){return await this.hooksService.hookDelete({hookId:e})}async hookUpdate(e,t){return await this.hooksService.hookUpdate({hookId:e,hook:t})}async hookTest(e,t){try{return await this.hooksService.hookTest({hookTest:Object.assign(Object.assign({},e),{payload:Object.assign(Object.assign({},e.payload),{user:null==t?void 0:t.user})}),tableId:t.params.tableId}),{msg:"The hook has been tested successfully"}}catch(e){throw console.error(e),e}}async tableSampleData(e,t,a){return await this.hooksService.tableSampleData({tableId:e,operation:t,version:a})}async hookLogList(e,t){return new m.PagedResponseImpl(await this.hooksService.hookLogList({query:t.query,hookId:e}),Object.assign(Object.assign({},t.query),{count:await this.hooksService.hookLogCount({hookId:e})}))}};r([(0,d.Get)("/api/v1/db/meta/tables/:tableId/hooks"),(0,h.Acl)("hookList"),c(0,(0,d.Param)("tableId")),l("design:type",Function),l("design:paramtypes",[String]),l("design:returntype",Promise)],g.prototype,"hookList",null),r([(0,d.Post)("/api/v1/db/meta/tables/:tableId/hooks"),(0,d.HttpCode)(200),(0,h.Acl)("hookCreate"),c(0,(0,d.Param)("tableId")),c(1,(0,d.Body)()),l("design:type",Function),l("design:paramtypes",[String,"function"==typeof(n=void 0!==u.HookReqType&&u.HookReqType)?n:Object]),l("design:returntype",Promise)],g.prototype,"hookCreate",null),r([(0,d.Delete)("/api/v1/db/meta/hooks/:hookId"),(0,h.Acl)("hookDelete"),c(0,(0,d.Param)("hookId")),l("design:type",Function),l("design:paramtypes",[String]),l("design:returntype",Promise)],g.prototype,"hookDelete",null),r([(0,d.Patch)("/api/v1/db/meta/hooks/:hookId"),(0,h.Acl)("hookUpdate"),c(0,(0,d.Param)("hookId")),c(1,(0,d.Body)()),l("design:type",Function),l("design:paramtypes",[String,"function"==typeof(s=void 0!==u.HookReqType&&u.HookReqType)?s:Object]),l("design:returntype",Promise)],g.prototype,"hookUpdate",null),r([(0,d.Post)("/api/v1/db/meta/tables/:tableId/hooks/test"),(0,d.HttpCode)(200),(0,h.Acl)("hookTest"),c(0,(0,d.Body)()),c(1,(0,d.Request)()),l("design:type",Function),l("design:paramtypes",["function"==typeof(o=void 0!==u.HookTestReqType&&u.HookTestReqType)?o:Object,Object]),l("design:returntype",Promise)],g.prototype,"hookTest",null),r([(0,d.Get)("/api/v1/db/meta/tables/:tableId/hooks/samplePayload/:operation/:version"),(0,h.Acl)("tableSampleData"),c(0,(0,d.Param)("tableId")),c(1,(0,d.Param)("operation")),c(2,(0,d.Param)("version")),l("design:type",Function),l("design:paramtypes",[String,Object,Object]),l("design:returntype",Promise)],g.prototype,"tableSampleData",null),r([(0,d.Get)("/api/v1/db/meta/hooks/:hookId/logs"),(0,h.Acl)("hookLogList"),c(0,(0,d.Param)("hookId")),c(1,(0,d.Request)()),l("design:type",Function),l("design:paramtypes",[String,Object]),l("design:returntype",Promise)],g.prototype,"hookLogList",null),g=r([(0,d.Controller)(),(0,d.UseGuards)(p.GlobalGuard),l("design:paramtypes",["function"==typeof(i=void 0!==f.HooksService&&f.HooksService)?i:Object])],g),t.HooksController=g},49310:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.KanbansController=void 0;const l=a(26481),c=a(68281),d=a(66310),u=a(12871),p=a(68382);let m=class{constructor(e){this.kanbansService=e}async kanbanViewGet(e){return await this.kanbansService.kanbanViewGet({kanbanViewId:e})}async kanbanViewCreate(e,t,a){return await this.kanbansService.kanbanViewCreate({tableId:e,kanban:t,user:a.user})}async kanbanViewUpdate(e,t){return await this.kanbansService.kanbanViewUpdate({kanbanViewId:e,kanban:t})}};s([(0,l.Get)("/api/v1/db/meta/kanbans/:kanbanViewId"),(0,p.Acl)("kanbanViewGet"),r(0,(0,l.Param)("kanbanViewId")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],m.prototype,"kanbanViewGet",null),s([(0,l.Post)("/api/v1/db/meta/tables/:tableId/kanbans"),(0,l.HttpCode)(200),(0,p.Acl)("kanbanViewCreate"),r(0,(0,l.Param)("tableId")),r(1,(0,l.Body)()),r(2,(0,l.Req)()),o("design:type",Function),o("design:paramtypes",[String,"function"==typeof(n=void 0!==c.ViewCreateReqType&&c.ViewCreateReqType)?n:Object,Object]),o("design:returntype",Promise)],m.prototype,"kanbanViewCreate",null),s([(0,l.Patch)("/api/v1/db/meta/kanbans/:kanbanViewId"),(0,p.Acl)("kanbanViewUpdate"),r(0,(0,l.Param)("kanbanViewId")),r(1,(0,l.Body)()),o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],m.prototype,"kanbanViewUpdate",null),m=s([(0,l.Controller)(),(0,l.UseGuards)(d.GlobalGuard),o("design:paramtypes",["function"==typeof(i=void 0!==u.KanbansService&&u.KanbansService)?i:Object])],m),t.KanbansController=m},71604:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MapsController=void 0;const c=a(26481),d=a(68281),u=a(66310),p=a(55536),m=a(68382);let f=class{constructor(e){this.mapsService=e}async mapViewGet(e){return await this.mapsService.mapViewGet({mapViewId:e})}async mapViewCreate(e,t,a){return await this.mapsService.mapViewCreate({tableId:e,map:t,user:a.user})}async mapViewUpdate(e,t){return await this.mapsService.mapViewUpdate({mapViewId:e,map:t})}};o([(0,c.Get)("/api/v1/db/meta/maps/:mapViewId"),(0,m.Acl)("mapViewGet"),l(0,(0,c.Param)("mapViewId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],f.prototype,"mapViewGet",null),o([(0,c.Post)("/api/v1/db/meta/tables/:tableId/maps"),(0,c.HttpCode)(200),(0,m.Acl)("mapViewCreate"),l(0,(0,c.Param)("tableId")),l(1,(0,c.Body)()),l(2,(0,c.Req)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(n=void 0!==d.ViewCreateReqType&&d.ViewCreateReqType)?n:Object,Object]),r("design:returntype",Promise)],f.prototype,"mapViewCreate",null),o([(0,c.Patch)("/api/v1/db/meta/maps/:mapViewId"),(0,m.Acl)("mapViewUpdate"),l(0,(0,c.Param)("mapViewId")),l(1,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(s=void 0!==d.MapUpdateReqType&&d.MapUpdateReqType)?s:Object]),r("design:returntype",Promise)],f.prototype,"mapViewUpdate",null),f=o([(0,c.Controller)(),(0,c.UseGuards)(u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==p.MapsService&&p.MapsService)?i:Object])],f),t.MapsController=f},68531:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaDiffsController=void 0;const r=a(26481),l=a(66310),c=a(80181),d=a(68382);let u=class{constructor(e){this.metaDiffsService=e}async metaDiff(e){return await this.metaDiffsService.metaDiff({projectId:e})}async baseMetaDiff(e,t){return await this.metaDiffsService.baseMetaDiff({baseId:t,projectId:e})}async metaDiffSync(e){return await this.metaDiffsService.metaDiffSync({projectId:e}),{msg:"The meta has been synchronized successfully"}}async baseMetaDiffSync(e,t){return await this.metaDiffsService.baseMetaDiffSync({projectId:e,baseId:t}),{msg:"The base meta has been synchronized successfully"}}};n([(0,r.Get)("/api/v1/db/meta/projects/:projectId/meta-diff"),(0,d.Acl)("metaDiff"),o(0,(0,r.Param)("projectId")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],u.prototype,"metaDiff",null),n([(0,r.Get)("/api/v1/db/meta/projects/:projectId/meta-diff/:baseId"),(0,d.Acl)("metaDiff"),o(0,(0,r.Param)("projectId")),o(1,(0,r.Param)("baseId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],u.prototype,"baseMetaDiff",null),n([(0,r.Post)("/api/v1/db/meta/projects/:projectId/meta-diff"),(0,r.HttpCode)(200),(0,d.Acl)("metaDiffSync"),o(0,(0,r.Param)("projectId")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],u.prototype,"metaDiffSync",null),n([(0,r.Post)("/api/v1/db/meta/projects/:projectId/meta-diff/:baseId"),(0,r.HttpCode)(200),(0,d.Acl)("baseMetaDiffSync"),o(0,(0,r.Param)("projectId")),o(1,(0,r.Param)("baseId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],u.prototype,"baseMetaDiffSync",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==c.MetaDiffsService&&c.MetaDiffsService)?i:Object])],u),t.MetaDiffsController=u},16450:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelVisibilitiesController=void 0;const r=a(26481),l=a(66310),c=a(97982),d=a(68382);let u=class{constructor(e){this.modelVisibilitiesService=e}async xcVisibilityMetaSetAll(e,t){return await this.modelVisibilitiesService.xcVisibilityMetaSetAll({visibilityRule:t,projectId:e}),{msg:"UI ACL has been created successfully"}}async modelVisibilityList(e,t){return await this.modelVisibilitiesService.xcVisibilityMetaGet({projectId:e,includeM2M:!0===t||"true"===t})}};n([(0,r.Post)("/api/v1/db/meta/projects/:projectId/visibility-rules"),(0,r.HttpCode)(200),(0,d.Acl)("modelVisibilitySet"),o(0,(0,r.Param)("projectId")),o(1,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],u.prototype,"xcVisibilityMetaSetAll",null),n([(0,r.Get)("/api/v1/db/meta/projects/:projectId/visibility-rules"),(0,d.Acl)("modelVisibilityList"),o(0,(0,r.Param)("projectId")),o(1,(0,r.Query)("includeM2M")),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],u.prototype,"modelVisibilityList",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==c.ModelVisibilitiesService&&c.ModelVisibilitiesService)?i:Object])],u),t.ModelVisibilitiesController=u},7688:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationsController=void 0;const r=a(26481),l=a(79689),c=a(66310),d=a(33402);let u=class{constructor(e){this.notificationsService=e}async notificationList(e){return this.notificationsService.notificationList(Object.assign(Object.assign({user:e.user,is_deleted:!1},e.query),{is_read:"true"===e.query.is_read}))}async notificationUpdate(e,t,a){return this.notificationsService.notificationUpdate({notificationId:e,body:(0,d.extractProps)(t,["is_read"]),user:a.user})}async markAllRead(e){return this.notificationsService.markAllRead({user:e.user})}async notificationDelete(e,t){return this.notificationsService.notificationUpdate({notificationId:e,body:{is_deleted:!0},user:t.user})}};n([(0,r.Get)("/api/v1/notifications"),o(0,(0,r.Request)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],u.prototype,"notificationList",null),n([(0,r.Patch)("/api/v1/notifications/:notificationId"),o(0,(0,r.Param)("notificationId")),o(1,(0,r.Body)()),o(2,(0,r.Request)()),s("design:type",Function),s("design:paramtypes",[Object,Object,Object]),s("design:returntype",Promise)],u.prototype,"notificationUpdate",null),n([(0,r.Post)("/api/v1/notifications/mark-all-read"),(0,r.HttpCode)(200),o(0,(0,r.Request)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],u.prototype,"markAllRead",null),n([(0,r.Delete)("/api/v1/notifications/:notificationId"),o(0,(0,r.Param)("notificationId")),o(1,(0,r.Request)()),s("design:type",Function),s("design:paramtypes",[Object,Object]),s("design:returntype",Promise)],u.prototype,"notificationDelete",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(c.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==l.NotificationsService&&l.NotificationsService)?i:Object])],u),t.NotificationsController=u},42826:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OldDatasController=void 0;const r=a(26481),l=a(22443),c=a(66310),d=a(68382);let u=class{constructor(e){this.oldDatasService=e}async dataList(e,t,a,i){t.json(await this.oldDatasService.dataList({query:e.query,projectId:a,tableName:i}))}async dataCount(e,t,a,i){t.json(await this.oldDatasService.dataCount({query:e.query,projectId:a,tableName:i}))}async dataInsert(e,t,a,i,n){t.json(await this.oldDatasService.dataInsert({projectId:a,tableName:i,body:n,cookie:e}))}async dataRead(e,t,a,i,n){t.json(await this.oldDatasService.dataRead({projectId:a,tableName:i,rowId:n,query:e.query}))}async dataUpdate(e,t,a,i,n){t.json(await this.oldDatasService.dataUpdate({projectId:a,tableName:i,body:e.body,cookie:e,rowId:n}))}async dataDelete(e,t,a,i,n){t.json(await this.oldDatasService.dataDelete({projectId:a,tableName:i,cookie:e,rowId:n}))}};n([(0,r.Get)("/nc/:projectId/api/v1/:tableName"),(0,d.Acl)("dataList"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectId")),o(3,(0,r.Param)("tableName")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String]),s("design:returntype",Promise)],u.prototype,"dataList",null),n([(0,r.Get)("/nc/:projectId/api/v1/:tableName/count"),(0,d.Acl)("dataCount"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectId")),o(3,(0,r.Param)("tableName")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String]),s("design:returntype",Promise)],u.prototype,"dataCount",null),n([(0,r.Post)("/nc/:projectId/api/v1/:tableName"),(0,r.HttpCode)(200),(0,d.Acl)("dataInsert"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectId")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,Object]),s("design:returntype",Promise)],u.prototype,"dataInsert",null),n([(0,r.Get)("/nc/:projectId/api/v1/:tableName/:rowId"),(0,d.Acl)("dataRead"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectId")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,String]),s("design:returntype",Promise)],u.prototype,"dataRead",null),n([(0,r.Patch)("/nc/:projectId/api/v1/:tableName/:rowId"),(0,d.Acl)("dataUpdate"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectId")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,String]),s("design:returntype",Promise)],u.prototype,"dataUpdate",null),n([(0,r.Delete)("/nc/:projectId/api/v1/:tableName/:rowId"),(0,d.Acl)("dataDelete"),o(0,(0,r.Request)()),o(1,(0,r.Response)()),o(2,(0,r.Param)("projectId")),o(3,(0,r.Param)("tableName")),o(4,(0,r.Param)("rowId")),s("design:type",Function),s("design:paramtypes",[Object,Object,String,String,String]),s("design:returntype",Promise)],u.prototype,"dataDelete",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(c.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==l.OldDatasService&&l.OldDatasService)?i:Object])],u),t.OldDatasController=u},22443:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OldDatasService=void 0;const s=a(26481),o=a(87049),r=n(a(89103)),l=a(51401),c=a(15147),d=n(a(19356));let u=class{async dataList(e){const{model:t,view:a}=await this.getViewAndModelFromRequest(e),i=await c.Base.get(t.base_id),n=await c.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await d.default.get(i)}),{ast:s}=await(0,r.default)({query:e.query,model:t,view:a}),l=Object.assign({},e.query);try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}try{l.sortArr=JSON.parse(l.sortArrJson)}catch(e){}return await(0,o.nocoExecute)(s,await n.list(l),{},l)}async dataCount(e){const{model:t,view:a}=await this.getViewAndModelFromRequest(e),i=await c.Base.get(t.base_id),n=await c.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await d.default.get(i)}),s=Object.assign({},e.query);try{s.filterArr=JSON.parse(s.filterArrJson)}catch(e){}return await n.count(s)}async dataInsert(e){const{model:t,view:a}=await this.getViewAndModelFromRequest(e),i=await c.Base.get(t.base_id),n=await c.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await d.default.get(i)});return await n.insert(e.body,null,e.cookie)}async dataRead(e){const{model:t,view:a}=await this.getViewAndModelFromRequest(e),i=await c.Base.get(t.base_id),n=await c.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await d.default.get(i)}),{ast:s}=await(0,r.default)({query:e.query,model:t,view:a});return await(0,o.nocoExecute)(s,await n.readByPk(e.rowId),{},{})}async dataUpdate(e){const{model:t,view:a}=await this.getViewAndModelFromRequest(e),i=await c.Base.get(t.base_id),n=await c.Model.getBaseModelSQL({id:t.id,viewId:a.id,dbDriver:await d.default.get(i)});return await n.updateByPk(e.rowId,e.body,null,e.cookie)}async dataDelete(e){const{model:t,view:a}=await this.getViewAndModelFromRequest(e),i=await c.Base.get(t.base_id),n=await c.Model.getBaseModelSQL({id:t.id,viewId:a.id,dbDriver:await d.default.get(i)});return await n.delByPk(e.rowId,null,e.cookie)}async getViewAndModelFromRequest(e){const t=await c.Project.getWithInfo(e.params.projectId),a=await c.Model.getByAliasOrId({project_id:t.id,aliasOrId:e.params.tableName}),i=e.params.viewName&&await c.View.getByTitleOrId({titleOrId:e.params.viewName,fk_model_id:a.id});return a||l.NcError.notFound("Table not found"),{model:a,view:i}}};u=i([(0,s.Injectable)()],u),t.OldDatasService=u},23858:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgLcenseController=void 0;const r=a(26481),l=a(68281),c=a(66310),d=a(73451),u=a(68382);let p=class{constructor(e){this.orgLcenseService=e}async licenseGet(){return await this.orgLcenseService.licenseGet()}async licenseSet(e){return await this.orgLcenseService.licenseSet({key:e.key}),{msg:"The license key has been saved"}}};n([(0,r.Get)("/api/v1/license"),(0,u.Acl)("licenseGet",{scope:"org",allowedRoles:[l.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],p.prototype,"licenseGet",null),n([(0,r.Post)("/api/v1/license"),(0,r.HttpCode)(200),(0,u.Acl)("licenseSet",{scope:"org",allowedRoles:[l.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),o(0,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],p.prototype,"licenseSet",null),p=n([(0,r.Controller)(),(0,r.UseGuards)(c.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==d.OrgLcenseService&&d.OrgLcenseService)?i:Object])],p),t.OrgLcenseController=p},78609:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgTokensController=void 0;const c=a(26481),d=a(68281),u=a(24340),p=a(94135),m=a(57909),f=a(7950),h=a(68382);let g=class{constructor(e,t){this.orgTokensService=e,this.orgTokensEeService=t}async apiTokenList(e){return await(0,p.getConditionalHandler)(this.orgTokensService.apiTokenList,this.orgTokensEeService.apiTokenListEE)({query:e.query,user:e.user})}async apiTokenCreate(e,t){return await this.orgTokensService.apiTokenCreate({apiToken:t,user:e.user})}async apiTokenDelete(e,t){await this.orgTokensService.apiTokenDelete({token:t,user:e.user})}};o([(0,c.Get)("/api/v1/tokens"),(0,h.Acl)("apiTokenList",{scope:"org",blockApiTokenAccess:!0}),l(0,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],g.prototype,"apiTokenList",null),o([(0,c.Post)("/api/v1/tokens"),(0,c.HttpCode)(200),(0,h.Acl)("apiTokenCreate",{scope:"org",blockApiTokenAccess:!0}),l(0,(0,c.Request)()),l(1,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[Object,"function"==typeof(s=void 0!==d.ApiTokenReqType&&d.ApiTokenReqType)?s:Object]),r("design:returntype",Promise)],g.prototype,"apiTokenCreate",null),o([(0,c.Delete)("/api/v1/tokens/:token"),(0,h.Acl)("apiTokenDelete",{scope:"org",blockApiTokenAccess:!0}),l(0,(0,c.Request)()),l(1,(0,c.Param)("token")),r("design:type",Function),r("design:paramtypes",[Object,String]),r("design:returntype",Promise)],g.prototype,"apiTokenDelete",null),g=o([(0,c.UseGuards)((0,u.AuthGuard)("jwt")),(0,c.Controller)(),r("design:paramtypes",["function"==typeof(i=void 0!==f.OrgTokensService&&f.OrgTokensService)?i:Object,"function"==typeof(n=void 0!==m.OrgTokensEeService&&m.OrgTokensEeService)?n:Object])],g),t.OrgTokensController=g},90313:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgUsersController=void 0;const c=a(26481),d=a(68281),u=a(66310),p=a(60498),m=a(23481),f=a(15147),h=a(68382);let g=class{constructor(e){this.orgUsersService=e}async userList(e){return new p.PagedResponseImpl(await this.orgUsersService.userList({query:e.query}),Object.assign(Object.assign({},e.query),{count:await f.User.count(e.query)}))}async userUpdate(e,t){return await this.orgUsersService.userUpdate({user:e,userId:t})}async userDelete(e){return await this.orgUsersService.userDelete({userId:e}),{msg:"The user has been deleted successfully"}}async userAdd(e,t){return await this.orgUsersService.userAdd({user:t.body,req:t})}async userSettings(e){return await this.orgUsersService.userSettings(e),{}}async userInviteResend(e,t){return await this.orgUsersService.userInviteResend({userId:t,req:e}),{msg:"The invitation has been sent to the user"}}async generateResetUrl(e,t){return await this.orgUsersService.generateResetUrl({siteUrl:e.ncSiteUrl,userId:t})}async appSettingsGet(){return await this.orgUsersService.appSettingsGet()}async appSettingsSet(e){return await this.orgUsersService.appSettingsSet({settings:e}),{msg:"The app settings have been saved"}}};o([(0,c.Get)("/api/v1/users"),(0,h.Acl)("userList",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],g.prototype,"userList",null),o([(0,c.Patch)("/api/v1/users/:userId"),(0,h.Acl)("userUpdate",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Body)()),l(1,(0,c.Param)("userId")),r("design:type",Function),r("design:paramtypes",[Object,String]),r("design:returntype",Promise)],g.prototype,"userUpdate",null),o([(0,c.Delete)("/api/v1/users/:userId"),(0,h.Acl)("userDelete",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Param)("userId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],g.prototype,"userDelete",null),o([(0,c.Post)("/api/v1/users"),(0,c.HttpCode)(200),(0,h.Acl)("userAdd",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Body)()),l(1,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[Object,Object]),r("design:returntype",Promise)],g.prototype,"userAdd",null),o([(0,c.Post)("/api/v1/users/settings"),(0,c.HttpCode)(200),(0,h.Acl)("userSettings",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype","function"==typeof(n="undefined"!=typeof Promise&&Promise)?n:Object)],g.prototype,"userSettings",null),o([(0,c.Post)("/api/v1/users/:userId/resend-invite"),(0,c.HttpCode)(200),(0,h.Acl)("userInviteResend",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Request)()),l(1,(0,c.Param)("userId")),r("design:type",Function),r("design:paramtypes",[Object,String]),r("design:returntype","function"==typeof(s="undefined"!=typeof Promise&&Promise)?s:Object)],g.prototype,"userInviteResend",null),o([(0,c.Post)("/api/v1/users/:userId/generate-reset-url"),(0,c.HttpCode)(200),(0,h.Acl)("generateResetUrl",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Request)()),l(1,(0,c.Param)("userId")),r("design:type",Function),r("design:paramtypes",[Object,String]),r("design:returntype",Promise)],g.prototype,"generateResetUrl",null),o([(0,c.Get)("/api/v1/app-settings"),(0,h.Acl)("appSettingsGet",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",Promise)],g.prototype,"appSettingsGet",null),o([(0,c.Post)("/api/v1/app-settings"),(0,c.HttpCode)(200),(0,h.Acl)("appSettingsSet",{scope:"org",allowedRoles:[d.OrgUserRoles.SUPER_ADMIN],blockApiTokenAccess:!0}),l(0,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[Object]),r("design:returntype",Promise)],g.prototype,"appSettingsSet",null),g=o([(0,c.Controller)(),(0,c.UseGuards)(u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==m.OrgUsersService&&m.OrgUsersService)?i:Object])],g),t.OrgUsersController=g},46202:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginsController=void 0;const r=a(26481),l=a(66310),c=a(60498),d=a(59540),u=a(68382);let p=class{constructor(e){this.pluginsService=e}async pluginList(){return new c.PagedResponseImpl(await this.pluginsService.pluginList())}async webhookPluginList(){return new c.PagedResponseImpl(await this.pluginsService.webhookPluginList())}async pluginTest(e){return await this.pluginsService.pluginTest({body:e})}async pluginRead(e){return await this.pluginsService.pluginRead({pluginId:e})}async pluginUpdate(e,t){return await this.pluginsService.pluginUpdate({pluginId:t,plugin:e})}async isPluginActive(e){return await this.pluginsService.isPluginActive({pluginTitle:e})}};n([(0,r.Get)("/api/v1/db/meta/plugins"),(0,u.Acl)("pluginList",{scope:"org"}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],p.prototype,"pluginList",null),n([(0,r.Get)("/api/v1/db/meta/plugins/webhook"),(0,u.Acl)("webhookPluginList",{scope:"org"}),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],p.prototype,"webhookPluginList",null),n([(0,r.Post)("/api/v1/db/meta/plugins/test"),(0,r.HttpCode)(200),(0,u.Acl)("pluginTest",{scope:"org"}),o(0,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],p.prototype,"pluginTest",null),n([(0,r.Get)("/api/v1/db/meta/plugins/:pluginId"),(0,u.Acl)("pluginRead",{scope:"org"}),o(0,(0,r.Param)("pluginId")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],p.prototype,"pluginRead",null),n([(0,r.Patch)("/api/v1/db/meta/plugins/:pluginId"),(0,u.Acl)("pluginUpdate",{scope:"org"}),o(0,(0,r.Body)()),o(1,(0,r.Param)("pluginId")),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],p.prototype,"pluginUpdate",null),n([(0,r.Get)("/api/v1/db/meta/plugins/:pluginTitle/status"),(0,u.Acl)("isPluginActive",{scope:"org"}),o(0,(0,r.Param)("pluginTitle")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],p.prototype,"isPluginActive",null),p=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==d.PluginsService&&d.PluginsService)?i:Object])],p),t.PluginsController=p},52392:function(e,t,a){var i,n,s,o,r,l,c,d,u,p=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectUsersController=void 0;const h=a(26481),g=a(68281),_=a(66310),b=a(95524),y=a(51401),w=a(68382);let v=class{constructor(e){this.projectUsersService=e}async userList(e,t){return{users:await this.projectUsersService.userList({projectId:e,query:t.query})}}async userInvite(e,t,a){return a.email||y.NcError.badRequest("Email is required"),await this.projectUsersService.userInvite({projectId:e,projectUser:a,req:t})}async projectUserUpdate(e,t,a,i){return await this.projectUsersService.projectUserUpdate({projectUser:i,projectId:e,userId:t,req:a}),{msg:"The user has been updated successfully"}}async projectUserDelete(e,t,a){return await this.projectUsersService.projectUserDelete({projectId:e,userId:t,req:a}),{msg:"The user has been deleted successfully"}}async projectUserInviteResend(e,t,a,i){return await this.projectUsersService.projectUserInviteResend({projectId:e,userId:t,projectUser:i,req:a}),{msg:"The invitation has been sent to the user"}}async projectUserMetaUpdate(e,t,a){return await this.projectUsersService.projectUserMetaUpdate({projectId:e,body:a,user:t.user})}};p([(0,h.Get)("/api/v1/db/meta/projects/:projectId/users"),(0,w.Acl)("userList"),f(0,(0,h.Param)("projectId")),f(1,(0,h.Request)()),m("design:type",Function),m("design:paramtypes",[String,Object]),m("design:returntype",Promise)],v.prototype,"userList",null),p([(0,h.Post)("/api/v1/db/meta/projects/:projectId/users"),(0,h.HttpCode)(200),(0,w.Acl)("userInvite"),f(0,(0,h.Param)("projectId")),f(1,(0,h.Request)()),f(2,(0,h.Body)()),m("design:type",Function),m("design:paramtypes",[String,Object,"function"==typeof(n=void 0!==g.ProjectUserReqType&&g.ProjectUserReqType)?n:Object]),m("design:returntype","function"==typeof(s="undefined"!=typeof Promise&&Promise)?s:Object)],v.prototype,"userInvite",null),p([(0,h.Patch)("/api/v1/db/meta/projects/:projectId/users/:userId"),(0,w.Acl)("projectUserUpdate"),f(0,(0,h.Param)("projectId")),f(1,(0,h.Param)("userId")),f(2,(0,h.Request)()),f(3,(0,h.Body)()),m("design:type",Function),m("design:paramtypes",[String,String,Object,Object]),m("design:returntype","function"==typeof(o="undefined"!=typeof Promise&&Promise)?o:Object)],v.prototype,"projectUserUpdate",null),p([(0,h.Delete)("/api/v1/db/meta/projects/:projectId/users/:userId"),(0,w.Acl)("projectUserDelete"),f(0,(0,h.Param)("projectId")),f(1,(0,h.Param)("userId")),f(2,(0,h.Request)()),m("design:type",Function),m("design:paramtypes",[String,String,Object]),m("design:returntype","function"==typeof(r="undefined"!=typeof Promise&&Promise)?r:Object)],v.prototype,"projectUserDelete",null),p([(0,h.Post)("/api/v1/db/meta/projects/:projectId/users/:userId/resend-invite"),(0,h.HttpCode)(200),(0,w.Acl)("projectUserInviteResend"),f(0,(0,h.Param)("projectId")),f(1,(0,h.Param)("userId")),f(2,(0,h.Request)()),f(3,(0,h.Body)()),m("design:type",Function),m("design:paramtypes",[String,String,Object,"function"==typeof(l=void 0!==g.ProjectUserReqType&&g.ProjectUserReqType)?l:Object]),m("design:returntype","function"==typeof(c="undefined"!=typeof Promise&&Promise)?c:Object)],v.prototype,"projectUserInviteResend",null),p([(0,h.Patch)("/api/v1/db/meta/projects/:projectId/user"),(0,w.Acl)("projectUserMetaUpdate"),f(0,(0,h.Param)("projectId")),f(1,(0,h.Request)()),f(2,(0,h.Body)()),m("design:type",Function),m("design:paramtypes",[String,Object,"function"==typeof(d=void 0!==g.ProjectUserReqType&&g.ProjectUserReqType)?d:Object]),m("design:returntype","function"==typeof(u="undefined"!=typeof Promise&&Promise)?u:Object)],v.prototype,"projectUserMetaUpdate",null),v=p([(0,h.UseGuards)(_.GlobalGuard),(0,h.Controller)(),m("design:paramtypes",["function"==typeof(i=void 0!==b.ProjectUsersService&&b.ProjectUsersService)?i:Object])],v),t.ProjectUsersController=v},76691:function(e,t,a){var i,n,s,o,r=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectsController=void 0;const u=a(26481),p=d(a(71363)),m=a(68281),f=a(66310),h=a(60498),g=d(a(27552)),_=a(67478),b=a(36701),y=a(68382),w=a(15147);let v=class{constructor(e){this.projectsService=e}async list(e,t){const a=await this.projectsService.projectList({user:t.user,query:e});return new h.PagedResponseImpl(a,{count:a.length,limit:a.length})}async projectInfoGet(){var e,t,a;return{Node:process.version,Arch:process.arch,Platform:process.platform,Docker:(0,p.default)(),RootDB:null===(a=null===(t=null===(e=g.default.getConfig())||void 0===e?void 0:e.meta)||void 0===t?void 0:t.db)||void 0===a?void 0:a.client,PackageVersion:_.packageVersion}}async projectGet(e){const t=await this.projectsService.getProjectWithInfo({projectId:e});return this.projectsService.sanitizeProject(t),t}async projectUpdate(e,t,a){return await this.projectsService.projectUpdate({projectId:e,project:t,user:a.user})}async projectDelete(e,t){return await this.projectsService.projectSoftDelete({projectId:e,user:t.user})}async projectCreate(e,t){return await this.projectsService.projectCreate({project:e,user:t.user})}async hasEmptyOrNullFilters(e){return await w.Filter.hasEmptyOrNullFilters(e)}};r([(0,y.Acl)("projectList",{scope:"org"}),(0,u.Get)("/api/v1/db/meta/projects/"),c(0,(0,u.Query)()),c(1,(0,u.Request)()),l("design:type",Function),l("design:paramtypes",["function"==typeof(n="undefined"!=typeof Record&&Record)?n:Object,Object]),l("design:returntype",Promise)],v.prototype,"list",null),r([(0,y.Acl)("projectInfoGet"),(0,u.Get)("/api/v1/db/meta/projects/:projectId/info"),l("design:type",Function),l("design:paramtypes",[]),l("design:returntype",Promise)],v.prototype,"projectInfoGet",null),r([(0,y.Acl)("projectGet"),(0,u.Get)("/api/v1/db/meta/projects/:projectId"),c(0,(0,u.Param)("projectId")),l("design:type",Function),l("design:paramtypes",[String]),l("design:returntype",Promise)],v.prototype,"projectGet",null),r([(0,y.Acl)("projectUpdate"),(0,u.Patch)("/api/v1/db/meta/projects/:projectId"),c(0,(0,u.Param)("projectId")),c(1,(0,u.Body)()),c(2,(0,u.Request)()),l("design:type",Function),l("design:paramtypes",[String,"function"==typeof(s="undefined"!=typeof Record&&Record)?s:Object,Object]),l("design:returntype",Promise)],v.prototype,"projectUpdate",null),r([(0,y.Acl)("projectDelete"),(0,u.Delete)("/api/v1/db/meta/projects/:projectId"),c(0,(0,u.Param)("projectId")),c(1,(0,u.Request)()),l("design:type",Function),l("design:paramtypes",[String,Object]),l("design:returntype",Promise)],v.prototype,"projectDelete",null),r([(0,y.Acl)("projectCreate",{scope:"org"}),(0,u.Post)("/api/v1/db/meta/projects"),(0,u.HttpCode)(200),c(0,(0,u.Body)()),c(1,(0,u.Request)()),l("design:type",Function),l("design:paramtypes",["function"==typeof(o=void 0!==m.ProjectReqType&&m.ProjectReqType)?o:Object,Object]),l("design:returntype",Promise)],v.prototype,"projectCreate",null),r([(0,y.Acl)("hasEmptyOrNullFilters"),(0,u.Get)("/api/v1/db/meta/projects/:projectId/has-empty-or-null-filters"),c(0,(0,u.Param)("projectId")),l("design:type",Function),l("design:paramtypes",[String]),l("design:returntype",Promise)],v.prototype,"hasEmptyOrNullFilters",null),v=r([(0,u.UseGuards)(f.GlobalGuard),(0,u.Controller)(),l("design:paramtypes",["function"==typeof(i=void 0!==b.ProjectsService&&b.ProjectsService)?i:Object])],v),t.ProjectsController=v},2389:function(e,t,a){var i,n=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return s(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicDatasExportController=void 0;const u=a(26481),p=a(68281),m=r(a(6302)),f=a(87049),h=d(a(57153)),g=a(51401),_=d(a(89103)),b=a(7214),y=a(35531),w=d(a(19356)),v=a(15147);let T=class{constructor(e){this.publicDatasExportService=e}async exportExcel(e,t,a){var i;const n=await v.View.getByUUID(a);n||g.NcError.notFound("Not found"),n.type!==p.ViewTypes.GRID&&n.type!==p.ViewTypes.KANBAN&&n.type!==p.ViewTypes.GALLERY&&n.type!==p.ViewTypes.MAP&&g.NcError.notFound("Not found"),n.password&&n.password!==(null===(i=e.headers)||void 0===i?void 0:i["xc-password"])&&g.NcError.forbidden(p.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);const s=await n.getModelWithInfo();await n.getColumns();const{offset:o,dbRows:r,elapsed:l}=await this.getDbRows(s,n,e),c=e.query.fields,d=m.utils.json_to_sheet(r.map((e=>Object.fromEntries(c.map((t=>[t,e[t]]))))),{header:c}),u=m.utils.book_new();m.utils.book_append_sheet(u,d,n.title);const f=m.write(u,{type:"base64",bookType:"xlsx"});t.set({"Access-Control-Expose-Headers":"nc-export-offset","nc-export-offset":o,"nc-export-elapsed-time":l,"Content-Disposition":`attachment; filename="${encodeURI(n.title)}-export.xlsx"`}),t.end(f)}async exportCsv(e,t){var a;const i=await v.View.getByUUID(e.params.publicDataUuid),n=e.query.fields;i||g.NcError.notFound("Not found"),i.type!==p.ViewTypes.GRID&&i.type!==p.ViewTypes.KANBAN&&i.type!==p.ViewTypes.GALLERY&&i.type!==p.ViewTypes.MAP&&g.NcError.notFound("Not found"),i.password&&i.password!==(null===(a=e.headers)||void 0===a?void 0:a["xc-password"])&&g.NcError.forbidden(p.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);const s=await i.getModelWithInfo();await i.getColumns();const{offset:o,dbRows:r,elapsed:l}=await this.getDbRows(s,i,e),c=h.default.unparse({fields:s.columns.sort(((e,t)=>Array.isArray(n)?n.indexOf(e.title)-n.indexOf(t.title):0)).filter((e=>!n||!Array.isArray(n)||n.includes(e.title))).map((e=>e.title)),data:r},{escapeFormulae:!0});t.set({"Access-Control-Expose-Headers":"nc-export-offset","nc-export-offset":o,"nc-export-elapsed-time":l,"Content-Disposition":`attachment; filename="${encodeURI(i.title)}-export.csv"`}),t.send(c)}async getDbRows(e,t,a){t.model.columns=t.columns.filter((e=>e.show)).map((e=>new v.Column(Object.assign(Object.assign({},e),t.model.columnsById[e.fk_column_id])))).filter((e=>!(0,p.isSystemColumn)(e)||t.show_system_fields)),e||g.NcError.notFound("Table not found");const i=Object.assign({},a.query);try{i.filterArr=JSON.parse(i.filterArrJson)}catch(e){}try{i.sortArr=JSON.parse(i.sortArrJson)}catch(e){}const n=await v.Base.get(e.base_id),s=await v.Model.getBaseModelSQL({id:e.id,viewId:null==t?void 0:t.id,dbDriver:await w.default.get(n)}),{ast:o}=await(0,_.default)({query:a.query,model:e,view:t,includePkByDefault:!1});let r=+a.query.offset||0;const l=+process.env.NC_EXPORT_MAX_TIMEOUT||5e3,c=[],d=process.hrtime();let u,m;for(u=0;u<l;r+=100,m=process.hrtime(d),u=1e3*m[0]+m[1]/1e6){const e=await(0,f.nocoExecute)(o,await s.list(Object.assign(Object.assign({},i),{offset:r,limit:100})),{},i);if(!(null==e?void 0:e.length)){r=-1;break}for(const i of e){const e=Object.assign({},i);for(const n of t.model.columns)e[n.title]=await(0,b.serializeCellValue)({value:i[n.title],column:n,siteUrl:a.ncSiteUrl});c.push(e)}}return{offset:r,dbRows:c,elapsed:u}}async serializeCellValue({value:e,column:t,ncSiteUrl:a}){if(!t)return e;if(!e)return e;switch(null==t?void 0:t.uidt){case p.UITypes.Attachment:{let t=e;try{"string"==typeof e&&(t=JSON.parse(e))}catch(e){}return(t||[]).map((e=>`${encodeURI(e.title)}(${encodeURI(e.url)})`))}case p.UITypes.Lookup:{const i=await t.getColOptions(),n=await i.getLookupColumn();return(await Promise.all([...Array.isArray(e)?e:[e]].map((async e=>(0,b.serializeCellValue)({value:e,column:n,siteUrl:a}))))).join(", ")}case p.UITypes.LinkToAnotherRecord:{const a=await t.getColOptions(),i=await a.getRelatedTable();return await i.getColumns(),[...Array.isArray(e)?e:[e]].map((e=>{var t;return e[null===(t=i.displayValue)||void 0===t?void 0:t.title]})).join(", ")}default:return e&&"object"==typeof e?JSON.stringify(e):e}}};o([(0,u.Get)("/api/v1/db/public/shared-view/:publicDataUuid/rows/export/excel"),c(0,(0,u.Request)()),c(1,(0,u.Response)()),c(2,(0,u.Param)("publicDataUuid")),l("design:type",Function),l("design:paramtypes",[Object,Object,String]),l("design:returntype",Promise)],T.prototype,"exportExcel",null),o([(0,u.Get)("/api/v1/db/public/shared-view/:publicDataUuid/rows/export/csv"),c(0,(0,u.Request)()),c(1,(0,u.Response)()),l("design:type",Function),l("design:paramtypes",[Object,Object]),l("design:returntype",Promise)],T.prototype,"exportCsv",null),T=o([(0,u.Controller)(),l("design:paramtypes",["function"==typeof(i=void 0!==y.PublicDatasExportService&&y.PublicDatasExportService)?i:Object])],T),t.PublicDatasExportController=T},84530:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicDatasController=void 0;const r=a(26481),l=a(36188),c=a(75885);let d=class{constructor(e){this.publicDatasService=e}async dataList(e,t){var a;return await this.publicDatasService.dataList({query:e.query,password:null===(a=e.headers)||void 0===a?void 0:a["xc-password"],sharedViewUuid:t})}async dataGroupBy(e,t){var a;return await this.publicDatasService.dataGroupBy({query:e.query,password:null===(a=e.headers)||void 0===a?void 0:a["xc-password"],sharedViewUuid:t})}async groupedDataList(e,t,a){var i;return await this.publicDatasService.groupedDataList({query:e.query,password:null===(i=e.headers)||void 0===i?void 0:i["xc-password"],sharedViewUuid:t,groupColumnId:a})}async dataInsert(e,t){var a,i;return await this.publicDatasService.dataInsert({sharedViewUuid:t,password:null===(a=e.headers)||void 0===a?void 0:a["xc-password"],body:null===(i=e.body)||void 0===i?void 0:i.data,siteUrl:e.ncSiteUrl,files:e.files})}async relDataList(e,t,a){var i;return await this.publicDatasService.relDataList({query:e.query,password:null===(i=e.headers)||void 0===i?void 0:i["xc-password"],sharedViewUuid:t,columnId:a})}async publicMmList(e,t,a,i){var n;return await this.publicDatasService.publicMmList({query:e.query,password:null===(n=e.headers)||void 0===n?void 0:n["xc-password"],sharedViewUuid:t,columnId:i,rowId:a})}async publicHmList(e,t,a,i){var n;return await this.publicDatasService.publicHmList({query:e.query,password:null===(n=e.headers)||void 0===n?void 0:n["xc-password"],sharedViewUuid:t,columnId:i,rowId:a})}};n([(0,r.Get)("/api/v1/db/public/shared-view/:sharedViewUuid/rows"),o(0,(0,r.Request)()),o(1,(0,r.Param)("sharedViewUuid")),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],d.prototype,"dataList",null),n([(0,r.Get)("/api/v1/db/public/shared-view/:sharedViewUuid/groupby"),o(0,(0,r.Request)()),o(1,(0,r.Param)("sharedViewUuid")),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],d.prototype,"dataGroupBy",null),n([(0,r.Get)("/api/v1/db/public/shared-view/:sharedViewUuid/group/:columnId"),o(0,(0,r.Request)()),o(1,(0,r.Param)("sharedViewUuid")),o(2,(0,r.Param)("columnId")),s("design:type",Function),s("design:paramtypes",[Object,String,String]),s("design:returntype",Promise)],d.prototype,"groupedDataList",null),n([(0,r.Post)("/api/v1/db/public/shared-view/:sharedViewUuid/rows"),(0,r.HttpCode)(200),(0,r.UseInterceptors)((0,l.AnyFilesInterceptor)()),o(0,(0,r.Request)()),o(1,(0,r.Param)("sharedViewUuid")),s("design:type",Function),s("design:paramtypes",[Object,String]),s("design:returntype",Promise)],d.prototype,"dataInsert",null),n([(0,r.Get)("/api/v1/db/public/shared-view/:sharedViewUuid/nested/:columnId"),o(0,(0,r.Request)()),o(1,(0,r.Param)("sharedViewUuid")),o(2,(0,r.Param)("columnId")),s("design:type",Function),s("design:paramtypes",[Object,String,String]),s("design:returntype",Promise)],d.prototype,"relDataList",null),n([(0,r.Get)("/api/v1/db/public/shared-view/:sharedViewUuid/rows/:rowId/mm/:columnId"),o(0,(0,r.Request)()),o(1,(0,r.Param)("sharedViewUuid")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("columnId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],d.prototype,"publicMmList",null),n([(0,r.Get)("/api/v1/db/public/shared-view/:sharedViewUuid/rows/:rowId/hm/:columnId"),o(0,(0,r.Request)()),o(1,(0,r.Param)("sharedViewUuid")),o(2,(0,r.Param)("rowId")),o(3,(0,r.Param)("columnId")),s("design:type",Function),s("design:paramtypes",[Object,String,String,String]),s("design:returntype",Promise)],d.prototype,"publicHmList",null),d=n([(0,r.Controller)(),s("design:paramtypes",["function"==typeof(i=void 0!==c.PublicDatasService&&c.PublicDatasService)?i:Object])],d),t.PublicDatasController=d},2465:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicMetasController=void 0;const l=a(26481),c=a(47258);let d=class{constructor(e){this.publicMetasService=e}async viewMetaGet(e,t){var a;return await this.publicMetasService.viewMetaGet({password:null===(a=e.headers)||void 0===a?void 0:a["xc-password"],sharedViewUuid:t})}async publicSharedBaseGet(e){return await this.publicMetasService.publicSharedBaseGet({sharedBaseUuid:e})}};s([(0,l.Get)("/api/v1/db/public/shared-view/:sharedViewUuid/meta"),r(0,(0,l.Request)()),r(1,(0,l.Param)("sharedViewUuid")),o("design:type",Function),o("design:paramtypes",[Object,String]),o("design:returntype",Promise)],d.prototype,"viewMetaGet",null),s([(0,l.Get)("/api/v1/db/public/shared-base/:sharedBaseUuid/meta"),r(0,(0,l.Param)("sharedBaseUuid")),o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype","function"==typeof(n="undefined"!=typeof Promise&&Promise)?n:Object)],d.prototype,"publicSharedBaseGet",null),d=s([(0,l.Controller)(),o("design:paramtypes",["function"==typeof(i=void 0!==c.PublicMetasService&&c.PublicMetasService)?i:Object])],d),t.PublicMetasController=d},28332:function(e,t,a){var i,n,s,o,r,l=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SharedBasesController=void 0;const u=a(26481),p=a(66310),m=a(27744),f=a(68382);let h=class{constructor(e){this.sharedBasesService=e}async createSharedBaseLink(e,t,a){return await this.sharedBasesService.createSharedBaseLink({projectId:a,roles:null==t?void 0:t.roles,password:null==t?void 0:t.password,siteUrl:e.ncSiteUrl})}async updateSharedBaseLink(e,t,a){return await this.sharedBasesService.updateSharedBaseLink({projectId:a,roles:null==t?void 0:t.roles,password:null==t?void 0:t.password,siteUrl:e.ncSiteUrl})}async disableSharedBaseLink(e){return await this.sharedBasesService.disableSharedBaseLink({projectId:e})}async getSharedBaseLink(e,t){return await this.sharedBasesService.getSharedBaseLink({projectId:t,siteUrl:e.ncSiteUrl})}};l([(0,u.Post)("/api/v1/db/meta/projects/:projectId/shared"),(0,u.HttpCode)(200),(0,f.Acl)("createSharedBaseLink"),d(0,(0,u.Request)()),d(1,(0,u.Body)()),d(2,(0,u.Param)("projectId")),c("design:type",Function),c("design:paramtypes",[Object,Object,String]),c("design:returntype","function"==typeof(n="undefined"!=typeof Promise&&Promise)?n:Object)],h.prototype,"createSharedBaseLink",null),l([(0,u.Patch)("/api/v1/db/meta/projects/:projectId/shared"),(0,f.Acl)("updateSharedBaseLink"),d(0,(0,u.Request)()),d(1,(0,u.Body)()),d(2,(0,u.Param)("projectId")),c("design:type",Function),c("design:paramtypes",[Object,Object,String]),c("design:returntype","function"==typeof(s="undefined"!=typeof Promise&&Promise)?s:Object)],h.prototype,"updateSharedBaseLink",null),l([(0,u.Delete)("/api/v1/db/meta/projects/:projectId/shared"),(0,f.Acl)("disableSharedBaseLink"),d(0,(0,u.Param)("projectId")),c("design:type",Function),c("design:paramtypes",[String]),c("design:returntype","function"==typeof(o="undefined"!=typeof Promise&&Promise)?o:Object)],h.prototype,"disableSharedBaseLink",null),l([(0,u.Get)("/api/v1/db/meta/projects/:projectId/shared"),(0,f.Acl)("getSharedBaseLink"),d(0,(0,u.Request)()),d(1,(0,u.Param)("projectId")),c("design:type",Function),c("design:paramtypes",[Object,String]),c("design:returntype","function"==typeof(r="undefined"!=typeof Promise&&Promise)?r:Object)],h.prototype,"getSharedBaseLink",null),h=l([(0,u.Controller)(),(0,u.UseGuards)(p.GlobalGuard),c("design:paramtypes",["function"==typeof(i=void 0!==m.SharedBasesService&&m.SharedBasesService)?i:Object])],h),t.SharedBasesController=h},85370:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SortsController=void 0;const c=a(26481),d=a(68281),u=a(66310),p=a(60498),m=a(40330),f=a(68382);let h=class{constructor(e){this.sortsService=e}async sortList(e){return new p.PagedResponseImpl(await this.sortsService.sortList({viewId:e}))}async sortCreate(e,t,a){return await this.sortsService.sortCreate({sort:t,viewId:e})}async sortGet(e){return await this.sortsService.sortGet({sortId:e})}async sortUpdate(e,t,a){return await this.sortsService.sortUpdate({sortId:e,sort:t})}async sortDelete(e,t){return await this.sortsService.sortDelete({sortId:e})}};o([(0,c.Get)("/api/v1/db/meta/views/:viewId/sorts/"),(0,f.Acl)("sortList"),l(0,(0,c.Param)("viewId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],h.prototype,"sortList",null),o([(0,c.Post)("/api/v1/db/meta/views/:viewId/sorts/"),(0,c.HttpCode)(200),(0,f.Acl)("sortCreate"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Body)()),l(2,(0,c.Req)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(n=void 0!==d.SortReqType&&d.SortReqType)?n:Object,Object]),r("design:returntype",Promise)],h.prototype,"sortCreate",null),o([(0,c.Get)("/api/v1/db/meta/sorts/:sortId"),(0,f.Acl)("sortGet"),l(0,(0,c.Param)("sortId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],h.prototype,"sortGet",null),o([(0,c.Patch)("/api/v1/db/meta/sorts/:sortId"),(0,f.Acl)("sortUpdate"),l(0,(0,c.Param)("sortId")),l(1,(0,c.Body)()),l(2,(0,c.Req)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(s=void 0!==d.SortReqType&&d.SortReqType)?s:Object,Object]),r("design:returntype",Promise)],h.prototype,"sortUpdate",null),o([(0,c.Delete)("/api/v1/db/meta/sorts/:sortId"),(0,f.Acl)("sortDelete"),l(0,(0,c.Param)("sortId")),l(1,(0,c.Req)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"sortDelete",null),h=o([(0,c.Controller)(),(0,c.UseGuards)(u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==m.SortsService&&m.SortsService)?i:Object])],h),t.SortsController=h},88062:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncController=void 0;const r=a(26481),l=a(66310),c=a(94163),d=a(68382);let u=class{constructor(e){this.syncService=e}async syncSourceList(e,t){return await this.syncService.syncSourceList({projectId:e,baseId:t})}async syncCreate(e,t,a,i){return await this.syncService.syncCreate({projectId:e,baseId:i,userId:a.user.id,syncPayload:t})}async syncDelete(e){return await this.syncService.syncDelete({syncId:e})}async syncUpdate(e,t){return await this.syncService.syncUpdate({syncId:e,syncPayload:t})}};n([(0,r.Get)(["/api/v1/db/meta/projects/:projectId/syncs","/api/v1/db/meta/projects/:projectId/syncs/:baseId"]),(0,d.Acl)("syncSourceList"),o(0,(0,r.Param)("projectId")),o(1,(0,r.Param)("baseId")),s("design:type",Function),s("design:paramtypes",[String,String]),s("design:returntype",Promise)],u.prototype,"syncSourceList",null),n([(0,r.Post)(["/api/v1/db/meta/projects/:projectId/syncs","/api/v1/db/meta/projects/:projectId/syncs/:baseId"]),(0,r.HttpCode)(200),(0,d.Acl)("syncSourceCreate"),o(0,(0,r.Param)("projectId")),o(1,(0,r.Body)()),o(2,(0,r.Req)()),o(3,(0,r.Param)("baseId")),s("design:type",Function),s("design:paramtypes",[String,Object,Object,String]),s("design:returntype",Promise)],u.prototype,"syncCreate",null),n([(0,r.Delete)("/api/v1/db/meta/syncs/:syncId"),(0,d.Acl)("syncSourceDelete"),o(0,(0,r.Param)("syncId")),s("design:type",Function),s("design:paramtypes",[String]),s("design:returntype",Promise)],u.prototype,"syncDelete",null),n([(0,r.Patch)("/api/v1/db/meta/syncs/:syncId"),(0,d.Acl)("syncSourceUpdate"),o(0,(0,r.Param)("syncId")),o(1,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[String,Object]),s("design:returntype",Promise)],u.prototype,"syncUpdate",null),u=n([(0,r.Controller)(),(0,r.UseGuards)(l.GlobalGuard),s("design:paramtypes",["function"==typeof(i=void 0!==c.SyncService&&c.SyncService)?i:Object])],u),t.SyncController=u},15387:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TablesController=void 0;const c=a(26481),d=a(68281),u=a(66310),p=a(19316),m=a(68382),f=a(60498);let h=class{constructor(e){this.tablesService=e}async tableList(e,t,a,i){return new f.PagedResponseImpl(await this.tablesService.getAccessibleTables({projectId:e,baseId:t,includeM2M:"true"===a,roles:(0,d.extractRolesObj)(i.user.project_roles)}))}async tableCreate(e,t,a,i){return await this.tablesService.tableCreate({projectId:e,baseId:t,table:a,user:i.user})}async tableGet(e,t){return await this.tablesService.getTableWithAccessibleViews({tableId:t.params.tableId,user:t.user})}async tableUpdate(e,t,a){return await this.tablesService.tableUpdate({tableId:e,table:t,projectId:a.ncProjectId,user:a.ncProjectId}),{msg:"The table has been updated successfully"}}async tableDelete(e,t){return await this.tablesService.tableDelete({tableId:t.params.tableId,user:t.user,req:t})}async tableReorder(e,t){return this.tablesService.reorderTable({tableId:e,order:t.order})}};o([(0,c.Get)(["/api/v1/db/meta/projects/:projectId/tables","/api/v1/db/meta/projects/:projectId/:baseId/tables"]),(0,m.Acl)("tableList"),l(0,(0,c.Param)("projectId")),l(1,(0,c.Param)("baseId")),l(2,(0,c.Query)("includeM2M")),l(3,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,String,String,Object]),r("design:returntype",Promise)],h.prototype,"tableList",null),o([(0,c.Post)(["/api/v1/db/meta/projects/:projectId/tables","/api/v1/db/meta/projects/:projectId/:baseId/tables"]),(0,c.HttpCode)(200),(0,m.Acl)("tableCreate"),l(0,(0,c.Param)("projectId")),l(1,(0,c.Param)("baseId")),l(2,(0,c.Body)()),l(3,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,String,"function"==typeof(n=void 0!==d.TableReqType&&d.TableReqType)?n:Object,Object]),r("design:returntype",Promise)],h.prototype,"tableCreate",null),o([(0,c.Get)("/api/v1/db/meta/tables/:tableId"),(0,m.Acl)("tableGet"),l(0,(0,c.Param)("tableId")),l(1,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"tableGet",null),o([(0,c.Patch)("/api/v1/db/meta/tables/:tableId"),(0,m.Acl)("tableUpdate"),l(0,(0,c.Param)("tableId")),l(1,(0,c.Body)()),l(2,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(s=void 0!==d.TableReqType&&d.TableReqType)?s:Object,Object]),r("design:returntype",Promise)],h.prototype,"tableUpdate",null),o([(0,c.Delete)("/api/v1/db/meta/tables/:tableId"),(0,m.Acl)("tableDelete"),l(0,(0,c.Param)("tableId")),l(1,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"tableDelete",null),o([(0,c.Post)("/api/v1/db/meta/tables/:tableId/reorder"),(0,m.Acl)("tableReorder"),(0,c.HttpCode)(200),l(0,(0,c.Param)("tableId")),l(1,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"tableReorder",null),h=o([(0,c.Controller)(),(0,c.UseGuards)(u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==p.TablesService&&p.TablesService)?i:Object])],h),t.TablesController=h},72346:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TestResetService=void 0;const n=i(a(52167)),s=i(a(42058)),o=i(a(49500)),r=i(a(94944)),l=i(a(61770)),c=i(a(27552)),d=i(a(89604)),u=i(a(37912)),p=a(13609),m=i(a(11922)),f={},h={sqlite:"sampleREST",mysql:"externalREST",pg:"pgExtREST"};t.TestResetService=class{constructor({parallelId:e,dbType:t,isEmptyProject:a,workerId:i}){this.removeProjectUsersFromCache=async e=>{const t=await m.default.getUsersList({project_id:e.id,limit:1e3,offset:0});for(const a of t)try{const t=await d.default.get(a.id);await u.default.del(`${p.CacheScope.PROJECT_USER}:${e.id}:${t.id}`)}catch(e){console.error("removeProjectUsersFromCache",e)}},this.parallelId=e,this.dbType=t,this.isEmptyProject=a,this.workerId=i}async process(){try{for(;"processing"===f[this.parallelId];)console.log(`waiting for previous worker to finish parrelelId:${this.parallelId}`),await new Promise((e=>setTimeout(e,1e3)));f[this.parallelId]="processing";const e=await(async()=>(await n.default.post("http://localhost:8080/api/v1/auth/user/signin",{email:"user@nocodb.com",password:"Password123."})).data.token)(),{project:t}=await this.resetProject({token:e,dbType:this.dbType,parallelId:this.parallelId,workerId:this.workerId});try{await g(this.parallelId),await _(this.parallelId),await b(this.parallelId)}catch(e){console.log(`Error in cleaning up project: ${this.parallelId}`,e)}return f[this.parallelId]="completed",{token:e,project:t}}catch(e){return console.error("TestResetService:process",e),f[this.parallelId]="errored",{error:e}}}async resetProject({token:e,dbType:t,parallelId:a,workerId:i}){const n=`${h[t]}${a}`,c=await l.default.getByTitle(n);return c&&(await this.removeProjectUsersFromCache(c),await l.default.softDelete(c.id)),"sqlite"==t?await(0,r.default)({token:e,title:n,parallelId:a,isEmptyProject:this.isEmptyProject}):"mysql"==t?await(0,o.default)({token:e,title:n,parallelId:a,oldProject:c,isEmptyProject:this.isEmptyProject}):"pg"==t&&await(0,s.default)({token:e,title:n,parallelId:i,oldProject:c,isEmptyProject:this.isEmptyProject}),{project:await l.default.getByTitle(n)}}};const g=async e=>{const t=await l.default.list({});for(const a of t)a.title.startsWith(`nc_test_${e}_`)&&await l.default.delete(a.id)},_=async e=>{const t=(await d.default.list()).filter((e=>!e.roles.includes("super")));for(const a of t)a.email.startsWith(`nc_test_${e}_`)&&(await u.default.del(`${p.CacheScope.USER}:${a.email}`),await d.default.delete(a.id))},b=async e=>{const t=await c.default.ncMeta.metaList(null,null,p.MetaTable.API_TOKENS);for(const a of t)a.description.startsWith(`nc_test_${e}`)&&(await u.default.deepDel(p.CacheScope.API_TOKEN,`${p.CacheScope.API_TOKEN}:${a.token}`,p.CacheDelDirection.CHILD_TO_PARENT),await c.default.ncMeta.metaDelete(null,null,p.MetaTable.API_TOKENS,{token:a.token}))}},94944:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(57147),s=i(a(71017)),o=i(a(52167)),r=e=>`${process.cwd()}/test_sakila_${e}.db`,l=async(e,t,a,i)=>{let n;return n=i?await o.default.post("http://localhost:8080/api/v1/db/meta/projects/",{title:t},{headers:{"xc-auth":e}}):await o.default.post("http://localhost:8080/api/v1/db/meta/projects/",((e,t)=>({title:e,bases:[{type:"sqlite3",config:{client:"sqlite3",connection:{client:"sqlite3",connection:{filename:r(t),database:"test_sakila",multipleStatements:!0}}},inflection_column:"camelize",inflection_table:"camelize"}],external:!0}))(t,a),{headers:{"xc-auth":e}}),200!==n.status&&console.error("Error creating project",n.data),n.data},c=async e=>{await n.promises.stat(r(e)).catch((()=>null))&&await n.promises.unlink(r(e))},d=async e=>{const t=s.default.join(process.cwd(),"tests");await n.promises.copyFile(`${t}/sqlite-sakila-db/sakila.db`,r(e))};t.default=async({parallelId:e,token:t,title:a,isEmptyProject:i})=>{await c(e),i||await d(e),await l(t,a,e,i)}},49500:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(57147),s=i(a(71017)),o=i(a(52167)),r=a(40514),l=i(a(67094)),c={client:"mysql2",connection:{host:"localhost",port:3306,user:"root",password:"password",database:"sakila",multipleStatements:!0,dateStrings:!0}},d=["actor","address","category","city","country","customer","film","film_text","film_actor","film_category","inventory","language","payment","rental","staff","store"],u=["actor_info","customer_list","film_list","nicer_but_slower_film_list","sales_by_film_category","sales_by_store","staff_list"];t.default=async({token:e,title:t,parallelId:a,oldProject:i,isEmptyProject:p})=>{const m=(0,r.knex)(c);try{await m.raw(`USE test_sakila_${a}`)}catch(e){await m.raw(`CREATE DATABASE test_sakila_${a}`),await m.raw(`USE test_sakila_${a}`)}(p||await(async(e,t,a)=>{const i=(await e.raw(`SELECT table_name FROM information_schema.tables WHERE table_schema = 'test_sakila_${t}'`))[0].map((e=>e.TABLE_NAME)).filter((e=>"nc_evolutions"!==e)),n=[...d,...u];if(0===i.length||!i.includes("actor")||i.length!==n.length||!i.every((e=>n.includes(e))))return!0;if(!a)return!0;const s=await l.default.projectAuditList(a.id,{});return console.log(`audits:resetMysqlSakilaProject:${t}`,null==s?void 0:s.length),!0})(m,a,i))&&await(async(e,t,a)=>{const i=s.default.join(process.cwd(),"/tests");try{await e.raw(`DROP DATABASE test_sakila_${t}`)}catch(e){console.log("Error dropping db",e)}if(await e.raw(`CREATE DATABASE test_sakila_${t}`),a)return;const o=await e.transaction();try{const e=await n.promises.readFile(`${i}/mysql-sakila-db/03-test-sakila-schema.sql`),a=await n.promises.readFile(`${i}/mysql-sakila-db/04-test-sakila-data.sql`);await o.raw(e.toString().replace(/test_sakila/g,`test_sakila_${t}`)),await o.raw(a.toString().replace(/test_sakila/g,`test_sakila_${t}`)),await o.commit()}catch(e){console.log("Error resetting mysql db",e),await o.rollback(e)}})(m,a,p);const f=await o.default.post("http://localhost:8080/api/v1/db/meta/projects/",((e,t)=>({title:e,bases:[{type:"mysql2",config:{client:"mysql2",connection:{host:"localhost",port:"3306",user:"root",password:"password",database:`test_sakila_${t}`}},inflection_column:"camelize",inflection_table:"camelize"}],external:!0}))(t,a),{headers:{"xc-auth":e}});200!==f.status&&console.error("Error creating project",f.data),await m.destroy()}},42058:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(57147),s=i(a(71017)),o=i(a(52167)),r=a(40514),l=i(a(67094)),c={client:"pg",connection:{host:"localhost",port:5432,user:"postgres",password:"password",database:"postgres",multipleStatements:!0},searchPath:["public","information_schema"],pool:{min:0,max:5}},d=e=>Object.assign(Object.assign({},c),{connection:Object.assign(Object.assign({},c.connection),{database:`sakila_${e}`})}),u=["country","city","actor","film_actor","category","film_category","language","film","payment_p2007_01","payment_p2007_02","payment_p2007_03","payment_p2007_04","payment_p2007_05","payment_p2007_06","payment","customer","inventory","rental","address","staff","store"],p=["actor_info","customer_list","film_list","nicer_but_slower_film_list","sales_by_film_category","sales_by_store","staff_list"];t.default=async({token:e,title:t,parallelId:a,oldProject:i,isEmptyProject:m})=>{const f=(0,r.knex)(c);try{await f.raw(`CREATE DATABASE sakila_${a}`)}catch(e){}(m||await(async(e,t)=>{const a=(0,r.knex)(d(e)),i=(await a.raw("SELECT * FROM information_schema.tables WHERE table_schema = 'public'")).rows.map((e=>e.table_name));await a.destroy();const n=i.filter((e=>"nc_evolutions"!==e)),s=[...u,...p];if(0===i.length||!i.includes("actor")||n.length!==s.length||!n.every((e=>s.includes(e))))return!0;if(!t)return!1;const o=await l.default.projectAuditList(t.id,{});return(null==o?void 0:o.length)>0})(a,i))&&(await f.raw(`DROP DATABASE IF EXISTS sakila_${a}`),await f.raw(`CREATE DATABASE sakila_${a}`),await f.destroy(),await(async(e,t)=>{const a=s.default.join(process.cwd(),"/tests");if(!t)try{const t=(0,r.knex)(d(e)),i=await n.promises.readFile(`${a}/pg-sakila-db/01-postgres-sakila-schema.sql`);await t.raw(i.toString());const s=await t.transaction(),o=await n.promises.readFile(`${a}/pg-sakila-db/02-postgres-sakila-insert-data.sql`);await s.raw(o.toString()),await s.commit(),await t.destroy()}catch(t){throw console.error(`Error resetting pg sakila db: Worker ${e}`),Error(`Error resetting pg sakila db: Worker ${e}`)}})(a,m));const h=await o.default.post("http://localhost:8080/api/v1/db/meta/projects/",((e,t)=>({title:e,bases:[{type:"pg",config:{client:"pg",connection:{host:"localhost",port:"5432",user:"postgres",password:"password",database:`sakila_${t}`},searchPath:["public"]},inflection_column:"camelize",inflection_table:"camelize"}],external:!0}))(t,a),{headers:{"xc-auth":e}});if(200!==h.status)throw console.error("Error creating project",h.data),new Error("Error creating project",h.data)}},31354:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.TestController=void 0;const o=a(26481),r=a(72346);let l=class{constructor(){}async reset(e){const t=new r.TestResetService({parallelId:e.body.parallelId,dbType:e.body.dbType,isEmptyProject:e.body.isEmptyProject,workerId:e.body.workerId});return await t.process()}};i([(0,o.Post)("/api/v1/meta/test/reset"),(0,o.HttpCode)(200),s(0,(0,o.Req)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],l.prototype,"reset",null),l=i([(0,o.Controller)(),n("design:paramtypes",[])],l),t.TestController=l},32332:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!DOCTYPE html>\n<html>\n<head>\n    <title>NocoDB - Reset Password</title>\n    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">\n    <link href="<%- ncPublicUrl %>/css/fonts.roboto.css" rel="stylesheet">\n    <link href="<%- ncPublicUrl %>/css/materialdesignicons.5.x.min.css" rel="stylesheet">\n    <link href="<%- ncPublicUrl %>/css/vuetify.2.x.min.css" rel="stylesheet">\n    <script src="<%- ncPublicUrl %>/js/vue.2.6.14.min.js"><\/script>\n</head>\n<body>\n<div id="app">\n    <v-app>\n        <v-container>\n            <v-row class="justify-center">\n                <v-col class="col-12 col-md-6">\n                    <v-alert v-if="success" type="success">\n                        Password reset successful!\n                    </v-alert>\n                    <template v-else>\n\n                        <v-form ref="form" v-model="validForm" v-if="valid === true" ref="formType" class="ma-auto"\n                                lazy-validation>\n\n\n                            <v-text-field\n                                    name="input-10-2"\n                                    label="New password"\n                                    type="password"\n                                    v-model="formdata.password"\n                                    :rules="[v => !!v ||  \'Password is required\']"\n                            ></v-text-field>\n\n                            <v-text-field\n                                    name="input-10-2"\n                                    type="password"\n                                    label="Confirm new password"\n                                    v-model="formdata.newPassword"\n                                    :rules="[v => !!v ||  \'Password is required\', v =>  v === formdata.password  || \'Password mismatch\']"\n                            ></v-text-field>\n\n                            <v-btn\n                                    :disabled="!validForm"\n                                    large\n                                    @click="resetPassword"\n                            >\n                                RESET PASSWORD\n                            </v-btn>\n\n                        </v-form>\n                        <div v-else-if="valid === false">Not a valid url</div>\n                        <div v-else>\n                            <v-skeleton-loader type="actions"></v-skeleton-loader>\n                        </div>\n                    </template>\n                </v-col>\n            </v-row>\n        </v-container>\n    </v-app>\n</div>\n<script src="<%- ncPublicUrl %>/js/vuetify.2.x.min.js"><\/script>\n<script src="<%- ncPublicUrl %>/js/axios.0.19.2.min.js"><\/script>\n\n<script>\n  var app = new Vue({\n    el: \'#app\',\n    vuetify: new Vuetify(),\n    data: {\n      valid: null,\n      validForm: false,\n      token: <%- token %>,\n      greeting: \'Password Reset\',\n      formdata: {\n        password: \'\',\n        newPassword: \'\'\n      },\n      success: false\n    },\n    methods: {\n      async resetPassword() {\n        if (this.$refs.form.validate()) {\n          try {\n            const res = await axios.post(\'<%- baseUrl %>api/v1/db/auth/password/reset/\' + this.token, {\n              ...this.formdata\n            });\n            this.success = true;\n          } catch (e) {\n            if (e.response && e.response.data && e.response.data.msg) {\n              alert(\'Failed to reset password: \' + e.response.data.msg)\n            } else {\n              alert(\'Some error occurred\')\n            }\n          }\n        }\n      }\n    },\n    async created() {\n      try {\n        const valid = (await axios.post(\'<%- baseUrl %>api/v1/db/auth/token/validate/\' + this.token)).data;\n        this.valid = !!valid;\n      } catch (e) {\n        this.valid = false;\n      }\n    }\n  })\n<\/script>\n</body>\n</html>'},28429:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!doctype html>\n<html>\n<head>\n  <meta name="viewport" content="width=device-width">\n  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n  <title>Simple Transactional Email</title>\n  <style>\n@media only screen and (max-width: 620px) {\n  table[class=body] h1 {\n    font-size: 28px !important;\n    margin-bottom: 10px !important;\n  }\n\n  table[class=body] p,\ntable[class=body] ul,\ntable[class=body] ol,\ntable[class=body] td,\ntable[class=body] span,\ntable[class=body] a {\n    font-size: 16px !important;\n  }\n\n  table[class=body] .wrapper,\ntable[class=body] .article {\n    padding: 10px !important;\n  }\n\n  table[class=body] .content {\n    padding: 0 !important;\n  }\n\n  table[class=body] .container {\n    padding: 0 !important;\n    width: 100% !important;\n  }\n\n  table[class=body] .main {\n    border-left-width: 0 !important;\n    border-radius: 0 !important;\n    border-right-width: 0 !important;\n  }\n\n  table[class=body] .btn table {\n    width: 100% !important;\n  }\n\n  table[class=body] .btn a {\n    width: 100% !important;\n  }\n\n  table[class=body] .img-responsive {\n    height: auto !important;\n    max-width: 100% !important;\n    width: auto !important;\n  }\n}\n@media all {\n  .ExternalClass {\n    width: 100%;\n  }\n\n  .ExternalClass,\n.ExternalClass p,\n.ExternalClass span,\n.ExternalClass font,\n.ExternalClass td,\n.ExternalClass div {\n    line-height: 100%;\n  }\n\n  .apple-link a {\n    color: inherit !important;\n    font-family: inherit !important;\n    font-size: inherit !important;\n    font-weight: inherit !important;\n    line-height: inherit !important;\n    text-decoration: none !important;\n  }\n\n  #MessageViewBody a {\n    color: inherit;\n    text-decoration: none;\n    font-size: inherit;\n    font-family: inherit;\n    font-weight: inherit;\n    line-height: inherit;\n  }\n\n  .btn-primary table td:hover {\n    background-color: #34495e !important;\n  }\n\n  .btn-primary a:hover {\n    background-color: #34495e !important;\n    border-color: #34495e !important;\n  }\n}\n</style>\n</head>\n<body class="" style="background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;">\n<span class="preheader" style="color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;">This is preheader text. Some clients will show this text as a preview.</span>\n<table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;" width="100%" bgcolor="#f6f6f6">\n  <tr>\n    <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n    <td class="container" style="font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;" width="580" valign="top">\n      <div class="content" style="box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;">\n\n        \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n        <table role="presentation" class="main" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;" width="100%">\n\n          \x3c!-- START MAIN CONTENT AREA --\x3e\n          <tr>\n            <td class="wrapper" style="font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;" valign="top">\n              <table role="presentation" border="0" cellpadding="0" cellspacing="0" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;" width="100%">\n                <tr>\n                  <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">\n                    <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">Hi,</p>\n                    <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">To change your NocoDB account password click the following link.</p>\n                    <table role="presentation" border="0" cellpadding="0" cellspacing="0" class="btn btn-primary" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; box-sizing: border-box; width: 100%;" width="100%">\n                      <tbody>\n                      <tr>\n                        <td align="left" style="font-family: sans-serif; font-size: 14px; vertical-align: top; padding-bottom: 15px;" valign="top">\n                          <table role="presentation" border="0" cellpadding="0" cellspacing="0" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: auto;">\n                            <tbody>\n                            <tr>\n                              <td style="font-family: sans-serif; font-size: 14px; vertical-align: top; border-radius: 5px; text-align: center; background-color: #3498db;" valign="top" align="center" bgcolor="#1088ff"> <a href="<%- resetLink %>" target="_blank" style="border: solid 1px rgb(23, 139, 255); border-radius: 5px; box-sizing: border-box; cursor: pointer; display: inline-block; font-size: 14px; font-weight: bold; margin: 0; padding: 12px 25px; text-decoration: none; text-transform: capitalize; background-color: rgb(23, 139, 255); border-color: #3498db; color: #ffffff;">Reset Password</a> </td>\n                            </tr>\n                            </tbody>\n                          </table>\n                        </td>\n                      </tr>\n                      </tbody>\n                    </table>\n                    <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">Thanks regards NocoDB.</p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          \x3c!-- END MAIN CONTENT AREA --\x3e\n        </table>\n        \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n        \x3c!-- START FOOTER --\x3e\n        <div class="footer" style="clear: both; margin-top: 10px; text-align: center; width: 100%;">\n          <table role="presentation" border="0" cellpadding="0" cellspacing="0" style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;" width="100%">\n            <tr>\n              <td class="content-block" style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;" valign="top" align="center">\n                <span class="apple-link" style="color: #999999; font-size: 12px; text-align: center;"></span>\n\x3c!--                <br> Don\'t like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.--\x3e\n              </td>\n            </tr>\n            <tr>\n              <td class="content-block powered-by" style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;" valign="top" align="center">\n              <a href="http://nocodb.com/">NocoDB</a>\n\x3c!--                Powered by <a href="http://htmlemail.io">HTMLemail</a>.--\x3e\n              </td>\n            </tr>\n          </table>\n        </div>\n        \x3c!-- END FOOTER --\x3e\n\n      </div>\n    </td>\n    <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n  </tr>\n</table>\n</body>\n</html>\n'},49185:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!doctype html>\n<html>\n<head>\n    <meta name="viewport" content="width=device-width">\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n    <title>Simple Transactional Email</title>\n    <style>\n        @media only screen and (max-width: 620px) {\n            table[class=body] h1 {\n                font-size: 28px !important;\n                margin-bottom: 10px !important;\n            }\n\n            table[class=body] p,\n            table[class=body] ul,\n            table[class=body] ol,\n            table[class=body] td,\n            table[class=body] span,\n            table[class=body] a {\n                font-size: 16px !important;\n            }\n\n            table[class=body] .wrapper,\n            table[class=body] .article {\n                padding: 10px !important;\n            }\n\n            table[class=body] .content {\n                padding: 0 !important;\n            }\n\n            table[class=body] .container {\n                padding: 0 !important;\n                width: 100% !important;\n            }\n\n            table[class=body] .main {\n                border-left-width: 0 !important;\n                border-radius: 0 !important;\n                border-right-width: 0 !important;\n            }\n\n            table[class=body] .btn table {\n                width: 100% !important;\n            }\n\n            table[class=body] .btn a {\n                width: 100% !important;\n            }\n\n            table[class=body] .img-responsive {\n                height: auto !important;\n                max-width: 100% !important;\n                width: auto !important;\n            }\n        }\n\n        @media all {\n            .ExternalClass {\n                width: 100%;\n            }\n\n            .ExternalClass,\n            .ExternalClass p,\n            .ExternalClass span,\n            .ExternalClass font,\n            .ExternalClass td,\n            .ExternalClass div {\n                line-height: 100%;\n            }\n\n            .apple-link a {\n                color: inherit !important;\n                font-family: inherit !important;\n                font-size: inherit !important;\n                font-weight: inherit !important;\n                line-height: inherit !important;\n                text-decoration: none !important;\n            }\n\n            #MessageViewBody a {\n                color: inherit;\n                text-decoration: none;\n                font-size: inherit;\n                font-family: inherit;\n                font-weight: inherit;\n                line-height: inherit;\n            }\n\n            .btn-primary table td:hover {\n                background-color: #34495e !important;\n            }\n\n            .btn-primary a:hover {\n                background-color: #34495e !important;\n                border-color: #34495e !important;\n            }\n        }\n    </style>\n</head>\n<body class=""\n      style="background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;">\n<span class="preheader"\n      style="color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;">This is preheader text. Some clients will show this text as a preview.</span>\n<table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body"\n       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;"\n       width="100%" bgcolor="#f6f6f6">\n    <tr>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n        <td class="container"\n            style="font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;"\n            width="580" valign="top">\n            <div class="content"\n                 style="box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;">\n\n                \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n                <table role="presentation" class="main"\n                       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;"\n                       width="100%">\n\n                    \x3c!-- START MAIN CONTENT AREA --\x3e\n                    <tr>\n                        <td class="wrapper"\n                            style="font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;"\n                            valign="top">\n                            <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                   style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                                   width="100%">\n                                <tr>\n                                    <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;"\n                                        valign="top">\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Hi,</p>\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Please verify your email address by clicking the following button.</p>\n                                        <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                               class="btn btn-primary"\n                                               style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; box-sizing: border-box; width: 100%;"\n                                               width="100%">\n                                            <tbody>\n                                            <tr>\n                                                <td align="left"\n                                                    style="font-family: sans-serif; font-size: 14px; vertical-align: top; padding-bottom: 15px;"\n                                                    valign="top">\n                                                    <table role="presentation" border="0" cellpadding="0"\n                                                           cellspacing="0"\n                                                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: auto;">\n                                                        <tbody>\n                                                        <tr>\n                                                            <td style="font-family: sans-serif; font-size: 14px; vertical-align: top; border-radius: 5px; text-align: center; background-color: #3498db;"\n                                                                valign="top" align="center" bgcolor="#1088ff"><a\n                                                                        href="<%- verifyLink %>" target="_blank"\n                                                                        style="border: solid 1px rgb(23, 139, 255); border-radius: 5px; box-sizing: border-box; cursor: pointer; display: inline-block; font-size: 14px; font-weight: bold; margin: 0; padding: 12px 25px; text-decoration: none; text-transform: capitalize; background-color: rgb(23, 139, 255); border-color: #3498db; color: #ffffff;">Verify</a>\n                                                            </td>\n                                                        </tr>\n                                                        </tbody>\n                                                    </table>\n                                                </td>\n                                            </tr>\n                                            </tbody>\n                                        </table>\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Thanks regards NocoDB.</p>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n\n                    \x3c!-- END MAIN CONTENT AREA --\x3e\n                </table>\n                \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n                \x3c!-- START FOOTER --\x3e\n                <div class="footer" style="clear: both; margin-top: 10px; text-align: center; width: 100%;">\n                    <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                           width="100%">\n                        <tr>\n                            <td class="content-block"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <span class="apple-link"\n                                      style="color: #999999; font-size: 12px; text-align: center;"></span>\n                                \x3c!--                <br> Don\'t like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.--\x3e\n                            </td>\n                        </tr>\n                        <tr>\n                            <td class="content-block powered-by"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <a href="http://nocodb.com/">NocoDB</a>\n                                \x3c!--                Powered by <a href="http://htmlemail.io">HTMLemail</a>.--\x3e\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                \x3c!-- END FOOTER --\x3e\n\n            </div>\n        </td>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n    </tr>\n</table>\n</body>\n</html>\n'},17882:function(e,t,a){var i,n,s,o,r,l,c,d,u,p,m,f,h=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),g=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),_=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},b=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&h(t,e,a);return g(t,e),t},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},w=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersController=void 0;const v=a(26481),T=a(24340),O=b(a(49632)),E=a(35793),S=a(68281),I=a(66310),k=a(51401),C=a(68382),j=a(15147),x=a(33206),R=a(74564),A=a(1119);let M=class{constructor(e,t,a){this.usersService=e,this.appHooksService=t,this.config=a}async signup(e,t){this.config.get("auth",{infer:!0}).disableEmailAuth&&k.NcError.forbidden("Email authentication is disabled"),t.json(await this.usersService.signup({body:e.body,req:e,res:t}))}async refreshToken(e,t){t.json(await this.usersService.refreshToken({body:e.body,req:e,res:t}))}async signin(e,t){this.config.get("auth",{infer:!0}).disableEmailAuth&&k.NcError.forbidden("Email authentication is disabled"),await this.setRefreshToken({req:e,res:t}),t.json(await this.usersService.login(e.user))}async signOut(e,t){e.isAuthenticated()||k.NcError.forbidden("Not allowed"),t.json(await this.usersService.signOut({req:e,res:t}))}async googleSignin(e,t){await this.setRefreshToken({req:e,res:t}),t.json(await this.usersService.login(e.user))}googleAuthenticate(){}async me(e){return Object.assign(Object.assign({},e.user),{roles:(0,S.extractRolesObj)(e.user.roles),workspace_roles:(0,S.extractRolesObj)(e.user.workspace_roles),project_roles:(0,S.extractRolesObj)(e.user.project_roles)})}async passwordChange(e){return e.isAuthenticated()||k.NcError.forbidden("Not allowed"),await this.usersService.passwordChange({user:e.user,req:e,body:e.body}),{msg:"Password has been updated successfully"}}async passwordForgot(e){return await this.usersService.passwordForgot({siteUrl:e.ncSiteUrl,body:e.body,req:e}),{msg:"Please check your email to reset the password"}}async tokenValidate(e){return await this.usersService.tokenValidate({token:e}),{msg:"Token has been validated successfully"}}async passwordReset(e,t,a){return await this.usersService.passwordReset({token:t,body:a,req:e}),{msg:"Password has been reset successfully"}}async emailVerification(e,t){return await this.usersService.emailVerification({token:t,req:e}),{msg:"Email has been verified successfully"}}async renderPasswordReset(e,t,i){try{t.send(O.render((await Promise.resolve().then((()=>b(a(32332))))).default,{ncPublicUrl:process.env.NC_PUBLIC_URL||"",token:JSON.stringify(i),baseUrl:"/"}))}catch(e){return t.status(400).json({msg:e.message})}}async setRefreshToken({res:e,req:t}){var a;const i=null===(a=t.user)||void 0===a?void 0:a.id;if(!i)return;const n=await j.User.get(i);if(!n)return;const s=(0,R.randomTokenString)();n.token_version||(n.token_version=(0,R.randomTokenString)()),await j.User.update(n.id,{refresh_token:s,email:n.email,token_version:n.token_version}),(0,R.setTokenCookie)(e,s)}};_([(0,v.Post)(["/auth/user/signup","/api/v1/db/auth/user/signup","/api/v1/auth/user/signup"]),(0,v.HttpCode)(200),w(0,(0,v.Request)()),w(1,(0,v.Response)()),y("design:type",Function),y("design:paramtypes",[Object,Object]),y("design:returntype","function"==typeof(o="undefined"!=typeof Promise&&Promise)?o:Object)],M.prototype,"signup",null),_([(0,v.Post)(["/auth/token/refresh","/api/v1/db/auth/token/refresh","/api/v1/auth/token/refresh"]),(0,v.HttpCode)(200),w(0,(0,v.Request)()),w(1,(0,v.Response)()),y("design:type",Function),y("design:paramtypes",[Object,Object]),y("design:returntype","function"==typeof(r="undefined"!=typeof Promise&&Promise)?r:Object)],M.prototype,"refreshToken",null),_([(0,v.Post)(["/auth/user/signin","/api/v1/db/auth/user/signin","/api/v1/auth/user/signin"]),(0,v.UseGuards)((0,T.AuthGuard)("local")),(0,v.HttpCode)(200),w(0,(0,v.Request)()),w(1,(0,v.Response)()),y("design:type",Function),y("design:paramtypes",[Object,Object]),y("design:returntype",Promise)],M.prototype,"signin",null),_([(0,v.UseGuards)(I.GlobalGuard),(0,v.Post)("/api/v1/auth/user/signout"),(0,v.HttpCode)(200),w(0,(0,v.Request)()),w(1,(0,v.Response)()),y("design:type",Function),y("design:paramtypes",[Object,Object]),y("design:returntype","function"==typeof(l="undefined"!=typeof Promise&&Promise)?l:Object)],M.prototype,"signOut",null),_([(0,v.Post)("/auth/google/genTokenByCode"),(0,v.HttpCode)(200),(0,v.UseGuards)((0,T.AuthGuard)("google")),w(0,(0,v.Request)()),w(1,(0,v.Response)()),y("design:type",Function),y("design:paramtypes",[Object,Object]),y("design:returntype",Promise)],M.prototype,"googleSignin",null),_([(0,v.Get)("/auth/google"),(0,v.UseGuards)((0,T.AuthGuard)("google")),y("design:type",Function),y("design:paramtypes",[]),y("design:returntype",void 0)],M.prototype,"googleAuthenticate",null),_([(0,v.Get)(["/auth/user/me","/api/v1/db/auth/user/me","/api/v1/auth/user/me"]),(0,v.UseGuards)(I.GlobalGuard),w(0,(0,v.Request)()),y("design:type",Function),y("design:paramtypes",[Object]),y("design:returntype",Promise)],M.prototype,"me",null),_([(0,v.Post)(["/user/password/change","/api/v1/db/auth/password/change","/api/v1/auth/password/change"]),(0,v.UseGuards)(I.GlobalGuard),(0,C.Acl)("passwordChange",{scope:"org"}),(0,v.HttpCode)(200),w(0,(0,v.Request)()),y("design:type",Function),y("design:paramtypes",[Object]),y("design:returntype","function"==typeof(c="undefined"!=typeof Promise&&Promise)?c:Object)],M.prototype,"passwordChange",null),_([(0,v.Post)(["/auth/password/forgot","/api/v1/db/auth/password/forgot","/api/v1/auth/password/forgot"]),(0,v.HttpCode)(200),w(0,(0,v.Request)()),y("design:type",Function),y("design:paramtypes",[Object]),y("design:returntype","function"==typeof(d="undefined"!=typeof Promise&&Promise)?d:Object)],M.prototype,"passwordForgot",null),_([(0,v.Post)(["/auth/token/validate/:tokenId","/api/v1/db/auth/token/validate/:tokenId","/api/v1/auth/token/validate/:tokenId"]),(0,v.HttpCode)(200),w(0,(0,v.Param)("tokenId")),y("design:type",Function),y("design:paramtypes",[String]),y("design:returntype","function"==typeof(u="undefined"!=typeof Promise&&Promise)?u:Object)],M.prototype,"tokenValidate",null),_([(0,v.Post)(["/auth/password/reset/:tokenId","/api/v1/db/auth/password/reset/:tokenId","/api/v1/auth/password/reset/:tokenId"]),(0,v.HttpCode)(200),w(0,(0,v.Request)()),w(1,(0,v.Param)("tokenId")),w(2,(0,v.Body)()),y("design:type",Function),y("design:paramtypes",[Object,String,Object]),y("design:returntype","function"==typeof(p="undefined"!=typeof Promise&&Promise)?p:Object)],M.prototype,"passwordReset",null),_([(0,v.Post)(["/api/v1/db/auth/email/validate/:tokenId","/api/v1/auth/email/validate/:tokenId"]),(0,v.HttpCode)(200),w(0,(0,v.Request)()),w(1,(0,v.Param)("tokenId")),y("design:type",Function),y("design:paramtypes",[Object,String]),y("design:returntype","function"==typeof(m="undefined"!=typeof Promise&&Promise)?m:Object)],M.prototype,"emailVerification",null),_([(0,v.Get)(["/api/v1/db/auth/password/reset/:tokenId","/auth/password/reset/:tokenId"]),w(0,(0,v.Request)()),w(1,(0,v.Response)()),w(2,(0,v.Param)("tokenId")),y("design:type",Function),y("design:paramtypes",[Object,Object,String]),y("design:returntype","function"==typeof(f="undefined"!=typeof Promise&&Promise)?f:Object)],M.prototype,"renderPasswordReset",null),M=_([(0,v.Controller)(),y("design:paramtypes",["function"==typeof(i=void 0!==A.UsersService&&A.UsersService)?i:Object,"function"==typeof(n=void 0!==x.AppHooksService&&x.AppHooksService)?n:Object,"function"==typeof(s=void 0!==E.ConfigService&&E.ConfigService)?s:Object])],M),t.UsersController=M},65697:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UtilsController=void 0;const l=r(a(57147)),c=a(16464),d=a(26481),u=a(66310),p=a(49313),m=a(68382);let f=class{constructor(e){this.utilsService=e}async getVersion(){if("true"!==process.env.NC_CLOUD)return this.utilsService.versionInfo();if(!this.version)try{this.version=await(0,c.promisify)(l.default.readFile)("./public/nc.txt","utf-8")}catch(e){this.version="Not available"}return this.version}async testConnection(e){return await this.utilsService.testConnection({body:e})}async appInfo(e){return await this.utilsService.appInfo({req:{ncSiteUrl:e.ncSiteUrl}})}async appHealth(){return await this.utilsService.appHealth()}async axiosRequestMake(e){return await this.utilsService.axiosRequestMake({body:e})}async urlToDbConfig(e){return await this.utilsService.urlToDbConfig({body:e})}async aggregatedMetaInfo(){return await this.utilsService.aggregatedMetaInfo()}};n([(0,d.Get)("/api/v1/version"),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],f.prototype,"getVersion",null),n([(0,d.UseGuards)(u.GlobalGuard),(0,d.Post)("/api/v1/db/meta/connection/test"),(0,m.Acl)("testConnection",{scope:"org"}),(0,d.HttpCode)(200),o(0,(0,d.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],f.prototype,"testConnection",null),n([(0,d.Get)("/api/v1/db/meta/nocodb/info"),o(0,(0,d.Request)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],f.prototype,"appInfo",null),n([(0,d.Get)("/api/v1/health"),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],f.prototype,"appHealth",null),n([(0,d.Post)("/api/v1/db/meta/axiosRequestMake"),(0,d.HttpCode)(200),o(0,(0,d.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],f.prototype,"axiosRequestMake",null),n([(0,d.Post)("/api/v1/url_to_config"),(0,d.HttpCode)(200),o(0,(0,d.Body)()),s("design:type",Function),s("design:paramtypes",[Object]),s("design:returntype",Promise)],f.prototype,"urlToDbConfig",null),n([(0,d.Get)("/api/v1/aggregated-meta-info"),s("design:type",Function),s("design:paramtypes",[]),s("design:returntype",Promise)],f.prototype,"aggregatedMetaInfo",null),f=n([(0,d.Controller)(),s("design:paramtypes",["function"==typeof(i=void 0!==p.UtilsService&&p.UtilsService)?i:Object])],f),t.UtilsController=f},71423:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewColumnsController=void 0;const c=a(26481),d=a(68281),u=a(66310),p=a(60498),m=a(58110),f=a(68382);let h=class{constructor(e){this.viewColumnsService=e}async columnList(e){return new p.PagedResponseImpl(await this.viewColumnsService.columnList({viewId:e}))}async columnAdd(e,t){return await this.viewColumnsService.columnAdd({viewId:e,column:t})}async columnUpdate(e,t,a){return await this.viewColumnsService.columnUpdate({viewId:e,columnId:t,column:a})}};o([(0,c.Get)("/api/v1/db/meta/views/:viewId/columns/"),(0,f.Acl)("columnList"),l(0,(0,c.Param)("viewId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],h.prototype,"columnList",null),o([(0,c.Post)("/api/v1/db/meta/views/:viewId/columns/"),(0,c.HttpCode)(200),(0,f.Acl)("columnAdd"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(n=void 0!==d.ViewColumnReqType&&d.ViewColumnReqType)?n:Object]),r("design:returntype",Promise)],h.prototype,"columnAdd",null),o([(0,c.Patch)("/api/v1/db/meta/views/:viewId/columns/:columnId"),(0,f.Acl)("columnUpdate"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Param)("columnId")),l(2,(0,c.Body)()),r("design:type",Function),r("design:paramtypes",[String,String,"function"==typeof(s=void 0!==d.ViewColumnReqType&&d.ViewColumnReqType)?s:Object]),r("design:returntype",Promise)],h.prototype,"columnUpdate",null),h=o([(0,c.Controller)(),(0,c.UseGuards)(u.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==m.ViewColumnsService&&m.ViewColumnsService)?i:Object])],h),t.ViewColumnsController=h},49146:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewsController=void 0;const c=a(26481),d=a(68281),u=a(60498),p=a(66310),m=a(430),f=a(68382);let h=class{constructor(e){this.viewsService=e}async viewList(e,t){return new u.PagedResponseImpl(await this.viewsService.viewList({tableId:e,user:t.user}))}async viewUpdate(e,t,a){return await this.viewsService.viewUpdate({viewId:e,view:t,user:a.user})}async viewDelete(e,t){return await this.viewsService.viewDelete({viewId:e,user:t.user})}async showAllColumns(e,t){return await this.viewsService.showAllColumns({viewId:e,ignoreIds:t})}async hideAllColumns(e,t){return await this.viewsService.hideAllColumns({viewId:e,ignoreIds:t})}async shareView(e,t){return await this.viewsService.shareView({viewId:e,user:t.user})}async shareViewList(e){return new u.PagedResponseImpl(await this.viewsService.shareViewList({tableId:e}))}async shareViewUpdate(e,t,a){return await this.viewsService.shareViewUpdate({viewId:e,sharedView:t,user:a.user})}async shareViewDelete(e,t){return await this.viewsService.shareViewDelete({viewId:e,user:t.user})}};o([(0,c.Get)("/api/v1/db/meta/tables/:tableId/views"),(0,f.Acl)("viewList"),l(0,(0,c.Param)("tableId")),l(1,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"viewList",null),o([(0,c.Patch)("/api/v1/db/meta/views/:viewId"),(0,f.Acl)("viewUpdate"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Body)()),l(2,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(n=void 0!==d.ViewUpdateReqType&&d.ViewUpdateReqType)?n:Object,Object]),r("design:returntype",Promise)],h.prototype,"viewUpdate",null),o([(0,c.Delete)("/api/v1/db/meta/views/:viewId"),(0,f.Acl)("viewDelete"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"viewDelete",null),o([(0,c.Post)("/api/v1/db/meta/views/:viewId/show-all"),(0,c.HttpCode)(200),(0,f.Acl)("showAllColumns"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Query)("ignoreIds")),r("design:type",Function),r("design:paramtypes",[String,Array]),r("design:returntype",Promise)],h.prototype,"showAllColumns",null),o([(0,c.Post)("/api/v1/db/meta/views/:viewId/hide-all"),(0,c.HttpCode)(200),(0,f.Acl)("hideAllColumns"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Query)("ignoreIds")),r("design:type",Function),r("design:paramtypes",[String,Array]),r("design:returntype",Promise)],h.prototype,"hideAllColumns",null),o([(0,c.Post)("/api/v1/db/meta/views/:viewId/share"),(0,c.HttpCode)(200),(0,f.Acl)("shareView"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"shareView",null),o([(0,c.Get)("/api/v1/db/meta/tables/:tableId/share"),(0,f.Acl)("shareViewList"),l(0,(0,c.Param)("tableId")),r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Promise)],h.prototype,"shareViewList",null),o([(0,c.Patch)("/api/v1/db/meta/views/:viewId/share"),(0,f.Acl)("shareViewUpdate"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Body)()),l(2,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,"function"==typeof(s=void 0!==d.ViewUpdateReqType&&d.ViewUpdateReqType)?s:Object,Object]),r("design:returntype",Promise)],h.prototype,"shareViewUpdate",null),o([(0,c.Delete)("/api/v1/db/meta/views/:viewId/share"),(0,f.Acl)("shareViewDelete"),l(0,(0,c.Param)("viewId")),l(1,(0,c.Request)()),r("design:type",Function),r("design:paramtypes",[String,Object]),r("design:returntype",Promise)],h.prototype,"shareViewDelete",null),h=o([(0,c.Controller)(),(0,c.UseGuards)(p.GlobalGuard),r("design:paramtypes",["function"==typeof(i=void 0!==m.ViewsService&&m.ViewsService)?i:Object])],h),t.ViewsController=h},88717:function(e,t,a){var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseModelSqlv2=t.getListArgs=t._wherePk=t.extractCondition=t.extractFilterFromXwhere=t.extractSortsObject=t.populatePk=void 0;const s=n(a(20091)),o=n(a(98492)),r=n(a(65826)),l=n(a(1635)),c=n(a(46778)),d=n(a(53291)),u=a(87049),p=a(68281),m=n(a(71564)),f=a(30754),h=n(a(73059)),g=a(25828),_=n(a(4766)),b=n(a(81407)),y=n(a(83492)),w=n(a(35774)),v=a(24210),T=a(78829),O=a(51401),E=n(a(89103)),S=a(15147),I=a(70939),k=n(a(27552)),C=a(17276),j=a(13609);l.default.extend(c.default),l.default.extend(d.default);const x="__nc_group_id",R=(0,f.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14);async function A(e,t){var a,i;await e.getColumns();for(const n of e.primaryKeys)(null===(a=n.meta)||void 0===a?void 0:a.ag)&&!t[n.title]&&(t[n.title]="nc"===(null===(i=n.meta)||void 0===i?void 0:i.ag)?`rc_${R()}`:(0,g.v4)())}function M(e,t,a){return!(!e.pk&&e.uidt!==p.UITypes.ForeignKey)||(!(!a||!e.pv)||(!t||t.includes(e.title)))}t.populatePk=A;class N{get dbDriver(){return this._dbDriver}constructor({dbDriver:e,model:t,viewId:a}){this._columns={},this._dbDriver=e,this.model=t,this.viewId=a,(0,s.default)(this)}async readByPk(e,t=!1,a={},{ignoreView:i=!1,getHiddenColumn:n=!1}={}){var s;const o=this.dbDriver(this.tnPath),{ast:r,dependencyFields:l}=await(0,E.default)({query:a,model:this.model,view:i?null:this.viewId&&await S.View.get(this.viewId),getHiddenColumn:n});let c;await this.selectObject(Object.assign(Object.assign({},null!=l?l:{}),{qb:o,validateFormula:t})),o.where(D(this.model.primaryKeys,e));try{c=null===(s=await this.execAndParse(o))||void 0===s?void 0:s[0]}catch(a){if(t||!B(await this.model.getColumns()))throw a;return console.log(a),this.readByPk(e,!0)}if(c){const e=await this.getProto();c.__proto__=e}return c?await(0,u.nocoExecute)(r,c,{},a):null}async exist(e){const t=this.dbDriver(this.tnPath);await this.model.getColumns();const a=this.model.primaryKeys;return!!a.length&&(t.select(a[0].column_name),(e+"").split("___").length==(null==a?void 0:a.length)&&(t.where(D(a,e)).first(),!!await t))}async findOne(e={},t=!1){const a=this._getListArgs(e),{where:n}=a,s=i(a,["where"]),o=this.dbDriver(this.tnPath);await this.selectObject(Object.assign(Object.assign({},e),{qb:o,validateFormula:t}));const r=await this.model.getAliasColObjMap(),l=P(null==s?void 0:s.sort,r),c=L(n,r);let d;await(0,y.default)(this,[new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:c,is_group:!0,logical_op:"and"})],o),Array.isArray(l)&&(null==l?void 0:l.length)?await(0,w.default)(this,l,o):this.model.primaryKey&&o.orderBy(this.model.primaryKey.column_name);try{d=await o.first()}catch(a){if(t||!B(await this.model.getColumns()))throw a;return console.log(a),this.findOne(e,!0)}if(d){const e=await this.getProto();d.__proto__=e}return d}async list(e={},t=!1,a=!1){var n;const s=this._getListArgs(e),{where:o,fields:r}=s,l=i(s,["where","fields"]),c=this.dbDriver(this.tnPath);await this.selectObject({qb:c,fieldsSet:e.fieldsSet,viewId:this.viewId,validateFormula:a}),+(null==l?void 0:l.shuffle)&&await this.shuffle({qb:c});const d=await this.model.getAliasColObjMap();let u=P(null==l?void 0:l.sort,d);const p=L(o,d);!t&&this.viewId?(await(0,y.default)(this,[new S.Filter({children:await S.Filter.rootFilterList({viewId:this.viewId})||[],is_group:!0}),new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:p,is_group:!0,logical_op:"and"})],c),u||(u=(null===(n=e.sortArr)||void 0===n?void 0:n.length)?e.sortArr:await S.Sort.list({viewId:this.viewId})),await(0,w.default)(this,u,c)):(await(0,y.default)(this,[new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:p,is_group:!0,logical_op:"and"})],c),u||(u=e.sortArr),await(0,w.default)(this,u,c)),this.model.primaryKey&&this.model.primaryKey.ai?c.orderBy(this.model.primaryKey.column_name):this.model.columns.find((e=>"created_at"===e.column_name))&&c.orderBy("created_at"),t||q(c,l);const m=await this.getProto();let f;try{f=await this.execAndParse(c)}catch(i){if(a||!B(await this.model.getColumns()))throw i;return console.log(i),this.list(e,t,!0)}return null==f?void 0:f.map((e=>(e.__proto__=m,e)))}async count(e={},t=!1){var a,i;await this.model.getColumns();const{where:n}=this._getListArgs(e),s=this.dbDriver(this.tnPath),o=L(n,await this.model.getAliasColObjMap());!t&&this.viewId?await(0,y.default)(this,[new S.Filter({children:await S.Filter.rootFilterList({viewId:this.viewId})||[],is_group:!0}),new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:o,is_group:!0,logical_op:"and"}),...e.filterArr||[]],s):await(0,y.default)(this,[new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:o,is_group:!0,logical_op:"and"}),...e.filterArr||[]],s),s.count((0,I.sanitize)(null===(a=this.model.primaryKey)||void 0===a?void 0:a.column_name)||"*",{as:"count"}).first();let r=(0,I.sanitize)(s.toQuery());this.isPg||this.isMssql||this.isSnowflake||(r=(0,I.unsanitize)(s.toQuery()));const l=await this.dbDriver.raw(r);return(this.isPg||this.isSnowflake?l.rows[0]:null!==(i=l[0][0])&&void 0!==i?i:l[0]).count}async groupByAndAggregate(e,t,a){var n;const s=this._getListArgs(a),{where:o}=s,r=i(s,["where"]),l=this.dbDriver(this.tnPath),c=`${e} as ${t}__${e}`;if("function"!=typeof l[t])throw new Error(`Unsupported aggregate function: ${t}`);l[t](c),l.select(a.groupByColumnName),+(null==r?void 0:r.shuffle)&&await this.shuffle({qb:l});const d=L(o,await this.model.getAliasColObjMap());return await(0,y.default)(this,[new S.Filter({children:a.widgetFilterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:d,is_group:!0,logical_op:"and"})],l),(null==a?void 0:a.groupByColumnName)&&l.groupBy(null==a?void 0:a.groupByColumnName),(null===(n=null==a?void 0:a.sortBy)||void 0===n?void 0:n.column_name)&&l.orderBy(a.sortBy.column_name,a.sortBy.direction),q(l,r),await l}async groupBy(e){var t,a;const n=this._getListArgs(e),{where:s}=n,o=i(n,["where"]);e.column_name=e.column_name||"";const r=await this.model.getColumns().then((t=>e.column_name.split(",").map((e=>{const a=t.find((t=>t.column_name===e||t.title===e));if(!a)throw O.NcError.notFound("Column not found");return a.column_name})))),l=this.dbDriver(this.tnPath);l.count(`${(null===(t=this.model.primaryKey)||void 0===t?void 0:t.column_name)||"*"} as count`),l.select(...r),+(null==o?void 0:o.shuffle)&&await this.shuffle({qb:l});const c=await this.model.getAliasColObjMap();let d=P(null==o?void 0:o.sort,c);const u=L(s,c);return await(0,y.default)(this,[...this.viewId?[new S.Filter({children:await S.Filter.rootFilterList({viewId:this.viewId})||[],is_group:!0})]:[],new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:u,is_group:!0,logical_op:"and"})],l),l.groupBy(...r),d||(d=(null===(a=e.sortArr)||void 0===a?void 0:a.length)?e.sortArr:await S.Sort.list({viewId:this.viewId})),d&&await(0,w.default)(this,d,l),q(l,o),await l}async groupByCount(e){var t,a;const n=this._getListArgs(e),{where:s}=n;i(n,["where"]);e.column_name=e.column_name||"";const o=await this.model.getColumns().then((t=>e.column_name.split(",").map((e=>{const a=t.find((t=>t.column_name===e||t.title===e));if(!a)throw O.NcError.notFound("Column not found");return a.column_name})))),r=this.dbDriver(this.tnPath);r.count(`${(null===(t=this.model.primaryKey)||void 0===t?void 0:t.column_name)||"*"} as count`),r.select(...o);const l=L(s,await this.model.getAliasColObjMap());await(0,y.default)(this,[...this.viewId?[new S.Filter({children:await S.Filter.rootFilterList({viewId:this.viewId})||[],is_group:!0})]:[],new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:l,is_group:!0,logical_op:"and"})],r),r.groupBy(...o);const c=this.dbDriver.count("*",{as:"count"}).from(r.as("groupby"));return null===(a=await c.first())||void 0===a?void 0:a.count}async multipleHmList({colId:e,ids:t},a={}){try{const n=this._getListArgs(a),{where:s,sort:r}=n,l=i(n,["where","sort"]),c=(await this.model.getColumns()).find((t=>t.id===e)),d=await(await c.getColOptions()).getChildColumn(),u=await d.getModel(),p=await(await c.getColOptions()).getParentColumn(),m=await p.getModel(),f=await S.Model.getBaseModelSQL({model:u,dbDriver:this.dbDriver});await m.getColumns();const h=this.getTnPath(u),g=this.getTnPath(m),_=this.dbDriver(h);await f.selectObject({qb:_,extractPkAndPv:!0,fieldsSet:a.fieldsSet}),await this.applySortAndFilter({table:u,where:s,qb:_,sort:r});const b=this.dbDriver.queryBuilder().from(this.dbDriver.unionAll(t.map((e=>{const t=_.clone().select(this.dbDriver.raw("? as ??",[e,x])).whereIn(d.column_name,this.dbDriver(g).select(p.column_name).where(D(m.primaryKeys,e)));return t.limit(+(null==l?void 0:l.limit)||25),t.offset(+(null==l?void 0:l.offset)||0),this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite).as("list")),y=await this.execAndParse(b,u),w=await(await S.Model.getBaseModelSQL({id:u.id,dbDriver:this.dbDriver})).getProto();return(0,o.default)(y.map((e=>(e.__proto__=w,e))),x)}catch(e){throw console.log(e),e}}async applySortAndFilter({table:e,where:t,qb:a,sort:i}){const n=await e.getAliasColObjMap(),s=L(t,n);if(await(0,y.default)(this,s,a),!i)return;const o=P(i,n);o&&await(0,w.default)(this,o,a)}async multipleHmListCount({colId:e,ids:t}){try{const a=(await this.model.getColumns()).find((t=>t.id===e)),i=await(await a.getColOptions()).getChildColumn(),n=await i.getModel(),s=await(await a.getColOptions()).getParentColumn(),o=await s.getModel();await o.getColumns();const r=this.getTnPath(n),l=this.getTnPath(o);return(await this.dbDriver.unionAll(t.map((e=>{const t=this.dbDriver(r).count(`${null==i?void 0:i.column_name} as count`).whereIn(i.column_name,this.dbDriver(l).select(s.column_name).where(D(o.primaryKeys,e))).first();return this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite)).map((({count:e})=>e))}catch(e){throw console.log(e),e}}async hmList({colId:e,id:t},a={}){try{const n=this._getListArgs(a),{where:s,sort:o}=n,r=i(n,["where","sort"]),l=(await this.model.getColumns()).find((t=>t.id===e)),c=await(await l.getColOptions()).getChildColumn(),d=await c.getModel(),u=await(await l.getColOptions()).getParentColumn(),p=await u.getModel(),m=await S.Model.getBaseModelSQL({model:d,dbDriver:this.dbDriver});await p.getColumns();const f=this.getTnPath(d),h=this.getTnPath(p),g=this.dbDriver(f);await this.applySortAndFilter({table:d,where:s,qb:g,sort:o}),g.whereIn(c.column_name,this.dbDriver(h).select(u.column_name).where(D(p.primaryKeys,t))),g.limit(+(null==r?void 0:r.limit)||25),g.offset(+(null==r?void 0:r.offset)||0),await m.selectObject({qb:g,fieldsSet:a.fieldSet});const _=await this.execAndParse(g,d),b=await(await S.Model.getBaseModelSQL({id:d.id,dbDriver:this.dbDriver})).getProto();return _.map((e=>(e.__proto__=b,e)))}catch(e){throw console.log(e),e}}async hmListCount({colId:e,id:t}){try{const a=(await this.model.getColumns()).find((t=>t.id===e)),i=await(await a.getColOptions()).getChildColumn(),n=await i.getModel(),s=await(await a.getColOptions()).getParentColumn(),o=await s.getModel();await o.getColumns();const r=this.getTnPath(n),l=this.getTnPath(o),c=this.dbDriver(r).count(`${null==i?void 0:i.column_name} as count`).whereIn(i.column_name,this.dbDriver(l).select(s.column_name).where(D(o.primaryKeys,t))).first(),{count:d}=await c;return d}catch(e){throw console.log(e),e}}async multipleMmList({colId:e,parentIds:t},a={}){const n=this._getListArgs(a),{where:s,sort:r}=n,l=i(n,["where","sort"]),c=(await this.model.getColumns()).find((t=>t.id===e)),d=await c.getColOptions(),u=await d.getMMModel(),p=this.getTnPath(u),m=(await d.getMMChildColumn()).column_name,f=(await d.getMMParentColumn()).column_name,h=(await d.getParentColumn()).column_name,g=(await d.getChildColumn()).column_name,_=await(await d.getParentColumn()).getModel(),b=await(await d.getChildColumn()).getModel();await b.getColumns();const y=await S.Model.getBaseModelSQL({dbDriver:this.dbDriver,model:_}),w=this.getTnPath(_),v=this.getTnPath(b),T=w,O=_.id,E=this.dbDriver(T).join(p,`${p}.${f}`,`${T}.${h}`);await y.selectObject({qb:E,fieldsSet:a.fieldsSet}),await this.applySortAndFilter({table:_,where:s,qb:E,sort:r});const I=this.dbDriver.unionAll(t.map((e=>{const t=E.clone().whereIn(`${p}.${m}`,this.dbDriver(v).select(g).where(D(b.primaryKeys,e))).select(this.dbDriver.raw("? as ??",[e,x]));return t.limit(+(null==l?void 0:l.limit)||25),t.offset(+(null==l?void 0:l.offset)||0),this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite);let k=await this.execAndParse(I,_);this.isMySQL&&(k=k[0]);const C=await(await S.Model.getBaseModelSQL({id:O,dbDriver:this.dbDriver})).getProto(),j=(0,o.default)(k.map((e=>(e.__proto__=C,e))),x);return t.map((e=>j[e]||[]))}async mmList({colId:e,parentId:t},a={}){const n=this._getListArgs(a),{where:s,sort:o}=n,r=i(n,["where","sort"]),l=(await this.model.getColumns()).find((t=>t.id===e)),c=await l.getColOptions(),d=await c.getMMModel(),u=this.getTnPath(d),p=(await c.getMMChildColumn()).column_name,m=(await c.getMMParentColumn()).column_name,f=(await c.getParentColumn()).column_name,h=(await c.getChildColumn()).column_name,g=await(await c.getParentColumn()).getModel(),_=await(await c.getChildColumn()).getModel();await _.getColumns();const b=await S.Model.getBaseModelSQL({dbDriver:this.dbDriver,model:g}),y=this.getTnPath(g),w=this.getTnPath(_),v=y,T=g.id,O=this.dbDriver(v).join(u,`${u}.${m}`,`${v}.${f}`).whereIn(`${u}.${p}`,this.dbDriver(w).select(h).where(D(_.primaryKeys,t)));await b.selectObject({qb:O,fieldsSet:a.fieldsSet}),await this.applySortAndFilter({table:g,where:s,qb:O,sort:o}),O.limit(+(null==r?void 0:r.limit)||25),O.offset(+(null==r?void 0:r.offset)||0);const E=await this.execAndParse(O,g),I=await(await S.Model.getBaseModelSQL({id:T,dbDriver:this.dbDriver})).getProto();return E.map((e=>(e.__proto__=I,e)))}async multipleMmListCount({colId:e,parentIds:t}){const a=(await this.model.getColumns()).find((t=>t.id===e)),i=await a.getColOptions(),n=await i.getMMModel(),s=this.getTnPath(n),r=(await i.getMMChildColumn()).column_name,l=(await i.getMMParentColumn()).column_name,c=(await i.getParentColumn()).column_name,d=(await i.getChildColumn()).column_name,u=await(await i.getParentColumn()).getModel(),p=await(await i.getChildColumn()).getModel();await p.getColumns();const m=this.getTnPath(u),f=this.getTnPath(p),h=m,g=this.dbDriver(h).join(s,`${s}.${l}`,`${h}.${c}`).count(`${s}.${r}`,{as:"count"}),_=await this.dbDriver.unionAll(t.map((e=>{const t=g.clone().whereIn(`${s}.${r}`,this.dbDriver(f).select(d).where(D(p.primaryKeys,e))).select(this.dbDriver.raw("? as ??",[e,x]));return this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite),b=(0,o.default)(_,x);return t.map((e=>{var t;return(null===(t=null==b?void 0:b[e])||void 0===t?void 0:t[0])||[]}))}async mmListCount({colId:e,parentId:t}){const a=(await this.model.getColumns()).find((t=>t.id===e)),i=await a.getColOptions(),n=await i.getMMModel(),s=this.getTnPath(n),o=(await i.getMMChildColumn()).column_name,r=(await i.getMMParentColumn()).column_name,l=(await i.getParentColumn()).column_name,c=(await i.getChildColumn()).column_name,d=await(await i.getParentColumn()).getModel(),u=await(await i.getChildColumn()).getModel();await u.getColumns();const p=this.getTnPath(d),m=this.getTnPath(u),f=p,h=this.dbDriver(f).join(s,`${s}.${r}`,`${f}.${l}`).count(`${s}.${o}`,{as:"count"}).whereIn(`${s}.${o}`,this.dbDriver(m).select(c).where(D(u.primaryKeys,t))).first(),{count:g}=await h;return g}async getMmChildrenExcludedListCount({colId:e,pid:t=null},a){var i;const{where:n}=this._getListArgs(a),s=(await this.model.getColumns()).find((t=>t.id===e)),o=await s.getColOptions(),r=await o.getMMModel(),l=this.getTnPath(r),c=(await o.getMMChildColumn()).column_name,d=(await o.getMMParentColumn()).column_name,u=(await o.getParentColumn()).column_name,p=(await o.getChildColumn()).column_name,m=await(await o.getParentColumn()).getModel(),f=await(await o.getChildColumn()).getModel();await f.getColumns();const h=this.getTnPath(m),g=this.getTnPath(f),_=h,b=this.dbDriver(_).count("*",{as:"count"}).where((e=>{e.whereNotIn(u,this.dbDriver(_).select(`${_}.${u}`).join(l,`${_}.${u}`,`${l}.${d}`).whereIn(`${l}.${c}`,this.dbDriver(g).select(p).where(D(f.primaryKeys,t)))).orWhereNull(u)})),w=L(n,await m.getAliasColObjMap());return await(0,y.default)(this,w,b),null===(i=await b.first())||void 0===i?void 0:i.count}async getMmChildrenExcludedList({colId:e,pid:t=null},a){const n=this._getListArgs(a),{where:s}=n,o=i(n,["where"]),r=(await this.model.getColumns()).find((t=>t.id===e)),l=await r.getColOptions(),c=await l.getMMModel(),d=this.getTnPath(c),u=(await l.getMMChildColumn()).column_name,p=(await l.getMMParentColumn()).column_name,m=(await l.getParentColumn()).column_name,f=(await l.getChildColumn()).column_name,h=await(await l.getParentColumn()).getModel(),g=await S.Model.getBaseModelSQL({dbDriver:this.dbDriver,model:h}),_=await(await l.getChildColumn()).getModel();await _.getColumns();const b=this.getTnPath(h),w=this.getTnPath(_),v=b,T=this.dbDriver(v).where((e=>e.whereNotIn(m,this.dbDriver(v).select(`${v}.${m}`).join(d,`${v}.${m}`,`${d}.${p}`).whereIn(`${d}.${u}`,this.dbDriver(w).select(f).where(D(_.primaryKeys,t)))).orWhereNull(m)));+(null==o?void 0:o.shuffle)&&await this.shuffle({qb:T}),await g.selectObject({qb:T});const O=L(s,await h.getAliasColObjMap());await(0,y.default)(this,O,T),h.primaryKey&&h.primaryKey.ai?T.orderBy(h.primaryKey.column_name):h.columns.find((e=>"created_at"===e.column_name))&&T.orderBy("created_at"),q(T,o);const E=await g.getProto();return(await T).map((e=>(e.__proto__=E,e)))}async getHmChildrenExcludedListCount({colId:e,pid:t=null},a){var i;const{where:n}=this._getListArgs(a),s=(await this.model.getColumns()).find((t=>t.id===e)),o=await s.getColOptions(),r=(await o.getChildColumn()).column_name,l=(await o.getParentColumn()).column_name,c=await(await o.getChildColumn()).getModel(),d=await(await o.getParentColumn()).getModel(),u=this.getTnPath(c),p=this.getTnPath(d);await d.getColumns();const m=this.dbDriver(u).count("*",{as:"count"}).where((e=>{e.whereNotIn(r,this.dbDriver(p).select(l).where(D(d.primaryKeys,t))).orWhereNull(r)})),f=L(n,await c.getAliasColObjMap());return await(0,y.default)(this,f,m),null===(i=await m.first())||void 0===i?void 0:i.count}async getHmChildrenExcludedList({colId:e,pid:t=null},a){const n=this._getListArgs(a),{where:s}=n,o=i(n,["where"]),r=(await this.model.getColumns()).find((t=>t.id===e)),l=await r.getColOptions(),c=(await l.getChildColumn()).column_name,d=(await l.getParentColumn()).column_name,u=await(await l.getChildColumn()).getModel(),p=await(await l.getParentColumn()).getModel(),m=await S.Model.getBaseModelSQL({dbDriver:this.dbDriver,model:u});await p.getColumns();const f=this.getTnPath(u),h=this.getTnPath(p),g=this.dbDriver(f).where((e=>{e.whereNotIn(c,this.dbDriver(h).select(d).where(D(p.primaryKeys,t))).orWhereNull(c)}));+(null==o?void 0:o.shuffle)&&await this.shuffle({qb:g}),await m.selectObject({qb:g});const _=L(s,await u.getAliasColObjMap());await(0,y.default)(this,_,g),u.primaryKey&&u.primaryKey.ai?g.orderBy(u.primaryKey.column_name):u.columns.find((e=>"created_at"===e.column_name))&&g.orderBy("created_at"),q(g,o);const b=await m.getProto();return(await this.execAndParse(g,u)).map((e=>(e.__proto__=b,e)))}async getBtChildrenExcludedListCount({colId:e,cid:t=null},a){var i;const{where:n}=this._getListArgs(a),s=(await this.model.getColumns()).find((t=>t.id===e)),o=await s.getColOptions(),r=(await o.getParentColumn()).column_name,l=await(await o.getParentColumn()).getModel(),c=(await o.getChildColumn()).column_name,d=await(await o.getChildColumn()).getModel(),u=this.getTnPath(d),p=this.getTnPath(l),m=u;await d.getColumns();const f=this.dbDriver(p).where((e=>{e.whereNotIn(r,this.dbDriver(m).select(c).where(D(d.primaryKeys,t)).whereNotNull(c))})).count("*",{as:"count"}),h=L(n,await l.getAliasColObjMap());return await(0,y.default)(this,h,f),null===(i=await f.first())||void 0===i?void 0:i.count}async getBtChildrenExcludedList({colId:e,cid:t=null},a){const n=this._getListArgs(a),{where:s}=n,o=i(n,["where"]),r=(await this.model.getColumns()).find((t=>t.id===e)),l=await r.getColOptions(),c=(await l.getParentColumn()).column_name,d=await(await l.getParentColumn()).getModel(),u=(await l.getChildColumn()).column_name,p=await(await l.getChildColumn()).getModel(),m=await S.Model.getBaseModelSQL({dbDriver:this.dbDriver,model:d}),f=this.getTnPath(p),h=this.getTnPath(d),g=f;await p.getColumns();const _=this.dbDriver(h).where((e=>{e.whereNotIn(c,this.dbDriver(g).select(u).where(D(p.primaryKeys,t)).whereNotNull(u)).orWhereNull(c)}));+(null==o?void 0:o.shuffle)&&await this.shuffle({qb:_}),await m.selectObject({qb:_});const b=L(s,await d.getAliasColObjMap());await(0,y.default)(this,b,_),d.primaryKey&&d.primaryKey.ai?_.orderBy(d.primaryKey.column_name):d.columns.find((e=>"created_at"===e.column_name))&&_.orderBy("created_at"),q(_,o);const w=await m.getProto();return(await this.execAndParse(_,p)).map((e=>(e.__proto__=w,e)))}async getSelectQueryBuilderForFormula(e,t,a=!1,i={}){const n=await e.getColOptions();if(n.error)throw new Error(`Formula error: ${n.error}`);return await(0,_.default)(this,n.formula,null,this.model,e,i,t,a)}async getProto(){var e;if(this._proto)return this._proto;const t={__columnAliases:{}},a=await this.model.getColumns();for(const i of a)switch(i.uidt){case p.UITypes.Lookup:{const a=await i.getColOptions(),n=await S.Column.get({colId:a.fk_relation_column_id}),s=n.uidt===p.UITypes.Links?`_nc_lk_${n.title}`:n.title;t.__columnAliases[i.title]={path:[s,null===(e=await S.Column.get({colId:a.fk_lookup_column_id}))||void 0===e?void 0:e.title]}}break;case p.UITypes.Links:case p.UITypes.LinkToAnotherRecord:{this._columns[i.title]=i;const e=await i.getColOptions();if("hm"===(null==e?void 0:e.type)){const e=new r.default((async t=>{if(t.length>1){const a=await this.multipleHmList({colId:i.id,ids:t},e.args);return t.map((e=>a[e]?a[e]:[]))}return[await this.hmList({colId:i.id,id:t[0]},e.args)]})),a=this;t[i.uidt===p.UITypes.Links?`_nc_lk_${i.title}`:i.title]=async function(t){return e.args=t,e.load(U(a.model.primaryKeys,this))}}else if("mm"===e.type){const e=new r.default((async t=>{if((null==t?void 0:t.length)>1){return await this.multipleMmList({parentIds:t,colId:i.id},e.args)}return[await this.mmList({parentId:t[0],colId:i.id},e.args)]})),a=this;t[i.uidt===p.UITypes.Links?`_nc_lk_${i.title}`:i.title]=async function(t){return e.args=t,await e.load(U(a.model.primaryKeys,this))}}else if("bt"===e.type){const e=await i.getColOptions(),a=await S.Column.get({colId:e.fk_parent_column_id}),n=await S.Column.get({colId:e.fk_child_column_id}),s=new r.default((async e=>{var t;const i=await(await S.Model.getBaseModelSQL({id:a.fk_model_id,dbDriver:this.dbDriver})).list({where:`(${a.column_name},in,${e.join(",")})`,fieldsSet:null===(t=s.args)||void 0===t?void 0:t.fieldsSet},!0),n=(0,o.default)(i,a.title);return e.map((async e=>{var t;return null===(t=null==n?void 0:n[e])||void 0===t?void 0:t[0]}))}));t[i.title]=async function(e){return null===(null==this?void 0:this[null==n?void 0:n.title])||void 0===(null==this?void 0:this[null==n?void 0:n.title])?null:(s.args=e,await s.load(null==this?void 0:this[null==n?void 0:n.title]))}}}}return this._proto=t,t}_getListArgs(e){const t=(0,T.extractLimitAndOffset)(e);return t.where=e.filter||e.where||e.w||"",t.having=e.having||e.h||"",t.shuffle=e.shuffle||e.r||"",t.condition=e.condition||e.c||{},t.conditionGraph=e.conditionGraph||{},t.limit=Math.max(Math.min(e.limit||e.l||N.config.limitDefault,N.config.limitMax),N.config.limitMin),t.offset=Math.max(+(e.offset||e.o)||0,0),t.fields=e.fields||e.f,t.sort=e.sort||e.s,t}async shuffle({qb:e}){this.isMySQL?e.orderByRaw("RAND()"):this.isPg||this.isSqlite?e.orderByRaw("RANDOM()"):this.isMssql&&e.orderByRaw("NEWID()")}async selectObject({qb:e,columns:t,fields:a,extractPkAndPv:i,viewId:n,fieldsSet:s,alias:o,validateFormula:r}){var l;const c={};let d;const u={};let m,f;if(null==s?void 0:s.size)d=t||await this.model.getColumns();else{m=await S.View.get(n);const e=n&&await S.View.getColumns(n);f=Array.isArray(a)?a:null==a?void 0:a.split(","),d=t||e||await this.model.getColumns()}for(const t of d){const a=t instanceof S.Column?t:await S.Column.get({colId:t.fk_column_id});if(!F(s,t,m,a,i)&&M(a,f,i))switch(a.uidt){case p.UITypes.DateTime:if(this.isMySQL){u[(0,I.sanitize)(a.title||a.column_name)]=this.dbDriver.raw("CONVERT_TZ(??, @@GLOBAL.time_zone, '+00:00')",[`${(0,I.sanitize)(o||this.tnPath)}.${a.column_name}`]);break}if(this.isPg){if("timestamp with time zone"!==a.dt&&"timestamptz"!==a.dt){u[(0,I.sanitize)(a.title||a.column_name)]=this.dbDriver.raw("?? AT TIME ZONE CURRENT_SETTING('timezone') AT TIME ZONE 'UTC'",[`${(0,I.sanitize)(o||this.tnPath)}.${a.column_name}`]).wrap("(",")");break}}else if(this.isMssql&&"datetimeoffset"!==a.dt){u[(0,I.sanitize)(a.title||a.column_name)]=this.dbDriver.raw("CONVERT(DATETIMEOFFSET, ?? AT TIME ZONE 'UTC')",[`${(0,I.sanitize)(o||this.tnPath)}.${a.column_name}`]);break}u[(0,I.sanitize)(a.title||a.column_name)]=(0,I.sanitize)(`${o||this.tnPath}.${a.column_name}`);break;case p.UITypes.LinkToAnotherRecord:case p.UITypes.Lookup:break;case p.UITypes.QrCode:{const t=await a.getColOptions(),i=await S.Column.get({colId:t.fk_qr_value_column_id});if(null==i)break;if(i.uidt===p.UITypes.Formula)try{const t=await this.getSelectQueryBuilderForFormula(i,o,r,c);e.select({[a.column_name]:t.builder})}catch(e){continue}else e.select({[a.column_name]:i.column_name});break}case p.UITypes.Barcode:{const t=await a.getColOptions(),i=await S.Column.get({colId:t.fk_barcode_value_column_id});if(null==i)break;if(i.uidt===p.UITypes.Formula)try{const t=await this.getSelectQueryBuilderForFormula(i,o,r,c);e.select({[a.column_name]:t.builder})}catch(e){continue}else e.select({[a.column_name]:i.column_name});break}case p.UITypes.Formula:try{const t=await this.getSelectQueryBuilderForFormula(a,o,r,c);e.select(this.dbDriver.raw("?? as ??",[t.builder,(0,I.sanitize)(a.title)]))}catch(t){console.log(t),e.select(this.dbDriver.raw("'ERR' as ??",[(0,I.sanitize)(a.title)]))}break;case p.UITypes.Rollup:case p.UITypes.Links:e.select((await(0,b.default)({baseModelSqlv2:this,knex:this.dbDriver,alias:o,columnOptions:await a.getColOptions()})).builder.as((0,I.sanitize)(a.title)));break;default:if(this.isPg&&"bytea"===a.dt){u[(0,I.sanitize)(a.title||a.column_name)]=this.dbDriver.raw(`encode(??.??, '${"hex"===(null===(l=a.meta)||void 0===l?void 0:l.format)?"hex":"escape"}')`,[o||this.model.table_name,a.column_name]);break}u[(0,I.sanitize)(a.title||a.column_name)]=(0,I.sanitize)(`${o||this.tnPath}.${a.column_name}`)}}e.select(u)}async insert(e,t,a,i=!1){var n,s,o;try{await A(this.model,e);const i=await this.model.mapAliasToColumn(e,this.clientMeta,this.dbDriver);let r;await this.validate(i),"beforeInsert"in this&&await this.beforeInsert(i,t,a),await this.model.getColumns();const l=this.dbDriver(this.tnPath).insert(i);(this.isPg||this.isMssql)&&this.model.primaryKey&&(l.returning(`${this.model.primaryKey.column_name} as ${this.model.primaryKey.title}`),r=await this.execAndParse(l));const c=this.model.columns.find((e=>e.ai));let d;if(c||(d=this.model.columns.find((e=>{var t;return null===(t=e.meta)||void 0===t?void 0:t.ag}))),d)r||await this.execAndParse(l),r=await this.readByPk(e[d.title],!1,{},{ignoreView:!0,getHiddenColumn:!0});else if(!r||"object"!=typeof(null==r?void 0:r[0])&&null!==(null==r?void 0:r[0])){let t;if(null==r?void 0:r.length)t=r[0];else{const e=await this.execAndParse(l);t=null!==(n=null==e?void 0:e.id)&&void 0!==n?n:null===(s=e[0])||void 0===s?void 0:s.insertId}c?(this.isSqlite?t=(await this.dbDriver(this.tnPath).select(c.column_name).max(c.column_name,{as:"id"}))[0].id:this.isSnowflake&&(t=(await this.dbDriver(this.tnPath).max(c.column_name,{as:"id"}))[0].id),r=await this.readByPk(t,!1,{},{ignoreView:!0,getHiddenColumn:!0})):r=e}else if(c){const e=Array.isArray(r)?null===(o=null==r?void 0:r[0])||void 0===o?void 0:o[c.title]:null==r?void 0:r[c.title];r=await this.readByPk(e,!1,{},{ignoreView:!0,getHiddenColumn:!0})}return await this.afterInsert(r,t,a),Array.isArray(r)?r[0]:r}catch(i){throw console.log(i),await this.errorInsert(i,e,t,a),i}}async delByPk(e,t,a){let i=t;try{const n=await this.readByPk(e,!1,{},{ignoreView:!0,getHiddenColumn:!0});await this.beforeDelete(e,i,a);const s=[];for(const t of this.model.columns){if(t.uidt!==p.UITypes.LinkToAnotherRecord)continue;const a=await t.getColOptions();switch(a.type){case"mm":{const t=await S.Model.get(a.fk_mm_model_id),i=await S.Column.get({colId:a.fk_mm_child_column_id});s.push((a=>a(this.getTnPath(t.table_name)).del().where(i.column_name,e)))}break;case"hm":{const t=await a.getRelatedTable();if(t.mm)break;const i=await S.Column.get({colId:a.fk_child_column_id});s.push((a=>a(this.getTnPath(t.table_name)).update({[i.column_name]:null}).where(i.column_name,e)))}}}const o=await this._wherePk(e);i||(i=await this.dbDriver.transaction()),await Promise.all(s.map((e=>e(i))));const r=await i(this.tnPath).del().where(o);return t||await i.commit(),await this.afterDelete(n,i,a),r}catch(n){throw console.log(n),t||await i.rollback(),await this.errorDelete(n,e,i,a),n}}async hasLTARData(e,t){const a=[],i=(await t.getColumns()).filter((e=>e.uidt===p.UITypes.LinkToAnotherRecord));let n=0;for(const s of i){const i=await s.getColOptions(),o=await i.getChildColumn(),r=await i.getParentColumn(),l=await o.getModel();await l.getColumns();const c=await r.getModel();await c.getColumns();let d=0;if(i.type===p.RelationTypes.HAS_MANY)d=+(await this.dbDriver(this.getTnPath(l.table_name)).count(o.column_name,{as:"cnt"}).where(o.column_name,e))[0].cnt;else if(i.type===p.RelationTypes.MANY_TO_MANY){const t=await i.getMMModel(),a=await i.getMMChildColumn();d=+(await this.dbDriver(this.getTnPath(t.table_name)).where(`${this.getTnPath(t.table_name)}.${a.column_name}`,e).count(a.column_name,{as:"cnt"}))[0].cnt}d&&a.push(`${1+n++}. ${t.title}.${s.title} is a LinkToAnotherRecord of ${l.title}`)}return a}async updateByPk(e,t,a,i,n=!1){try{const n=await this.model.mapAliasToColumn(t,this.clientMeta,this.dbDriver);await this.validate(t),await this.beforeUpdate(t,a,i);const s=await this.readByPk(e,!1,{},{ignoreView:!0,getHiddenColumn:!0}),o=this.dbDriver(this.tnPath).update(n).where(await this._wherePk(e));await this.execAndParse(o);const r=await this.readByPk(e,!1,{},{ignoreView:!0,getHiddenColumn:!0});return await this.afterUpdate(s,r,a,i,n),r}catch(e){throw console.log(e),await this.errorUpdate(e,t,a,i),e}}async _wherePk(e){return await this.model.getColumns(),D(this.model.primaryKeys,e)}getTnPath(e,t){var a,i;const n="string"==typeof e?e:e.table_name,s=null===(i=(a=this.dbDriver).searchPath)||void 0===i?void 0:i.call(a);return this.isMssql&&s?this.dbDriver.raw("??.??"+(t?" as ??":""),[s,n,...t?[t]:[]]):this.isSnowflake?`${[this.dbDriver.client.config.connection.database,this.dbDriver.client.config.connection.schema,n].join(".")}${t?` as ${t}`:""}`:`${n}${t?` as ${t}`:""}`}get tnPath(){return this.getTnPath(this.model)}get clientMeta(){return{isSqlite:this.isSqlite,isMssql:this.isMssql,isPg:this.isPg,isMySQL:this.isMySQL}}get isSqlite(){return"sqlite3"===this.clientType}get isMssql(){return"mssql"===this.clientType}get isPg(){return"pg"===this.clientType}get isMySQL(){return"mysql2"===this.clientType||"mysql"===this.clientType}get isSnowflake(){return"snowflake"===this.clientType}get clientType(){return this.dbDriver.clientType()}async nestedInsert(e,t=null,a){var i;try{await A(this.model,e);const t=await this.model.mapAliasToColumn(e,this.clientMeta,this.dbDriver);let n=null;const s=[],o=(await this.model.getColumns()).filter((e=>(0,p.isLinksOrLTAR)(e)));for(const a of o)if(a.title in e){const i=await a.getColOptions(),o="string"==typeof e[a.title]?JSON.parse(e[a.title]):e[a.title];switch(i.type){case p.RelationTypes.BELONGS_TO:{const e=await i.getChildColumn(),a=await i.getParentColumn();t[e.column_name]=null==o?void 0:o[a.title]}break;case p.RelationTypes.HAS_MANY:{const e=await i.getChildColumn(),t=await e.getModel();await t.getColumns(),s.push((async()=>{await this.dbDriver(this.getTnPath(t.table_name)).update({[e.column_name]:n}).whereIn(t.primaryKey.column_name,null==o?void 0:o.map((e=>e[t.primaryKey.title])))}))}break;case p.RelationTypes.MANY_TO_MANY:s.push((async()=>{const e=await i.getParentColumn().then((e=>e.getModel()));await e.getColumns();const t=await i.getMMParentColumn(),a=await i.getMMChildColumn(),s=await i.getMMModel(),r=o.map((i=>({[t.column_name]:i[e.primaryKey.title],[a.column_name]:n})));await this.dbDriver(this.getTnPath(s.table_name)).insert(r)}))}}let r;await this.validate(t),await this.beforeInsert(t,this.dbDriver,a);const l=this.dbDriver(this.tnPath).insert(t);(this.isPg||this.isMssql)&&(l.returning(`${this.model.primaryKey.column_name} as ${this.model.primaryKey.title}`),r=await l);const c=this.model.columns.find((e=>e.ai));if(!r||"object"!=typeof(null==r?void 0:r[0])&&null!==(null==r?void 0:r[0])){let t;t=(null==r?void 0:r.length)?r[0]:(await l)[0],c?(this.isSqlite?t=(await this.dbDriver(this.tnPath).select(c.column_name).max(c.column_name,{as:"id"}))[0].id:this.isSnowflake&&(t=(await this.dbDriver(this.tnPath).max(c.column_name,{as:"id"})).rows[0].id),r=await this.readByPk(t,!1,{},{ignoreView:!0,getHiddenColumn:!0})):r=e}else c&&(r=await this.readByPk(Array.isArray(r)?null===(i=null==r?void 0:r[0])||void 0===i?void 0:i[c.title]:null==r?void 0:r[c.title]));return r=Array.isArray(r)?r[0]:r,r&&(n=r[this.model.primaryKey.title]||r[this.model.primaryKey.column_name]),await Promise.all(s.map((e=>e()))),await this.afterInsert(r,this.dbDriver,a),r}catch(e){throw console.log(e),e}}async bulkInsert(e,{chunkSize:t=100,cookie:a,foreign_key_checks:i=!0,skip_hooks:n=!1,raw:s=!1,insertOneByOneAsFallback:o=!1}={}){var r,c,d,u;let f;try{const h=s?e:[];if(!s){await this.model.getColumns();for(const t of e){const e={};for(let a=0;a<this.model.columns.length;++a){const i=this.model.columns[a];if(i.pk&&(null===(r=i.meta)||void 0===r?void 0:r.ag)&&!t[i.title]&&(t[i.title]="nc"===(null===(c=i.meta)||void 0===c?void 0:c.ag)?`rc_${R()}`:(0,g.v4)()),!(0,p.isVirtualCol)(i)){let a=void 0!==(null==t?void 0:t[i.column_name])?null==t?void 0:t[i.column_name]:null==t?void 0:t[i.title];if(void 0!==a){if(i.uidt===p.UITypes.Attachment&&"string"!=typeof a&&(a=JSON.stringify(a)),i.uidt===p.UITypes.DateTime&&(0,l.default)(a).isValid()){const{isMySQL:e,isSqlite:t,isMssql:i,isPg:n}=this.clientMeta;a.indexOf("-")<0&&a.indexOf("+")<0&&"Z"!==a.slice(-1)&&(a+="+00:00"),a=e?this.dbDriver.raw("CONVERT_TZ(?, '+00:00', @@GLOBAL.time_zone)",[(0,l.default)(a).utc().format("YYYY-MM-DD HH:mm:ss")]):t?(0,l.default)(a).utc().format("YYYY-MM-DD HH:mm:ssZ"):n?this.dbDriver.raw("? AT TIME ZONE CURRENT_SETTING('timezone')",[(0,l.default)(a).utc().format("YYYY-MM-DD HH:mm:ssZ")]):i?this.dbDriver.raw("SWITCHOFFSET(CONVERT(datetimeoffset, ?), DATENAME(TzOffset, SYSDATETIMEOFFSET()))",[(0,l.default)(a).utc().format("YYYY-MM-DD HH:mm:ssZ")]):(0,l.default)(a).utc().format("YYYY-MM-DD HH:mm:ssZ")}e[(0,I.sanitize)(i.column_name)]=a}}if((null===(d=null==i?void 0:i.meta)||void 0===d?void 0:d.validate)&&(null==i?void 0:i.validate)){const t=i.getValidators(),a=i.column_name,n=i.title;if(t){const{func:i,msg:s}=t;for(let t=0;t<i.length;++t){const o="string"==typeof i[t]?v.customValidators[i[t]]?v.customValidators[i[t]]:m.default[i[t]]:i[t],r=(null==e?void 0:e[a])||(null==e?void 0:e[n]),l="string"==typeof i[t]?r+"":r;[null,void 0,""].includes(r)||("AsyncFunction"===o.constructor.name?await o(l):o(l))||O.NcError.badRequest(s[t].replace(/\{VALUE}/g,r).replace(/\{cn}/g,n))}}}}h.push(e)}}const _=this.isSqlite?10:t;let b;if(f=await this.dbDriver.transaction(),i||(this.isPg?await f.raw("set session_replication_role to replica;"):this.isMySQL&&await f.raw("SET foreign_key_checks = 0;")),o&&(this.isSqlite||this.isMySQL)){b=[];const e=this.model.primaryKeys.find((e=>e.ai));for(const t of h){const a=f(this.tnPath).insert(t),i=(await a)[0];b.push(e?{[e.title]:i}:i)}}else b=this.isPg||this.isMssql?await f.batchInsert(this.tnPath,h,_).returning(null===(u=this.model.primaryKey)||void 0===u?void 0:u.column_name):await f.batchInsert(this.tnPath,h,_);return i||(this.isPg?await f.raw("set session_replication_role to origin;"):this.isMySQL&&await f.raw("SET foreign_key_checks = 1;")),await f.commit(),s||n||await this.afterBulkInsert(h,this.dbDriver,a),b}catch(e){throw await(null==f?void 0:f.rollback()),e}}async bulkUpdate(e,{cookie:t,raw:a=!1,throwExceptionIfNotExist:i=!1}={}){let n;try{a&&await this.model.getColumns();const s=a?e:await Promise.all(e.map((e=>this.model.mapAliasToColumn(e,this.clientMeta,this.dbDriver)))),o=[],r=[],l=[],c=[],d=[];for(const e of s){a||await this.validate(e);const t=await this._extractPksValues(e);if(!t)continue;a||o.push(await this.readByPk(t));const i=await this._wherePk(t);d.push(i),c.push({d:e,wherePk:i}),l.push(t)}n=await this.dbDriver.transaction();for(const e of c)await n(this.tnPath).update(e.d).where(e.wherePk);if(await n.commit(),!a)for(const e of l){const t=await this.readByPk(e);!t&&i&&O.NcError.unprocessableEntity(`Record with pk ${JSON.stringify(e)} not found`),r.push(t)}return a||await this.afterBulkUpdate(o,r,this.dbDriver,t),d}catch(e){throw n&&await n.rollback(),e}}async bulkUpdateAll(e={},t,{cookie:a}={}){try{let i=0;const n=await this.model.mapAliasToColumn(t,this.clientMeta,this.dbDriver);await this.validate(n);if(await this._extractPksValues(n));else{await this.model.getColumns();const{where:t}=this._getListArgs(e),a=this.dbDriver(this.tnPath),s=L(t,await this.model.getAliasColObjMap()),o=[new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:s,is_group:!0,logical_op:"and"})];e.viewId&&o.push(new S.Filter({children:await S.Filter.rootFilterList({viewId:e.viewId})||[],is_group:!0})),await(0,y.default)(this,o,a),a.update(n),i=await a}return await this.afterBulkUpdate(null,i,this.dbDriver,a,!0),i}catch(e){throw e}}async bulkDelete(e,{cookie:t,throwExceptionIfNotExist:a=!1}={}){let i;try{const n=await Promise.all(e.map((e=>this.model.mapAliasToColumn(e,this.clientMeta,this.dbDriver)))),s=[],o=[];for(const e of n){const t=await this._extractPksValues(e);if(!t)continue;const i=await this.readByPk(t);!i&&a&&O.NcError.unprocessableEntity(`Record with pk ${JSON.stringify(t)} not found`),s.push(i),o.push(e)}const r=[],l=await S.Base.get(this.model.base_id);for(const e of this.model.columns){if(e.uidt!==p.UITypes.LinkToAnotherRecord)continue;const t=await e.getColOptions();switch(t.type){case"mm":{const e=await S.Model.get(t.fk_mm_model_id),a=await S.Column.get({colId:t.fk_mm_child_column_id});r.push(((t,i)=>t(this.getTnPath(e.table_name)).del().whereIn(a.column_name,i)))}break;case"hm":{const e=await t.getRelatedTable();if(e.mm)break;const a=await S.Column.get({colId:t.fk_child_column_id});r.push(((t,i)=>t(this.getTnPath(e.table_name)).update({[a.column_name]:null}).whereIn(a.column_name,i)))}}}const c=o.map((e=>e[this.model.primaryKey.column_name]));if(i=await this.dbDriver.transaction(),l.isMeta()&&r.length>0)for(const e of r)await e(i,c);for(const e of o)await i(this.tnPath).del().where(e);return await i.commit(),await this.afterBulkDelete(s,this.dbDriver,t),o}catch(e){throw i&&await i.rollback(),console.log(e),e}}async bulkDeleteAll(e={},{cookie:t}={}){let a;try{await this.model.getColumns();const{where:i}=this._getListArgs(e),n=this.dbDriver(this.tnPath),s=L(i,await this.model.getAliasColObjMap());await(0,y.default)(this,[new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:s,is_group:!0,logical_op:"and"})],n);const o=[];for(const e of this.model.columns){if(e.uidt!==p.UITypes.LinkToAnotherRecord)continue;const t=await e.getColOptions();if("bt"===t.type)continue;const a=await t.getChildColumn(),i=await t.getParentColumn(),n=await i.getModel(),s=await a.getModel();await s.getColumns(),await n.getColumns();const r=this.getTnPath(s);switch(t.type){case"mm":{const e=await t.getMMChildColumn(),i=await t.getMMModel(),n=this.getTnPath(i);o.push((()=>this.dbDriver(n).where({[e.column_name]:this.dbDriver(r).select(a.column_name).first()}).delete()))}break;case"hm":{if((await t.getRelatedTable()).mm)break;const e=await S.Column.get({colId:t.fk_child_column_id});o.push(((t,a)=>t(r).where({[e.column_name]:this.dbDriver.from(a.select(i.column_name).first().as("___cn_alias"))}).update({[e.column_name]:null})))}}}const r=await S.Base.get(this.model.base_id);if(a=await this.dbDriver.transaction(),r.isMeta())for(const e of o)await e(a,n.clone());const l=n.clone().transacting(a).del(),c=await l;return await a.commit(),await this.afterBulkDelete(c,this.dbDriver,t,!0),c}catch(e){throw e}}async beforeInsert(e,t,a){await this.handleHooks("before.insert",null,e,a)}async afterInsert(e,t,a){var i;await this.handleHooks("after.insert",null,e,a);const n=this._extractPksValues(e);await S.Audit.insert({fk_model_id:this.model.id,row_id:n,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.INSERT,description:h.default.sanitize(`Record with ID ${n} has been inserted into Table ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(i=null==a?void 0:a.user)||void 0===i?void 0:i.email})}async afterBulkUpdate(e,t,a,i,n=!1){var s;let o=t;n||(o=t.length,await this.handleHooks("after.bulkUpdate",e,t,i)),await S.Audit.insert({fk_model_id:this.model.id,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.BULK_UPDATE,description:h.default.sanitize(`${o} ${o>1?"records have":"record has"} been bulk updated in ${this.model.title}`),ip:null==i?void 0:i.clientIp,user:null===(s=null==i?void 0:i.user)||void 0===s?void 0:s.email})}async afterBulkDelete(e,t,a,i=!1){var n;let s=e;i||(s=e.length,await this.handleHooks("after.bulkDelete",null,e,a)),await S.Audit.insert({fk_model_id:this.model.id,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.BULK_DELETE,description:h.default.sanitize(`${s} ${s>1?"records have":"record has"} been bulk deleted in ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(n=null==a?void 0:a.user)||void 0===n?void 0:n.email})}async afterBulkInsert(e,t,a){var i;await this.handleHooks("after.bulkInsert",null,e,a),await S.Audit.insert({fk_model_id:this.model.id,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.BULK_INSERT,description:h.default.sanitize(`${e.length} ${e.length>1?"records have":"record has"} been bulk inserted in ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(i=null==a?void 0:a.user)||void 0===i?void 0:i.email})}async beforeUpdate(e,t,a){var i;const n=null===(i=a.query)||void 0===i?void 0:i.ignoreWebhook;if(n&&"true"!=n&&"false"!=n)throw new Error("ignoreWebhook value can be either true or false");void 0!==n&&"false"!==n||await this.handleHooks("before.update",null,e,a)}async afterUpdate(e,t,a,i,n){var s,o;const r=this._extractPksValues(t);let l=`Record with ID ${r} has been updated in Table ${this.model.title}.`,c="";if(n){n=await this.model.mapColumnToAlias(n);for(const a of Object.keys(n)){const i="object"==typeof e[a]?JSON.stringify(e[a]):e[a],n="object"==typeof t[a]?JSON.stringify(t[a]):t[a];l+="\n",l+=`Column "${a}" got changed from "${i}" to "${n}"`,c+=h.default.sanitize(`<span class="">${a}</span>\n  : <span class="text-decoration-line-through red px-2 lighten-4 black--text">${i}</span>\n  <span class="black--text green lighten-4 px-2">${n}</span>`)}}await S.Audit.insert({fk_model_id:this.model.id,row_id:r,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.UPDATE,description:h.default.sanitize(l),details:c,ip:null==i?void 0:i.clientIp,user:null===(s=null==i?void 0:i.user)||void 0===s?void 0:s.email});const d=null===(o=i.query)||void 0===o?void 0:o.ignoreWebhook;if(d&&"true"!=d&&"false"!=d)throw new Error("ignoreWebhook value can be either true or false");void 0!==d&&"false"!==d||await this.handleHooks("after.update",e,t,i)}async beforeDelete(e,t,a){await this.handleHooks("before.delete",null,e,a)}async afterDelete(e,t,a){var i,n;const s=null===(i=null==a?void 0:a.params)||void 0===i?void 0:i.id;await S.Audit.insert({fk_model_id:this.model.id,row_id:s,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.DELETE,description:h.default.sanitize(`Record with ID ${s} has been deleted in Table ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(n=null==a?void 0:a.user)||void 0===n?void 0:n.email}),await this.handleHooks("after.delete",null,e,a)}async handleHooks(e,t,a,i){k.default.eventEmitter.emit(C.HANDLE_WEBHOOK,{hookName:e,prevData:t,newData:a,user:null==i?void 0:i.user,viewId:this.viewId,modelId:this.model.id,tnPath:this.tnPath})}async errorInsert(e,t,a,i){}async errorUpdate(e,t,a,i){}_extractPksValues(e){return this.model.primaryKey?e[this.model.primaryKey.title]||e[this.model.primaryKey.column_name]:"N/A"}async errorDelete(e,t,a,i){}async validate(e){var t;await this.model.getColumns();for(let a=0;a<this.model.columns.length;++a){const i=this.model.columns[a];if(!(null===(t=null==i?void 0:i.meta)||void 0===t?void 0:t.validate)||!(null==i?void 0:i.validate))continue;const n=i.getValidators(),s=i.column_name,o=i.title;if(!n)continue;const{func:r,msg:l}=n;for(let t=0;t<r.length;++t){const a="string"==typeof r[t]?v.customValidators[r[t]]?v.customValidators[r[t]]:m.default[r[t]]:r[t],i=(null==e?void 0:e[s])||(null==e?void 0:e[o]),n="string"==typeof r[t]?i+"":i;[null,void 0,""].includes(i)||("AsyncFunction"===a.constructor.name?await a(n):a(n))||O.NcError.badRequest(l[t].replace(/\{VALUE}/g,i).replace(/\{cn}/g,o))}}return!0}async addChild({colId:e,rowId:t,childId:a,cookie:i}){const n=(await this.model.getColumns()).find((t=>t.id===e));n&&[p.UITypes.LinkToAnotherRecord,p.UITypes.Links].includes(n.uidt)||O.NcError.notFound("Column not found");const s=await n.getColOptions(),o=await s.getChildColumn(),r=await s.getParentColumn(),l=await r.getModel(),c=await o.getModel();await c.getColumns(),await l.getColumns();const d=this.getTnPath(c),u=this.getTnPath(l);switch(s.type){case p.RelationTypes.MANY_TO_MANY:{const e=await s.getMMChildColumn(),i=await s.getMMParentColumn(),n=await s.getMMModel(),p=this.getTnPath(n);if(this.isSnowflake){const n=this.dbDriver(u).select(r.column_name).where(D(l.primaryKeys,a)).first(),s=this.dbDriver(d).select(o.column_name).where(D(c.primaryKeys,t)).first();await this.dbDriver.raw(`INSERT INTO ?? (??, ??) SELECT (${n.toQuery()}), (${s.toQuery()})`,[p,i.column_name,e.column_name])}else await this.dbDriver(p).insert({[i.column_name]:this.dbDriver(u).select(r.column_name).where(D(l.primaryKeys,a)).first(),[e.column_name]:this.dbDriver(d).select(o.column_name).where(D(c.primaryKeys,t)).first()})}break;case p.RelationTypes.HAS_MANY:await this.dbDriver(d).update({[o.column_name]:this.dbDriver.from(this.dbDriver(u).select(r.column_name).where(D(l.primaryKeys,t)).first().as("___cn_alias"))}).where(D(c.primaryKeys,a));break;case p.RelationTypes.BELONGS_TO:await this.dbDriver(d).update({[o.column_name]:this.dbDriver.from(this.dbDriver(u).select(r.column_name).where(D(l.primaryKeys,a)).first().as("___cn_alias"))}).where(D(c.primaryKeys,t))}const m=await this.readByPk(t,!1,{},{ignoreView:!0,getHiddenColumn:!0});await this.afterInsert(m,this.dbDriver,i),await this.afterAddChild(t,a,i)}async afterAddChild(e,t,a){var i;await S.Audit.insert({fk_model_id:this.model.id,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.LINK_RECORD,row_id:e,description:h.default.sanitize(`Record [id:${t}] has been linked with record [id:${e}] in ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(i=null==a?void 0:a.user)||void 0===i?void 0:i.email})}async removeChild({colId:e,rowId:t,childId:a,cookie:i}){const n=(await this.model.getColumns()).find((t=>t.id===e));n&&[p.UITypes.LinkToAnotherRecord,p.UITypes.Links].includes(n.uidt)||O.NcError.notFound("Column not found");const s=await n.getColOptions(),o=await s.getChildColumn(),r=await s.getParentColumn(),l=await r.getModel(),c=await o.getModel();await c.getColumns(),await l.getColumns();const d=this.getTnPath(c),u=this.getTnPath(l),m=await this.readByPk(t,!1,{},{ignoreView:!0,getHiddenColumn:!0});switch(s.type){case p.RelationTypes.MANY_TO_MANY:{const e=await s.getMMChildColumn(),i=await s.getMMParentColumn(),n=await s.getMMModel(),p=this.getTnPath(n);await this.dbDriver(p).where({[i.column_name]:this.dbDriver(u).select(r.column_name).where(D(l.primaryKeys,a)).first(),[e.column_name]:this.dbDriver(d).select(o.column_name).where(D(c.primaryKeys,t)).first()}).delete()}break;case p.RelationTypes.HAS_MANY:await this.dbDriver(d).where(D(c.primaryKeys,a)).update({[o.column_name]:null});break;case p.RelationTypes.BELONGS_TO:await this.dbDriver(d).where(D(c.primaryKeys,t)).update({[o.column_name]:null})}const f=await this.readByPk(t,!1,{},{ignoreView:!0,getHiddenColumn:!0});await this.afterUpdate(m,f,this.dbDriver,i),await this.afterRemoveChild(t,a,i)}async afterRemoveChild(e,t,a){var i;await S.Audit.insert({fk_model_id:this.model.id,op_type:p.AuditOperationTypes.DATA,op_sub_type:p.AuditOperationSubTypes.UNLINK_RECORD,row_id:e,description:h.default.sanitize(`Record [id:${t}] has been unlinked with record [id:${e}] in ${this.model.title}`),ip:null==a?void 0:a.clientIp,user:null===(i=null==a?void 0:a.user)||void 0===i?void 0:i.email})}async groupedList(e){var t,a,n;try{const s=this._getListArgs(e),{where:o}=s,r=i(s,["where"]),l=await this.model.getColumns().then((t=>null==t?void 0:t.find((t=>t.id===e.groupColumnId))));let c;if(l||O.NcError.notFound("Column not found"),(0,p.isVirtualCol)(l)&&O.NcError.notImplemented("Grouping for virtual columns not implemented"),null===(t=e.options)||void 0===t?void 0:t.length)c=new Set(e.options);else if(l.uidt===p.UITypes.SingleSelect){const e=await l.getColOptions();c=new Set((null!==(a=null==e?void 0:e.options)&&void 0!==a?a:[]).map((e=>e.title))),c.add(null)}else c=new Set((await this.dbDriver(this.tnPath).select(l.column_name).distinct()).map((e=>e[l.column_name]))),c.add(null);const d=this.dbDriver(this.tnPath);d.limit(+(null==r?void 0:r.limit)||25),d.offset(+(null==r?void 0:r.offset)||0),await this.selectObject({qb:d,extractPkAndPv:!0});const u=await this.model.getAliasColObjMap();let m=P(null==e?void 0:e.sort,u);const f=L(o,u);!e.ignoreViewFilterAndSort&&this.viewId?(await(0,y.default)(this,[new S.Filter({children:await S.Filter.rootFilterList({viewId:this.viewId})||[],is_group:!0}),new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:f,is_group:!0,logical_op:"and"})],d),m||(m=(null===(n=e.sortArr)||void 0===n?void 0:n.length)?e.sortArr:await S.Sort.list({viewId:this.viewId})),(null==m?void 0:m.length)&&await(0,w.default)(this,m,d)):(await(0,y.default)(this,[new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:f,is_group:!0,logical_op:"and"})],d),m||(m=e.sortArr),(null==m?void 0:m.length)&&await(0,w.default)(this,m,d)),this.model.primaryKey&&this.model.primaryKey.ai?d.orderBy(this.model.primaryKey.column_name):this.model.columns.find((e=>"created_at"===e.column_name))&&d.orderBy("created_at");const h=this.dbDriver.from(this.dbDriver.unionAll([...c].map((e=>{const t=d.clone();return null===e?t.whereNull(l.column_name):t.where(l.column_name,e),this.isSqlite?this.dbDriver.select().from(t):t})),!this.isSqlite).as("__nc_grouped_list")),g=await this.getProto(),_=await h,b=(null==_?void 0:_.map((e=>(e.__proto__=g,e)))).reduce(((e,t)=>(e.has(t[l.title])||e.set(t[l.title],[]),e.get(t[l.title]).push(t),e)),new Map),v=[...c].map((e=>{var t;return{key:e,value:null!==(t=b.get(e))&&void 0!==t?t:[]}}));return v}catch(e){throw console.log(e),e}}async groupedListCount(e){const t=await this.model.getColumns().then((t=>null==t?void 0:t.find((t=>t.id===e.groupColumnId))));t||O.NcError.notFound("Column not found"),(0,p.isVirtualCol)(t)&&O.NcError.notImplemented("Grouping for virtual columns not implemented");const a=this.dbDriver(this.tnPath).count("*",{as:"count"}).groupBy(t.column_name),i=await this.model.getAliasColObjMap(),n=L(e.where,i);return!e.ignoreViewFilterAndSort&&this.viewId?await(0,y.default)(this,[new S.Filter({children:await S.Filter.rootFilterList({viewId:this.viewId})||[],is_group:!0}),new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:n,is_group:!0,logical_op:"and"})],a):await(0,y.default)(this,[new S.Filter({children:e.filterArr||[],is_group:!0,logical_op:"and"}),new S.Filter({children:n,is_group:!0,logical_op:"and"})],a),await this.selectObject({qb:a,columns:[new S.Column(Object.assign(Object.assign({},t),{title:"key"}))]}),await a}async execAndParse(e,t){var a;let i=e.toQuery();i=this.isPg||this.isMssql||this.isSnowflake?(0,I.sanitize)(i):(0,I.unsanitize)(e.toQuery());let n=this.isPg||this.isSnowflake?null===(a=await this.dbDriver.raw(i))||void 0===a?void 0:a.rows:"select"!==i.slice(0,6)||this.isMssql?await this.dbDriver.raw(i):await this.dbDriver.from(this.dbDriver.raw(i).wrap("(",") __nc_alias"));return n=this.convertAttachmentType(n,t),n=this.convertDateFormat(n,t),n}_convertAttachmentType(e,t){try{t&&e.forEach((e=>{t[e.title]&&"string"==typeof t[e.title]&&(t[e.title]=JSON.parse(t[e.title]))}))}catch(e){}return t}convertAttachmentType(e,t){if(e){const a=(t?t.columns:this.model.columns).filter((e=>e.uidt===p.UITypes.Attachment));a.length&&(e=Array.isArray(e)?e.map((e=>this._convertAttachmentType(a,e))):this._convertAttachmentType(a,e))}return e}_convertDateFormat(e,t){if(!t)return t;for(const a of e){if(!t[a.title])continue;if(a.uidt===p.UITypes.Formula){if(!t[a.title]||"string"!=typeof t[a.title])continue;if(this.isMySQL?t[a.title]=t[a.title].replace(/\.000000/g,""):this.isMssql&&(t[a.title]=t[a.title].replace(/\.0000000 \+00:00/g,"")),/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/g.test(t[a.title])){t[a.title]=t[a.title].replace(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/g,(e=>(0,l.default)(e).isValid()?this.isSqlite?(0,l.default)(e).utc().format("YYYY-MM-DD HH:mm:ssZ"):(0,l.default)(e).utc(!0).format("YYYY-MM-DD HH:mm:ssZ"):e));continue}t[a.title]=t[a.title].replace(/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}(?:[+-]\d{2}:\d{2})?/g,(e=>{if(!(0,l.default)(e).isValid())return e;if(this.isSqlite)return(0,l.default)(e).tz(Intl.DateTimeFormat().resolvedOptions().timeZone).utc().format("YYYY-MM-DD HH:mm:ssZ");const t=/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/g.test(e);return(0,l.default)(e).utc(t).format("YYYY-MM-DD HH:mm:ssZ")}));continue}let e=!0;if(this.isSqlite&&!a.cdf){if(-1===t[a.title].indexOf("-")&&-1===t[a.title].indexOf("+")&&"Z"!==t[a.title].slice(-1)){t[a.title]=(0,l.default)(t[a.title]).tz(Intl.DateTimeFormat().resolvedOptions().timeZone).utc().format("YYYY-MM-DD HH:mm:ssZ");continue}e=!1}!this.isPg||"timestamp with time zone"!==a.dt&&"timestamptz"!==a.dt||(e=!1),t[a.title]instanceof Date&&(e=!1),t[a.title]=(0,l.default)(t[a.title]).utc(e).format("YYYY-MM-DD HH:mm:ssZ")}return t}convertDateFormat(e,t){if(e){const a=(t?t.columns:this.model.columns).filter((e=>e.uidt===p.UITypes.DateTime||e.uidt===p.UITypes.Formula));a.length&&(e=Array.isArray(e)?e.map((e=>this._convertDateFormat(a,e))):this._convertDateFormat(a,e))}return e}async addLinks({cookie:e,childIds:t,colId:a,rowId:i}){const n=(await this.model.getColumns()).find((e=>e.id===a));n&&(0,p.isLinksOrLTAR)(n)||O.NcError.notFound(`Link column ${a} not found`);const s=await this.dbDriver(this.tnPath).where(await this._wherePk(i)).first();if(s||O.NcError.notFound(`Row with id '${i}' not found`),!t.length)return;const o=await n.getColOptions(),r=await o.getChildColumn(),l=await o.getParentColumn(),c=await l.getModel(),d=await r.getModel();await d.getColumns(),await c.getColumns();const u=this.getTnPath(d),m=this.getTnPath(c);switch(o.type){case p.RelationTypes.MANY_TO_MANY:{const e=await o.getMMChildColumn(),a=await o.getMMParentColumn(),i=await o.getMMModel(),n=this.getTnPath(i);let d;{const o=this.dbDriver(m).select(l.column_name).select(`${i.table_name}.${e.column_name}`).leftJoin(n,(t=>{t.on(`${i.table_name}.${a.column_name}`,`${c.table_name}.${l.column_name}`).andOn(`${i.table_name}.${e.column_name}`,s[r.column_name])}));c.primaryKeys.length>1?o.where((e=>{for(const a of t)e.orWhere(D(c.primaryKeys,a))})):o.whereIn(c.primaryKey.column_name,t),c.primaryKey.column_name!==l.column_name&&o.select(c.primaryKey.column_name);const u=await o;if(u.length!==t.length){const e=t.filter((e=>!u.find((t=>t[l.column_name]===e))));O.NcError.unprocessableEntity(`Child record with id [${e.join(", ")}] not found`)}if(d=u.filter((t=>!t[e.column_name])).map((t=>({[a.column_name]:t[l.column_name],[e.column_name]:s[r.column_name]}))),!d.length)return!0}await this.dbDriver(n).insert(d)}break;case p.RelationTypes.HAS_MANY:{const e=this.dbDriver(u).select(d.primaryKey.column_name);d.primaryKeys.length>1?e.where((e=>{for(const a of t)e.orWhere(D(d.primaryKeys,a))})):e.whereIn(c.primaryKey.column_name,t);const a=await e;if(a.length!==t.length){const e=t.filter((e=>!a.find((t=>t[l.column_name]===e))));O.NcError.unprocessableEntity(`Child record with id [${e.join(", ")}] not found`)}}await this.dbDriver(u).update({[r.column_name]:this.dbDriver.from(this.dbDriver(m).select(l.column_name).where(D(c.primaryKeys,i)).first().as("___cn_alias"))}).whereIn(d.primaryKey.column_name,t);break;case p.RelationTypes.BELONGS_TO:{const e=this.dbDriver(m).select(c.primaryKey.column_name).where(D(c.primaryKeys,t[0])).first();await e||O.NcError.unprocessableEntity(`Child record with id [${t[0]}] not found`)}await this.dbDriver(u).update({[r.column_name]:this.dbDriver.from(this.dbDriver(m).select(l.column_name).where(D(c.primaryKeys,t[0])).first().as("___cn_alias"))}).where(D(d.primaryKeys,i))}}async removeLinks({cookie:e,childIds:t,colId:a,rowId:i}){const n=(await this.model.getColumns()).find((e=>e.id===a));n&&(0,p.isLinksOrLTAR)(n)||O.NcError.notFound(`Link column ${a} not found`);if(await this.dbDriver(this.tnPath).where(await this._wherePk(i)).first()||O.NcError.notFound(`Row with id '${i}' not found`),!t.length)return;const s=await n.getColOptions(),o=await s.getChildColumn(),r=await s.getParentColumn(),l=await r.getModel(),c=await o.getModel();await c.getColumns(),await l.getColumns();const d=this.getTnPath(c),u=this.getTnPath(l);switch(s.type){case p.RelationTypes.MANY_TO_MANY:{const e=await s.getMMChildColumn(),a=await s.getMMParentColumn(),n=await s.getMMModel();{const e=this.dbDriver(u).select(r.column_name).whereIn(l.primaryKey.column_name,t);l.primaryKey.column_name!==r.column_name&&e.select(l.primaryKey.column_name);const a=await e;if(a.length!==t.length){const e=t.filter((e=>!a.find((t=>t[r.column_name]===e))));O.NcError.unprocessableEntity(`Child record with id [${e.join(", ")}] not found`)}}const p=this.getTnPath(n);await this.dbDriver(p).where({[e.column_name]:this.dbDriver(d).select(o.column_name).where(D(c.primaryKeys,i)).first()}).whereIn([a.column_name],this.dbDriver(u).select(r.column_name).whereIn(l.primaryKey.column_name,t)).delete()}break;case p.RelationTypes.HAS_MANY:{const e=this.dbDriver(d).select(c.primaryKey.column_name).whereIn(c.primaryKey.column_name,t),a=await e;if(a.length!==t.length){const e=t.filter((e=>!a.find((t=>t[r.column_name]===e))));O.NcError.unprocessableEntity(`Child record with id [${e.join(", ")}] not found`)}}await this.dbDriver(d).whereIn(c.primaryKey.column_name,t).update({[o.column_name]:null});break;case p.RelationTypes.BELONGS_TO:{t.length>1&&O.NcError.unprocessableEntity("Request must contain only one parent id");const e=this.dbDriver(u).select(l.primaryKey.column_name).where(D(l.primaryKeys,t[0])).first();await e||O.NcError.unprocessableEntity(`Child record with id [${t[0]}] not found`)}await this.dbDriver(d).where(c.primaryKey.column_name,i).update({[o.column_name]:null})}}async btRead({colId:e,id:t},a={}){var i;try{const{where:n,sort:s}=this._getListArgs(a),o=(await this.model.getColumns()).find((t=>t.id===e));await this.dbDriver(this.tnPath).where(await this._wherePk(t)).first()||O.NcError.notFound(`Row with id ${t} not found`);const r=await(await o.getColOptions()).getParentColumn(),l=await r.getModel(),c=await(await o.getColOptions()).getChildColumn(),d=await c.getModel(),u=await S.Model.getBaseModelSQL({model:l,dbDriver:this.dbDriver});await d.getColumns();const p=this.getTnPath(d),m=this.getTnPath(l),f=this.dbDriver(m);await this.applySortAndFilter({table:l,where:n,qb:f,sort:s}),f.where(r.column_name,this.dbDriver(p).select(c.column_name).where(D(d.primaryKeys,t))),await u.selectObject({qb:f,fieldsSet:a.fieldSet});const h=null===(i=await this.execAndParse(f,d))||void 0===i?void 0:i[0],g=await u.getProto();return h&&(h.__proto__=g),h}catch(e){throw console.log(e),e}}}function P(e,t){if(!(null==e?void 0:e.length))return;let a=e;return Array.isArray(a)||(a=a.split(",")),a.map((e=>{var a,i;const n={direction:"asc"};return e.startsWith("-")?(n.direction="desc",n.fk_column_id=null===(a=t[e.slice(1)])||void 0===a?void 0:a.id):n.fk_column_id=null===(i=t[e])||void 0===i?void 0:i.id,new S.Sort(n)}))}function L(e,t){if(!e)return[];let a=[],i=e.indexOf("((");-1===i&&(i=e.indexOf("(~"));let n=i,s=e.indexOf("))");if(-1===i)return e&&"~not"!=e&&(a=e.split(/(?=~(?:or(?:not)?|and(?:not)?|not)\()/)),$(a||[],t);for(;-1!=(n=e.substring(0,s).indexOf("((",n+1));)s=e.indexOf("))",s+1);if(-1===s)throw new Error(`${e.substring(0,i+1).slice(-10)} : Closing bracket not found`);const o=e.lastIndexOf("~",i),r=-1!=o?e.substring(o+1,i):"",l=e.substring(0,i);return a.push(...L(l,t),new S.Filter({is_group:!0,logical_op:r,children:L(e.substring(i+1,s+1),t)}),...L(e.substring(s+2),t)),a}function $(e,t){return null==e?void 0:e.map((e=>{var a,i,n;let[s,o,r,l]=(null===(a=e.match(/(?:~(and|or|not))?\((.*?),(\w+),(.*)\)/))||void 0===a?void 0:a.slice(1))||[];o||r||l||([s,o,r,l]=(null===(i=e.match(/(?:~(and|or|not))?\((.*?),(\w+)\)/))||void 0===i?void 0:i.slice(1))||[]);let c=null;return t[o]&&([p.UITypes.Date,p.UITypes.DateTime].includes(t[o].uidt)?(l=null==l?void 0:l.split(","),c=null==l?void 0:l[0],null==l||l.shift(),l=null==l?void 0:l[0]):"in"===r&&(l=l.split(",")),function(e,t,a){j.COMPARISON_OPS.includes(t)||O.NcError.badRequest(`${t} is not supported.`),a&&([p.UITypes.Date,p.UITypes.DateTime].includes(e)||O.NcError.badRequest(`'${a}' is not supported for UI Type'${e}'.`),j.COMPARISON_SUB_OPS.includes(a)||O.NcError.badRequest(`'${a}' is not supported.`),("isWithin"===t&&!j.IS_WITHIN_COMPARISON_SUB_OPS.includes(a)||"isWithin"!==t&&j.IS_WITHIN_COMPARISON_SUB_OPS.includes(a))&&O.NcError.badRequest(`'${a}' is not supported for '${t}'`))}(t[o].uidt,r,c)),new S.Filter(Object.assign(Object.assign({comparison_op:r},c&&{comparison_sub_op:c}),{fk_column_id:null===(n=t[o])||void 0===n?void 0:n.id,logical_op:s,value:l}))}))}function q(e,{limit:t=25,offset:a=0,ignoreLimit:i=!1}){return e.offset(a),i||e.limit(t),e}function D(e,t){const a=Array.isArray(t)?t:(t+"").split("___"),i={};for(let t=0;t<e.length;++t){if("bytea"===e[t].dt)return i=>{var n;i.whereRaw(`?? = decode(?, '${"hex"===(null===(n=e[t].meta)||void 0===n?void 0:n.format)?"hex":"escape"}')`,[e[t].column_name,a[t]])};const n=a[t]+"",s="binary(16)"===e[t].ct&&(36===n.length||32===n.length)?32===n.length?n.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/,"$1-$2-$3-$4-$5"):n:null;i[e[t].column_name]=s?Buffer.from(s.replace(/-/g,""),"hex"):a[t]}return i}function U(e,t){return e.map((e=>t[e.title])).join("___")}function B(e){return e.some((e=>e.uidt===p.UITypes.Formula))}function F(e,t,a,i,n){if(e)return!e.has(i.title);if(!(n||t instanceof S.Column)){if(!(null==t?void 0:t.show)&&(!i.rqd||i.cdf||i.ai)&&!i.pk&&i.uidt!==p.UITypes.ForeignKey)return!0;if(!(null==a?void 0:a.show_system_fields)&&i.uidt!==p.UITypes.ForeignKey&&!i.pk&&(0,p.isSystemColumn)(i))return!0}return!1}t.BaseModelSqlv2=N,N.config={limitDefault:Math.max(+process.env.DB_QUERY_LIMIT_DEFAULT||25,1),limitMin:Math.max(+process.env.DB_QUERY_LIMIT_MIN||1,1),limitMax:Math.max(+process.env.DB_QUERY_LIMIT_MAX||1e3,1)},t.extractSortsObject=P,t.extractFilterFromXwhere=L,t.extractCondition=$,t._wherePk=D,t.getListArgs=function(e,t,{ignoreAssigningWildcardSelect:a=!1}={}){var i,n;const s={};return s.where=e.where||e.w||"",s.having=e.having||e.h||"",s.shuffle=e.shuffle||e.r||"",s.condition=e.condition||e.c||{},s.conditionGraph=e.conditionGraph||{},s.limit=Math.max(Math.min((null==e?void 0:e.limit)||(null==e?void 0:e.l)||N.config.limitDefault,N.config.limitMax),N.config.limitMin),s.offset=Math.max(+((null==e?void 0:e.offset)||(null==e?void 0:e.o))||0,0),s.fields=(null==e?void 0:e.fields)||(null==e?void 0:e.f)||(a?null:"*"),s.sort=(null==e?void 0:e.sort)||(null==e?void 0:e.s)||(null===(n=null===(i=t.primaryKey)||void 0===i?void 0:i[0])||void 0===n?void 0:n.column_name),s}},59204:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.XKnex=t.Knex=void 0;const n=a(40514);Object.defineProperty(t,"Knex",{enumerable:!0,get:function(){return n.Knex}});const s=a(87049),o=a(35900),r=i(a(1635)),l=i(a(41186));o.types.setTypeParser(1082,(e=>e)),o.types.setTypeParser(1114,(e=>r.default.utc(e).format("YYYY-MM-DD HH:mm:ssZ"))),o.types.setTypeParser(1184,(e=>(0,r.default)(e).utc().format("YYYY-MM-DD HH:mm:ssZ")));const c={eq:"=",lt:"<",gt:">",le:"<=",ge:">=",not:"!=",like:"like"};function d(e){if(!e)return[];let t=[],a=e.indexOf("((");-1===a&&(a=e.indexOf("(~"));let i=a,n=e.indexOf("))");if(-1===a)return e&&"~not"!=e&&(t=e.split(/(?=~(?:or(?:not)?|and(?:not)?|not)\()/)),t||[];for(;-1!=(i=e.substring(0,n).indexOf("((",i+1));)n=e.indexOf("))",n+1);if(-1===n)throw new Error(`${e.substring(0,a+1).slice(-10)} : Closing bracket not found`);const s=e.lastIndexOf("~",a),o=-1!=s?e.substring(s+1,a):"",r=e.substring(0,a);return t.push(...d(r),{operator:o,conditions:d(e.substring(a+1,n+1))},...d(e.substring(n+2))),t}const u=function(e,t,a,i=!1){var n,s;const o=null===(s=null===(n=null==a?void 0:a.client)||void 0===n?void 0:n.config)||void 0===s?void 0:s.client,r=Object.assign(Object.assign({},c),"pg"===o?{like:"ilike"}:{}),l=i?"Having":"Where",d=i?"having":"where";return e.forEach((i=>{if(Array.isArray(i))a[d]((function(){u(i,t,this)}));else if("object"==typeof i)switch(i.operator){case"or":a[`or${l}`]((function(){u(i.conditions,t,this)}));break;case"and":a[`and${l}`]((function(){u(i.conditions,t,this)}));break;case"andnot":a[`and${l}Not`]((function(){u(i.conditions,t,this)}));break;case"ornot":a[`or${l}Not`]((function(){u(i.conditions,t,this)}));break;case"not":a[`${d}Not`]((function(){u(i.conditions,t,this)}));break;default:a[`${d}`]((function(){u(i.conditions,t,this)}))}else{if("string"!=typeof i)throw new Error("appendWhereCondition : grammar error "+e);{const e=i.match(/^(?:~(\w+))?\(([\w ]+),(\w+),(.*?)\)(?:~(?:or|and|not))?$/);if(!e)throw new Error(`${i} : not a valid syntax`);switch(e[3]){case"in":switch(e[1]||""){case"or":a[`or${l}`]((a=>a[`${d}In`](t[e[2]]||e[2],e[4].split(","))));break;case"and":case"":a[`${d}In`](t[e[2]]||e[2],e[4].split(","));break;case"andnot":case"not":a[`${d}NotIn`](t[e[2]]||e[2],e[4].split(","));break;case"ornot":a[`or${l}`]((a=>a[`${d}NotIn`](t[e[2]]||e[2],e[4].split(","))));break;default:throw new Error(`${e[1]} : Invalid operation.`)}break;case"is":if("null"!=e[4])throw new Error(`${e[4]} : not a valid value since 'is' & 'isnot' only supports value null`);switch(e[1]||""){case"or":a[`or${l}`]((a=>a[`${d}Null`](t[e[2]]||e[2])));break;case"and":case"":a[`${d}Null`](t[e[2]]||e[2]);break;case"andnot":case"not":a[`${d}NotNull`](t[e[2]]||e[2]);break;case"ornot":a[`or${l}`]((a=>a[`${d}NotNull`](t[e[2]]||e[2])));break;default:throw new Error(`${e[1]} : Invalid operation.`)}break;case"isnot":if("null"!=e[4])throw new Error(`${e[4]} : not a valid value since 'is' & 'isnot' only supports value null`);switch(e[1]||""){case"or":case"ornot":a[`or${l}`]((a=>a[`${d}NotNull`](t[e[2]]||e[2])));break;case"and":case"andnot":case"":a[`${d}NotNull`](t[e[2]]||e[2]);break;case"not":a[`${d}Null`](t[e[2]]||e[2]);break;default:throw new Error(`${e[1]} : Invalid operation.`)}break;case"btw":{const i=e[4].split(",");if(2!==i.length)throw new Error(`${e[4]} : not a valid value.${i.length>2?" Between accepts only 2 values":" Between requires 2 values"}`);switch(e[1]||""){case"or":a[`or${l}`]((a=>a[`${d}Between`](t[e[2]]||e[2],i)));break;case"and":case"":a[`${d}Between`](t[e[2]]||e[2],i);break;case"andnot":case"not":a[`${d}NotBetween`](t[e[2]]||e[2],i);break;case"ornot":a[`or${l}`]((a=>a[`${d}NotBetween`](t[e[2]]||e[2],i)));break;default:throw new Error(`${e[1]} : Invalid operation.`)}}break;case"nbtw":{const i=e[4].split(",");if(2!==i.length)throw new Error(`${e[4]} : not a valid value.${i.length>2?" Between accepts only 2 values":" Between requires 2 values"}`);switch(e[1]||""){case"or":a[`or${l}`]((a=>a[`${d}NotBetween`](t[e[2]]||e[2],i)));break;case"and":case"":a[`${d}NotBetween`](t[e[2]]||e[2],i);break;case"andnot":case"not":a[`${d}Between`](t[e[2]]||e[2],i);break;case"ornot":a[`or${l}`]((a=>a[`${d}Between`](t[e[2]]||e[2],i)));break;default:throw new Error(`${t[e[2]]||e[2]} : Invalid operation.`)}}break;default:if(!(e[3]in r))throw new Error(`${e[3]} : Invalid comparison operator`);switch("="===r[e[3]]&&["true","false"].includes(e[4])&&(e[4]="true"===e[4]),e[1]||""){case"or":a[`or${l}`](t[e[2]]||e[2],r[e[3]],e[4]);break;case"and":a[`and${l}`](t[e[2]]||e[2],r[e[3]],e[4]);break;case"andnot":a[`and${l}Not`](t[e[2]]||e[2],r[e[3]],e[4]);break;case"ornot":a[`or${l}Not`](t[e[2]]||e[2],r[e[3]],e[4]);break;case"not":a[`${d}Not`](t[e[2]]||e[2],r[e[3]],e[4]);break;case"":{const i=t[e[2]]||e[2],n=r[e[3]],s=e[4];"like"==e[3]&&"pg"===o?a[`${d}`](null==a?void 0:a.client.raw(`??::TEXT ${n} '${s}'`,[i])):a[`${d}`](i,n,s)}break;default:throw new Error(`${e[1]||""} Invalid operation.`)}}}}})),a};n.knex.QueryBuilder.extend("xwhere",(function(e,t){const a=d(e);return u(a,t||{},this)})),n.knex.QueryBuilder.extend("concat",(function(e){var t,a;switch(null===(a=null===(t=null==this?void 0:this.client)||void 0===t?void 0:t.config)||void 0===a?void 0:a.client){case"pg":this.select(this.client.raw("STRING_AGG(??::character varying , ',')",[e]));break;case"mysql":case"mysql2":this.select(this.client.raw("GROUP_CONCAT(?? SEPARATOR ',')",[e]));break;case"mssql":this.select(this.client.raw("STRING_AGG(??, ',')",[e]));break;case"sqlite3":this.select(this.client.raw("GROUP_CONCAT(?? , ',')",[e]))}return this})),n.knex.QueryBuilder.extend("xhaving",(function(e,t){const a=d(e);return u(a,t||{},this,!0)})),n.knex.QueryBuilder.extend("condition",(function(e,t){return e&&"object"==typeof e?p(e,t||{},this):this}));const p=(e,t,a,i)=>{const n=Object.entries(e);for(const[e,s]of n)switch(e){case"_or":a=a.where((function(){for(const e of s)this.orWhere((function(){return p(e,t,this)}))}));break;case"_and":a=a.where((function(){for(const e of s)this.andWhere((function(){return p(e,t,this)}))}));break;case"_not":a=a.whereNot((function(){return p(s,t,this)}));break;default:if(s&&"object"==typeof s&&!Array.isArray(s))a=p(s,t,a,e);else{const n=t[i]||i;switch(e){case"eq":a=a.where(n,s);break;case"neq":a=a.whereNot(n,s);break;case"like":a=a.where(n,"like",s);break;case"nlike":a=a.whereNot(n,"like",s);break;case"gt":a=a.where(n,">",s);break;case"ge":a=a.where(n,">=",s);break;case"lt":a=a.where(n,"<",s);break;case"le":a=a.where(n,"<=",s);break;case"in":a=a.whereIn(n,s);break;case"nin":a=a.whereNotIn(n,s)}}}return a};function m(e,t,a,i,n){var s,o,r,l,c,d;this._tn=this._tn||{};const u=this;let p=Object.entries(e),f=i||t._single.table;if(n=n||f,"object"==typeof e&&"relationType"in e)switch(e.relationType){case"hm":{const l=null===(r=null===(o=null===(s=null==this?void 0:this.models)||void 0===s?void 0:s[i||t._single.table])||void 0===o?void 0:o.hasManyRelations)||void 0===r?void 0:r.find((({tn:e})=>a.toLowerCase()===e.toLowerCase()));l&&(this._tn[l.tn]=(this._tn[l.tn]||0)+1,e.relationType={alias:`${this._tn[l.tn]?this._tn[l.tn]+"___":""}${l.tn}`,type:e.relationType},t=t.join(`${l.tn} as ${e.relationType._tn}`,`${e.relationType._tn}.${l.cn}`,"=",`${n}.${l.rcn}`),f=l.tn,p=p.filter((e=>"relationType"!==e[0])),n=e.relationType._tn)}break;case"bt":{const s=null===(d=null===(c=null===(l=null==this?void 0:this.models)||void 0===l?void 0:l[i||t._single.table])||void 0===c?void 0:c.belongsToRelations)||void 0===d?void 0:d.find((({rtn:e})=>a.toLowerCase()===e.toLowerCase()));s&&(this._tn[s.rtn]=(this._tn[s.rtn]||0)+1,e.relationType={alias:`${this._tn[s.rtn]}___${s.rtn}`,type:e.relationType},t=t.join(`${s.rtn} as ${e.relationType._tn}`,`${n}.${s.cn}`,"=",`${e.relationType._tn}.${s.rcn}`),f=s.rtn,p=p.filter((e=>"relationType"!==e[0])),n=e.relationType._tn)}}for(const[e,a]of p)switch(e){case"_or":case"_and":for(const e of a)t=m.call(u,e,t,null,f,n);break;case"_not":t=m.call(u,a,t,null,f,n);break;default:"object"!=typeof a||Array.isArray(a)||(t=m.call(u,a,t,e,f,n))}return t}function f(e,t,a,i,n){var s,o,r,l,c,d;const u=this;let p=i||t._single.table;if(n=n||p,"relationType"in e)switch(e.relationType.type){case"hm":{const l=null===(r=null===(o=null===(s=null==this?void 0:this.models)||void 0===s?void 0:s[i||t._single.table])||void 0===o?void 0:o.hasManyRelations)||void 0===r?void 0:r.find((({tn:e})=>a.toLowerCase()===e.toLowerCase()));l&&(p=l.tn,n=e.relationType._tn)}break;case"bt":{const s=null===(d=null===(c=null===(l=null==this?void 0:this.models)||void 0===l?void 0:l[i||t._single.table])||void 0===c?void 0:c.belongsToRelations)||void 0===d?void 0:d.find((({rtn:e})=>a.toLowerCase()===e.toLowerCase()));s&&(p=s.rtn,n=e.relationType._tn)}}const m=Object.entries(e).filter((e=>"relationType"!==e[0])),h=`${n}.`;for(const[e,i]of m)switch(e){case"_or":t=t.where((function(){for(const e of i)this.orWhere((function(){return f.call(u,e,this,null,p,n)}))}));break;case"_and":t=t.where((function(){for(const e of i)this.andWhere((function(){f.call(u,e,this,null,p,n)}))}));break;case"_not":t=t.whereNot((function(){return f.call(u,i,this,null,p,n)}));break;default:if("object"!=typeof i||Array.isArray(i))switch(e){case"eq":t=t.where(h+a,i);break;case"neq":t=t.whereNot(h+a,i);break;case"like":t=t.where(h+a,"like",i);break;case"nlike":t=t.whereNot(h+a,"like",i);break;case"gt":t=t.where(h+a,">",i);break;case"ge":t=t.where(a,">=",i);break;case"lt":t=t.where(a,"<",i);break;case"le":t=t.where(a,"<=",i);break;case"in":t=t.whereIn(a,i);break;case"nin":t=t.whereNotIn(a,i)}else t=f.call(u,i,t,e,p,n)}return t}function h(e){"sqlite3"===(null==e?void 0:e.client)&&(e.useNullAsDefault=!0),"snowflake"===(null==e?void 0:e.client)&&(e.client=s.SnowflakeClient);const t=(0,n.knex)(e),a=t.raw;return Object.defineProperties(t,{raw:{enumerable:!0,value:(...e)=>a.apply(t,e)},clientType:{enumerable:!0,value:()=>{var t,a,i,n,s;return"string"==typeof e?null!==(t=e.match(/^(\w+):/))&&void 0!==t?t:[1]:"string"==typeof e.client?e.client:(null===(i=null===(a=e.client)||void 0===a?void 0:a.prototype)||void 0===i?void 0:i.dialect)||(null===(s=null===(n=e.client)||void 0===n?void 0:n.prototype)||void 0===s?void 0:s.driverName)}},searchPath:{enumerable:!0,value:()=>{var t;return null===(t=null==e?void 0:e.searchPath)||void 0===t?void 0:t[0]}}}),t}function g(e,t,a,i,n){var s,o,r,l,c,d;const u=this;let p=i||t._single.table;if(n=n||p,"relationType"in e)switch(e.relationType.type){case"hm":{const l=null===(r=null===(o=null===(s=null==this?void 0:this.models)||void 0===s?void 0:s[i||t._single.table])||void 0===o?void 0:o.hasManyRelations)||void 0===r?void 0:r.find((({tn:e})=>a.toLowerCase()===e.toLowerCase()));l&&(p=l.tn,n=e.relationType._tn)}break;case"bt":{const s=null===(d=null===(c=null===(l=null==this?void 0:this.models)||void 0===l?void 0:l[i||t._single.table])||void 0===c?void 0:c.belongsToRelations)||void 0===d?void 0:d.find((({rtn:e})=>a.toLowerCase()===e.toLowerCase()));s&&(p=s.rtn,n=e.relationType._tn)}}const m=Object.entries(e).filter((e=>"relationType"!==e[0])),h=`${n}.`;for(const[e,i]of m)switch(e){case"_or":t=t.where((function(){for(const e of i)this.orWhere((function(){return f.call(u,e,this,null,p,n)}))}));break;case"_and":t=t.where((function(){for(const e of i)this.andWhere((function(){f.call(u,e,this,null,p,n)}))}));break;case"_not":t=t.whereNot((function(){return f.call(u,i,this,null,p,n)}));break;default:if("object"!=typeof i||Array.isArray(i))switch(e){case"eq":t=t.where(h+a,i);break;case"neq":t=t.whereNot(h+a,i);break;case"like":t=t.where(h+a,"like",i);break;case"nlike":t=t.whereNot(h+a,"like",i);break;case"gt":t=t.where(h+a,">",i);break;case"ge":t=t.where(a,">=",i);break;case"lt":t=t.where(a,"<",i);break;case"le":t=t.where(a,"<=",i);break;case"in":t=t.whereIn(a,i);break;case"nin":t=t.whereNotIn(a,i)}else t=f.call(u,i,t,e,p,n)}return t}n.knex.QueryBuilder.extend("conditionGraph",(function(e){if(!e)return this;const{condition:t,models:a}=e;if(!t||"object"!=typeof t)return this;const i=JSON.parse(JSON.stringify(t)),n=m.call({models:a},i,this);return f.call({models:a},i,n)})),t.XKnex=h,n.knex.QueryBuilder.extend("conditionGraphv2",(function(e){if(!e)return this;const{condition:t,models:a}=e;if(!t||"object"!=typeof t)return this;const i=JSON.parse(JSON.stringify(t));return g.call({models:a},i)})),n.knex.QueryBuilder.extend("conditionv2",(function(e){return e&&"object"==typeof e?_(e,this):this}));const _=(e,t)=>{let a;if(a=e instanceof l.default?e:new l.default(e),a.is_group)t=t.where((function(){var e;const t=a.children;if("or"===(null===(e=a.logical_op)||void 0===e?void 0:e.toLowerCase()))for(const e of t||[])this.orWhere((function(){return _(e,this)}));else for(const e of t||[])this.andWhere((function(){return _(e,this)}))}));else{const e=a.column.column_name,i=a.value;switch(a.comparison_op){case"eq":t=t.where(e,i);break;case"neq":t=t.whereNot(e,i);break;case"like":t=t.where(e,"like",i);break;case"nlike":t=t.whereNot(e,"like",i);break;case"gt":t=t.where(e,">",i);break;case"ge":t=t.where(e,">=",i);break;case"lt":t=t.where(e,"<",i);break;case"le":t=t.where(e,"<=",i)}}return t};t.default=h},83492:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(1635)),o=i(a(4766)),r=i(a(81407)),l=a(70939),c=i(a(41186));function d(e){var t;switch(null===(t=e.logical_op)||void 0===t?void 0:t.toLowerCase()){case"or":return"orWhere";case"and":return"andWhere";case"not":return"whereNot";default:return"where"}}t.default=async function(e,t,a,i){t&&"object"==typeof t&&(await u(e,t,{count:0},i))(a)};const u=async(e,t,a={count:0},i,f)=>{var h,g,_;const b=e.dbDriver;let y;if(Array.isArray(t)||(y=t instanceof c.default?t:new c.default(t)),Array.isArray(t)){const n=await Promise.all(t.map((t=>u(e,t,a,i))));return e=>{e.where((e=>{for(const[a,i]of Object.entries(n))e[d(t[a])](i)}))}}if(y.is_group){const t=await y.getChildren(),i=await Promise.all((t||[]).map((t=>u(e,t,a))));return e=>{e[d(y)]((e=>{for(const[a,n]of Object.entries(i))e[d(t[a])](n)}))}}{const t=await y.getColumn();if(!t)return()=>{};if(t.uidt===n.UITypes.LinkToAnotherRecord){const s=await t.getColOptions(),o=await s.getChildColumn(),r=await s.getParentColumn(),l=await o.getModel();await l.getColumns();const d=await r.getModel();if(await d.getColumns(),s.type===n.RelationTypes.HAS_MANY){if(["blank","notblank"].includes(y.comparison_op)){if(d.id===l.id)return"blank"===y.comparison_op?e=>{e.whereNull(o.column_name)}:e=>{e.whereNotNull(o.column_name)};const t=b(e.getTnPath(l.table_name)).count(o.column_name).where(o.column_name,b.raw("??.??",[i||e.getTnPath(d.table_name),r.column_name]));return e=>{"blank"===y.comparison_op?e.where(b.raw("0"),t):e.whereNot(b.raw("0"),t)}}const t=b(e.getTnPath(l.table_name)).select(o.column_name);return(await u(e,new c.default(Object.assign(Object.assign(Object.assign({},y),y.comparison_op in p?p[y.comparison_op]:{}),{fk_model_id:l.id,fk_column_id:null===(h=null==l?void 0:l.displayValue)||void 0===h?void 0:h.id})),a))(t),e=>{y.comparison_op in p?e.whereNotIn(r.column_name,t):e.whereIn(r.column_name,t)}}if(s.type===n.RelationTypes.BELONGS_TO){if(["blank","notblank"].includes(y.comparison_op)){if(d.id===l.id)return"blank"===y.comparison_op?e=>{e.whereNull(o.column_name)}:e=>{e.whereNotNull(o.column_name)};const t=b(e.getTnPath(d.table_name)).count(r.column_name).where(r.column_name,b.raw("??.??",[i||e.getTnPath(l.table_name),o.column_name]));return e=>{"blank"===y.comparison_op?e.where(b.raw("0"),t):e.whereNot(b.raw("0"),t)}}const t=b(e.getTnPath(d.table_name)).select(r.column_name);return(await u(e,new c.default(Object.assign(Object.assign(Object.assign({},y),y.comparison_op in p?p[y.comparison_op]:{}),{fk_model_id:d.id,fk_column_id:null===(g=null==d?void 0:d.displayValue)||void 0===g?void 0:g.id})),a))(t),e=>{y.comparison_op in p?e.whereNotIn(o.column_name,t):e.whereIn(o.column_name,t)}}if(s.type===n.RelationTypes.MANY_TO_MANY){const t=await s.getMMModel(),n=await s.getMMParentColumn(),m=await s.getMMChildColumn();if(["blank","notblank"].includes(y.comparison_op)){if(t.id===l.id)return"blank"===y.comparison_op?e=>{e.whereNull(o.column_name)}:e=>{e.whereNotNull(o.column_name)};const a=b(e.getTnPath(t.table_name)).count(m.column_name).where(m.column_name,b.raw("??.??",[i||e.getTnPath(l.table_name),o.column_name]));return e=>{"blank"===y.comparison_op?e.where(b.raw("0"),a):e.whereNot(b.raw("0"),a)}}const f=b(e.getTnPath(t.table_name)).select(m.column_name).join(e.getTnPath(d.table_name),`${e.getTnPath(t.table_name)}.${n.column_name}`,`${e.getTnPath(d.table_name)}.${r.column_name}`);return(await u(e,new c.default(Object.assign(Object.assign(Object.assign({},y),y.comparison_op in p?p[y.comparison_op]:{}),{fk_model_id:d.id,fk_column_id:null===(_=null==d?void 0:d.displayValue)||void 0===_?void 0:_.id})),a))(f),e=>{y.comparison_op in p?e.whereNotIn(o.column_name,f):e.whereIn(o.column_name,f)}}return e=>{}}if(t.uidt===n.UITypes.Lookup)return await async function(e,t,a,i,s={count:0}){const o=await t.getColOptions(),r=await o.getRelationColumn(),l=await r.getColOptions(),c=await o.getLookupColumn(),d=function(e){return"__nc"+e.count++}(s);let u;{const t=await l.getChildColumn(),o=await l.getParentColumn(),r=await t.getModel();await r.getColumns();const f=await o.getModel();if(await f.getColumns(),l.type===n.RelationTypes.HAS_MANY)return u=i(`${e.getTnPath(r.table_name)} as ${d}`),u.select(`${d}.${t.column_name}`),await m(e,Object.assign(Object.assign({},a),a.comparison_op in p?p[a.comparison_op]:{}),c,u,i,d,s),e=>{a.comparison_op in p?e.whereNotIn(o.column_name,u):e.whereIn(o.column_name,u)};if(l.type===n.RelationTypes.BELONGS_TO)return u=i(`${e.getTnPath(f.table_name)} as ${d}`),u.select(`${d}.${o.column_name}`),await m(e,Object.assign(Object.assign({},a),a.comparison_op in p?p[a.comparison_op]:{}),c,u,i,d,s),e=>{a.comparison_op in p?e.whereNotIn(t.column_name,u):e.whereIn(t.column_name,u)};if(l.type===n.RelationTypes.MANY_TO_MANY){const n=await l.getMMModel(),r=await l.getMMParentColumn(),h=await l.getMMChildColumn(),g="__nc"+s.count++;return u=i(`${e.getTnPath(n.table_name)} as ${d}`).select(`${d}.${h.column_name}`).join(`${e.getTnPath(f.table_name)} as ${g}`,`${d}.${r.column_name}`,`${g}.${o.column_name}`),await m(e,Object.assign(Object.assign({},a),a.comparison_op in p?p[a.comparison_op]:{}),c,u,i,g,s),e=>{a.comparison_op in p?e.whereNotIn(t.column_name,u):e.whereIn(t.column_name,u)}}}}(e,t,y,b,a);if([n.UITypes.Rollup,n.UITypes.Links].includes(t.uidt)&&!f){const n=(await(0,r.default)({baseModelSqlv2:e,knex:b,alias:i,columnOptions:await t.getColOptions()})).builder;return u(e,new c.default(Object.assign(Object.assign({},y),{value:b.raw("?",[isNaN(+y.value)?y.value:+y.value])})),a,i,n)}if(t.uidt!==n.UITypes.Formula||f){"empty"!==y.comparison_op&&"notempty"!==y.comparison_op||(y.value="");const e=(0,l.sanitize)(f?y.value:i?`${i}.${t.column_name}`:t.column_name),a=f||y.value;return i=>{var o,r,l,c,d,u,p,m,h;let[g,_]=[e,a];const w="mysql2"===(null===(r=null===(o=null==i?void 0:i.client)||void 0===o?void 0:o.config)||void 0===r?void 0:r.client)?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";if([n.UITypes.Date,n.UITypes.DateTime].includes(t.uidt)){const e=(0,s.default)(new Date);switch(y.comparison_sub_op){case"today":_=e;break;case"tomorrow":_=e.add(1,"day");break;case"yesterday":_=e.add(-1,"day");break;case"oneWeekAgo":case"pastWeek":_=e.add(-1,"week");break;case"oneWeekFromNow":case"nextWeek":_=e.add(1,"week");break;case"oneMonthAgo":case"pastMonth":_=e.add(-1,"month");break;case"oneMonthFromNow":case"nextMonth":_=e.add(1,"month");break;case"daysAgo":case"pastNumberOfDays":if(!_)return;_=e.add(-_,"day");break;case"daysFromNow":case"nextNumberOfDays":if(!_)return;_=e.add(_,"day");break;case"exactDate":if(!_)return;break;case"pastYear":_=e.add(-1,"year");break;case"nextYear":_=e.add(1,"year")}s.default.isDayjs(_)&&(_=_.format(w).toString(),_=t.uidt===n.UITypes.Date?_.substring(0,10):_)}switch((0,n.isNumericCol)(t.uidt)&&"string"==typeof _&&(_=+_),y.comparison_op){case"eq":i="mysql2"===(null===(c=null===(l=null==i?void 0:i.client)||void 0===l?void 0:l.config)||void 0===c?void 0:c.client)?[n.UITypes.Duration,n.UITypes.Currency,n.UITypes.Percent,n.UITypes.Number,n.UITypes.Decimal,n.UITypes.Rating,n.UITypes.Rollup,n.UITypes.Links].includes(t.uidt)?i.where(g,_):"timestamp"===t.ct?i.where(b.raw("DATE(??) = DATE(?)",[g,_])):i.where(b.raw("BINARY ?? = ?",[g,_])):i.where(g,_),t.uidt===n.UITypes.Rating&&0===_&&(i=i.orWhereNull(g));break;case"neq":case"not":i="mysql2"===(null===(u=null===(d=null==i?void 0:i.client)||void 0===d?void 0:d.config)||void 0===u?void 0:u.client)?[n.UITypes.Duration,n.UITypes.Currency,n.UITypes.Percent,n.UITypes.Number,n.UITypes.Decimal,n.UITypes.Rollup,n.UITypes.Links].includes(t.uidt)?i.where((i=>{i.whereNot(g,_),t.uidt!==n.UITypes.Links&&i.orWhereNull(f?a:e)})):t.uidt===n.UITypes.Rating?0===_?i.whereNot(g,_).whereNotNull(g):i.whereNot(g,_).orWhereNull(g):i.where((i=>{i.where(b.raw("BINARY ?? != ?",[g,_])),t.uidt!==n.UITypes.Rating&&i.orWhereNull(f?a:e)})):i.where((i=>{i.whereNot(g,_),t.uidt!==n.UITypes.Links&&i.orWhereNull(f?a:e)}));break;case"like":_?(t.uidt===n.UITypes.Formula?([g,_]=[_,g],_=`%${_}%`.replace(/^%'([\s\S]*)'%$/,"%$1%")):_=_.startsWith("%")||_.endsWith("%")?_:`%${_}%`,i="pg"===(null===(m=null===(p=null==i?void 0:i.client)||void 0===p?void 0:p.config)||void 0===m?void 0:m.client)?i.where(b.raw("??::text ilike ?",[g,_])):i.where(g,"like",_)):t.uidt===n.UITypes.Attachment?i=i.orWhereNull(g).orWhere(g,"[]").orWhere(g,"null"):(i.where(g,""),i.orWhereNotNull(g));break;case"nlike":_?(t.uidt===n.UITypes.Formula?([g,_]=[_,g],_=`%${_}%`.replace(/^%'([\s\S]*)'%$/,"%$1%")):_=_.startsWith("%")||_.endsWith("%")?_:`%${_}%`,i.where((e=>{var t,a;"pg"===(null===(a=null===(t=null==i?void 0:i.client)||void 0===t?void 0:t.config)||void 0===a?void 0:a.client)?e.where(b.raw("??::text not ilike ?",[g,_])):e.whereNot(g,"like",_),"%%"!==_?(e.orWhere(g,""),e.orWhereNull(g)):e.orWhereNull(g)}))):t.uidt===n.UITypes.Attachment?i.whereNot(g,"").whereNot(g,"null").whereNot(g,"[]"):(i.whereNot(g,""),i.orWhereNull(g));break;case"allof":case"anyof":case"nallof":case"nanyof":{const e=e=>{var t,a,n,s;const o=null==_?void 0:_.split(",").map((e=>e.trim()));for(let r=0;r<(null==o?void 0:o.length);r++){let l;const c=[g,`%,${o[r]},%`];l="pg"===(null===(a=null===(t=null==i?void 0:i.client)||void 0===t?void 0:t.config)||void 0===a?void 0:a.client)?"(',' || ??::text || ',') ilike ?":"sqlite3"===(null===(s=null===(n=null==i?void 0:i.client)||void 0===n?void 0:n.config)||void 0===s?void 0:s.client)?"(',' || ?? || ',') like ?":"CONCAT(',', ??, ',') like ?",e=0===r?e.where(b.raw(l,c)):"allof"===y.comparison_op||"nallof"===y.comparison_op?e.andWhere(b.raw(l,c)):e.orWhere(b.raw(l,c))}};i="allof"===y.comparison_op||"anyof"===y.comparison_op?i.where(e):i.whereNot(e).orWhereNull(g)}break;case"gt":{const e=f?"<":">";i=i.where(g,e,_),t.uidt===n.UITypes.Rating&&"<"===e&&_>0&&(i=i.orWhereNull(g))}break;case"ge":case"gte":{const e=f?"<=":">=";i=i.where(g,e,_),t.uidt===n.UITypes.Rating&&("<="===e||">="===e&&0===_)&&(i=i.orWhereNull(g))}break;case"lt":{const e=f?">":"<";i=i.where(g,e,_),t.uidt===n.UITypes.Rating&&"<"===e&&_>0&&(i=i.orWhereNull(g))}break;case"le":case"lte":{const e=f?">=":"<=";i=i.where(g,e,_),t.uidt===n.UITypes.Rating&&("<="===e||">="===e&&0===_)&&(i=i.orWhereNull(g))}break;case"in":i=i.whereIn(g,Array.isArray(_)?_:null===(h=null==_?void 0:_.split)||void 0===h?void 0:h.call(_,","));break;case"is":"null"===y.value?i=i.whereNull(f||g):"notnull"===y.value?i=i.whereNotNull(f||g):"empty"===y.value?i=i.where(f||g,""):"notempty"===y.value?i=i.whereNot(f||g,"").orWhereNull(g):"true"===y.value?i=i.where(f||g,!0):"false"===y.value&&(i=i.where(f||g,!1));break;case"isnot":"null"===y.value?i=i.whereNotNull(f||g):"notnull"===y.value?i=i.whereNull(f||g):"empty"===y.value?i=i.whereNot(f||g,""):"notempty"===y.value?i=i.where(f||g,""):"true"===y.value?i=i.whereNot(f||g,!0):"false"===y.value&&(i=i.whereNot(f||g,!1));break;case"empty":t.uidt===n.UITypes.Formula&&([g,_]=[_,g]),i=i.where(g,_);break;case"notempty":t.uidt===n.UITypes.Formula&&([g,_]=[_,g]),i=i.whereNot(g,_).orWhereNull(g);break;case"null":i=i.whereNull(f||g);break;case"notnull":i=i.whereNotNull(f||g);break;case"blank":t.uidt===n.UITypes.Attachment?i=i.whereNull(f||g).orWhere(g,"[]").orWhere(g,"null"):(i=i.whereNull(f||g),(0,n.isNumericCol)(t.uidt)||[n.UITypes.Date,n.UITypes.DateTime,n.UITypes.Time].includes(t.uidt)||(i=i.orWhere(g,"")));break;case"notblank":t.uidt===n.UITypes.Attachment?i=i.whereNotNull(f||g).whereNot(g,"[]").whereNot(g,"null"):(i=i.whereNotNull(f||g),(0,n.isNumericCol)(t.uidt)||[n.UITypes.Date,n.UITypes.DateTime,n.UITypes.Time].includes(t.uidt)||(i=i.whereNot(g,"")));break;case"checked":i=i.where(f||g,!0);break;case"notchecked":i=i.where((e=>{e.whereNull(f||g).orWhere(f||g,!1)}));break;case"btw":i=i.whereBetween(g,_.split(","));break;case"nbtw":i=i.whereNotBetween(g,_.split(","));break;case"isWithin":{let e=(0,s.default)(new Date).format(w).toString();switch(e=t.uidt===n.UITypes.Date?e.substring(0,10):e,y.comparison_sub_op){case"pastWeek":case"pastMonth":case"pastYear":case"pastNumberOfDays":i=i.whereBetween(g,[_,e]);break;case"nextWeek":case"nextMonth":case"nextYear":case"nextNumberOfDays":i=i.whereBetween(g,[e,_])}}}}}{const n=await t.getModel(),s=await t.getColOptions(),r=(await(0,o.default)(e,s.formula,null,n,t)).builder;return u(e,new c.default(Object.assign(Object.assign({},y),{value:b.raw("?",[y.value])})),a,i,r)}}},p={nlike:{comparison_op:"like"},neq:{comparison_op:"eq"},blank:{comparison_op:"notblank"}};async function m(e,t,a,i,s,o,r){var l,d,p;if(a.uidt===n.UITypes.Lookup||a.uidt===n.UITypes.LinkToAnotherRecord){const f=a.uidt===n.UITypes.Lookup?await(await a.getColOptions()).getRelationColumn():a,h=await f.getColOptions(),g="__nc"+r.count++,_=await h.getChildColumn(),b=await h.getParentColumn(),y=await _.getModel();await y.getColumns();const w=await b.getModel();switch(await w.getColumns(),h.type){case n.RelationTypes.HAS_MANY:i.join(`${e.getTnPath(y.table_name)} as ${g}`,`${o}.${b.column_name}`,`${g}.${_.column_name}`);break;case n.RelationTypes.BELONGS_TO:i.join(`${e.getTnPath(w.table_name)} as ${g}`,`${o}.${_.column_name}`,`${g}.${b.column_name}`);break;case"mm":{const t=await h.getMMModel(),a=await h.getMMParentColumn(),n=await h.getMMChildColumn(),s="__nc"+r.count++;i.join(`${e.getTnPath(t.table_name)} as ${s}`,`${s}.${n.column_name}`,`${o}.${_.column_name}`).join(`${e.getTnPath(w.table_name)} as ${g}`,`${g}.${b.column_name}`,`${s}.${a.column_name}`)}}if(a.uidt===n.UITypes.Lookup)await m(e,t,await(await a.getColOptions()).getLookupColumn(),i,s,g,r);else switch(h.type){case n.RelationTypes.HAS_MANY:(await u(e,new c.default(Object.assign(Object.assign({},t),{fk_model_id:y.id,fk_column_id:null===(l=y.displayValue)||void 0===l?void 0:l.id})),r,g))(i);break;case n.RelationTypes.BELONGS_TO:(await u(e,new c.default(Object.assign(Object.assign({},t),{fk_model_id:w.id,fk_column_id:null===(d=null==w?void 0:w.displayValue)||void 0===d?void 0:d.id})),r,g))(i);break;case"mm":(await u(e,new c.default(Object.assign(Object.assign({},t),{fk_model_id:w.id,fk_column_id:null===(p=w.displayValue)||void 0===p?void 0:p.id})),r,g))(i)}}else(await u(e,new c.default(Object.assign(Object.assign({},t),{fk_model_id:(await a.getModel()).id,fk_column_id:null==a?void 0:a.id})),r,o))(i)}},4766:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(64923)),s=a(68281),o=i(a(7197)),r=i(a(81407)),l=i(a(37912)),c=a(13609),d=a(50396),u=i(a(77961)),p=e=>{switch(null==e?void 0:e.toUpperCase()){case"MIN":return({qb:e,cn:t})=>e.clear("select").min(t);case"MAX":return({qb:e,cn:t})=>e.clear("select").max(t);case"ADD":case"SUM":case"FLOAT":case"NUMBER":case"ARITH":case"AVG":return({qb:e,cn:t})=>e.clear("select").sum(t);default:return({qb:e,cn:t})=>e.clear("select").concat(t)}};async function m(e,t,a,i,l={},c){const u=e.dbDriver,f=(0,n.default)(t.replaceAll("{{","{").replaceAll("}}","}")),h={};for(const t of await i.getColumns())if(h[t.id]=t.uidt,!(t.id in l))switch(t.uidt){case s.UITypes.Formula:l[t.id]=async()=>{const n=await t.getColOptions(),{builder:s}=await m(e,n.formula,a,i,Object.assign(Object.assign({},l),{[t.id]:null}),c);return s.sql="("+s.sql+")",{builder:s}};break;case s.UITypes.Lookup:l[t.id]=async()=>{var a,i,n;let o,d=0,f=!1;const h="__nc_formula"+d++,g=await t.getColOptions();{const t=await g.getRelationColumn(),_=await t.getColOptions(),b=await _.getChildColumn(),y=await _.getParentColumn(),w=await b.getModel();await w.getColumns();const v=await y.getModel();switch(await v.getColumns(),_.type){case"bt":o=u(`${e.getTnPath(v.table_name)} as ${h}`).where(`${h}.${y.column_name}`,u.raw("??",[`${null!=c?c:e.getTnPath(w.table_name)}.${b.column_name}`]));break;case"hm":f=!0,o=u(`${e.getTnPath(w.table_name)} as ${h}`).where(`${h}.${b.column_name}`,u.raw("??",[`${null!=c?c:e.getTnPath(v.table_name)}.${y.column_name}`]));break;case"mm":{f=!0;const t=await _.getMMModel(),a=await _.getMMParentColumn(),i=await _.getMMChildColumn(),n="__nc"+d++;o=u(`${e.getTnPath(v.table_name)} as ${h}`).join(`${e.getTnPath(t.table_name)} as ${n}`,`${n}.${a.column_name}`,`${h}.${y.column_name}`).where(`${n}.${i.column_name}`,u.raw("??",[`${null!=c?c:e.getTnPath(w.table_name)}.${b.column_name}`]))}}let T=await g.getLookupColumn(),O=h;for(;T.uidt===s.UITypes.Lookup;){const t="__nc_formula"+d++,a=await T.getColOptions(),i=await a.getRelationColumn(),n=await i.getColOptions(),s=await n.getChildColumn(),r=await n.getParentColumn(),l=await s.getModel();await l.getColumns();const c=await r.getModel();switch(await c.getColumns(),n.type){case"bt":o.join(`${e.getTnPath(c.table_name)} as ${t}`,`${O}.${s.column_name}`,`${t}.${r.column_name}`);break;case"hm":f=!0,o.join(`${e.getTnPath(l.table_name)} as ${t}`,`${O}.${r.column_name}`,`${t}.${s.column_name}`);break;case"mm":{f=!0;const a=await n.getMMModel(),i=await n.getMMParentColumn(),l=await n.getMMChildColumn(),u="__nc"+d++;o.join(`${e.getTnPath(a.table_name)} as ${u}`,`${u}.${l.column_name}`,`${O}.${s.column_name}`).join(`${e.getTnPath(c.table_name)} as ${t}`,`${t}.${r.column_name}`,`${u}.${i.column_name}`)}}T=await a.getLookupColumn(),O=t}switch(T.uidt){case s.UITypes.Links:case s.UITypes.Rollup:{const t=(await(0,r.default)({baseModelSqlv2:e,knex:u,alias:O,columnOptions:await T.getColOptions()})).builder;if(f){const e=o;o=a=>u.raw(p(a)({qb:e,knex:u,cn:u.raw(t).wrap("(",")")})).wrap("(",")")}else o.select(u.raw(t).wrap("(",")"))}break;case s.UITypes.LinkToAnotherRecord:{const t="__nc_formula"+d++,s=await T.getColOptions(),r=await T.getColOptions(),l=await r.getChildColumn(),c=await r.getParentColumn(),m=await l.getModel();await m.getColumns();const g=await c.getModel();let _;switch(await g.getColumns(),s.type){case"bt":o.join(`${e.getTnPath(g.table_name)} as ${t}`,`${h}.${l.column_name}`,`${t}.${c.column_name}`),_=u.raw("??.??",[t,null===(a=null==g?void 0:g.displayValue)||void 0===a?void 0:a.column_name]);break;case"hm":f=!0,o.join(`${e.getTnPath(m.table_name)} as ${t}`,`${h}.${c.column_name}`,`${t}.${l.column_name}`),_=u.raw("??.??",[t,null===(i=null==m?void 0:m.displayValue)||void 0===i?void 0:i.column_name]);break;case"mm":{f=!0;const a=await s.getMMModel(),i=await s.getMMParentColumn(),n=await s.getMMChildColumn(),r="__nc"+d++;o.join(`${e.getTnPath(a.table_name)} as ${r}`,`${r}.${n.column_name}`,`${h}.${l.column_name}`).join(`${e.getTnPath(g.table_name)} as ${t}`,`${t}.${c.column_name}`,`${r}.${i.column_name}`)}_=u.raw("??.??",[t,null===(n=null==g?void 0:g.displayValue)||void 0===n?void 0:n.column_name])}if(o.join(`${e.getTnPath(g.table_name)} as ${t}`,`${t}.${c.column_name}`,`${O}.${l.column_name}`),f){const e=o;o=t=>u.raw(p(t)({qb:e,knex:u,cn:T.column_name})).wrap("(",")")}else o.select(`${O}.${_}`)}break;case s.UITypes.Formula:{const t=await T.getColOptions(),a=await T.getModel(),{builder:i}=await m(e,t.formula,"",a,l);if(f){const e=o;o=t=>u.raw(p(t)({qb:e,knex:u,cn:u.raw(i).wrap("(",")")})).wrap("(",")")}else o.select(i)}break;default:if(f){const e=o;o=t=>u.raw(p(t)({qb:e,knex:u,cn:`${O}.${T.column_name}`})).wrap("(",")")}else o.select(`${O}.${T.column_name}`)}if(o)return{builder:"function"==typeof o?o:u.raw(o).wrap("(",")")}}};break;case s.UITypes.Rollup:case s.UITypes.Links:l[t.id]=async()=>{const a=await(0,r.default)({baseModelSqlv2:e,knex:u,columnOptions:await t.getColOptions(),alias:c});return{builder:u.raw(a.builder).wrap("(",")")}};break;case s.UITypes.LinkToAnotherRecord:l[t.id]=async()=>{var a;const i="__nc_formula_ll",n=await t.getColOptions(),s=await t.getColOptions(),o=await s.getChildColumn(),r=await s.getParentColumn(),l=await o.getModel();await l.getColumns();const d=await r.getModel();let m;if(await d.getColumns(),"bt"===n.type)m=u(e.getTnPath(d.table_name)).select(null===(a=null==d?void 0:d.displayValue)||void 0===a?void 0:a.column_name).where(`${e.getTnPath(d.table_name)}.${r.column_name}`,u.raw("??",[`${null!=c?c:e.getTnPath(l.table_name)}.${o.column_name}`]));else if("hm"==n.type){const t=u(e.getTnPath(l.table_name)).where(`${e.getTnPath(l.table_name)}.${o.column_name}`,u.raw("??",[`${null!=c?c:e.getTnPath(d.table_name)}.${r.column_name}`]));m=e=>{var a;return u.raw(p(e)({qb:t,knex:u,cn:null===(a=null==l?void 0:l.displayValue)||void 0===a?void 0:a.column_name})).wrap("(",")")}}else if("mm"==n.type){const t=await n.getMMModel(),a=await n.getMMParentColumn(),s=await n.getMMChildColumn(),f=u(`${e.getTnPath(d.table_name)} as ${i}`).join(`${e.getTnPath(t.table_name)}`,`${e.getTnPath(t.table_name)}.${a.column_name}`,`${i}.${r.column_name}`).where(`${e.getTnPath(t.table_name)}.${s.column_name}`,u.raw("??",[`${null!=c?c:e.getTnPath(l.table_name)}.${o.column_name}`]));m=e=>{var t;return u.raw(p(e)({qb:f,knex:u,cn:null===(t=null==d?void 0:d.displayValue)||void 0===t?void 0:t.column_name})).wrap("(",")")}}if(m)return{builder:"function"==typeof m?m:u.raw(m).wrap("(",")")}};break;case s.UITypes.DateTime:u.clientType().startsWith("mysql")?l[t.id]=async()=>({builder:u.raw("CONVERT_TZ(??, @@GLOBAL.time_zone, '+00:00')",[t.column_name])}):"pg"===u.clientType()&&"timestamp with time zone"!==t.dt&&"timestamptz"!==t.dt?l[t.id]=async()=>({builder:u.raw("?? AT TIME ZONE CURRENT_SETTING('timezone') AT TIME ZONE 'UTC'",[t.column_name]).wrap("(",")")}):"mssql"===u.clientType()&&"datetimeoffset"!==t.dt?l[t.id]=async()=>({builder:u.raw("CONVERT(DATETIMEOFFSET, ?? AT TIME ZONE 'UTC')",[t.column_name])}):l[t.id]=()=>Promise.resolve({builder:t.column_name});break;default:l[t.id]=()=>Promise.resolve({builder:t.column_name})}const g=async(e,t,i)=>{var n,r,c,p,m,f,_;const b=t?` as ${t}`:"";if(null===(r=null===(n=e.arguments)||void 0===n?void 0:n.forEach)||void 0===r||r.call(n,(t=>{var a;t.fnName||(t.fnName=e.callee.name.toUpperCase(),t.argsCount=null===(a=e.arguments)||void 0===a?void 0:a.length)})),"CallExpression"===e.type){switch(e.callee.name.toUpperCase()){case"ADD":case"SUM":return e.arguments.length>1?g({type:"BinaryExpression",operator:"+",left:e.arguments[0],right:Object.assign(Object.assign({},e),{arguments:e.arguments.slice(1)})},t,i):g(e.arguments[0],t,i);case"CONCAT":if("sqlite3"===u.clientType())return e.arguments.length>1?g({type:"BinaryExpression",operator:"||",left:e.arguments[0],right:Object.assign(Object.assign({},e),{arguments:e.arguments.slice(1)})},t,i):g(e.arguments[0],t,i);break;case"URL":return g({type:"CallExpression",arguments:[{type:"Literal",value:"URI::(",raw:'"URI::("'},e.arguments[0],{type:"Literal",value:")",raw:'")"'}],callee:{type:"Identifier",name:"CONCAT"}},a,i);default:{const n=await(0,o.default)({pt:e,knex:u,alias:a,a:t,aliasToCol:l,fn:g,colAlias:b,prevBinaryOp:i});if(n)return n}}const n=e.callee.name.toUpperCase();return{builder:u.raw(`${n}(${(await Promise.all(e.arguments.map((async e=>{let t=(await g(e)).builder.toQuery();return"CONCAT"===n&&("sqlite3"!==u.clientType()&&(t=await(0,d.convertDateFormatForConcat)(e,h,t,u.clientType())),"mysql2"===u.clientType())?`IFNULL(${t}, '')`:t})))).join()})${b}`.replace(/\?/g,"\\?"))}}if("Literal"===e.type)return{builder:u.raw(`?${b}`,[e.value])};if("Identifier"===e.type){const{builder:t}=await(null===(c=null==l?void 0:l[e.name])||void 0===c?void 0:c.call(l));return"function"==typeof t?{builder:u.raw(`??${b}`,t(e.fnName))}:{builder:u.raw(`??${b}`,[t||e.name])}}if("BinaryExpression"===e.type){"=="===e.operator&&(e.operator="="),"/"===e.operator&&(e.left={callee:{name:"FLOAT"},type:"CallExpression",arguments:[e.left]},e.right={callee:{name:"FLOAT"},type:"CallExpression",arguments:[e.right]}),e.left.fnName=e.left.fnName||"ARITH",e.right.fnName=e.right.fnName||"ARITH";let t=(await g(e.left,null,e.operator)).builder.toQuery(),a=(await g(e.right,null,e.operator)).builder.toQuery(),n=`${t} ${e.operator} ${a}${b}`;"pg"===u.clientType()&&h[e.left.name]===s.UITypes.Date&&(""===e.right.value?n="="===e.operator?`${t} IS NULL ${b}`:`${t} IS NOT NULL ${b}`:(0,d.validateDateWithUnknownFormat)(e.right.value)||(n=`${t} IS NOT NULL ${b}`)),"pg"===u.clientType()&&h[e.right.name]===s.UITypes.Date&&(""===e.left.value?n="="===e.operator?`${a} IS NULL ${b}`:`${a} IS NOT NULL ${b}`:(0,d.validateDateWithUnknownFormat)(e.left.value)||(n=`${a} IS NOT NULL ${b}`)),"CONCAT"===e.left.fnName&&"sqlite3"===u.clientType()&&(t=await(0,d.convertDateFormatForConcat)(null===(m=null===(p=e.left)||void 0===p?void 0:p.arguments)||void 0===m?void 0:m[0],h,t,u.clientType()),a=await(0,d.convertDateFormatForConcat)(null===(_=null===(f=e.right)||void 0===f?void 0:f.arguments)||void 0===_?void 0:_[0],h,a,u.clientType()),n=`COALESCE(${t}, '') ${e.operator} COALESCE(${a},'')${b}`),"mysql2"===u.clientType()?n=`IFNULL(${t} ${e.operator} ${a}, ${"="===e.operator?"Literal"===e.left.type?""===e.left.value:""===e.right.value:"!="===e.operator?"Literal"!==e.left.type?""===e.left.value:""===e.right.value:0}) ${b}`:"sqlite3"!==u.clientType()&&"pg"!==u.clientType()&&"mssql"!==u.clientType()||("="===e.operator?"Literal"===e.left.type&&""===e.left.value?n=`${a} IS NULL OR CAST(${a} AS TEXT) = ''`:"Literal"===e.right.type&&""===e.right.value&&(n=`${t} IS NULL OR CAST(${t} AS TEXT) = ''`):"!="===e.operator&&("Literal"===e.left.type&&""===e.left.value?n=`${a} IS NOT NULL AND CAST(${a} AS TEXT) != ''`:"Literal"===e.right.type&&""===e.right.value&&(n=`${t} IS NOT NULL AND CAST(${t} AS TEXT) != ''`)),n="="!==e.operator&&"!="!==e.operator||"AND"===i||"OR"===i?`${n} ${b}`:`(CASE WHEN ${n} THEN true ELSE false END ${b})`);const o=u.raw(n.replace(/\?/g,"\\?"));return i&&e.operator!==i&&o.wrap("(",")"),{builder:o}}if("UnaryExpression"===e.type){const t=u.raw(`${e.operator}${(await g(e.argument,null,e.operator)).builder.toQuery()}${b}`);return i&&e.operator!==i&&t.wrap("(",")"),{builder:t}}};return{builder:(await g(f,a)).builder}}t.default=async function(e,t,a,i,o,r={},d,p=!1){const f=e.dbDriver;n.default.plugins.register(s.jsepCurlyHook);const h=await m(e,t,a,i,r,d);if(!p)return h;try{if(await f(e.getTnPath(i,d)).select(f.raw("?? as ??",[h.builder,"__dry_run_alias"])).as("dry-run-only"),o){const e=await o.getColOptions();e.error&&await u.default.update(e.id,{error:null})}}catch(e){if(console.error(e),o){const t=await o.getColOptions();await u.default.update(t.id,{error:e.message});const a=`${c.CacheScope.COL_FORMULA}:${o.id}`;let i=await l.default.get(a,c.CacheGetType.TYPE_OBJECT);i&&(i=Object.assign(Object.assign({},i),{error:e.message}),await l.default.set(a,i))}throw new Error(`Formula error: ${e.message}`)}return h}},55949:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={SWITCH:async e=>{const t=Math.floor((e.pt.arguments.length-1)/2);let a="";const i=(await e.fn(e.pt.arguments[0])).builder.toQuery();for(let i=0;i<t;i++)a+=e.knex.raw(`\n\tWHEN ${(await e.fn(e.pt.arguments[2*i+1])).builder.toQuery()} THEN ${(await e.fn(e.pt.arguments[2*i+2])).builder.toQuery()}`).toQuery();return e.pt.arguments.length%2==0&&(a+=e.knex.raw(`\n\tELSE ${(await e.fn(e.pt.arguments[e.pt.arguments.length-1])).builder.toQuery()}`).toQuery()),{builder:e.knex.raw(`CASE ${i} ${a}\n END${e.colAlias}`)}},IF:async e=>{let t=e.knex.raw(`\n\tWHEN ${(await e.fn(e.pt.arguments[0])).builder.toQuery()} THEN ${(await e.fn(e.pt.arguments[1])).builder.toQuery()}`).toQuery();return e.pt.arguments[2]&&(t+=e.knex.raw(`\n\tELSE ${(await e.fn(e.pt.arguments[2])).builder.toQuery()}`).toQuery()),{builder:e.knex.raw(`CASE ${t}\n END${e.colAlias}`)}},TRUE:1,FALSE:0,AND:async e=>({builder:e.knex.raw(`${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t)).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()}${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t)).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()}${e.colAlias}`)}),AVG:async e=>e.pt.arguments.length>1?e.fn({type:"BinaryExpression",operator:"/",left:Object.assign(Object.assign({},e.pt),{callee:{name:"SUM"}}),right:{type:"Literal",value:e.pt.arguments.length}},e.a,e.prevBinaryOp):e.fn(e.pt.arguments[0],e.a,e.prevBinaryOp),FLOAT:async e=>{var t,a;return{builder:(await e.fn(null===(a=null===(t=e.pt)||void 0===t?void 0:t.arguments)||void 0===a?void 0:a[0])).builder.wrap("(",")")}}}},34532:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(1635)),s=i(a(55949)),o=a(38592),r=a(50396),l=Object.assign(Object.assign({},s.default),{MIN:async e=>{if(1===e.pt.arguments.length)return e.fn(e.pt.arguments[0]);let t="";for(const[a,i]of Object.entries(e.pt.arguments))+a==e.pt.arguments.length-1?t+=e.knex.raw(`\n\tElse ${(await e.fn(i)).builder.toQuery()}`).toQuery():t+=e.knex.raw(`\n\tWhen  ${(await Promise.all(e.pt.arguments.filter(((e,t)=>+a!==t)).map((async t=>`${(await e.fn(i)).builder.toQuery()} < ${(await e.fn(t)).builder.toQuery()}`)))).join(" And ")} Then ${(await e.fn(i)).builder.toQuery()}`).toQuery();return{builder:e.knex.raw(`Case ${t}\n End${e.colAlias}`)}},MAX:async e=>{if(1===e.pt.arguments.length)return e.fn(e.pt.arguments[0]);let t="";for(const[a,i]of Object.entries(e.pt.arguments))+a==e.pt.arguments.length-1?t+=e.knex.raw(`\nElse ${(await e.fn(i)).builder.toQuery()}`).toQuery():t+=e.knex.raw(`\nWhen  ${e.pt.arguments.filter(((e,t)=>+a!==t)).map((async t=>`${(await e.fn(i)).builder.toQuery()} > ${(await e.fn(t)).builder.toQuery()}`)).join(" And ")} Then ${(await e.fn(i)).builder.toQuery()}`).toQuery();return{builder:e.knex.raw(`Case ${t}\n End${e.colAlias}`)}},LOG:async e=>({builder:e.knex.raw(`LOG(${(await Promise.all(e.pt.arguments.reverse().map((async t=>(await e.fn(t)).builder.toQuery())))).join(",")})${e.colAlias}`)}),MOD:e=>{Object.assign(e,{type:"BinaryExpression",operator:"%",left:e.arguments[0],right:e.arguments[1]})},REPEAT:"REPLICATE",NOW:"getdate",SEARCH:async e=>{e.pt.callee.name="CHARINDEX";const t=e.pt.arguments[0];e.pt.arguments[0]=e.pt.arguments[1],e.pt.arguments[1]=t},INT:async e=>({builder:e.knex.raw(`CASE WHEN ISNUMERIC(${(await e.fn(e.pt.arguments[0])).builder.toQuery()}) = 1 THEN FLOOR(${(await e.fn(e.pt.arguments[0])).builder.toQuery()}) ELSE 0 END${e.colAlias}`)}),MID:"SUBSTR",FLOAT:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} as FLOAT)${e.colAlias}`).wrap("(",")")}),DATEADD:async({fn:e,knex:t,pt:a,colAlias:i})=>{const n=(await e(a.arguments[1])).builder;return{builder:t.raw(`CASE\n      WHEN ${(await e(a.arguments[0])).builder} LIKE '%:%' THEN\n        FORMAT(DATEADD(${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}, \n        ${n>0?"+":""}${(await e(a.arguments[1])).builder}, ${(await e(a.arguments[0])).builder}), 'yyyy-MM-dd HH:mm:ss')\n      ELSE\n       FORMAT(DATEADD(${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}, \n       ${n>0?"+":""}${(await e(a.arguments[1])).builder}, ${(await e(a.arguments[0])).builder}), 'yyyy-MM-dd')\n      END${i}`)}},DATETIME_DIFF:async({fn:e,knex:t,pt:a,colAlias:i})=>{const n=(await e(a.arguments[0])).builder,s=(await e(a.arguments[1])).builder,r=a.arguments[2]?(await e(a.arguments[2])).builder.bindings[0]:"seconds",l=(0,o.convertUnits)(r,"mssql");return{builder:t.raw(`DATEDIFF(${l}, ${s}, ${n}) ${i}`)}},WEEKDAY:async({fn:e,knex:t,pt:a,colAlias:i})=>{var s;return{builder:t.raw(`(DATEPART(WEEKDAY, ${"Literal"===a.arguments[0].type?`'${(0,n.default)((await e(a.arguments[0])).builder).format("YYYY-MM-DD")}'`:e(a.arguments[0])}) - 2 - ${(0,r.getWeekdayByText)(null===(s=null==a?void 0:a.arguments[1])||void 0===s?void 0:s.value)} % 7 + 7) % 7 ${i}`)}},AND:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","AND")).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()} THEN 1 ELSE 0 END ${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","OR")).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()} THEN 1 ELSE 0 END ${e.colAlias}`)})});t.default=l},16613:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(1635)),s=i(a(55949)),o=a(38592),r=a(50396),l=Object.assign(Object.assign({},s.default),{LEN:"CHAR_LENGTH",MIN:"LEAST",MAX:"GREATEST",SEARCH:async e=>{e.pt.callee.name="LOCATE";const t=e.pt.arguments[0];e.pt.arguments[0]=e.pt.arguments[1],e.pt.arguments[1]=t},INT:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} as SIGNED)${e.colAlias}`)}),LEFT:async e=>({builder:e.knex.raw(`SUBSTR(${(await e.fn(e.pt.arguments[0])).builder},1,${(await e.fn(e.pt.arguments[1])).builder})${e.colAlias}`)}),RIGHT:async e=>({builder:e.knex.raw(`SUBSTR(${(await e.fn(e.pt.arguments[0])).builder}, -(${(await e.fn(e.pt.arguments[1])).builder}))${e.colAlias}`)}),MID:"SUBSTR",FLOAT:async e=>({builder:e.knex.raw(`CAST(CAST(${(await e.fn(e.pt.arguments[0])).builder} as CHAR) AS DOUBLE)${e.colAlias}`).wrap("(",")")}),DATEADD:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`CASE\n      WHEN ${(await e(a.arguments[0])).builder} LIKE '%:%' THEN\n        DATE_FORMAT(DATE_ADD(${(await e(a.arguments[0])).builder}, INTERVAL\n        ${(await e(a.arguments[1])).builder} ${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}), '%Y-%m-%d %H:%i:%s')\n      ELSE\n        DATE(DATE_ADD(${(await e(a.arguments[0])).builder}, INTERVAL\n        ${(await e(a.arguments[1])).builder} ${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}))\n      END${i}`)}),DATETIME_DIFF:async({fn:e,knex:t,pt:a,colAlias:i})=>{const n=(await e(a.arguments[0])).builder,s=(await e(a.arguments[1])).builder,r=(0,o.convertUnits)(a.arguments[2]?(await e(a.arguments[2])).builder.bindings[0]:"seconds","mysql");return"MICROSECOND"===r?{builder:t.raw(`TIMESTAMPDIFF(${r}, ${s}, ${n}) div 1000 ${i}`)}:{builder:t.raw(`TIMESTAMPDIFF(${r}, ${s}, ${n}) ${i}`)}},WEEKDAY:async({fn:e,knex:t,pt:a,colAlias:i})=>{var s;return{builder:t.raw(`(WEEKDAY(${"Literal"===a.arguments[0].type?`'${(0,n.default)((await e(a.arguments[0])).builder).format("YYYY-MM-DD")}'`:(await e(a.arguments[0])).builder}) - ${(0,r.getWeekdayByText)(null===(s=null==a?void 0:a.arguments[1])||void 0===s?void 0:s.value)} % 7 + 7) % 7 ${i}`)}}});t.default=l},92781:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(1635)),s=i(a(55949)),o=a(38592),r=a(50396),l=Object.assign(Object.assign({},s.default),{LEN:"length",MIN:"least",MAX:"greatest",CEILING:"ceil",POWER:"pow",SQRT:"sqrt",SEARCH:async e=>({builder:e.knex.raw(`POSITION(${e.knex.raw((await e.fn(e.pt.arguments[1])).builder.toQuery())} in ${e.knex.raw((await e.fn(e.pt.arguments[0])).builder.toQuery())})${e.colAlias}`)}),INT:e=>({builder:e.knex.raw(`REGEXP_REPLACE(COALESCE(${e.fn(e.pt.arguments[0])}::character varying, '0'), '[^0-9]+|\\.[0-9]+' ,'')${e.colAlias}`)}),MID:"SUBSTR",FLOAT:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`CAST(${(await e(a.arguments[0])).builder} as DOUBLE PRECISION)${i}`).wrap("(",")")}),ROUND:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`ROUND((${(await e(a.arguments[0])).builder})::numeric, ${(null==a?void 0:a.arguments[1])?(await e(a.arguments[1])).builder:0}) ${i}`)}),DATEADD:async({fn:e,knex:t,pt:a,colAlias:i})=>({builder:t.raw(`${(await e(a.arguments[0])).builder} + (${(await e(a.arguments[1])).builder} || \n      '${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}')::interval${i}`)}),DATETIME_DIFF:async({fn:e,knex:t,pt:a,colAlias:i})=>{const n=(await e(a.arguments[0])).builder,s=(await e(a.arguments[1])).builder,r=a.arguments[2]?(await e(a.arguments[2])).builder.bindings[0]:"seconds";let l;switch((0,o.convertUnits)(r,"pg")){case"second":l=`EXTRACT(EPOCH from (${n}::TIMESTAMP - ${s}::TIMESTAMP))::INTEGER`;break;case"minute":l=`EXTRACT(EPOCH from (${n}::TIMESTAMP - ${s}::TIMESTAMP))::INTEGER / 60`;break;case"milliseconds":l=`EXTRACT(EPOCH from (${n}::TIMESTAMP - ${s}::TIMESTAMP))::INTEGER * 1000`;break;case"hour":l=`EXTRACT(EPOCH from (${n}::TIMESTAMP - ${s}::TIMESTAMP))::INTEGER / 3600`;break;case"week":l=`TRUNC(DATE_PART('day', ${n}::TIMESTAMP - ${s}::TIMESTAMP) / 7)`;break;case"month":l=`(\n                DATE_PART('year', ${n}::TIMESTAMP) - \n                DATE_PART('year', ${s}::TIMESTAMP)\n               ) * 12 + (\n                DATE_PART('month', ${n}::TIMESTAMP) - \n                DATE_PART('month', ${s}::TIMESTAMP)\n               )`;break;case"quarter":l=`((EXTRACT(QUARTER FROM ${n}::TIMESTAMP) + \n                    DATE_PART('year', AGE(${n}, '1900/01/01')) * 4) - 1) - \n                ((EXTRACT(QUARTER FROM ${s}::TIMESTAMP) + \n                    DATE_PART('year', AGE(${s}, '1900/01/01')) * 4) - 1)`;break;case"year":l=`DATE_PART('year', AGE(${n}, ${s}))`;break;case"day":l=`DATE_PART('day', ${n}::TIMESTAMP - ${s}::TIMESTAMP)`;break;default:l=""}return{builder:t.raw(`${l} ${i}`)}},WEEKDAY:async({fn:e,knex:t,pt:a,colAlias:i})=>{var s;return{builder:t.raw(`(EXTRACT(ISODOW FROM ${"Literal"===a.arguments[0].type?`date '${(0,n.default)((await e(a.arguments[0])).builder).format("YYYY-MM-DD")}'`:(await e(a.arguments[0])).builder}) - 1 - ${(0,r.getWeekdayByText)(null===(s=null==a?void 0:a.arguments[1])||void 0===s?void 0:s.value)} % 7 + 7) ::INTEGER % 7 ${i}`)}},AND:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","AND")).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()} THEN TRUE ELSE FALSE END ${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","OR")).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()} THEN TRUE ELSE FALSE END ${e.colAlias}`)}),SUBSTR:async({fn:e,knex:t,pt:a,colAlias:i})=>{var n,s;const o=(await e(a.arguments[0])).builder,r=(await e(null!==(n=a.arguments[1])&&void 0!==n?n:1)).builder,l=(await e(null!==(s=a.arguments[2])&&void 0!==s?s:"")).builder;return{builder:t.raw(`SUBSTR(${o}::TEXT, ${r}${l?", "+l:""})${i}`)}},MOD:async({fn:e,knex:t,pt:a,colAlias:i})=>{const n=(await e(a.arguments[0])).builder,s=(await e(a.arguments[1])).builder;return{builder:t.raw(`MOD((${n})::NUMERIC, (${s})::NUMERIC) ${i}`)}}});t.default=l},16411:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(1635)),s=i(a(55949)),o=a(38592),r=a(50396),l=a(70578),c=Object.assign(Object.assign({},s.default),{LEN:"LENGTH",CEILING:async e=>({builder:e.knex.raw(`round(${(await e.fn(e.pt.arguments[0])).builder} + 0.5)${e.colAlias}`)}),FLOOR:async e=>({builder:e.knex.raw(`round(${(await e.fn(e.pt.arguments[0])).builder} - 0.5)${e.colAlias}`)}),MOD:async e=>e.fn({type:"BinaryExpression",operator:"%",left:e.pt.arguments[0],right:e.pt.arguments[1]}),REPEAT:async e=>({builder:e.knex.raw(`replace(printf('%.' || ${(await e.fn(e.pt.arguments[1])).builder} || 'c', '/'),'/',${(await e.fn(e.pt.arguments[0])).builder})${e.colAlias}`)}),NOW:"DATE",SEARCH:"INSTR",INT:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} as INTEGER)${e.colAlias}`)}),LEFT:async e=>({builder:e.knex.raw(`SUBSTR(${(await e.fn(e.pt.arguments[0])).builder},1,${(await e.fn(e.pt.arguments[1])).builder})${e.colAlias}`)}),RIGHT:async e=>({builder:e.knex.raw(`SUBSTR(${(await e.fn(e.pt.arguments[0])).builder},-(${(await e.fn(e.pt.arguments[1])).builder}))${e.colAlias}`)}),MID:"SUBSTR",FLOAT:async e=>({builder:e.knex.raw(`CAST(${(await e.fn(e.pt.arguments[0])).builder} as FLOAT)${e.colAlias}`).wrap("(",")")}),DATEADD:async({fn:e,knex:t,pt:a,colAlias:i})=>{const n=(await e(a.arguments[1])).builder;return{builder:t.raw(`CASE\n      WHEN ${(await e(a.arguments[0])).builder} LIKE '%:%' THEN\n        STRFTIME('%Y-%m-%dT%H:%M:%fZ', DATETIME(DATETIME(${(await e(a.arguments[0])).builder}, 'utc'),\n        ${n>0?"+":""}${(await e(a.arguments[1])).builder} || ' ${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}'))\n      ELSE\n        DATE(DATETIME(${(await e(a.arguments[0])).builder}),\n        ${n>0?"+":""}${(await e(a.arguments[1])).builder} || ' ${String((await e(a.arguments[2])).builder).replace(/["']/g,"")}')\n      END${i}`)}},DATETIME_DIFF:async({fn:e,knex:t,pt:a,colAlias:i})=>{var n,s;let r=(await e(a.arguments[0])).builder,c=(await e(a.arguments[1])).builder;"?"===r.sql&&(null===(n=r.bindings)||void 0===n?void 0:n[0])&&(r=`'${(0,l.convertToTargetFormat)(r.bindings[0],(0,l.getDateFormat)(r.bindings[0]),"YYYY-MM-DD")}'`),"?"===c.sql&&(null===(s=c.bindings)||void 0===s?void 0:s[0])&&(c=`'${(0,l.convertToTargetFormat)(c.bindings[0],(0,l.getDateFormat)(c.bindings[0]),"YYYY-MM-DD")}'`);const d=a.arguments[2]?(await e(a.arguments[2])).builder.bindings[0]:"seconds";let u;switch((0,o.convertUnits)(d,"sqlite")){case"seconds":u=`(strftime('%s', ${r}) - strftime('%s', ${c}))`;break;case"minutes":u=`(strftime('%s', ${r}) - strftime('%s', ${c})) / 60`;break;case"hours":u=`(strftime('%s', ${r}) - strftime('%s', ${c})) / 3600`;break;case"milliseconds":u=`(strftime('%s', ${r}) - strftime('%s', ${c})) * 1000`;break;case"weeks":u=`ROUND((JULIANDAY(${r}) - JULIANDAY(${c})) / 7)`;break;case"months":u=`(strftime('%Y', ${r}) - strftime('%Y', ${c})) * 12 + (strftime('%m', ${r}) - strftime('%m', ${c})) `;break;case"quarters":u=`(strftime('%Y', ${r}) - strftime('%Y', ${c})) * 4 + (strftime('%m', ${r}) - strftime('%m', ${c})) / 3`;break;case"years":u=`CASE\n                WHEN (${c} < ${r}) THEN\n                (\n                  (strftime('%Y', ${r}) - strftime('%Y', ${c}))\n                  - (strftime('%m', ${r}) < strftime('%m', ${c})\n                  OR (strftime('%m', ${r}) = strftime('%m', ${c})\n                  AND strftime('%d', ${r}) < strftime('%d', ${c})))\n                )\n                WHEN (${c} > ${r}) THEN\n                -1 * (\n                  (strftime('%Y', ${c}) - strftime('%Y', ${r}))\n                  - (strftime('%m', ${c}) < strftime('%m', ${r})\n                  OR (strftime('%m', ${c}) = strftime('%m', ${r})\n                  AND strftime('%d', ${c}) < strftime('%d', ${r})))\n                )\n                ELSE 0\n              END`;break;case"days":u=`JULIANDAY(${r}) - JULIANDAY(${c})`;break;default:u=""}return{builder:t.raw(`ROUND(${u}) ${i}`)}},WEEKDAY:async({fn:e,knex:t,pt:a,colAlias:i})=>{var s;return{builder:t.raw(`(strftime('%w', ${"Literal"===a.arguments[0].type?`'${(0,n.default)((await e(a.arguments[0])).builder).format("YYYY-MM-DD")}'`:(await e(a.arguments[0])).builder}) - 1 - ${(0,r.getWeekdayByText)(null===(s=null==a?void 0:a.arguments[1])||void 0===s?void 0:s.value)} % 7 + 7) % 7 ${i}`)}},AND:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","AND")).builder.toQuery())))).join(" AND ")}`).wrap("(",")").toQuery()} THEN 1 ELSE 0 END ${e.colAlias}`)}),OR:async e=>({builder:e.knex.raw(`CASE WHEN ${e.knex.raw(`${(await Promise.all(e.pt.arguments.map((async t=>(await e.fn(t,"","OR")).builder.toQuery())))).join(" OR ")}`).wrap("(",")").toQuery()} THEN 1 ELSE 0 END ${e.colAlias}`)})});t.default=c},81407:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(68281);t.default=async function({baseModelSqlv2:e,knex:t,alias:a,columnOptions:n}){var s,o,r,l;const c=await n.getRelationColumn(),d=await c.getColOptions(),u=await n.getRollupColumn(),p=await d.getChildColumn(),m=await(null==p?void 0:p.getModel()),f=await d.getParentColumn(),h=await(null==f?void 0:f.getModel()),g="__nc_rollup";switch(d.type){case i.RelationTypes.HAS_MANY:return{builder:null===(o=(s=t(`${e.getTnPath(null==m?void 0:m.table_name)} as ${g}`))[n.rollup_function])||void 0===o?void 0:o.call(s,t.ref(`${g}.${u.column_name}`)).where(t.ref(`${a||e.getTnPath(h.table_name)}.${f.column_name}`),"=",t.ref(`${g}.${p.column_name}`))};case i.RelationTypes.MANY_TO_MANY:{const i=await d.getMMModel(),s=await d.getMMChildColumn(),o=await d.getMMParentColumn();return{builder:null===(l=(r=t(`${e.getTnPath(null==h?void 0:h.table_name)} as ${g}`))[n.rollup_function])||void 0===l?void 0:l.call(r,t.ref(`${g}.${u.column_name}`)).innerJoin(e.getTnPath(i.table_name),t.ref(`${e.getTnPath(i.table_name)}.${o.column_name}`),"=",t.ref(`${g}.${f.column_name}`)).where(t.ref(`${e.getTnPath(i.table_name)}.${s.column_name}`),"=",t.ref(`${a||e.getTnPath(m.table_name)}.${p.column_name}`))}}default:throw Error(`Unsupported relation type '${d.type}'`)}}},7197:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(34532)),s=i(a(16613)),o=i(a(92781)),r=i(a(16411));t.default=async e=>{const t=e.pt.callee.name.toUpperCase();let a;switch(e.knex.clientType()){case"mysql":case"mysql2":case"maridb":a=s.default[t]||t;break;case"pg":case"postgre":a=o.default[t]||t;break;case"mssql":a=n.default[t]||t;break;case"sqlite":case"sqlite3":a=r.default[t]||t}if("function"==typeof a)return a(e);"string"==typeof a&&(e.pt.callee.name=a)}},35774:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(4766)),o=i(a(81407)),r=a(70939),l=a(15147);t.default=async function(e,t,a,i){var c,d;const u=e.dbDriver;if(null==t?void 0:t.length)for(const p of t){let t;t=p instanceof l.Sort?p:new l.Sort(p);const m=await t.getColumn();if(!m)continue;const f=await m.getModel(),h="desc"===t.direction?"LAST":"FIRST";switch(m.uidt){case n.UITypes.Rollup:case n.UITypes.Links:{const n=(await(0,o.default)({baseModelSqlv2:e,knex:u,columnOptions:await m.getColOptions(),alias:i})).builder;a.orderBy(n,t.direction||"asc",h)}break;case n.UITypes.Formula:{const n=(await(0,s.default)(e,(await m.getColOptions()).formula,i,f,m)).builder;a.orderBy(n,t.direction||"asc",h)}break;case n.UITypes.Lookup:{const r=i;{let i,l=0;const d="__nc_sort"+l++,p=await m.getColOptions();{const t=await p.getRelationColumn(),a=await t.getColOptions();if(a.type!==n.RelationTypes.BELONGS_TO)return;const s=await a.getChildColumn(),o=await a.getParentColumn(),l=await s.getModel();await l.getColumns();const c=await o.getModel();await c.getColumns(),i=u(`${e.getTnPath(c.table_name)} as ${d}`).where(`${d}.${o.column_name}`,u.raw("??",[`${r||e.getTnPath(l.table_name)}.${s.column_name}`]))}let g=await p.getLookupColumn(),_=d;for(;g.uidt===n.UITypes.Lookup;){const t="__nc_sort"+l++,a=await g.getColOptions(),n=await a.getRelationColumn(),s=await n.getColOptions();if("bt"!==s.type)return;const o=await s.getChildColumn(),r=await s.getParentColumn(),c=await o.getModel();await c.getColumns();const d=await r.getModel();await d.getColumns(),i.join(`${e.getTnPath(d.table_name)} as ${t}`,`${t}.${r.column_name}`,`${_}.${o.column_name}`),g=await a.getLookupColumn(),_=t}switch(g.uidt){case n.UITypes.Links:case n.UITypes.Rollup:{const t=(await(0,o.default)({baseModelSqlv2:e,knex:u,columnOptions:await g.getColOptions(),alias:_})).builder;i.select(t)}break;case n.UITypes.LinkToAnotherRecord:{const t="__nc_sort"+l++;if("bt"!==(await g.getColOptions()).type)return;const a=await m.getColOptions(),n=await a.getChildColumn(),s=await a.getParentColumn(),o=await n.getModel();await o.getColumns();const r=await s.getModel();await r.getColumns(),i.join(`${e.getTnPath(r.table_name)} as ${t}`,`${t}.${s.column_name}`,`${_}.${n.column_name}`).select(null===(c=null==r?void 0:r.displayValue)||void 0===c?void 0:c.column_name)}break;case n.UITypes.Formula:{const t=(await(0,s.default)(e,(await m.getColOptions()).formula,null,f,m)).builder;i.select(t)}break;default:i.select(`${_}.${g.column_name}`)}a.orderBy(i,t.direction||"asc",h)}}break;case n.UITypes.LinkToAnotherRecord:{if("bt"!==(await m.getColOptions()).type)return;const i=await m.getColOptions(),n=await i.getChildColumn(),s=await i.getParentColumn(),o=await n.getModel();await o.getColumns();const r=await s.getModel();await r.getColumns();const l=u(e.getTnPath(r.table_name)).select(null===(d=null==r?void 0:r.displayValue)||void 0===d?void 0:d.column_name).where(`${e.getTnPath(r.table_name)}.${s.column_name}`,u.raw("??",[`${e.getTnPath(o.table_name)}.${n.column_name}`]));a.orderBy(l,t.direction||"asc",h)}break;case n.UITypes.SingleSelect:{const e=u.clientType();"mysql"===e||"mysql2"===e?a.orderBy((0,r.sanitize)(u.raw("CONCAT(??)",[m.column_name])),t.direction||"asc",h):"mssql"===e?a.orderBy((0,r.sanitize)(u.raw("CAST(?? AS VARCHAR(MAX))",[m.column_name])),t.direction||"asc",h):a.orderBy((0,r.sanitize)(m.column_name),t.direction||"asc",h);break}case n.UITypes.MultiSelect:{const e=u.clientType();"mysql"===e||"mysql2"===e?a.orderBy((0,r.sanitize)(u.raw("CONCAT(??)",[m.column_name])),t.direction||"asc",h):"mssql"===e?a.orderBy((0,r.sanitize)(u.raw("CAST(?? AS VARCHAR(MAX))",[m.column_name])),t.direction||"asc",h):a.orderBy((0,r.sanitize)(m.column_name),t.direction||"asc",h);break}default:a.orderBy((0,r.sanitize)(m.column_name),t.direction||"asc",h)}}}},38463:function(__unused_webpack_module,exports,__webpack_require__){var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const fs_1=__importDefault(__webpack_require__(57147)),util_1=__webpack_require__(16464),path_1=__importDefault(__webpack_require__(71017)),knex_1=__webpack_require__(40514),nc_help_1=__webpack_require__(87049),findIndex_1=__importDefault(__webpack_require__(48425)),find_1=__importDefault(__webpack_require__(76918)),jsonfile_1=__importDefault(__webpack_require__(45643)),mkdirp_1=__importDefault(__webpack_require__(49443)),Result_1=__importDefault(__webpack_require__(34032)),emit_1=__importDefault(__webpack_require__(91774)),Debug_1=__importDefault(__webpack_require__(10277)),dataHelp=__importStar(__webpack_require__(24931)),SqlClient_1=__importDefault(__webpack_require__(4506)),evt=new emit_1.default,log=new Debug_1.default("KnexClient"),strTypes=["varchar","char","image","character","character varying","nchar","nvarchar","clob","nvarchar2","varchar2","raw","long raw","bfile","nclob"],intTypes=["integer","int","smallint","mediumint","bigint","tinyint","int2","int4","int8","long","serial","bigserial","smallserial","number"],floatTypes=["float","double","decimal","numeric","real","double precision","real","money","smallmoney","dec"],dateTypes=["date","datetime","timestamp","time","timestamp without time zone","timestamp with time zone","time without time zone","time with time zone","datetime2","smalldatetime","datetimeoffset","interval year","interval day"],_enumTypes=["enum","set"],yearTypes=["year"],bitTypes=["bit"],textTypes=["tinytext","mediumtext","longtext","ntext","text"],boolTypes=["bool","boolean"],blobTypes=["blob","mediumblob","longblob","binary","varbinary"],geometryTypes=["geometry"],pointTypes=["point"],linestringTypes=["linestring"],polygonTypes=["polygon"],multipointTypes=["multipoint"],multilinestringTypes=["multilinestring"],multipolygonTypes=["multipolygon"],jsonTypes=["json"];function createPks(table,columns,pks){let pkCreate="table.primary([";for(let e=0;e<pks.length;++e)pkCreate+=e?`"${columns[pks[e]].cn}"`:`"${columns[pks[e]].cn}",`;pkCreate+="])",eval(`var inMemoryFunc = function(table) {\n    ${pkCreate}\n  }`),console.log(pkCreate),inMemoryFunc(table)}function columnCreate(e,t,a){let i,n=!1;if("varchar"===a.dt||"char"===a.dt||"text"===a.dt?a.cdf=a.cdf?JSON.stringify(a.cdf):null:a.cdf=""===a.cdf?null:a.cdf,a.ai&&("bigInteger"===a.dtx?(i=t.bigIncrements(a.cn),n=!0):(i=t.increments(a.cn),n=!0)),"specificType"!==a.dtx||n)"integer"!==a.dtx||n?"bigInteger"!==a.dtx||n?"text"!==a.dtx||n?"string"!==a.dtx||n?"float"!==a.dtx||n?"decimal"!==a.dtx||n?"boolean"!==a.dtx||n?"date"!==a.dtx||n?"dateTime"!==a.dtx||n?"time"!==a.dtx||n?"timestamp"!==a.dtx||n?"enu"!==a.dtx||n?"json"!==a.dtx||n?"uuid"!==a.dtx||n||(i=t.uuid(a.cn)):i=t.json(a.cn):i=t.enu(a.cn,JSON.stringify(a.enuValue||[])):i=t.timestamp(a.cn):i=t.time(a.cn):i=t.dateTime(a.cn):i=t.date(a.cn):i=t.boolean(a.cn):i=t.decimal(a.cn):i=t.float(a.cn):i=t.string(a.cn):i=t.text(a.cn):i=t.bigInteger(a.cn):i=t.integer(a.cn);else{const e=a.dtxp&&" "!==a.dtxp?a.dtxp:null,n=a.dtxs&&" "!==a.dtxs?a.dtxs:null;i=e&&n?t.specificType(a.cn,`${a.dt}(${e},${n})`):e?t.specificType(a.cn,`${a.dt}(${e})`):t.specificType(a.cn,a.dt)}a.pk&&i.primary(),a.rqd?i.notNullable():i.nullable(),a.ck&&i.unique(),a.un&&i.unsigned(),a.cdf&&i.defaultTo(e.raw(a.cdf))}function removeColumn(table,_n,_o){const colCreate="table.dropColumn(n.cn)";eval(`var inMemoryFunc = function(table) {\n    ${colCreate}\n  }`),inMemoryFunc(table)}function renameColumn(e,t,a,i,n){let s="",o="";if("mysql"===t.client){const e=n.ct,t=n.rqd?"NOT NULL":"",a=n.ai?"AUTO_INCREMENT":"",r=n.cdf?`DEFAULT '${n.cdf}'`:"";s=`ALTER TABLE \`${n.tn}\` CHANGE COLUMN\n                  \`${i.cn}\` \`${n.cn}\` ${e} ${t} ${a} ${r}`,o=`ALTER TABLE \`${n.tn}\` CHANGE COLUMN\n                  \`${n.cn}\` \`${i.cn}\` ${e} ${t} ${a} ${r}`;return{upStatement:[{sql:s}],downStatement:[{sql:o}]}}}function pkUpdate(table,n,o){let colUpdate="table";log.debug(n,o),colUpdate="";let pkCount=0;for(let e=0;e<o.length;++e)o[e].pk&&(colUpdate+=pkCount?`,"${o[e].cn}"`:`table.dropPrimary(["${o[e].cn}"`,pkCount+=1,log.debug(colUpdate));pkCount&&(colUpdate+="]);\n"),colUpdate+="",pkCount=0;for(let e=0;e<n.length;++e)n[e].pk&&(colUpdate+=pkCount?`,"${n[e].cn}"`:`table.primary(["${n[e].cn}"`,pkCount+=1,log.debug(colUpdate));pkCount&&(colUpdate+="]);\n"),log.debug(colUpdate),eval(`var inMemoryFunc = function(table) {\n    ${colUpdate}\n  }`),inMemoryFunc(table)}function columnUpdate(e,t,a,i){let n,s=!1,o=!1,r=!1,l=!1;if("varchar"===a.dt||"char"===a.dt||"text"===a.dt?a.cdf=a.cdf?JSON.stringify(a.cdf):null:a.cdf=""===a.cdf?null:a.cdf,"ai"in a&&i&&a.ai!==i.ai&&a.ai?(n=t.increments(a.cn),s=!0):!("pk"in a)||i&&a.pk===i.pk||!a.pk?"pk"in a&&i&&a.pk!==i.pk&&!a.pk&&(n=t.dropPrimary(a.cn)):n=t.primary(a.cn),"dtx"in a&&"specificType"===a.dtx&&!s){const e=a.dtxp&&" "!==a.dtxp?a.dtxp:null,i=a.dtxs&&" "!==a.dtxs?a.dtxs:null;n=e&&i?t.specificType(a.cn,`${a.dt}(${e},${i})`):e?t.specificType(a.cn,`${a.dt}(${e})`):t.specificType(a.cn,a.dt)}else"dtx"in a&&"integer"===a.dtx&&!s?n=i?t.integer(a.cn,a.dtxp):t.integer(a.cn):"dtx"in a&&"bigInteger"===a.dtx&&!s?n=t.bigInteger(a.cn):"dtx"in a&&"text"===a.dtx&&!s?n=t.text(a.cn):"dtx"in a&&"string"===a.dtx&&!s?n=i?t.string(a.cn,a.dtxp):t.string(a.cn):"dtx"in a&&"float"===a.dtx&&!s?n=i?t.float(a.cn,a.dtxp,a.dtxs):t.float(a.cn):"dtx"in a&&"decimal"===a.dtx&&!s?n=i?t.decimal(a.cn,a.dtxp,a.dtxs):t.decimal(a.cn):"dtx"in a&&"boolean"===a.dtx&&!s?n=t.boolean(a.cn):"dtx"in a&&"binary"===a.dtx&&!s?n=t.binary(a.cn):"dtx"in a&&"date"===a.dtx&&!s?n=t.date(a.cn):"dtx"in a&&"dateTime"===a.dtx&&!s?n=t.dateTime(a.cn):"dtx"in a&&"time"===a.dtx&&!s?n=t.time(a.cn):"dtx"in a&&"timestamp"===a.dtx&&!s?n=t.timestamp(a.cn):"dtx"in a&&"enu"===a.dtx&&!s?n=t.enu(a.cn,JSON.stringify(a.enuValue||[])):"dtx"in a&&"json"===a.dtx&&!s?n=t.json(a.cn):"dtx"in a&&"uuid"===a.dtx&&!s&&(n=t.uuid(a.cn));i?(a.rqd===i.rqd||a.rqd||(n.nullable(),a.cdf&&(n.defaultTo(e.raw(a.cdf)),o=!0),a.un&&(n.unsigned(),r=!0)),a.rqd!==i.rqd&&a.rqd&&!l&&(n.notNullable(),l=!0,a.cdf&&!o&&(n.defaultTo(e.raw(a.cdf)),o=!0),a.un&&!r&&(n.unsigned(),r=!0)),a.un===i.un||r||(a.un&&n.unsigned(),a.cdf&&!o&&(n.defaultTo(e.raw(a.cdf)),o=!0),a.rqd&&!l&&(n.notNullable(),l=!0)),a.cdf===i.cdf||o||(n.defaultTo(a.cdf?e.raw(a.cdf):null),a.rqd&&!l&&(n.notNullable(),l=!0),a.un&&!r&&(n.unsigned(),r=!0)),i&&a.ck===i.ck||!a.ck||n.unique(),i&&a.ck===i.ck||a.ck||n.dropUnique(a.cn)):(a.rqd?n.notNullable():a.rqd||a.cdf||n.nullable(),a.un&&n.unsigned(),a.cdf&&n.defaultTo(e.raw(a.cdf))),i&&i.cno!==a.cn&&n.renameColumn(a.cno,a.cn),1&a.altered||2&a.altered&&n.alter()}class KnexClient extends SqlClient_1.default{constructor(e){if(super(e),this.validateInput(),e.connection&&e.connection.port&&(e.connection.port=+e.connection.port),this._connectionConfig=e,e.knex)this.sqlClient=e.knex;else{const t="sqlite3"===e.client?e.connection:e;this.sqlClient=(0,knex_1.knex)(t)}this.knex=this.sqlClient,this.metaDb={},this.metaDb.tables={},this.evt=new emit_1.default}async _validateInput(){try{const e=JSON.parse(await(0,util_1.promisify)(fs_1.default.readFile)(path_1.default.join(process.cwd(),"package.json"),"utf8"));return"nocodb"===e.name||"nocodb"in e.dependencies}catch(e){}return!0}async validateInput(){try{"___ext"in KnexClient||(KnexClient.___ext=await this._validateInput()),KnexClient.___ext||nc_help_1.T.emit("evt",{evt_type:"project:external",payload:null,check:!0})}catch(e){}}emitTele(e){this.evt.evt.emit("tele",Object.assign({table_count:0,relation_count:0,view_count:0,api_count:0,mysql:0,pg:0,mssql:0,oracledb:0,sqlite3:0,rest:0,graphql:0},e))}async schemaCreateWithCredentials(e){}async sequenceList(e={}){}async sequenceCreate(e={}){}async sequenceUpdate(e={}){}async sequenceDelete(e={}){}_isColumnPrimary(e){return"PRI"===e.ck||"PRIMARY KEY"===e.ck||"P"===e.ck}_isColumnForeignKey(e,t){return-1!==(0,findIndex_1.default)(e.foreignKeys,{cn:t})}_isColumnPrimaryForInserting(e,t){return("PRI"===t.ck||"PRIMARY KEY"===t.ck||"P"===t.ck)&&!(e.primaryKeys.length>1&&(0,findIndex_1.default)(e.primaryKeys,{cn:t.cn})>0)}_getMaxPksPossible(e){const t={int:4294967295,tinyint:255,smallint:65535,mediumint:16777215,bigint:61};return e.un?t[e.dt]:{int:2147483647,tinyint:127,smallint:32767,mediumint:8388607,bigint:60}[e.dt]}_getMaxNumPossible(e){const t={int:4294967295,tinyint:255,smallint:65535,mediumint:16777215,bigint:61};return e.un?t[e.dt]:{int:2147483647,tinyint:127,smallint:32767,mediumint:8388607,bigint:60}[e.dt]}_getMaxRowsPossible(e,t){let a=1e4;const i=e.primaryKeys[0];if(e.primaryKeys.length){const t=this.getKnexDataTypeMock(i.ct),n=(0,find_1.default)(e.columns,{cn:i.cn});"integer"===t?a=Math.pow(2,n.np):"string"===t&&n.clen&&n.clen<3&&(a=500)}let n=1e4,s=0,o=(0,findIndex_1.default)(e.columns,{ck:"UNI"},s);for(;-1!==o;){const t=e.columns[o],a=this.getKnexDataTypeMock(t.ct);"integer"===a?n=Math.pow(2,t.np):"string"===a&&t.clen&&t.clen<2&&(n=25),s=o,o=(0,findIndex_1.default)(e.columns,{ck:"UNI"},s+1)}let r=1e4;for(s=0,o=(0,findIndex_1.default)(e.columns,{ck:"MUL"},s);-1!==o;){const t=e.columns[o],a=this.getKnexDataTypeMock(t.ct);"integer"===a&&(r=Math.pow(2,t.np)),s=o,o=(0,findIndex_1.default)(e.columns,{ck:"MUL"},s+1)}return Math.min(a,n,r,t)}getColumnType(e){}getKnexDataTypeMock(e){try{const t=e;let a={};return a=dataHelp.getType(t,strTypes)?"string":dataHelp.getType(t,intTypes)?"integer":dataHelp.getType(t,floatTypes)?"float":dataHelp.getType(t,dateTypes)?"date":dataHelp.getType(t,_enumTypes)?"enum":dataHelp.getType(t,yearTypes)?"year":dataHelp.getType(t,blobTypes)?"blob":dataHelp.getType(t,boolTypes)?"boolean":dataHelp.getType(t,geometryTypes)?"geometry":dataHelp.getType(t,pointTypes)?"point":dataHelp.getType(t,linestringTypes)?"linestring":dataHelp.getType(t,polygonTypes)?"polygon":dataHelp.getType(t,multipointTypes)?"multipoint":dataHelp.getType(t,multilinestringTypes)?"multilinestring":dataHelp.getType(t,multipolygonTypes)?"multipolygon":dataHelp.getType(t,bitTypes)?"bit":dataHelp.getType(t,textTypes)?"text":dataHelp.getType(t,jsonTypes)?"json":"other",a}catch(e){return console.log(e),"string"}}getMinMax(e){}async mockDb(e){}async dbCacheInitAsyncKnex(e=null){try{const e=this;let t=null,a=[];if("mysql"===this.connectionConfig.client){t=dataHelp.getMysqlSchemaQuery();const e=await this.knex.raw(t,[this.connectionConfig.connection.database]);e.length?(a=e[0],await this.knex.raw("FLUSH TABLES",[])):console.log({},e[0])}if(a.length){for(let e=0;e<a.length;++e){const t=Object.keys(a[e]);for(let i=0;i<t.length;++i){const n=a[e][t[i]];a[e][t[i].toLowerCase()]=n}}e.iterateToCacheTables(a),e.iterateToCacheTablePks(a),e.iterateToCacheTableColumns(a),e.iterateToCacheTableFks(a),e.constructUiMeta(),console.log("erm atrix = = = = ="),e.iterateToCacheErMatrix(a),console.log("erm atrix = = = = =");for(let e=0;e<a.length;++e)"PRI"===a[e].ck&&console.log("PK >> ",a[e].tn,a[e].cn,a[e].ext)}}catch(e){console.log(e)}}getUiColumnObject(e){const t={};return t.cn=e.cn,t.dt=e.dt,t.data_type_knex=this.getKnexDataTypeMock(e.dt),t.ct=e.ct,t.nrqd="NO"!==e.nrqd,t.ck="MUL"===e.ck,t.pk="PRI"===e.ck,t.un=-1!==e.ct.indexOf("unsigned"),t.ai=-1!==e.ext.indexOf("auto_increment"),"mysql"===this.connectionConfig.client&&(t.cdf=e.cdf,t.clen=e.clen,t.np=e.np,t.ns=e.ns,t.dp=e.dp),t}constructUiMeta(){for(const e in this.metaDb.tables){const t=this.metaDb.tables[e];for(let e=0;e<t.columns.length;++e){const a=t.columns[e];t.uiModel.columns[e]=this.getUiColumnObject(a)}}}iterateToCacheTables(e){for(let t=0;t<e.length;++t){const a=e[t];{const e=a.tn;if(!(e in this.metaDb.tables)){this.metaDb.tables[e]={},this.metaDb.tables[e].primaryKeys=[],this.metaDb.tables[e].foreignKeys=[],this.metaDb.tables[e].columns=[],this.metaDb.tables[e].indicies=[],this.metaDb.tables[e].is_view=a.is_view;const t={columns:[],primaryKeys:[],foreignKeys:[],indicies:[]};this.metaDb.tables[e].uiModel=t}}}}iterateToCacheTableColumns(e){for(let t=0;t<e.length;++t){const a=e[t],i=a.tn,n={};a.cn.split(" ").length>1||(n.cn=a.cn,n.op=a.op,n.ck=a.ck,n.dt=a.dt,n.ct=a.ct,n.rtn=a.rtn,n.rcn=a.rcn,n.nrqd=a.nrqd,"mysql"===this.connectionConfig.client&&(n.ext=a.ext,n.cc=a.cc,n.cdf=a.cdf,n.clen=a.clen,n.np=a.np,n.ns=a.ns,n.dp=a.dp),dataHelp.findOrInsertObjectArrayByKey(n,"cn",this.metaDb.tables[i].columns))}}iterateToCacheTableFks(e){for(let t=0;t<e.length;++t){const a=e[t],i=a.tn;if(a.rtn){const e={};e.cn=a.cn,e.tn=a.tn,e.rtn=a.rtn,e.rcn=a.rcn,e.dt=a.dt,e.ct=a.ct,dataHelp.findOrInsertObjectArrayByKey(e,"cn",this.metaDb.tables[i].foreignKeys)}}}iterateToCacheErMatrix(e){this.metaDb.erMatrix=[];const t=Object.keys(this.metaDb.tables),a={},i={};console.log("< < < ",t);for(let e=0;e<t.length;++e)a[t[e]]=e,i[e]=t[e];this.metaDb.erTablesAsArr=t,this.metaDb.erTableIndexObj=a,this.metaDb.erIndexTableObj=i;for(let e=0;e<t.length;++e){this.metaDb.erMatrix[e]=[];for(let a=0;a<t.length;++a)this.metaDb.erMatrix[e].push(0)}console.log(this.metaDb.erTableIndexObj,this.metaDb.erIndexTableObj);for(let t=0;t<e.length;++t)if(null!==e[t].rtn){const i=a[e[t].rtn],n=a[e[t].tn];this.metaDb.erMatrix[i][n]=1}}iterateToCacheTablePks(e){for(let t=0;t<e.length;++t){const a=e[t],i=a.tn;if(this._isColumnPrimary(a)){const e={};e.cn=a.cn,e.op=a.op,e.ck=a.ck,e.dt=a.dt,e.ct=a.ct,dataHelp.findOrInsertObjectArrayByKey(e,"cn",this.metaDb.tables[i].primaryKeys)}}}emit(e){log.api(e),evt.evt.emit("UI",{status:0,data:`SQL : ${e}`})}emitW(e){log.warn(e),evt.evt.emit("UI",{status:1,data:`SQL : ${e}`})}emitE(e){log.error(e),evt.evt.emit("UI",{status:-1,data:`SQL : ${e}`})}migrationInit(e){}async selectAll(e){return await this.sqlClient(e).select()}async list(e){const{size:t=10,page:a=1,orderBy:i}=e,n=new Result_1.default;try{const s=await this.sqlClient(e.tn).count();n.data.count=Object.values(s[0])[0];const o=this.sqlClient(e.tn).select().limit(t).offset((a-1)*t);i&&i.length?n.data.list=await o.orderBy(i):n.data.list=await o}catch(e){console.log(e),n.data.list=[]}return n}executeSqlFiles(){}async createDatabaseIfNotExists(e){}async createTableIfNotExists(e){}async raw(e,...t){const a=(new Date).getTime();let i=null,n=null,s=null;try{return i=await this.sqlClient.raw(e,...t),n=(new Date).getTime(),s=n-a,log.api(`Query: (${e}) [Took: ${s} ms]`),this.emit(`${e} [Took: ${s} ms]`),i}catch(e){throw n=(new Date).getTime(),s=n-a,this.emitE(`${e} [Took: ${s} ms]`),console.log(e),e}}async insert(e){const{tn:t,data:a}=e,i=await this.sqlClient(t).insert(a);return log.debug(i),i}async update(e){const{tn:t,data:a,whereConditions:i}=e;return await this.sqlClient(t).where(i).update(a)}async delete(e){const{tn:t,whereConditions:a}=e,i=await this.sqlClient(t).where(a).del();return log.debug(i),i}async remove(e,t){await this.sqlClient(e).del().where(t)}hasTable(e){}hasDatabase(e){}getKnexDataTypes(){const e=new Result_1.default;return e.data.list=["int","tinyint","smallint","mediumint","bigint","float","decimal","double","real","bit","boolean","serial","date","datetime","timestamp","time","year","char","varchar","nchar","text","tinytext","mediumtext","longtext","binary","varbinary","blob","tinyblob","mediumblob","longblob","enum","set","time","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","json"],e}getKnexDataTypesAdvanced(e={}){const t=new Result_1.default;return t.data.list=[{type:"int",dtxp:"10",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"tinyint",dtxp:"1",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"smallint",dtxp:"5",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"mediumint",dtxp:"8",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"bigint",dtxp:"20",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"bit",dtxp:"",dtxs:"",aggrDataType:"numeric",cdf:"1"},{type:"boolean",dtxp:"",dtxs:"",aggrDataType:"boolean",cdf:""},{type:"float",dtxp:"10",dtxs:"2",aggrDataType:"float",cdf:""},{type:"decimal",dtxp:"10",dtxs:"2",aggrDataType:"float",cdf:""},{type:"double",dtxp:"10",dtxs:"2",aggrDataType:"float",cdf:""},{type:"serial",dtxp:"",dtxs:"",aggrDataType:"numeric",cdf:""},{type:"date",dtxp:"",dtxs:"",aggrDataType:"datetime",cdf:""},{type:"datetime",dtxp:"",dtxs:"",aggrDataType:"datetime",cdf:""},{type:"timestamp",dtxp:"",dtxs:"",aggrDataType:"datetime",cdf:""},{type:"time",dtxp:"",dtxs:"",aggrDataType:"time",cdf:""},{type:"year",dtxp:"",dtxs:"",aggrDataType:"year",cdf:""},{type:"char",dtxp:"10",dtxs:"",aggrDataType:"char",cdf:""},{type:"varchar",dtxp:"10",dtxs:"",aggrDataType:"char",cdf:""},{type:"nchar",dtxp:"10",dtxs:"",aggrDataType:"char",cdf:""},{type:"text",dtxp:"",dtxs:"",aggrDataType:"text",cdf:""},{type:"tinytext",dtxp:"",dtxs:"",aggrDataType:"text",cdf:""},{type:"mediumtext",dtxp:"",dtxs:"",aggrDataType:"text",cdf:""},{type:"longtext",dtxp:"",dtxs:"",aggrDataType:"text",cdf:""},{type:"binary",dtxp:"255",dtxs:"",aggrDataType:"binary",cdf:""},{type:"varbinary",dtxp:"255",dtxs:"",aggrDataType:"binary",cdf:""},{type:"blob",dtxp:"",dtxs:"",aggrDataType:"blob",cdf:""},{type:"tinyblob",dtxp:"",dtxs:"",aggrDataType:"blob",cdf:""},{type:"mediumblob",dtxp:"",dtxs:"",aggrDataType:"blob",cdf:""},{type:"longblob",dtxp:"",dtxs:"",aggrDataType:"blob",cdf:""},{type:"enum",dtxp:"'a','b'",dtxs:"",aggrDataType:"enum",cdf:""},{type:"set",dtxp:"'a','b'",dtxs:"",aggrDataType:"set",cdf:""},{type:"geometry",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"point",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"linestring",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"polygon",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"multipoint",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"multilinestring",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"multipolygon",dtxp:"",dtxs:"",aggrDataType:"geometry",cdf:""},{type:"json",dtxp:"",dtxs:"",aggrDataType:"json",cdf:""}],e&&"aggrDataType"in e&&(t.data.list=t.data.list.filter((t=>t.aggrDataType===e.aggrDataType))),t}async tableCreate(e){const t=this.tableCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient,await this.sqlClient.schema.createTable(e.table,(function(t){const a=[],i=JSON.parse(JSON.stringify(e.columns));for(let e=0;e<i.length;++e)i[e].pk&&(a.push(e),i[e].pk=!1,i[e].ai=!1);if(a.length>1){for(let a=0;a<i.length;++a)columnCreate(e.sqlClient,t,i[a]);createPks(t,e.columns,a)}else for(let a=0;a<e.columns.length;++a)columnCreate(e.sqlClient,t,e.columns[a])}));const t=this.sqlClient.schema.createTable(e.table,(function(t){const a=[],i=JSON.parse(JSON.stringify(e.columns));for(let e=0;e<i.length;++e)i[e].pk&&(a.push(e),i[e].pk=!1,i[e].ai=!1);if(a.length>1){for(let a=0;a<i.length;++a)columnCreate(e.sqlClient,t,i[a]);createPks(t,e.columns,a)}else for(let a=0;a<e.columns.length;++a)columnCreate(e.sqlClient,t,e.columns[a])})).toSQL();this.emit(`Success : ${t}`);const i=this.sqlClient.schema.dropTable(e.table).toSQL();a.data.object={upStatement:t,downStatement:i}}catch(e){throw log.ppe(e,t),e}return a}async tableRename(e){const t=this.tableCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{e.table=e.tn,await this.sqlClient.schema.renameTable(e.tn_old,e.tn);const t=this.querySeparator()+this.sqlClient.schema.renameTable(e.tn_old,e.tn).toQuery();this.emit(`Success : ${t}`);const i=this.querySeparator()+this.sqlClient.schema.renameTable(e.tn,e.tn_old).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw log.ppe(e,t),e}return a}async tableUpdate(e){const t=this.tableUpdate.name,a=new Result_1.default;log.api(`${t}:args:`,e);let i=!1,n={};try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;const s=[],o=[];let r=0;for(let t=0;t<e.columns.length;++t)e.columns[t].pk&&o.push(t);for(let t=0;t<e.originalColumns.length;++t)e.originalColumns[t].pk&&s.push(t);if(o.length>s.length)r=o.length-s.length;else if(o.length<s.length)r=o.length-s.length;else for(let e=0;e<o.length;++e)o[e]!==s[e]&&(r=1);if(console.log("pksChanged:",r),await this.sqlClient.schema.alterTable(e.table,(function(s){if(r)pkUpdate(s,e.columns,e.originalColumns);else for(let o=0;o<e.columns.length;++o){const r=(0,find_1.default)(t,{cn:e.columns[o].cno});8&e.columns[o].altered?(i=!0,n=renameColumn(e.sqlClient,e.connectionConfig,s,r,e.columns[o]),a.data.object=n):4&e.columns[o].altered?removeColumn(s,e.columns[o],r):2&e.columns[o].altered?columnUpdate(e.sqlClient,s,e.columns[o],r):1&e.columns[o].altered&&columnUpdate(e.sqlClient,s,e.columns[o],null)}})),i)await this.sqlClient.raw(n.upStatement),a.data.object=n;else{const i=this.sqlClient.schema.alterTable(e.table,(function(a){if(r)pkUpdate(a,e.columns,e.originalColumns);else for(let i=0;i<e.columns.length;++i){const n=(0,find_1.default)(t,{cn:e.columns[i].cno});8&e.columns[i].altered||(4&e.columns[i].altered?removeColumn(a,e.columns[i],n):2&e.columns[i].altered?columnUpdate(e.sqlClient,a,e.columns[i],n):1&e.columns[i].altered&&columnUpdate(e.sqlClient,a,e.columns[i],null))}})).toSQL(),n=this.sqlClient.schema.alterTable(e.table,(function(a){if(r)pkUpdate(a,e.columns,e.originalColumns);else for(let i=0;i<e.columns.length;++i){const n=(0,find_1.default)(t,{cn:e.columns[i].cno});8&e.columns[i].altered||(4&e.columns[i].altered?columnUpdate(e.sqlClient,a,n,null):1&e.columns[i].altered?removeColumn(a,e.columns[i],null):2&e.columns[i].altered&&columnUpdate(e.sqlClient,a,n,e.columns[i]))}})).toSQL();a.data.object={upStatement:i,downStatement:n}}}catch(e){throw log.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const{columns:t}=e;e.sqlClient=this.sqlClient;const i=this.sqlClient.schema.dropTable(e.tn).toSQL(),n=this.sqlClient.schema.createTable(e.tn,(function(a){for(let i=0;i<t.length;++i)columnCreate(e.sqlClient,a,t[i])})).toSQL();this.emit(`Success : ${i}`),await this.sqlClient.schema.dropTable(e.tn),a.data.object={upStatement:i,downStatement:n}}catch(e){throw log.ppe(e,t),e}return a}async indexCreate(e){const t=this.indexCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);const i=e.indexName||null;try{e.table=e.tn,await this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.index(e.columns,i):t.unique(e.columns,i)}));const t=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.index(e.columns,i):t.unique(e.columns,i)})).toQuery();this.emit(`Success : ${t}`);const n=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)})).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:n}]}}catch(e){throw log.ppe(e,t),e}return a}async indexDelete(e){const t=this.indexDelete.name,a=new Result_1.default;log.api(`${t}:args:`,e);const i=e.indexName||null;try{e.table=e.tn,await this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)}));const t=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.dropIndex(e.columns,i):t.dropUnique(e.columns,i)})).toQuery();this.emit(`Success : ${t}`);const n=this.querySeparator()+this.sqlClient.schema.table(e.table,(function(t){e.non_unique_original?t.index(e.columns,i):t.unique(e.columns,i)})).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:n}]}}catch(e){throw log.ppe(e,t),e}return a}async relationCreate(e){const t=this.relationCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);const i=e.foreignKeyName||null;try{const t=this.sqlClient.schema.table(e.childTable,(function(t){t=t.foreign(e.childColumn,i).references(e.parentColumn).on(e.parentTable),e.onUpdate&&(t=t.onUpdate(e.onUpdate)),e.onDelete&&t.onDelete(e.onDelete)}));await t;const n=this.querySeparator()+t.toQuery();this.emit(`Success : ${n}`);const s=this.querySeparator()+this.sqlClient.schema.table(e.childTable,(function(t){t.dropForeign(e.childColumn,i)})).toQuery();a.data.object={upStatement:[{sql:n}],downStatement:[{sql:s}]}}catch(e){throw log.ppe(e,t),e}return a}async relationDelete(e){const t=this.relationDelete.name,a=new Result_1.default;log.api(`${t}:args:`,e);const i=e.foreignKeyName||null;try{await this.sqlClient.schema.table(e.childTable,(function(t){t.dropForeign(e.childColumn,i)}));const t=this.querySeparator()+this.sqlClient.schema.table(e.childTable,(function(t){t.dropForeign(e.childColumn,i)})).toQuery(),n=this.querySeparator()+await this.sqlClient.schema.table(e.childTable,(function(t){t.foreign(e.childColumn,i).references(e.parentColumn).on(e.parentTable)})).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:n}]}}catch(e){throw log.ppe(e,t),e}return a}getKnexDataType(e){try{switch(e){case"int":return"integer";case"bigint":return"bigInteger";case"varchar":return"string";case"text":case"float":case"decimal":case"boolean":case"date":case"datetime":case"time":case"timestamp":case"binary":case"json":return e;case"enum":return"enu";default:return"specificType"}}catch(e){return log.debug(e),"string"}}getType(e,t){for(let a=0;a<t.length;++a)if(-1!==e.indexOf(t[a]))return 1;return 0}async fakerColumnsList(e){const t=this.fakerColumnsList.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const t=path_1.default.join(e.seedsFolder,`${e.tn}.json`),i=await(0,util_1.promisify)(jsonfile_1.default.readFile)(t);a.data.list=i}catch(e){log.ppe(e,t),a.data.list=[]}return a}async fakerColumnsCreate(e){const t=this.fakerColumnsCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const t=path_1.default.join(e.seedsFolder,`${e.tn}.json`);await(0,util_1.promisify)(jsonfile_1.default.writeFile)(t,e.fakerColumns,{spaces:2}),this.emit(`Created : ${t}`)}catch(e){throw log.ppe(e,t),e}return a}async fakerColumnsUpdate(e){const t=this.fakerColumnsUpdate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Success :")}catch(e){throw log.ppe(e,t),e}return a}async fakerColumnsDelete(e){const t=this.fakerColumnsDelete.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Success :")}catch(e){throw log.ppe(e,t),e}return a}async _getmetaDb(){}async seedInit(e){const t=this.seedInit.name,a=new Result_1.default;log.api(`${t}:args:`,e),console.log("in knex SeedInit");try{await(0,mkdirp_1.default)(e.seedsFolder)}catch(e){throw log.ppe(e,t),e}return a}async seedTerm(e){const t=this.seedInit.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Success : seedTerm")}catch(e){throw log.ppe(e,t),e}return a}async seedStart(e){const t=this.seedStart.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Seeding : Started"),await this.mockDb(e),this.emit("Seeding : Finished")}catch(e){throw log.ppe(e,t),e}return a}async seedStop(e){const t=this.seedStop.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{this.emit("Success : seedStop")}catch(e){throw log.ppe(e,t),e}return a}async seedSettingsRead(e){const t=this.seedSettingsRead.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const t=path_1.default.join(e.seedsFolder,"__xseeds.json"),i=await(0,util_1.promisify)(jsonfile_1.default.readFile)(t);a.data=i}catch(e){log.ppe(e,t)}return a}async seedSettingsCreate(e){const t=this.seedSettingsCreate.name,a=new Result_1.default;log.api(`${t}:args:`,e);try{const t=path_1.default.join(e.seedsFolder,"__xseeds.json");await(0,util_1.promisify)(jsonfile_1.default.writeFile)(t,e.settings,{spaces:2}),this.emit("Success : Seed settings updated")}catch(e){throw log.ppe(e,t),e}return a}querySeparator(){return"/* xc */\n"}getTnPath(e){return e}async tableCreateStatement(e){}async tableInsertStatement(e){}async tableUpdateStatement(e){}async tableDeleteStatement(e){}async tableTruncateStatement(e){}async tableSelectStatement(e){}async sequelizeModelCreate(e){}genQuery(e,t=[],a=0){a&&(t=((Array.isArray(t)?t:[t])||[]).map((e=>"string"==typeof e?this.sanitize(e):e)));const i=this.sqlClient.raw(e,t).toQuery();return a?this.sanitize(i):this.unsanitize(i)}sanitize(e){return e.replace(/([^\\]|^)(\?+)/g,((e,t,a)=>`${t}${a.split("?").join("\\?")}`))}unsanitize(e){return e.replace(/\\[?]/g,"?")}genValue(e){return this.genQuery("?",[e],!0)}genIdentifier(e){return this.genQuery("??",[e],!0)}genRaw(e){const t=this.genQuery("?",[e],!0);return"number"==typeof e||"boolean"==typeof e?t:t.substring(1,t.length-1)}sanitiseDataType(e){if(/^[\w -]+(?:\(\d+(?:\s?,\s?\d+)?\))?$/.test(e))return e;throw new Error(`Invalid data type: ${e}`)}sanitiseDefaultValue(e){if(null!=e){if("string"==typeof e){if(["NULL","null","TRUE","true","FALSE","false"].includes(e))return e;if(/^\d+(\.\d+)?$/.test(e))return e;if(/^\w+\(\)$/.test(e))return e;if(/^CURRENT_TIMESTAMP[\w ]*$/.test(e.toUpperCase()))return e;const t=e.match(/^(['"])(.*)\1$/);return t?this.genQuery("?",[t[2].replace('"'===t[1]?/\\"/g:/\\'/g,t[1])]):this.genQuery("?",[e])}return this.genQuery("?",[e])}}}exports.default=KnexClient},4506:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.connectionConfig=e,this.sqlClient=null}async testConnection(e){}migrationInit(e){}migrationUp(e){}migrationDown(e){}selectAll(e){}executeSqlFiles(){}async createDatabaseIfNotExists(e){}async createTableIfNotExists(e){}startTransaction(){}commit(){}rollback(){}hasTable(e){}hasDatabase(e){}async tableCreate(e){}async tableUpdate(e){}async columnCreate(e){}async columnUpdate(e){}async columnDelete(e){}async indexCreate(e){}async indexUpdate(e){}async indexDelete(e){}async relationCreate(e){}async relationUpdate(e){}async relationDelete(e){}async databaseList(e){}async tableList(e){}async schemaList(e){}async tableDelete(e){}async columnList(e){}async indexList(e){}async relationList(e){}async schemaCreate(e){}async schemaDelete(e){}async triggerList(e){}async triggerCreate(e){}async triggerRead(e){}async functionList(e){}async functionRead(e){}async procedureList(e){}async procedureRead(e){}async viewList(e){}async viewRead(e){}async sequenceList(e={}){}async sequenceCreate(e={}){}async sequenceUpdate(e={}){}async sequenceDelete(e={}){}async tableCreateStatement(e){}async tableInsertStatement(e){}async tableUpdateStatement(e){}async tableDeleteStatement(e){}async tableTruncateStatement(e){}async tableSelectStatement(e){}async totalRecords(e){}}},47668:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SqlClientFactory=void 0;const n=i(a(57147)),s=a(16464),o=i(a(8935)),r=i(a(65086)),l=i(a(1127)),c=i(a(70984)),d=i(a(87750)),u=i(a(37522)),p=i(a(94621)),m=i(a(46074));class f{static create(e){if(e.meta=e.meta||{},e.pool=e.pool||{min:0,max:5},e.meta.dbtype=e.meta.dbtype||"","mysql"===e.client||"mysql2"===e.client)return"tidb"===e.meta.dbtype?new p.default(e):"vitess"===e.meta.dbtype?new m.default(e):new o.default(e);if("sqlite3"===e.client)return new c.default(e);if("mssql"===e.client)return new r.default(e);if("oracledb"===e.client)return new l.default(e);if("pg"===e.client)return"yugabyte"===e.meta.dbtype?new u.default(e):new d.default(e);throw new Error("Database not supported")}}t.SqlClientFactory=f;t.default=class{static async create(e){return e.connection.ssl&&"object"==typeof e.connection.ssl&&(e.connection.ssl.caFilePath&&(e.connection.ssl.ca=(await(0,s.promisify)(n.default.readFile)(e.connection.ssl.caFilePath)).toString(),delete e.connection.ssl.caFilePath),e.connection.ssl.keyFilePath&&(e.connection.ssl.key=(await(0,s.promisify)(n.default.readFile)(e.connection.ssl.keyFilePath)).toString(),delete e.connection.ssl.keyFilePath),e.connection.ssl.certFilePath&&(e.connection.ssl.cert=(await(0,s.promisify)(n.default.readFile)(e.connection.ssl.certFilePath)).toString(),delete e.connection.ssl.certFilePath)),f.create(e)}}},24931:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getType=t.getColumnType=t.getDataType=t.getChartQuery=t.getMysqlSchemaQuery=t.getStepArray=t.getStepArraySimple=t.numberGetFixed=t.numberGetLength=t.numberRound=t.round=t.findObjectInArrayByKey=t.findOrInsertObjectArrayByKey=void 0;t.findOrInsertObjectArrayByKey=(e,t,a)=>{let i=0,n=0;for(n=0;n<a.length;++n)if(t in a[n]&&e[t]===a[n][t]){i=1;break}return i||a.push(e),a[n]};t.findObjectInArrayByKey=(e,t,a)=>{for(let i=0;i<a.length;++i)if(a[i][e]===t)return a[i];return null};t.round=function(e,t){const a=Math.pow(10,t),i=e*a;return Math.round(i)/a};t.numberRound=(e,t)=>{const a=Math.pow(10,t),i=e*a;return Math.round(i)/a};t.numberGetLength=e=>{let t=e;return e<0&&(t*=-1),t.toString().length};t.numberGetFixed=e=>parseInt(e.toFixed());t.getStepArraySimple=function(e,t,a){const i=[];for(let n=e;n<=t;n+=a)i.push(n);return i};t.getStepArray=(e,a,i)=>{e=(0,t.numberGetFixed)(e),a=(0,t.numberGetFixed)(a);let n=e-(i=(0,t.numberGetFixed)(i))/2,s=a+i/2;n=(0,t.numberGetFixed)(n),s=(0,t.numberGetFixed)(s);const o=(0,t.numberGetLength)(n),r=(0,t.numberGetLength)(s),l=(0,t.numberGetLength)(i);o>1&&(n=(0,t.numberRound)(n,-1)),r>2&&(s=(0,t.numberRound)(s,-1)),1!==l&&(i=(0,t.numberRound)(i,-1));const c=[];for(let e=n;e<s;e+=i)c.push(e);return c.push(s),c};t.getMysqlSchemaQuery=function(){return"select c.table_name as tn, c.column_name as cn, c.ordinal_position as cop,c.column_key as ck,c.is_nullable as nrqd, c.data_type, c.column_type as ct,c.extra as ext,c.privileges as priv, c.cc,c.cdf as cdf,c.data_type,c.character_maximum_length as clen,c.numeric_precision as np,c.numeric_scale as ns,c.datetime_precision as dp, k.constraint_name as cstn, k.referenced_table_name as rtn, k.referenced_column_name as rcn, s.index_name,s.seq_in_index, v.table_name as is_view from information_schema.columns as c left join information_schema.key_column_usage as k on c.column_name=k.column_name and c.table_schema = k.referenced_table_schema and c.table_name = k.table_name left join information_schema.statistics as s on c.column_name = s.column_name and c.table_schema = s.index_schema and c.table_name = s.table_name LEFT JOIN information_schema.VIEWS as v ON c.table_schema = v.table_schema and c.table_name = v.table_name where c.table_schema=? order by c.table_name, c.ordinal_position"};t.getChartQuery=function(){return"select ? as ??, count(*) as _count from ?? where ?? between ? and ? "};t.getDataType=function(e,t){for(let a=0;a<t.length;++a)if(-1!==e.indexOf(t[a]))return 1;return 0};t.getColumnType=function(e){return(0,t.getDataType)(e.data_type,["varchar","text","char","tinytext","mediumtext","longtext","ntext","image","blob","mediumblob","longblob","binary","varbinary","character","character varying","nchar","nvarchar","clob","nvarchar2","varchar2","raw","long raw","bfile","nclob"])?"string":(0,t.getDataType)(e.data_type,["bit","integer","int","smallint","mediumint","bigint","tinyint","int2","int4","int8","long","serial","bigserial","smallserial","bool","boolean","number"])?"int":(0,t.getDataType)(e.data_type,["float","double","decimal","numeric","real","double precision","real","money","smallmoney","dec"])?"float":(0,t.getDataType)(e.data_type,["date","datetime","timestamp","time","year","timestamp without time zone","timestamp with time zone","time without time zone","time with time zone","datetime2","smalldatetime","datetimeoffset","interval year","interval day"])?"date":"string"};t.getType=function(e,t){return t.includes(e)}},65086:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(40514)),s=i(a(76918)),o=i(a(38463)),r=i(a(10277)),l=i(a(34032)),c=new r.default("MssqlClient");class d extends o.default{constructor(e){super(e)}async sequenceDelete(e){const t=this.sequenceDelete.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=this.querySeparator()+`DROP SEQUENCE ${e.sequence_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`CREATE SEQUENCE ${e.sequence_name}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async sequenceList(e){const t=this.sequenceList.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SELECT * FROM sys.SEQUENCES;");a.data.list=t.map((e=>Object.assign(Object.assign({},e),{sequence_name:e.name,original_sequence_name:e.name})))}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async sequenceCreate(e){const t=this.sequenceCreate.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE SEQUENCE ${e.sequence_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP SEQUENCE ${e.sequence_name}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async sequenceUpdate(e){const t=this.sequenceUpdate.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=this.querySeparator()+`ALTER SEQUENCE ${e.original_sequence_name} RENAME TO ${e.sequence_name};`,i=this.querySeparator()+`ALTER SEQUENCE ${e.sequence_name} RENAME TO ${e.original_sequence_name};`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async testConnection(e={}){const t=this.testConnection.name,a=new l.default;c.api(`${t}:args:`,e);try{await this.sqlClient.raw("SELECT 1+1 AS data")}catch(e){c.ppe(e),a.code=-1,a.message=e.message}finally{c.api(`${t}:result:`,a)}return a}getKnexDataTypes(){const e=new l.default;return e.data.list=["bigint","binary","bit","char","date","datetime","datetime2","datetimeoffset","decimal","float","geography","geometry","heirarchyid","image","int","money","nchar","ntext","numeric","nvarchar","real","json","smalldatetime","smallint","smallmoney","sql_variant","sysname","text","time","timestamp","tinyint","uniqueidentifier","varbinary","xml","varchar"],e}async version(e={}){const t=this.version.name,a=new l.default;c.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT SERVERPROPERTY('productversion') AS version, SERVERPROPERTY ('productlevel') AS level, SERVERPROPERTY ('edition') AS edition, @@version AS versionD");a.data.object={};const t=e[0],i=t.version.split(".");a.data.object.version=t.version,a.data.object.primary=i[0],a.data.object.major=i[1],a.data.object.minor=i[2]}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async createDatabaseIfNotExists(e){const t=this.createDatabaseIfNotExists.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));delete t.connection.database;const a=(0,n.default)(t);0===(await a.raw(`SELECT name from sys.databases WHERE name = '${e.database}'`)).length&&await a.raw(`CREATE DATABASE  ${e.database}`),this.sqlClient=(0,n.default)(this.connectionConfig),await a.destroy(),this.connectionConfig.searchPath&&this.connectionConfig.searchPath[0]&&await this.sqlClient.raw(" IF NOT EXISTS ( SELECT  *\n                            FROM    sys.schemas\n                            WHERE   name = ? )\n                EXEC('CREATE SCHEMA ??')",[this.connectionConfig.searchPath[0],this.connectionConfig.searchPath[0]])}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async dropDatabase(e){const t=this.dropDatabase.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));delete t.connection.database;const a=(0,n.default)(t);await this.sqlClient.destroy(),this.sqlClient=a,c.debug("dropping database:",e),await a.raw(`ALTER DATABASE ${e.database} SET SINGLE_USER WITH ROLLBACK IMMEDIATE;\n         DROP DATABASE ${e.database};`)}catch(e){c.ppe(e,t)}return c.api(`${t}: result`,a),a}async createTableIfNotExists(e){const t=this.createTableIfNotExists.name,a=new l.default;c.api(`${t}:args:`,e);try{await this.sqlClient.schema.withSchema(this.schema).hasTable(e.tn)?c.debug(`${this.getTnPath(e.tn)} tables exists`):(await this.sqlClient.schema.withSchema(this.schema).createTable(e.tn,(function(e){e.increments(),e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()})),c.debug("Table created:",`${this.getTnPath(e.tn)}`))}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async hasTable(e){const t=this.hasTable.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data.value=await this.sqlClient.schema.withSchema(this.schema).hasTable(e.tn)}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async hasDatabase(e){const t=this.hasDatabase.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`SELECT name FROM sys.databases WHERE name = '${e.databaseName}'`);a.data.value=t.length>0}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async databaseList(e={}){const t=this.databaseList.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data.list=await this.sqlClient.raw("SELECT name AS database_name, database_id, create_date FROM sys.databases ORDER BY name")}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async tableList(e={}){const t=this.tableList.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data.list=await this.sqlClient.raw("SELECT schema_name(t.schema_id) AS schema_name,\n        t.name AS tn, t.create_date, t.modify_date FROM sys.tables t WHERE schema_name(t.schema_id) = ? ORDER BY schema_name,tn ",[this.schema||"dbo"])}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async schemaList(e={}){const t=this.schemaList.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data.list=await this.sqlClient.raw(`SELECT name AS schema_name FROM master.${this.schema}.sysdatabases WHERE name not in ('master', 'tempdb', 'model', 'msdb');`)}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async columnList(e){const t=this.columnList.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT\n      c.table_name AS tn,\n       CASE WHEN trg1.trigger_name IS NULL THEN CAST(0 AS BIT) ELSE CAST(1 AS BIT) END AS au,\n       c.column_name AS cn,\n       c.ordinal_position AS cop,\n      pk.constraint_type AS ck,\n      CASE WHEN COLUMNPROPERTY(object_id(CONCAT('${this.schema}.', c.TABLE_NAME)), c.COLUMN_NAME, 'IsIdentity') = 1\n      THEN\n        1\n      ELSE\n        0\n      END AS ai,\n      c.is_nullable AS nrqd,\n      c.data_type AS dt,\n      c.column_default AS cdf,c.character_maximum_length AS clen,\n      c.character_octet_length,c.numeric_precision AS np,c.numeric_scale AS ns,c.datetime_precision AS dp,c.character_set_name AS csn,\n      c.collation_name AS clnn,\n      pk.constraint_type AS cst, pk.ordinal_position AS op, pk.constraint_name AS pk_constraint_name,\n      fk.parent_table AS rtn, fk.parent_column AS rcn,\n      v.table_name AS is_view,\n      df.default_constraint_name\n  FROM INFORMATION_SCHEMA.COLUMNS c\n    left join\n      ( SELECT kc.constraint_name, kc.table_name,kc.column_name, kc.ordinal_position,tc.constraint_type\n        FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE kc\n          INNER JOIN INFORMATION_SCHEMA.TABLE_CONSTRAINTS AS tc\n            ON kc.constraint_name = tc.constraint_name AND tc.constraint_type in ('primary key')\n        WHERE kc.table_catalog='${e.databaseName}' AND kc.table_schema='${this.schema}'\n        ) pk\n      ON \n      pk.table_name = c.table_name AND pk.column_name=c.column_name\n    left join\n          ( SELECT\n                ccu.table_name AS child_table\n                ,ccu.column_name AS child_column\n                ,kcu.table_name AS parent_table\n                ,kcu.column_name AS parent_column\n                ,ccu.constraint_name\n            FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE ccu\n                INNER JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc\n                    ON ccu.constraint_name = rc.constraint_name\n                INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE kcu\n                    ON kcu.constraint_name = rc.unique_constraint_name  ) fk\n      ON\n      fk.child_table = c.table_name AND fk.child_column=c.column_name\n    left join INFORMATION_SCHEMA.VIEWS v\n      ON v.table_name=c.table_name\n    left join (\n              SELECT\n                  default_constraints.name default_constraint_name, all_columns.name name\n              FROM\n                  sys.all_columns\n                      INNER JOIN\n                  sys.tables\n                      ON all_columns.object_id = tables.object_id\n                      INNER JOIN\n                  sys.schemas\n                      ON tables.schema_id = schemas.schema_id\n                      INNER JOIN\n                  sys.default_constraints\n                      ON all_columns.default_object_id = default_constraints.object_id\n              WHERE\n        schemas.name = '${this.schema}'\n    AND tables.name =  '${e.tn}') df ON df.name = c.column_name\n\n     left join (  SELECT trg.name AS trigger_name,\n               tab.name AS [table1]\n          FROM sys.triggers trg\n              left join sys.objects tab\n                  ON trg.parent_id = tab.object_id\n          WHERE tab.name =  '${e.tn}') trg1 ON trg1.trigger_name = CONCAT('xc_trigger_${e.tn}_' , c.column_name)\n\n    WHERE c.table_catalog='${e.databaseName}' AND c.table_schema='${this.schema}' AND c.table_name = '${e.tn}'\n    ORDER BY c.table_name, c.ordinal_position`);for(let e=0;e<t.length;e++){const a=t[e];a.pk="PRIMARY KEY"===a.ck,a.not_nullable="NO"===a.nrqd,a.rqd="NO"===a.nrqd,a.ai=1===a.ai,a.nrqd="YES"===a.nrqd,a.cno=a.cn,a.dtxp=a.clen||a.np||a.dp,a.dtxs=a.ns,a.au=!!a.au}a.data.list=t}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async indexList(e={}){const t=this.indexList.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`SELECT  t.[name] AS table_view,\n        CASE WHEN t.[type] = 'U' THEN 'Table'\n            WHEN t.[type] = 'V' THEN 'View'\n            END AS [object_type],\n        i.index_id,\n        CASE WHEN i.is_primary_key = 1 THEN 'Primary key'\n            WHEN i.is_unique = 1 THEN 'Unique'\n            else 'Not Unique' END AS [type],\n        i.[name] AS index_name,\n        substring(column_names, 1, len(column_names)-1) AS [columns],\n        CASE WHEN i.[type] = 1 THEN 'Clustered index'\n            WHEN i.[type] = 2 THEN 'Nonclustered unique index'\n            WHEN i.[type] = 3 THEN 'XML index'\n            WHEN i.[type] = 4 THEN 'Spatial index'\n            WHEN i.[type] = 5 THEN 'Clustered columnstore index'\n            WHEN i.[type] = 6 THEN 'Nonclustered columnstore index'\n            WHEN i.[type] = 7 THEN 'Nonclustered hash index'\n            END AS index_type\n    FROM sys.objects t\n        INNER JOIN sys.indexes i\n            ON t.object_id = i.object_id\n        cross apply (SELECT col.[name] + ',' + CAST(ic.key_ordinal AS varchar)  + ','\n                        FROM sys.index_columns ic\n                            INNER JOIN sys.columns col\n                                ON ic.object_id = col.object_id\n                                AND ic.column_id = col.column_id\n                        WHERE ic.object_id = t.object_id\n                            AND ic.index_id = i.index_id\n                                ORDER BY col.column_id\n                                for xml path ('') ) D (column_names)\n    WHERE t.is_ms_shipped <> 1\n    AND index_id > 0 AND t.name = '${this.getTnPath(e.tn)}'\n    ORDER BY schema_name(t.schema_id) + '.' + t.[name], i.index_id`),i=[];for(let e=0,a=0;e<t.length;++e,++a)if(t[e].key_name=t[e].index_name,t[e].non_unique="Not Unique"===t[e].type?1:0,t[e].non_unique_original="Not Unique"===t[e].type?1:0,t[e].pk="Primary key"===t[e].type,t[e].columns=t[e].columns.split(","),2===t[e].columns.length)i[a]=t[e],i[a].cn=t[e].columns[0],i[a].seq_in_index=1;else{const n=t[e].columns.slice();for(let s=0;s<n.length;s+=2,++a)i[a]=JSON.parse(JSON.stringify(t[e])),i[a].cn=n[s].trim(),i[a].seq_in_index=parseInt(n[s+1]);a--}a.data.list=i}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async constraintList(e={}){const t=this.constraintList.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT  t.[name] AS table_view,\n        CASE WHEN t.[type] = 'U' THEN 'Table'\n            WHEN t.[type] = 'V' THEN 'View'\n            END AS [object_type],\n        i.index_id,\n        CASE WHEN i.is_primary_key = 1 THEN 'Primary key'\n            WHEN i.is_unique = 1 THEN 'Unique'\n            else 'Not Unique' END AS [type],\n        i.[name] AS index_name,\n        substring(column_names, 1, len(column_names)-1) AS [columns],\n        CASE WHEN i.[type] = 1 THEN 'Clustered index'\n            WHEN i.[type] = 2 THEN 'Nonclustered unique index'\n            WHEN i.[type] = 3 THEN 'XML index'\n            WHEN i.[type] = 4 THEN 'Spatial index'\n            WHEN i.[type] = 5 THEN 'Clustered columnstore index'\n            WHEN i.[type] = 6 THEN 'Nonclustered columnstore index'\n            WHEN i.[type] = 7 THEN 'Nonclustered hash index'\n            END AS index_type\n    FROM sys.objects t\n        INNER JOIN sys.indexes i\n            ON t.object_id = i.object_id\n        cross apply (SELECT col.[name] + ', ' + CAST(ic.key_ordinal AS varchar)  + ', '\n                        FROM sys.index_columns ic\n                            INNER JOIN sys.columns col\n                                ON ic.object_id = col.object_id\n                                AND ic.column_id = col.column_id\n                        WHERE ic.object_id = t.object_id\n                            AND ic.index_id = i.index_id\n                                ORDER BY col.column_id\n                                for xml path ('') ) D (column_names)\n    WHERE t.is_ms_shipped <> 1\n    AND index_id > 0 AND t.name = '${this.getTnPath(e.tn)}'\n    ORDER BY schema_name(t.schema_id) + '.' + t.[name], i.index_id`),i=[];for(let e=0,a=0;e<t.length;++e,++a)if(t[e].cstn=t[e].index_name,t[e].cst=t[e].type,t[e].columns=t[e].columns.split(","),2===t[e].columns.length)i[a]=t[e],i[a].cn=t[e].columns[0],i[a].op=1;else{const n=t[e].columns.slice();for(let s=0;s<n.length;s+=2,++a)i[a]=JSON.parse(JSON.stringify(t[e])),i[a].cn=n[s],i[a].op=parseInt(n[s+1]);a--}a.data.list=i}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`SELECT  fk_tab.name AS tn, '>-' AS rel, pk_tab.name AS rtn,\n        fk_cols.constraint_column_id AS no, fk_col.name AS cn, ' = ' AS [join],\n        pk_col.name AS rcn, fk.name AS cstn,\n        fk.update_referential_action_desc AS ur, fk.delete_referential_action_desc AS dr\n        FROM sys.foreign_keys fk\n        INNER JOIN sys.tables fk_tab\n            ON fk_tab.object_id = fk.parent_object_id\n        INNER JOIN sys.tables pk_tab\n            ON pk_tab.object_id = fk.referenced_object_id\n        INNER JOIN sys.foreign_key_columns fk_cols\n            ON fk_cols.constraint_object_id = fk.object_id\n        INNER JOIN sys.columns fk_col\n            ON fk_col.column_id = fk_cols.parent_column_id\n            AND fk_col.object_id = fk_tab.object_id\n        INNER JOIN sys.columns pk_col\n            ON pk_col.column_id = fk_cols.referenced_column_id\n            AND pk_col.object_id = pk_tab.object_id\n        WHERE fk_tab.name = '${this.getTnPath(e.tn)}'\n        ORDER BY  fk_tab.name, pk_tab.name, fk_cols.constraint_column_id`),i={NO_ACTION:"NO ACTION",CASCADE:"CASCADE",RESTRICT:"RESTRICT",SET_NULL:"SET NULL",SET_DEFAULT:"SET DEFAULT"};for(const e of t)e.ur=i[e.ur],e.dr=i[e.dr];a.data.list=t}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationList.name,a=new l.default;c.api(`${t}:args:`,e);try{const e=await this.raw("SELECT  fk_tab.name AS tn, '>-' AS rel, pk_tab.name AS rtn,\n        fk_cols.constraint_column_id AS no, fk_col.name AS cn, ' = ' AS [join],\n        pk_col.name AS rcn, fk.name AS cstn,\n        fk.update_referential_action_desc AS ur, fk.delete_referential_action_desc AS dr\n        FROM sys.foreign_keys fk\n        INNER JOIN sys.tables fk_tab\n            ON fk_tab.object_id = fk.parent_object_id\n        INNER JOIN sys.tables pk_tab\n            ON pk_tab.object_id = fk.referenced_object_id\n        INNER JOIN sys.foreign_key_columns fk_cols\n            ON fk_cols.constraint_object_id = fk.object_id\n        INNER JOIN sys.columns fk_col\n            ON fk_col.column_id = fk_cols.parent_column_id\n            AND fk_col.object_id = fk_tab.object_id\n        INNER JOIN sys.columns pk_col\n            ON pk_col.column_id = fk_cols.referenced_column_id\n            AND pk_col.object_id = pk_tab.object_id\n        ORDER BY  fk_tab.name, pk_tab.name, fk_cols.constraint_column_id"),t={NO_ACTION:"NO ACTION",CASCADE:"CASCADE",RESTRICT:"RESTRICT",SET_NULL:"SET NULL",SET_DEFAULT:"SET DEFAULT"};for(const a of e)a.ur=t[a.ur],a.dr=t[a.dr];a.data.list=e}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=`SELECT trg.name AS trigger_name,\n               tab.name AS [table],\n              CASE WHEN is_instead_of_trigger = 1 THEN 'Instead of'\n                  else 'After' END AS [activation],\n              (CASE WHEN objectproperty(trg.object_id, 'ExecIsUpdateTrigger') = 1\n                          THEN 'Update' else '' end\n              + CASE WHEN objectproperty(trg.object_id, 'ExecIsDeleteTrigger') = 1\n                          THEN 'Delete' else '' end\n              + CASE WHEN objectproperty(trg.object_id, 'ExecIsInsertTrigger') = 1\n                          THEN 'Insert' else '' end\n              ) AS [event],\n              CASE WHEN trg.parent_class = 1 THEN 'Table trigger'\n                  WHEN trg.parent_class = 0 THEN 'Database trigger'\n              END [class],\n              CASE WHEN trg.[type] = 'TA' THEN 'Assembly (CLR) trigger'\n                  WHEN trg.[type] = 'TR' THEN 'SQL trigger'\n                  else '' END AS [type],\n              CASE WHEN is_disabled = 1 THEN 'Disabled'\n                  else 'Active' END AS [status],\n              object_definition(trg.object_id) AS [definition]\n          FROM sys.triggers trg\n              left join sys.objects tab\n                  ON trg.parent_id = tab.object_id\n          WHERE tab.name =  '${this.getTnPath(e.tn)}'\n          ORDER BY trg.name;`,i=await this.sqlClient.raw(t);for(let e=0;e<i.length;e++){const t=i[e];t.statement=t.definition,t.trigger=t.trigger_name,t.event=t.event.toUpperCase(),t.timing=t.activation.toUpperCase()}a.data.list=i}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new l.default;c.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT o.name AS function_name,definition, o.create_date AS created, o.modify_date AS modified,o.*\n        FROM sys.sql_modules AS m\n        JOIN sys.objects AS o ON m.object_id = o.object_id\n        AND type IN ('FN', 'IF', 'TF')");for(let t=0;t<e.length;t++){const a=e[t];"FN"===a.type&&(a.type="FUNCTION")}a.data.list=e}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT SPECIFIC_NAME AS procedure_name, ROUTINE_TYPE AS [type],LAST_ALTERED AS modified, CREATED AS created,ROUTINE_DEFINITION AS definition ,pc.*\n        FROM ${e.databaseName}.INFORMATION_SCHEMA.ROUTINES AS pc WHERE routine_type = 'PROCEDURE'`);a.data.list=t}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SELECT v.name AS view_name,v.*,m.* FROM sys.views v INNER JOIN sys.schemas s ON s.schema_id = v.schema_id AND schema_name(v.schema_id) = ?\n        INNER JOIN sys.sql_modules AS m ON m.object_id = v.object_id",[this.schema||"dbo"]);a.data.list=t}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async functionRead(e={}){const t=this.functionRead.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT o.name AS function_name,definition AS create_function, o.create_date AS created, o.modify_date AS modified,o.*\n        FROM sys.sql_modules AS m\n        JOIN sys.objects AS o ON m.object_id = o.object_id\n        AND type IN ('FN', 'IF', 'TF') AND o.name = '${e.function_name}'`);for(let e=0;e<t.length;e++){const a=t[e];"FN"===a.type&&(a.type="FUNCTION")}a.data.list=t}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT SPECIFIC_NAME AS procedure_name, ROUTINE_TYPE AS [type],LAST_ALTERED AS modified, CREATED AS created,ROUTINE_DEFINITION AS create_procedure ,pc.*\n        FROM ${e.databaseName}.INFORMATION_SCHEMA.ROUTINES AS pc WHERE routine_type = 'PROCEDURE' AND SPECIFIC_NAME='${e.procedure_name}'`);a.data.list=t}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT v.name AS view_name,v.*,m.*, m.definition AS view_definition FROM sys.views v INNER JOIN sys.schemas s ON s.schema_id = v.schema_id\n        INNER JOIN sys.sql_modules AS m ON m.object_id = v.object_id WHERE v.name = '${e.view_name}'`);a.data.list=t}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new l.default;c.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`SELECT [so].[name] AS [trigger_name], [so].[crdate] AS [created],\n        USER_NAME([so].[uid]) AS [trigger_owner], USER_NAME([so2].[uid]) AS [ts],\n        OBJECT_NAME([so].[parent_obj]) AS [tn],\n        OBJECTPROPERTY( [so].[id], 'ExecIsUpdateTrigger') AS [isupdate],\n        OBJECTPROPERTY( [so].[id], 'ExecIsDeleteTrigger') AS [isdelete],\n        OBJECTPROPERTY( [so].[id], 'ExecIsInsertTrigger') AS [isinsert],\n        OBJECTPROPERTY( [so].[id], 'ExecIsAfterTrigger') AS [isafter],\n        OBJECTPROPERTY( [so].[id], 'ExecIsInsteadOfTrigger') AS [isinsteadof],\n        OBJECTPROPERTY([so].[id], 'ExecIsTriggerDisabled') AS [disabled],df.definition\n        FROM sysobjects AS [so]\n        INNER JOIN sys.sql_modules AS df ON object_id = so.id\n        INNER JOIN sysobjects AS so2 ON so.parent_obj = so2.Id\n        WHERE [so].[type] = 'TR' AND so2.name = '${this.getTnPath(e.tn)}' AND [so].[name] = '${e.trigger_name}'`);for(let e=0;e<t.length;e++){const a=t[e];a.table=a.tn,a.statement=a.definition,a.trigger=a.trigger_name,a.event=[],a.timing=[]}a.data.list=t}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.schemaCreate.name,a=new l.default;c.api(`${t}:args:`,e);try{0===(await this.sqlClient.raw(`SELECT name FROM sys.databases WHERE name = '${e.database_name}'`)).length&&await this.sqlClient.raw(`CREATE DATABASE  ${e.database_name}`)}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async schemaDelete(e={}){const t=this.schemaDelete.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));if(t.connection.database===e.database_name){delete t.connection.database;const e=(0,n.default)(t);await this.sqlClient.destroy(),this.sqlClient=e}await this.sqlClient.raw(`ALTER DATABASE ${e.database_name} SET SINGLE_USER WITH ROLLBACK IMMEDIATE;\n         DROP DATABASE ${e.database_name};`)}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=`${this.querySeparator()}DROP TRIGGER IF EXISTS ${e.trigger_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:`${this.querySeparator()}${e.oldStatement}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async functionDelete(e={}){const t=this.functionDelete.name,a=new l.default;c.api(`${t}:args:`,e);const i=this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name}`,n=this.querySeparator()+e.create_function;try{await this.sqlClient.raw(i),a.data.object={upStatement:[{sql:i}],downStatement:[{sql:n}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async procedureDelete(e={}){const t=this.procedureDelete.name,a=new l.default;c.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP PROCEDURE IF EXISTS ${e.procedure_name}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name}`}],downStatement:[{sql:this.querySeparator()+`${e.create_procedure}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async functionCreate(e={}){const t=this.functionCreate.name,a=new l.default;c.api(`${t}:args:`,e);try{await this.sqlClient.raw(`${e.create_function}`),a.data.object={upStatement:[{sql:this.querySeparator()+`${e.create_function}`}],downStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new l.default;c.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP FUNCTION IF EXISTS ${e.function_name}`),await this.sqlClient.raw(`${e.create_function}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name};${this.querySeparator()}\n${e.create_function}`}],downStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name};${this.querySeparator()} ${e.oldCreateFunction}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new l.default;c.api(`${t}:args:`,e);try{await this.sqlClient.raw(`${e.create_procedure}`),a.data.object={upStatement:[{sql:this.querySeparator()+`${e.create_procedure}`}],downStatement:[{sql:this.querySeparator()+`DROP PROCEDURE ${e.procedure_name}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new l.default;c.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP PROCEDURE IF EXISTS ${e.procedure_name}`),await this.sqlClient.raw(`${e.create_procedure}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name};${this.querySeparator()}\n${e.create_procedure}`}],downStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name};${this.querySeparator()}${e.oldCreateProcedure}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=this.genQuery(`CREATE TRIGGER ?? ON ?? \n${e.timing} ${e.event}\n as\n${e.statement}`,[e.trigger_name,this.getTnPath(e.tn)]);await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`DROP TRIGGER ${e.trigger_name}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new l.default;c.api(`${t}:args:`,e);try{await this.sqlClient.raw(`ALTER TRIGGER ${e.trigger_name} ON ${this.getTnPath(e.tn)} \n${e.timing} ${e.event}\n AS\n${e.statement}`),a.data.object={upStatement:[{sql:this.querySeparator()+`ALTER TRIGGER ${e.trigger_name} ON ${this.getTnPath(e.tn)} \n${e.timing} ${e.event}\n AS\n${e.statement}`}],downStatement:[{sql:this.querySeparator()+`ALTER TRIGGER ${e.trigger_name} ON ${this.getTnPath(e.tn)} \n${e.timing} ${e.event}\n AS\n${e.statement}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=e.view_definition;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`DROP VIEW ${e.view_name}`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=e.view_definition;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`DROP VIEW ${e.view_name} ; ${this.querySeparator()}${e.oldViewDefination};`}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new l.default;c.api(`${t}:args:`,e);try{const t=`DROP VIEW ${e.view_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+e.oldViewDefination}]}}catch(e){throw c.ppe(e,t),e}return c.api(`${t}: result`,a),a}async tableCreate(e){const t=this.tableCreate.name,a=new l.default;c.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.createTable(e.tn,e);await this.sqlClient.raw(t);const i=this.querySeparator()+this.sqlClient.schema.withSchema(this.schema).dropTable(e.table).toString();this.emit(`Success : ${t}`);const n=await this.afterTableCreate(e);a.data.object={upStatement:[{sql:t},...n.upStatement],downStatement:[...n.downStatement,{sql:i}]}}catch(e){throw c.ppe(e,t),e}return a}async afterTableCreate(e){const t={upStatement:[],downStatement:[]};let a="",i="";const n=e.columns.find((e=>e.pk));if(!n)return t;for(let t=0;t<e.columns.length;t++){const s=e.columns[t];if(s.au){const t=`[${this.schema}].[xc_trigger_${e.table_name}_${s.column_name}]`,o=this.querySeparator()+this.genQuery("CREATE TRIGGER ?? ON ?? AFTER UPDATE\n                  AS\n                  BEGIN\n                      SET NOCOUNT ON;\n                      UPDATE ?? Set ?? = GetDate() WHERE ?? in (SELECT ?? FROM Inserted)\n                  END;",[t,this.getTnPath(e.table_name),this.getTnPath(e.table_name),s.column_name,n.column_name,n.column_name]);a+=o,await this.sqlClient.raw(o),i+=this.querySeparator()+`DROP TRIGGER IF EXISTS ${this.schema}.${t};`}}return t.upStatement[0]={sql:a},t.downStatement[0]={sql:i},t}async afterTableUpdate(e){const t={upStatement:[],downStatement:[]};let a="",i="";const n=e.columns.find((e=>e.pk));if(!n)return t;for(let t=0;t<e.columns.length;t++){const s=e.columns[t];if(s.au&&1===s.altered){const t=`xc_trigger_${e.table_name}_${s.column_name}`,o=this.querySeparator()+`CREATE TRIGGER [${this.schema}].[${t}] ON  [${this.schema}].[${e.table_name}] AFTER UPDATE\n                  AS\n                  BEGIN\n                      SET NOCOUNT ON;\n                      UPDATE [${this.schema}].[${e.table_name}] Set [${s.column_name}] = GetDate() WHERE [${n.column_name}] in (SELECT [${n.column_name}] FROM Inserted)\n                  END;`;a+=o,await this.sqlClient.raw(o),i+=this.querySeparator()+`DROP TRIGGER IF EXISTS [${this.schema}].[${t}];`}}return t.upStatement[0]={sql:a},t.downStatement[0]={sql:i},t}async tableUpdate(e){const t=this.tableUpdate.name,a=new l.default;c.api(`${t}:args:`,e);try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let i="",n="";for(let a=0;a<e.columns.length;++a){const o=(0,s.default)(t,{cn:e.columns[a].cno});4&e.columns[a].altered?(i+=this.alterTableRemoveColumn(e.table,e.columns[a],o,i),n+=this.alterTableAddColumn(e.table,o,e.columns[a],n)):2&e.columns[a].altered||8&e.columns[a].altered?(i+=this.alterTableChangeColumn(e.table,e.columns[a],o,i),n+=this.alterTableChangeColumn(e.table,o,e.columns[a],n)):1&e.columns[a].altered&&(i+=this.alterTableAddColumn(e.table,e.columns[a],o,i),n+=this.alterTableRemoveColumn(e.table,e.columns[a],o,n))}i+=this.alterTablePK(e.table,e.columns,e.originalColumns,i),n+=this.alterTablePK(e.table,e.originalColumns,e.columns,n),await this.sqlClient.raw(i),console.log(i);const o=await this.afterTableUpdate(e);a.data.object={upStatement:[{sql:this.querySeparator()+i},...o.upStatement],downStatement:[...o.downStatement,{sql:this.querySeparator()+n}]}}catch(e){throw c.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new l.default;c.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.sqlClient.schema.withSchema(this.schema).dropTable(e.tn).toString();let i=this.querySeparator()+this.createTable(e.tn,e);this.emit(`Success : ${t}`);let n=await this.relationList({tn:e.tn});n=n.data.list;for(const e of n)i+=this.querySeparator()+await this.sqlClient.withSchema(this.schema).schema.table(e.tn,(t=>{t=t.foreign(e.cn,null).references(e.rcn).on(this.getTnPath(e.rtn)),e.ur&&(t=t.onUpdate(e.ur)),e.dr&&t.onDelete(e.dr)})).toQuery();let s=await this.indexList(e);s=s.data.list.filter((({type:e,key_name:t})=>"Primary key"!==e&&-1===t.indexOf("fk_")));const o={};for(const{key_name:t,non_unique:a,cn:i}of s)t in o||(o[t]={tn:this.getTnPath(e.tn),indexName:t,non_unique:a,columns:[]}),o[t].columns.push(i);for(const{non_unique:e,tn:t,columns:a,key_name:n}of Object.values(o))i+=this.querySeparator()+this.sqlClient.schema.withSchema(this.schema).table(t,(function(t){e?t.index(a,n):t.unique(a,n)})).toQuery();await this.sqlClient.schema.withSchema(this.schema).dropTable(e.tn),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw c.ppe(e,t),e}return a}async relationCreate(e){const t=this.relationCreate.name,a=new l.default;c.api(`${t}:args:`,e);const i=e.foreignKeyName||null;try{const t=this;await this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(a){a=a.foreign(e.childColumn,i).references(e.parentColumn).on(t.getTnPath(e.parentTable)),e.onUpdate&&(a=a.onUpdate(e.onUpdate)),e.onDelete&&a.onDelete(e.onDelete)}));const n=this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(a){a=a.foreign(e.childColumn,i).references(e.parentColumn).on(t.getTnPath(e.parentTable)),e.onUpdate&&(a=a.onUpdate(e.onUpdate)),e.onDelete&&a.onDelete(e.onDelete)}));await n;const s=this.querySeparator()+n.toQuery();this.emit(`Success : ${s}`);const o=this.querySeparator()+this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(t){t.dropForeign(e.childColumn,i)})).toQuery();a.data.object={upStatement:[{sql:s}],downStatement:[{sql:o}]}}catch(e){throw c.ppe(e,t),e}return a}async relationDelete(e){const t=this.relationDelete.name,a=new l.default;c.api(`${t}:args:`,e);const i=e.foreignKeyName||null;try{const t=this;await this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(t){t.dropForeign(e.childColumn,i)}));const n=this.querySeparator()+this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(t){t.dropForeign(e.childColumn,i)})).toQuery(),s=this.querySeparator()+await this.sqlClient.schema.table(this.getTnPath(e.childTable),(function(a){a.foreign(e.childColumn,i).references(e.parentColumn).on(t.getTnPath(e.parentTable))})).toQuery();a.data.object={upStatement:[{sql:n}],downStatement:[{sql:s}]}}catch(e){throw c.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name;let a=new l.default;c.api(`${t}:args:`,e);try{a=await this.columnList(e);const t=this.createTable(e.tn,{tn:e.tn,columns:a.data.list});a.data=t}catch(e){throw c.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data=`INSERT INTO \`${this.getTnPath(e.tn)}\` (`;let t=" VALUES (";const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`${i.data.list[e].cn}\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n${i.data.list[e].cn}\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw c.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data=`UPDATE ${this.getTnPath(e.tn)} \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,${t.data.list[e].cn} = <\`${t.data.list[e].cn}\`>\n\t`:`${t.data.list[e].cn} = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw c.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data=`DELETE FROM ${this.getTnPath(e.tn)} WHERE ;`}catch(e){throw c.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE ${this.getTnPath(e.tn)};`}catch(e){throw c.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new l.default;c.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, ${t.data.list[e].cn}\n\t`:`${t.data.list[e].cn}\n\t`;a.data+=` FROM ${e.tn};`}catch(e){throw c.ppe(e,t),e}return a}alterTablePK(e,t,a,i,n=!1){const s=[],o=[];let r=0;for(let e=0;e<t.length;++e)t[e].pk&&4!==t[e].altered&&o.push(t[e].cn);for(let e=0;e<a.length;++e)a[e].pk&&s.push(a[e].cn);if(o.length===s.length){for(let e=0;e<o.length;++e)if(s[e]!==o[e]){r=1;break}}else r=o.length-s.length;let l="";return(o.length||s.length)&&r&&(l+=s.length?",DROP PRIMARY KEY":"",o.length&&(l+=n?this.genQuery(", PRIMARY KEY(??)",[o],true):this.genQuery("ALTER TABLE ?? ADD PRIMARY KEY(??)",[this.getTnPath(e),o],true))),l}getTnPath(e){return this.schema?`${this.schema}.${e}`:e}alterTableRemoveColumn(e,t,a,i){let n=i?";":"";return t.cdf&&(n+=this.genQuery("\nALTER TABLE ?? DROP CONSTRAINT ??;",[this.getTnPath(e),t.default_constraint_name||`DF_${e}_${t.cn}`],true)),n+=this.genQuery("\nALTER TABLE ?? DROP COLUMN ??",[this.getTnPath(e),t.cn],true),n}createTableColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,0)}alterTableAddColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,1)}alterTableChangeColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,2)}createTable(e,t){let a="";for(let i=0;i<t.columns.length;++i)a+=this.createTableColumn(e,t.columns[i],null,a);return a+=this.alterTablePK(e,t.columns,[],a,!0),a=this.genQuery(`CREATE TABLE ?? (${a});`,[this.getTnPath(t.tn)],!0),a}alterTableColumn(e,t,a,i,n=2){let s="";const o=this.sanitiseDefaultValue(t.cdf),r=!0,l=!function(e){switch(e){case"datetimeoffset":case"geography":case"geometry":case"heirarchyid":case"image":case"money":case"real":case"json":case"smalldatetime":case"smallmoney":case"text":case"time":case"timestamp":case"int":case"tinyint":case"bigint":case"bit":case"smallint":case"float":case"uniqueidentifier":case"xml":return!0;default:return!1}}(t.dt)&&t.dtxp?`(${t.dtxp}${t.dtxs?`,${t.dtxs}`:""})`:"";return 0===n?(s=i?",":"",s+=this.genQuery(`?? ${this.sanitiseDataType(t.dt)}`,[t.cn],r),s+=l,s+=t.rqd?" NOT NULL":" NULL",s+=t.ai?" IDENTITY(1,1)":" ",s+=o?this.genQuery(` CONSTRAINT  ?? DEFAULT ${o}`,[`DF_${e}_${t.cn}`],r):"",o&&(t.default_constraint_name=`DF_${e}_${t.cn}`)):1===n?(s+=this.genQuery(` ADD ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],r),s+=l,s+=t.rqd?" NOT NULL":" NULL",s+=t.ai?" IDENTITY(1,1)":" ",s+=o?this.genQuery(` CONSTRAINT ?? DEFAULT ${o}`,[`DF_${e}_${t.cn}`],r):" ",s=this.genQuery(`ALTER TABLE ?? ${s};`,[this.getTnPath(e)],r),o&&(t.default_constraint_name=`DF_${e}_${t.cn}`)):(t.cn!==a.cn&&(s+=this.genQuery("\nEXEC sp_rename ?, ?, 'COLUMN';\n",[`${this.getTnPath(e)}.${t.cno}`,`${t.cn}`],r)),t.dtxp===a.dtxp&&t.dtxs===a.dtxs&&t.dt===a.dt&&t.rqd===a.rqd||(s+=this.genQuery(`\nALTER TABLE ?? ALTER COLUMN ?? ${this.sanitiseDataType(t.dt)}${l}`,[this.getTnPath(e),t.cn],r),s+=t.rqd?" NOT NULL;\n":" NULL;\n"),t.cdf===a.cdf&&t.cn===a.cn||(a.default_constraint_name&&(s+=this.genQuery("\nALTER TABLE ?? DROP CONSTRAINT ??;",[this.getTnPath(e),a.default_constraint_name],r)),t.cdf&&(s+=this.genQuery(`\nALTER TABLE ??  ADD CONSTRAINT ?? DEFAULT ${this.sanitiseDefaultValue(t.cdf)} FOR ??;`,[this.getTnPath(e),`DF_${t.tn}_${t.cn}`,t.cn],r),t.default_constraint_name=`DF_${t.tn}_${t.cn}`))),s}get schema(){return this.connectionConfig&&this.connectionConfig.searchPath&&this.connectionConfig.searchPath[0]||"dbo"}async totalRecords(e={}){const t=this.totalRecords.name,a=new l.default;c.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT SUM(RecordCount) AS TotalRecords FROM\n      (SELECT (SCHEMA_NAME(A.schema_id) + '.' + A.Name) AS TableName, AVG(B.rows) AS RecordCount\n        FROM sys.objects A\n        INNER JOIN sys.partitions B ON A.object_id = B.object_id\n        WHERE A.type = 'U'\n        GROUP BY A.schema_id,A.Name) src");a.data=e[0]}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{c.api(`${t} :result: ${a}`)}return a}}t.default=d},8935:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(a(71017)),l=a(16464),c=o(a(40514)),d=o(a(89699)),u=o(a(87413)),p=o(a(76918)),m=o(a(45643)),f=o(a(49443)),h=a(30754),g=o(a(48673)),_=o(a(10277)),b=o(a(91774)),y=o(a(34032)),w=o(a(38463)),v=o(a(33894)),T=o(a(3876)),O=s(a(38311)),E=new _.default("MysqlClient"),S=new b.default;class I extends w.default{constructor(e){super(e),this.queries=v.default,this._version={}}emit(e){E.api(e),S.evt.emit("UI",{status:0,data:`SQL : ${e}`})}emitW(e){E.warn(e),S.evt.emit("UI",{status:1,data:`SQL : ${e}`})}emitE(e){E.error(e),S.evt.emit("UI",{status:-1,data:`SQL : ${e}`})}async schemaCreateWithCredentials(e){const t=this.schemaCreateWithCredentials.name,a=new y.default;E.api(`${t}:args:`,e);try{e.schema||(e.schema=`nc${(0,h.nanoid)(8)}`),e.user||(e.user=`nc${(0,h.nanoid)(8)}`),e.password||(e.password=(0,h.nanoid)(16));const t=await this.sqlClient.raw("create database if not exists ??",[e.schema]);await this.sqlClient.raw("CREATE USER ?@'localhost' IDENTIFIED WITH mysql_native_password BY ?",[e.user,e.password]),await this.sqlClient.raw("GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, INDEX, DROP, ALTER, CREATE TEMPORARY TABLES, LOCK TABLES PRIVILEGES ON ??.* TO ?@'localhost'",[e.schema,e.user]),await this.sqlClient.raw("FLUSH PRIVILEGES"),E.debug("Create database if not exists",t),a.object=e}catch(e){a.code=-1,a.message=e.message,a.object=e}return a}async testConnection(e={}){const t=this.testConnection.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.raw("SELECT 1+1 as data")}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{a.code?this.emitE(`TestConnection result: ${a.message}`):this.emit(`TestConnection result: ${a.code}`)}return a}getKnexDataTypes(){const e=new y.default;return e.data.list=["int","tinyint","smallint","mediumint","bigint","float","decimal","double","real","bit","boolean","serial","date","datetime","timestamp","time","year","char","varchar","nchar","text","tinytext","mediumtext","longtext","binary","varbinary","blob","tinyblob","mediumblob","longblob","enum","set","time","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","json"],e}async version(e){const t=this.version.name,a=new y.default;E.api(`${t}:args:`,e);try{a.data.object={};const e=await this.sqlClient.raw("select version() as version");E.debug(e[0][0]),a.data.object.version=e[0][0].version;const t=e[0][0].version.split(".");t.length&&3===t.length?(a.data.object.primary=t[0],a.data.object.major=t[1],a.data.object.minor=t[2],a.data.object.key=t[0]+t[1]):(a.code=-1,a.message=`Invalid version : ${e[0][0].version}`)}catch(e){E.ppe(e),a.code=-1,a.message=e.message}finally{E.api(`${t} :result: %o`,a)}return a}async getDataTypes(e={}){const t=this.getDataTypes.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.version(),this._version.key in this.types?a.data.list=this.types[this._version.key]:a.data.list=this.types.default}catch(e){E.ppe(e),a.code=-1,a.message=e.message}finally{E.api(`${t} :result: ${a}`)}return a}async createDatabaseIfNotExists(e={}){const t=this.createDatabaseIfNotExists.name,a=new y.default;E.api(`${t}:args:`,e,this.connectionConfig);try{const a=JSON.parse(JSON.stringify(this.connectionConfig));delete a.connection.database;const i=(0,c.default)(a),n=await i.raw(this.queries[t].default.sql,[e.database]);E.debug("Create database if not exists",n),this.sqlClient=(0,c.default)(this.connectionConfig),await i.destroy()}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async dropDatabase(e={}){const t=this.dropDatabase.name,a=new y.default;E.api(`${t}:args:`,e);try{E.api("dropping database:",e),await this.sqlClient.raw(this.queries[t].default.sql,[e.database])}catch(e){e&&E.ppe(e.message,t)}return E.api(`${t}: result`,a),a}async createTableIfNotExists(e={}){const t=this.createTableIfNotExists.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.schema.hasTable(e.tn)?E.debug(`${e.tn} tables exists`):(await this.sqlClient.schema.createTable(e.tn,(function(e){e.increments(),e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()})),E.debug("Table created:",`${e.tn}`))}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async hasTable(e){const t=this.hasTable.name,a=new y.default;E.api(`${t}:args:`,e);try{const t=await this.sqlClient.schema.hasTable(e.tn);a.data.value=t}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async hasDatabase(e){const t=this.hasDatabase.name,a=new y.default;E.api(`${t}:args:`,e);try{const i=await this.sqlClient.raw(this.queries[t].default.sql,[`${e.databaseName}`]);a.data.value=i.length>0}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async databaseList(e={}){const t=this.databaseList.name,a=new y.default;E.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SHOW databases");if(E.debug(e.length),2===e.length){for(let t=0;t<e[0].length;++t)e[0][t].database_name=e[0][t].Database;a.data.list=e[0]}else E.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a.data.list.length),a}async tableList(e){const t=this.tableList.name,a=new y.default;E.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SHOW FULL TABLES WHERE TABLE_TYPE NOT LIKE 'VIEW'");let t;if(2===e.length){for(let a=0;a<e[0].length;++a)t||(t=Object.keys(e[0][a]).find((e=>/^Tables_in_/i.test(e)))),e[0][a].tn=e[0][a][t];a.data.list=e[0]}else E.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[];this.emitTele({mysql:1,table_count:a.data.list.length,api_count:10*a.data.list.length})}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a.data.list),a}async schemaList(e){const t=this.schemaList.name,a=new y.default;E.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("select schema_name \n                    from \n                        information_schema.schemata \n                            where \n                                schema_name not in ('information_schema','performance_schema','sys','mysql') \n                                order by schema_name;");2===e.length?a.data.list=e[0].map((e=>(0,u.default)(e,((e,t)=>t.toLowerCase())))):(E.debug("Unknown response for schemaList:",a.data.list.length),a.data.list=[])}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a.data.list),a}async columnList(e={}){var t;const a=this.columnList.name,i=new y.default;E.api(`${a}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const n=await this.sqlClient.raw(await this._getQuery({func:a}),[e.databaseName,e.tn,e.databaseName,e.tn]);if(2===n.length){const e=[];n[0].length||(i.code=-1,i.message="Table not found or Invalid table name");for(let a=0;a<n[0].length;++a){const i={};if(n[0][a]=(0,u.default)(n[0][a],((e,t)=>t.toLowerCase())),"57"!==this._version.key&&"80"!==this._version.key||(i.dp=n[0][a].dp,i.generated_expression=n[0][a].generated_expression),i.tn=n[0][a].tn,i.cn=n[0][a].cn,i.cno=n[0][a].cn,i.dt=n[0][a].dt,i.np=n[0][a].np,i.ns=n[0][a].ns,i.clen=n[0][a].clen,i.cop=n[0][a].cop,i.pk="PRI"===n[0][a].ck,i.nrqd="NO"!==n[0][a].nrqd,i.rqd=!i.nrqd,n[0][a].ct=n[0][a].ct||"",i.un=-1!==n[0][a].ct.indexOf("unsigned"),i.ct=n[0][a].ct||"",n[0][a].ext=n[0][a].ext||"",i.ai=-1!==n[0][a].ext.indexOf("auto_increment"),n[0][a].cst=n[0][a].cst||" ",i.unique=-1!==n[0][a].cst.indexOf("UNIQUE"),"timestamp"===i.dt||"datetime"===i.dt)if(n[0][a].cdf&&n[0][a].ext){const e=n[0][a].ext;e.includes("DEFAULT_GENERATED")?i.cdf=n[0][a].cdf+e.substring(e.lastIndexOf("DEFAULT_GENERATED")+"DEFAULT_GENERATED".length):i.cdf=`${n[0][a].cdf} ${e}`}else i.cdf=n[0][a].cdf;else i.cdf=n[0][a].cdf;(null===(t=this._version)||void 0===t?void 0:t.version)&&this._version.version.includes("Maria")&&"NULL"===i.cdf&&(i.cdf=null),i.cc=n[0][a].cc,i.csn=n[0][a].csn,i.dtx="specificType","int"===i.dt||"tinyint"===i.dt||"mediumint"===i.dt||"bigint"===i.dt||"enum"===i.dt||"set"===i.dt?(i.dtxp=i.ct.substring(i.ct.lastIndexOf("(")+1,i.ct.lastIndexOf(")")),i.dtxs=n[0][a].ns):(i.dtxp=n[0][a].clen||n[0][a].np||n[0][a].dp,i.dtxs=n[0][a].ns),i.au=!1,e.push(i)}i.data.list=e}else E.debug("Unknown response for databaseList:",n),i.data.list=[]}catch(e){throw E.ppe(e,a),e}return E.api(`${a}: result list length = `,i.data.list.length),i}async indexList(e={}){const t=this.indexList.name,a=new y.default;E.api(`${t}:args:`,e);try{const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.tn]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),a.cn=a.column_name,delete a.column_name,a.tn=a.table,delete a.table,a.non_unique_original=a.non_unique,e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[];E.api(`${t}: result %O`,a.data.list)}catch(e){throw E.ppe(e,t),e}return a}async constraintList(e={}){const t=this.constraintList.name,a=new y.default;E.api(`${t}:args:`,e);try{const i=await this.sqlClient.raw(await this._getQuery({func:t}),[this.connectionConfig.connection.database,e.tn]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName,e.tn]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationListAll.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,{databaseName:e.databaseName});if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),e.push(a)}a.data.list=e,this.emitTele({mysql:1,relation_count:a.data.list.length,api_count:10*a.data.list.length})}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[`%${e.tn}%`]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),a.trigger_name=a.trigger,e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),a.function_name=a.name,e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),a.procedure_name=a.name,e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[]);let n;if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){n||(n=Object.keys(i[0][t]).find((e=>/^Tables_in_/i.test(e))));const a=i[0][t];a.view_name=a[n],e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a.data.list.length),a}async functionRead(e={}){const t=this.functionRead.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.function_name]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),a.create_function=a["create function"],e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.procedure_name]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),a.create_procedure=a["create procedure"],e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName,e.view_name]);if(2===i.length){const e=[];for(let t=0;t<i[0].length;++t){let a=i[0][t];a=(0,u.default)(a,(function(e,t){return t.toLowerCase()})),e.push(a)}a.data.list=e}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new y.default;E.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const i=await this.sqlClient.raw(this.queries[t].default.sql,[e.databaseName]);if(2===i.length){const t=[];for(let a=0;a<i[0].length;++a){const n=i[0][a];n.view_name=n[`Tables_in_${e.databaseName}`],t.push(n)}a.data.list=t}else E.debug("Unknown response for databaseList:",i),a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.triggerList.name;E.api(`${t}:args:`,e);return await this.sqlClient.raw(this.queries[t].default.sql,[e.database_name])}async schemaDelete(e={}){const t=this.schemaDelete.name;E.api(`${t}:args:`,e);return await this.sqlClient.raw(this.queries[t].default.sql,[e.database_name])}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new y.default;E.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP TRIGGER ${e.trigger_name}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP TRIGGER ??",[e.trigger_name]),await this.sqlClient.raw(`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`),a.data.object={upStatement:[{sql:`${this.querySeparator()}DROP TRIGGER ${e.trigger_name};\n${this.querySeparator()}CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`}],downStatement:[{sql:`${this.querySeparator()}CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.oldStatement}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new y.default;E.api(`${t}:args:`,e);try{const t=`${this.querySeparator()}DROP TRIGGER ${e.trigger_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:`${this.querySeparator()}CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.oldStatement}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new y.default;E.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE VIEW ${e.view_name} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP VIEW ${e.view_name}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new y.default;E.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE OR REPLACE VIEW ${e.view_name} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`CREATE VIEW ${e.view_name} AS \n${e.oldViewDefination}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new y.default;E.api(`${t}:args:`,e);try{const t=this.querySeparator()+`DROP VIEW ${e.view_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`CREATE VIEW ${e.view_name} AS \n${e.oldViewDefination}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async functionCreate(e={}){const t=this.functionCreate.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.raw(`${e.create_function}`),a.data.object={upStatement:[{sql:this.querySeparator()+`${e.create_function}`}],downStatement:[{sql:this.querySeparator()+`DROP FUNCTION ${e.function_name}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP FUNCTION IF EXISTS ${e.function_name}`),await this.sqlClient.raw(`${e.create_function}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name};${this.querySeparator()}\n${e.create_function}`}],downStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name};${this.querySeparator()}${e.oldCreateFunction}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async functionDelete(e={}){const t=this.functionDelete.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP FUNCTION IF EXISTS ${e.function_name}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP FUNCTION IF EXISTS ${e.function_name}`}],downStatement:[{sql:this.querySeparator()+`${e.create_function}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.raw(`${e.create_procedure}`),a.data.object={upStatement:[{sql:this.querySeparator()+`${e.create_procedure}`}],downStatement:[{sql:this.querySeparator()+`DROP PROCEDURE ${e.procedure_name}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP PROCEDURE IF EXISTS ??",[e.procedure_name]),await this.sqlClient.raw(`${e.create_procedure}`),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name}; ${this.querySeparator()} \n${e.create_procedure}`}],downStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name}; ${this.querySeparator()} ${e.oldCreateProcedure}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async procedureDelete(e={}){const t=this.procedureDelete.name,a=new y.default;E.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP PROCEDURE IF EXISTS ??",[e.procedure_name]),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP PROCEDURE IF EXISTS ${e.procedure_name}`}],downStatement:[{sql:this.querySeparator()+`${e.create_procedure}`}]}}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}async _getQuery(e){try{if((0,d.default)(this._version)){const t=await this.version();this._version=t.data.object,E.debug(`Version was empty for ${e.func}: population version for database as`,this._version)}return this._version.key in this.queries[e.func]?this.queries[e.func][this._version.key].sql:this.queries[e.func].default.sql}catch(e){throw E.ppe(e,this._getQuery.name),e}}mapFieldWithSuggestedFakerFn(e){return e.map((e=>{let t=null,a=1/0;const i=O.mapDataType(e.dt);return T.default.forEach(((n,s)=>{if("string"===i||i===n.type)if(s){const i=g.default.get(e.cn.toLowerCase(),n.name.toLowerCase());a>i&&(a=i,t=n)}else t=n,a=g.default.get(e.cn.toLowerCase(),n.name.toLowerCase())})),a<3?Object.assign(Object.assign({},e),{fakerFunction:t.value}):e}))}async seedInit(e){const t=this.seedInit.name,a=new y.default;E.api(`${t}:args:`,e),console.log("in mysql SeedInit");try{await(0,f.default)(e.seedsFolder);const t=r.default.join(e.seedsFolder,"__xseeds.json");await(0,l.promisify)(m.default.writeFile)(t,{rows:{value:8,description:"Maximum number of rows"},foreign_key_rows:{value:2,description:"1:n - Total number foreign key per relation"}},{spaces:2});let i=await this.tableList();i=i.data.list;for(const t of i){let a=await this.columnList({tn:t.tn});a=a.data.list;for(let e=0;e<a.length;++e)a[e].fakerFunction=null;a=this.mapFieldWithSuggestedFakerFn(a);let i=await this.relationList({tn:t.tn});i=i.data.list;for(let e=0;e<i.length;e++){const t=i[e];for(let e=0;e<a.length;e++){const i=a[e];i.cn===t.cn&&(a[e]=Object.assign(Object.assign({},i),t))}}await this.fakerColumnsCreate({seedsFolder:e.seedsFolder,tn:t.tn,fakerColumns:a})}a.data=await(0,l.promisify)(m.default.readFile)(t)}catch(e){throw E.ppe(e,t),e}return a}async tableCreate(e){const t=this.tableCreate.name,a=new y.default;E.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.createTable(e);await this.sqlClient.raw(t);const i=this.querySeparator()+this.sqlClient.schema.dropTable(e.table).toString();this.emit(`Success : ${t}`),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw E.ppe(e,t),e}return a}async tableUpdate(e){const t=this.tableUpdate.name,a=new y.default;E.api(`${t}:args:`,e);try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let i="",n="";for(let a=0;a<e.columns.length;++a){const s=(0,p.default)(t,{cn:e.columns[a].cno});4&e.columns[a].altered?(i+=this.alterTableRemoveColumn(e.columns[a],s,i),n+=this.alterTableAddColumn(s,e.columns[a],n)):2&e.columns[a].altered||8&e.columns[a].altered?(i+=this.alterTableChangeColumn(e.columns[a],s,i),n+=this.alterTableChangeColumn(s,e.columns[a],n)):1&e.columns[a].altered&&(i+=this.alterTableAddColumn(e.columns[a],s,i),n+=this.alterTableRemoveColumn(e.columns[a],s,n))}i+=this.alterTablePK(e.columns,e.originalColumns,i),n+=this.alterTablePK(e.originalColumns,e.columns,n),i&&(i=this.genQuery(`ALTER TABLE ?? ${this.sanitize(i)};`,[e.tn]),n=this.genQuery(`ALTER TABLE ?? ${this.sanitize(n)};`,[e.tn])),await this.sqlClient.raw(i),console.log(i),a.data.object={upStatement:[{sql:this.querySeparator()+i}],downStatement:[{sql:this.querySeparator()+n}]}}catch(e){throw E.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new y.default;E.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.sqlClient.schema.dropTable(e.table_name).toString();let i=await this.sqlClient.raw("show create table ??",[e.table_name]);i=Object.entries(i[0][0]).find((([e])=>"create table"===e.toLowerCase()))[1];const n=this.querySeparator()+i;this.emit(`Success : ${t}`),await this.sqlClient.schema.dropTable(e.table_name),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:n}]}}catch(e){throw E.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name,a=new y.default;E.api(`${t}:args:`,e);try{a.data=";";const t=await this.sqlClient.raw("show create table ??;",[e.tn]);2===t.length&&(a.data=t[0][0]["Create Table"])}catch(e){throw E.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new y.default;E.api(`${t}:args:`,e);try{let t=" VALUES (";a.data=`INSERT INTO \`${e.tn}\` (`;const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`${i.data.list[e].cn}\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n\`${i.data.list[e].cn}\`\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw E.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new y.default;E.api(`${t}:args:`,e);try{a.data=`UPDATE \`${e.tn}\` \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,\`${t.data.list[e].cn}\` = <\`${t.data.list[e].cn}\`>\n\t`:`\`${t.data.list[e].cn}\` = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw E.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new y.default;E.api(`${t}:args:`,e);try{a.data=`DELETE FROM ${e.tn};`}catch(e){throw E.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new y.default;E.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE ${e.tn};`}catch(e){throw E.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new y.default;E.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, ${t.data.list[e].cn}\n\t`:`${t.data.list[e].cn}\n\t`;a.data+=` FROM ${e.tn};`}catch(e){throw E.ppe(e,t),e}return a}async sequenceList(e={}){const t=this.sequenceList.name,a=new y.default;E.api(`${t}:args:`,e);try{a.data.list=[]}catch(e){throw E.ppe(e,t),e}return E.api(`${t}: result`,a),a}alterTableRemoveColumn(e,t,a){let i=a?",":"";return i+=this.genQuery(" DROP COLUMN ??",[e.cn]),i}createTableColumn(e,t,a){return this.alterTableColumn(e,t,a,0)}alterTableAddColumn(e,t,a){return this.alterTableColumn(e,t,a,1)}alterTableChangeColumn(e,t,a){return this.alterTableColumn(e,t,a,2)}createTable(e){let t="";for(let a=0;a<e.columns.length;++a)t+=this.createTableColumn(e.columns[a],null,t);return t+=this.alterTablePK(e.columns,[],t,!0),t=this.genQuery(`CREATE TABLE ?? (${this.sanitize(t)});`,[e.tn]),t}alterTableColumn(e,t,a,i=2){let n=a?",":"";const s=parseInt(e.dtxs)?parseInt(e.dtxs):null;n+=2===i?this.genQuery(`\n    CHANGE\n    COLUMN ?? ?? ${this.sanitiseDataType(e.dt)}`,[t.cn,e.cn]):1===i?this.genQuery(`\n    ADD\n    COLUMN ?? ${this.sanitiseDataType(e.dt)}`,[e.cn]):this.genQuery(` ?? ${this.sanitiseDataType(e.dt)}`,[e.cn]),e.dt.endsWith("text")||(n+=e.dtxp&&" "!==e.dtxp?`(${e.dtxp}`:"",n+=s?`,${s}`:"",n+=e.dtxp&&" "!==e.dtxp?")":""),n+=e.un?" UNSIGNED":"",n+=e.rqd?" NOT NULL":" NULL",n+=e.ai?" auto_increment":"";const o=this.sanitiseDefaultValue(e.cdf);return n+=o?`\n    DEFAULT ${o}`:"",n}alterTablePK(e,t,a,i=!1){const n=[],s=[];let o=0;for(let t=0;t<e.length;++t)e[t].pk&&4!==e[t].altered&&s.push(e[t].cn);for(let e=0;e<t.length;++e)t[e].pk&&n.push(t[e].cn);if(s.length===n.length){for(let e=0;e<s.length;++e)if(n[e]!==s[e]){o=1;break}}else o=s.length-n.length;let r="";return(s.length||n.length)&&o&&(r+=n.length?",DROP PRIMARY KEY":"",s.length&&(r+=i?this.genQuery(", PRIMARY\n    KEY(??)",[s]):this.genQuery(", ADD\n    PRIMARY\n    KEY(??)",[s]))),r}async totalRecords(e={}){const t=this.totalRecords.name,a=new y.default;E.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT SUM(table_rows) as TotalRecords FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = ?;",[this.connectionConfig.connection.database]);a.data=e[0][0]}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{E.api(`${t} :result: ${a}`)}return a}}t.default=I},94621:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(87413)),s=i(a(10277)),o=i(a(34032)),r=i(a(8935)),l=new s.default("TidbClient");class c extends r.default{async constraintList(e={}){const t=this.constraintList.name,a=new o.default;l.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`select *, TABLE_NAME as tn from INFORMATION_SCHEMA.KEY_COLUMN_USAGE where CONSTRAINT_SCHEMA='${this.connectionConfig.connection.database}' and TABLE_NAME='${e.tn}'`);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,n.default)(i,(function(e,t){return t.toLowerCase()})),e.push(i)}a.data.list=e}else l.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw l.ppe(e,t),e}return l.api(`${t}: result`,a),a}}t.default=c},46074:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(87413)),s=i(a(10277)),o=i(a(34032)),r=i(a(8935)),l=new s.default("VitessClient");class c extends r.default{constructor(e){super(e)}async relationList(e={}){const t=new o.default;return t.data.list=[],t}async relationListAll(e={}){const t=new o.default;return t.data.list=[],t}async databaseList(e={}){const t=this.databaseList.name,a=new o.default;l.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SHOW databases");if(l.debug(e.length),2===e.length){for(let t=0;t<e[0].length;++t)e[0][t].database_name=e[0][t].Databases;a.data.list=e[0]}else l.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw l.ppe(e,t),e}return l.api(`${t}: result`,a.data.list.length),a}async tableList(e={}){const t=this.tableList.name,a=new o.default;l.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SHOW TABLES"),t=`Tables_in_vt_${this.connectionConfig.connection.database}`;if(2===e.length){for(let a=0;a<e[0].length;++a)e[0][a].tn=e[0][a][t];a.data.list=e[0]}else l.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw l.ppe(e,t),e}return l.api(`${t}: result`,a.data.list.length),a}async columnList(e={}){const t=this.columnList.name,a=new o.default;l.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw(`select *, table_name as tn from information_schema.columns where table_name = '${e.tn}' ORDER by ordinal_position`);if(2===t.length){const i=[];for(let a=0;a<t[0].length;++a){const s={};t[0][a]=(0,n.default)(t[0][a],((e,t)=>t.toLowerCase())),s.tn=e.tn,s.cn=t[0][a].cn,s.dt=t[0][a].dt,s.np=t[0][a].np,s.ns=t[0][a].ns,s.clen=t[0][a].clen,s.cop=t[0][a].op,s.dtx=this.getKnexDataType(s.dt),s.pk="PRI"===t[0][a].ck,s.nrqd="NO"!==t[0][a].nrqd,s.not_nullable=!s.nrqd,t[0][a].ct=t[0][a].ct||"",s.un=-1!==t[0][a].ct.indexOf("unsigned"),s.ct=t[0][a].ct||"",t[0][a].ext=t[0][a].ext||"",s.ai=-1!==t[0][a].ext.indexOf("auto_increment"),t[0][a].cst=t[0][a].cst||" ",s.unique=-1!==t[0][a].cst.indexOf("UNIQUE"),s.cdf=t[0][a].cdf,s.cc=t[0][a].cc,s.csn=t[0][a].csn,i.push(s)}a.data.list=i}else l.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw l.ppe(e,t),e}return l.api(`${t}: result list length = `,a.data.list.length),a}async constraintList(e={}){const t=this.constraintList.name,a=new o.default;l.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`select *, TABLE_NAME as tn from INFORMATION_SCHEMA.KEY_COLUMN_USAGE where TABLE_NAME = '${e.tn}' ORDER by ordinal_position;`);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,n.default)(i,(function(e,t){return t.toLowerCase()})),e.push(i)}a.data.list=e}else l.debug("Unknown response for databaseList:",a.data.list.length),a.data.list=[]}catch(e){throw l.ppe(e,t),e}return l.api(`${t}: result`,a),a}}t.default=c},3876:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{name:"zipCode",group:"address",value:"address.zipCode",type:"string"},{name:"city",group:"address",value:"address.city",type:"string"},{name:"cityPrefix",group:"address",value:"address.cityPrefix",type:"string"},{name:"citySuffix",group:"address",value:"address.citySuffix",type:"string"},{name:"streetName",group:"address",value:"address.streetName",type:"string"},{name:"streetAddress",group:"address",value:"address.streetAddress",type:"string"},{name:"streetSuffix",group:"address",value:"address.streetSuffix",type:"string"},{name:"streetPrefix",group:"address",value:"address.streetPrefix",type:"string"},{name:"secondaryAddress",group:"address",value:"address.secondaryAddress",type:"string"},{name:"county",group:"address",value:"address.county",type:"string"},{name:"country",group:"address",value:"address.country",type:"string"},{name:"countryCode",group:"address",value:"address.countryCode",type:"string"},{name:"state",group:"address",value:"address.state",type:"string"},{name:"stateAbbr",group:"address",value:"address.stateAbbr",type:"string"},{name:"latitude",group:"address",value:"address.latitude",type:"number"},{name:"longitude",group:"address",value:"address.longitude",type:"number"},{name:"color",group:"commerce",value:"commerce.color",type:"string"},{name:"department",group:"commerce",value:"commerce.department",type:"string"},{name:"productName",group:"commerce",value:"commerce.productName",type:"string"},{name:"price",group:"commerce",value:"commerce.price",type:"number"},{name:"productAdjective",group:"commerce",value:"commerce.productAdjective",type:"string"},{name:"productMaterial",group:"commerce",value:"commerce.productMaterial",type:"string"},{name:"product",group:"commerce",value:"commerce.product",type:"string"},{name:"suffixes",group:"company",value:"company.suffixes",type:"string"},{name:"companyName",group:"company",value:"company.companyName",type:"string"},{name:"companySuffix",group:"company",value:"company.companySuffix",type:"string"},{name:"catchPhrase",group:"company",value:"company.catchPhrase",type:"string"},{name:"bs",group:"company",value:"company.bs",type:"string"},{name:"catchPhraseAdjective",group:"company",value:"company.catchPhraseAdjective",type:"string"},{name:"catchPhraseDescriptor",group:"company",value:"company.catchPhraseDescriptor",type:"string"},{name:"catchPhraseNoun",group:"company",value:"company.catchPhraseNoun",type:"string"},{name:"bsAdjective",group:"company",value:"company.bsAdjective",type:"string"},{name:"bsBuzz",group:"company",value:"company.bsBuzz",type:"string"},{name:"bsNoun",group:"company",value:"company.bsNoun",type:"string"},{name:"column",group:"database",value:"database.column",type:"string"},{name:"type",group:"database",value:"database.type",type:"string"},{name:"collation",group:"database",value:"database.collation",type:"string"},{name:"engine",group:"database",value:"database.engine",type:"string"},{name:"past",group:"date",value:"date.past",type:"date"},{name:"future",group:"date",value:"date.future",type:"date"},{name:"recent",group:"date",value:"date.recent",type:"date"},{name:"soon",group:"date",value:"date.soon",type:"date"},{name:"month",group:"date",value:"date.month",type:"string"},{name:"weekday",group:"date",value:"date.weekday",type:"string"},{name:"account",group:"finance",value:"finance.account",type:"string"},{name:"accountName",group:"finance",value:"finance.accountName",type:"string"},{name:"mask",group:"finance",value:"finance.mask",type:"string"},{name:"amount",group:"finance",value:"finance.amount",type:"number"},{name:"transactionType",group:"finance",value:"finance.transactionType",type:"string"},{name:"currencyCode",group:"finance",value:"finance.currencyCode",type:"string"},{name:"currencyName",group:"finance",value:"finance.currencyName",type:"string"},{name:"currencySymbol",group:"finance",value:"finance.currencySymbol",type:"string"},{name:"bitcoinAddress",group:"finance",value:"finance.bitcoinAddress",type:"string"},{name:"ethereumAddress",group:"finance",value:"finance.ethereumAddress",type:"string"},{name:"iban",group:"finance",value:"finance.iban",type:"string"},{name:"bic",group:"finance",value:"finance.bic",type:"string"},{name:"abbreviation",group:"hacker",value:"hacker.abbreviation",type:"string"},{name:"adjective",group:"hacker",value:"hacker.adjective",type:"string"},{name:"noun",group:"hacker",value:"hacker.noun",type:"string"},{name:"verb",group:"hacker",value:"hacker.verb",type:"string"},{name:"ingverb",group:"hacker",value:"hacker.ingverb",type:"string"},{name:"phrase",group:"hacker",value:"hacker.phrase",type:"string"},{name:"createCard",group:"helpers",value:"helpers.createCard",type:"string"},{name:"contextualCard",group:"helpers",value:"helpers.contextualCard",type:"string"},{name:"userCard",group:"helpers",value:"helpers.userCard",type:"string"},{name:"createTransaction",group:"helpers",value:"helpers.createTransaction",type:"string"},{name:"image",group:"image",value:"image.image",type:"string"},{name:"avatar",group:"image",value:"image.avatar",type:"string"},{name:"imageUrl",group:"image",value:"image.imageUrl",type:"string"},{name:"abstract",group:"image",value:"image.abstract",type:"string"},{name:"animals",group:"image",value:"image.animals",type:"string"},{name:"business",group:"image",value:"image.business",type:"string"},{name:"cats",group:"image",value:"image.cats",type:"string"},{name:"city",group:"image",value:"image.city",type:"string"},{name:"food",group:"image",value:"image.food",type:"string"},{name:"nightlife",group:"image",value:"image.nightlife",type:"string"},{name:"fashion",group:"image",value:"image.fashion",type:"string"},{name:"people",group:"image",value:"image.people",type:"string"},{name:"nature",group:"image",value:"image.nature",type:"string"},{name:"sports",group:"image",value:"image.sports",type:"string"},{name:"technics",group:"image",value:"image.technics",type:"string"},{name:"transport",group:"image",value:"image.transport",type:"string"},{name:"dataUri",group:"image",value:"image.dataUri",type:"string"},{name:"avatar",group:"internet",value:"internet.avatar",type:"string"},{name:"email",group:"internet",value:"internet.email",type:"string"},{name:"exampleEmail",group:"internet",value:"internet.exampleEmail",type:"string"},{name:"userName",group:"internet",value:"internet.userName",type:"string"},{name:"protocol",group:"internet",value:"internet.protocol",type:"string"},{name:"url",group:"internet",value:"internet.url",type:"string"},{name:"domainName",group:"internet",value:"internet.domainName",type:"string"},{name:"domainSuffix",group:"internet",value:"internet.domainSuffix",type:"string"},{name:"domainWord",group:"internet",value:"internet.domainWord",type:"string"},{name:"ip",group:"internet",value:"internet.ip",type:"string"},{name:"ipv6",group:"internet",value:"internet.ipv6",type:"string"},{name:"userAgent",group:"internet",value:"internet.userAgent",type:"string"},{name:"color",group:"internet",value:"internet.color",type:"string"},{name:"mac",group:"internet",value:"internet.mac",type:"string"},{name:"password",group:"internet",value:"internet.password",type:"string"},{name:"word",group:"lorem",value:"lorem.word",type:"string"},{name:"words",group:"lorem",value:"lorem.words",type:"string"},{name:"sentence",group:"lorem",value:"lorem.sentence",type:"string"},{name:"slug",group:"lorem",value:"lorem.slug",type:"string"},{name:"sentences",group:"lorem",value:"lorem.sentences",type:"string"},{name:"paragraph",group:"lorem",value:"lorem.paragraph",type:"string"},{name:"paragraphs",group:"lorem",value:"lorem.paragraphs",type:"string"},{name:"text",group:"lorem",value:"lorem.text",type:"string"},{name:"lines",group:"lorem",value:"lorem.lines",type:"string"},{name:"firstName",group:"name",value:"name.firstName",type:"string"},{name:"lastName",group:"name",value:"name.lastName",type:"string"},{name:"findName",group:"name",value:"name.findName",type:"string"},{name:"jobTitle",group:"name",value:"name.jobTitle",type:"string"},{name:"prefix",group:"name",value:"name.prefix",type:"string"},{name:"suffix",group:"name",value:"name.suffix",type:"string"},{name:"title",group:"name",value:"name.title",type:"string"},{name:"jobDescriptor",group:"name",value:"name.jobDescriptor",type:"string"},{name:"jobArea",group:"name",value:"name.jobArea",type:"string"},{name:"jobType",group:"name",value:"name.jobType",type:"string"},{name:"phoneNumber",group:"phone",value:"phone.phoneNumber",type:"string"},{name:"phoneNumberFormat",group:"phone",value:"phone.phoneNumberFormat",type:"string"},{name:"phoneFormats",group:"phone",value:"phone.phoneFormats",type:"string"},{name:"number",group:"random",value:"random.number",type:"number"},{name:"float",group:"random",value:"random.float",type:"number"},{name:"uuid",group:"random",value:"random.uuid",type:"string"},{name:"boolean",group:"random",value:"random.boolean",type:"boolean"},{name:"word",group:"random",value:"random.word",type:"string"},{name:"words",group:"random",value:"random.words",type:"string"},{name:"image",group:"random",value:"random.image",type:"string"},{name:"locale",group:"random",value:"random.locale",type:"string"},{name:"alphaNumeric",group:"random",value:"random.alphaNumeric",type:"string"},{name:"hexaDecimal",group:"random",value:"random.hexaDecimal",type:"string"},{name:"fileName",group:"system",value:"system.fileName",type:"string"},{name:"commonFileName",group:"system",value:"system.commonFileName",type:"string"},{name:"mimeType",group:"system",value:"system.mimeType",type:"string"},{name:"commonFileType",group:"system",value:"system.commonFileType",type:"string"},{name:"commonFileExt",group:"system",value:"system.commonFileExt",type:"string"},{name:"fileType",group:"system",value:"system.fileType",type:"string"},{name:"fileExt",group:"system",value:"system.fileExt",type:"string"},{name:"directoryPath",group:"system",value:"system.directoryPath",type:"string"},{name:"filePath",group:"system",value:"system.filePath",type:"string"},{name:"semver",group:"system",value:"system.semver",type:"string"}]},38311:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapDataType=void 0;t.mapDataType=function(e){switch(e){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"bit":case"boolean":case"float":case"decimal":case"double":case"serial":return"number";case"date":case"datetime":case"timestamp":case"time":case"year":return"date";case"char":case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"enum":case"set":case"json":return"string"}return"string"}},33894:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const a="SELECT\nc.table_name as tn,\nc.column_name as cn,\nc.data_type as dt,\nc.column_type as ct,\nc.character_maximum_length as clen,\nc.numeric_precision as np,\nc.numeric_scale as ns,\n-- c.datetime_precision as dp,\nc.ordinal_position as cop,\nc.column_key as ck,\nc.extra as ext, -- gives ai\nc.column_default as cdf,\nc.is_nullable as nrqd,\nc.privileges as priv,\nc.column_comment as cc,\n-- c.generation_expression,\nc.character_set_name as csn,\nc.collation_name as clnn,\nct.CONSTRAINT_TYPE as cst\nFROM\ninformation_schema.COLUMNS as c\nLeft join(\n        select\n                tc.CONSTRAINT_NAME,\n                tc.TABLE_NAME,\n                tc.CONSTRAINT_SCHEMA,\n                tc.CONSTRAINT_TYPE,\n                s.COLUMN_NAME\n        from\n                information_schema.TABLE_CONSTRAINTS as tc\n        LEFT JOIN information_schema.STATISTICS as s ON\n                s.table_schema = tc.CONSTRAINT_SCHEMA\n                and s.TABLE_NAME = tc.TABLE_NAME\n                and s.INDEX_NAME = tc.CONSTRAINT_NAME\n        where\n                tc.CONSTRAINT_SCHEMA = ?\n                and s.TABLE_NAME = ?\n) ct on\nc.TABLE_SCHEMA = ct.CONSTRAINT_SCHEMA\nAND c.TABLE_NAME = ct.TABLE_NAME\nAND c.COLUMN_NAME = ct.COLUMN_NAME\nWHERE\nc.table_schema = ?\nand c.TABLE_NAME = ?\nORDER BY\nc.table_name,\nc.ordinal_position";t.default={columnList:{55:{sql:a,paramsHints:["databaseName","tn","databaseName","tn"]},56:{sql:a,paramsHints:["databaseName","tn","databaseName","tn"]},default:{sql:"SELECT\n      c.table_name as tn,\n      c.column_name as cn,\n      c.data_type as dt,\n      c.column_type as ct,\n      c.character_maximum_length as clen,\n      c.numeric_precision as np,\n      c.numeric_scale as ns,\n      c.datetime_precision as dp,\n      c.ordinal_position as cop,\n      c.column_key as ck,\n      c.extra as ext, -- gives ai\n      c.column_default as cdf,\n      c.is_nullable as nrqd,\n      c.privileges as priv,\n      c.column_comment as cc,\n--       c.generation_expression,\n      c.character_set_name as csn,\n      c.collation_name as clnn,\n      ct.CONSTRAINT_TYPE as cst\n     FROM\n      information_schema.COLUMNS as c\n    Left join(\n              select\n                      tc.CONSTRAINT_NAME,\n                      tc.TABLE_NAME,\n                      tc.CONSTRAINT_SCHEMA,\n                      tc.CONSTRAINT_TYPE,\n                      s.COLUMN_NAME\n              from\n                      information_schema.TABLE_CONSTRAINTS as tc\n              LEFT JOIN information_schema.STATISTICS as s ON\n                      s.table_schema = tc.CONSTRAINT_SCHEMA\n                      and s.TABLE_NAME = tc.TABLE_NAME\n                      and s.INDEX_NAME = tc.CONSTRAINT_NAME\n                      and tc.CONSTRAINT_TYPE != 'UNIQUE'\n                      and tc.CONSTRAINT_TYPE != 'FOREIGN KEY'\n              where\n                      tc.CONSTRAINT_SCHEMA = ?\n                      and s.TABLE_NAME = ?\n      ) ct on\n      c.TABLE_SCHEMA = ct.CONSTRAINT_SCHEMA\n      AND c.TABLE_NAME = ct.TABLE_NAME\n      AND c.COLUMN_NAME = ct.COLUMN_NAME\n    WHERE\n      c.table_schema = ?\n      and c.TABLE_NAME = ?\n    ORDER BY\n      c.table_name,\n      c.ordinal_position",paramsHints:["databaseName","tn","databaseName","tn"]}},constraintList:{default:{sql:"SELECT\n      k.constraint_name as cstn,\n      k.column_name as cn,\n      k.ordinal_position as op,\n      k.position_in_unique_constraint as puc,\n      t.constraint_type as cst\nFROM information_schema.table_constraints t\nLEFT JOIN information_schema.key_column_usage k\nUSING(constraint_name,table_schema,table_name)\nWHERE\nt.table_schema=?\nAND t.table_name=?;",paramsHints:["database","tn"]}},createDatabaseIfNotExists:{default:{sql:"create database if not exists ??  CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci",paramsHints:["database"]}},createTableIfNotExists:{default:{sql:"",paramsHints:[]}},dropDatabase:{default:{sql:"drop database ??",paramsHints:["database"]}},databaseList:{default:{sql:"SHOW databases",paramsHints:[]}},hasDatabase:{default:{sql:"SHOW DATABASES LIKE ?",paramsHints:["databaseName"]}},indexList:{default:{sql:"show index from ??",paramsHints:["tn"]}},functionList:{default:{sql:"show function status where db=?",paramsHints:["databaseName"]}},functionRead:{default:{sql:"SHOW CREATE FUNCTION ??",paramsHints:["function_name"]}},functionDelete:{default:{sql:"DROP FUNCTION IF EXISTS ??",paramsHints:["function_name"]}},procedureList:{default:{sql:"show procedure status where db=?",paramsHints:["databaseName"]}},procedureRead:{default:{sql:"show create procedure ??",paramsHints:["procedure_name"]}},procedureDelete:{default:{sql:"DROP PROCEDURE IF EXISTS ??",paramsHints:["procedure_name"]}},relationList:{default:{sql:"SELECT\n      kcu.CONSTRAINT_NAME as cstn,\n      kcu.TABLE_NAME as tn,\n      kcu.COLUMN_NAME as cn,\n      kcu.POSITION_IN_UNIQUE_CONSTRAINT as puc,\n      kcu.REFERENCED_TABLE_NAME as rtn,\n      kcu.REFERENCED_COLUMN_NAME as rcn,\n      rc.MATCH_OPTION as mo,\n      rc.UPDATE_RULE as ur,\n      rc.DELETE_RULE as dr,\n      kcu.table_schema as ts\n    FROM\n      information_schema.KEY_COLUMN_USAGE AS kcu\n    INNER JOIN information_schema.REFERENTIAL_CONSTRAINTS AS rc ON\n      kcu.CONSTRAINT_NAME = rc.CONSTRAINT_NAME\n    Group by\n      kcu.CONSTRAINT_NAME,\n      kcu.TABLE_NAME,\n      kcu.COLUMN_NAME,\n      kcu.POSITION_IN_UNIQUE_CONSTRAINT,\n      kcu.REFERENCED_TABLE_NAME,\n      kcu.REFERENCED_COLUMN_NAME,\n      rc.MATCH_OPTION,\n      rc.UPDATE_RULE,\n      rc.DELETE_RULE ,\n      kcu.table_schema\n    Having\n      kcu.table_schema = ?\n      AND kcu.referenced_column_name IS NOT NULL\n      AND kcu.table_name =?",paramsHints:["database","tn"]}},relationListAll:{default:{sql:"SELECT\n      kcu.constraint_name AS cstn,\n      kcu.table_name AS tn,\n      kcu.column_name AS cn,\n      kcu.position_in_unique_constraint AS puc,\n      kcu.referenced_table_name AS rtn,\n      kcu.referenced_column_name AS rcn,\n      rc.match_option AS mo,\n      rc.update_rule AS ur,\n      rc.delete_rule AS dr,\n      kcu.table_schema AS ts\n    FROM\n      (\n      SELECT\n        table_schema,\n        constraint_name,\n        table_name,\n        column_name,\n        position_in_unique_constraint,\n        referenced_table_name,\n        referenced_column_name\n      FROM\n        information_schema.KEY_COLUMN_USAGE\n      WHERE\n        table_schema = :databaseName) AS kcu\n    INNER JOIN\n              (\n      SELECT\n        constraint_schema,\n        match_option,\n        update_rule,\n        delete_rule,\n        constraint_name\n      FROM\n        information_schema.REFERENTIAL_CONSTRAINTS\n      WHERE\n        constraint_schema = :databaseName) AS rc ON\n      kcu.constraint_name = rc.constraint_name\n      AND kcu.table_schema = rc.constraint_schema\n    INNER JOIN\n              (\n      SELECT\n        table_schema,\n        table_name,\n        column_name\n      FROM\n        information_schema.COLUMNS\n      WHERE\n        table_schema = :databaseName\n        AND table_name IN (\n        SELECT\n          table_name\n        FROM\n          information_schema.TABLES\n        WHERE\n          table_schema = :databaseName\n          AND Lower(table_type) = 'base table')) AS col ON\n      col.table_schema = kcu.table_schema\n      AND col.table_name = kcu.table_name\n      AND kcu.referenced_column_name IS NOT NULL\n    GROUP BY\n      cstn ,\n      tn ,\n      rcn ,\n      cn ,\n      puc ,\n      rtn ,\n      cn,\n      mo ,\n      ur ,\n      dr ,\n      ts",paramsHints:["database"]}},schemaCreate:{default:{sql:"create database ??",paramsHints:["database_name"]}},schemaDelete:{default:{sql:"drop database ??",paramsHints:["database_name"]}},triggerList:{default:{sql:"SHOW TRIGGERS like ?",paramsHints:["tn"]}},tableList:{default:{sql:"",paramsHints:[]}},testConnection:{default:{sql:"",paramsHints:[]}},triggerRead:{default:{sql:"SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW';",paramsHints:["databaseName"]}},triggerDelete:{default:{sql:"DROP TRIGGER ??",paramsHints:["trigger_name"]}},version:{default:{sql:"",paramsHints:[]}},viewRead:{default:{sql:"select * FROM INFORMATION_SCHEMA.VIEWS WHERE\n       TABLE_SCHEMA = ? AND TABLE_NAME = ?",paramsHints:["databaseName","view_name"]}},viewList:{default:{sql:"SHOW FULL TABLES WHERE TABLE_TYPE LIKE 'VIEW'",paramsHints:[]}}}},1127:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(40514)),s=i(a(87413)),o=i(a(76918)),r=i(a(38463)),l=i(a(10277)),c=i(a(34032)),d=new l.default("OracleClient");class u extends r.default{constructor(e){super(e)}getKnexDataTypes(){const e=new c.default;return e.data.list=["bfile","binary rowid","binary double","binary_float","blob","canoical","cfile","char","clob","content pointer","contigous array","date","decimal","double precision","float","integer","interval day to second","interval year to month","lob pointer","long","long raw","named collection","named object","nchar","nclob","number","nvarchar2","octet","oid","pointer","raw","real","ref","ref cursor","rowid","signed binary integer","smallint","table","time","time with tz","timestamp","timestamp with local time zone","timestamp with local tz","timestamp with timezone","timestamp with tz","unsigned binary integer","urowid","varchar","varchar2","varray","varying array"],e}async testConnection(e={}){const t=this.testConnection.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.raw('SELECT 1+1 AS "data" FROM DUAL')}catch(e){d.ppe(e),a.code=-1,a.message=e.message}finally{d.api(`${t}:result:`,a)}return a}async version(e={}){const t=this.version.name,a=new c.default;d.api(`${t}:args:`,e);try{const e=await this.raw("SELECT * FROM PRODUCT_COMPONENT_VERSION WHERE product LIKE 'Oracle%'");a.data.object={};let t=e[0];t=(0,s.default)(t,((e,t)=>t.toLowerCase()));const i=t.version.split(".");a.data.object.version=t.version,a.data.object.primary=i[0],a.data.object.major=i[1],a.data.object.minor=i[2]}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async createDatabaseIfNotExists(e={}){const t=this.createDatabaseIfNotExists.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));t.connection.database="xe",t.connection.user="system",t.connection.password="oracle";const a=(0,n.default)(t);d.debug("checking if db exists");0===(await a.raw(`select USERNAME from SYS.ALL_USERS WHERE USERNAME = '${this.connectionConfig.connection.user}'`)).length&&(d.debug("creating database:",e),await a.raw(`CREATE USER ${this.connectionConfig.connection.user} IDENTIFIED BY ${this.connectionConfig.connection.user}`),await a.raw(`GRANT ALL PRIVILEGES TO ${this.connectionConfig.connection.user}`),await a.raw(`GRANT EXECUTE ON DBMS_AQ TO ${this.connectionConfig.connection.user}`),await a.raw(`GRANT EXECUTE ON DBMS_AQADM TO ${this.connectionConfig.connection.user}`)),await a.destroy(),this.sqlClient=(0,n.default)(this.connectionConfig)}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async dropDatabase(e){const t=this.dropDatabase.name,a=new c.default;d.api(`${t}:args:`,e);try{const e=JSON.parse(JSON.stringify(this.connectionConfig));e.connection.database="xe",e.connection.user="system",e.connection.password="oracle";const t=(0,n.default)(e);await this.sqlClient.destroy(),d.debug("dropping database:",this.connectionConfig.connection.user);const a=await t.raw(`select SID,SERIAL# from v$session where username =  '${this.connectionConfig.connection.user}'\n      `);d.debug(`Active Sessions for ${this.connectionConfig.connection.user}: `,a);for(let e=0;e<a.length;e++){const i=a[e];await t.raw(`alter system kill session '${i.SID},${i["SERIAL#"]}' immediate`)}await t.raw(`drop user ${this.connectionConfig.connection.user} cascade`),d.debug("dropped database:",this.connectionConfig.connection.user)}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async createTableIfNotExists(e){const t=this.createTableIfNotExists.name,a=new c.default;d.api(`${t}:args:`,e);try{(await this.hasTable({tn:e.tn})).data.value?d.debug(`${e.tn} tables exists`):(await this.sqlClient.schema.createTable(e.tn,(function(e){e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()})),d.debug("Table created:",`${e.tn}`))}catch(e){if(d.ppe(e,t),!(JSON.stringify(e.message).indexOf("exact fetch returns more than requested number of rows")>-1))throw e;d.warn("safely ignored Exception:exact fetch returns more than requested number of rows knex create table issue")}return d.api(`${t}: result`,a),a}async hasTable(e={}){const t=this.hasTable.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=await this.raw(`select TABLE_NAME as tn FROM all_tables WHERE OWNER = '${this.connectionConfig.connection.user}' AND tn = '${e.tn}'`);a.data.value=t.length>0}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async hasDatabase(e={}){const t=this.hasDatabase.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=await this.raw(`select USERNAME from SYS.ALL_USERS WHERE USERNAME = '${e.databaseName}'`);a.data.value=t.length>0}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async databaseList(e={}){const t=this.databaseList.name,a=new c.default;d.api(`${t}:args:`,e);try{const e=await this.raw('select USERNAME as "database_name" from SYS.ALL_USERS order by USERNAME');a.data.list=e}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async tableList(e={}){const t=this.tableList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`select table_name FROM all_tables WHERE owner='${e.databaseName}'`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async schemaList(e={}){const t=this.schemaList.name,a=new c.default;d.api(`${t}:args:`,e);try{const e=await this.raw("SELECT username AS schema_name\n                          FROM dba_users u\n                         WHERE ACCOUNT_STATUS = 'OPEN' AND EXISTS (\n                            SELECT 1\n                              FROM dba_objects o\n                             WHERE o.owner = u.username )\n                           AND default_tablespace not in ('SYSTEM','SYSAUX') ");for(let t=0;t<e.length;t++){let a=e[t];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),e[t]=a}a.data.list=e}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async columnList(e={}){const t=this.columnList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT\n      seq.sequence_name,\n      CASE\n        WHEN seq.sequence_name IS NOT NULL\n        AND p.constraint_type = 'P' THEN 1\n        ELSE 0\n      END as ai,\n      c.table_name as tn,\n      c.column_name AS cn,\n      c.column_id AS cop,\n      p.constraint_type AS ck,\n      c.NULLABLE AS nrqd,\n      c.DATA_TYPE AS dt,\n      c.DATA_LENGTH,\n      c.DATA_PRECISION,\n      c.DEFAULT_LENGTH,\n      c.DATA_DEFAULT AS cdf,\n      c.character_set_name as csn,\n      c.CHAR_LENGTH AS clen,\n      -- c.DEFAULT_ON_NULL,\n      c.LOW_VALUE,\n      c.HIGH_VALUE,\n      c.DATA_SCALE AS ns,\n      p.constraint_name AS pk_constraint_name,\n      p.POSITION AS p_con_ordinal_position\n    FROM\n      SYS.ALL_TAB_COLS c\n    LEFT JOIN(\n        SELECT\n          a.table_name,\n          a.column_name,\n          a.constraint_name,\n          c.constraint_type,\n          a.position,\n          c_pk.table_name r_table_name,\n          c_pk.constraint_name r_pk,\n          cc_pk.column_name r_column_name\n        FROM\n          all_cons_columns a\n        JOIN all_constraints c ON\n          (\n            a.owner = c.owner\n            AND a.constraint_name = c.constraint_name\n          )\n        LEFT JOIN all_constraints c_pk ON\n          (\n            c.r_owner = c_pk.owner\n            AND c.r_constraint_name = c_pk.constraint_name\n          )\n        LEFT JOIN all_cons_columns cc_pk ON\n          (\n            cc_pk.owner = c_pk.owner\n            AND cc_pk.constraint_name = c_pk.constraint_name\n          )\n        WHERE\n          a.owner = '${e.databaseName}'\n          AND c.constraint_type = 'P'\n      ) p ON\n      c.table_name = p.table_name\n      AND c.column_name = p.column_name\n    LEFT OUTER JOIN(\n        SELECT\n          t.table_name,\n          d.referenced_name AS sequence_name,\n          d.REFERENCED_OWNER AS OWNER,\n          c.COLUMN_NAME\n        FROM\n          user_trigger_cols t,\n          user_dependencies d,\n          user_tab_cols c\n        WHERE\n          d.name = t.trigger_name\n          AND t.TABLE_NAME = c.TABLE_NAME\n          AND t.COLUMN_NAME = c.COLUMN_NAME\n          AND d.referenced_type = 'SEQUENCE'\n          AND d.type = 'TRIGGER'\n      ) seq ON\n      c.table_name = seq.table_name\n      AND c.column_name = seq.column_name\n    WHERE\n      c.owner = '${e.databaseName}' AND  c.table_name = '${e.tn}'\n    ORDER BY\n      c.table_name,\n      c.column_id,\n      c.column_name`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.np=a.data_precision,a.pk="P"===a.ck,a.nrqd="Y"===a.nrqd,a.not_nullable="N"===a.nrqd,a.ai=1===a.ai,a.cno=a.cn,a.dtxp=a.clen||a.np,a.dtxs=a.ns,a.au=!1,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async indexList(e={}){const t=this.indexList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`select ind_col.COLUMN_POSITION AS postion, ind.index_name as key_name,\n        ind_col.column_name as cn,\n        ind.index_type,\n        ind.uniqueness,\n        ind.table_owner as schema_name,\n        ind.table_name as tn,\n        ind.table_type as table_type\n        from sys.all_indexes ind\n        inner join sys.all_ind_columns ind_col on ind.owner = ind_col.index_owner\n        and ind.index_name = ind_col.index_name\n        where ind.owner = '${e.databaseName}'  AND ind.table_name  = '${e.tn}'\n        order by ind.table_owner, ind.table_name, ind.index_name, ind_col.column_position`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.table=a.tn,a.non_unique="NONUNIQUE"===a.uniqueness?1:0,a.non_unique_original="NONUNIQUE"===a.uniqueness?1:0,a.seq_in_index=a.postion,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async constraintList(e={}){const t=this.constraintList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT cols.table_name as tn, cols.column_name as cn, cols.position, cons.*\n        FROM all_constraints cons, all_cons_columns cols\n        WHERE cols.table_name = '${e.tn}' AND cols.owner = '${e.databaseName}'\n        AND cons.constraint_type in ('P','R','U') AND cons.constraint_name = cols.constraint_name\n        AND cons.owner = cols.owner ORDER BY cons.constraint_name, cols.position`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.table=a.tn,"P"===a.cst&&(a.cst="Primary Key"),"U"===a.cst&&(a.cst="Unique"),"R"===a.cst&&(a.cst="Foreign Key"),a.op=a.position,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT\n        a.table_name as tn,\n        a.column_name as cn,\n        a.constraint_name cstn,\n        c.constraint_type cst,\n        a.position,\n        c_pk.table_name r_table_name,\n        c_pk.constraint_name r_pk,\n        cc_pk.column_name r_column_name,\n        c.delete_rule dr\n      FROM\n        all_cons_columns a\n      JOIN all_constraints c ON\n        (\ta.owner = c.owner\n          AND a.constraint_name = c.constraint_name )\n      LEFT JOIN all_constraints c_pk ON\n        (\tc.r_owner = c_pk.owner\n          AND c.r_constraint_name = c_pk.constraint_name )\n      LEFT JOIN all_cons_columns cc_pk ON\n        (\tcc_pk.owner = c_pk.owner\n          AND cc_pk.constraint_name = c_pk.constraint_name )\n      WHERE  a.owner = '${e.databaseName}'\n        AND c.constraint_type = 'R'\n\n      `);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.rtn=a.r_table_name,a.rcn=a.r_column_name,a.non_unique="NONUNIQUE"===a.uniqueness,a.puc=a.position,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT\n        a.table_name as tn,\n        a.column_name as cn,\n        a.constraint_name cstn,\n        c.constraint_type cst,\n        a.position puc,\n        c_pk.table_name r_table_name,\n        c_pk.constraint_name r_pk,\n        cc_pk.column_name r_column_name,\n        c.delete_rule dr\n      FROM\n        all_cons_columns a\n      JOIN all_constraints c ON\n        (\ta.owner = c.owner\n          AND a.constraint_name = c.constraint_name )\n      LEFT JOIN all_constraints c_pk ON\n        (\tc.r_owner = c_pk.owner\n          AND c.r_constraint_name = c_pk.constraint_name )\n      LEFT JOIN all_cons_columns cc_pk ON\n        (\tcc_pk.owner = c_pk.owner\n          AND cc_pk.constraint_name = c_pk.constraint_name )\n      WHERE  a.owner = '${e.databaseName}'\n        AND c.constraint_type = 'R'\n\n      `);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.rtn=a.r_table_name,a.rcn=a.r_column_name,a.non_unique="NONUNIQUE"===a.uniqueness,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.sqlClient.raw(`select owner as trigger_schema_name, trigger_name, trigger_type,\n      triggering_event, table_owner as schema_name, table_name as object_name, base_object_type as object_type,\n      status, trigger_body as script     from sys.all_triggers\n      -- excluding some Oracle maintained schemas\n      where owner = '${e.databaseName}' order by trigger_name, table_owner, table_name, base_object_type`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.trigger=a.trigger_name,a.table=a.object_name,a.event=a.triggering_event,a.timing=a.trigger_type,a.statement=a.script,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT *  FROM ALL_OBJECTS WHERE owner = '${e.databaseName}' and OBJECT_TYPE IN ('FUNCTION','PROCEDURE','PACKAGE')`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.function_name=a.object_name,a.type=a.object_type,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT *  FROM ALL_OBJECTS WHERE owner = '${e.databaseName}' and OBJECT_TYPE IN ('FUNCTION','PROCEDURE','PACKAGE')`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.procedure_name=a.object_name,a.type=a.object_type,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT * FROM all_views WHERE owner='${e.databaseName}'`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.view_name=a.object_name,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async functionRead(e={}){const t=this.functionRead.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT * FROM all_source  WHERE TYPE = 'FUNCTION' AND OWNER = '${e.databaseName}' AND NAME = '${e.function_name}' ORDER BY line`),i=[];if(t.length>0){let e="";for(let a=0;a<t.length;a++){let i=t[a];i=(0,s.default)(i,((e,t)=>t.toLowerCase())),i.function_name=i.name,t[a]=i,e+=i.text}t[0].create_function=e,i.push(t[0])}a.data.list=i}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT * FROM all_source  WHERE TYPE = 'PROCEDURE' AND OWNER = '${e.databaseName}' AND NAME = '${e.procedure_name}' ORDER BY line`),i=[];if(t.length>0){let e="";for(let a=0;a<t.length;a++){let i=t[a];i=(0,s.default)(i,((e,t)=>t.toLowerCase())),i.procedure_name=i.name,t[a]=i,e+=i.text}t[0].create_procedure=e,i.push(t[0])}a.data.list=i}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.raw(`SELECT * FROM all_views WHERE owner='${e.databaseName}' and view_name='${e.view_name}'`);for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.view_name=a.object_name,a.view_definition=a.text,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new c.default;d.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.user;const t=await this.sqlClient.raw(`select owner as trigger_schema_name, trigger_name, trigger_type,\n      triggering_event, table_owner as schema_name, table_name as object_name,\n      base_object_type as object_type, status, trigger_body as script from sys.all_triggers\n      -- excluding some Oracle maintained schemas\n      where owner = '${e.databaseName}' and trigger_name = '${e.trigger_name}' order by trigger_name, table_owner, table_name, base_object_type`);if(!t[0])return[];for(let e=0;e<t.length;e++){let a=t[e];a=(0,s.default)(a,((e,t)=>t.toLowerCase())),a.trigger=a.trigger_name,a.table=a.object_name,a.event=a.triggering_event,a.timing=a.trigger_type,a.trigger_definition=a.script,t[e]=a}a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.schemaCreate.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.raw(`create database ${e.database_name}`)}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async schemaDelete(e={}){const t=this.schemaDelete.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.raw(`drop database ${e.database_name}`)}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.raw(`DROP TRIGGER IF EXISTS ${e.trigger_name}`)}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async functionDelete(e={}){const t=this.functionDelete.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.raw(`DROP FUNCTION IF EXISTS ${e.function_name}`)}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async procedureDelete(e={}){const t=this.procedureDelete.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.raw(`DROP PROCEDURE IF EXISTS ${e.procedure_name}`)}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async functionCreate(e={}){const t=this.functionCreate.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`CREATE TRIGGER \`${e.function_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${e.function_name}`);const t=await this.sqlClient.raw(`CREATE TRIGGER \`${e.function_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`CREATE TRIGGER \`${e.procedure_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${e.procedure_name}`);const t=await this.sqlClient.raw(`CREATE TRIGGER \`${e.procedure_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),a.data.object={upStatement:t,downStatement:`DROP TRIGGER ${e.trigger_name}`}}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new c.default;d.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${e.trigger_name}`),await this.sqlClient.raw(`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`),a.data.object={upStatement:`DROP TRIGGER ${e.trigger_name};\nCREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.statement}`,downStatement:`CREATE TRIGGER \`${e.trigger_name}\` \n${e.timing} ${e.event}\nON ${e.tn} FOR EACH ROW\n${e.oldStatement}`}}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=`CREATE VIEW ${e.view_name} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:t,downStatement:`DROP VIEW ${e.view_name}`}}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=`CREATE OR REPLACE VIEW ${e.view_name} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:t,downStatement:`CREATE VIEW ${e.view_name} AS \n${e.oldViewDefination}`}}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new c.default;d.api(`${t}:args:`,e);try{const t=`DROP VIEW ${e.view_name}`;await this.sqlClient.raw(t),a.data.object={upStatement:t,downStatement:`CREATE VIEW ${e.view_name} AS \n${e.oldViewDefination}`}}catch(e){throw d.ppe(e,t),e}return d.api(`${t}: result`,a),a}async tableCreate(e){const t=this.tableCreate.name,a=new c.default;d.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=h(e.tn,e);await this.sqlClient.raw(t);const i=this.sqlClient.schema.dropTable(e.table).toSQL();this.emit(`Success : ${t}`),a.data.object={upStatement:[{sql:t}],downStatement:i}}catch(e){throw d.ppe(e,t),e}return a}async tableUpdate(e){const t=this.tableUpdate.name,a=new c.default;d.api(`${t}:args:`,e);try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let i="",n="";for(let a=0;a<e.columns.length;++a){const s=(0,o.default)(t,{cn:e.columns[a].cno});4&e.columns[a].altered?(i+=p(e.table,e.columns[a],s),n+=m(e.table,s,e.columns[a],n)):2&e.columns[a].altered||8&e.columns[a].altered?(i+=f(e.table,e.columns[a],s,i),n+=f(e.table,s,e.columns[a],n)):1&e.columns[a].altered&&(i+=m(e.table,e.columns[a],s,i),n+=p(e.table,e.columns[a],s))}await this.sqlClient.raw(i),console.log(i),a.data.object={upStatement:[{sql:i}],downStatement:[{sql:n}]}}catch(e){throw d.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new c.default;d.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.sqlClient.schema.dropTable(e.tn).toSQL(),i=h(e.tn,e);this.emit(`Success : ${t}`),await this.sqlClient.schema.dropTable(e.tn),a.data.object={upStatement:t,downStatement:[{sql:i}]}}catch(e){throw d.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name,a=new c.default;d.api(`${t}:args:`,e);try{a.data=";";const t=await this.sqlClient.raw(`show create table ${e.tn};`);2===t.length&&(a.data=t[0][0]["Create Table"])}catch(e){throw d.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new c.default;d.api(`${t}:args:`,e);try{let t=" VALUES (";a.data=`INSERT INTO \`${e.tn}\` (`;const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`${i.data.list[e].cn}\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n\`${i.data.list[e].cn}\`\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw d.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new c.default;d.api(`${t}:args:`,e);try{a.data=`UPDATE \`${e.tn}\` \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,\`${t.data.list[e].cn}\` = <\`${t.data.list[e].cn}\`>\n\t`:`\`${t.data.list[e].cn}\` = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw d.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new c.default;d.api(`${t}:args:`,e);try{a.data=`DELETE FROM ${e.tn};`}catch(e){throw d.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new c.default;d.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE ${e.tn};`}catch(e){throw d.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new c.default;d.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, ${t.data.list[e].cn}\n\t`:`${t.data.list[e].cn}\n\t`;a.data+=` FROM ${e.tn};`}catch(e){throw d.ppe(e,t),e}return a}async totalRecords(e={}){this.totalRecords.name;throw new Error("Function not supported for oracle yet")}}function p(e,t,a){let i=a?",":"";return i+=` DROP COLUMN \`${e.cn}\``,i}function m(e,t,a,i){return g(e,t,a,i,1)}function f(e,t,a,i){return g(e,t,a,i,2)}function h(e,t){let a="";for(let s=0;s<t.columns.length;++s)a+=(i=e,n=t.columns[s],g(i,n,null,a,0));var i,n;return a+=function(e,t,a,i=!1){const n=[],s=[];let o=0;for(let t=0;t<e.length;++t)e[t].pk&&4!==e[t].altered&&s.push(e[t].cn);for(let e=0;e<t.length;++e)t[e].pk&&n.push(t[e].cn);if(s.length===n.length){for(let e=0;e<s.length;++e)if(n[e]!==s[e]){o=1;break}}else o=s.length-n.length;let r="";return(s.length||n.length)&&o&&(r+=n.length?",DROP PRIMARY KEY":"",s.length&&(r+=i?`, PRIMARY KEY(${s.join(",")})`:`, ADD PRIMARY KEY(${s.join(",")})`)),r}(t.columns,[],0,!0),a=`CREATE TABLE ${t.tn} (`+a+")",a}function g(e,t,a,i,n=2){const s=parseInt(t.dtxs)?parseInt(t.dtxs):null;let o=i?",":"";const r=function(e){if(void 0===e.cdf||null===e.cdf)return e.cdf;switch(e.dt){case"bfile":case"binary rowid":case"binary double":case"binary_float":case"blob":case"canoical":case"cfile":case"char":case"clob":case"content pointer":case"contigous array":case"date":case"decimal":case"double precision":case"float":case"integer":case"interval day to second":case"interval year to month":case"lob pointer":case"long":case"long raw":case"named collection":case"named object":case"nchar":case"nclob":case"number":case"nvarchar2":case"octet":case"oid":case"pointer":case"raw":case"real":case"ref":case"ref cursor":case"rowid":case"signed binary integer":case"smallint":case"table":case"time":case"time with tz":case"timestamp":case"timestamp with local time zone":case"timestamp with local tz":case"timestamp with timezone":case"timestamp with tz":case"unsigned binary integer":case"urowid":case"varchar":case"varchar2":case"varray":case"varying array":return e.cdf}}(t);return 0===n?(t.ai?(t.dt,o+=` ${t.cn} serial`):o+=` ${t.cn} ${t.dt}`,o+=t.dtxp&&" "!==t.dtxp?`(${t.dtxp}`:"",o+=s?`,${s}`:"",o+=t.dtxp&&" "!==t.dtxp?")":"",o+=t.rqd?" NOT NULL":" NULL",o+=r?` DEFAULT ${r}`:""):1===n?(o+=` ADD  ${t.cn} ${t.dt}`,o+=t.rqd?" NOT NULL":" NULL",o+=r?` DEFAULT ${r}`:" ",o=`ALTER TABLE ${e} ${o};`):(t.cn!==a.cno&&(o+=`\nALTER TABLE ${e} RENAME COLUMN ${t.cno} TO ${t.cn};\n`),t.dt!==a.dt&&(o+=`\nALTER TABLE ${e} ALTER COLUMN ${t.cn} TYPE ${t.dt};\n`),t.rqd!==a.rqd&&(o+=`\nALTER TABLE ${e} ALTER COLUMN ${t.cn} `,o+=t.rqd?" SET NOT NULL;\n":" DROP NOT NULL;\n"),t.cdf!==a.cdf&&(o+=`\nALTER TABLE ${e} ALTER COLUMN ${t.cn} `,o+=t.cdf?` SET DEFAULT ${t.cdf};\n`:" DROP DEFAULT;\n")),o}t.default=u},87750:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(30754),s=i(a(40514)),o=i(a(89699)),r=i(a(87413)),l=i(a(76918)),c=i(a(38463)),d=i(a(10277)),u=i(a(34032)),p=i(a(92698)),m=new d.default("PGClient");class f extends c.default{constructor(e){super(e),this.queries=p.default,this._version={}}async schemaCreateWithCredentials(e){const t=this.schemaCreateWithCredentials.name,a=new u.default;m.api(`${t}:args:`,e);try{e.schema||(e.schema=`nc${(0,n.nanoid)(8)}`),e.user||(e.user=`nc${(0,n.nanoid)(8)}`),e.password||(e.password=(0,n.nanoid)(16));const t=await this.sqlClient.raw("create database ?",[e.schema]);await this.sqlClient.raw("create user ? with encrypted password ?",[e.user,e.password]),await this.sqlClient.raw("grant all privileges on database ?? to ?",[e.schema,e.user]),m.debug("Create database if not exists",t),a.object=e}catch(e){a.code=-1,a.message=e.message,a.object=e}return a}async sequenceDelete(e={}){const t=this.sequenceDelete.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=`${this.querySeparator()}DROP SEQUENCE ${this.genIdentifier(e.sequence_name)}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:`${this.querySeparator()}CREATE SEQUENCE ${this.genIdentifier(e.sequence_name)}`}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async sequenceList(e={}){const t=this.sequenceList.name,a=new u.default;m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.raw("select *\n              from INFORMATION_SCHEMA.sequences;");a.data.list=t.map((e=>Object.assign(Object.assign({},e),{original_sequence_name:e.sequence_name})))}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async sequenceCreate(e={}){const t=this.sequenceCreate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE SEQUENCE ${this.genIdentifier(e.sequence_name)}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP SEQUENCE ${this.genIdentifier(e.sequence_name)}`}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async sequenceUpdate(e={}){const t=this.sequenceUpdate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=this.querySeparator()+`ALTER SEQUENCE ${this.genIdentifier(e.original_sequence_name)} RENAME TO ${this.genIdentifier(e.sequence_name)};`,i=this.querySeparator()+`ALTER SEQUENCE ${this.genIdentifier(e.sequence_name)} RENAME TO ${this.genIdentifier(e.original_sequence_name)};`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async testConnection(e={}){const t=this.testConnection.name,a=new u.default;m.api(`${t}:args:`,e);try{await this.raw("SELECT 1+1 as data")}catch(e){const t=JSON.parse(JSON.stringify(this.connectionConfig));t.connection.database="postgres";const i=(0,s.default)(Object.assign(Object.assign({},t),{pool:{min:0,max:1}}));try{await i.raw("SELECT 1+1 as data"),await i.destroy()}catch(t){/^database "[\w\d_]+" does not exist$/.test(t.message)||(m.ppe(t),a.code=-1,a.message=e.message)}}finally{m.api(`${t}:result:`,a)}return a}getKnexDataTypes(){const e=new u.default;return e.data.list=["int","integer","bigint","bigserial","char","int2","int4","int8","int4range","int8range","serial","serial2","serial8","character","bit","bool","boolean","date","double precision","event_trigger","fdw_handler","float4","float8","uuid","smallint","smallserial","character varying","text","real","time","time without time zone","timestamp","timestamp without time zone","timestamptz","timestamp with time zone","timetz","time with time zone","daterange","json","jsonb","gtsvector","index_am_handler","anyenum","anynonarray","anyrange","box","bpchar","bytea","cid","cidr","circle","cstring","inet","internal","interval","language_handler","line","lsec","macaddr","money","name","numeric","numrange","oid","opaque","path","pg_ddl_command","pg_lsn","pg_node_tree","point","polygon","record","refcursor","regclass","regconfig","regdictionary","regnamespace","regoper","regoperator","regproc","regpreocedure","regrole","regtype","reltime","smgr","tid","tinterval","trigger","tsm_handler","tsquery","tsrange","tstzrange","tsvector","txid_snapshot","unknown","void","xid","xml"],e}async version(e={}){const t=this.version.name,a=new u.default;m.api(`${t}:args:`,e);try{a.data.object={};const e=await this.sqlClient.raw("SHOW server_version");m.debug(e.rows[0]),a.data.object.version=e.rows[0].server_version;const t=e.rows[0].server_version.split(".");!t.length||3!==t.length&&2!==t.length?(a.code=-1,a.message=`Invalid version : ${e.rows[0].server_version}`):(a.data.object.primary=t[0],a.data.object.major=t[1],a.data.object.minor=t.length>2?t[2]:t[1],a.data.object.key=t[0]+t[1])}catch(e){m.ppe(e),a.code=-1,a.message=e.message}finally{m.api(`${t} :result: %o`,a)}return a}async createDatabaseIfNotExists(e={}){var t,a;const i=this.createDatabaseIfNotExists.name,n=new u.default;let o;m.api(`${i}:args:`,e);try{const i=JSON.parse(JSON.stringify(this.connectionConfig));let n=[];try{i.connection.database="postgres",o=(0,s.default)(Object.assign(Object.assign({},i),{pool:{min:0,max:1}})),m.debug("checking if db exists"),n=(await o.raw("SELECT datname as database FROM pg_database WHERE datistemplate = false and datname = ?",[e.database])).rows}catch(t){m.debug("checking if db exists"),n=(await this.sqlClient.raw("SELECT datname as database FROM pg_database WHERE datistemplate = false and datname = ?",[e.database])).rows}0===n.length&&(m.debug("creating database:",e),await o.raw("CREATE DATABASE ?? ENCODING 'UTF8'",[e.database]));const r=(null===(t=this.connectionConfig.searchPath)||void 0===t?void 0:t[0])||"public";!!(null===(a=(await this.sqlClient.raw("SELECT schema_name FROM information_schema.schemata WHERE schema_name = ?",[r])).rows)||void 0===a?void 0:a[0])||await this.sqlClient.raw("CREATE SCHEMA IF NOT EXISTS ??  AUTHORIZATION ?? ",[r,this.connectionConfig.connection.user])}catch(e){throw m.ppe(e,i),e}finally{o&&await o.destroy()}return m.api(`${i}: result`,n),n}async dropDatabase(e){const t=this.dropDatabase.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=JSON.parse(JSON.stringify(this.connectionConfig));t.connection.database="postgres";const a=(0,s.default)(Object.assign(Object.assign({},t),{pool:{min:0,max:1}}));await this.sqlClient.destroy(),this.sqlClient=a,await a.raw("ALTER DATABASE ?? WITH CONNECTION LIMIT 0;\n      SELECT pg_terminate_backend(sa.pid) FROM pg_stat_activity sa WHERE\n      sa.pid <> pg_backend_pid() AND sa.datname = ?;",[e.database,e.database]),m.debug("dropping database:",e),await a.raw("DROP DATABASE ??;",[e.database]),await a.destroy()}catch(e){m.ppe(e,t)}return m.api(`${t}: result`,a),a}async createTableIfNotExists(e){const t=this.createTableIfNotExists.name,a=new u.default;m.api(`${t}:args:`,e);try{if(0===(await this.sqlClient.raw("SELECT table_schema,table_name as tn, table_catalog FROM information_schema.tables where table_schema=? and\n         table_name = ? and table_catalog = ?",[this.schema,e.tn,this.connectionConfig.connection.database])).rows.length){const t=await this.sqlClient.schema.createTable(e.tn,(function(e){e.increments(),e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()}));m.debug("Table created:",`${e.tn}`,t)}else m.debug(`${e.tn} tables exists`)}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async hasTable(e={}){const t=this.hasTable.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT table_schema,table_name as tn, table_catalog FROM information_schema.tables where table_schema=? and table_name = ? and table_catalog = ?'",[this.schema,e.tn,this.connectionConfig.connection.database]);a.data.value=t.length>0}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async hasDatabase(e={}){const t=this.hasDatabase.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT datname as database FROM pg_database WHERE datistemplate = false and datname = ?",[e.database]);a.data.value=t.length>0}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async databaseList(e={}){const t=this.databaseList.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:e}=await this.sqlClient.raw("SELECT datname as database_name\n           FROM pg_database\n           WHERE datistemplate = false;");a.data.list=e}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async tableList(e={}){const t=this.tableList.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:e}=await this.raw("SELECT table_schema as ts, table_name as tn,table_type\n              FROM information_schema.tables\n              where table_schema = ?\n              ORDER BY table_schema, table_name",[this.schema]);a.data.list=e.filter((({table_type:e})=>"base table"===e.toLowerCase()))}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async schemaList(e={}){const t=this.schemaList.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:e}=await this.raw("SELECT datname as schema_name FROM pg_database\n                              WHERE \n                                  datistemplate = false \n                                      order by schema_name;");a.data.list=e}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async columnList(e={}){const t=this.columnList.name,a=new u.default;m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw('select\n                    c.table_name as tn, c.column_name as cn, c.data_type as dt,\n                    (CASE WHEN  trg.trigger_name is NULL THEN false  else  true end) as au,\n                    pk.constraint_type as ck,\n                    c.character_maximum_length as clen,\n                    c.numeric_precision as np,\n                    c.numeric_scale as ns,\n                    c.datetime_precision as dp,\n                    c.ordinal_position as cop,\n                    c.is_nullable as nrqd,\n                    c.column_default as cdf,\n                    c.generation_expression,\n                    c.character_octet_length,\n                    c.character_set_name as csn,\n                    -- c.collation_name as clnn,\n                    pk.ordinal_position as pk_ordinal_position, pk.constraint_name as pk_constraint_name,\n                    c.udt_name,\n\n       (SELECT count(*)\n            FROM INFORMATION_SCHEMA.TABLE_CONSTRAINTS tc1\n                inner join INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE cu\n                    on cu.CONSTRAINT_NAME = tc1.CONSTRAINT_NAME\n            where\n                tc1.CONSTRAINT_TYPE = \'UNIQUE\'\n                and tc1.TABLE_NAME = c.TABLE_NAME\n                and cu.COLUMN_NAME = c.COLUMN_NAME\n                and tc1.TABLE_SCHEMA=c.TABLE_SCHEMA) IsUnique,\n                (SELECT\n        string_agg(enumlabel, \',\')\n        FROM "pg_enum" "e"\n        INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid"\n        INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace"\n        WHERE "n"."nspname" = table_schema AND "t"."typname"=udt_name\n                ) enum_values\n\n\n            from information_schema.columns c\n              left join\n                ( select kc.constraint_name, kc.table_name,kc.column_name, kc.ordinal_position,tc.constraint_type\n                  from information_schema.key_column_usage kc\n                    inner join information_schema.table_constraints as tc\n                      on kc.constraint_name = tc.constraint_name \n                      and kc.constraint_schema = tc.constraint_schema and tc.constraint_type in (\'PRIMARY KEY\')\n                  where kc.table_catalog = :database and kc.table_schema= :schema\n                  order by table_name,ordinal_position ) pk\n                on\n                pk.table_name = c.table_name and pk.column_name=c.column_name\n                left join information_schema.triggers trg on trg.event_object_table = c.table_name and trg.trigger_name = CONCAT(\'xc_trigger_\' , :table::text , \'_\' , c.column_name)\n              where c.table_catalog=:database and c.table_schema=:schema and c.table_name=:table\n              order by c.table_name, c.ordinal_position',{schema:this.schema,database:e.databaseName,table:e.tn}),i=[];for(let e=0;e<t.rows.length;++e){const a={};a.tn=t.rows[e].tn,a.cn=t.rows[e].cn,a.cno=t.rows[e].cn,a.dt=t.rows[e].dt,a.np=t.rows[e].np,a.ns=t.rows[e].ns,a.clen=t.rows[e].clen,a.dp=t.rows[e].dp,a.cop=t.rows[e].cop,a.dtx=t.rows[e].dt,a.pk=null!==t.rows[e].pk_constraint_name,a.nrqd="NO"!==t.rows[e].nrqd,a.not_nullable=!a.nrqd,a.rqd=!a.nrqd,t.rows[e].ct=t.rows[e].dt||"",a.un=-1!==t.rows[e].ct.indexOf("unsigned"),a.ai=!1,t.rows[e].cdf&&(a.ai=-1!==t.rows[e].cdf.indexOf("nextval")),a.cdf=t.rows[e].cdf,a.cc=t.rows[e].cc,a.csn=t.rows[e].csn,a.dtxp=t.rows[e].clen||t.rows[e].np||t.rows[e].dp,a.dtxs=t.rows[e].ns,a.au=t.rows[e].au,a.data_type_custom=t.rows[e].udt_name,"USER-DEFINED"===a.dt&&(a.dtxp=t.rows[e].enum_values),i.push(a)}a.data.list=i}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async indexList(e={}){const t=this.indexList.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT\n      f.attname AS cn,\n      i.relname as key_name,\n      ix.indnatts, ix.indkey, f.attnum as seq_in_index,\n      pg_catalog.format_type(f.atttypid,f.atttypmod) AS type,\n      f.attnotnull as rqd,\n      p.contype as cst,\n      p.conname as cstn,\n      CASE\n          WHEN i.oid<>0 THEN true\n          ELSE false\n      END AS is_index,\n      CASE\n          WHEN p.contype = 'p' THEN true\n          ELSE false\n      END AS primarykey,\n      CASE\n          WHEN p.contype = 'u' THEN 0\n      WHEN p.contype = 'p' THEN 0\n          ELSE 1\n      END AS non_unique_original,\n      CASE\n          WHEN p.contype = 'p' THEN true\n          ELSE false\n      END AS primarykey,\n      CASE\n          WHEN p.contype = 'u' THEN 0\n      WHEN p.contype = 'p' THEN 0\n          ELSE 1\n      END AS non_unique,\n      CASE\n          WHEN f.atthasdef = 't' THEN pg_get_expr(d.adbin, d.adrelid)\n      END AS default  FROM pg_attribute f\n      JOIN pg_class c ON c.oid = f.attrelid\n      JOIN pg_type t ON t.oid = f.atttypid\n      LEFT JOIN pg_attrdef d ON d.adrelid = c.oid AND d.adnum = f.attnum\n      LEFT JOIN pg_namespace n ON n.oid = c.relnamespace\n      LEFT JOIN pg_constraint p ON p.conrelid = c.oid AND f.attnum = ANY (p.conkey)\n      LEFT JOIN pg_class AS g ON p.confrelid = g.oid\n      LEFT JOIN pg_index AS ix ON f.attnum = ANY(ix.indkey) and c.oid = f.attrelid and c.oid = ix.indrelid\n      LEFT JOIN pg_class AS i ON ix.indexrelid = i.oid\n      WHERE\n        c.relkind = 'r'::char\n      AND n.nspname = ?\n      AND c.relname = ?\n      and i.oid<>0\n      AND f.attnum > 0\n      ORDER BY i.relname, f.attnum;",[this.schema,e.tn]);a.data.list=t}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async relationDelete(e){const t=this.relationDelete.name,a=new u.default;m.api(`${t}:args:`,e);const i=e.foreignKeyName||null;e.childTableWithSchema=e.childTable,e.parentTableWithSchema=e.parentTable;try{await this.sqlClient.schema.table(e.childTableWithSchema,(function(t){t.dropForeign(e.childColumn,i)}));const t=this.querySeparator()+this.sqlClient.schema.table(e.childTableWithSchema,(function(t){t.dropForeign(e.childColumn,i)})).toQuery(),n=this.querySeparator()+await this.sqlClient.schema.table(e.childTableWithSchema,(function(t){t.foreign(e.childColumn,i).references(e.parentColumn).on(e.parentTableWithSchema)})).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:n}]}}catch(e){throw m.ppe(e,t),e}return a}async constraintList(e={}){const t=this.constraintList.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw('\n      SELECT c.conname AS cstn,\n          CASE\n              WHEN c.contype = \'u\' THEN \'UNIQUE\'\n          WHEN c.contype = \'p\' THEN \'PRIMARY KEY\'\n              ELSE \'FOREIGN KEY\'\n          END AS cst,\n           col.attnum,\n           sch.nspname                                   AS "schema",\n           tbl.relname                                   AS "table",\n           ARRAY_AGG(col.attname ORDER BY u.attposition) AS columns,\n           pg_get_constraintdef(c.oid)                   AS definition\n        FROM pg_constraint c\n           JOIN LATERAL UNNEST(c.conkey) WITH ORDINALITY AS u(attnum, attposition) ON TRUE\n           JOIN pg_class tbl ON tbl.oid = c.conrelid\n           JOIN pg_namespace sch ON sch.oid = tbl.relnamespace\n           JOIN pg_attribute col ON (col.attrelid = tbl.oid AND col.attnum = u.attnum)\n        where tbl.relname=?\n        GROUP BY constraint_name, col.attnum, constraint_type, "schema", "table", definition\n        ORDER BY "schema", "table"; ',[e.tn]),i=[];for(let e=0,a=0;e<t.rows.length;++e,++a)if(t.rows[e].columns=t.rows[e].columns.replace("{",""),t.rows[e].columns=t.rows[e].columns.replace("}",""),t.rows[e].columns=t.rows[e].columns.split(","),1===t.rows[e].columns.length)i[a]=t.rows[e],i[a].columns=t.rows[e].columns[0],i[a].seq_in_index=1;else{const n=t.rows[e].columns.slice();for(let s=0;s<n.length;++s,++a)i[a]=JSON.parse(JSON.stringify(t.rows[e])),i[a].columns=n[s],i[a].seq_in_index=s;a--}a.data.list=i}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:t}=await this.sqlClient.raw("SELECT distinct\n                tc.table_schema as ts,\n                tc.constraint_name as cstn,\n                tc.table_name as tn,\n                kcu.column_name as cn,\n                ccu.table_schema AS foreign_table_schema,\n                ccu.table_name AS rtn,\n                ccu.column_name AS rcn,\n                pc.confupdtype as ur, pc.confdeltype as dr\n        FROM\n            information_schema.table_constraints AS tc\n            JOIN information_schema.key_column_usage AS kcu\n              ON tc.constraint_name = kcu.constraint_name\n              AND tc.table_schema = kcu.table_schema\n            JOIN information_schema.constraint_column_usage AS ccu\n              ON ccu.constraint_name = tc.constraint_name\n              AND ccu.table_schema = tc.table_schema\n            join (select conname,confupdtype,confdeltype from pg_catalog.pg_constraint) pc\n            on pc.conname = tc.constraint_name\n        WHERE tc.constraint_type = 'FOREIGN KEY' AND tc.table_schema=:schema and tc.table_name=:table\n        order by tc.table_name;",{schema:this.schema,table:e.tn}),i={a:"NO ACTION",c:"CASCADE",r:"RESTRICT",n:"SET NULL",d:"SET DEFAULT"};for(const e of t)e.ur=i[e.ur],e.dr=i[e.dr];a.data.list=t}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationList.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:e}=await this.sqlClient.raw("SELECT DISTINCT tc.table_schema as ts,\n                tc.constraint_name as cstn,\n                tc.table_name as tn,\n                kcu.column_name as cn,\n                ccu.table_schema AS foreign_table_schema,\n                ccu.table_name   AS rtn,\n                ccu.column_name  AS rcn,\n                pc.confupdtype   as ur,\n                pc.confdeltype   as dr\n         FROM information_schema.table_constraints AS tc\n                JOIN information_schema.key_column_usage AS kcu\n                     ON tc.constraint_name = kcu.constraint_name\n                       AND tc.table_schema = kcu.table_schema\n                JOIN information_schema.constraint_column_usage AS ccu\n                     ON ccu.constraint_name = tc.constraint_name\n                       AND ccu.table_schema = tc.table_schema\n                join (select conname, confupdtype, confdeltype\n                      from pg_catalog.pg_constraint) pc\n                     on pc.conname = tc.constraint_name\n         WHERE tc.constraint_type = 'FOREIGN KEY'\n           AND tc.table_schema = ?\n         order by tc.table_name;",[this.schema]),t={a:"NO ACTION",c:"CASCADE",r:"RESTRICT",n:"SET NULL",d:"SET DEFAULT"};for(const a of e)a.ur=t[a.ur],a.dr=t[a.dr];a.data.list=e}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new u.default;m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.sqlClient.raw("select * from information_schema.triggers where trigger_schema=? and event_object_table=?",[this.schema,e.tn]);for(let e=0;e<t.length;++e)t[e].statement=t[e].action_statement,t[e].table=t[e].event_object_table,t[e].trigger=t[e].trigger_name,t[e].event=t[e].event_manipulation,t[e].timing=t[e].action_timing;a.data.list=t}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new u.default;m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.raw("SELECT *\n              FROM pg_catalog.pg_namespace n\n                     JOIN pg_catalog.pg_proc p\n                          ON pronamespace = n.oid\n              WHERE nspname = ?;",[this.schema]),i=[];for(let e=0;e<t.length;++e)"prokind"in t[e]&&"p"===t[e].prokind||i.push({create_function:t[e].prosrc,function_name:t[e].proname});a.data.list=i}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new u.default;a.data.list=[],m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.raw("SELECT *\n              FROM pg_catalog.pg_namespace n\n                     JOIN pg_catalog.pg_proc p\n                          ON pronamespace = n.oid\n              WHERE nspname = ?;",[this.schema]),i=[];for(let e=0;e<t.length;++e)"prokind"in t[e]&&"p"===t[e].prokind&&i.push({create_procedure:t[e].prosrc,procedure_name:t[e].proname});a.data.list=i}catch(e){}return m.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new u.default;m.api(`${t}:args:`,e);try{const{rows:e}=await this.sqlClient.raw("select *\n           from INFORMATION_SCHEMA.views\n           WHERE table_schema = ?;",[this.schema]);for(let t=0;t<e.length;++t)e[t].view_name=e[t].tn||e[t].table_name;a.data.list=e}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async functionRead(e={}){const t=this.functionRead.name,a=new u.default;m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.sqlClient.raw("SELECT format('%I.%I(%s)', ns.nspname, p.proname, oidvectortypes(p.proargtypes)) as function_declaration, pg_get_functiondef(p.oid) as create_function\n                FROM pg_proc p INNER JOIN pg_namespace ns ON (p.pronamespace = ns.oid)\n            WHERE ns.nspname = ? and p.proname = ?;",[this.schema,e.function_name]);for(let a=0;a<t.length;++a)t[a].function_name=e.function_name;a.data.list=t}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new u.default;m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("show create procedure ?;",[e.procedure_name]),i=[];if(2===t.length)for(let e=0;e<t[0].length;++e){let a=t[0][e];a=(0,r.default)(a,((e,t)=>t.toLowerCase())),a.create_procedure=a["create procedure"],i.push(a)}else m.debug("Unknown response for tableList:",t);a.data.list=i}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new u.default;m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const{rows:t}=await this.sqlClient.raw("select * from INFORMATION_SCHEMA.views WHERE table_name=? and table_schema = ANY (current_schemas(false));",[e.view_name]);for(let e=0;e<t.length;++e)t[e].view_name=t[e].tn;a.data.list=t}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new u.default;m.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW';",[e.databaseName]);let i=[];if(2===t.length){const a=[];for(let i=0;i<t[0].length;++i){const n=t[0][i];n.view_name=n[`Tables_in_${e.databaseName}`],a.push(n)}i=a}else m.debug("Unknown response for tableList:",t);a.data.list=i}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.schemaCreate.name,a=new u.default;m.api(`${t}:args:`,e);try{await this.sqlClient.raw("create database ??",[e.database_name])}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async schemaDelete(e={}){const t=this.schemaDelete.name,a=new u.default;m.api(`${t}:args:`,e);try{await this.sqlClient.raw("drop database ??",[e.database_name])}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=this.genQuery("DROP TRIGGER IF EXISTS ?? ON ??",[e.trigger_name,e.tn]);await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+this.genQuery(`CREATE TRIGGER ?? \n${e.timing} ${e.event}\nON ?? FOR EACH ROW\n${e.statement}`,[e.trigger_name,e.tn])}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async functionDelete(e={}){const t=this.functionDelete.name,a=new u.default;m.api(`${t}:args:`,e);const i=this.querySeparator()+`DROP FUNCTION IF EXISTS ${this.genIdentifier(e.function_declaration)}`,n=this.querySeparator()+e.create_function;try{await this.sqlClient.raw(i),a.data.object={upStatement:[{sql:i}],downStatement:[{sql:n}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async procedureDelete(e={}){const t=this.procedureDelete.name,a=new u.default;m.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP PROCEDURE IF EXISTS ${this.genIdentifier(e.procedure_name)}`)}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async _getQuery(e){try{if((0,o.default)(this._version)){const t=await this.version();this._version=t.data.object,m.debug(`Version was empty for ${e.func}: population version for database as`,this._version)}return this._version.key in this.queries[e.func]?this.queries[e.func][this._version.key].sql:this.queries[e.func].default.sql}catch(e){throw m.ppe(e,this._getQuery.name),e}}async functionCreate(e={}){const t=this.functionCreate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=this.querySeparator()+e.create_function;await this.sqlClient.raw(t);const i=await this.functionRead({function_name:e.function_name}),n=this.querySeparator()+`DROP FUNCTION IF EXISTS ${this.genIdentifier(i.data.list[0].function_declaration)}`;a.data.object={upStatement:[{sql:t}],downStatement:[{sql:n}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=this.querySeparator()+e.create_function;let i=this.querySeparator()+e.oldCreateFunction;await this.sqlClient.raw(`DROP FUNCTION IF EXISTS ${this.genIdentifier(e.function_declaration)};`),await this.sqlClient.raw(t);const n=await this.functionRead({function_name:e.function_name});i=`DROP FUNCTION IF EXISTS ${this.genIdentifier(n.data.list[0].function_declaration)};`+i,a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.procedure_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t);const i=this.querySeparator()+`DROP PROCEDURE IF EXISTS ${this.genIdentifier(e.procedure_name)}`;a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=this.querySeparator()+`DROP TRIGGER ${e.procedure_name}`,i=this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.procedure_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),await this.sqlClient.raw(i),a.data.object={upStatement:[{sql:i}],downStatement:[{sql:";"}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+`DROP TRIGGER ${this.genIdentifier(e.trigger_name)}`}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new u.default;m.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${this.genIdentifier(e.trigger_name)} ON ${this.genIdentifier(e.tn)}`),await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`),a.data.object={upStatement:this.querySeparator()+`DROP TRIGGER ${this.genIdentifier(e.trigger_name)} ON ${this.genIdentifier(e.tn)};${this.querySeparator()}CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`,downStatement:this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.oldStatement}`}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=e.view_definition;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`DROP VIEW ${this.genIdentifier(e.view_name)}`}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=`CREATE OR REPLACE VIEW ${this.genIdentifier(e.view_name)} AS \n${e.view_definition}`;await this.sqlClient.raw(t),a.data.object={upStatement:this.querySeparator()+t,downStatement:this.querySeparator()+`CREATE VIEW ${this.genIdentifier(e.view_name)} AS \n${e.oldViewDefination}`}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new u.default;m.api(`${t}:args:`,e);try{const t=`DROP VIEW ${this.genIdentifier(e.view_name)}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:this.querySeparator()+`CREATE VIEW ${this.genIdentifier(e.view_name)} AS \n${e.oldViewDefination}`}]}}catch(e){throw m.ppe(e,t),e}return m.api(`${t}: result`,a),a}async tableCreate(e){const t=this.tableCreate.name,a=new u.default;m.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.createTable(e.tn,e);await this.sqlClient.raw(t);const i=this.querySeparator()+this.sqlClient.schema.dropTable(e.table).toString();this.emit(`Success : ${t}`);const n=await this.afterTableCreate(e);a.data.object={upStatement:[{sql:t},...n.upStatement],downStatement:[...n.downStatement,{sql:i}]}}catch(e){throw m.ppe(e,t),e}return a}async afterTableCreate(e){const t={upStatement:[],downStatement:[]};let a="",i="";for(let t=0;t<e.columns.length;t++){const n=e.columns[t];if(n.au){const t=`xc_au_${e.tn}_${n.cn}`,s=`xc_trigger_${e.tn}_${n.cn}`,o=this.genQuery("CREATE OR REPLACE FUNCTION ??()\n                          RETURNS TRIGGER AS $$\n                          BEGIN\n                            NEW.?? = NOW();\n                            RETURN NEW;\n                          END;\n                          $$ LANGUAGE plpgsql;",[t,n.cn]);a+=this.querySeparator()+o+this.querySeparator()+this.genQuery("CREATE TRIGGER ??\n            BEFORE UPDATE ON ??\n            FOR EACH ROW\n            EXECUTE PROCEDURE ??();",[s,e.tn,t]),i+=this.querySeparator()+this.genQuery("DROP TRIGGER IF EXISTS ?? ON ??;",[s,e.tn])+this.querySeparator()+this.genQuery("DROP FUNCTION IF EXISTS ??()",[t])}}return""!==a&&await this.sqlClient.raw(a),t.upStatement[0]={sql:a},t.downStatement[0]={sql:i},t}async afterTableUpdate(e){const t={upStatement:[],downStatement:[]};let a="",i="";for(let t=0;t<e.columns.length;t++){const n=e.columns[t];if(n.au&&1===n.altered){const t=`xc_au_${e.tn}_${n.cn}`,s=`xc_trigger_${e.tn}_${n.cn}`,o=this.genQuery("CREATE OR REPLACE FUNCTION ??()\n                          RETURNS TRIGGER AS $$\n                          BEGIN\n                            NEW.?? = NOW();\n                            RETURN NEW;\n                          END;\n                          $$ LANGUAGE plpgsql;",[t,n.cn]);a+=this.querySeparator()+o+this.querySeparator()+this.genQuery("CREATE TRIGGER ??\n            BEFORE UPDATE ON ??\n            FOR EACH ROW\n            EXECUTE PROCEDURE ??();",[s,e.tn,t]),i+=this.querySeparator()+this.genQuery("DROP TRIGGER IF EXISTS ?? ON ??;",[s,e.tn])+this.querySeparator()+this.genQuery("DROP FUNCTION IF EXISTS ??()",[t])}}return""!==a&&await this.sqlClient.raw(a),t.upStatement[0]={sql:a},t.downStatement[0]={sql:i},t}async tableUpdate(e){const t=this.tableUpdate.name,a=new u.default;m.api(`${t}:args:`,e);try{e.table=e.tn;const t=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let i="",n="";for(let a=0;a<e.columns.length;++a){const s=(0,l.default)(t,{cn:e.columns[a].cno});4&e.columns[a].altered?(i+=this.alterTableRemoveColumn(e.table,e.columns[a],s,i),n+=this.alterTableAddColumn(e.table,s,e.columns[a],n)):2&e.columns[a].altered||8&e.columns[a].altered?(i+=this.alterTableChangeColumn(e.table,e.columns[a],s,i),n+=this.alterTableChangeColumn(e.table,s,e.columns[a],n)):1&e.columns[a].altered&&(i+=this.alterTableAddColumn(e.table,e.columns[a],s,i),n+=this.alterTableRemoveColumn(e.table,e.columns[a],s,n))}i+=(i?";":"")+this.alterTablePK(e.table,e.columns,e.originalColumns,i),n+=(n?";":"")+this.alterTablePK(e.table,e.originalColumns,e.columns,n),""!==i&&await this.sqlClient.raw(i);const s=await this.afterTableUpdate(e);a.data.object={upStatement:[{sql:this.querySeparator()+i},...s.upStatement],downStatement:[...s.downStatement,{sql:this.querySeparator()+n}]}}catch(e){throw m.ppe(e,t),e}return a}async tableDelete(e){const t=this.tableDelete.name,a=new u.default;m.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.sqlClient.schema.dropTable(e.tn).toString();let i=this.createTable(e.tn,e),n=await this.relationList(e);n=n.data.list;for(const e of n)i+=this.querySeparator()+await this.sqlClient.schema.table(e.tn,(function(t){t=t.foreign(e.cn,null).references(e.rcn).on(e.rtn),e.ur&&(t=t.onUpdate(e.ur)),e.dr&&t.onDelete(e.dr)})).toQuery();let s=await this.indexList(e);s=s.data.list.filter((({cst:e})=>"p"!==e&&"f"!==e));const o={};for(const{key_name:t,non_unique:a,cn:i}of s)t in o||(o[t]={tn:e.tn,indexName:t,non_unique:a,columns:[]}),o[t].columns.push(i);for(const{non_unique:e,tn:t,columns:a,indexName:n}of Object.values(o))i+=this.querySeparator()+this.sqlClient.schema.table(t,(function(t){e?t.index(a,n):t.unique(a,n)})).toQuery();this.emit(`Success : ${t}`),await this.sqlClient.schema.dropTable(e.tn),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:this.querySeparator()+i}]}}catch(e){throw m.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name;let a=new u.default;m.api(`${t}:args:`,e);try{a=await this.columnList(e);const t=this.createTable(e.tn,{tn:e.tn,columns:a.data.list});a.data=t}catch(e){throw m.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new u.default;m.api(`${t}:args:`,e);try{a.data=`INSERT INTO \`${e.tn}\` (`;let t=" VALUES (";const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`"${i.data.list[e].cn}"\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n"${i.data.list[e].cn}"\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw m.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new u.default;m.api(`${t}:args:`,e);try{a.data=`UPDATE "${e.tn}" \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,"${t.data.list[e].cn}" = <\`${t.data.list[e].cn}\`>\n\t`:`"${t.data.list[e].cn}" = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw m.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new u.default;m.api(`${t}:args:`,e);try{a.data=`DELETE FROM "${e.tn}" where ;`}catch(e){throw m.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new u.default;m.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE "${e.tn}";`}catch(e){throw m.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new u.default;m.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, "${t.data.list[e].cn}"\n\t`:`"${t.data.list[e].cn}"\n\t`;a.data+=` FROM "${e.tn}";`}catch(e){throw m.ppe(e,t),e}return a}alterTablePK(e,t,a,i,n=!1){const s=[],o=[];let r=0;for(let e=0;e<t.length;++e)t[e].pk&&4!==t[e].altered&&o.push(t[e].cn);for(let e=0;e<a.length;++e)a[e].pk&&s.push(a[e].cn);if(o.length===s.length){for(let e=0;e<o.length;++e)if(s[e]!==o[e]){r=1;break}}else r=o.length-s.length;let l="";return(o.length||s.length)&&r&&(l+=s.length?this.genQuery("alter TABLE ?? drop constraint IF EXISTS ??;",[e,`${e}_pkey`]):"",o.length&&(l+=n?this.genQuery(", PRIMARY KEY(??)",[o]):this.genQuery("alter TABLE ?? add constraint ?? PRIMARY KEY(??);",[e,`${e}_pkey`,o]))),l}alterTableRemoveColumn(e,t,a,i){let n=i?",":"";return n+=this.genQuery("ALTER TABLE ?? DROP COLUMN ??",[e,t.cn],!0),n}createTableColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,0)}alterTableAddColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,1)}alterTableChangeColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,2)}createTable(e,t){let a="";for(let i=0;i<t.columns.length;++i)a+=this.createTableColumn(e,t.columns[i],null,a);return a+=this.alterTablePK(e,t.columns,[],a,!0),a=this.genQuery(`CREATE TABLE ?? (${a});`,[t.tn]),a}alterTableColumn(e,t,a,i,n=2){let s="";const o=this.sanitiseDefaultValue(t.cdf),r=!0;return 0===n?(s=i?",":"",t.ai?"int8"===t.dt||t.dt.indexOf("bigint")>-1?s+=this.genQuery(" ?? bigserial",[t.cn],r):"int2"===t.dt||t.dt.indexOf("smallint")>-1?s+=this.genQuery(" ?? smallserial",[t.cn],r):s+=this.genQuery(" ?? serial",[t.cn],r):(s+=this.genQuery(` ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],r),s+=t.rqd?" NOT NULL":" NULL",s+=o?` DEFAULT ${o}`:"")):1===n?(s+=this.genQuery(` ADD ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],r),s+=t.rqd?" NOT NULL":" NULL",s+=o?` DEFAULT ${o}`:"",s=this.genQuery(`ALTER TABLE ?? ${s};`,[e],r)):(t.cn!==a.cn&&(s+=this.genQuery("\nALTER TABLE ?? RENAME COLUMN ?? TO ?? ;\n",[e,a.cn,t.cn],r)),t.dt!==a.dt&&(s+=this.genQuery(`\nALTER TABLE ?? ALTER COLUMN ?? TYPE ${this.sanitiseDataType(t.dt)} USING ??::${this.sanitiseDataType(t.dt)};\n`,[e,t.cn,t.cn],r)),t.rqd!==a.rqd&&(s+=this.genQuery("\nALTER TABLE ?? ALTER COLUMN ?? ",[e,t.cn],r),s+=t.rqd?" SET NOT NULL;\n":" DROP NOT NULL;\n"),t.cdf!==a.cdf&&(s+=this.genQuery("\nALTER TABLE ?? ALTER COLUMN ?? ",[e,t.cn],r),s+=t.cdf?` SET DEFAULT ${this.sanitiseDefaultValue(t.cdf)};\n`:" DROP DEFAULT;\n")),s}get schema(){return this.connectionConfig&&this.connectionConfig.searchPath&&this.connectionConfig.searchPath[0]||"public"}async totalRecords(e={}){const t=this.totalRecords.name,a=new u.default;m.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT SUM(n_live_tup) as TotalRecords FROM pg_stat_user_tables;");a.data=e.rows[0]}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{m.api(`${t} :result: ${a}`)}return a}async getDefaultByteaOutputFormat(){var e,t;const a=this.getDefaultByteaOutputFormat.name,i=new u.default;m.api(`${a}:args:`,{});try{const a=await this.sqlClient.raw("SHOW bytea_output;");i.data=null===(t=null===(e=a.rows)||void 0===e?void 0:e[0])||void 0===t?void 0:t.bytea_output}catch(e){i.data="escape"}finally{m.api(`${a} :result: ${i}`)}return i}async tableRename(e){const t=this.tableCreate.name,a=new u.default;m.api(`${t}:args:`,e);try{e.table=e.tn,await this.sqlClient.schema.renameTable(this.sqlClient.raw("??.??",[this.schema,e.tn_old]),e.tn);const t=this.querySeparator()+this.sqlClient.schema.renameTable(this.sqlClient.raw("??.??",[this.schema,e.tn]),e.tn_old).toQuery();this.emit(`Success : ${t}`);const i=this.querySeparator()+this.sqlClient.schema.renameTable(this.sqlClient.raw("??.??",[this.schema,e.tn_old]),e.tn).toQuery();a.data.object={upStatement:[{sql:t}],downStatement:[{sql:i}]}}catch(e){throw m.ppe(e,t),e}return a}}t.default=f},37522:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(87750)),s=i(a(34032)),o=new(i(a(10277)).default)("YBClient");class r extends n.default{constructor(e){super(e)}async tableList(e={}){const t=this.tableList.name,a=new s.default;o.api(`${t}:args:`,e);try{const{rows:e}=await this.raw("select tablename as tn, * from pg_catalog.pg_tables where schemaname != 'information_schema' and schemaname != 'pg_catalog'");a.data.list=e}catch(e){throw o.ppe(e,t),e}return o.api(`${t}: result`,a),a}async columnList(e={}){const t=this.columnList.name,a=new s.default;o.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.raw(`\n      select c.relname as tn, a.attname as cn, pg_catalog.format_type(a.atttypid, a.atttypmod) as "dt",a.attnotnull as "not_nullable",\n      pg_catalog.pg_get_expr(ad.adbin, ad.adrelid, true) as cdf, dsc.description as comment,a.attnum as cop,\n      coalesce(i.indisprimary,false) as pk,\n      a.*,ad.oid as attr_id\n      FROM pg_catalog.pg_attribute a\n      INNER JOIN pg_catalog.pg_class c ON (a.attrelid=c.oid)\n      LEFT OUTER JOIN pg_catalog.pg_attrdef ad ON (a.attrelid=ad.adrelid AND a.attnum = ad.adnum)\n      LEFT OUTER JOIN pg_catalog.pg_description dsc ON (c.oid=dsc.objoid AND a.attnum = dsc.objsubid)\n      LEFT JOIN pg_index i ON (a.attnum = any(i.indkey) and a.attrelid = i.indrelid and i.indrelid = '${e.tn}'::regclass AND i.indisprimary)\n      WHERE NOT a.attisdropped AND c.relname = '${e.tn}' and a.attnum > 0 ORDER BY a.attnum`),i=[];for(let a=0;a<t.rows.length;++a){const n={};n.tn=e.tn,n.cn=t.rows[a].cn,n.dt=t.rows[a].dt,n.np=t.rows[a].np,n.ns=t.rows[a].ns,n.clen=t.rows[a].clen,n.dp=t.rows[a].dp,n.cop=t.rows[a].cop,n.dtx=this.getKnexDataType(n.dt),n.pk=null!==t.rows[a].pk_constraint_name,n.not_nullable=t.rows[a].not_nullable,n.nrqd=!n.not_nullable,t.rows[a].ct=t.rows[a].dt||"",n.un=-1!==t.rows[a].ct.indexOf("unsigned"),n.ai=!1,t.rows[a].cdf&&(n.ai=-1!==t.rows[a].cdf.indexOf("nextval")),n.cdf=t.rows[a].cdf?t.rows[a].cdf.split("::")[0].replace(/'/g,""):t.rows[a].cdf,n.cc=t.rows[a].comment,n.csn=t.rows[a].csn,i.push(n)}a.data.list=i}catch(e){throw o.ppe(e,t),e}return o.api(`${t}: result`,a),a}}t.default=r},92698:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const a={columnList:{default:{sql:"SELECT\n      c.table_name as tn,\n      c.column_name as cn,\n      c.data_type as dt,\n      c.column_type as ct,\n      c.character_maximum_length as clen,\n      c.numeric_precision as np,\n      c.numeric_scale as ns,\n      c.datetime_precision as dp,\n      c.ordinal_position as cop,\n      c.column_key as ck,\n      c.extra as ext, -- gives ai\n      c.column_default as cdf,\n      c.is_nullable as nrqd,\n      c.privileges as priv,\n      c.column_comment as cc,\n      c.generation_expression,\n      c.character_set_name as csn,\n      c.collation_name as clnn,\n      ct.CONSTRAINT_TYPE as cst\n    FROM\n      information_schema.COLUMNS as c\n    Left join(\n              select\n                      tc.CONSTRAINT_NAME,\n                      tc.TABLE_NAME,\n                      tc.CONSTRAINT_SCHEMA,\n                      tc.CONSTRAINT_TYPE,\n                      s.COLUMN_NAME\n              from\n                      information_schema.TABLE_CONSTRAINTS as tc\n              LEFT JOIN information_schema.STATISTICS as s ON\n                      s.table_schema = tc.CONSTRAINT_SCHEMA\n                      and s.TABLE_NAME = tc.TABLE_NAME\n                      and s.INDEX_NAME = tc.CONSTRAINT_NAME\n              where\n                      tc.CONSTRAINT_SCHEMA = ?\n                      and s.TABLE_NAME = ? \n      ) ct on\n      c.TABLE_SCHEMA = ct.CONSTRAINT_SCHEMA\n      AND c.TABLE_NAME = ct.TABLE_NAME\n      AND c.COLUMN_NAME = ct.COLUMN_NAME\n    WHERE\n      c.table_schema = ?\n      and c.TABLE_NAME = ?\n    ORDER BY\n      c.table_name,\n      c.ordinal_position",paramsHints:["databaseName","tn","databaseName","tn"]}},constraintList:{default:{sql:"SELECT \n      k.constraint_name as cstn, \n      k.column_name as cn, \n      k.ordinal_position as op, \n      k.position_in_unique_constraint as puc, \n      t.constraint_type as cst\nFROM information_schema.table_constraints t\nLEFT JOIN information_schema.key_column_usage k\nUSING(constraint_name,table_schema,table_name)\nWHERE\nt.table_schema=?\nAND t.table_name=?;",paramsHints:["database","tn"]}},createDatabaseIfNotExists:{default:{sql:"create database if not exists ??",paramsHints:["database"]}},createTableIfNotExists:{default:{sql:"",paramsHints:[]}},dropDatabase:{default:{sql:"drop database ??",paramsHints:["database"]}},databaseList:{default:{sql:"SHOW databases",paramsHints:[]}},hasDatabase:{default:{sql:"SHOW DATABASES LIKE ??",paramsHints:["databaseName"]}},indexList:{default:{sql:"show index from ??",paramsHints:["tn"]}},functionList:{default:{sql:"show function status where db=?",paramsHints:["databaseName"]}},functionRead:{default:{sql:"SHOW CREATE FUNCTION ??",paramsHints:["function_name"]}},functionDelete:{default:{sql:"DROP FUNCTION IF EXISTS ??",paramsHints:["function_name"]}},procedureList:{default:{sql:"show procedure status where db=?",paramsHints:["databaseName"]}},procedureRead:{default:{sql:"show create procedure ??",paramsHints:["procedure_name"]}},procedureDelete:{default:{sql:"DROP PROCEDURE IF EXISTS ??",paramsHints:["procedure_name"]}},relationList:{default:{sql:"SELECT\n      kcu.CONSTRAINT_NAME as cstn,\n      kcu.TABLE_NAME as tn,\n      kcu.COLUMN_NAME as cn,\n      kcu.POSITION_IN_UNIQUE_CONSTRAINT as puc,\n      kcu.REFERENCED_TABLE_NAME as rtn,\n      kcu.REFERENCED_COLUMN_NAME as rcn,\n      rc.MATCH_OPTION as mo,\n      rc.UPDATE_RULE as ur,\n      rc.DELETE_RULE as dr\n    FROM\n      information_schema.`KEY_COLUMN_USAGE` AS kcu\n    INNER JOIN information_schema.REFERENTIAL_CONSTRAINTS AS rc ON\n      kcu.CONSTRAINT_NAME = rc.CONSTRAINT_NAME\n    WHERE\n      kcu.table_schema = ?\n      AND kcu.referenced_column_name IS NOT NULL\n      AND kcu.table_name=?",paramsHints:["database","tn"]}},schemaCreate:{default:{sql:"create database ??",paramsHints:["database_name"]}},schemaDelete:{default:{sql:"drop database ??",paramsHints:["database_name"]}},triggerList:{default:{sql:"SHOW TRIGGERS like ?",paramsHints:["tn"]}},tableList:{default:{sql:"",paramsHints:[]}},testConnection:{default:{sql:"",paramsHints:[]}},triggerRead:{default:{sql:"SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW';",paramsHints:["databaseName"]}},triggerDelete:{default:{sql:"DROP TRIGGER ??",paramsHints:["trigger_name"]}},version:{default:{sql:"",paramsHints:[]}},viewRead:{default:{sql:"select * FROM INFORMATION_SCHEMA.VIEWS WHERE\n       TABLE_SCHEMA = ? AND TABLE_NAME = ?",paramsHints:["databaseName","view_name"]}},viewList:{default:{sql:"SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW'",paramsHints:["databaseName"]}}};t.default=a},70984:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(16464),s=i(a(57147)),o=i(a(40514)),r=i(a(89699)),l=i(a(87413)),c=i(a(76918)),d=a(30754),u=i(a(38463)),p=i(a(10277)),m=i(a(34032)),f=i(a(79374)),h=(0,d.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz_",6),g=new p.default("SqliteClient");class _ extends u.default{constructor(e){e.connection.useNullAsDefault=!0,super(e),this.sqlClient=(null==e?void 0:e.knex)||(0,o.default)(e.connection),this.queries=f.default,this._version={}}getKnexDataTypes(){const e=new m.default;return e.data.list=["int","integer","tinyint","smallint","mediumint","bigint","int2","int8","character","blob sub_type text","numeric","blob","real","double","double precision","float","numeric","boolean","date","datetime","text","varchar","timestamp"],e}async testConnection(e={}){const t=this.testConnection.name,a=new m.default;g.api(`${t}:args:`,e);try{await this.raw("SELECT 1+1 as data")}catch(e){g.ppe(e),a.code=-1,a.message=e.message}finally{g.api(`${t} :result: ${a}`)}return a}async version(e){const t=this.version.name,a=new m.default;g.api(`${t}:args:`,e);try{a.data.object={};const e=await this.raw("select sqlite_version() as version");g.debug(e[0]),a.data.object.version=e[0].version;const t=e[0].version.split(".");t.length&&3===t.length?(a.data.object.primary=t[0],a.data.object.major=t[1],a.data.object.minor=t[2],a.data.object.key=t[0]+t[1]):(a.code=-1,a.message=`Invalid version : ${e[0].version}`)}catch(e){g.ppe(e),a.code=-1,a.message=e.message}finally{g.api(`${t} :result: %o`,a)}return a}async createDatabaseIfNotExists(e){const t=this.createDatabaseIfNotExists.name,a=new m.default;g.api(`${t}:args:`,e);try{if(await(0,n.promisify)(s.default.exists)(e.database))this.sqlClient=(0,o.default)(this.connectionConfig.connection);else{g.debug("sqlite file do no exists - create one");const t=await(0,n.promisify)(s.default.open)(e.database,"w"),a=await(0,n.promisify)(s.default.close)(t);g.debug("sqlite file is created",t,a),this.sqlClient=(0,o.default)(this.connectionConfig.connection),await this.sqlClient.raw('PRAGMA encoding = "UTF-8"')}}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async dropDatabase(e){const t=this.dropDatabase.name,a=new m.default;g.api(`${t}:args:`,e);try{g.debug("dropping database:",e),await(0,n.promisify)(s.default.unlink)(e.database),g.debug("dropped database:")}catch(e){g.ppe(e,t)}return g.api(`${t}: result`,a),a}async createTableIfNotExists(e={}){const t=this.createTableIfNotExists.name,a=new m.default;g.api(`${t}:args:`,e);try{if((await this.hasTable({tn:e.tn})).data.value)g.debug(`${e.tn} tables exists`);else{const t=await this.sqlClient.schema.createTable(e.tn,(function(e){e.increments(),e.string("title").notNullable(),e.string("titleDown").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.dateTime("created"),e.timestamps()}));g.debug("Table created:",`${e.tn}`,t)}}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async hasTable(e){const t=this.hasTable.name,a=new m.default;g.api(`${t}:args:`,e);try{await this.sqlClient.raw("select * from ??",[e.tn]),a.data.value=!0}catch(e){a.data.value=!1}return g.api(`${t}: result`,a),a}async hasDatabase(e={}){const t=this.hasDatabase.name,a=new m.default;g.api(`${t}:args:`,e);let i=!1;return g.debug("sqlite databaseName:",e.databaseName),i=await(0,n.promisify)(s.default.exists)(e.databaseName),a.data.value=i,a}async databaseList(e){return[]}async tableList(e={}){const t=this.tableList.name,a=new m.default;g.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT name as tn FROM sqlite_master where type = 'table'");a.data.list=[];for(let t=0;t<e.length;++t)"sqlite_sequence"!==e[t].tn.toLocaleLowerCase()&&a.data.list.push(e[t])}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async schemaList(e={}){const t=this.schemaList.name;new m.default;throw g.api(`${t}:args:`,e),new Error("SchemaList : Not supported for sqlite")}async columnList(e={}){const t=this.columnList.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw("PRAGMA table_info(??)",[e.tn]),i=(await this.triggerList(e)).data.list;for(let a=0;a<t.length;++a){switch(t[a].cn=t[a].name,t[a].cno=t[a].cn,t[a].dt=t[a].type.toLocaleLowerCase(),t[a].dt){case"integer":case"int":case"text":case"varchar":case"numeric":case"blob":case"blob sub_type text":case"real":case"timestamp":case"tinyint":case"smallint":case"mediumint":case"bigint":case"int2":case"int8":case"character":case"double":case"double precision":case"float":case"boolean":case"date":case"datetime":case"time":break;default:if("t"===t[a].dt[0]||"i"===t[a].dt[0]){const e=/(\w+)\(([^)]+)\)/.exec(t[a].dt);e&&e.length&&e.length>1&&(t[a].dtxp=e[2],t[a].dt=e[1])}}t[a].nrqd=1!==t[a].notnull,t[a].not_nullable=1===t[a].notnull,t[a].rqd=1===t[a].notnull,t[a].cdf=t[a].dflt_value,t[a].pk=t[a].pk>0,t[a].cop=t[a].cid,t[a].ai=t[a].pk&&"integer"===t[a].dt,t[a].dtx=this.getKnexDataType(t[a].dt),t[a].dtxp="",t[a].dtxs="",t[a].au=!!i.find((({trigger:i})=>i===`xc_trigger_${e.tn}_${t[a].cn}`))}a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async indexList(e={}){const t=this.indexList.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw("PRAGMA index_list(??)",[e.tn]),i=[];for(let e=0,a=0;e<t.length;++e,++a){t[e].key_name=t[e].name,t[e].non_unique=0===t[e].unique?1:0,t[e].non_unique_original=0===t[e].unique?1:0,t[e].unique=1===t[e].unique?1:0;const n=await this.sqlClient.raw("PRAGMA index_info(??)",[t[e].key_name]);if(1===n.length)i[a]=t[e],i[a].cn=n[0].name,i[a].seq_in_index=1;else{for(let s=0;s<n.length;++s,++a)i[a]=JSON.parse(JSON.stringify(t[e])),i[a].cn=n[s].name,i[a].seq_in_index=s;a--}}a.data.list=i}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async relationList(e={}){const t=this.relationList.name,a=new m.default;g.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("PRAGMA foreign_key_list(??)",[e.tn]);for(let a=0;a<t.length;++a)t[a].tn=e.tn,t[a].cn=t[a].from,t[a].rtn=t[a].table,t[a].rcn=t[a].to,t[a].ur=t[a].on_update,t[a].dr=t[a].on_delete,t[a].mo=t[a].match;a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async relationListAll(e={}){const t=this.relationList.name,a=new m.default;g.api(`${t}:args:`,e);try{let e=await this.tableList();e=e.data.list;const t=[];for(let a=0;a<e.length;++a){const i=await this.sqlClient.raw("PRAGMA foreign_key_list(??)",[e[a].tn]);for(let n=0;n<i.length;++n)i[n].tn=e[a].tn,i[n].cn=i[n].from,i[n].rtn=i[n].table,i[n].rcn=i[n].to,i[n].ur=i[n].on_update,i[n].dr=i[n].on_delete,i[n].mo=i[n].match,t.push(i[n])}a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async triggerList(e={}){const t=this.triggerList.name,a=new m.default;g.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("select *, name as trigger_name from sqlite_master where type = 'trigger' and tbl_name=?;",[e.tn]);for(let e=0;e<t.length;++e)t[e].trigger=t[e].name,t[e].table=t[e].tbl_name,t[e].statement=t[e].sql;a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async functionList(e={}){const t=this.functionList.name,a=new m.default;g.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("show function status where db=?",[e.databaseName]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,l.default)(i,(function(e,t){return t.toLowerCase()})),i.function_name=i.name,e.push(i)}a.data.list=e}else g.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async procedureList(e={}){const t=this.procedureList.name,a=new m.default;g.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("show procedure status where db=?",[e.databaseName]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,l.default)(i,(function(e,t){return t.toLowerCase()})),i.procedure_name=i.name,e.push(i)}a.data.list=e}else g.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async viewList(e={}){const t=this.viewList.name,a=new m.default;g.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SELECT * FROM sqlite_master WHERE type = 'view'");for(let e=0;e<t.length;++e)t[e].view_name=t[e].name,t[e].view_definition=t[e].sql;a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async functionRead(e={}){const t=this.functionRead.name,a=new m.default;g.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SHOW CREATE FUNCTION ??;",[e.function_name]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,l.default)(i,(function(e,t){return t.toLowerCase()})),i.create_function=i["create function"],e.push(i)}a.data.list=e}else g.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async procedureRead(e={}){const t=this.procedureRead.name,a=new m.default;g.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("show create procedure ??;",[e.procedure_name]);if(2===t.length){const e=[];for(let a=0;a<t[0].length;++a){let i=t[0][a];i=(0,l.default)(i,(function(e,t){return t.toLowerCase()})),i.create_procedure=i["create procedure"],e.push(i)}a.data.list=e}else g.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async viewRead(e={}){const t=this.viewRead.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw("SELECT * FROM sqlite_master WHERE type = 'view' AND name = ?",[e.view_name]);for(let e=0;e<t.length;++e)t[e].view_name=t[e].name,t[e].view_definition=t[e].sql;a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async triggerRead(e={}){const t=this.triggerRead.name,a=new m.default;g.api(`${t}:args:`,e);try{e.databaseName=this.connectionConfig.connection.database;const t=await this.sqlClient.raw("SHOW FULL TABLES IN ?? WHERE TABLE_TYPE LIKE 'VIEW';",[e.databaseName]);if(2===t.length){const i=[];for(let a=0;a<t[0].length;++a){const n=t[0][a];n.view_name=n[`Tables_in_${e.databaseName}`],i.push(n)}a.data.list=i}else g.debug("Unknown response for databaseList:",t),a.data.list=[]}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async schemaCreate(e={}){const t=this.schemaCreate.name;g.api(`${t}:args:`,e);return await this.sqlClient.raw("create database ??",[e.database_name])}async schemaDelete(e={}){const t=this.schemaDelete.name;g.api(`${t}:args:`,e);return await this.sqlClient.raw("drop database ??",[e.database_name])}async triggerDelete(e={}){const t=this.triggerDelete.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=this.querySeparator()+"DROP TRIGGER ??";await this.sqlClient.raw(t,[e.trigger_name]),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:";"}]}}catch(e){throw g.ppe(e,t),e}return a}async functionDelete(e={}){const t=this.functionDelete.name;g.api(`${t}:args:`,e);return await this.sqlClient.raw("DROP FUNCTION IF EXISTS ??",[e.function_name])}async procedureDelete(e={}){const t=this.procedureDelete.name;g.api(`${t}:args:`,e);return await this.sqlClient.raw("DROP PROCEDURE IF EXISTS ??",[e.procedure_name])}async _getQuery(e){try{if((0,r.default)(this._version)){const t=await this.version();this._version=t.data.object,g.debug(`Version was empty for ${e.func}: population version for database as`,this._version)}return this._version.key in this.queries[e.func]?this.queries[e.func][this._version.key].sql:this.queries[e.func].default.sql}catch(e){throw g.ppe(e,this._getQuery.name),e}}async functionCreate(e={}){const t=this.functionCreate.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.function_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async functionUpdate(e={}){const t=this.functionUpdate.name,a=new m.default;g.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${this.genIdentifier(e.function_name)}`);const t=await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.function_name)}\` \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async procedureCreate(e={}){const t=this.procedureCreate.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.procedure_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async procedureUpdate(e={}){const t=this.procedureUpdate.name,a=new m.default;g.api(`${t}:args:`,e);try{await this.sqlClient.raw(`DROP TRIGGER ${e.procedure_name}`);const t=await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.procedure_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);a.data.list=t}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async triggerCreate(e={}){const t=this.triggerCreate.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=this.querySeparator()+`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:t}],downStatement:[{sql:";"}]}}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async triggerUpdate(e={}){const t=this.triggerUpdate.name,a=new m.default;g.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP TRIGGER ??",[e.trigger_name]),await this.sqlClient.raw(`CREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`);const t=`DROP TRIGGER ${this.genIdentifier(e.trigger_name)};\nCREATE TRIGGER ${this.genIdentifier(e.trigger_name)} \n${e.timing} ${e.event}\nON ${this.genIdentifier(e.tn)} FOR EACH ROW\n${e.statement}`;a.data.object={upStatement:[{sql:t}],downStatement:[{sql:";"}]}}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async viewCreate(e={}){const t=this.viewCreate.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=e.view_definition+";";await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:";"}]}}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async viewUpdate(e={}){const t=this.viewUpdate.name,a=new m.default;g.api(`${t}:args:`,e);try{const t=e.view_definition;await this.sqlClient.raw(t),a.data.object={upStatement:[{sql:this.querySeparator()+t}],downStatement:[{sql:";"}]}}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async viewDelete(e={}){const t=this.viewDelete.name,a=new m.default;g.api(`${t}:args:`,e);try{await this.sqlClient.raw("DROP VIEW ??;",[e.view_name]),a.data.object={upStatement:[{sql:this.querySeparator()+`DROP VIEW ${e.view_name};`}],downStatement:[{sql:";"}]}}catch(e){throw g.ppe(e,t),e}return g.api(`${t}: result`,a),a}async tableCreate(e){const t=this.tableCreate.name,a=new m.default;g.api(`${t}:args:`,e);try{e.table=e.tn,e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.createTable(e.tn,e);await this.sqlClient.raw(t);const i=[{sql:";"}];this.emit(`Success : ${t}`);const n=await this.afterTableCreate(e);a.data.object={upStatement:[{sql:t},...n.upStatement],downStatement:i}}catch(e){throw g.ppe(e,t),e}return a}async afterTableCreate(e){const t={upStatement:[],downStatement:[]};let a="";const i=e.columns.find((e=>e.pk));if(!i)return t;const n=this.genIdentifier(e.tn);for(let t=0;t<e.columns.length;t++){const s=e.columns[t];if(s.au){const e=this.genIdentifier(`xc_trigger_${n}_${s.cn}`),t=`${this.querySeparator()}CREATE TRIGGER ${e}\n            AFTER UPDATE\n            ON "${n}" FOR EACH ROW\n            BEGIN\n              UPDATE "${n}" SET ${this.genIdentifier(s.cn)} = current_timestamp\n                WHERE ${this.genIdentifier(i.cn)} = old.${this.genIdentifier(i.cn)};\n            END;`;a+=t,await this.sqlClient.raw(t)}}return t.upStatement[0]={sql:a},t.downStatement[0]={sql:""},t}async afterTableUpdate(e){const t={upStatement:[],downStatement:[]};let a="";const i=e.columns.find((e=>e.pk));if(!i)return t;const n=this.genIdentifier(e.tn);for(let t=0;t<e.columns.length;t++){const s=e.columns[t];if(s.au&&1===s.altered){const t=this.genIdentifier(`xc_trigger_${e.tn}_${s.cn}`),o=`${this.querySeparator()}CREATE TRIGGER ${t}\n            AFTER UPDATE\n            ON "${n}" FOR EACH ROW\n            BEGIN\n              UPDATE "${n}" SET ${this.genIdentifier(s.cn)} = current_timestamp\n                WHERE ${this.genIdentifier(i.cn)} = old.${this.genIdentifier(i.cn)};\n            END;`;a+=o,await this.sqlClient.raw(o)}}return t.upStatement[0]={sql:a},t.downStatement[0]={sql:""},t}async tableUpdate(e){var t,a;const i=this.tableUpdate.name,n=new m.default;g.api(`${i}:args:`,e);try{e.table=e.tn;const s=e.originalColumns;e.connectionConfig=this._connectionConfig,e.sqlClient=this.sqlClient;let o="",r="";for(let t=0;t<e.columns.length;++t){const a=(0,c.default)(s,{cn:e.columns[t].cno});!e.columns[t].pk&&4&e.columns[t].altered?(o+=this.alterTableRemoveColumn(e.table,e.columns[t],a,o),r+=this.alterTableAddColumn(e.table,a,e.columns[t],r)):2&e.columns[t].altered||8&e.columns[t].altered?(o+=this.alterTableChangeColumn(e.table,e.columns[t],a,o),r+=";"):1&e.columns[t].altered&&(o+=this.alterTableAddColumn(e.table,e.columns[t],a,o),r+=";")}const l=this.alterTablePK(e.columns,e.originalColumns,o),d=null===(a=null===(t=await this.sqlClient.raw("PRAGMA foreign_keys;"))||void 0===t?void 0:t[0])||void 0===a?void 0:a.foreign_keys;d&&await this.sqlClient.raw("PRAGMA foreign_keys = OFF;"),await this.sqlClient.raw("PRAGMA legacy_alter_table = ON;");const u=await this.sqlClient.transaction();try{const t=o.split(";");for(let e=0;e<t.length;e++)""!==t[e].trim()&&await u.raw(t[e]);l&&await u.schema.alterTable(e.table,(e=>{for(const t of l.oldPks.filter((e=>!l.newPks.includes(e))))e.dropPrimary(t);for(const t of l.dropPks)e.dropColumn(t);l.newPks.length&&e.primary(l.newPks)})),await u.commit()}catch(e){throw await u.rollback(),g.ppe(e,i),e}finally{d&&await this.sqlClient.raw("PRAGMA foreign_keys = ON;"),await this.sqlClient.raw("PRAGMA legacy_alter_table = OFF;")}console.log(o);const p=await this.afterTableUpdate(e);n.data.object={upStatement:[{sql:this.querySeparator()+o},...p.upStatement],downStatement:[{sql:";"}]}}catch(e){throw g.ppe(e,i),e}return n}async tableDelete(e){const t=this.tableDelete.name,a=new m.default;g.api(`${t}:args:`,e);try{e.sqlClient=this.sqlClient;const t=this.querySeparator()+this.sqlClient.schema.dropTable(e.tn).toString(),i=[{sql:";"}];this.emit(`Success : ${t}`),await this.sqlClient.schema.dropTable(e.tn),a.data.object={upStatement:[{sql:t}],downStatement:i}}catch(e){throw g.ppe(e,t),e}return a}async tableCreateStatement(e){const t=this.tableCreateStatement.name;let a=new m.default;g.api(`${t}:args:`,e);try{a=await this.columnList(e);const t=this.createTable(e.tn,{tn:e.tn,columns:a.data.list});a.data=t}catch(e){throw g.ppe(e,t),e}return a}async tableInsertStatement(e){const t=this.tableCreateStatement.name,a=new m.default;g.api(`${t}:args:`,e);try{a.data=`INSERT INTO "${e.tn}" (`;let t=" VALUES (";const i=await this.columnList(e);if(i.data&&i.data.list)for(let e=0;e<i.data.list.length;++e)e?(a.data+=`, \`${i.data.list[e].cn}\`\n\t`,t+=`, <${i.data.list[e].cn}>\n\t`):(a.data+=`\n${i.data.list[e].cn}\n\t`,t+=`\n<${i.data.list[e].cn}>\n\t`);a.data+=")",t+=");",a.data+=t}catch(e){throw g.ppe(e,t),e}return a}async tableUpdateStatement(e){const t=this.tableUpdateStatement.name,a=new m.default;g.api(`${t}:args:`,e);try{a.data=`UPDATE "${e.tn}" \nSET\n`;const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`,${t.data.list[e].cn} = <\`${t.data.list[e].cn}\`>\n\t`:`${t.data.list[e].cn} = <\`${t.data.list[e].cn}\`>\n\t`;a.data+=";"}catch(e){throw g.ppe(e,t),e}return a}async tableDeleteStatement(e){const t=this.tableDeleteStatement.name,a=new m.default;g.api(`${t}:args:`,e);try{a.data=`DELETE FROM "${e.tn}" where ;`}catch(e){throw g.ppe(e,t),e}return a}async tableTruncateStatement(e){const t=this.tableTruncateStatement.name,a=new m.default;g.api(`${t}:args:`,e);try{a.data=`TRUNCATE TABLE "${e.tn}";`}catch(e){throw g.ppe(e,t),e}return a}async tableSelectStatement(e){const t=this.tableSelectStatement.name,a=new m.default;g.api(`${t}:args:`,e);try{a.data="SELECT ";const t=await this.columnList(e);if(t.data&&t.data.list)for(let e=0;e<t.data.list.length;++e)a.data+=e?`, ${t.data.list[e].cn}\n\t`:`${t.data.list[e].cn}\n\t`;a.data+=` FROM "${e.tn}";`}catch(e){throw g.ppe(e,t),e}return a}async sequelizeModelCreate(e){const t=this.sequelizeModelCreate.name,a=new m.default;g.api(`${t}:args:`,e);try{console.time(t);let a=[];e.tn?a.push({tn:e.tn}):(a=await this.tableList(e),a=a.data.list);let i=await this.relationList(e);i=i.data.list,e.tn&&(i=i.filter((t=>t.tn===e.tn||t.rtn===e.tn)));for(let e=0;e<a.length;++e){let t=await this.columnList({tn:a[e].tn});t=t.data.list,console.log(`Sequelize model created: ${a[e].tn}(${t.length})\n`),console.log("\n\n- - - - - - - - - - - - - ")}console.timeEnd(t)}catch(e){throw g.ppe(e,t),e}return a}createTablePK(e,t){const a=[];for(let t=0;t<e.length;++t)e[t].pk&&4!==e[t].altered&&a.push(e[t].cn);let i="";return a.length&&(i+=this.genQuery(", PRIMARY KEY(??)",[a])),i}alterTablePK(e,t,a){const i=[],n=[],s=[];let o=!1;for(let t=0;t<e.length;++t)e[t].pk&&(4!==e[t].altered?i.push(e[t].cn):s.push(e[t].cn),o=!0);for(let e=0;e<t.length;++e)t[e].pk&&n.push(t[e].cn);return i.length===n.length&&i.every((e=>n.includes(e)))&&0===s.length&&(o=!1),!!o&&{newPks:i,oldPks:n,dropPks:s}}alterTableRemoveColumn(e,t,a,i){let n=i?";":"";return n+=this.genQuery("ALTER TABLE ?? DROP COLUMN ??",[e,t.cn],!0),n}createTableColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,0)}alterTableAddColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,1)}alterTableChangeColumn(e,t,a,i){return this.alterTableColumn(e,t,a,i,2)}createTable(e,t){let a="";for(let i=0;i<t.columns.length;++i)a+=this.createTableColumn(e,t.columns[i],null,a);return a+=this.createTablePK(t.columns,a),a=this.genQuery(`CREATE TABLE ?? (${a});`,[t.tn]),a}alterTableColumn(e,t,a,i,n=2){let s="",o=!0;if(2===n){const i=h(),n=this.genQuery("ALTER TABLE ?? RENAME COLUMN ?? TO ??;",[e,a.cn,`${a.cno}_nc_${i}`],o);let r="";r+=this.genQuery(` ADD ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],o),r+=t.dtxp&&"text"!==t.dt?`(${this.genRaw(t.dtxp)})`:"",r+=t.cdf?` DEFAULT ${this.sanitiseDefaultValue(t.cdf)}`:t.rqd?" DEFAULT ''":" ",r+=t.rqd?" NOT NULL":" ",r=this.genQuery(`ALTER TABLE ?? ${r};`,[e],o);s=`${n}${r}${this.genQuery("UPDATE ?? SET ?? = ??;",[e,t.cn,`${a.cno}_nc_${i}`],o)}${this.genQuery("ALTER TABLE ?? DROP COLUMN ??;",[e,`${a.cno}_nc_${i}`],o)}`}else 0===n?(s=i?",":"",s+=this.genQuery(`?? ${this.sanitiseDataType(t.dt)}`,[t.cn],o),s+=t.dtxp&&"text"!==t.dt?`(${this.genRaw(t.dtxp)})`:"",s+=t.cdf?` DEFAULT ${this.sanitiseDefaultValue(t.cdf)}`:" ",s+=t.rqd?" NOT NULL":" "):1===n&&(o=!0,s+=this.genQuery(` ADD ?? ${this.sanitiseDataType(t.dt)}`,[t.cn],o),s+=t.dtxp&&"text"!==t.dt?`(${this.genRaw(t.dtxp)})`:"",s+=t.cdf?` DEFAULT ${this.sanitiseDefaultValue(t.cdf)}`:t.rqd?" DEFAULT ''":" ",s+=t.rqd?" NOT NULL":" ",s=this.genQuery(`ALTER TABLE ?? ${s};`,[e],o));return s}async totalRecords(e={}){const t=this.totalRecords.name,a=new m.default;g.api(`${t}:args:`,e);try{const e=await this.sqlClient.raw("SELECT name FROM sqlite_master WHERE type='table';");let t=0;for(const a of e){const e=await this.sqlClient.raw("SELECT COUNT(*) as ct FROM ??;",[a.name]);e&&e.length&&(t+=e[0].ct)}a.data.TotalRecords=t}catch(e){a.code=-1,a.message=e.message,a.object=e}finally{g.api(`${t} :result: ${a}`)}return a}}t.default=_},79374:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default={int:{},integer:{},tinyint:{},smallint:{},mediumint:{},bigint:{},"unsigned big int":{},int2:{},int4:{},character:{},varchar:{},nchar:{},text:{},clob:{},"varying character":{},"native character":{},blob:{},real:{},double:{},"double precision":{},float:{},numeric:{},decimal:{},boolean:{},date:{},datetime:{}}},98577:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(10277)),s=i(a(91774));t.default=class{constructor({dir:e="",filename:t="",ctx:a}){this.dir=e,this.filename=t,this.ctx=a,this.evt=new s.default,this.log=new n.default("BaseRender")}emit(e){this.log.api(e),this.evt.evt.emit("UI",{status:0,data:`File : ${e}`})}emitW(e){this.log.warn(e),this.evt.evt.emit("UI",{status:1,data:`File : ${e}`})}emitE(e){this.log.error(e),this.evt.evt.emit("UI",{status:-1,data:`File : ${e}`})}async prepare(){console.log("BaseRender::prepare -> Should be overriden")}}},8741:function(e,t,a){var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(a(69309)),o=n(a(98577)),r=a(60334);class l extends o.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.columns={func:this._renderColumns.bind(this),args:this.ctx},e}_renderColumns(e){let t="";return t+=`\n    ${this._getInputType(e)}\r\n\n    ${this._getQuery(e)},\r\n\n    ${this._getMutation(e)}\r\n\n    ${this._getType(e)}\r\n\n    `,t+="",t}getString(){return this._renderColumns(this.ctx)}generateManyToManyTypeProps(e){var t;if(!(null===(t=e.manyToMany)||void 0===t?void 0:t.length))return"";let a="\r\n";for(const t of e.manyToMany)a+=`\t\t${t._rtn}MMList(where: String,limit: Int, offset: Int, sort: String): [${t._rtn}]\r\n`;return a}generateVirtualTypes(e){var t;if(!(null===(t=e.v)||void 0===t?void 0:t.length))return"";const a=[];for(const t of e.v)(t.formula||t.rl)&&a.push(`\t\t${t._cn}: JSON`);return a.length?`\r\n${a.join("\r\n")}\r\n`:""}_getInputType(e){let t=`input ${e._tn}Input { \r\n`;for(const a of e.columns)/\s/.test(a._cn)?console.log(`Skipping ${e.tn}.${a._cn}`):t+=`\t\t${a._cn}: ${this._getGraphqlType(a)},\r\n`;return t+="\t}",t}_getQuery(e){let t="type Query { \r\n";return t+=`\t\t${e._tn}List(where: String,condition:Condition${e._tn}, limit: Int, offset: Int, sort: String,conditionGraph: String): [${e._tn}]\r\n`,t+=`\t\t${e._tn}Read(id:String!): ${e._tn}\r\n`,t+=`\t\t${e._tn}Exists(id: String!): Boolean\r\n`,t+=`\t\t${e._tn}FindOne(where: String,condition:Condition${e._tn}): ${e._tn}\r\n`,t+=`\t\t${e._tn}Count(where: String,condition:Condition${e._tn},conditionGraph: String): Int\r\n`,t+=`\t\t${e._tn}Distinct(column_name: String, where: String,condition:Condition${e._tn}, limit: Int, offset: Int, sort: String): [${e._tn}]\r\n`,t+=`\t\t${e._tn}GroupBy(fields: String, having: String, limit: Int, offset: Int, sort: String): [${e._tn}GroupBy]\r\n`,t+=`\t\t${e._tn}Aggregate(column_name: String!, having: String, limit: Int, offset: Int, sort: String, func: String!): [${e._tn}Aggregate]\r\n`,t+=`\t\t${e._tn}Distribution(min: Int, max: Int, step: Int, steps: String, column_name: String!): [distribution]\r\n`,t+="\t}\r\n",t}_getMutation(e){let t="type Mutation { \r\n";return t+=`\t\t${e._tn}Create(data:${e._tn}Input): ${e._tn}\r\n`,t+=`\t\t${e._tn}Update(id:String,data:${e._tn}Input):  ${e._tn}\r\n`,t+=`\t\t${e._tn}Delete(id:String): Int\r\n`,t+=`\t\t${e._tn}CreateBulk(data: [${e._tn}Input]): [Int]\r\n`,t+=`\t\t${e._tn}UpdateBulk(data: [${e._tn}Input]): [Int]\r\n`,t+=`\t\t${e._tn}DeleteBulk(data: [${e._tn}Input]): [Int]\r\n`,t+="\t},\r\n",t}_getType(e){let t=`type ${e._tn} { \r\n`,a=`input Condition${e._tn} { \r\n`;for(const i of e.columns)i._cn.split(" ").length>1?console.log(`Skipping ${e.tn}.${i._cn}`):(t+=`\t\t${i._cn.replace(/ /g,"_")}: ${this._getGraphqlType(i)},\r\n`,a+=`\t\t${i._cn.replace(/ /g,"_")}: ${this._getGraphqlConditionType(i)},\r\n`);let n=e.hasMany;n.length>1&&(n=(0,s.default)(n,(e=>[e.tn,e.rtn].join()))),t+=n.length?"\r\n":"";for(const{_tn:e}of n){t+=`\t\t${e}List(where: String,limit: Int, offset: Int, sort: String): [${e}]\r\n`,a+=`\t\t${e}List: Condition${e}\r\n`,t+=`\t\t${e}Count: Int\r\n`}t+=this.generateManyToManyTypeProps(e),t+=this.generateVirtualTypes(e);let o=e.belongsTo;o.length>1&&(o=(0,s.default)(o,(e=>[e.tn,e.rtn].join()))),t+=o.length?"\r\n":"";for(const{_rtn:e}of o){t+=`\t\t${e}Read(id:String): ${e}\r\n`,a+=`\t\t${e}Read: Condition${e}\r\n`}t+="\t}\r\n";const l=Object.assign({},r.GROUPBY_DEFAULT_COLS);t+=`type ${e._tn}GroupBy { \r\n`;for(let a of e.columns){const{_cn:e}=a,n=i(a,["_cn"]);e in l?l[e]=`\t\t# ${e} - clashes with column in table\r\n`:t+=`\t\t${e.replace(/ /g,"_")}: ${this._getGraphqlType(n)},\r\n`}t+=Object.values(l).join(""),t+="\t}\r\n";const c=Object.assign({},r.AGG_DEFAULT_COLS);t+=`type ${e._tn}Aggregate { \r\n`;for(const a of e.columns)a._cn in c?c[a._cn]=`\t\t# ${a._cn} - clashes with column in table\r\n`:t+=`\t\t${a._cn.replace(/ /g,"_")}: ${this._getGraphqlType(a)},\r\n`;return t+=Object.values(c).join(""),t+="\t}\r\n",a+=`\n    _or:[Condition${e._tn}]\n    _not:Condition${e._tn}\n    _and:[Condition${e._tn}]\n    \n    \t}\r\n`,`${t}\r\n\r\n${a}`}}t.default=l},81984:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(54884)),s=i(a(65729)),o=i(a(99733)),r=i(a(90650)),l=i(a(72201));t.default=class{static create(e,t){if("mysql2"===e.client||"mysql"===e.client)return new s.default(t);if("sqlite3"===e.client)return new l.default(t);if("mssql"===e.client)return new n.default(t);if("pg"===e.client)return new r.default(t);if("oracledb"===e.client)return new o.default(t);throw new Error("Database not supported")}}},54884:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(8741));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}_getGraphqlType(e){switch(e.dt){case"smallint":case"int":case"tinyint":case"bigint":return"Int";case"numeric":case"money":case"real":case"decimal":case"float":return"Float";case"binary":case"bit":return"Boolean";case"char":case"date":case"datetime":case"datetime2":case"datetimeoffset":case"heirarchyid":case"image":case"nchar":case"ntext":case"nvarchar":case"smalldatetime":case"smallmoney":case"sql_variant":case"sysname":case"text":case"time":case"timestamp":case"uniqueidentifier":case"varbinary":case"xml":case"varchar":default:return"String";case"geography":case"geometry":case"json":return"JSON"}}_getGraphqlConditionType(e){switch(this._getGraphqlType(e.dt)){case"Int":return"ConditionInt";case"Float":return"ConditionFloat";case"Boolean":return"ConditionBoolean";case"String":case"[String]":case"JSON":return"ConditionString"}}}t.default=s},65729:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(8741));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}_getGraphqlType(e){switch(e.dt){case"tinyint":case"smallint":case"mediumint":case"bigint":case"serial":case"int":return"Int";case"float":case"decimal":case"double":case"real":return"Float";case"bit":case"boolean":return"Boolean";case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":return"String";default:return"JSON"}}_getGraphqlConditionType(e){switch(this._getGraphqlType(e.dt)){case"Int":return"ConditionInt";case"Float":return"ConditionFloat";case"Boolean":return"ConditionBoolean";case"String":case"JSON":case"[String]":return"ConditionString"}}}t.default=s},99733:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(8741));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}_getGraphqlType(e){switch(e.dt){case"char":case"nchar":case"nvarchar2":case"varchar2":case"long":case"raw":case"long raw":case"date":case"timestamp":case"timestamp with time zone":case"timestamp with local time zone":case"interval year to month":case"interval day to second":case"bfile":case"blob":case"clob":case"nclob":default:return"String";case"number":case"numeric":case"float":case"dec":case"real":case"decimal":case"double precision":return"Float";case"integer":case"int":case"smallint":case"rowid":case"urowid":return"Int"}}_getGraphqlConditionType(e){switch(this._getGraphqlType(e.dt)){case"Int":return"ConditionInt";case"Float":return"ConditionFloat";case"Boolean":return"ConditionBoolean";case"String":case"[String]":return"ConditionString"}}}t.default=s},90650:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(8741));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}_getGraphqlType(e){switch(e.dt){case"int":case"integer":case"bigint":case"bigserial":case"char":case"int2":case"int4":case"int8":case"int4range":case"int8range":case"serial":case"serial2":case"smallint":case"smallserial":case"serial8":return"ARRAY"===e.dtx?"[Int]":"Int";case"bit":case"bool":case"boolean":return"ARRAY"===e.dtx?"[Boolean]":"Boolean";case"money":case"real":case"float4":case"float8":return"ARRAY"===e.dtx?"[Float]":"Float";case"json":case"jsonb":case"anyenum":case"anynonarray":case"path":case"point":case"polygon":return"ARRAY"===e.dtx?"[JSON]":"JSON";default:return"ARRAY"===e.dtx?"[String]":"String"}}_getGraphqlConditionType(e){switch(this._getGraphqlType(e.dt)){case"Int":return"ConditionInt";case"Float":return"ConditionFloat";case"Boolean":return"ConditionBoolean";case"String":case"[String]":case"[JSON]":case"JSON":return"ConditionString"}}}t.default=s},72201:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(8741));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}_getGraphqlType(e){switch(e.dt){case"int":case"integer":case"tinyint":case"smallint":case"mediumint":case"bigint":case"int2":case"int8":return"Int";case"character":case"blob sub_type text":case"blob":case"date":case"datetime":case"text":case"varchar":case"timestamp":default:return"String";case"real":case"double":case"double precision":case"float":case"numeric":return"Float";case"boolean":return"Boolean"}}_getGraphqlConditionType(e){switch(this._getGraphqlType(e.dt)){case"Int":return"ConditionInt";case"Float":return"ConditionFloat";case"Boolean":return"ConditionBoolean";case"String":case"[String]":return"ConditionString"}}}t.default=s},60334:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GROUPBY_DEFAULT_COLS=t.AGG_DEFAULT_COLS=void 0;const a={count:"\t\tcount: Int,\r\n",avg:"\t\tavg: Float,\r\n",min:"\t\tmin: Float,\r\n",max:"\t\tmax: Int,\r\n",sum:"\t\tsum: Float\r\n"};t.AGG_DEFAULT_COLS=a;const i={count:"\t\tcount: Int,\r\n"};t.GROUPBY_DEFAULT_COLS=i},16412:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(98577)),o=i(a(35619));class r extends s.default{getXcColumnsObject(e){var t,a,i,s,o;const r=[];for(const l of e.columns){(null===(a=null===(t=this.ctx)||void 0===t?void 0:t.belongsTo)||void 0===a?void 0:a.find((e=>e.cn===l.cn)))&&(l.uidt=n.UITypes.ForeignKey);const e=Object.assign({validate:{func:[],args:[],msg:[]},column_name:l.cn||l.column_name,title:l._cn||l.cn||l.column_name||l.title,type:this._getAbstractType(l),dt:l.dt,uidt:l.uidt||this.getUIDataType(l),uip:l.uip,uicn:l.uicn},l);l.rqd&&(e.rqd=l.rqd),l.cdf&&(e.default=l.cdf,e.columnDefault=l.cdf),l.un&&(e.un=l.un),l.pk&&(e.pk=l.pk),l.ai&&(e.ai=l.ai),l.dtxp&&(e.dtxp=l.dtxp),l.dtxs&&(e.dtxs=l.dtxs);const c=null===(o=null===(s=null===(i=this.ctx)||void 0===i?void 0:i.oldMeta)||void 0===s?void 0:s.columns)||void 0===o?void 0:o.find((t=>e.cn==t.cn&&e.type==t.type));c&&(e._cn=c._cn||e._cn,e.uidt=c.uidt,e.uidt!==n.UITypes.MultiSelect&&e.uidt!==n.UITypes.SingleSelect||"set"===e.dt||"enum"===e.dt||(e.dtxp=e.dtxp||c.dtxp)),r.push(e)}return this.mapDefaultDisplayValue(r),r}getObject(){return{tn:this.ctx.tn,_tn:this.ctx._tn,columns:this.getXcColumnsObject(this.ctx),pks:[],hasMany:this.ctx.hasMany,belongsTo:this.ctx.belongsTo,db_type:this.ctx.db_type,type:this.ctx.type,v:this.getVitualColumns()}}getVitualColumns(){var e,t;const a=[...(this.ctx.hasMany||[]).map((e=>({uidt:n.UITypes.LinkToAnotherRecord,type:"hm",hm:e,_cn:`${e._tn}List`}))),...(this.ctx.belongsTo||[]).map((e=>({uidt:n.UITypes.LinkToAnotherRecord,type:"bt",bt:e,_cn:`${e._rtn}Read`})))],i=(null===(t=null===(e=this.ctx)||void 0===e?void 0:e.oldMeta)||void 0===t?void 0:t.v)||[];for(const e of i)(e.lk||e.rl||e.formula)&&a.push(e);return a}mapDefaultDisplayValue(e){(0,o.default)(e)}}t.default=r},60854:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(40258)),s=i(a(12239)),o=i(a(31097)),r=i(a(60780)),l=i(a(63661)),c=i(a(9845));t.default=class{static create(e,t){if("mysql2"===e.client||"mysql"===e.client)return new s.default(t);if("sqlite3"===e.client)return new l.default(t);if("mssql"===e.client)return new n.default(t);if("pg"===e.client)return new r.default(t);if("oracledb"===e.client)return new o.default(t);if("snowflake"===e.client)return new c.default(t);throw new Error("Database not supported")}}},40258:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(16412));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this._renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this._renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this._renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_renderXcHasMany(e){return JSON.stringify(e.hasMany)}_renderXcBelongsTo(e){return JSON.stringify(e.belongsTo)}_renderXcColumns(e){let t="[\r\n";for(let a=0;a<e.columns.length;++a)t+="{\r\n",t+=`cn: '${e.columns[a].cn}',\r\n`,t+=`type: '${this._getAbstractType(e.columns[a])}',\r\n`,t+=`dt: '${e.columns[a].dt}',\r\n`,e.columns[a].rqd&&(t+=`rqd: ${e.columns[a].rqd},\r\n`),e.columns[a].cdf&&(t+=`default: "${e.columns[a].cdf}",\r\n`,t+=`columnDefault: "${e.columns[a].cdf}",\r\n`),e.columns[a].un&&(t+=`un: ${e.columns[a].un},\r\n`),e.columns[a].pk&&(t+=`pk: ${e.columns[a].pk},\r\n`),e.columns[a].ai&&(t+=`ai: ${e.columns[a].ai},\r\n`),e.columns[a].dtxp&&(t+=`dtxp: "${e.columns[a].dtxp}",\r\n`),e.columns[a].dtxs&&(t+=`dtxs: ${e.columns[a].dtxs},\r\n`),t+="validate: {\n                func: [],\n                args: [],\n                msg: []\n              },",t+="},\r\n";return t+="]\r\n",t}_getAbstractType(e){let t="";switch(e.dt){case"bigint":t="bigInteger";break;case"binary":case"varbinary":t="binary";break;case"bit":t="bit";break;case"char":case"nchar":case"nvarchar":case"varchar":t="string";break;case"date":t="date";break;case"datetime":case"datetime2":case"smalldatetime":t="datetime";break;case"datetimeoffset":t="datetimeoffset";break;case"decimal":t="decimal";break;case"float":case"real":t="float";break;case"geography":t="geography";break;case"geometry":t="geometry";break;case"heirarchyid":t="heirarchyid";break;case"image":t="image";break;case"int":case"smallint":case"tinyint":t="integer";break;case"money":t="money";break;case"ntext":case"text":t="text";break;case"numeric":t="numeric";break;case"json":t="json";break;case"smallmoney":t="smallmoney";break;case"sql_variant":t="sql_variant";break;case"sysname":t="sysname";break;case"time":t="time";break;case"timestamp":t="timestamp";break;case"uniqueidentifier":t="uniqueidentifier";break;case"xml":t="xml";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){const t=(e.dt||e.dt).toLowerCase();switch(t){case"bigint":case"smallint":case"bit":case"tinyint":case"int":return"integer";case"binary":case"char":case"geography":case"heirarchyid":case"image":case"money":case"nchar":case"nvarchar":case"varchar":return"string";case"date":return"date";case"datetime":case"datetime2":case"smalldatetime":case"datetimeoffset":return"datetime";case"decimal":case"float":case"numeric":case"real":return"float";case"geometry":return"geometry";case"ntext":case"text":return"text";case"json":return"json";case"smallmoney":case"sql_variant":case"sysname":case"uniqueidentifier":case"varbinary":case"xml":return t;case"time":return"time";case"timestamp":return"timestamp"}}}t.default=s},12239:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(16412));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this._renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this._renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this._renderXcBelongsTo.bind(this),args:{dbType:this.ctx.dbType,tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_renderXcHasMany(e){return JSON.stringify(e.hasMany)}_renderXcBelongsTo(e){return JSON.stringify(e.belongsTo)}_renderXcColumns(e){let t="[\r\n";for(let a=0;a<e.columns.length;++a)t+="{\r\n",t+=`cn: '${e.columns[a].cn}',\r\n`,t+=`type: '${this._getAbstractType(e.columns[a])}',\r\n`,t+=`dt: '${e.columns[a].dt}',\r\n`,e.columns[a].rqd&&(t+=`rqd: ${e.columns[a].rqd},\r\n`),e.columns[a].cdf&&(t+=`default: "${e.columns[a].cdf}",\r\n`,t+=`columnDefault: "${e.columns[a].cdf}",\r\n`),e.columns[a].un&&(t+=`un: ${e.columns[a].un},\r\n`),e.columns[a].pk&&(t+=`pk: ${e.columns[a].pk},\r\n`),e.columns[a].ai&&(t+=`ai: ${e.columns[a].ai},\r\n`),e.columns[a].dtxp&&(t+=`dtxp: "${e.columns[a].dtxp}",\r\n`),e.columns[a].dtxs&&(t+=`dtxs: ${e.columns[a].dtxs},\r\n`),t+="validate: {\n                func: [],\n                args: [],\n                msg: []\n              },",t+="},\r\n";return t+="]\r\n",t}_getAbstractType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t="integer";break;case"bigint":t="bigInteger";break;case"float":t="float";break;case"decimal":t="decimal";break;case"double":t="double";break;case"real":t="real";break;case"bit":case"boolean":t="boolean";break;case"serial":t="serial";break;case"date":t="date";break;case"datetime":t="datetime";break;case"timestamp":t="timestamp";break;case"time":t="time";break;case"year":t="year";break;case"char":case"varchar":case"nchar":t="string";break;case"text":case"tinytext":case"mediumtext":case"longtext":t="text";break;case"binary":case"varbinary":t="binary";break;case"blob":t="blob";break;case"tinyblob":t="tinyblob";break;case"mediumblob":t="mediumblob";break;case"longblob":t="longblob";break;case"enum":t="enum";break;case"set":t="set";break;case"geometry":t="geometry";break;case"point":t="point";break;case"linestring":t="linestring";break;case"polygon":t="polygon";break;case"multipoint":t="multipoint";break;case"multilinestring":t="multilinestring";break;case"multipolygon":t="multipolygon";break;case"json":t="json";break;default:t+=`"${e.dt}"`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){switch((e.dt||e.dt).toLowerCase()){case"int":case"smallint":case"mediumint":case"bigint":case"bit":return"integer";case"boolean":return"boolean";case"float":case"decimal":case"double":case"serial":return"float";case"tinyint":return"1"==e.dtxp?"boolean":"integer";case"date":return"date";case"datetime":case"timestamp":return"datetime";case"time":return"time";case"year":return"year";case"char":case"varchar":case"nchar":case"binary":return"string";case"text":case"tinytext":case"mediumtext":case"longtext":case"varbinary":return"text";case"blob":case"tinyblob":case"mediumblob":case"longblob":return"blob";case"enum":return"enum";case"set":return"set";case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":return"geometry";case"json":return"json"}}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=s},31097:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(16412));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this._renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this._renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this._renderXcBelongsTo.bind(this),args:{dbType:this.ctx.dbType,tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_renderXcHasMany(e){return JSON.stringify(e.hasMany)}_renderXcBelongsTo(e){return JSON.stringify(e.belongsTo)}_renderXcColumns(e){let t="[\r\n";for(let a=0;a<e.columns.length;++a)t+="{\r\n",t+=`cn: '${e.columns[a].cn}',\r\n`,t+=`type: '${this._getAbstractType(e.columns[a])}',\r\n`,t+=`dt: '${e.columns[a].dt}',\r\n`,e.columns[a].rqd&&(t+=`rqd: ${e.columns[a].rqd},\r\n`),e.columns[a].cdf&&(t+=`default: "${e.columns[a].cdf}",\r\n`,t+=`columnDefault: "${e.columns[a].cdf}",\r\n`),e.columns[a].un&&(t+=`un: ${e.columns[a].un},\r\n`),e.columns[a].pk&&(t+=`pk: ${e.columns[a].pk},\r\n`),e.columns[a].ai&&(t+=`ai: ${e.columns[a].ai},\r\n`),e.columns[a].dtxp&&(t+=`dtxp: "${e.columns[a].dtxp}",\r\n`),e.columns[a].dtxs&&(t+=`dtxs: ${e.columns[a].dtxs},\r\n`),t+="validate: {\n                func: [],\n                args: [],\n                msg: []\n              },",t+="},\r\n";return t+="]\r\n",t}_getAbstractType(e){let t="";switch(e.dt){case"char":case"nchar":case"nvarchar2":case"varchar2":case"long":case"raw":case"long raw":case"interval year to month":case"interval day to second":case"clob":case"nclob":t="string";break;case"number":case"numeric":case"float":case"dec":case"decimal":case"real":case"double precision":t="float";break;case"integer":case"int":case"smallint":t="integer";break;case"date":t="date";break;case"timestamp":case"timestamp with time zone":case"timestamp with local time zone":t="timestamp";break;case"bfile":case"blob":t="blob";break;case"rowid":case"urowid":t="bigInteger";break;default:t+=`"${e.dt}"`}return t}getAbstractType(e){switch((e.dt||e.dt).toLowerCase()){case"integer":case"long":case"smallint":return"integer";case"bfile":case"binary rowid":case"binary double":case"binary_float":case"canoical":case"cfile":case"char":case"clob":case"content pointer":case"contigous array":case"interval day to second":case"interval year to month":case"lob pointer":case"long raw":case"named collection":case"named object":case"nchar":case"nclob":case"nvarchar2":case"oid":case"pointer":case"raw":case"ref":case"ref cursor":case"rowid":case"signed binary integer":case"table":case"unsigned binary integer":case"urowid":case"varchar":case"varchar2":case"varray":case"varying array":return"string";case"blob":return"blob";case"date":return"date";case"decimal":case"double precision":case"float":case"real":case"number":return"float";case"time":case"time with tz":return"time";case"timestamp":case"timestamp with local time zone":case"timestamp with local tz":case"timestamp with timezone":case"timestamp with tz":return"datetime"}}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":return"LongText";case"blob":return"Attachment";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON"}}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=s},60780:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(16412));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this._renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this._renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this._renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_renderXcHasMany(e){return JSON.stringify(e.hasMany)}_renderXcBelongsTo(e){return JSON.stringify(e.belongsTo)}_renderXcColumns(e){let t="[\r\n";for(let a=0;a<e.columns.length;++a)t+="{\r\n",t+=`cn: '${e.columns[a].cn}',\r\n`,t+=`type: '${this._getAbstractType(e.columns[a])}',\r\n`,t+=`dt: '${e.columns[a].dt}',\r\n`,e.columns[a].rqd&&(t+=`rqd: ${e.columns[a].rqd},\r\n`),e.columns[a].cdf&&(t+=`default: "${e.columns[a].cdf}",\r\n`,t+=`columnDefault: "${e.columns[a].cdf}",\r\n`),e.columns[a].un&&(t+=`un: ${e.columns[a].un},\r\n`),e.columns[a].pk&&(t+=`pk: ${e.columns[a].pk},\r\n`),e.columns[a].ai&&(t+=`ai: ${e.columns[a].ai},\r\n`),e.columns[a].dtxp&&(t+=`dtxp: "${e.columns[a].dtxp}",\r\n`),e.columns[a].dtxs&&(t+=`dtxs: ${e.columns[a].dtxs},\r\n`),t+="validate: {\n                func: [],\n                args: [],\n                msg: []\n              },",t+="},\r\n";return t+="]\r\n",t}_getAbstractType(e){let t="";switch(e.dt){case"int":case"integer":case"int2":case"int4":case"int8":case"smallint":t="integer";break;case"bigint":t="bigInteger";break;case"bigserial":t="bigserial";break;case"char":case"character":case"character varying":t="string";break;case"int4range":t="int4range";break;case"int8range":t="int8range";break;case"serial":t="serial";break;case"serial2":t="serial2";break;case"serial8":t="serial8";break;case"bit":t="bit";break;case"bool":case"boolean":t="boolean";break;case"date":t="date";break;case"double precision":t="double";break;case"event_trigger":t="event_trigger";break;case"fdw_handler":t="fdw_handler";break;case"float4":case"float8":case"real":case"money":t="float";break;case"uuid":t="uuid";break;case"smallserial":t="smallserial";break;case"text":t="text";break;case"time":case"time without time zone":case"timetz":case"time with time zone":t="time";break;case"timestamp":case"timestamp without time zone":case"timestamp with time zone":t="timestamp";break;case"timestamptz":t="timestampt";break;case"daterange":t="daterange";break;case"json":t="json";break;case"jsonb":t="jsonb";break;case"gtsvector":t="gtsvector";break;case"index_am_handler":t="index_am_handler";break;case"anyenum":t="enum";break;case"anynonarray":t="anynonarray";break;case"anyrange":t="anyrange";break;case"box":t="box";break;case"bpchar":t="bpchar";break;case"bytea":t="bytea";break;case"cid":t="cid";break;case"cidr":t="cidr";break;case"circle":t="circle";break;case"cstring":t="cstring";break;case"inet":t="inet";break;case"internal":t="internal";break;case"interval":t="interval";break;case"language_handler":t="language_handler";break;case"line":t="line";break;case"lsec":t="lsec";break;case"macaddr":t="macaddr";break;case"name":t="name";break;case"numeric":t="numeric";break;case"numrange":t="numrange";break;case"oid":t="oid";break;case"opaque":t="opaque";break;case"path":t="path";break;case"pg_ddl_command":t="pg_ddl_command";break;case"pg_lsn":t="pg_lsn";break;case"pg_node_tree":t="pg_node_tree";break;case"point":t="point";break;case"polygon":t="polygon";break;case"record":t="record";break;case"refcursor":t="refcursor";break;case"regclass":t="regclass";break;case"regconfig":t="regconfig";break;case"regdictionary":t="regdictionary";break;case"regnamespace":t="regnamespace";break;case"regoper":t="regoper";break;case"regoperator":t="regoperator";break;case"regproc":t="regproc";break;case"regpreocedure":t="regpreocedure";break;case"regrole":t="regrole";break;case"regtype":t="regtype";break;case"reltime":t="reltime";break;case"smgr":t="smgr";break;case"tid":t="tid";break;case"tinterval":t="tinterval";break;case"trigger":t="trigger";break;case"tsm_handler":t="tsm_handler";break;case"tsquery":t="tsquery";break;case"tsrange":t="tsrange";break;case"tstzrange":t="tstzrange";break;case"tsvector":t="tsvector";break;case"txid_snapshot":t="txid_snapshot";break;case"unknown":t="unknown";break;case"void":t="void";break;case"xid":t="xid";break;case"xml":t="xml";break;default:t+=`"${e.dt}"`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){const t=e.dt.toLowerCase();switch(t){case"anyenum":case"enum":return"enum";case"anynonarray":case"anyrange":case"bpchar":case"bytea":case"cid":case"cidr":case"cstring":case"event_trigger":case"fdw_handler":case"gtsvector":case"index_am_handler":case"inet":case"language_handler":case"lsec":case"macaddr":case"money":case"name":case"numeric":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"smgr":case"tid":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"xml":return t;case"bit":case"bigint":case"bigserial":case"int":case"int2":case"int4":case"int8":case"integer":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":case"tinyint":case"mediumint":return"integer";case"bool":case"boolean":return"boolean";case"char":case"character":case"character varying":case"daterange":case"double precision":case"int4range":case"int8range":case"internal":case"interval":case"uuid":case"year":case"varchar":case"nchar":return"string";case"date":return"date";case"float4":case"float8":case"real":case"float":case"decimal":case"double":return"float";case"json":case"jsonb":return"json";case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":return"text";case"time":case"time without time zone":case"timetz":case"time with time zone":return"time";case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"datetime":return"datetime";case"blob":case"tinyblob":case"mediumblob":case"longblob":return"blob";case"set":return"set";case"line":case"point":case"polygon":case"circle":case"box":case"geometry":case"linestring":case"multipoint":case"multilinestring":case"multipolygon":return"geometry"}}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=s},9845:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(16412));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this._renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this._renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this._renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_renderXcHasMany(e){return JSON.stringify(e.hasMany)}_renderXcBelongsTo(e){return JSON.stringify(e.belongsTo)}_renderXcColumns(e){let t="[\r\n";for(let a=0;a<e.columns.length;++a)t+="{\r\n",t+=`cn: '${e.columns[a].cn}',\r\n`,t+=`type: '${this._getAbstractType(e.columns[a])}',\r\n`,t+=`dt: '${e.columns[a].dt}',\r\n`,e.columns[a].rqd&&(t+=`rqd: ${e.columns[a].rqd},\r\n`),e.columns[a].cdf&&(t+=`default: "${e.columns[a].cdf}",\r\n`,t+=`columnDefault: "${e.columns[a].cdf}",\r\n`),e.columns[a].un&&(t+=`un: ${e.columns[a].un},\r\n`),e.columns[a].pk&&(t+=`pk: ${e.columns[a].pk},\r\n`),e.columns[a].ai&&(t+=`ai: ${e.columns[a].ai},\r\n`),e.columns[a].dtxp&&(t+=`dtxp: "${e.columns[a].dtxp}",\r\n`),e.columns[a].dtxs&&(t+=`dtxs: ${e.columns[a].dtxs},\r\n`),t+="validate: {\n                func: [],\n                args: [],\n                msg: []\n              },",t+="},\r\n";return t+="]\r\n",t}_getAbstractType(e){let t="";switch(e.dt){case"int":case"integer":case"int2":case"int4":case"int8":case"smallint":t="integer";break;case"bigint":t="bigInteger";break;case"bigserial":t="bigserial";break;case"char":case"character":case"character varying":t="string";break;case"int4range":t="int4range";break;case"int8range":t="int8range";break;case"serial":t="serial";break;case"serial2":t="serial2";break;case"serial8":t="serial8";break;case"bit":t="bit";break;case"bool":case"boolean":t="boolean";break;case"date":t="date";break;case"double precision":t="double";break;case"event_trigger":t="event_trigger";break;case"fdw_handler":t="fdw_handler";break;case"float4":case"float8":case"real":case"money":t="float";break;case"uuid":t="uuid";break;case"smallserial":t="smallserial";break;case"text":t="text";break;case"time":case"time without time zone":case"timetz":case"time with time zone":t="time";break;case"timestamp":case"timestamp without time zone":case"timestamp with time zone":t="timestamp";break;case"timestamptz":t="timestampt";break;case"daterange":t="daterange";break;case"json":t="json";break;case"jsonb":t="jsonb";break;case"gtsvector":t="gtsvector";break;case"index_am_handler":t="index_am_handler";break;case"anyenum":t="enum";break;case"anynonarray":t="anynonarray";break;case"anyrange":t="anyrange";break;case"box":t="box";break;case"bpchar":t="bpchar";break;case"bytea":t="bytea";break;case"cid":t="cid";break;case"cidr":t="cidr";break;case"circle":t="circle";break;case"cstring":t="cstring";break;case"inet":t="inet";break;case"internal":t="internal";break;case"interval":t="interval";break;case"language_handler":t="language_handler";break;case"line":t="line";break;case"lsec":t="lsec";break;case"macaddr":t="macaddr";break;case"name":t="name";break;case"numeric":t="numeric";break;case"numrange":t="numrange";break;case"oid":t="oid";break;case"opaque":t="opaque";break;case"path":t="path";break;case"pg_ddl_command":t="pg_ddl_command";break;case"pg_lsn":t="pg_lsn";break;case"pg_node_tree":t="pg_node_tree";break;case"point":t="point";break;case"polygon":t="polygon";break;case"record":t="record";break;case"refcursor":t="refcursor";break;case"regclass":t="regclass";break;case"regconfig":t="regconfig";break;case"regdictionary":t="regdictionary";break;case"regnamespace":t="regnamespace";break;case"regoper":t="regoper";break;case"regoperator":t="regoperator";break;case"regproc":t="regproc";break;case"regpreocedure":t="regpreocedure";break;case"regrole":t="regrole";break;case"regtype":t="regtype";break;case"reltime":t="reltime";break;case"smgr":t="smgr";break;case"tid":t="tid";break;case"tinterval":t="tinterval";break;case"trigger":t="trigger";break;case"tsm_handler":t="tsm_handler";break;case"tsquery":t="tsquery";break;case"tsrange":t="tsrange";break;case"tstzrange":t="tstzrange";break;case"tsvector":t="tsvector";break;case"txid_snapshot":t="txid_snapshot";break;case"unknown":t="unknown";break;case"void":t="void";break;case"xid":t="xid";break;case"xml":t="xml";break;default:t+=`"${e.dt}"`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"json":return"JSON";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){const t=e.dt.toLowerCase();switch(t){case"anyenum":case"enum":return"enum";case"anynonarray":case"anyrange":case"bpchar":case"bytea":case"cid":case"cidr":case"cstring":case"event_trigger":case"fdw_handler":case"gtsvector":case"index_am_handler":case"inet":case"language_handler":case"lsec":case"macaddr":case"money":case"name":case"numeric":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"smgr":case"tid":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"xml":return t;case"bit":case"bigint":case"bigserial":case"int":case"int2":case"int4":case"int8":case"integer":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":case"tinyint":case"mediumint":return"integer";case"bool":case"boolean":return"boolean";case"char":case"character":case"character varying":case"daterange":case"double precision":case"int4range":case"int8range":case"internal":case"interval":case"uuid":case"year":case"varchar":case"nchar":return"string";case"date":return"date";case"float4":case"float8":case"real":case"float":case"decimal":case"double":return"float";case"json":case"jsonb":return"json";case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":return"text";case"time":case"time without time zone":case"timetz":case"time with time zone":return"time";case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"datetime":return"datetime";case"blob":case"tinyblob":case"mediumblob":case"longblob":return"blob";case"set":return"set";case"line":case"point":case"polygon":case"circle":case"box":case"geometry":case"linestring":case"multipoint":case"multilinestring":case"multipolygon":return"geometry"}}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}}t.default=s},63661:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(16412));class s extends n.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){const e={};return e.tn=this.ctx.tn,e.dbType=this.ctx.dbType,e.columns={func:this._renderXcColumns.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations}},e.hasMany={func:this._renderXcHasMany.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,hasMany:this.ctx.hasMany}},e.belongsTo={func:this._renderXcBelongsTo.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,belongsTo:this.ctx.belongsTo}},e}_renderXcHasMany(e){return JSON.stringify(e.hasMany)}_renderXcBelongsTo(e){return JSON.stringify(e.belongsTo)}_renderXcColumns(e){let t="[\r\n";for(let a=0;a<e.columns.length;++a)t+="{\r\n",t+=`cn: '${e.columns[a].cn}',\r\n`,t+=`type: '${this._getAbstractType(e.columns[a])}',\r\n`,t+=`dt: '${e.columns[a].dt}',\r\n`,e.columns[a].rqd&&(t+=`rqd: ${e.columns[a].rqd},\r\n`),e.columns[a].cdf&&(t+=`default: "${e.columns[a].cdf}",\r\n`,t+=`columnDefault: "${e.columns[a].cdf}",\r\n`),e.columns[a].un&&(t+=`un: ${e.columns[a].un},\r\n`),e.columns[a].pk&&(t+=`pk: ${e.columns[a].pk},\r\n`),e.columns[a].ai&&(t+=`ai: ${e.columns[a].ai},\r\n`),e.columns[a].dtxp&&(t+=`dtxp: "${e.columns[a].dtxp}",\r\n`),e.columns[a].dtxs&&(t+=`dtxs: ${e.columns[a].dtxs},\r\n`),t+="validate: {\n                func: [],\n                args: [],\n                msg: []\n              },",t+="},\r\n";return t+="]\r\n",t}_getAbstractType(e){let t="";switch(e.dt){case"int":case"integer":case"tinyint":case"smallint":case"mediumint":case"int2":case"int8":t="integer";break;case"bigint":t="bigInteger";break;case"character":case"varchar":t="string";break;case"blob sub_type text":case"text":t="text";break;case"numeric":case"real":case"float":t="float";break;case"blob":t="blob";break;case"double":case"double precision":t="decimal";break;case"boolean":t="boolean";break;case"date":t="date";break;case"datetime":t="datetime";break;case"timestamp":t="timestamp";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetType(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":t+=`DataTypes.INTEGER(${e.dtxp})`,e.un&&(t+=".UNSIGNED");break;case"bigint":t+="DataTypes.BIGINT",e.un&&(t+=".UNSIGNED");break;case"float":case"real":t+="DataTypes.FLOAT";break;case"decimal":t+="DataTypes.DECIMAL";break;case"double":t+=`"DOUBLE(${e.dtxp},${e.ns})"`;break;case"bit":t+="DataTypes.BOOLEAN";break;case"boolean":t+="DataTypes.STRING(45)";break;case"serial":t+="DataTypes.BIGINT";break;case"date":t+="DataTypes.DATEONLY";break;case"datetime":case"timestamp":t+="DataTypes.DATE";break;case"time":t+="DataTypes.TIME";break;case"year":t+='"YEAR"';break;case"char":case"nchar":t+=`DataTypes.CHAR(${e.dtxp})`;break;case"varchar":t+=`DataTypes.STRING(${e.dtxp})`;break;case"text":case"tinytext":case"mediumtext":case"longtext":t+="DataTypes.TEXT";break;case"binary":t+=`"BINARY(${e.dtxp})"`;break;case"varbinary":t+=`"VARBINARY(${e.dtxp})"`;break;case"blob":t+='"BLOB"';break;case"tinyblob":t+='"TINYBLOB"';break;case"mediumblob":t+='"MEDIUMBLOB"';break;case"longblob":t+='"LONGBLOB"';break;case"enum":t+=`DataTypes.ENUM(${e.dtxp})`;break;case"set":t+=`"SET(${e.dtxp})"`;break;case"geometry":t+="DataTypes.GEOMETRY";break;case"point":t+='"POINT"';break;case"linestring":t+='"LINESTRING"';break;case"polygon":t+='"POLYGON"';break;case"multipoint":t+='"MULTIPOINT"';break;case"multilinestring":t+='"MULTILINESTRING"';break;case"multipolygon":t+='"MULTIPOLYGON"';break;case"json":t+="DataTypes.JSON";break;default:t+=`"${e.dt}"`}return t}_sequelizeGetDefault(e){let t="";switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"float":case"decimal":case"double":case"real":case"time":case"year":case"char":case"varchar":case"nchar":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":t+=`'${e.cdf}'`;break;case"bit":t+=e.cdf?e.cdf.split("b")[1]:e.cdf;break;case"boolean":case"serial":case"text":case"tinytext":case"mediumtext":case"longtext":case"binary":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"json":t+=e.cdf;break;case"date":case"datetime":case"timestamp":t+=`sequelize.literal('${e.cdf_sequelize}')`}return t}getUIDataType(e){switch(this.getAbstractType(e)){case"integer":return"Number";case"boolean":return"Checkbox";case"float":return"Decimal";case"date":return"Date";case"datetime":return"DateTime";case"time":return"Time";case"year":return"Year";case"string":return"SingleLineText";case"text":case"json":case"blob":return"LongText";case"enum":return"SingleSelect";case"set":return"MultiSelect";case"geometry":return"Geometry";default:return"SpecificDBType"}}getAbstractType(e){var t;switch(null===(t=e.dt)||void 0===t?void 0:t.replace(/\(\d+\)$/,"").toLowerCase()){case"date":return"date";case"datetime":case"timestamp":return"datetime";case"integer":case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"int2":case"int8":return"integer";case"text":return"text";case"boolean":return"boolean";case"real":case"double":case"double precision":case"float":case"numeric":return"float";case"blob sub_type text":case"blob":return"blob";case"character":case"varchar":return"string"}}}t.default=s},82231:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class a{static setSwaggerType(e,t,i="mysql"){switch(i){case"mysql":case"mysql2":case"mariadb":a.setSwaggerTypeForMysql(e,t);break;case"pg":a.setSwaggerTypeForPg(e,t);break;case"mssql":a.setSwaggerTypeForMssql(e,t);break;case"sqlite3":a.setSwaggerTypeForSqlite(e,t)}}static setSwaggerTypeForMysql(e,t){switch(e.dt){case"int":case"tinyint":case"smallint":case"mediumint":case"bigint":case"bit":t.type="integer";break;case"float":case"decimal":case"real":t.type="number";break;case"double":t.type="number",t.format="double";break;case"boolean":t.type="boolean";break;case"serial":case"date":case"datetime":case"timestamp":case"time":case"year":case"char":case"varchar":case"nchar":case"text":case"tinytext":case"mediumtext":case"longtext":case"varbinary":case"blob":case"tinyblob":case"mediumblob":case"longblob":case"enum":case"set":case"geometry":case"point":case"linestring":case"polygon":case"multipoint":case"multilinestring":case"multipolygon":default:t.type="string";break;case"binary":t.type="string",t.format="binary";break;case"json":t.type="object"}}static setSwaggerTypeForPg(e,t){switch(e.dt){case"int":case"integer":case"bigint":case"bigserial":case"int2":case"int4":case"int8":case"int4range":case"int8range":case"serial":case"serial2":case"serial8":case"smallint":case"smallserial":t.type="integer";break;case"char":case"character":case"bit":case"date":case"character varying":case"text":case"time":case"time without time zone":case"timestamp":case"timestamp without time zone":case"timestamptz":case"timestamp with time zone":case"timetz":case"time with time zone":case"daterange":case"gtsvector":case"index_am_handler":case"anyenum":case"anynonarray":case"anyrange":case"box":case"bpchar":case"bytea":case"cid":case"cidr":case"circle":case"cstring":case"inet":case"internal":case"interval":case"language_handler":case"line":case"lsec":case"macaddr":case"money":case"name":case"numrange":case"oid":case"opaque":case"path":case"pg_ddl_command":case"pg_lsn":case"pg_node_tree":case"point":case"polygon":case"record":case"refcursor":case"regclass":case"regconfig":case"regdictionary":case"regnamespace":case"regoper":case"regoperator":case"regproc":case"regpreocedure":case"regrole":case"regtype":case"reltime":case"smgr":case"tid":case"tinterval":case"trigger":case"tsm_handler":case"tsquery":case"tsrange":case"tstzrange":case"tsvector":case"txid_snapshot":case"unknown":case"void":case"xid":case"xml":default:t.type="string";break;case"bool":case"boolean":t.type="boolean";break;case"double precision":t.type="number",t.format="double";break;case"event_trigger":case"fdw_handler":case"float4":case"float8":case"real":case"numeric":t.type="number",t.format="float";break;case"uuid":t.type="string",t.format="uuid";break;case"json":case"jsonb":t.type="object"}}static setSwaggerTypeForMssql(e,t){switch(e.dt){case"bigint":case"int":case"tinyint":case"smallint":case"bit":t.type="integer";break;case"binary":t.type="string",t.format="binary";break;case"char":case"date":case"datetime":case"datetime2":case"datetimeoffset":case"geography":case"geometry":case"heirarchyid":case"image":case"money":case"nchar":case"ntext":case"nvarchar":case"smalldatetime":case"smallmoney":case"sql_variant":case"sysname":case"text":case"time":case"timestamp":case"uniqueidentifier":case"varbinary":case"xml":case"varchar":default:t.type="string";break;case"decimal":case"float":case"numeric":case"real":t.type="number",t.format="float";break;case"json":t.type="object"}}static setSwaggerTypeForSqlite(e,t){switch(e.dt){case"int":case"integer":case"tinyint":case"smallint":case"mediumint":case"bigint":case"int2":case"int8":t.type="integer";break;case"character":case"numeric":case"real":case"float":t.type="number";break;case"double":case"double precision":t.type="number",t.format="double";break;case"boolean":t.type="boolean";break;default:t.type="string"}}}t.default=a},2211:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(98577)),s=i(a(82231));class o extends n.default{constructor({dir:e="",filename:t="",ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){let e={};return e=this.ctx,e.paths={},e.definitions={func:this._renderDefinitions.bind(this),args:{tn:this.ctx.tn,columns:this.ctx.columns,relations:this.ctx.relations,dbType:this.ctx.dbType}},e}_renderDefinitions(e){const t=this.getDefenitions(e);return JSON.stringify(t)}getDefenitions(e){var t,a,i,n,o,r,l;const c={[e._tn]:{type:"object",properties:{}},[`${e._tn}Nested`]:{type:"object",properties:{}}};let d=c[e._tn].properties;for(const t of e.columns){const a={};s.default.setSwaggerType(t,a,e.dbType),t.rqd&&(a.nullable=!1),t.ai&&(a.readOnly=!0),d[t._cn]=a}d=Object.assign(c[`${e._tn}Nested`].properties,d);for(const s of e.v||[]){const e={readOnly:!0};let c=s._cn;s.mm?(e.type="array",e.items={$ref:`#/definitions/${null===(t=s.mm)||void 0===t?void 0:t._rtn}`},c=`${null===(a=s.mm)||void 0===a?void 0:a._rtn}MMList`):s.hm?(e.type="array",e.items={$ref:`#/definitions/${null===(i=s.hm)||void 0===i?void 0:i._tn}`},e.$ref=`#/definitions/${null===(n=s.hm)||void 0===n?void 0:n._tn}`,c=`${null===(o=s.hm)||void 0===o?void 0:o._tn}List`):s.bt&&(e.$ref=`#/definitions/${null===(r=s.bt)||void 0===r?void 0:r._rtn}`,c=`${null===(l=s.bt)||void 0===l?void 0:l._rtn}Read`),d[c]=e}return c}getObject(){return{tags:[{name:`${this.ctx._tn}`,description:`Everything about your ${this.ctx._tn}`}],paths:{[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}`]:{post:{tags:[`${this.ctx._tn}`],summary:`Add a new ${this.ctx._tn}`,description:"",operationId:`add${this.ctx._tn}`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"body",name:"body",description:`${this.ctx._tn} object that needs to add`,required:!0,schema:{$ref:`#/definitions/${this.ctx._tn}`}}],responses:{405:{description:"Invalid input"}}},get:{tags:[`${this.ctx._tn}`],summary:"Get list",description:"",operationId:`get${this.ctx._tn}`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"query",name:"fields",type:"string",description:"Comma separated fields from the model"},{in:"query",name:"bt",type:"string",description:"Comma separated parent table names(Belongs To)"},{in:"query",name:"hm",type:"string",description:"Comma separated child table names(Has Many)"},{in:"query",name:"mm",type:"string",description:"Comma separated child table names(Many to Many)"},{in:"query",name:"where",type:"string",description:"Where expression"},{in:"query",name:"limit",description:"Page size limit",type:"integer",format:"int64"},{in:"query",name:"offset",description:"Pagination offset",type:"integer",format:"int64"},{in:"query",name:"sort",description:"Comma separated sort fields",type:"string"}],responses:{405:{description:"Invalid input"},200:{description:"successful operation",schema:{type:"array",items:{$ref:`#/definitions/${this.ctx._tn}Nested`}}}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/{${this.ctx._tn}Id}`]:{get:{tags:[`${this.ctx._tn}`],summary:`Find ${this.ctx._tn} by ID`,description:`Returns a single ${this.ctx._tn}`,operationId:`get${this.ctx._tn}ById`,produces:["application/json"],parameters:[{name:`${this.ctx._tn}Id`,in:"path",description:`ID of ${this.ctx._tn} to return. In case of composite key provide keys separated by ___`,required:!0,type:"string"},{in:"query",name:"bt",type:"string",description:"Comma separated parent table names(Belongs To)"},{in:"query",name:"hm",type:"string",description:"Comma separated child table names(Has Many)"},{in:"query",name:"mm",type:"string",description:"Comma separated child table names(Many to Many)"}],responses:{200:{description:"successful operation",schema:{$ref:`#/definitions/${this.ctx._tn}Nested`}},400:{description:"Invalid ID supplied"},404:{description:`${this.ctx._tn} not found`}}},put:{tags:[`${this.ctx._tn}`],summary:`Updates a ${this.ctx._tn}`,description:"",operationId:`update${this.ctx._tn}`,consumes:["application/json"],produces:["application/json"],parameters:[{name:`${this.ctx._tn}Id`,in:"path",description:`ID of ${this.ctx._tn} to return. In case of composite key provide keys separated by ___`,required:!0,type:"string"},{in:"body",name:"body",description:`${this.ctx._tn} object that needs to be added to the store`,required:!0,schema:{$ref:`#/definitions/${this.ctx._tn}`}}],responses:{405:{description:"Invalid input"}}},delete:{tags:[`${this.ctx._tn}`],summary:`Deletes a ${this.ctx._tn}`,description:"",operationId:`delete${this.ctx._tn}`,produces:["application/json"],parameters:[{name:`${this.ctx._tn}Id`,in:"path",description:`ID of ${this.ctx._tn} to return. In case of composite key provide keys separated by ___`,required:!0,type:"string"}],responses:{400:{description:"Invalid ID supplied"},404:{description:`${this.ctx._tn} not found`}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/bulk`]:{post:{tags:[`${this.ctx._tn}`],summary:`Bulk ${this.ctx._tn} insert`,description:"",operationId:`bulk${this.ctx._tn}Insert`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"body",name:"body",description:`${this.ctx._tn} objects`,required:!0,schema:{type:"array",items:{$ref:`#/definitions/${this.ctx._tn}`}}}],responses:{405:{description:"Invalid input"}}},put:{tags:[`${this.ctx._tn}`],summary:`Bulk ${this.ctx._tn} update`,description:"",operationId:`bulk${this.ctx._tn}Update`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"body",name:"body",description:`${this.ctx._tn} objects with id`,required:!0,schema:{type:"array",items:{$ref:`#/definitions/${this.ctx._tn}`}}}],responses:{405:{description:"Invalid input"}}},delete:{tags:[`${this.ctx._tn}`],summary:`Bulk ${this.ctx._tn} delete`,description:"",operationId:`bulk${this.ctx._tn}Delete`,produces:["application/json"],parameters:[{in:"body",name:"body",description:`${this.ctx._tn} objects contains id`,required:!0,schema:{type:"array",items:{$ref:`#/definitions/${this.ctx._tn}`}}}],responses:{400:{description:"Invalid ID supplied"},404:{description:`${this.ctx._tn} not found`}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/findOne`]:{get:{tags:[`${this.ctx._tn}`],summary:"Get first one from filtered data",description:"",operationId:`findOne${this.ctx._tn}`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"query",name:"fields",type:"string",description:"Comma separated fields from the model"},{in:"query",name:"where",type:"string",description:"Where expression"},{in:"query",name:"limit",description:"Page size limit",type:"integer",format:"int64"},{in:"query",name:"offset",description:"Pagination offset",type:"integer",format:"int64"},{in:"query",name:"sort",description:"Comma separated sort fields",type:"string"}],responses:{405:{description:"Invalid input"},200:{description:"successful operation",schema:{$ref:`#/definitions/${this.ctx._tn}`}}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/{${this.ctx._tn}Id}/exists`]:{get:{tags:[`${this.ctx._tn}`],summary:`Check ${this.ctx._tn} with provided ID exists`,description:`Returns a single ${this.ctx._tn}`,operationId:`check${this.ctx._tn}Exists`,produces:["application/json"],parameters:[{name:`${this.ctx._tn}Id`,in:"path",description:`ID of ${this.ctx._tn} to return. In case of composite key provide keys separated by ___`,required:!0,type:"string"}],responses:{200:{description:"successful operation",schema:{type:"boolean"}}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/count`]:{get:{tags:[`${this.ctx._tn}`],summary:`Get ${this.ctx._tn} count`,operationId:`get${this.ctx._tn}Count`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"query",name:"where",type:"string",description:"Where expression"}],responses:{405:{description:"Invalid input"},200:{description:"successful operation",schema:{type:"object"}}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/groupby`]:{get:{tags:[`${this.ctx._tn}`],summary:"Group by column",description:"",operationId:`${this.ctx._tn}GroupByColumn`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"query",name:"column_name",type:"string",description:"Column name"},{in:"query",name:"where",type:"string",description:"Where expression"},{in:"query",name:"limit",description:"Page size limit",type:"integer",format:"int64"},{in:"query",name:"offset",description:"Pagination offset",type:"integer",format:"int64"},{in:"query",name:"sort",description:"Comma separated sort fieldst",type:"string"}],responses:{405:{description:"Invalid input"},200:{description:"successful operation",schema:{$ref:`#/definitions/${this.ctx._tn}`}}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/distribution`]:{get:{tags:[`${this.ctx._tn}`],summary:"",description:"",operationId:`${this.ctx._tn}Distribution`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"query",name:"column_name",type:"string",description:"Column name"},{in:"query",name:"min",description:"min value",type:"integer",format:"int64"},{in:"query",name:"max",description:"max value",type:"integer",format:"int64"},{in:"query",name:"step",description:"step value",type:"integer",format:"int64"},{in:"query",name:"steps",description:"steps value",type:"integer",format:"int64"},{in:"query",name:"func",description:"comma separated aggregation functions",type:"string"}],responses:{405:{description:"Invalid input"},200:{description:"successful operation",schema:{type:"array",items:{type:"object"}}}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/distinct`]:{get:{tags:[`${this.ctx._tn}`],summary:"Get first one from filtered data",description:"",operationId:`${this.ctx._tn}Distinct`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"query",name:"column_name",type:"string",description:"Column name"},{in:"query",name:"where",type:"string",description:"Where expression"},{in:"query",name:"limit",description:"Page size limit",type:"integer",format:"int64"},{in:"query",name:"offset",description:"Pagination offset",type:"integer",format:"int64"},{in:"query",name:"sort",description:"Comma separated sort fields",type:"string"}],responses:{405:{description:"Invalid input"},200:{description:"successful operation",schema:{type:"array",items:{type:"object"}}}}}},[`/nc/${this.ctx.project_id}/api/${this.ctx.routeVersionLetter}/${this.ctx._tn}/aggregate`]:{get:{tags:[`${this.ctx._tn}`],summary:"Get first one from filtered data",description:"",operationId:`${this.ctx._tn}Aggregate`,consumes:["application/json"],produces:["application/json"],parameters:[{in:"query",name:"column_name",type:"string",description:"Column name"},{in:"query",name:"func",type:"string",description:"Comma separated aggregate functions"},{in:"query",name:"having",type:"string",description:"Having expression"},{in:"query",name:"fields",type:"string",description:"Comma separated fields from the model"},{in:"query",name:"limit",description:"Page size limit",type:"integer",format:"int64"},{in:"query",name:"offset",description:"Pagination offset",type:"integer",format:"int64"},{in:"query",name:"sort",description:"Comma separated sort fields",type:"string"}],responses:{405:{description:"Invalid input"},200:{description:"successful operation",schema:{$ref:`#/definitions/${this.ctx._tn}`}}}}}},definitions:this.getDefenitions(this.ctx)}}}t.default=o},52440:function(e,t,a){var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(a(98577));class o extends s.default{constructor({dir:e,filename:t,ctx:a}){super({dir:e,filename:t,ctx:a})}prepare(){let e={};return e=this.ctx,e}getObject(){const e=this.prepare(),t=[{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}`,type:"get",handler:["list"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.list(req.query);\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/findOne`,type:"get",handler:["findOne"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.findOne(req.query);\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/m2mNotChildren/:assoc/:pid`,type:"get",handler:["m2mNotChildren"],acl:{admin:!0,user:!0,guest:!0},functions:["\n                "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/groupby/:column_name`,type:"get",handler:["groupby"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.groupBy({\n      ...req.params,\n      ...req.query\n    });\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/count`,type:"get",handler:["count"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.countByPk({\n      ...req.query\n    });\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/bulk`,type:"post",handler:["bulkInsert"],acl:{admin:!0,user:!0,guest:!1},functions:["\nasync function(req, res){\n    const data = await req.model.insertb(req.body);\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/bulk`,type:"put",handler:["bulkUpdate"],acl:{admin:!0,user:!0,guest:!1},functions:["\nasync function(req, res){\n    const data = await req.model.updateb(req.body);\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/bulk`,type:"delete",handler:["bulkDelete"],acl:{admin:!0,user:!0,guest:!1},functions:["\nasync function(req, res){\n    const data = await req.model.delb(req.body)\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/:id/exists`,type:"get",handler:["exists"],acl:{admin:!0,user:!0,guest:!1},functions:["\nasync function(req, res){\n    const data = await req.model.exists(req.params.id);\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/distinct`,type:"get",handler:["distinct"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.distinct({\n      ...req.query\n    });\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/distribute`,type:"get",handler:["distribute"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.distribution({\n      ...req.query\n    });\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/aggregate`,type:"get",handler:["aggregate"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.aggregate({\n      ...req.params,\n      ...req.query\n    });\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/groupby`,type:"get",handler:["groupby"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.groupBy({\n      ...req.params,\n      ...req.query\n    });\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/:id`,type:"get",handler:["get"],acl:{admin:!0,user:!0,guest:!0},functions:["\nasync function(req, res){\n    const data = await req.model.readByPk(req.params.id);\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}`,type:"post",handler:["create"],acl:{admin:!0,user:!0,guest:!1},functions:["\nasync function(req, res){\n    const data = await req.model.insert(req.body, null, req);\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/:id`,type:"put",handler:["update"],acl:{admin:!0,user:!0,guest:!1},functions:["\nasync function(req, res){\n    const data = await req.model.updateByPk(req.params.id, req.body, null, req);\n    res.json(data);\n}\n        "]},{path:`/api/${this.ctx.routeVersionLetter}/${e._tn}/:id`,type:"delete",handler:["delete"],acl:{admin:!0,user:!0,guest:!1},functions:["\nasync function(req, res){\n    const data = await req.model.delByPk(req.params.id, null, req);\n    res.json(data);\n}\n        "]}];return"view"===this.ctx.type?t.filter((({type:e,handler:t})=>"get"===e&&!t.includes("exists")&&!t.includes("get"))):t}getObjectWithoutFunctions(){return this.getObject().map((e=>{var{functions:t}=e;return i(e,["functions"])}))}}t.default=o},58564:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(65813)),s=i(a(94720));class o{static getSqlMgr(e,t=null){return t?new n.default(e,t):(this.sqlMgrMap[e.id]||(this.sqlMgrMap[e.id]=new n.default(e)),this.sqlMgrMap[e.id])}static async getSqlMgrTrans(e,t,a){const i=new s.default(e,t,a);return await i.startTransaction(a),i}}t.default=o,o.sqlMgrMap={}},65813:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(47668)),s=i(a(22549)),o=i(a(10277)),r=i(a(19356)),l=new o.default("SqlMgr");t.default=class{constructor(e,t=null){l.api("constructor:args:",e),this._migrator=new s.default(e),this.ncMeta=t}async migrator(e){return this._migrator}static async testConnection(e={}){return(await n.default.create(e)).testConnection()}async sqlOp(e,t,a){const i=this.sqlOp.name;l.api(`${i}:args:`,e,t,a);const n=await this.getSqlClient(e);return await n[t](a)}async sqlOpPlus(e,t,a){var i;const n=this.sqlOpPlus.name;l.api(`${n}:args:`,e,t,a),(null===(i=e.getConfig())||void 0===i?void 0:i.schema)&&(a=Object.assign(Object.assign({},a),{schema:e.getConfig().schema}));const s=await this.getSqlClient(e);return await s[t](a)}async getSqlClient(e){return e.is_meta&&this.ncMeta?r.default.getSqlClient(e,this.ncMeta.knex):r.default.getSqlClient(e)}}},94720:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(71616)),s=i(a(65813)),o=i(a(19356));class r extends s.default{constructor(e,t,a){super(e),this.projectId=e.id,this.ncMeta=t,this.base=a}async migrator(){return new n.default({id:this.projectId},await this.getSqlClient(this.base),this.ncMeta)}async startTransaction(e){const t=await o.default.get(e);this.trx=await t.transaction()}async commit(){this.trx&&(await this.trx.commit(),this.trx=null)}async rollback(e){this.trx&&(await this.trx.rollback(e),this.trx=null)}async getSqlClient(e){return o.default.getSqlClient(e,this.trx)}async sqlOp(e,t,a){return super.sqlOp(e,t,a)}async sqlOpPlus(e,t,a){return super.sqlOpPlus(e,t,a)}}t.default=r},22549:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},o=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=r(a(57147)),c=r(a(71017)),d=a(16464),u=r(a(54230)),p=r(a(10277)),m=r(a(91774)),f=s(a(48852)),h=r(a(34032)),g=r(a(47668)),_=r(a(19356)),b=r(a(27552)),y=r(a(61770)),w=new m.default,v=new p.default("KnexMigrator"),T="nc_migrations";t.default=class{constructor(e){this.toolDir=process.cwd(),this.projectId=e.id}get metaDb(){return b.default.ncMeta.knex}async getProject(){return y.default.getWithInfo(this.projectId)}emit(e,t){v.api(e),w.evt.emit("UI",{status:0,data:`Migrator : ${e}`})}emitW(e,t){v.warn(e),w.evt.emit("UI",{status:1,data:e})}emitE(e,t){v.error(e),w.evt.emit("UI",{status:-1,data:e})}_getWorkingEnvDir(e){return c.default.join(this.toolDir,"nc",this.projectId,e.dbAlias,"migrations")}async _initAllEnvOnFilesystem(){for(const e of(await this.getProject()).bases)await this._initDbOnFs(e)}async _initDbOnFs(e){}async _initDbWithSql(e){var t;const a=await this.getSqlClient(e),i=await e.getConnectionConfig();"oracledb"===i.client?(this.emit(`${i.client}: Creating DB if not exists ${i.connection.user}`),await a.createDatabaseIfNotExists({database:i.connection.user})):e.isMeta(!0,1)&&"pg"===e.type?(this.emit(`${i.client}: Creating DB if not exists ${i.connection.database}`),await a.createDatabaseIfNotExists({database:i.connection.database,schema:null===(t=e.getConfig())||void 0===t?void 0:t.schema})):"sqlite3"!==i.client?(this.emit(`${i.client}: Creating DB if not exists ${i.connection.database}`),await a.createDatabaseIfNotExists({database:i.connection.database})):(this.emit(`${i.client}: Creating DB if not exists ${i.connection.connection.filename}`),await a.createDatabaseIfNotExists({database:i.connection.connection.filename}))}async getSqlClient(e){return _.default.getSqlClient(e)}async _cleanDbWithSql(e){const t=await g.default.create(e);"oracledb"===e.client?(this.emit(`Dropping DB : ${e.connection.user}`),await t.dropDatabase({database:e.connection.user})):"sqlite3"===e.client?(this.emit(`Dropping DB : ${e.connection.connection.filename}`),await t.dropDatabase({database:e.connection.connection.filename})):(this.emit(`Dropping DB : ${e.connection.database}`),await t.dropDatabase({database:e.connection.database}))}async _initEnvDbsWithSql(e){this.emit(`Initialising base: ${e.alias}`),await this._initDbWithSql(e)}async _migrationsUp(e){var{base:t}=e,a=o(e,["base"]);const i=new h.default;if(i.data.object={},i.data.object.list=[],process.env.NC_MIGRATIONS_DISABLED)return i;try{const{onlyList:e}=a;let n,s,{migrationSteps:o}=a;if(!o&&!a.file)return i.code=-1,i.message="Neither num of steps nor file is specified for migration",v.debug("Neither num of steps nor file is specified for migration"),v.debug("See help"),i;this.metaDb?s=n=await this.metaDb(T).where({project_id:this.projectId,db_alias:t.id}).orderBy("id","asc"):(n=await(0,d.promisify)(u.default)(a.upFilesPattern),s=await(0,d.promisify)(u.default)(a.downFilesPattern));const r=await this.getSqlClient(t);let c=await r.selectAll(r.getTnPath("nc_evolutions"));if(this.suffix&&(c=c.filter((e=>e.title.includes(this.suffix)))),n.length===c.length){this.emit(`Evolutions are upto date for ' env : ${t.alias} '`);for(let e=0;e<c.length;++e)i.data.object.list.push({title:c[e].title,titleDown:c[e].titleDown,status:!1});i.data.object.pending=n.length-c.length}else if(n.length>c.length||e){this.emit(`Number of evolutions pending for 'env:${t.alias}': '${n.length-c.length}'`),i.data.object.pending=n.length-c.length;let u=0;if(0!==c.length){const e=c[c.length-1];let t=0;for(;t<n.length;++t)if(this.metaDb){if(-1!==n[t].title.indexOf(e.title)){t++;break}}else if(-1!==n[t].indexOf(e.title)){t++;break}u=t}try{if(!o){let e=0;for(let t=u;t<n.length;++t)if(o++,this.metaDb){if(n[t].title.includes(a.file)){e=1;break}}else if(n[t].includes(a.file)){e=1;break}if(!e)return void v.debug(`Error : There is no file ${a.file} in migration directory`)}if(e)if(this.metaDb)for(let e=0;e<u;++e)i.data.object.list.push({title:n[e].title,titleDown:s[e].title_down,status:!1});else for(let e=0;e<u;++e){const t=n[e].split("/"),a=s[e].split("/");i.data.object.list.push({title:t[t.length-1],titleDown:a[t.length-1],status:!1})}const t=[],c=[];for(let r=u;r<n.length&&r<u+o;++r){let o,u;if(this.metaDb)o=n[r].title,u=n[r].title_down;else{const e=n[r].split("/");o=e[e.length-1];const t=s[r].split("/");u=t[t.length-1]}if(e)v.debug(o),i.data.object.list.push({title:o,titleDown:u,status:!0});else{let e;e=this.metaDb?n[r].up:await(0,d.promisify)(l.default.readFile)(n[r],"utf8"),a.sqlContentMigrate&&t.push(...e.split(/\/\*\s*xc[\s\S]*?\s*\*\//).filter((e=>e.trim()))),c.push({title:o,titleDown:u,status:0})}}if(e);else{const e=this,a=r.knex.isTransaction?r.knex:await r.knex.transaction();try{for(const i of t)await a.raw(i),e.emit(`'${i}' : Executed SQL query`);for(const t of c)await a(r.getTnPath("nc_evolutions")).insert(t),e.emit(`'${t.title}' : Updating bookkeeping of SQL UP migration - done`);r.knex.isTransaction||await a.commit()}catch(t){throw r.knex.isTransaction||await a.rollback(),e.emitW("Migration operation failed, Database restored to previous state"),v.ppe(t,""),t}}}catch(e){throw this.emitE(`Error while migrating up : ${e.code} and ${e.message}`),v.debug(e),e}}else i.data.object.pending=-1,this.emitE("Evolutions are dirty - reset the whole thing please")}catch(e){throw v.debug("Error in evolutionUp",e),i.code=-1,i.message=e.message,e}return i}async _migrationsDown(e){var{base:t}=e,a=o(e,["base"]);if(process.env.NC_MIGRATIONS_DISABLED)return;let{migrationSteps:i}=a;const{onlyList:n}=a;if(!i&&!a.file)return v.debug("Neither num of steps nor file is specified for migartion"),void v.debug("See help");a.onlyList?v.debug("Pending migration list:"):v.debug("Migrating Down:");try{let e;e=this.metaDb?await this.metaDb(T).where({project_id:this.projectId,db_alias:t.id}).orderBy("title","asc"):await(0,d.promisify)(u.default)(a.downFilesPattern);const s=await this.getSqlClient(t),o=await s.selectAll(s.getTnPath("nc_evolutions"));if(o.length)try{if(!i){let t=0;for(let n=o.length-1;n>=0;--n)if(i++,this.metaDb){if(e[n].title_down.includes(a.file)){t=1;break}}else if(e[n].includes(a.file)){t=1;break}if(!t)return void v.debug(`Error : There is no file ${a.file} in migration directory`)}const t=[],r=[];for(let s=o.length-1,c=0;s>=0&&c<i;--s,++c){let i;if(this.metaDb)i=e[s].title_down;else{const t=e[s].split("/");i=t[t.length-1]}if(n)v.debug(i);else{let n;this.emit(`Migrating Down: '${i}'`),n=this.metaDb?e[s].down:await(0,d.promisify)(l.default.readFile)(e[s],"utf8"),a.sqlContentMigrate&&t.push(...n.split(/\/\*\s*xc[\s\S]*?\s*\*\//).filter((e=>e.trim()))),r.push({titleDown:i})}}const c=this,u=s.knex.isTransaction?s.knex:await s.knex.transaction();try{for(const e of t)await u.raw(e).transacting(u),c.emit(`'${e}' : Executed SQL query`);for(const e of r)c.emit(`'${e.titleDown}' : Updating bookkeeping of SQL DOWN migration - done`),await u(s.getTnPath("nc_evolutions")).where(e).del();s.knex.isTransaction||await u.commit()}catch(e){throw s.knex.isTransaction||await u.rollback(),c.emitW("Migration operation failed, Database restored to previous state"),v.ppe(e,""),e}}catch(e){throw e}}catch(e){v.debug("Error in evolutionUp",e)}}async init(e){const t=this.init.name;v.api(`${t}:args:`,e),v.debug(e);try{await this._initAllEnvOnFilesystem()}catch(e){throw v.debug("Error in creating migration project:",e),e}}async sync(e){const t=this.sync.name;v.api(`${t}:args:`,e);try{if(e)await this._initEnvDbsWithSql(e);else for(const e of(await this.getProject()).bases)await this._initEnvDbsWithSql(e)}catch(e){throw v.debug("Error in creating migration project:",e),e}}async migrationsCreate(e){const t=this.migrationsCreate.name;v.api(`${t}:args:`,e);try{const t=`${f.getUniqFilenamePrefix()}${this.suffix}`,a=f.getFilenameForUp(t),i=f.getFilenameForDown(t);return await this.metaDb(T).insert({project_id:e.project_id,db_alias:e.id,up:"",down:"",title:a,title_down:i}),this.emit(`Migration files created successfully : '${a}' and '${i}'`),{up:a,down:i}}catch(e){throw v.debug(e),e}}async migrationsDelete(e={}){const t=this.migrationsDelete.name,a=new h.default;return v.api(`${t}:args:`,e),a}async migrationsUp(e){var{base:t}=e,a=o(e,["base"]);const i=this.migrationsUp.name;return v.api(`${i}:args:`,a),await this._migrationsUp({base:t,migrationSteps:a.migrationSteps,file:a.file,onlyList:a.onlyList,title:`${this.toolDir}`,sqlContentMigrate:a.sqlContentMigrate,sqlClient:a.sqlClient})}async migrationsDown(e){var{base:t}=e,a=o(e,["base"]);const i=this.migrationsDown.name;v.api(`${i}:args:`,a),await this._migrationsDown({base:t,migrationSteps:a.migrationSteps,onlyList:a.onlyList,file:a.file,title:"nc_evolutions",sqlContentMigrate:a.sqlContentMigrate})}async migrationsWrite(e){var{base:t}=e,a=o(e,["base"]);const i=this.migrationsWrite.name;v.api(`${i}:args:`,a);try{let e="",i="";for(let t=0;t<a.upStatement.length;t++)e=`${e+a.upStatement[t].sql};`;v.debug("migrationsWrite: created up statement",e);for(let e=0;e<a.downStatement.length;e++)i=`${i+a.downStatement[e].sql};`;v.debug("migrationsWrite: created downStatement",i),this.metaDb?await this.metaDb(T).where({project_id:t.project_id,db_alias:t.id,title:a.up}).first()?await this.metaDb(T).update({up:e,down:i}).where({project_id:this.projectId,db_alias:t.id,title:a.up}):await this.metaDb(T).insert({project_id:this.projectId,db_alias:t.id,up:e,down:i,title:a.up,title_down:a.down}):(await(0,d.promisify)(l.default.writeFile)(c.default.join(this._getWorkingEnvDir(a),a.up),e,"utf-8"),v.debug("migrationsWrite: wrote to file",a.up),await(0,d.promisify)(l.default.writeFile)(c.default.join(this._getWorkingEnvDir(a),a.down),i,"utf-8")),v.debug("migrationsWrite: wrote to file",a.down)}catch(e){v.debug("migrationsWrite error: ",e)}}async migrationsList(e){return await this.migrationsUp(e)}async migrationsToSql(e){const t=new h.default;try{if(t.data.object={up:"",down:""},this.metaDb){const a=await this.metaDb(T).where({db_alias:e.dbAlias,project_id:this.projectId,title:e.title}).first();t.data.object.up=a.up,t.data.object.down=a.down}else{const a=c.default.join(this.toolDir,"nc",this.projectId,e.dbAlias,"migrations",e.title),i=c.default.join(this.toolDir,"nc",this.projectId,e.dbAlias,"migrations",e.titleDown);t.data.object.up=await(0,d.promisify)(l.default.readFile)(a,"utf8"),t.data.object.down=await(0,d.promisify)(l.default.readFile)(i,"utf8")}console.log("migrationsToSql",t.data.object)}catch(e){console.log("migrationsToSql",e)}return t}async migrationsSquash(){}async migrationsCreateManually(){}async _writeProjectJson(e,t){const a=c.default.join(e,"config.xc.json");await(0,d.promisify)(l.default.writeFile)(a,JSON.stringify("",null,2),"utf-8")}async migrationsRenameEnv(e){}async migrationsUpdateEnvDb(e){throw new Error("Not implemented")}async migrationsDeleteEnvDb(e){throw new Error("Not implemented")}async migrationsUpWithExternalClient(e){throw new Error("Not implemented")}async migrationsDownWithExternalClient(e){throw new Error("Not implemented")}get suffix(){return""}}},71616:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(22549)),s=i(a(27552)),o=i(a(19356));class r extends n.default{constructor(e,t=null,a=s.default.ncMeta){super(e),this.sqlClient=t,this.ncMeta=a}get metaDb(){return this.ncMeta.knex||s.default.ncMeta.knex}async getSqlClient(e){return this.sqlClient||o.default.getSqlClient(e)}}t.default=r},10277:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(a(55634)),l=o(a(96974));Promise.resolve().then((()=>s(a(34357))));const c=o(a(29581));t.default=class{constructor(e){this.namespace=e,this.api=(0,l.default)(`${e}_A`),this.warn=(0,l.default)(`${e}_W`),this.info=(0,l.default)(`${e}_I`),this.error=(0,l.default)(`${e}_E`),this.debug=(0,l.default)(`${e}_D`),c.default.createNamespace(e)}ppException(e,t=null){let a="";return a+=`                                              EXCEPTION OCCURED!! in ${this.namespace.red.bold} @ ${t}`,a+="\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n".red.bold,a+="MESSAGE:\n".yellow.bold,a+=`${e.message}\n`.yellow.bold,a+="\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n".red.bold,a+="CODE:\n".yellow.bold,a+=`${e.code}\n`.yellow.bold,a+="\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n".red.bold,a+="STACK:\n".yellow.bold,a+=`${e.stack}\n`.yellow.bold,a+="\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n".red.bold,console.log((0,r.default)(a,{padding:1,borderStyle:"double"})),console.log(e),a}ppe(e,t){return this.ppException(e,t)}}},29581:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(96974)),s={},o={api:"A",info:"I",error:"E",warn:"W",debug:"D"};t.default=class{static _create(e){s[e]?(s[e][`${e}_A`].enabled=n.default.enabled(`${e}_A`),s[e][`${e}_D`].enabled=n.default.enabled(`${e}_D`),s[e][`${e}_I`].enabled=n.default.enabled(`${e}_I`),s[e][`${e}_W`].enabled=n.default.enabled(`${e}_W`),s[e][`${e}_E`].enabled=n.default.enabled(`${e}_E`)):(s[e]={},s[e][`${e}_A`]={level:"api",enabled:n.default.enabled(`${e}_A`)},s[e][`${e}_W`]={level:"warn",enabled:n.default.enabled(`${e}_W`)},s[e][`${e}_I`]={level:"info",enabled:n.default.enabled(`${e}_I`)},s[e][`${e}_E`]={level:"error",enabled:n.default.enabled(`${e}_E`)},s[e][`${e}_D`]={level:"debug",enabled:n.default.enabled(`${e}_D`)})}static createNamespace(e){e in s||this._create(e)}static getNamespaces(){return s}static refreshNamespace(e){this._create(e)}static enable(e,t){const a=`${e}_${o[t]},${n.default.disable()}`;n.default.enable(`${a}`),this.refreshNamespace(e)}static disable(e,t){const a=`${e}_${o[t]}`;let i=`${n.default.disable()}`;i=i.replace(a,""),n.default.enable(i),this.refreshNamespace(e)}static enableAll(e){for(const t in o)n.default.enable(`${e}_${o[t]}`),this.refreshNamespace(e)}static disableAll(e){for(const t in o)n.default.disable(`${e}_${o[t]}`),this.refreshNamespace(e)}}},34032:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e=0,t="",a={}){this.code=e,this.message=t,this.data=a}}},24210:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.customValidators=void 0;const n=i(a(71564));t.customValidators={isCurrency:n.default.isFloat}},91774:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(51196));let s=null;t.default=class{constructor(){if(s)return s;this.evt=new n.default,s=this}}},48852:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameForDown=t.getFilenameForUp=t.getUniqFilenamePrefix=void 0;const n=i(a(1635));t.getUniqFilenamePrefix=function(){return(0,n.default)().format("YYYYMMDD_HHmmssSSS")};t.getFilenameForUp=function(e){return e+".up.sql"};t.getFilenameForDown=function(e){return e+".down.sql"}},39099:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalExceptionFilter=void 0;const s=a(26481),o=a(51401);let r=i=class{constructor(){this.logger=new s.Logger(i.name)}catch(e,t){var a,i,n,s,r,l,c;const d=t.switchToHttp().getResponse();this.logger.error(e.message,e.stack);const u=(0,o.extractDBError)(e);return u?d.status(400).json(u):e instanceof o.BadRequest||400===(null===(a=e.getStatus)||void 0===a?void 0:a.call(e))?d.status(400).json({msg:e.message}):e instanceof o.Unauthorized||401===(null===(i=e.getStatus)||void 0===i?void 0:i.call(e))?d.status(401).json({msg:e.message}):e instanceof o.Forbidden||403===(null===(n=e.getStatus)||void 0===n?void 0:n.call(e))?d.status(403).json({msg:e.message}):e instanceof o.NotFound||404===(null===(s=e.getStatus)||void 0===s?void 0:s.call(e))?d.status(404).json({msg:e.message}):e instanceof o.InternalServerError||500===(null===(r=e.getStatus)||void 0===r?void 0:r.call(e))?d.status(500).json({msg:e.message}):e instanceof o.NotImplemented||501===(null===(l=e.getStatus)||void 0===l?void 0:l.call(e))?d.status(501).json({msg:e.message}):e instanceof o.AjvError?d.status(400).json({msg:e.message,errors:e.errors}):e instanceof o.UnprocessableEntity?d.status(422).json({msg:e.message}):void((null===(c=e.getStatus)||void 0===c?void 0:c.call(e))?d.status(e.getStatus()).json(e.getResponse()):d.status(400).json({msg:e.message}))}};r=i=n([(0,s.Catch)()],r),t.GlobalExceptionFilter=r},67184:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationsGateway=void 0;const r=a(6279),l=a(43952),c=a(30715),d=a(24340),u=a(33206);let p=class{constructor(e){this.appHooks=e,this.clients={}}async onModuleInit(){this.server.use((async(e,t)=>{try{const t=new c.ExecutionContextHost([e.handshake]),a=new((0,d.AuthGuard)("jwt"))(t);await a.canActivate(t)}catch(e){}t()})).on("connection",(e=>{var t,a,i,n;(null===(a=null===(t=null==e?void 0:e.handshake)||void 0===t?void 0:t.user)||void 0===a?void 0:a.id)&&(this.clients[null===(n=null===(i=null==e?void 0:e.handshake)||void 0===i?void 0:i.user)||void 0===n?void 0:n.id]=e)})),this.appHooks.on("notification",this.notificationHandler.bind(this))}onModuleDestroy(){this.appHooks.removeListener("notification",this.notificationHandler)}notificationHandler(e){var t;(null==e?void 0:e.fk_user_id)&&this.clients[e.fk_user_id]&&(null===(t=this.clients[e.fk_user_id])||void 0===t||t.emit("notification",e))}};s([(0,r.WebSocketServer)(),o("design:type","function"==typeof(n=void 0!==l.Server&&l.Server)?n:Object)],p.prototype,"server",void 0),p=s([(0,r.WebSocketGateway)({cors:{origin:"*",allowedHeaders:["xc-auth"],credentials:!0},namespace:"notifications"}),o("design:paramtypes",["function"==typeof(i=void 0!==u.AppHooksService&&u.AppHooksService)?i:Object])],p),t.NotificationsGateway=p},63960:function(e,t,a){var i,n,s,o,r,l=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},u=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SocketGateway=void 0;const m=p(a(6113)),f=a(26481),h=a(50143),g=a(87049),_=a(43952),b=a(24340),y=a(30715),w=a(6279),v=a(82469),T=a(91215);let O=new URL(process.env.NC_PUBLIC_URL||`http://localhost:${process.env.PORT||"8080"}/`).pathname;O+=O.endsWith("/")?"":"/";let E=class{constructor(e,t,a){this.jwtStrategy=e,this.telemetryService=t,this.httpAdapterHost=a,this.clients={},this._jobs={}}async onModuleInit(){this.server.use((async(e,t)=>{try{const t=new y.ExecutionContextHost([e.handshake]),a=new((0,b.AuthGuard)("jwt"))(t);await a.canActivate(t)}catch(e){}t()})).on("connection",(e=>{var t,a;this.clients[e.id]=e;const i=(n=(process.env.NC_SERVER_UUID||g.T.id)+(null===(a=null===(t=null==e?void 0:e.handshake)||void 0===t?void 0:t.user)||void 0===a?void 0:a.id),m.default.createHash("md5").update(n).digest("hex"));var n;e.on("page",(e=>{this.telemetryService.sendEvent(Object.assign(Object.assign({evt_type:"$pageview"},e),{id:i}))})),e.on("event",(e=>{var{event:t}=e,a=u(e,["event"]);this.telemetryService.sendEvent(Object.assign(Object.assign({evt_type:t},a),{id:i}))}))}))}get io(){return this.server}};l([(0,w.WebSocketServer)(),c("design:type","function"==typeof(o=void 0!==_.Server&&_.Server)?o:Object)],E.prototype,"_io",void 0),l([(0,w.WebSocketServer)(),c("design:type","function"==typeof(r=void 0!==_.Server&&_.Server)?r:Object)],E.prototype,"server",void 0),E=l([(0,w.WebSocketGateway)({cors:{origin:"*",allowedHeaders:["xc-auth"],credentials:!0},namespace:O}),(0,f.Injectable)(),d(2,(0,f.Inject)(h.HttpAdapterHost)),c("design:paramtypes",["function"==typeof(i=void 0!==v.JwtStrategy&&v.JwtStrategy)?i:Object,"function"==typeof(n=void 0!==T.TelemetryService&&T.TelemetryService)?n:Object,"function"==typeof(s=void 0!==h.HttpAdapterHost&&h.HttpAdapterHost)?s:Object])],E),t.SocketGateway=E},66310:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalGuard=void 0;const o=a(26481),r=a(24340),l=a(21964),c=a(68281),d=a(82469);let u=class extends((0,r.AuthGuard)(["jwt"])){constructor(e){super(),this.jwtStrategy=e}async canActivate(e){var t;let a;const i=e.switchToHttp().getRequest();if(null===(t=i.headers)||void 0===t?void 0:t["xc-auth"])try{a=await this.extractBoolVal(super.canActivate(e))}catch(e){console.log(e)}if(a&&!i.headers["xc-shared-base-id"]&&-1===i.path.indexOf("/user/me")&&i.header("xc-preview")&&["owner","creator"].some((e=>{var t;return null===(t=i.user.roles)||void 0===t?void 0:t[e]})))return i.user=Object.assign(Object.assign({},i.user),{isAuthorized:!0,roles:(0,c.extractRolesObj)(i.header("xc-preview"))});if(a)return!0;if(i.headers["xc-token"]){let t=!1;try{const a=new((0,r.AuthGuard)("authtoken"))(e);t=await this.extractBoolVal(a.canActivate(e))}catch(e){}if(t)return this.authenticate(i,Object.assign(Object.assign({},i.user),{isAuthorized:!0,roles:"owner"===i.user.roles?"owner,creator":i.user.roles}))}else if(i.headers["xc-shared-base-id"]){let t=!1;try{const a=new((0,r.AuthGuard)("base-view"))(e);t=await this.extractBoolVal(a.canActivate(e))}catch(e){}if(t)return this.authenticate(i,Object.assign(Object.assign({},i.user),{isAuthorized:!0,isPublicBase:!0}))}return await this.authenticate(i)}async authenticate(e,t={roles:{guest:!0}}){const a=await this.jwtStrategy.validate(e,t);return e.user=a,!0}async extractBoolVal(e){return e instanceof l.Observable?(0,l.lastValueFrom)(e):"boolean"==typeof e||e instanceof Promise?e:void 0}};u=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==d.JwtStrategy&&d.JwtStrategy)?i:Object])],u),t.GlobalGuard=u},70781:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=a(51401),o=i(a(69017)),r=i(a(5259)),l=i(a(12490)),c=i(a(3701)),d=i(a(2408)),u=i(a(36098)),p=i(a(82281)),m=i(a(93166)),f=i(a(69592)),h=i(a(72200)),g=i(a(48854)),_=i(a(26999)),b=i(a(95311)),y=i(a(39047)),w=i(a(18427)),v=i(a(60242)),T=i(a(68399)),O=i(a(70741)),E=i(a(86349)),S=i(a(27552)),I=i(a(7232)),k=a(13609),C=i(a(4691)),j=[h.default,y.default,r.default,v.default,w.default,m.default,u.default,l.default,d.default,b.default,o.default,O.default,p.default,c.default,T.default,g.default,_.default,f.default,E.default];t.default=class{static async init(e=S.default.ncMeta){for(const t of j){const a=await e.metaGet(null,null,k.MetaTable.PLUGIN,{title:t.title});a?a.version!==t.version&&await e.metaUpdate(null,null,k.MetaTable.PLUGIN,{title:t.title,version:t.version,logo:t.logo,description:t.description,tags:t.tags,category:t.category,input_schema:JSON.stringify(t.inputs)},a.id):await e.metaInsert2(null,null,k.MetaTable.PLUGIN,{title:t.title,version:t.version,logo:t.logo,description:t.description,tags:t.tags,category:t.category,input_schema:JSON.stringify(t.inputs)})}await this.initPluginsFromEnv()}static async initPluginsFromEnv(){if(process.env.NC_S3_BUCKET_NAME&&process.env.NC_S3_REGION&&process.env.NC_S3_ACCESS_KEY&&process.env.NC_S3_ACCESS_SECRET){const e=await C.default.getPluginByTitle(m.default.title);await C.default.update(e.id,{active:!0,input:JSON.stringify({bucket:process.env.NC_S3_BUCKET_NAME,region:process.env.NC_S3_REGION,access_key:process.env.NC_S3_ACCESS_KEY,access_secret:process.env.NC_S3_ACCESS_SECRET})})}if(process.env.NC_SMTP_FROM&&process.env.NC_SMTP_HOST&&process.env.NC_SMTP_PORT){const e=await C.default.getPluginByTitle(g.default.title);await C.default.update(e.id,{active:!0,input:JSON.stringify({from:process.env.NC_SMTP_FROM,host:process.env.NC_SMTP_HOST,port:process.env.NC_SMTP_PORT,username:process.env.NC_SMTP_USERNAME,password:process.env.NC_SMTP_PASSWORD,secure:process.env.NC_SMTP_SECURE,ignoreTLS:process.env.NC_SMTP_IGNORE_TLS})})}}static async storageAdapter(e=S.default.ncMeta){const t=await e.metaGet2(null,null,k.MetaTable.PLUGIN,{category:n.PluginCategory.STORAGE,active:!0});if(!t)return new I.default;const a=new(j.find((e=>e.title===t.title&&e.category===n.PluginCategory.STORAGE)).builder)(e,t);return(null==t?void 0:t.input)&&(t.input=JSON.parse(t.input)),await a.init(null==t?void 0:t.input),a.getAdapter()}static async emailAdapter(e=!0,t=S.default.ncMeta){const a=await t.metaGet2(null,null,k.MetaTable.PLUGIN,{category:n.PluginCategory.EMAIL,active:!0});if(!a){if(e)return null;throw new Error("Plugin not configured / active")}const i=new(j.find((e=>e.title===a.title&&e.category===n.PluginCategory.EMAIL)).builder)(t,a);return(null==a?void 0:a.input)&&(a.input=JSON.parse(a.input)),await i.init(null==a?void 0:a.input),i.getAdapter()}static async webhookNotificationAdapters(e,t=S.default.ncMeta){const a=await t.metaGet2(null,null,k.MetaTable.PLUGIN,{title:e,active:!0});if(!a)throw new Error("Plugin not configured / active");const i=new(j.find((e=>e.title===a.title)).builder)(t,a);return(null==a?void 0:a.input)&&(a.input=JSON.parse(a.input)),await i.init(null==a?void 0:a.input),i.getAdapter()}static async test(e){var t,a,i,n,o,r,l,c,d;switch(e.input="string"==typeof(null==e?void 0:e.input)?JSON.parse(null==e?void 0:e.input):null==e?void 0:e.input,e.category){case"Storage":{const n=j.find((t=>(null==t?void 0:t.title)===e.title)),o=new n.builder(S.default.ncMeta,n);return await o.init(null==e?void 0:e.input),(null===(t=null==o?void 0:o.getAdapter())||void 0===t?void 0:t.test)||s.NcError.notImplemented("Plugin test is not implemented"),null===(i=null===(a=null==o?void 0:o.getAdapter())||void 0===a?void 0:a.test)||void 0===i?void 0:i.call(a)}case"Email":{const t=j.find((t=>(null==t?void 0:t.title)===e.title)),a=new t.builder(S.default.ncMeta,t);return await a.init(null==e?void 0:e.input),(null===(n=null==a?void 0:a.getAdapter())||void 0===n?void 0:n.test)||s.NcError.notImplemented("Plugin test is not implemented"),null===(r=null===(o=null==a?void 0:a.getAdapter())||void 0===o?void 0:o.test)||void 0===r?void 0:r.call(o)}default:{const t=j.find((t=>(null==t?void 0:t.title)===e.title)),a=new t.builder(S.default.ncMeta,t);return await a.init(null==e?void 0:e.input),(null===(l=null==a?void 0:a.getAdapter())||void 0===l?void 0:l.test)||s.NcError.notImplemented("Plugin test is not implemented"),null===(d=null===(c=null==a?void 0:a.getAdapter())||void 0===c?void 0:c.test)||void 0===d?void 0:d.call(c)}}}}},60498:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PagedResponseImpl=void 0;const i=a(78829);t.PagedResponseImpl=class{constructor(e,t={},a){var n,s;const{offset:o,limit:r}=(0,i.extractLimitAndOffset)(t);let l=null!==(n=t.count)&&void 0!==n?n:null;null!==l&&(l=+l),this.list=e,null!==l&&(this.pageInfo={totalRows:+l},this.pageInfo.page=o?o/r+1:1,this.pageInfo.pageSize=r,this.pageInfo.isFirstPage=null!==(s=this.pageInfo.isFirstPage)&&void 0!==s?s:1===this.pageInfo.page,this.pageInfo.isLastPage=this.pageInfo.page===(Math.ceil(this.pageInfo.totalRows/this.pageInfo.pageSize)||1)),a&&Object.assign(this,a),o&&o>=l&&(this.errors=[{message:"Offset is beyond the total number of rows"}])}}},71079:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(64923));t.default=function({formula:e,columnId:t,title:a}){let i=!1;const s=(e,n)=>{"CallExpression"===e.type?e.arguments.map((e=>s(e,n))):"Literal"===e.type||("Identifier"===e.type?e.name===t&&(n.error=n.formula.error||"",n.error+=`Column '${a||t}' was deleted`,i=!0):"BinaryExpression"===e.type&&(s(e.left,n),s(e.right,n)))};return s((0,n.default)(e.formula),e),i}},9996:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.validatePayload=t.getAjvValidatorMw=t.parseHrtimeToMilliSeconds=void 0;const n=i(a(75888)),s=i(a(34638)),o=i(a(2695)),r=a(51401);t.parseHrtimeToMilliSeconds=function(e){return(1e3*e[0]+e[1]/1e6).toFixed(3)};const l=new n.default({strictSchema:!1,strict:!1});l.addSchema(o.default,"swagger.json"),(0,s.default)(l);t.getAjvValidatorMw=e=>(t,a,i)=>{if(l.validate("string"==typeof e?{$ref:e}:e,t.body))i();else{const e=l.errors;a.status(400).json({message:"Invalid request body",errors:e})}};t.validatePayload=(e,t)=>{if(!l.validate("string"==typeof e?{$ref:e}:e,t)){const e=l.errors;r.NcError.ajvValidationError({message:"Invalid request body",errors:e})}}},97086:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCacheMiddleware=void 0;t.getCacheMiddleware=(e=2592e3)=>async(t,a,i)=>{const{method:n}=t;"GET"===n&&a.set("Cache-Control",`public, max-age=${e}`),i()}},51401:(e,t)=>{var a;function i(e){var t;if(!e.code)return;let i,n,s;switch(e.code){case"SQLITE_BUSY":i="The database is locked by another process or transaction.";break;case"SQLITE_CONSTRAINT":{const a=/FOREIGN KEY|UNIQUE/.test(e.message)?null===(t=e.message.match(/FOREIGN KEY|UNIQUE/gi))||void 0===t?void 0:t.join(" "):"constraint";i=`A ${a} constraint was violated: ${e.message}`,n={constraint:a}}break;case"SQLITE_CORRUPT":i="The database file is corrupt.";break;case"SQLITE_ERROR":if(i="A SQL error occurred.",e.message){const t=e.message.match(/no such table: (\w+)/),o=e.message.match(/SQLITE_ERROR: table `?(\w+)`? already exists/),r=e.message.match(/SQLITE_ERROR: duplicate column name: (\w+)/),l=e.message.match(/SQLITE_ERROR: unrecognized token: "(\w+)"/),c=e.message.match(/SQLITE_ERROR: no such column: (\w+)/),d=e.message.match(/SQLITE_ERROR: constraint failed: (\w+)/);if(t&&t[1])i=`The table '${t[1]}' does not exist.`,s=a.TABLE_NOT_EXIST,n={table:t[1]};else if(o&&o[1])i=`The table '${o[1]}' already exists.`,s=a.TABLE_EXIST,n={table:o[1]};else if(l&&l[1])i=`Unrecognized token: ${l[1]}`,n={token:l[1]};else if(c&&c[1])i=`The column ${c[1]} does not exist.`,s=a.COLUMN_NOT_EXIST,n={column:c[1]};else if(d&&d[1])i=`A constraint failed: ${d[1]}`;else if(r&&r[1])i=`The column '${r[1]}' already exists.`,s=a.COLUMN_EXIST,n={column:r[1]};else{const t=e.message.match(/SQLITE_ERROR:\s*(\w+)/);t&&t[1]&&(i=t[1])}}break;case"SQLITE_RANGE":i="A column index is out of range.";break;case"SQLITE_SCHEMA":i="The database schema has changed.";break;case"ER_TABLE_EXISTS_ERROR":if(i="The table already exists.",e.message){const t=e.message.match(/ Table '?(\w+)'? already exists/i);t&&t[1]&&(i=`The table '${t[1]}' already exists.`,s=a.TABLE_EXIST,n={table:t[1]})}break;case"ER_DUP_FIELDNAME":if(i="The column already exists.",e.message){const t=e.message.match(/ Duplicate column name '(\w+)'/i);t&&t[1]&&(i=`The column '${t[1]}' already exists.`,s=a.COLUMN_EXIST,n={column:t[1]})}break;case"ER_NO_SUCH_TABLE":if(i="The table does not exist.",e.message){const t=e.message.match(/ Table '(?:\w+\.)?(\w+)' doesn't exist/i);t&&t[1]&&(i=`The table '${t[1]}' does not exist`,s=a.TABLE_NOT_EXIST,n={table:t[1]})}break;case"ER_DUP_ENTRY":case"23505":i="This record already exists.";break;case"ER_PARSE_ERROR":case"42601":i="There was a syntax error in your SQL query.";break;case"ER_NO_DEFAULT_FOR_FIELD":case"23502":i="A value is required for this field.";break;case"ER_BAD_NULL_ERROR":i="A null value is not allowed for this field.";{const t=e.message.match(/Column '(\w+)' cannot be null/i);t&&t[1]&&(i=`The column '${t[1]}' cannot be null.`,s=a.COLUMN_NOT_NULL,n={column:t[1]})}break;case"ER_DATA_TOO_LONG":case"22001":i="The data entered is too long for this field.";break;case"ER_BAD_FIELD_ERROR":{i="The field you are trying to access does not exist.";const t=e.message.match(/ Unknown column '(\w+)' in 'field list'/i);t&&t[1]&&(i=`The column '${t[1]}' does not exist.`,s=a.COLUMN_NOT_EXIST,n={column:t[1]})}break;case"ER_ACCESS_DENIED_ERROR":case"28000":case"ELOGIN":i="You do not have permission to perform this action.";break;case"ER_LOCK_WAIT_TIMEOUT":case"40P01":case"ETIMEOUT":i="A timeout occurred while waiting for a table lock.";break;case"ER_NO_REFERENCED_ROW":case"23503":i="The referenced row does not exist.";break;case"ER_ROW_IS_REFERENCED":case"23506":i="This record is being referenced by other records.";break;case"23514":i="A null value is not allowed for this field.";break;case"42P07":if(i="The table already exists.",e.message){const t=e.message.match(/ relation "?(\w+)"? already exists/i);t&&t[1]&&(i=`The table '${t[1]}' already exists.`,s=a.TABLE_EXIST,n={table:t[1]})}break;case"42701":if(i="The column already exists.",e.message){const t=e.message.match(/ column "(\w+)" of relation "(\w+)" already exists/i);t&&t[1]&&(i=`The column '${t[1]}' already exists.`,s=a.COLUMN_EXIST,n={column:t[1]})}break;case"42P01":if(i="The table does not exist.",e.message){const t=e.message.match(/ relation "(\w+)" does not exist/i);t&&t[1]&&(i=`The table '${t[1]}' does not exist.`,s=a.TABLE_NOT_EXIST,n={table:t[1]})}break;case"42703":if(i="The column does not exist.",e.message){const t=e.message.match(/ column "(\w+)" does not exist/i);t&&t[1]&&(i=`The column '${t[1]}' does not exist.`,s=a.COLUMN_NOT_EXIST,n={column:t[1]})}break;case"EREQUEST":if(i="There was a syntax error in your SQL query.",e.message){const t=e.message.match(/ There is already an object named '(\w+)' in the database/i),o=e.message.match(/ Column name '(\w+)' in table '(\w+)' is specified more than once/i),r=e.message.match(/ Invalid object name '(\w+)'./i),l=e.message.match(/ Invalid column name '(\w+)'./i);t&&t[1]?(i=`The table '${t[1]}' already exists.`,s=a.TABLE_EXIST,n={table:t[1]}):o&&o[1]?(i=`The column '${o[1]}' already exists.`,s=a.COLUMN_EXIST,n={column:o[1]}):r&&r[1]?(i=`The table '${r[1]}' does not exist`,s=a.TABLE_NOT_EXIST,n={table:r[1]}):l&&l[1]&&(i=`The column '${l[1]}' does not exist`,s=a.COLUMN_NOT_EXIST,n={column:l[1]})}break;case"ECONNRESET":i="The connection was reset.";break;case"ECONNREFUSED":i="The connection was refused.";break;case"EHOSTUNREACH":i="The host is unreachable.";break;case"EHOSTDOWN":i="The host is down."}return i?{message:i,type:s,extra:n,info:{message:e.message,code:e.code}}:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.NcError=t.AjvError=t.UnprocessableEntity=t.NotImplemented=t.InternalServerError=t.NotFound=t.Forbidden=t.Unauthorized=t.BadRequest=t.extractDBError=t.DBError=void 0,function(e){e.TABLE_EXIST="TABLE_EXIST",e.TABLE_NOT_EXIST="TABLE_NOT_EXIST",e.COLUMN_EXIST="COLUMN_EXIST",e.COLUMN_NOT_EXIST="COLUMN_NOT_EXIST",e.CONSTRAINT_EXIST="CONSTRAINT_EXIST",e.CONSTRAINT_NOT_EXIST="CONSTRAINT_NOT_EXIST",e.COLUMN_NOT_NULL="COLUMN_NOT_NULL"}(a=t.DBError||(t.DBError={})),t.extractDBError=i,t.default=function(e){return async function(t,a,p){try{return await e(t,a,p)}catch(t){console.log(e.name?`${e.name} ::`:"",t);const m=i(t);if(m)return a.status(400).json(m);if(t instanceof n)return a.status(400).json({msg:t.message});if(t instanceof s)return a.status(401).json({msg:t.message});if(t instanceof o)return a.status(403).json({msg:t.message});if(t instanceof r)return a.status(404).json({msg:t.message});if(t instanceof l)return a.status(500).json({msg:t.message});if(t instanceof c)return a.status(501).json({msg:t.message});if(t instanceof u)return a.status(400).json({msg:t.message,errors:t.errors});if(t instanceof d)return a.status(422).json({msg:t.message});p(t)}}};class n extends Error{}t.BadRequest=n;class s extends Error{}t.Unauthorized=s;class o extends Error{}t.Forbidden=o;class r extends Error{}t.NotFound=r;class l extends Error{}t.InternalServerError=l;class c extends Error{}t.NotImplemented=c;class d extends Error{}t.UnprocessableEntity=d;class u extends Error{constructor(e){super(e.message),this.errors=e.errors}}t.AjvError=u;t.NcError=class{static notFound(e="Not found"){throw new r(e)}static badRequest(e){throw new n(e)}static unauthorized(e){throw new s(e)}static forbidden(e){throw new o(e)}static internalServerError(e="Internal server error"){throw new l(e)}static notImplemented(e="Not implemented"){throw new c(e)}static ajvValidationError(e){throw new u(e)}static unprocessableEntity(e="Unprocessable entity"){throw new d(e)}}},59484:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.populateRollupForLTAR=t.generateFkName=t.validateRequiredField=t.validateLookupPayload=t.validateRollupPayload=t.createHmAndBtColumn=t.randomID=void 0;const n=a(30754),s=a(68281),o=a(64190),r=i(a(95391)),l=a(36002),c=i(a(83889)),d=a(15147);t.randomID=(0,n.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz_",10),t.createHmAndBtColumn=async function(e,t,a,i,n,r,d=!1,u=!1,p=null,m=!1){{const o=(0,l.getUniqueColumnAliasName)(await e.getColumns(),"bt"===i&&n||`${t.title}`);await c.default.insert({title:o,fk_model_id:e.id,uidt:s.UITypes.LinkToAnotherRecord,type:"bt",fk_child_column_id:a.id,fk_parent_column_id:t.primaryKey.id,fk_related_model_id:t.id,virtual:d,system:u||t.id===e.id,fk_col_name:r,fk_index_name:r})}{const f=(0,l.getUniqueColumnAliasName)(await t.getColumns(),"hm"===i&&n||(0,o.pluralize)(e.title)),h={plural:(null==p?void 0:p.plural)||(0,o.pluralize)(e.title),singular:(null==p?void 0:p.singular)||(0,o.singularize)(e.title)};await c.default.insert({title:f,fk_model_id:t.id,uidt:m?s.UITypes.Links:s.UITypes.LinkToAnotherRecord,type:"hm",fk_child_column_id:a.id,fk_parent_column_id:t.primaryKey.id,fk_related_model_id:e.id,virtual:d,system:u,fk_col_name:r,fk_index_name:r,meta:h})}},t.validateRollupPayload=async function(e){(0,r.default)(["title","fk_relation_column_id","fk_rollup_column_id","rollup_function"],e);const t=await(await c.default.get({colId:e.fk_relation_column_id})).getColOptions();if(!t)throw new Error("Relation column not found");let a;switch(t.type){case"hm":a=await c.default.get({colId:t.fk_child_column_id});break;case"mm":case"bt":a=await c.default.get({colId:t.fk_parent_column_id})}const i=await a.getModel();if(!(await i.getColumns()).find((t=>t.id===e.fk_rollup_column_id)))throw new Error("Rollup column not found in related table")},t.validateLookupPayload=async function(e,t){if((0,r.default)(["title","fk_relation_column_id","fk_lookup_column_id"],e),t){let a=e;for(;a;){if(t===a.fk_lookup_column_id)throw new Error("Circular lookup reference not allowed");a=await c.default.get({colId:a.fk_lookup_column_id}).then((e=>"Lookup"===e.uidt?e.getColOptions():null))}}const a=await(await c.default.get({colId:e.fk_relation_column_id})).getColOptions();if(!a)throw new Error("Relation column not found");let i;switch(a.type){case"hm":i=await c.default.get({colId:a.fk_child_column_id});break;case"mm":case"bt":i=await c.default.get({colId:a.fk_parent_column_id})}const n=await i.getModel();if(!(await n.getColumns()).find((t=>t.id===e.fk_lookup_column_id)))throw new Error("Lookup column not found in related table")};t.validateRequiredField=(e,t)=>t.every((t=>t in e&&void 0!==e[t]&&null!==e[t]));t.generateFkName=(e,a)=>`fk_${e.table_name.replace(/\W+/g,"_").slice(0,10)}_${a.table_name.replace(/\W+/g,"_").slice(0,10)}_${(0,t.randomID)(15)}`,t.populateRollupForLTAR=async function({column:e,columnMeta:t,alias:a}){var i,n;const r=await e.getModel(),u=await r.getViews(),p=await e.getColOptions().then((e=>e.getRelatedTable()));await p.getColumns();const m=(null===(i=p.primaryKey)||void 0===i?void 0:i.id)||(null===(n=(await p.getColumns())[0])||void 0===n?void 0:n.id),f={plural:(null==t?void 0:t.plural)||(0,o.pluralize)(p.title),singular:(null==t?void 0:t.singular)||(0,o.singularize)(p.title)};await c.default.insert({uidt:s.UITypes.Links,title:(0,l.getUniqueColumnAliasName)(await r.getColumns(),a||`${p.title} Count`),fk_rollup_column_id:m,fk_model_id:r.id,rollup_function:"count",fk_relation_column_id:e.id,meta:f});const h=await d.GridViewColumn.list(u[0].id).then((t=>t.find((t=>t.fk_column_id===e.id))));await d.GridViewColumn.update(h.id,{show:!1})}},32041:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertDateFormat=void 0,t.convertDateFormat=function(e,t){if("YYYY-MM-DD"===e){if("mysql2"===t||"sqlite3"===t)return"%Y-%m-%d"}else if("YYYY/MM/DD"===e){if("mysql2"===t||"sqlite3"===t)return"%Y/%m/%d"}else if("DD-MM-YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%d/%m/%Y"}else if("MM-DD-YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%d-%m-%Y"}else if("DD/MM/YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%d/%m/%Y"}else if("MM/DD/YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%m-%d-%Y"}else if("DD MM YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%d %m %Y"}else if("MM DD YYYY"===e){if("mysql2"===t||"sqlite3"===t)return"%m %d %Y"}else if("YYYY MM DD"===e&&("mysql2"===t||"sqlite3"===t))return"%Y %m %d";return e}},38592:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertUnits=void 0,t.convertUnits=function(e,t){switch(e){case"milliseconds":case"ms":switch(t){case"mssql":return"millisecond";case"mysql":return"MICROSECOND";case"pg":case"sqlite":return"milliseconds";default:return e}case"seconds":case"s":switch(t){case"mssql":case"pg":return"second";case"mysql":return"SECOND";case"sqlite":return"seconds";default:return e}case"minutes":case"m":switch(t){case"mssql":case"pg":return"minute";case"mysql":return"MINUTE";case"sqlite":return"minutes";default:return e}case"hours":case"h":switch(t){case"mssql":case"pg":return"hour";case"mysql":return"HOUR";case"sqlite":return"hours";default:return e}case"days":case"d":switch(t){case"mssql":case"pg":return"day";case"mysql":return"DAY";case"sqlite":return"days";default:return e}case"weeks":case"w":switch(t){case"mssql":case"pg":return"week";case"mysql":return"WEEK";case"sqlite":return"weeks";default:return e}case"months":case"M":switch(t){case"mssql":case"pg":return"month";case"mysql":return"MONTH";case"sqlite":return"months";default:return e}case"quarters":case"Q":switch(t){case"mssql":case"pg":return"quarter";case"mysql":return"QUARTER";case"sqlite":return"quarters";default:return e}case"years":case"y":switch(t){case"mssql":case"pg":return"year";case"mysql":return"YEAR";case"sqlite":return"years";default:return e}default:return e}}},54123:function(e,t){var a=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};function i(e){return e.split("::").pop()}Object.defineProperty(t,"__esModule",{value:!0}),t.generateUniqueName=t.findWithIdentifier=t.getEntityIdentifier=t.getParentIdentifier=t.withoutId=t.reverseGet=t.withoutNull=t.clearPrefix=t.generateBaseIdMap=void 0,t.generateBaseIdMap=async function(e,t){t.set(e.project_id,e.project_id),t.set(e.id,`${e.project_id}::${e.id}`);const a=await e.getModels();for(const i of a){t.set(i.id,`${e.project_id}::${e.id}::${i.id}`),await i.getColumns();for(const e of i.columns)t.set(e.id,`${t.get(i.id)}::${e.id}`)}return a},t.clearPrefix=function(e,t){return t&&0!==t.length?e.replace(new RegExp(`^${t}_?`),""):e},t.withoutNull=function(e){const t={};let a=!1;for(const[i,n]of Object.entries(e))null!==n&&(t[i]=n,a=!0);return a?t:null},t.reverseGet=function(e,t){for(const[a,i]of e.entries())if(t===i)return a},t.withoutId=function(e){const{id:t}=e;return a(e,["id"])},t.getParentIdentifier=function(e){const t=e.split("::");return t.pop(),t.join("::")},t.getEntityIdentifier=i,t.findWithIdentifier=function(e,t){for(const a of e.keys())if(i(a)===t)return e.get(a)},t.generateUniqueName=function(e,t){let a=e,i=1;for(;t.includes(a);)a=`${e}_${i}`,i++;return a}},26676:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractLimitAndOffset=void 0;const a={limitDefault:Math.max(+process.env.DB_QUERY_LIMIT_DEFAULT||25,1),limitMin:Math.max(+process.env.DB_QUERY_LIMIT_MIN||1,1),limitMax:Math.max(+process.env.DB_QUERY_LIMIT_MAX||1e3,1)};t.extractLimitAndOffset=function(e={}){const t={},i=+(e.limit||e.l);t.limit=Math.max(Math.min(i&&i>0&&Number.isInteger(i)?i:a.limitDefault,a.limitMax),a.limitMin);const n=+(e.offset||e.o)||0;return t.offset=Math.max(Number.isInteger(n)?n:0,0),t}},33402:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.extractPropsAndSanitize=t.extractProps=void 0;const n=i(a(73059));t.extractProps=function(e,t){return t.reduce(((t,a)=>(a in e&&(t[a]=e[a]),t)),{})},t.extractPropsAndSanitize=function(e,t){return t.reduce(((t,a)=>(a in e&&(t[a]=""===e[a]?null:n.default.sanitize(e[a])),t)),{})}},50396:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.convertDateFormatForConcat=t.validateDateWithUnknownFormat=t.getWeekdayByIndex=t.getWeekdayByText=void 0;const n=i(a(1635)),s=a(68281),o=a(32041),r=i(a(83889));t.getWeekdayByText=function(e){return{monday:0,tuesday:1,wednesday:2,thursday:3,friday:4,saturday:5,sunday:6}[(null==e?void 0:e.toLowerCase())||"monday"]},t.getWeekdayByIndex=function(e){return{0:"monday",1:"tuesday",2:"wednesday",3:"thursday",4:"friday",5:"saturday",6:"sunday"}[e||0]},t.validateDateWithUnknownFormat=function(e){const t=["DD-MM-YYYY","MM-DD-YYYY","YYYY-MM-DD","DD/MM/YYYY","MM/DD/YYYY","YYYY/MM/DD","DD MM YYYY","MM DD YYYY","YYYY MM DD"];for(const a of t){if((0,n.default)(e,a,!0).isValid())return!0;for(const t of["HH:mm","HH:mm:ss","HH:mm:ss.SSS"])if((0,n.default)(e,`${a} ${t}`,!0).isValid())return!0}return!1},t.convertDateFormatForConcat=async function(e,t,a,i){if("Identifier"===(null==e?void 0:e.type)&&(null==e?void 0:e.name)in t&&t[e.name]===s.UITypes.Date){const t=(await r.default.get({colId:e.name})).meta;"mysql2"===i?a=`DATE_FORMAT(${a}, '${(0,o.convertDateFormat)(t.date_format,i)}')`:"pg"===i?a=`TO_CHAR(${a}, '${(0,o.convertDateFormat)(t.date_format,i)}')`:"sqlite3"===i?a=`strftime('${(0,o.convertDateFormat)(t.date_format,i)}', ${a})`:"mssql"===i&&(a=`FORMAT(${a}, '${(0,o.convertDateFormat)(t.date_format,i)}')`)}return a}},89103:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(68281),n=a(15147),s=async({query:e,extractOnlyPrimaries:t=!1,includePkByDefault:a=!0,model:r,view:l,dependencyFields:c=Object.assign(Object.assign({},e||{}),{nested:Object.assign({},(null==e?void 0:e.nested)||{}),fieldsSet:new Set}),getHiddenColumn:d=!1})=>{var u;if(c.nested=c.nested||{},c.fieldsSet=c.fieldsSet||new Set,(null===(u=r.columns)||void 0===u?void 0:u.length)||await r.getColumns(),t){const e=Object.assign(Object.assign({},r.primaryKeys?r.primaryKeys.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.title]:1})),{}):{}),r.displayValue?{[r.displayValue.title]:1}:{});return await Promise.all(r.primaryKeys.map((e=>o(e,c)))),await o(r.displayValue,c),{ast:e,dependencyFields:c}}let p=(null==e?void 0:e.fields)||(null==e?void 0:e.f);p=p&&"*"!==p?Array.isArray(p)?p:p.split(","):null;let m=null;l&&(m=(await n.View.getColumns(l.id)).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.fk_column_id]:t.show})),{}));const f=await r.columns.reduce((async(t,n)=>{var r,u,f,h,g,_;let b=1;const y=(null===(u=null===(r=null==e?void 0:e.nested)||void 0===r?void 0:r[n.title])||void 0===u?void 0:u.fields)||(null===(h=null===(f=null==e?void 0:e.nested)||void 0===f?void 0:f[n.title])||void 0===h?void 0:h.f);if(y&&"*"!==y)if(n.uidt===i.UITypes.LinkToAnotherRecord){const t=await n.getColOptions().then((e=>e.getRelatedTable())),{ast:a}=await s({model:t,query:null===(g=null==e?void 0:e.nested)||void 0===g?void 0:g[n.title],dependencyFields:c.nested[n.title]=c.nested[n.title]||{nested:{},fieldsSet:new Set}});b=a}else b=n.uidt===i.UITypes.Links?1:(Array.isArray(y)?y:y.split(",")).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:1})),{});else if(n.uidt===i.UITypes.LinkToAnotherRecord){const t=await n.getColOptions().then((e=>e.getRelatedTable()));b=(await s({model:t,query:null===(_=null==e?void 0:e.nested)||void 0===_?void 0:_[n.title],extractOnlyPrimaries:"*"!==y,dependencyFields:c.nested[n.title]=c.nested[n.title]||{nested:{},fieldsSet:new Set}})).ast}let w;return w=d?!(0,i.isSystemColumn)(n)||"created_at"===n.column_name||"updated_at"===n.column_name||n.pk:!m||a&&n.pk?(null==p?void 0:p.length)?p.includes(n.title)&&b:b:m[n.id]&&(!(0,i.isSystemColumn)(n)||l.show_system_fields||n.pv)&&(!(null==p?void 0:p.length)||p.includes(n.title))&&b,(w||n.pk)&&await o(n,c),Object.assign(Object.assign({},await t),{[n.title]:w})}),Promise.resolve({}));return{ast:f,dependencyFields:c}},o=async(e,t={nested:{},fieldsSet:new Set})=>{switch(e.uidt){case i.UITypes.Lookup:await r(e,t);break;case i.UITypes.LinkToAnotherRecord:await l(e,t);break;default:t.fieldsSet.add(e.title)}},r=async(e,t={nested:{},fieldsSet:new Set})=>{const a=await e.getColOptions(),i=await a.getRelationColumn();await l(i,t),await o(await a.getLookupColumn(),t.nested[i.title]=t.nested[i.title]||{nested:{},fieldsSet:new Set})},l=async(e,t={nested:{},fieldsSet:new Set})=>{const a=await e.getColOptions();switch(a.type){case i.RelationTypes.HAS_MANY:t.fieldsSet.add(await a.getParentColumn().then((e=>e.title)));break;case i.RelationTypes.BELONGS_TO:case i.RelationTypes.MANY_TO_MANY:t.fieldsSet.add(await a.getChildColumn().then((e=>e.title)))}};t.default=s},58177:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(68281);t.default=async function(e,t){var a;const n=i.SqlUiFactory.create(await t.getConnectionConfig()),s=n.getDataTypeForUiType(e,(null===(a=null==e?void 0:e.meta)||void 0===a?void 0:a.ag)?"AG":"AI"),o=Object.assign({rqd:!1,pk:!1,ai:!1,cdf:null,un:!1,dtx:"specificType"},s);o.dtxp=n.getDefaultLengthForDatatype(o.dt),o.dtxs=n.getDefaultScaleForDatatype(o.dt);const r=[i.UITypes.MultiSelect,i.UITypes.SingleSelect];return e&&r.includes(o.uidt)&&r.includes(e.uidt)&&(o.dtxp=e.dtxp),o.altered=e.altered||2,Object.assign(Object.assign({},o),e)}},8609:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(60854));t.default=function(e,t){return n.default.create({client:e.type},{}).getUIDataType(t)}},94135:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getConditionalHandler=void 0;const n=i(a(27552));t.default=function(e,t){return async(...a)=>n.default.isEE()?e(...a):t(...a)},t.getConditionalHandler=function(e,t){return async(...a)=>n.default.isEE()?e(...a):t(...a)}},10460:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getColumnNameAlias=void 0;const n=i(a(64190));t.default=function(e,t,a){var i;let s=e;return a.isMeta(!0)&&!a.isMeta(!0,1)&&t&&(s=s.replace(t,"")),(null==a?void 0:a.inflection_table)&&(null===(i=n.default[null==a?void 0:a.inflection_table])||void 0===i?void 0:i.call(n.default,s))||s},t.getColumnNameAlias=function(e,t){var a;return(null==t?void 0:t.inflection_column)&&(null===(a=n.default[null==t?void 0:t.inflection_column])||void 0===a?void 0:a.call(n.default,e))||e}},36002:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getUniqueColumnAliasName=t.getUniqueColumnName=void 0,t.getUniqueColumnName=function(e,t="field"){let a=0;for(;e.some((e=>e.column_name===`${t}${a||""}`));)a++;return`${t}${a||""}`},t.getUniqueColumnAliasName=function(e,t="field"){let a=0;for(;e.some((e=>e.title===`${t}${a||""}`));)a++;return`${t}${a||""}`}},78829:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.populateMeta=void 0;const s=a(39097);Object.defineProperty(t,"populateMeta",{enumerable:!0,get:function(){return s.populateMeta}}),n(a(59484),t),n(a(9996),t),n(a(97086),t),n(a(26676),t)},6543:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(16464),s=a(25828),o=i(a(98432)),r=a(68281),l=i(a(55634)),c=a(87049),d=a(71564),u=i(a(37912)),p=i(a(27552)),m=a(15147),f=a(13609),h=a(74564),g={owner:0,creator:1,editor:2,commenter:3,viewer:4};t.default=async function(e=p.default.ncMeta){var t,a;if(process.env.NC_ADMIN_EMAIL&&process.env.NC_ADMIN_PASSWORD){(0,d.isEmail)(null===(t=process.env.NC_ADMIN_EMAIL)||void 0===t?void 0:t.trim())||(console.log("\n",(0,l.default)(`Provided admin email '${process.env.NC_ADMIN_EMAIL}'  is not valid`,{title:"Invalid admin email",padding:1,borderStyle:"double",titleAlignment:"center",borderColor:"red"}),"\n"),process.exit(1));const{valid:i,error:p,hint:_}=(0,r.validatePassword)(process.env.NC_ADMIN_PASSWORD);let b;i||(console.log("\n",(0,l.default)(`${p}${_?`\n\n${_}`:""}`,{title:"Invalid admin password",padding:1,borderStyle:"double",titleAlignment:"center",borderColor:"red"}),"\n"),process.exit(1));try{b=await e.startTransaction();const t=process.env.NC_ADMIN_EMAIL.toLowerCase().trim(),i=await(0,n.promisify)(o.default.genSalt)(10),r=await(0,n.promisify)(o.default.hash)(process.env.NC_ADMIN_PASSWORD,i),l=(0,s.v4)(),d="org-level-creator,super";if(await m.User.isFirst(b))c.T.emit("evt",{evt_type:"project:invite",count:1}),await m.User.insert({email:t,salt:i,password:r,email_verification_token:l,token_version:(0,h.randomTokenString)(),roles:d},b);else{const e=await(0,n.promisify)(o.default.genSalt)(10),i=await(0,n.promisify)(o.default.hash)(process.env.NC_ADMIN_PASSWORD,e),r=(0,s.v4)(),l=await b.metaList2(null,null,f.MetaTable.USERS);let p=!1;for(const s of l)if(null===(a=s.roles)||void 0===a?void 0:a.includes("super"))if(p=!0,t!==s.email){const a=await m.User.getByEmail(t,b);if(null==a?void 0:a.id){const n=await b.metaList2(null,null,f.MetaTable.PROJECT_USERS,{condition:{fk_user_id:a.id}});for(const e of n){const t=await m.ProjectUser.get(e.project_id,s.id,b);t?g[t.roles]>g[e.roles]&&await m.ProjectUser.update(t.project_id,s.id,e.roles,b):await m.ProjectUser.insert(Object.assign(Object.assign({},e),{fk_user_id:s.id}),b),await m.ProjectUser.delete(e.project_id,e.fk_user_id,b)}await b.metaDelete(null,null,f.MetaTable.USERS,a.id),await u.default.delAll(f.CacheScope.USER,`${a.email}___*`),await u.default.del(`${f.CacheScope.USER}:${a.id}`),await u.default.del(`${f.CacheScope.USER}:${a.email}`),await m.User.update(s.id,{salt:e,email:t,password:i,email_verification_token:r,token_version:(0,h.randomTokenString)(),refresh_token:null},b)}else await m.User.update(s.id,{salt:e,email:t,password:i,email_verification_token:r,token_version:(0,h.randomTokenString)(),refresh_token:null},b)}else{await(0,n.promisify)(o.default.hash)(process.env.NC_ADMIN_PASSWORD,s.salt)!==s.password&&await m.User.update(s.id,{salt:e,password:i,email_verification_token:r,token_version:(0,h.randomTokenString)(),refresh_token:null},b)}if(!p){const a=await m.User.getByEmail(t,b);(null==a?void 0:a.id)?(await u.default.delAll(f.CacheScope.USER,`${a.email}___*`),await u.default.del(`${f.CacheScope.USER}:${a.id}`),await u.default.del(`${f.CacheScope.USER}:${a.email}`),await m.User.update(a.id,{salt:e,email:t,password:i,email_verification_token:r,token_version:(0,h.randomTokenString)(),refresh_token:null,roles:d},b)):(c.T.emit("evt",{evt_type:"project:invite",count:1}),await m.User.insert({email:t,salt:e,password:i,email_verification_token:r,token_version:(0,h.randomTokenString)(),roles:d},b))}}await b.commit()}catch(e){throw console.log("Error occurred while updating/creating admin user"),await b.rollback(e),e}}}},35619:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e.some((e=>e.pv))){const t=e.findIndex((e=>e.pk));if(t===e.length-1){if(t>0)return e[t-1].pv=!0,e[t-1];if(e.length>0)return e[0].pv=!0,e[0]}else{if(t>-1)return e[t+1].pv=!0,e[t+1];if(e.length>0)return e[0].pv=!0,e[0]}}}},39097:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.populateRollupColumnAndHideLTAR=t.populateMeta=t.extractAndGenerateManyToManyRelations=t.IGNORE_TABLES=void 0;const r=a(68281),l=a(68281),c=a(64190),d=a(68281),u=a(36002),p=o(a(35619)),m=o(a(8609)),f=s(a(10460)),h=o(a(86026)),g=o(a(74721)),_=o(a(19356)),b=o(a(33505)),y=o(a(83889)),w=a(15147);async function v(e,t,a){let i=!1;const n=await a.getColOptions();for(const a of await e.getColumns())if(a.uidt===r.UITypes.LinkToAnotherRecord){const e=await a.getColOptions();if(e&&e.type===l.RelationTypes.MANY_TO_MANY&&e.fk_mm_model_id===t.id&&e.fk_child_column_id===n.fk_parent_column_id&&e.fk_mm_child_column_id===n.fk_child_column_id){i=!0;break}}return i}async function T(e){for(const t of e){await t.getColumns();const e=t.columns.filter((e=>!(0,l.isVirtualCol)(e))),a=[];for(const e of t.columns)if(e.uidt==r.UITypes.LinkToAnotherRecord){const t=await e.getColOptions();(null==t?void 0:t.type)===l.RelationTypes.BELONGS_TO&&a.push(e)}if(2===(null==a?void 0:a.length)&&e.length<5&&2===t.primaryKeys.length){const e=await a[0].colOptions.getRelatedTable(),i=await a[1].colOptions.getRelatedTable();await e.getColumns(),await i.getColumns();const n=await v(e,t,a[0]),s=await v(i,t,a[1]);n||await y.default.insert({title:(0,u.getUniqueColumnAliasName)(e.columns,(0,c.pluralize)(i.title)),fk_model_id:e.id,fk_related_model_id:i.id,fk_mm_model_id:t.id,fk_child_column_id:a[0].colOptions.fk_parent_column_id,fk_parent_column_id:a[1].colOptions.fk_parent_column_id,fk_mm_child_column_id:a[0].colOptions.fk_child_column_id,fk_mm_parent_column_id:a[1].colOptions.fk_child_column_id,type:l.RelationTypes.MANY_TO_MANY,uidt:r.UITypes.Links,meta:{plural:(0,c.pluralize)(i.title),singular:(0,c.singularize)(i.title)}}),s||await y.default.insert({title:(0,u.getUniqueColumnAliasName)(i.columns,(0,c.pluralize)(e.title)),fk_model_id:i.id,fk_related_model_id:e.id,fk_mm_model_id:t.id,fk_child_column_id:a[1].colOptions.fk_parent_column_id,fk_parent_column_id:a[0].colOptions.fk_parent_column_id,fk_mm_child_column_id:a[1].colOptions.fk_child_column_id,fk_mm_parent_column_id:a[0].colOptions.fk_child_column_id,type:l.RelationTypes.MANY_TO_MANY,uidt:r.UITypes.Links,meta:{plural:(0,c.pluralize)(e.title),singular:(0,c.singularize)(e.title)}}),await b.default.markAsMmTable(t.id,!0);for(const e of[a[0],a[1]]){const t=await e.colOptions,a=await t.getRelatedTable();for(const e of await a.getColumns()){if(!(0,d.isLinksOrLTAR)(e.uidt))continue;const a=await e.getColOptions();if(a&&a.type===l.RelationTypes.HAS_MANY&&(a.fk_child_column_id===t.fk_child_column_id&&a.fk_parent_column_id===t.fk_parent_column_id)){await y.default.markAsSystemField(e.id);break}}}}else t.mm&&await b.default.markAsMmTable(t.id,!1)}}t.IGNORE_TABLES=["nc_models","nc_roles","nc_routes","nc_loaders","nc_resolvers","nc_hooks","nc_store","_evolutions","nc_evolutions","xc_users","nc_rpc","nc_acl","nc_cron","nc_disabled_models_for_role","nc_audit","xc_knex_migrations","xc_knex_migrations_lock","nc_plugins","nc_migrations","nc_api_tokens","nc_projects","nc_projects_users","nc_relations","nc_shared_views"],t.extractAndGenerateManyToManyRelations=T,t.populateMeta=async function(e,a){var i,n,s,o,l,d,u,w,v,O,E,S,I;const k={type:"rest",apiCount:0,tablesCount:0,relationsCount:0,viewsCount:0,client:null===(i=await(null==e?void 0:e.getConnectionConfig()))||void 0===i?void 0:i.client,timeTaken:0},C=process.hrtime(),j=await _.default.getSqlClient(e);let x=1;const R={},A=[],M=null===(o=null===(s=await j.relationListAll({schema:null===(n=e.getConfig())||void 0===n?void 0:n.schema}))||void 0===s?void 0:s.data)||void 0===o?void 0:o.list;k.relationsCount=M.length;let N=null===(v=null===(w=null===(u=null===(d=await j.tableList({schema:null===(l=e.getConfig())||void 0===l?void 0:l.schema}))||void 0===d?void 0:d.data)||void 0===u?void 0:u.list)||void 0===w?void 0:w.filter((({tn:e})=>!t.IGNORE_TABLES.includes(e))))||void 0===v?void 0:v.map((t=>(t.order=++x,t.title=(0,f.default)(t.tn,a.prefix,e),t.table_name=t.tn,t)));e.is_meta&&(null==a?void 0:a.prefix)&&(N=N.filter((e=>{var t;return null===(t=null==e?void 0:e.tn)||void 0===t?void 0:t.startsWith(null==a?void 0:a.prefix)}))),k.tablesCount=N.length,N.forEach((t=>{t.title=(0,f.default)(t.tn,a.prefix,e)})),M.forEach((t=>{t.title=(0,f.default)(t.tn,a.prefix,e),t.rtitle=(0,f.default)(t.rtn,a.prefix,e)}));let P=null;"pg"===e.type&&(P={format:(await j.getDefaultByteaOutputFormat()).data});const L=N.map((t=>async()=>{var i,n,s;const o=M.filter((e=>e.tn===t.tn||e.rtn===t.tn)),l=null===(s=null===(n=await j.columnList({tn:t.tn,schema:null===(i=e.getConfig())||void 0===i?void 0:i.schema}))||void 0===n?void 0:n.data)||void 0===s?void 0:s.list,d="view"===t.type?[]:o.filter((e=>e.rtn===t.tn)),u="view"===t.type?[]:o.filter((e=>e.tn===t.tn));(0,p.default)(l);const h=[...d.map((e=>({uidt:r.UITypes.Links,type:"hm",hm:e,title:(0,c.pluralize)(e.title),meta:{plural:(0,c.pluralize)(e.title),singular:(0,c.singularize)(e.title)}}))),...u.map((e=>{const t=l.find((t=>t.cn===e.cn));return t&&(t.uidt=r.UITypes.ForeignKey,t.system=!0),{uidt:r.UITypes.LinkToAnotherRecord,type:"bt",bt:e,title:`${e.rtitle}`}}))];R[t.table_name]=await b.default.insert(a.id,e.id,{table_name:t.tn||t.table_name,title:t.title,type:t.type||"table",order:t.order}),k.apiCount+=5;let g=1;for(const a of l)await y.default.insert(Object.assign(Object.assign(Object.assign({uidt:a.uidt||(0,m.default)(e,a),fk_model_id:R[t.tn].id},a),{title:(0,f.getColumnNameAlias)(a.cn,e),column_name:a.cn,order:g++}),P&&"bytea"===a.dt?{meta:P}:{}));A.push((async()=>{var i,n,s,o,r,l,c,d;const u={};for(const p of h){let m=0;for(;`${p.title}${m||""}`in u;)m++;p.title=`${p.title}${m||""}`,u[p.title]=!0;const f=p.hm||p.bt,h=null===(s=null===(n=await(null===(i=null==R?void 0:R[f.tn])||void 0===i?void 0:i.getColumns()))||void 0===n?void 0:n.find((e=>e.column_name===f.cn)))||void 0===s?void 0:s.id,_=null===(o=null==R?void 0:R[f.tn])||void 0===o?void 0:o.id,b=null===(c=null===(l=await(null===(r=null==R?void 0:R[f.rtn])||void 0===r?void 0:r.getColumns()))||void 0===l?void 0:l.find((e=>e.column_name===f.rcn)))||void 0===c?void 0:c.id,w=null===(d=null==R?void 0:R[f.rtn])||void 0===d?void 0:d.id;try{await y.default.insert({project_id:a.id,db_alias:e.id,fk_model_id:R[t.tn].id,cn:p.cn,title:p.title,uidt:p.uidt,type:p.hm?"hm":p.mm?"mm":"bt",fk_child_column_id:h,fk_parent_column_id:b,fk_index_name:f.cstn,ur:f.ur,dr:f.dr,order:g++,fk_related_model_id:p.hm?_:w,system:p.system,meta:p.meta}),k.apiCount+=5}catch(e){console.log(e)}}}))}));await g.default.executeOperations(L,e.type),await g.default.executeOperations(A,e.type),await T(Object.values(R));let $=null===(I=null===(S=null===(E=await j.viewList({schema:null===(O=e.getConfig())||void 0===O?void 0:O.schema}))||void 0===E?void 0:E.data)||void 0===S?void 0:S.list)||void 0===I?void 0:I.map((t=>(t.order=++x,t.table_name=t.view_name,t.title=(0,f.default)(t.view_name,a.prefix,e),t)));e.is_meta&&(null==a?void 0:a.prefix)&&($=N.filter((e=>{var t;return null===(t=null==e?void 0:e.tn)||void 0===t?void 0:t.startsWith(null==a?void 0:a.prefix)}))),k.viewsCount=$.length;const q=$.map((t=>async()=>{var i,n,s;const o=null===(s=null===(n=await j.columnList({tn:t.table_name,schema:null===(i=e.getConfig())||void 0===i?void 0:i.schema}))||void 0===n?void 0:n.data)||void 0===s?void 0:s.list;(0,p.default)(o),R[t.table_name]=await b.default.insert(a.id,e.id,{table_name:t.table_name,title:(0,f.default)(t.table_name,a.prefix,e),type:r.ModelTypes.VIEW,order:t.order});let l=1;k.apiCount+=2;for(const a of o)await y.default.insert(Object.assign(Object.assign({fk_model_id:R[t.table_name].id},a),{title:(0,f.getColumnNameAlias)(a.cn,e),order:l++,uidt:(0,m.default)(e,a)}))}));await g.default.executeOperations(q,e.type);const D=await b.default.list({project_id:a.id,base_id:e.id});for(const e of D){const t=await e.getViews();for(const e of t)e.type===r.ViewTypes.GRID&&await h.default.fixPVColumnForView(e.id)}const U=process.hrtime(C),B=U[0]+U[1]/1e9;return k.timeTaken=B.toFixed(1),k},t.populateRollupColumnAndHideLTAR=async function(e,t){var a,i;for(const n of await b.default.list({project_id:t.id,base_id:e.id})){const e=(await n.getColumns()).filter((e=>e.uidt===r.UITypes.LinkToAnotherRecord&&e.colOptions.type!==l.RelationTypes.BELONGS_TO&&!e.system)),t=await n.getViews();for(const s of e){const e=await s.getColOptions().then((e=>e.getRelatedTable()));await e.getColumns();const o=(null===(a=e.primaryKey)||void 0===a?void 0:a.id)||(null===(i=(await e.getColumns())[0])||void 0===i?void 0:i.id);await y.default.insert({uidt:r.UITypes.Links,title:(0,u.getUniqueColumnAliasName)(await n.getColumns(),`${e.title}`),fk_rollup_column_id:o,fk_model_id:n.id,rollup_function:"count",fk_relation_column_id:s.id,meta:{singular:(0,c.singularize)(e.title),plural:(0,c.pluralize)(e.title)}});const l=await w.GridViewColumn.list(t[0].id).then((e=>e.find((e=>e.fk_column_id===s.id))));await w.GridViewColumn.update(l.id,{show:!1})}}}},6526:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.populateSamplePayloadV2=t.populateSamplePayload=void 0;const i=a(68281),n=a(25828),s=a(15147);async function o(e,t=!1,a="insert"){var n;const o={};let l,c=[];if(e instanceof s.View){const t=await e.getColumns();for(const e of t)e.show&&c.push(await s.Column.get({colId:e.fk_column_id}));l=await e.getModel(),await l.getColumns()}else e instanceof s.Model&&(c=await e.getColumns(),l=e);for(const e of c)!t&&[i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||"delete"===a&&(null===(n=l.primaryKey)||void 0===n?void 0:n.title)!==e.title||(o[e.title]=await r(e));return o}async function r(e){var t,a,n,s,l,c,d,u;switch(e.uidt){case i.UITypes.ID:return 1;case i.UITypes.LinkToAnotherRecord:{const t=await e.getColOptions(),a=await o(await t.getRelatedTable());if(t.type!==i.RelationTypes.BELONGS_TO)return;return t.type===i.RelationTypes.BELONGS_TO?a:[a]}case i.UITypes.ForeignKey:return 1;case i.UITypes.Lookup:{const t=await e.getColOptions(),a=await t.getRelationColumn().then((e=>e.getColOptions())),n=await r(await t.getLookupColumn());return a.type===i.RelationTypes.BELONGS_TO?n:[n].flat()}case i.UITypes.SingleLineText:return"Sample Text";case i.UITypes.LongText:return"Sample Long text";case i.UITypes.Attachment:return[{url:"https://nocodb.com/dummy.png",title:"image.png",mimetype:"image/png",size:0}];case i.UITypes.Checkbox:return!0;case i.UITypes.MultiSelect:{const i=await e.getColOptions();return(null===(t=null==i?void 0:i[0])||void 0===t?void 0:t.title)||(null===(s=null===(n=null===(a=null==e?void 0:e.dtxp)||void 0===a?void 0:a.split(","))||void 0===n?void 0:n[0])||void 0===s?void 0:s.replace(/^['"]|['"]$/g,""))}case i.UITypes.SingleSelect:{const t=await e.getColOptions();return(null===(l=null==t?void 0:t[0])||void 0===l?void 0:l.title)||(null===(u=null===(d=null===(c=null==e?void 0:e.dtxp)||void 0===c?void 0:c.split(","))||void 0===d?void 0:d[0])||void 0===u?void 0:u.replace(/^['"]|['"]$/g,""))}case i.UITypes.Date:return new Date;case i.UITypes.Year:return 2e3;case i.UITypes.Time:return"11:00";case i.UITypes.PhoneNumber:return"0000000000";case i.UITypes.Email:return"test@nocodb.com";case i.UITypes.URL:return"https://nocodb.com";case i.UITypes.Number:return 123;case i.UITypes.Decimal:return 123.1;case i.UITypes.Currency:return"$123";case i.UITypes.Percent:return"10";case i.UITypes.Duration:return 123;case i.UITypes.Rating:return 1;case i.UITypes.Formula:return"Sample Output";case i.UITypes.Rollup:case i.UITypes.Count:return 1;case i.UITypes.DateTime:case i.UITypes.CreateTime:case i.UITypes.LastModifiedTime:return new Date;case i.UITypes.AutoNumber:return 1;case i.UITypes.Geometry:return{};case i.UITypes.JSON:return"{}";case i.UITypes.SpecificDBType:return null}}t.populateSamplePayload=o,t.populateSamplePayloadV2=async function(e,t=!1,a="insert",o="records"){const l={};let c,d=[];if(e instanceof s.View){const t=await e.getColumns();for(const e of t)e.show&&d.push(await s.Column.get({colId:e.fk_column_id}));c=await e.getModel(),await c.getColumns()}else e instanceof s.Model&&(d=await e.getColumns(),c=e);await c.getViews();const u={type:`${o}.after.${a}`,id:(0,n.v4)(),data:{table_id:c.id,table_name:c.title,view_id:c.views[0].id,view_name:c.views[0].title}};for(const e of d)!t&&[i.UITypes.LinkToAnotherRecord,i.UITypes.Lookup].includes(e.uidt)||(l[e.title]=await r(e));let p;return["update","bulkUpdate"].includes(a)&&(p=l),u.data=Object.assign(Object.assign(Object.assign(Object.assign({},u.data),p&&{previous_rows:[p]}),"bulkInsert"!==a&&l&&{rows:[l]}),"bulkInsert"===a&&l&&{row_inserted:10}),u}},70939:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unsanitize=t.sanitize=void 0,t.sanitize=function(e){return"string"!=typeof e?e:null==e?void 0:e.replace(/([^\\]|^)(\?+)/g,((e,t,a)=>`${t}${a.split("?").join("\\?")}`))},t.unsanitize=function(e){return"string"!=typeof e?e:null==e?void 0:e.replace(/\\[?]/g,"?")}},56248:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.randomTokenString=void 0;const n=i(a(6113));t.randomTokenString=function(){return n.default.randomBytes(40).toString("hex")}},40516:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.syncBaseMigration=void 0;const n=i(a(22549));t.default=async function(e){for(const t of await e.getBases())try{const a=new n.default(e);await a.init(t),await a.sync(t),await a.migrationsUp({base:t})}catch(e){console.log(e)}},t.syncBaseMigration=async function(e,t){try{const a=new n.default(e);await a.init(t),await a.sync(t),await a.migrationsUp({base:t})}catch(e){console.log(e)}}},95391:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(const a of e)if(!(a in t))throw new Error(`Missing '${a}' property in request body`)}},58632:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t._transformSubmittedFormDataForEmail=t.invokeWebhook=t.axiosRequestMake=t.handleHttpWebHook=t.constructWebHookData=t.validateCondition=t.parseBody=void 0;const n=i(a(62097)),s=a(25828),o=i(a(70781)),r=a(15147);function l(e,t){return e?n.default.compile(e,{noEscape:!0})({data:t}):e}async function c(e,t){var a,i,n,s,o,l,c,d,u,p,m,f,h,g;if(!e.length)return!0;let _=!0;for(const b of e){const e=b instanceof r.Filter?b:new r.Filter(b);let y;const w=await e.getColumn().then((e=>e.title));let v=t[w];switch(typeof e.value){case"boolean":v=!!t[w];break;case"number":v=+t[w]}switch(e.comparison_op){case"eq":y=v==e.value;break;case"neq":y=v!=e.value;break;case"like":y=(null===(i=null===(a=t[w])||void 0===a?void 0:a.toLowerCase())||void 0===i?void 0:i.indexOf(null===(n=e.value)||void 0===n?void 0:n.toLowerCase()))>-1;break;case"nlike":y=-1===(null===(o=null===(s=t[w])||void 0===s?void 0:s.toLowerCase())||void 0===o?void 0:o.indexOf(null===(l=e.value)||void 0===l?void 0:l.toLowerCase()));break;case"empty":case"blank":y=""===t[w]||null===t[w]||void 0===t[w];break;case"notempty":case"notblank":y=!(""===t[w]||null===t[w]||void 0===t[w]);break;case"checked":y=!!t[w];break;case"notchecked":y=!t[w];break;case"null":y=y=null===t[w];break;case"notnull":y=null!==t[w];break;case"allof":y=(null!==(d=null===(c=e.value)||void 0===c?void 0:c.split(",").map((e=>e.trim())))&&void 0!==d?d:[]).every((e=>{var a,i;return(null!==(i=null===(a=t[w])||void 0===a?void 0:a.split(","))&&void 0!==i?i:[]).includes(e)}));break;case"anyof":y=(null!==(p=null===(u=e.value)||void 0===u?void 0:u.split(",").map((e=>e.trim())))&&void 0!==p?p:[]).some((e=>{var a,i;return(null!==(i=null===(a=t[w])||void 0===a?void 0:a.split(","))&&void 0!==i?i:[]).includes(e)}));break;case"nallof":y=!(null!==(f=null===(m=e.value)||void 0===m?void 0:m.split(",").map((e=>e.trim())))&&void 0!==f?f:[]).every((e=>{var a,i;return(null!==(i=null===(a=t[w])||void 0===a?void 0:a.split(","))&&void 0!==i?i:[]).includes(e)}));break;case"nanyof":y=!(null!==(g=null===(h=e.value)||void 0===h?void 0:h.split(",").map((e=>e.trim())))&&void 0!==g?g:[]).some((e=>{var a,i;return(null!==(i=null===(a=t[w])||void 0===a?void 0:a.split(","))&&void 0!==i?i:[]).includes(e)}));break;case"lt":y=+t[w]<+e.value;break;case"lte":case"le":y=+t[w]<=+e.value;break;case"gt":y=+t[w]>+e.value;break;case"gte":case"ge":y=+t[w]>=+e.value}switch(e.logical_op){case"or":_=_||y;break;case"not":_=_&&!y;break;default:_=_&&y}}return _}function d(e,t,a,i,n){if("v2"===e.version){return{type:`${"records"}.${e.event}.${e.operation}`,id:(0,s.v4)(),data:Object.assign(Object.assign(Object.assign({table_id:t.id,table_name:t.title},i&&{previous_rows:Array.isArray(i)?i:[i]}),"bulkInsert"!==e.operation&&n&&{rows:Array.isArray(n)?n:[n]}),"bulkInsert"===e.operation&&{rows_inserted:Array.isArray(n)?n.length:n?1:0})}}return n}async function u(e,t,i,n,s,o,r){const l=p(n,s,d(e,t,0,o,r));return a(52167)(l)}function p(e,t,a){const i=Object.assign({},e);if(i.body)try{i.body=JSON.parse("string"==typeof i.body?i.body:JSON.stringify(i.body),((e,t)=>"string"==typeof t?l(t,a):t))}catch(e){i.body=l(i.body,a)}if(i.auth)try{i.auth=JSON.parse("string"==typeof i.auth?i.auth:JSON.stringify(i.auth),((e,t)=>"string"==typeof t?l(t,a):t))}catch(e){i.auth=l(i.auth,a)}i.response={};return{params:i.parameters?i.parameters.reduce(((e,t)=>(t.name&&t.enabled&&(e[t.name]=l(t.value,a)),e)),{}):{},url:l(i.path,a),method:i.method,data:i.body,headers:i.headers?i.headers.reduce(((e,t)=>(t.name&&t.enabled&&(e[t.name]=l(t.value,a)),e)),{}):{},withCredentials:!0}}n.default.registerHelper("json",(function(e){return JSON.stringify(e)})),t.parseBody=l,t.validateCondition=c,t.constructWebHookData=d,t.handleHttpWebHook=u,t.axiosRequestMake=p,t.invokeWebhook=async function(e,t,a,i,n,s,d=null,p=!1,m=!1){var f,h,g,_,b;let y;const w=process.hrtime();let v;try{v="string"==typeof e.notification?JSON.parse(e.notification):e.notification;const a=Array.isArray(n);if(a&&"URL"!==(null==v?void 0:v.type))return;if(e.condition&&!m)if(a){const t=[];for(const a of n){if(await c(d||await e.getFilters(),a)&&t.push(a),!t.length)return;n=t}}else if(!await c(d||await e.getFilters(),n))return;switch(null==v?void 0:v.type){case"Email":{const t=await(null===(f=await o.default.emailAdapter(!1))||void 0===f?void 0:f.mailSend({to:l(null===(h=null==v?void 0:v.payload)||void 0===h?void 0:h.to,n),subject:l(null===(g=null==v?void 0:v.payload)||void 0===g?void 0:g.subject,n),html:l(null===(_=null==v?void 0:v.payload)||void 0===_?void 0:_.body,n)}));"ALL"===process.env.NC_AUTOMATION_LOG_LEVEL&&(y=Object.assign(Object.assign({},e),{fk_hook_id:e.id,type:v.type,payload:JSON.stringify(null==v?void 0:v.payload),response:JSON.stringify(t),triggered_by:null==s?void 0:s.email}))}break;case"URL":{const a=await u(e,t,0,null==v?void 0:v.payload,s,i,n);"ALL"===process.env.NC_AUTOMATION_LOG_LEVEL&&(y=Object.assign(Object.assign({},e),{fk_hook_id:e.id,type:v.type,payload:JSON.stringify(null==v?void 0:v.payload),response:JSON.stringify({status:a.status,statusText:a.statusText,headers:a.headers,config:{url:a.config.url,method:a.config.method,data:a.config.data,headers:a.config.headers,params:a.config.params}}),triggered_by:null==s?void 0:s.email}))}break;default:{const t=await(await o.default.webhookNotificationAdapters(v.type)).sendMessage(l(null===(b=null==v?void 0:v.payload)||void 0===b?void 0:b.body,n),JSON.parse(JSON.stringify(null==v?void 0:v.payload),((e,t)=>"string"==typeof t?l(t,n):t)));"ALL"===process.env.NC_AUTOMATION_LOG_LEVEL&&(y=Object.assign(Object.assign({},e),{fk_hook_id:e.id,type:v.type,payload:JSON.stringify(null==v?void 0:v.payload),response:JSON.stringify({status:t.status,statusText:t.statusText,headers:t.headers,config:{url:t.config.url,method:t.config.method,data:t.config.data,headers:t.config.headers,params:t.config.params}}),triggered_by:null==s?void 0:s.email}))}}}catch(t){if(console.log(t),["ERROR","ALL"].includes(process.env.NC_AUTOMATION_LOG_LEVEL)&&(y=Object.assign(Object.assign({},e),{type:v.type,payload:JSON.stringify(null==v?void 0:v.payload),fk_hook_id:e.id,error_code:t.error_code,error_message:t.message,error:JSON.stringify(t),triggered_by:null==s?void 0:s.email})),p)throw t}finally{y&&(y.execution_time=((T=process.hrtime(w))[0]+T[1]/1e6).toFixed(3),r.HookLog.insert(Object.assign(Object.assign({},y),{test_call:m})))}var T},t._transformSubmittedFormDataForEmail=function(e,t,a){const i=Object.assign({},e);for(const e of a)"Attachment"===e.uidt?("string"==typeof i[e.title]&&(i[e.title]=JSON.parse(i[e.title])),i[e.title]=(i[e.title]||[]).map((e=>["jpeg","gif","png","apng","svg","bmp","ico","jpg"].includes(e.title.split(".").pop())?`<a href="${e.url}" target="_blank"><img height="50px" src="${e.url}"/></a>`:`<a href="${e.url}" target="_blank">${e.title}</a>`)).join("&nbsp;")):i[e.title]&&"object"==typeof i[e.title]&&(i[e.title]=JSON.stringify(i[e.title]));return i}},31001:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UploadAllowedInterceptor=void 0;const s=a(26481),o=a(68281),r=n(a(27552)),l=a(51401),c=a(13609);let d=class{async intercept(e,t){var a,i;const n=e.switchToHttp().getRequest();(null===(a=n.user)||void 0===a?void 0:a.id)||(null===(i=n.user)||void 0===i?void 0:i.isPublicBase)||l.NcError.unauthorized("Unauthorized");try{if((0,o.extractRolesObj)(n.user.roles)[o.OrgUserRoles.SUPER_ADMIN]||(0,o.extractRolesObj)(n.user.roles)[o.OrgUserRoles.CREATOR]||(0,o.extractRolesObj)(n.user.roles)[o.ProjectRoles.EDITOR]||await r.default.ncMeta.knex(c.MetaTable.PROJECT_USERS).where((function(){this.where("roles",o.ProjectRoles.OWNER),this.orWhere("roles",o.ProjectRoles.CREATOR),this.orWhere("roles",o.ProjectRoles.EDITOR)})).andWhere("fk_user_id",n.user.id).first())return t.handle()}catch(e){}l.NcError.badRequest("Upload not allowed")}};d=i([(0,s.Injectable)()],d),t.UploadAllowedInterceptor=d},26094:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JobEvents=t.JobStatus=t.JobTypes=t.JOBS_QUEUE=void 0,t.JOBS_QUEUE="jobs",function(e){e.DuplicateBase="duplicate-base",e.DuplicateModel="duplicate-model",e.AtImport="at-import"}(t.JobTypes||(t.JobTypes={})),function(e){e.COMPLETED="completed",e.WAITING="waiting",e.ACTIVE="active",e.DELAYED="delayed",e.FAILED="failed",e.PAUSED="paused",e.REFRESH="refresh"}(t.JobStatus||(t.JobStatus={})),function(e){e.STATUS="job.status",e.LOG="job.log"}(t.JobEvents||(t.JobEvents={}))},5311:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaService=void 0;const c=a(26481),d=a(30754),u=l(a(75666)),p=l(a(1635)),m=l(a(36619)),f=l(a(53291)),h=l(a(14786)),g=l(a(79982)),_=a(59204),b=a(35043),y=a(13609);p.default.extend(m.default),p.default.extend(f.default);const w=(0,d.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz_",4),v=[],T=(0,d.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14);let O=i=class{constructor(e,t=null){this._config=e,this._knex=(0,_.XKnex)(Object.assign(Object.assign({},this._config.meta.db),{useNullAsDefault:!0})),this.trx=t}get knexInstance(){return this._knex}get config(){return this._config}get connection(){var e;return null!==(e=this.trx)&&void 0!==e?e:this.knexInstance}get knexConnection(){return this.connection}get knex(){return this.knexConnection}async metaGet(e,t,a,i,n){const s=this.connection(a);return(null==n?void 0:n.length)&&s.select(...n),null!=e&&s.where("project_id",e),null!=t&&s.where("db_alias",t),i?("object"!=typeof i?s.where("id",i):s.where(i),s.first()):s.first()}async metaInsert2(e,t,a,i,n){const s=Object.assign(Object.assign({},i),n?{}:{id:(null==i?void 0:i.id)||await this.genNanoid(a)});return null!==t&&(s.base_id=t),null!==e&&(s.project_id=e),await this.knexConnection(a).insert(Object.assign(Object.assign({},s),{created_at:this.now(),updated_at:this.now()})),s}async bulkMetaInsert(e,t,a,i,n){const s=[],o=this.now();for(const r of i){const i=(null==r?void 0:r.id)||await this.genNanoid(a),l=Object.assign(Object.assign(Object.assign({},r),n?{}:{id:i}),{created_at:o,updated_at:o});null!==t&&(l.base_id=t),null!==e&&(l.project_id=e),s.push(l)}return await this.knexConnection.batchInsert(a,s),s}async genNanoid(e){let t;switch(e){case y.MetaTable.PROJECT:t="p";break;case y.MetaTable.BASES:t="b";break;case y.MetaTable.MODELS:t="m";break;case y.MetaTable.COLUMNS:t="c";break;case y.MetaTable.COL_RELATIONS:t="l";break;case y.MetaTable.COL_SELECT_OPTIONS:t="s";break;case y.MetaTable.COL_LOOKUP:t="lk";break;case y.MetaTable.COL_ROLLUP:t="rl";break;case y.MetaTable.COL_FORMULA:t="f";break;case y.MetaTable.FILTER_EXP:t="fi";break;case y.MetaTable.SORT:t="so";break;case y.MetaTable.SHARED_VIEWS:t="sv";break;case y.MetaTable.ACL:t="ac";break;case y.MetaTable.FORM_VIEW:t="fv";break;case y.MetaTable.FORM_VIEW_COLUMNS:t="fvc";break;case y.MetaTable.GALLERY_VIEW:t="gv";break;case y.MetaTable.GALLERY_VIEW_COLUMNS:t="gvc";break;case y.MetaTable.KANBAN_VIEW:t="kv";break;case y.MetaTable.KANBAN_VIEW_COLUMNS:t="kvc";break;case y.MetaTable.USERS:t="us";break;case y.MetaTable.ORGS:t="org";break;case y.MetaTable.TEAMS:t="tm";break;case y.MetaTable.VIEWS:t="vw";break;case y.MetaTable.HOOKS:t="hk";break;case y.MetaTable.HOOK_LOGS:t="hkl";break;case y.MetaTable.AUDIT:t="adt";break;case y.MetaTable.API_TOKENS:t="tkn";break;default:t="nc"}return`${t}${T()}`}async metaPaginatedList(e,t,a,i){var n,s;const o=this.knexConnection(a),r=this.knexConnection(a);return null!=e&&(o.where("project_id",e),r.where("project_id",e)),null!=t&&(o.where("db_alias",t),r.where("db_alias",t)),(null==i?void 0:i.condition)&&(o.where(i.condition),r.where(i.condition)),(null==i?void 0:i.limit)&&o.limit(i.limit),(null==i?void 0:i.sort)&&o.orderBy(i.sort.field,i.sort.desc?"desc":"asc"),(null==i?void 0:i.offset)&&o.offset(i.offset),(null==i?void 0:i.xcCondition)&&o.condition(i.xcCondition)(r).condition(i.xcCondition),(null===(n=null==i?void 0:i.fields)||void 0===n?void 0:n.length)&&o.select(...i.fields),{list:await o,count:null===(s=Object.values(await r.count().first()))||void 0===s?void 0:s[0]}}async metaDelete(e,t,a,i,n){const s=this.knexConnection(a);return null!=e&&s.where("project_id",e),null!=t&&s.where("db_alias",t),"object"!=typeof i?s.where("id",i):i&&s.where(i),n&&s.condition(n,{}),s.del()}async metaGet2(e,t,a,i,n,s){const o=this.knexConnection(a);return s&&o.condition(s),(null==n?void 0:n.length)&&o.select(...n),null!=e&&o.where("project_id",e),null!=t&&o.where("base_id",t),i?("object"!=typeof i?o.where("id",i):o.where(i),o.first()):o.first()}async metaGetNextOrder(e,t){var a;const i=this.knexConnection(e);return i.where(t),i.max("order",{as:"order"}),(+(null===(a=await i.first())||void 0===a?void 0:a.order)||0)+1}async metaInsert(e,t,a,i){return this.knexConnection(a).insert(Object.assign(Object.assign({db_alias:t,project_id:e},i),{created_at:this.now(),updated_at:this.now()}))}async metaList(e,t,a,i){var n;const s=this.knexConnection(a);if(null!=e&&s.where("project_id",e),(null==i?void 0:i.condition)&&s.where(i.condition),(null==i?void 0:i.limit)&&s.limit(i.limit),(null==i?void 0:i.offset)&&s.offset(i.offset),(null==i?void 0:i.xcCondition)&&s.condition(i.xcCondition),null==i?void 0:i.orderBy)for(const[e,t]of Object.entries(i.orderBy))s.orderBy(e,t);return(null===(n=null==i?void 0:i.fields)||void 0===n?void 0:n.length)&&s.select(...i.fields),s}async metaList2(e,t,a,i){var n;const s=this.knexConnection(a);if(null!=e&&s.where("project_id",e),null!=t&&s.where("base_id",t),(null==i?void 0:i.condition)&&s.where(i.condition),(null==i?void 0:i.limit)&&s.limit(i.limit),(null==i?void 0:i.offset)&&s.offset(i.offset),(null==i?void 0:i.xcCondition)&&s.condition(i.xcCondition),null==i?void 0:i.orderBy)for(const[e,t]of Object.entries(i.orderBy))s.orderBy(e,t);return(null===(n=null==i?void 0:i.fields)||void 0===n?void 0:n.length)&&s.select(...i.fields),s}async metaCount(e,t,a,i){var n;const s=this.knexConnection(a);return null!=e&&s.where("project_id",e),null!=t&&s.where("base_id",t),(null==i?void 0:i.condition)&&s.where(i.condition),(null==i?void 0:i.xcCondition)&&s.condition(i.xcCondition),s.count((null==i?void 0:i.aggField)||"id",{as:"count"}).first(),+(null===(n=await s)||void 0===n?void 0:n.count)||0}async metaUpdate(e,t,a,i,n,s){const o=this.knexConnection(a);return null!=e&&o.where("project_id",e),null!=t&&o.where("db_alias",t),delete i.created_at,o.update(Object.assign(Object.assign({},i),{updated_at:this.now()})),"object"!=typeof n?o.where("id",n):n&&o.where(n),s&&o.condition(s),await o}async metaDeleteAll(e,t){}async isMetaDataExists(e,t){const a=this.knexConnection("nc_models");null!=e&&a.where("project_id",e),null!=t&&a.where("db_alias",t);return!!await a.first()}async commit(){this.trx&&await this.trx.commit(),this.trx=null}async rollback(e){this.trx&&await this.trx.rollback(e),this.trx=null}async startTransaction(){const e=await this.connection.transaction();return Object.assign(e,{clientType:this.connection.clientType,searchPath:this.connection.searchPath}),new i(this.config,e)}async metaReset(e,t,a){var i;a&&await Promise.all(null===(i=null==v?void 0:v[a])||void 0===i?void 0:i.map((a=>(async()=>{try{await this.knexConnection(a).where({db_alias:t,project_id:e}).del()}catch(e){console.warn(`Error: ${a} reset failed`)}})())))}async projectCreate(e,t,a,i){try{const n=this.getNanoId(),s=`${e.toLowerCase().replace(/\W+/g,"_")}_${n}`;i&&(t.prefix=`nc_${n}__`),t.id=s;const o={id:s,title:e,description:a,config:u.default.AES.encrypt(JSON.stringify(t),"secret").toString()};return await this.knexConnection("nc_projects").insert(Object.assign(Object.assign({},o),{created_at:this.now(),updated_at:this.now()})),await this.knexConnection(y.MetaTable.PROJECT).insert({id:s,title:e}),o.prefix=t.prefix,o}catch(e){console.log(e)}}async projectUpdate(e,t){try{const a={config:u.default.AES.encrypt(JSON.stringify(t,null,2),"secret").toString()};await this.knexConnection("nc_projects").update(a).where({id:e})}catch(e){console.log(e)}}async projectList(){return(await this.knexConnection("nc_projects").select()).map((e=>(e.config=u.default.AES.decrypt(e.config,"secret").toString(u.default.enc.Utf8),e)))}async userProjectList(e){return(await this.knexConnection("nc_projects").leftJoin(this.knexConnection("nc_projects_users").where("nc_projects_users.user_id",e).as("user"),"user.project_id","nc_projects.id").select("nc_projects.*").select("user.user_id").select(this.knexConnection("xc_users").select("xc_users.email").innerJoin("nc_projects_users","nc_projects_users.user_id","=","xc_users.id").whereRaw("nc_projects.id = nc_projects_users.project_id").where("nc_projects_users.roles","like","%owner%").first().as("owner")).select(this.knexConnection("xc_users").count("xc_users.id").innerJoin("nc_projects_users","nc_projects_users.user_id","=","xc_users.id").where((e=>{e.where("nc_projects_users.roles","like","%creator%").orWhere("nc_projects_users.roles","like","%owner%")})).whereRaw("nc_projects.id = nc_projects_users.project_id").andWhere("xc_users.id",e).first().as("is_creator"))).map((t=>(t.allowed=t.user_id===e,t.config=u.default.AES.decrypt(t.config,"secret").toString(u.default.enc.Utf8),t)))}async isUserHaveAccessToProject(e,t){return!!await this.knexConnection("nc_projects_users").where({project_id:e,user_id:t}).first()}async projectGet(e,t){const a=await this.knexConnection("nc_projects").where({title:e}).first();return a&&!t&&(a.config=u.default.AES.decrypt(a.config,"secret").toString(u.default.enc.Utf8)),a}async projectGetById(e,t){const a=await this.knexConnection("nc_projects").where({id:e}).first();return a&&!t&&(a.config=u.default.AES.decrypt(a.config,"secret").toString(u.default.enc.Utf8)),a}projectDelete(e){return this.knexConnection("nc_projects").where({title:e}).delete()}projectDeleteById(e){return this.knexConnection("nc_projects").where({id:e}).delete()}async projectStatusUpdate(e,t){return this.knexConnection("nc_projects").update({status:t}).where({id:e})}async projectAddUser(e,t,a){return await this.knexConnection("nc_projects_users").where({user_id:t,project_id:e}).first()?{}:this.knexConnection("nc_projects_users").insert({user_id:t,project_id:e,roles:a})}projectRemoveUser(e,t){return this.knexConnection("nc_projects_users").where({user_id:t,project_id:e}).delete()}removeXcUser(e){return this.knexConnection("xc_users").where({id:e}).delete()}getNanoId(){return w()}isMySQL(){return"mysql"===this.connection.clientType()||"mysql2"===this.connection.clientType()}now(){return(0,p.default)().utc().format(this.isMySQL()?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")}async audit(e,t,a,i){return["DATA","COMMENT"].includes(null==i?void 0:i.op_type)?Promise.resolve(void 0):this.metaInsert(e,t,a,i)}async init(){return await this.connection.migrate.latest({migrationSource:new h.default,tableName:"xc_knex_migrations"}),await this.connection.migrate.latest({migrationSource:new g.default,tableName:"xc_knex_migrationsv2"}),!0}};O=i=s([(0,c.Injectable)(),r(1,(0,c.Optional)()),o("design:paramtypes",["function"==typeof(n=void 0!==b.NcConfig&&b.NcConfig)?n:Object,Object])],O),t.MetaService=O},14786:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const o=s(a(15081)),r=s(a(70256)),l=s(a(5566)),c=s(a(789)),d=s(a(31380)),u=s(a(36306)),p=s(a(69034)),m=s(a(96402)),f=s(a(39894)),h=s(a(62333)),g=s(a(15629)),_=s(a(83629));t.default=class{getMigrations(){return Promise.resolve(["project","m2m","fkn","viewType","viewName","nc_006_alter_nc_shared_views","nc_007_alter_nc_shared_views_1","nc_008_add_nc_shared_bases","nc_009_add_model_order","nc_010_add_parent_title_column","nc_011_remove_old_ses_plugin",..."true"===process.env.NC_CLOUD?["nc_012_cloud_cleanup"]:[]])}getMigrationName(e){return e}getMigration(e){switch(e){case"project":return o;case"m2m":return r;case"fkn":return l;case"viewType":return c;case"viewName":return d;case"nc_006_alter_nc_shared_views":return u;case"nc_007_alter_nc_shared_views_1":return p;case"nc_008_add_nc_shared_bases":return m;case"nc_009_add_model_order":return f;case"nc_010_add_parent_title_column":return h;case"nc_011_remove_old_ses_plugin":return g;case"nc_012_cloud_cleanup":return _}}}},79982:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const o=s(a(88724)),r=s(a(91733)),l=s(a(2228)),c=s(a(46990)),d=s(a(90943)),u=s(a(3586)),p=s(a(42505)),m=s(a(86948)),f=s(a(60914)),h=s(a(21483)),g=s(a(51314)),_=s(a(17888)),b=s(a(70696)),y=s(a(22474)),w=s(a(71530)),v=s(a(37030)),T=s(a(45818)),O=s(a(82803)),E=s(a(82177)),S=s(a(51058)),I=s(a(22671)),k=s(a(98206)),C=s(a(29962));t.default=class{getMigrations(){return Promise.resolve(["nc_011","nc_012_alter_column_data_types","nc_013_sync_source","nc_014_alter_column_data_types","nc_015_add_meta_col_in_column_table","nc_016_alter_hooklog_payload_types","nc_017_add_user_token_version_column","nc_018_add_meta_in_view","nc_019_add_meta_in_meta_tables","nc_020_kanban_view","nc_021_add_fields_in_token","nc_022_qr_code_column_type","nc_023_multiple_source","nc_024_barcode_column_type","nc_025_add_row_height","nc_026_map_view","nc_027_add_comparison_sub_op","nc_028_add_enable_scanner_in_form_columns_meta_table","nc_029_webhook","nc_030_add_description_field","nc_031_remove_fk_and_add_idx","nc_033_add_group_by","nc_034_erd_filter_and_notification"])}getMigrationName(e){return e}getMigration(e){switch(e){case"nc_011":return o;case"nc_012_alter_column_data_types":return r;case"nc_013_sync_source":return l;case"nc_014_alter_column_data_types":return c;case"nc_015_add_meta_col_in_column_table":return d;case"nc_016_alter_hooklog_payload_types":return u;case"nc_017_add_user_token_version_column":return p;case"nc_018_add_meta_in_view":return m;case"nc_019_add_meta_in_meta_tables":return f;case"nc_020_kanban_view":return h;case"nc_021_add_fields_in_token":return g;case"nc_022_qr_code_column_type":return _;case"nc_023_multiple_source":return b;case"nc_024_barcode_column_type":return y;case"nc_025_add_row_height":return w;case"nc_026_map_view":return v;case"nc_027_add_comparison_sub_op":return T;case"nc_028_add_enable_scanner_in_form_columns_meta_table":return O;case"nc_029_webhook":return E;case"nc_030_add_description_field":return S;case"nc_031_remove_fk_and_add_idx":return I;case"nc_033_add_group_by":return k;case"nc_034_erd_filter_and_notification":return C}}}},15081:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.createTable("nc_projects",(e=>{e.string("id",128).primary(),e.string("title"),e.string("status"),e.text("description"),e.text("config"),e.text("meta"),e.timestamps()})),await e.schema.createTable("nc_roles",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("type").defaultTo("CUSTOM"),e.string("description"),e.timestamps()})),await e("nc_roles").insert([{db_alias:"",project_id:"",title:"owner",description:"Can add/remove creators. And full edit database structures & fields.",type:"SYSTEM"},{db_alias:"",project_id:"",title:"creator",description:"Can fully edit database structure & values",type:"SYSTEM"},{db_alias:"",project_id:"",title:"editor",description:"Can edit records but cannot change structure of database/fields",type:"SYSTEM"},{db_alias:"",project_id:"",title:"commenter",description:"Can view and comment the records but cannot edit anything",type:"SYSTEM"},{db_alias:"",project_id:"",title:"viewer",description:"Can view the records but cannot edit anything",type:"SYSTEM"}]),await e.schema.createTable("nc_hooks",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("description",255),e.string("env").defaultTo("all"),e.string("tn"),e.string("type"),e.string("event"),e.string("operation"),e.boolean("async").defaultTo(!1),e.boolean("payload").defaultTo(!0),e.text("url","text"),e.text("headers","text"),e.text("condition","text"),e.text("notification","text"),e.integer("retries").defaultTo(0),e.integer("retry_interval").defaultTo(6e4),e.integer("timeout").defaultTo(6e4),e.boolean("active").defaultTo(!0),e.timestamps()})),await e("nc_hooks").insert({type:"AUTH_MIDDLEWARE"}),await e.schema.createTable("nc_store",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("key").index(),e.text("value","text"),e.string("type"),e.string("env"),e.string("tag"),e.timestamps()})),await e("nc_store").insert({key:"NC_DEBUG",value:JSON.stringify({"nc:app":!1,"nc:api:rest":!1,"nc:api:base":!1,"nc:api:gql":!1,"nc:api:grpc":!1,"nc:migrator":!1,"nc:datamapper":!1}),db_alias:""}),await e("nc_store").insert({key:"NC_PROJECT_COUNT",value:"0",db_alias:""}),await e.schema.createTable("nc_cron",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("description",255),e.string("env"),e.string("pattern"),e.string("webhook"),e.string("timezone").defaultTo("America/Los_Angeles"),e.boolean("active").defaultTo(!0),e.text("cron_handler"),e.text("payload"),e.text("headers"),e.integer("retries").defaultTo(0),e.integer("retry_interval").defaultTo(6e4),e.integer("timeout").defaultTo(6e4),e.timestamps()})),await e.schema.createTable("nc_acl",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("tn"),e.text("acl"),e.string("type").defaultTo("table"),e.timestamps()})),await e.schema.createTable("nc_models",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("alias"),e.string("type").defaultTo("table"),e.text("meta","mediumtext"),e.text("schema","text"),e.text("schema_previous","text"),e.text("services","mediumtext"),e.text("messages","text"),e.boolean("enabled").defaultTo(!0),e.string("parent_model_title"),e.string("show_as").defaultTo("table"),e.text("query_params","mediumtext"),e.integer("list_idx"),e.string("tags"),e.boolean("pinned"),e.timestamps(),e.index(["db_alias","title"])})),await e.schema.createTable("nc_relations",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("tn"),e.string("rtn"),e.string("_tn"),e.string("_rtn"),e.string("cn"),e.string("rcn"),e.string("_cn"),e.string("_rcn"),e.string("referenced_db_alias"),e.string("type"),e.string("db_type"),e.string("ur"),e.string("dr"),e.timestamps(),e.index(["db_alias","tn"])})),await e.schema.createTable("nc_routes",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("tn"),e.string("tnp"),e.string("tnc"),e.string("relation_type"),e.text("path","text"),e.string("type"),e.text("handler","text"),e.text("acl","text"),e.integer("order"),e.text("functions"),e.integer("handler_type").defaultTo(1),e.boolean("is_custom"),e.timestamps(),e.index(["db_alias","title","tn"])})),await e.schema.createTable("nc_resolvers",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.text("resolver","text"),e.string("type"),e.text("acl","text"),e.text("functions"),e.integer("handler_type").defaultTo(1),e.timestamps()})),await e.schema.createTable("nc_loaders",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("parent"),e.string("child"),e.string("relation"),e.string("resolver"),e.text("functions"),e.timestamps()})),await e.schema.createTable("nc_rpc",(e=>{e.increments(),e.string("project_id"),e.string("db_alias").defaultTo("db"),e.string("title"),e.string("tn"),e.text("service","text"),e.string("tnp"),e.string("tnc"),e.string("relation_type"),e.integer("order"),e.string("type"),e.text("acl","text"),e.text("functions","text"),e.integer("handler_type").defaultTo(1),e.timestamps()})),await e.schema.createTable("nc_projects_users",(e=>{e.string("project_id").index(),e.integer("user_id").unsigned().index(),e.text("roles"),e.timestamps()})),await e.schema.createTable("nc_shared_views",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("model_name"),e.text("meta","mediumtext"),e.text("query_params","mediumtext"),e.string("view_id"),e.boolean("show_all_fields"),e.boolean("allow_copy"),e.string("password"),e.timestamps()})),await e.schema.createTable("nc_disabled_models_for_role",(e=>{e.increments(),e.string("project_id"),e.string("db_alias",45),e.string("title",45),e.string("type",45),e.string("role",45),e.boolean("disabled").defaultTo(!0),e.string("tn"),e.string("rtn"),e.string("cn"),e.string("rcn"),e.string("relation_type"),e.timestamps(),e.index(["project_id","db_alias","title","type","role"],"xc_disabled124_idx")})),await e.schema.createTable("nc_plugins",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("title",45),e.text("description"),e.boolean("active").defaultTo(!1),e.float("rating"),e.string("version"),e.string("docs"),e.string("status").defaultTo("install"),e.string("status_details"),e.string("logo"),e.string("icon"),e.string("tags"),e.string("category"),e.text("input_schema"),e.text("input"),e.string("creator"),e.string("creator_website"),e.string("price"),e.timestamps()})),await e.schema.createTable("nc_audit",(e=>{e.increments(),e.string("user"),e.string("ip"),e.string("project_id"),e.string("db_alias"),e.string("model_name",100),e.string("model_id",100),e.string("op_type"),e.string("op_sub_type"),e.string("status"),e.text("description"),e.text("details"),e.index(["db_alias","project_id","model_name","model_id"],"`nc_audit_index`"),e.timestamps()})),await e.schema.createTable("nc_migrations",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.text("up"),e.text("down"),e.string("title").notNullable(),e.string("title_down").nullable(),e.string("description").nullable(),e.integer("batch").nullable(),e.string("checksum").nullable(),e.integer("status").nullable(),e.timestamps()})),await e.schema.createTable("nc_api_tokens",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("description"),e.text("permissions"),e.text("token"),e.string("expiry"),e.boolean("enabled").defaultTo(!0),e.timestamps()}))};t.down=async e=>{await e.schema.dropTable("nc_plugins"),await e.schema.dropTable("nc_disabled_models_for_role"),await e.schema.dropTable("nc_shared_views"),await e.schema.dropTable("nc_projects_users"),await e.schema.dropTable("nc_projects"),await e.schema.dropTable("nc_roles"),await e.schema.dropTable("nc_hooks"),await e.schema.dropTable("nc_store"),await e.schema.dropTable("nc_cron"),await e.schema.dropTable("nc_acl"),await e.schema.dropTable("nc_models"),await e.schema.dropTable("nc_relations"),await e.schema.dropTable("nc_routes"),await e.schema.dropTable("nc_resolvers"),await e.schema.dropTable("nc_loaders"),await e.schema.dropTable("nc_rpc"),await e.schema.dropTable("nc_audit"),await e.schema.dropTable("nc_migrations"),await e.schema.dropTable("nc_api_tokens")}},70256:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_models",(e=>{e.integer("mm"),e.text("m_to_m_meta")}))};t.down=async e=>{await e.schema.alterTable("nc_models",(e=>{e.dropColumns("mm","m_to_m_meta")}))}},5566:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_relations",(e=>{e.string("fkn")}))};t.down=async e=>{await e.schema.alterTable("nc_relations",(e=>{e.dropColumns("fkn")}))}},789:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.string("view_type")}))};t.down=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.dropColumns("view_type")}))}},31380:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.integer("view_name")}))};t.down=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.dropColumns("view_name")}))}},36306:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.dropColumns("view_name")}))};t.down=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.integer("view_name")}))}},69034:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.string("view_name",255)}))};t.down=async e=>{await e.schema.alterTable("nc_shared_views",(e=>{e.dropColumns("view_name")}))}},96402:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.createTable("nc_shared_bases",(e=>{e.increments(),e.string("project_id"),e.string("db_alias"),e.string("roles").defaultTo("viewer"),e.string("shared_base_id"),e.boolean("enabled").defaultTo(!0),e.string("password"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable("nc_shared_bases")}},39894:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_models",(e=>{e.float("order").unsigned().index(),e.float("view_order").unsigned().index()}))};t.down=async e=>{await e.schema.alterTable("nc_models",(e=>{e.dropColumn("order"),e.dropColumn("view_order")}))}},62333:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_disabled_models_for_role",(e=>{e.string("parent_model_title")}))};t.down=async e=>{await e.schema.alterTable("nc_disabled_models_for_role",(e=>{e.dropColumn("parent_model_title")}))}},15629:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e("nc_plugins").del().where({title:"SES"})};t.down=async e=>{}},83629:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.dropTable("nc_plugins"),await e.schema.dropTable("nc_disabled_models_for_role"),await e.schema.dropTable("nc_shared_views"),await e.schema.dropTable("nc_projects_users"),await e.schema.dropTable("nc_roles"),await e.schema.dropTable("nc_hooks"),await e.schema.dropTable("nc_cron"),await e.schema.dropTable("nc_acl"),await e.schema.dropTable("nc_models"),await e.schema.dropTable("nc_relations"),await e.schema.dropTable("nc_routes"),await e.schema.dropTable("nc_resolvers"),await e.schema.dropTable("nc_loaders"),await e.schema.dropTable("nc_rpc"),await e.schema.dropTable("nc_audit"),await e.schema.dropTable("nc_migrations"),await e.schema.dropTable("nc_projects")};t.down=async e=>{}},88724:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.createTable(i.MetaTable.PROJECT,(e=>{e.string("id",128).primary(),e.string("title"),e.string("prefix"),e.string("status"),e.text("description"),e.text("meta"),e.string("color"),e.string("uuid"),e.string("password"),e.string("roles"),e.boolean("deleted").defaultTo(!1),e.boolean("is_meta"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.BASES,(e=>{e.string("id",20).primary().notNullable(),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.string("alias"),e.text("config"),e.text("meta"),e.boolean("is_meta"),e.string("type"),e.string("inflection_column"),e.string("inflection_table"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.MODELS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.foreign("base_id").references(`${i.MetaTable.BASES}.id`),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.string("table_name"),e.string("title"),e.string("type").defaultTo("table"),e.text("meta","mediumtext"),e.text("schema","text"),e.boolean("enabled").defaultTo(!0),e.boolean("mm").defaultTo(!1),e.string("tags"),e.boolean("pinned"),e.boolean("deleted"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_model_id",20),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("title"),e.string("column_name"),e.string("uidt"),e.string("dt"),e.string("np"),e.string("ns"),e.string("clen"),e.string("cop"),e.boolean("pk"),e.boolean("pv"),e.boolean("rqd"),e.boolean("un"),e.string("ct"),e.boolean("ai"),e.boolean("unique"),e.string("cdf"),e.string("cc"),e.string("csn"),e.string("dtx"),e.string("dtxp"),e.string("dtxs"),e.boolean("au"),e.text("validate"),e.boolean("virtual"),e.boolean("deleted"),e.boolean("system").defaultTo(!1),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_RELATIONS,(e=>{e.string("id",20).primary().notNullable(),e.string("ref_db_alias"),e.string("type"),e.boolean("virtual"),e.string("db_type"),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_related_model_id",20),e.foreign("fk_related_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("fk_child_column_id",20),e.foreign("fk_child_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_parent_column_id",20),e.foreign("fk_parent_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_mm_model_id",20),e.foreign("fk_mm_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("fk_mm_child_column_id",20),e.foreign("fk_mm_child_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_mm_parent_column_id",20),e.foreign("fk_mm_parent_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("ur"),e.string("dr"),e.string("fk_index_name"),e.boolean("deleted"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_SELECT_OPTIONS,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("title"),e.string("color"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_LOOKUP,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_relation_column_id",20),e.foreign("fk_relation_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_lookup_column_id",20),e.foreign("fk_lookup_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.boolean("deleted"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_ROLLUP,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_relation_column_id",20),e.foreign("fk_relation_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_rollup_column_id",20),e.foreign("fk_rollup_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("rollup_function"),e.boolean("deleted"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.COL_FORMULA,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.text("formula").notNullable(),e.text("formula_raw"),e.text("error"),e.boolean("deleted"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.VIEWS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_model_id",20),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("title"),e.integer("type"),e.boolean("is_default"),e.boolean("show_system_fields"),e.string("lock_type").defaultTo("collaborative"),e.string("uuid"),e.string("password"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.HOOKS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_model_id",20),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("title"),e.string("description",255),e.string("env").defaultTo("all"),e.string("type"),e.string("event"),e.string("operation"),e.boolean("async").defaultTo(!1),e.boolean("payload").defaultTo(!0),e.text("url","text"),e.text("headers","text"),e.boolean("condition").defaultTo(!1),e.text("notification","text"),e.integer("retries").defaultTo(0),e.integer("retry_interval").defaultTo(6e4),e.integer("timeout").defaultTo(6e4),e.boolean("active").defaultTo(!0),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.HOOK_LOGS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_hook_id",20),e.string("type"),e.string("event"),e.string("operation"),e.boolean("test_call").defaultTo(!0),e.boolean("payload").defaultTo(!0),e.text("conditions"),e.text("notification","text"),e.string("error_code"),e.string("error_message"),e.text("error","text"),e.integer("execution_time"),e.string("response"),e.string("triggered_by"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.FILTER_EXP,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("fk_hook_id",20),e.foreign("fk_hook_id").references(`${i.MetaTable.HOOKS}.id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_parent_id",20),e.foreign("fk_parent_id").references(`${i.MetaTable.FILTER_EXP}.id`),e.string("logical_op"),e.string("comparison_op"),e.string("value"),e.boolean("is_group"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.SORT,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("direction").defaultTo(!1),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.SHARED_VIEWS,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.text("meta","mediumtext"),e.text("query_params","mediumtext"),e.string("view_id"),e.boolean("show_all_fields"),e.boolean("allow_copy"),e.string("password"),e.boolean("deleted"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.FORM_VIEW,(e=>{e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("heading"),e.string("subheading"),e.string("success_msg"),e.string("redirect_url"),e.string("redirect_after_secs"),e.string("email"),e.boolean("submit_another_form"),e.boolean("show_blank_form"),e.string("uuid"),e.string("banner_image_url"),e.string("logo_url"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.FORM_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("uuid"),e.string("label"),e.string("help"),e.string("description"),e.boolean("required"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.GALLERY_VIEW,(e=>{e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.boolean("next_enabled"),e.boolean("prev_enabled"),e.integer("cover_image_idx"),e.string("fk_cover_image_col_id",20),e.foreign("fk_cover_image_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("cover_image"),e.string("restrict_types"),e.string("restrict_size"),e.string("restrict_number"),e.boolean("public"),e.string("dimensions"),e.string("responsive_columns"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.GALLERY_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("uuid"),e.string("label"),e.string("help"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.GRID_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("base_id",20),e.string("project_id",128),e.string("uuid"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.GRID_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("base_id",20),e.string("project_id",128),e.string("uuid"),e.string("label"),e.string("help"),e.string("width").defaultTo("200px"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.KANBAN_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("base_id",20),e.string("project_id",128),e.boolean("show"),e.float("order"),e.string("uuid"),e.string("title"),e.boolean("public"),e.string("password"),e.boolean("show_all_fields"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.KANBAN_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("uuid"),e.string("label"),e.string("help"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.USERS,(e=>{e.string("id",20).primary().notNullable(),e.string("email"),e.string("password",255),e.string("salt",255),e.string("firstname"),e.string("lastname"),e.string("username"),e.string("refresh_token",255),e.string("invite_token",255),e.string("invite_token_expires",255),e.timestamp("reset_password_expires"),e.string("reset_password_token",255),e.string("email_verification_token",255),e.boolean("email_verified"),e.string("roles",255).defaultTo("editor"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.PROJECT_USERS,(e=>{e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.string("fk_user_id",20),e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`),e.text("roles"),e.boolean("starred"),e.boolean("pinned"),e.string("group"),e.string("color"),e.float("order"),e.float("hidden"),e.timestamp("opened_date"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.ORGS,(e=>{e.string("id",20).primary().notNullable(),e.string("title"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.TEAMS,(e=>{e.string("id",20).primary().notNullable(),e.string("title"),e.string("org_id",20),e.foreign("org_id").references(`${i.MetaTable.ORGS}.id`),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.TEAM_USERS,(e=>{e.string("org_id",20),e.foreign("org_id").references(`${i.MetaTable.ORGS}.id`),e.string("user_id",20),e.foreign("user_id").references(`${i.MetaTable.USERS}.id`),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.AUDIT,(e=>{e.string("id",20).primary().notNullable(),e.string("user"),e.string("ip"),e.string("base_id",20),e.foreign("base_id").references(`${i.MetaTable.BASES}.id`),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.string("fk_model_id",20),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`),e.string("row_id").index(),e.string("op_type"),e.string("op_sub_type"),e.string("status"),e.text("description"),e.text("details"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.PLUGIN,(e=>{e.string("id",20).primary().notNullable(),e.string("title",45),e.text("description"),e.boolean("active").defaultTo(!1),e.float("rating"),e.string("version"),e.string("docs"),e.string("status").defaultTo("install"),e.string("status_details"),e.string("logo"),e.string("icon"),e.string("tags"),e.string("category"),e.text("input_schema"),e.text("input"),e.string("creator"),e.string("creator_website"),e.string("price"),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.MODEL_ROLE_VISIBILITY,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("role",45),e.boolean("disabled").defaultTo(!0),e.timestamps(!0,!0)}))};t.down=async e=>{for(const t of i.orderedMetaTables)await e.schema.dropTable(t)}},91733:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{"sqlite3"!==e.client.config.client&&(await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("cdf").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("dtxp").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("cc").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("ct").alter()})))};t.down=async e=>{"sqlite3"!==e.client.config.client&&(await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("cdf").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("dtxp").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("cc").alter()})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("ct").alter()})))}},2228:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.createTable(i.MetaTable.SYNC_SOURCE,(e=>{e.string("id",20).primary().notNullable(),e.string("title"),e.string("type"),e.text("details"),e.boolean("deleted"),e.boolean("enabled").defaultTo(!0),e.float("order"),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.string("fk_user_id",20),e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`),e.timestamps(!0,!0)})),await e.schema.createTable(i.MetaTable.SYNC_LOGS,(e=>{e.string("id",20).primary().notNullable(),e.string("project_id",128),e.string("fk_sync_source_id",20),e.integer("time_taken"),e.string("status"),e.text("status_details"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.SYNC_LOGS),await e.schema.dropTable(i.MetaTable.SYNC_SOURCE)}},46990:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{"sqlite3"!==e.client.config.client&&(await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("success_msg").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("redirect_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("banner_image_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("logo_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.text("description").alter()})))};t.down=async e=>{"sqlite3"!==e.client.config.client&&(await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("success_msg").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("redirect_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("banner_image_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.string("logo_url").alter()})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.string("description").alter()})))}},90943:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.text("meta")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.dropColumn("meta")}))}},3586:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{"mssql"===e.client.config.client?(await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.dropColumn("payload")})),await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("payload")}))):"sqlite3"!==e.client.config.client&&await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("payload").alter()}))};t.down=async e=>{"sqlite3"!==e.client.config.client&&await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.boolean("payload").alter()}))}},42505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;t.up=async e=>{await e.schema.alterTable("nc_users_v2",(e=>{e.string("token_version")}))};t.down=async e=>{await e.schema.alterTable("nc_users_v2",(e=>{e.dropColumns("token_version")}))}},86948:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.text("meta")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.dropColumns("meta")}))}},60914:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.text("meta")})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.text("meta")})),await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.text("meta")})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW,(e=>{e.text("meta")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.dropColumns("meta")})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.dropColumns("meta")})),await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.dropColumns("meta")})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW,(e=>{e.dropColumns("meta")}))}},21483:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.KANBAN_VIEW,(e=>{e.string("fk_grp_col_id",20),e.foreign("fk_grp_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_cover_image_col_id",20),e.foreign("fk_cover_image_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.text("meta")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.KANBAN_VIEW,(e=>{e.dropColumns("meta"),e.dropColumns("fk_grp_col_id"),e.dropColumns("fk_cover_image_col_id")}))}},51314:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.API_TOKENS,(e=>{e.string("fk_user_id",20),e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`)})),await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.dropForeign(["fk_user_id"])}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.API_TOKENS,(e=>{e.dropForeign(["fk_user_id"]),e.dropColumn("fk_user_id")})),await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`)}))}},17888:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.createTable(i.MetaTable.COL_QRCODE,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_qr_value_column_id",20),e.foreign("fk_qr_value_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.boolean("deleted"),e.float("order"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.COL_QRCODE)}},70696:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.string("base_id",20),e.foreign("base_id").references(`${i.MetaTable.BASES}.id`)})),await e.schema.alterTable(i.MetaTable.BASES,(e=>{e.boolean("enabled").defaultTo(!0),e.float("order")})),await e.schema.alterTable(i.MetaTable.AUDIT,(e=>{e.dropForeign("base_id")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.dropColumn("base_id")})),await e.schema.alterTable(i.MetaTable.BASES,(e=>{e.dropColumn("enabled"),e.dropColumn("order")})),await e.schema.alterTable(i.MetaTable.AUDIT,(e=>{e.foreign("base_id").references(`${i.MetaTable.BASES}.id`)}))}},22474:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.createTable(i.MetaTable.COL_BARCODE,(e=>{e.string("id",20).primary().notNullable(),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("fk_barcode_value_column_id",20),e.foreign("fk_barcode_value_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("barcode_format",15),e.boolean("deleted"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.COL_BARCODE)}},71530:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.integer("row_height")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.dropColumns("row_height")}))}},37030:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.createTable(i.MetaTable.MAP_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.string("base_id",20),e.foreign("base_id").references(`${i.MetaTable.BASES}.id`),e.string("project_id",128),e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.string("uuid"),e.string("title"),e.string("fk_geo_data_col_id",20),e.foreign("fk_geo_data_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.text("meta"),e.dateTime("created_at"),e.dateTime("updated_at")})),await e.schema.createTable(i.MetaTable.MAP_VIEW_COLUMNS,(e=>{e.string("id",20).primary().notNullable(),e.string("base_id",20),e.string("project_id",128),e.string("fk_view_id",20),e.foreign("fk_view_id").references(`${i.MetaTable.MAP_VIEW}.fk_view_id`),e.string("fk_column_id",20),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.string("uuid"),e.string("label"),e.string("help"),e.boolean("show"),e.float("order"),e.timestamps(!0,!0)}))};t.down=async e=>{await e.schema.dropTable(i.MetaTable.MAP_VIEW),await e.schema.dropTable(i.MetaTable.MAP_VIEW_COLUMNS)}},45818:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.string("comparison_sub_op")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.dropColumns("comparison_sub_op")}))}},82803:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.boolean("enable_scanner")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.dropColumns("enable_scanner")}))}},82177:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{"mssql"===e.client.config.client?(await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.dropColumn("response")})),await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("response")}))):"sqlite3"!==e.client.config.client&&await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.text("response").alter()})),await e.schema.alterTable(i.MetaTable.HOOKS,(e=>{e.string("version")}))};t.down=async e=>{"sqlite3"!==e.client.config.client&&await e.schema.alterTable(i.MetaTable.HOOK_LOGS,(e=>{e.boolean("response").alter()})),await e.schema.alterTable(i.MetaTable.HOOKS,(e=>{e.dropColumn("version")}))}},51058:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.BASES,(e=>{e.string("description",255)})),await e.schema.alterTable(i.MetaTable.MODELS,(e=>{e.string("description",255)})),await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.string("description",255)})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.string("description",255)}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.BASES,(e=>{e.dropColumn("description")})),await e.schema.alterTable(i.MetaTable.MODELS,(e=>{e.dropColumn("description")})),await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.dropColumn("description")})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.dropColumn("description")}))}},22671:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.BASES}'`),await e.schema.alterTable(i.MetaTable.BASES,(e=>{e.dropForeign("project_id"),e.index("project_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.BASES}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.MODELS}'`),await e.schema.alterTable(i.MetaTable.MODELS,(e=>{e.dropForeign("base_id"),e.index("base_id"),e.dropForeign("project_id"),e.index("project_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.MODELS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COLUMNS}'`),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.dropForeign("fk_model_id"),e.index("fk_model_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_RELATIONS}'`),await e.schema.alterTable(i.MetaTable.COL_RELATIONS,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_related_model_id"),e.index("fk_related_model_id"),e.dropForeign("fk_child_column_id"),e.index("fk_child_column_id"),e.dropForeign("fk_parent_column_id"),e.index("fk_parent_column_id"),e.dropForeign("fk_mm_model_id"),e.index("fk_mm_model_id"),e.dropForeign("fk_mm_child_column_id"),e.index("fk_mm_child_column_id"),e.dropForeign("fk_mm_parent_column_id"),e.index("fk_mm_parent_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_RELATIONS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_SELECT_OPTIONS}'`),await e.schema.alterTable(i.MetaTable.COL_SELECT_OPTIONS,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_SELECT_OPTIONS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_LOOKUP}'`),await e.schema.alterTable(i.MetaTable.COL_LOOKUP,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_relation_column_id"),e.index("fk_relation_column_id"),e.dropForeign("fk_lookup_column_id"),e.index("fk_lookup_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_LOOKUP}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_QRCODE}'`),await e.schema.alterTable(i.MetaTable.COL_QRCODE,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_qr_value_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_QRCODE}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_BARCODE}'`),await e.schema.alterTable(i.MetaTable.COL_BARCODE,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_barcode_value_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_BARCODE}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_FORMULA}'`),await e.schema.alterTable(i.MetaTable.COL_FORMULA,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_FORMULA}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_ROLLUP}'`),await e.schema.alterTable(i.MetaTable.COL_ROLLUP,(e=>{e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_relation_column_id"),e.index("fk_relation_column_id"),e.dropForeign("fk_rollup_column_id"),e.index("fk_rollup_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.COL_ROLLUP}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.VIEWS}'`),await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.dropForeign("fk_model_id"),e.index("fk_model_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.VIEWS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.HOOKS}'`),await e.schema.alterTable(i.MetaTable.HOOKS,(e=>{e.dropForeign("fk_model_id"),e.index("fk_model_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.HOOKS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.FILTER_EXP}'`),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_hook_id"),e.index("fk_hook_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id"),e.dropForeign("fk_parent_id"),e.index("fk_parent_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.FILTER_EXP}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.SORT}'`),await e.schema.alterTable(i.MetaTable.SORT,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.SORT}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.SHARED_VIEWS}'`),await e.schema.alterTable(i.MetaTable.SHARED_VIEWS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.SHARED_VIEWS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.FORM_VIEW}'`),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.FORM_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.FORM_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.FORM_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.GALLERY_VIEW}'`),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_cover_image_col_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.GALLERY_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.GALLERY_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.GALLERY_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.GRID_VIEW}'`),await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.GRID_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.GRID_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.GRID_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.MAP_VIEW}'`),await e.schema.alterTable(i.MetaTable.MAP_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_geo_data_col_id"),e.index("fk_geo_data_col_id"),e.dropForeign("base_id"),e.dropForeign("project_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.MAP_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.MAP_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.MAP_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.MAP_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.KANBAN_VIEW}'`),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_grp_col_id"),e.index("fk_grp_col_id"),e.dropForeign("fk_cover_image_col_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.KANBAN_VIEW}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.KANBAN_VIEW_COLUMNS}'`),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id"),e.dropForeign("fk_column_id"),e.index("fk_column_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.KANBAN_VIEW_COLUMNS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.PROJECT_USERS}'`),await e.schema.alterTable(i.MetaTable.PROJECT_USERS,(e=>{e.dropForeign("project_id"),e.index("project_id"),e.dropForeign("fk_user_id"),e.index("fk_user_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.PROJECT_USERS}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.AUDIT}'`),await e.schema.alterTable(i.MetaTable.AUDIT,(e=>{e.dropForeign("project_id"),e.index("project_id"),e.dropForeign("fk_model_id"),e.index("fk_model_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.AUDIT}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.MODEL_ROLE_VISIBILITY}'`),await e.schema.alterTable(i.MetaTable.MODEL_ROLE_VISIBILITY,(e=>{e.dropForeign("fk_view_id"),e.index("fk_view_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.MODEL_ROLE_VISIBILITY}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.SYNC_SOURCE}'`),await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.dropForeign("project_id"),e.index("project_id"),e.dropForeign("base_id"),e.index("base_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.SYNC_SOURCE}'`),console.time(`Removed foreign keys and created index for columns in '${i.MetaTable.API_TOKENS}'`),await e.schema.alterTable(i.MetaTable.API_TOKENS,(e=>{e.dropForeign("fk_user_id"),e.index("fk_user_id")})),console.timeEnd(`Removed foreign keys and created index for columns in '${i.MetaTable.API_TOKENS}'`)};t.down=async e=>{await e.schema.alterTable(i.MetaTable.BASES,(e=>{e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`)})),await e.schema.alterTable(i.MetaTable.MODELS,(e=>{e.foreign("base_id").references(`${i.MetaTable.BASES}.id`),e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`)})),await e.schema.alterTable(i.MetaTable.COLUMNS,(e=>{e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_RELATIONS,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_related_model_id").references(`${i.MetaTable.MODELS}.id`),e.foreign("fk_child_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_parent_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_mm_model_id").references(`${i.MetaTable.MODELS}.id`),e.foreign("fk_mm_child_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_mm_parent_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_SELECT_OPTIONS,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_LOOKUP,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_relation_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_lookup_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_ROLLUP,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_relation_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_rollup_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_QRCODE,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_qr_value_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_BARCODE,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_barcode_value_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.COL_FORMULA,(e=>{e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.VIEWS,(e=>{e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`)})),await e.schema.alterTable(i.MetaTable.HOOKS,(e=>{e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`)})),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("fk_hook_id").references(`${i.MetaTable.HOOKS}.id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_parent_id").references(`${i.MetaTable.FILTER_EXP}.id`)})),await e.schema.alterTable(i.MetaTable.SORT,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.SHARED_VIEWS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`)})),await e.schema.alterTable(i.MetaTable.FORM_VIEW,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`)})),await e.schema.alterTable(i.MetaTable.FORM_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.FORM_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("fk_cover_image_col_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.GALLERY_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.GALLERY_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.GRID_VIEW,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`)})),await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.GRID_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.MAP_VIEW,(e=>{e.string("fk_view_id",20).primary(),e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("base_id").references(`${i.MetaTable.BASES}.id`),e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.foreign("fk_geo_data_col_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.MAP_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.MAP_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`),e.foreign("fk_grp_col_id").references(`${i.MetaTable.COLUMNS}.id`),e.foreign("fk_cover_image_col_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.KANBAN_VIEW_COLUMNS,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.KANBAN_VIEW}.fk_view_id`),e.foreign("fk_column_id").references(`${i.MetaTable.COLUMNS}.id`)})),await e.schema.alterTable(i.MetaTable.PROJECT_USERS,(e=>{e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`)})),await e.schema.alterTable(i.MetaTable.AUDIT,(e=>{e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`),e.foreign("fk_model_id").references(`${i.MetaTable.MODELS}.id`)})),await e.schema.alterTable(i.MetaTable.MODEL_ROLE_VISIBILITY,(e=>{e.foreign("fk_view_id").references(`${i.MetaTable.VIEWS}.id`)})),await e.schema.alterTable(i.MetaTable.SYNC_SOURCE,(e=>{e.foreign("project_id").references(`${i.MetaTable.PROJECT}.id`)})),await e.schema.alterTable(i.MetaTable.API_TOKENS,(e=>{e.foreign("fk_user_id").references(`${i.MetaTable.USERS}.id`),e.foreign("base_id").references(`${i.MetaTable.BASES}.id`)}))}},98206:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.boolean("group_by"),e.float("group_by_order"),e.string("group_by_sort")}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.GRID_VIEW_COLUMNS,(e=>{e.dropColumn("group_by"),e.dropColumn("group_by_order"),e.dropColumn("group_by_sort")}))}},29962:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.down=t.up=void 0;const i=a(13609);t.up=async e=>{await e.schema.hasColumn(i.MetaTable.BASES,"erd_uuid")||await e.schema.alterTable(i.MetaTable.BASES,(e=>{e.string("erd_uuid")})),await e.schema.hasTable(i.MetaTable.NOTIFICATION)||await e.schema.createTable(i.MetaTable.NOTIFICATION,(e=>{e.string("id",20).primary().notNullable(),e.string("type",40),e.text("body"),e.boolean("is_read").defaultTo(!1),e.boolean("is_deleted").defaultTo(!1),e.string("fk_user_id",20).index(),e.timestamps(!0,!0),e.index("created_at")})),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.text("value").alter()}))};t.down=async e=>{await e.schema.alterTable(i.MetaTable.BASES,(e=>{e.dropColumn("erd_uuid")})),e.schema.dropTable(i.MetaTable.NOTIFICATION),await e.schema.alterTable(i.MetaTable.FILTER_EXP,(e=>{e.string("value",255).alter()}))}},51971:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(a(51401),t);const o=s(a(51401));t.default=o.default},68382:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Acl=t.AclMiddleware=t.ExtractIdsMiddleware=t.getRolesLabels=t.rolesLabel=void 0;const r=a(26481),l=a(50143),c=a(68281),d=a(21964),u=a(15147),p=o(a(65377)),m=a(51971);function f(e){return e.filter((e=>![c.OrgUserRoles.CREATOR,c.OrgUserRoles.VIEWER].includes(e))).map((e=>t.rolesLabel[e]))}t.rolesLabel={[c.OrgUserRoles.SUPER_ADMIN]:"Super Admin",[c.OrgUserRoles.CREATOR]:"Org Creator",[c.OrgUserRoles.VIEWER]:"Org Viewer",[c.ProjectRoles.OWNER]:"Project Owner",[c.ProjectRoles.CREATOR]:"Project Creator",[c.ProjectRoles.VIEWER]:"Project Viewer",[c.ProjectRoles.EDITOR]:"Project Editor",[c.ProjectRoles.COMMENTER]:"Project Commenter"},t.getRolesLabels=f;let h=class{async use(e,t,a){var i,n;const{params:s}=e;if(s.projectName){const a=await u.Project.getByTitleOrId(s.projectName);a&&(e.ncProjectId=a.id,t.locals.project=a)}if(s.projectId)e.ncProjectId=s.projectId;else if(s.dashboardId)e.ncProjectId=s.dashboardId;else if(s.tableId||s.modelId){const t=await u.Model.getByIdOrName({id:s.tableId||s.modelId});e.ncProjectId=null==t?void 0:t.project_id}else if(s.viewId){const t=await u.View.get(s.viewId)||await u.Model.get(s.viewId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.formViewId||s.gridViewId||s.kanbanViewId||s.galleryViewId){const t=await u.View.get(s.formViewId||s.gridViewId||s.kanbanViewId||s.galleryViewId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.publicDataUuid){const t=await u.View.getByUUID(e.params.publicDataUuid);e.ncProjectId=null==t?void 0:t.project_id}else if(s.hookId){const t=await u.Hook.get(s.hookId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.gridViewColumnId){const t=await u.GridViewColumn.get(s.gridViewColumnId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.formViewColumnId){const t=await u.FormViewColumn.get(s.formViewColumnId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.galleryViewColumnId){const t=await u.GalleryViewColumn.get(s.galleryViewColumnId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.columnId){const t=await u.Column.get({colId:s.columnId});e.ncProjectId=null==t?void 0:t.project_id}else if(s.filterId){const t=await u.Filter.get(s.filterId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.filterParentId){const t=await u.Filter.get(s.filterParentId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.sortId){const t=await u.Sort.get(s.sortId);e.ncProjectId=null==t?void 0:t.project_id}else if(s.syncId){const t=await u.SyncSource.get(e.params.syncId);e.ncProjectId=t.project_id}else if(["/api/v1/db/meta/audits/rows/:rowId/update","/api/v1/db/meta/audits/comments"].some((t=>e.route.path===t))&&"POST"===e.method&&(null===(i=e.body)||void 0===i?void 0:i.fk_model_id)){const t=await u.Model.getByIdOrName({id:e.body.fk_model_id});e.ncProjectId=null==t?void 0:t.project_id}else if(["/api/v1/db/meta/audits/comments/count","/api/v1/db/meta/audits/comments"].some((t=>e.route.path===t))&&"GET"===e.method&&e.query.fk_model_id){const t=await u.Model.getByIdOrName({id:null===(n=e.query)||void 0===n?void 0:n.fk_model_id});e.ncProjectId=null==t?void 0:t.project_id}else["/auth/user/me","/api/v1/db/auth/user/me","/api/v1/auth/user/me","/api/v1/db/meta/plugins/webhook"].some((t=>e.route.path===t))&&e.query.project_id&&(e.ncProjectId=e.query.project_id);a()}async canActivate(e){return await this.use(e.switchToHttp().getRequest(),e.switchToHttp().getResponse(),(()=>{})),!0}};h=n([(0,r.Injectable)()],h),t.ExtractIdsMiddleware=h;let g=class{constructor(e){this.reflector=e}async intercept(e,t){var a,i;const n=this.reflector.get("permission",e.getHandler()),s=this.reflector.get("allowedRoles",e.getHandler()),o=this.reflector.get("blockApiTokenAccess",e.getHandler()),r=this.reflector.get("scope",e.getHandler()),l=e.switchToHttp().getRequest(),u=!0===(null===(a=l.user.roles)||void 0===a?void 0:a[c.OrgUserRoles.SUPER_ADMIN])?c.OrgUserRoles.SUPER_ADMIN:function(e,t){return"project"===t?null==e?void 0:e.project_roles:"org"===t?null==e?void 0:e.roles:void 0}(l.user,r);u||m.NcError.forbidden("Unauthorized access"),u===c.OrgUserRoles.SUPER_ADMIN&&(l.user.project_roles={[c.ProjectRoles.OWNER]:!0});const h=(0,c.extractRolesObj)(u);(null===(i=null==l?void 0:l.user)||void 0===i?void 0:i.is_api_token)&&o&&m.NcError.forbidden("Not allowed with API token"),s&&!s.some((e=>null==h?void 0:h[e]))||(null==h?void 0:h.creator)||(null==h?void 0:h.owner)||(null==h?void 0:h.editor)||(null==h?void 0:h.viewer)||(null==h?void 0:h.commenter)||(null==h?void 0:h[c.OrgUserRoles.SUPER_ADMIN])||(null==h?void 0:h[c.OrgUserRoles.CREATOR])||(null==h?void 0:h[c.OrgUserRoles.VIEWER])||m.NcError.unauthorized("Unauthorized access");return h&&Object.entries(h).some((([e,t])=>t&&p.default[e]&&("*"===p.default[e]||p.default[e].exclude&&!p.default[e].exclude[n]||p.default[e].include&&p.default[e].include[n])))||m.NcError.forbidden(`${n} - ${f(Object.keys(h).filter((e=>h[e])))} : Not allowed`),t.handle().pipe((0,d.map)((e=>e)))}};g=n([(0,r.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.Reflector&&l.Reflector)?i:Object])],g),t.AclMiddleware=g;t.Acl=(e,{scope:t="project",allowedRoles:a,blockApiTokenAccess:i}={})=>(n,s,o)=>{(0,r.SetMetadata)("permission",e)(n,s,o),(0,r.SetMetadata)("scope",t)(n,s,o),(0,r.SetMetadata)("allowedRoles",a)(n,s,o),(0,r.SetMetadata)("blockApiTokenAccess",i)(n,s,o),(0,r.UseInterceptors)(g)(n,s,o)}},93768:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalMiddleware=void 0;const s=a(26481),o=n(a(27552));let r=class{use(e,t,a){var i,n,s,r;e.ncSiteUrl=(null===(s=null===(n=null===(i=o.default.config)||void 0===i?void 0:i.envs)||void 0===n?void 0:n[o.default.env])||void 0===s?void 0:s.publicUrl)||(null===(r=o.default.config)||void 0===r?void 0:r.publicUrl)||e.protocol+"://"+e.get("host"),e.ncFullUrl=e.protocol+"://"+e.get("host")+e.originalUrl,a()}};r=i([(0,s.Injectable)()],r),t.GlobalMiddleware=r},59633:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GuiMiddleware=void 0;const r=a(26481),l=o(a(58890)),c=a(35793);let d=class{constructor(e){this.configService=e}use(e,t,a){const i=this.configService.get("dashboardPath",{infer:!0});l.default.expressMiddleware(i)(e,t,a)}};d=n([(0,r.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==c.ConfigService&&c.ConfigService)?i:Object])],d),t.GuiMiddleware=d},20600:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(30754),s=a(13609),o=i(a(27552)),r=i(a(37912));class l{constructor(e){Object.assign(this,e)}static async insert(e,t=o.default.ncMeta){const a=(0,n.nanoid)(40);return await t.metaInsert(null,null,s.MetaTable.API_TOKENS,{description:e.description,token:a,fk_user_id:e.fk_user_id}),await r.default.appendToList(s.CacheScope.API_TOKEN,[],`${s.CacheScope.API_TOKEN}:${a}`),this.getByToken(a)}static async list(e,t=o.default.ncMeta){const a=await t.metaList(null,null,s.MetaTable.API_TOKENS,{condition:{fk_user_id:e}});return null==a?void 0:a.map((e=>new l(e)))}static async delete(e,t=o.default.ncMeta){return await r.default.deepDel(s.CacheScope.API_TOKEN,`${s.CacheScope.API_TOKEN}:${e}`,s.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(null,null,s.MetaTable.API_TOKENS,{token:e})}static async getByToken(e,t=o.default.ncMeta){let a=e&&await r.default.get(`${s.CacheScope.API_TOKEN}:${e}`,s.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet(null,null,s.MetaTable.API_TOKENS,{token:e}),await r.default.set(`${s.CacheScope.API_TOKEN}:${e}`,a)),a&&new l(a)}static async count({fk_user_id:e,includeUnmappedToken:t=!1}={},a=o.default.ncMeta){var i,n;const r=a.knex(s.MetaTable.API_TOKENS);return e&&r.where(`${s.MetaTable.API_TOKENS}.fk_user_id`,e),t&&r.orWhereNull(`${s.MetaTable.API_TOKENS}.fk_user_id`),null!==(n=null===(i=await r.count("id",{as:"count"}).first())||void 0===i?void 0:i.count)&&void 0!==n?n:0}static async listWithCreatedBy({limit:e=10,offset:t=0,fk_user_id:a,includeUnmappedToken:i=!1},n=o.default.ncMeta){const r=n.knex(s.MetaTable.API_TOKENS).offset(t).limit(e).select(`${s.MetaTable.API_TOKENS}.id`,`${s.MetaTable.API_TOKENS}.token`,`${s.MetaTable.API_TOKENS}.description`,`${s.MetaTable.API_TOKENS}.fk_user_id`,`${s.MetaTable.API_TOKENS}.project_id`,`${s.MetaTable.API_TOKENS}.created_at`,`${s.MetaTable.API_TOKENS}.updated_at`).select(n.knex(s.MetaTable.USERS).select("email").whereRaw(`${s.MetaTable.USERS}.id = ${s.MetaTable.API_TOKENS}.fk_user_id`).as("created_by"));return a&&r.where(`${s.MetaTable.API_TOKENS}.fk_user_id`,a),i&&r.orWhereNull(`${s.MetaTable.API_TOKENS}.fk_user_id`),r}}t.default=l},67094:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(33505)),o=i(a(27552)),r=a(33402),l=a(13609);class c{constructor(e){Object.assign(this,e)}static async get(e){const t=await o.default.ncMeta.metaGet2(null,null,l.MetaTable.AUDIT,e);return t&&new c(t)}static async insert(e,t=o.default.ncMeta,{forceAwait:a}={forceAwait:"true"===process.env.TEST}){if("true"===process.env.NC_DISABLE_AUDIT)return;const i=async()=>{const a=(0,r.extractProps)(e,["user","ip","base_id","project_id","row_id","fk_model_id","op_type","op_sub_type","status","description","details"]);if((!a.project_id||!a.base_id)&&a.fk_model_id){const e=await s.default.getByIdOrName({id:a.fk_model_id},t);a.project_id=e.project_id,a.base_id=e.base_id}return await t.metaInsert2(null,null,l.MetaTable.AUDIT,a)};return a?await i():i()}static async commentsCount(e){const t=await o.default.ncMeta.knex(l.MetaTable.AUDIT).count("id",{as:"count"}).select("row_id").whereIn("row_id",e.ids).where("fk_model_id",e.fk_model_id).where("op_type",n.AuditOperationTypes.COMMENT).groupBy("row_id");return null==t?void 0:t.map((e=>new c(e)))}static async commentsList(e){const t=o.default.ncMeta.knex(l.MetaTable.AUDIT).where("row_id",e.row_id).where("fk_model_id",e.fk_model_id).orderBy("created_at","desc");"true"==e.comments_only&&t.where("op_type",n.AuditOperationTypes.COMMENT);const a=await t;return null==a?void 0:a.map((e=>new c(e)))}static async projectAuditList(e,{limit:t=25,offset:a=0,baseId:i}){return await o.default.ncMeta.metaList2(null,null,l.MetaTable.AUDIT,{condition:Object.assign({project_id:e},i?{base_id:i}:{}),orderBy:{created_at:"desc"},limit:t,offset:a})}static async projectAuditCount(e,t){var a;return null===(a=await o.default.ncMeta.knex(l.MetaTable.AUDIT).where(Object.assign({project_id:e},t?{base_id:t}:{})).count("id",{as:"count"}).first())||void 0===a?void 0:a.count}static async deleteRowComments(e,t=o.default.ncMeta){return t.metaDelete(null,null,l.MetaTable.AUDIT,{fk_model_id:e})}static async commentUpdate(e,t,a=o.default.ncMeta){const i=(0,r.extractProps)(t,["description"]);return await a.metaUpdate(null,null,l.MetaTable.AUDIT,i,e)}static async baseAuditList(e,{limit:t=25,offset:a=0}){return await o.default.ncMeta.metaList2(null,null,l.MetaTable.AUDIT,{condition:{base_id:e},orderBy:{created_at:"desc"},limit:t,offset:a})}static async baseAuditCount(e){var t;return null===(t=await o.default.ncMeta.knex(l.MetaTable.AUDIT).where({base_id:e}).count("id",{as:"count"}).first())||void 0===t?void 0:t.count}}t.default=c},78881:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(27552)),s=i(a(37912)),o=a(33402),r=a(13609),l=a(15147);class c{constructor(e){Object.assign(this,e)}static async insert(e,t=n.default.ncMeta){const a=(0,o.extractProps)(e,["fk_column_id","fk_barcode_value_column_id","barcode_format"]);return await t.metaInsert2(null,null,r.MetaTable.COL_BARCODE,a),this.read(e.fk_column_id,t)}static async read(e,t=n.default.ncMeta){let a=e&&await s.default.get(`${r.CacheScope.COL_BARCODE}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,r.MetaTable.COL_BARCODE,{fk_column_id:e}),await s.default.set(`${r.CacheScope.COL_BARCODE}:${e}`,a)),a?new c(a):null}static async update(e,t,a=n.default.ncMeta){const i=(0,o.extractProps)(t,["fk_column_id","fk_barcode_value_column_id","barcode_format"]),l=`${r.CacheScope.COL_BARCODE}:${e}`;let c=await s.default.get(l,r.CacheGetType.TYPE_OBJECT);c&&(c=Object.assign(Object.assign({},c),i),await s.default.set(l,c)),await a.metaUpdate(null,null,r.MetaTable.COL_BARCODE,i,e)}async getValueColumn(){return l.Column.get({colId:this.fk_barcode_value_column_id})}}t.default=c},23520:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(75666)),o=a(25828),r=i(a(33505)),l=i(a(61770)),c=i(a(72481)),d=i(a(37912)),u=a(13609),p=i(a(27552)),m=a(33402),f=a(51401),h=i(a(19356));class g{constructor(e){Object.assign(this,e)}static castType(e){return e&&new g(e)}static async createBase(e,t=p.default.ncMeta){var a,i,n;const o=(0,m.extractProps)(e,["id","alias","config","type","is_meta","inflection_column","inflection_table","order","enabled"]);o.config=s.default.AES.encrypt(JSON.stringify(e.config),null===(n=null===(i=null===(a=p.default.getConfig())||void 0===a?void 0:a.auth)||void 0===i?void 0:i.jwt)||void 0===n?void 0:n.secret).toString();const{id:r}=await t.metaInsert2(e.projectId,null,u.MetaTable.BASES,o);await d.default.appendToList(u.CacheScope.BASE,[e.projectId],`${u.CacheScope.BASE}:${r}`);const l=await this.get(r,t);return await this.reorderBases(e.projectId),l}static async updateBase(e,t,a=p.default.ncMeta){var i,n,o;const r=await g.get(e,a);r||f.NcError.badRequest("Wrong base id!"),await d.default.deepDel(u.CacheScope.BASE,`${u.CacheScope.BASE}:${e}`,u.CacheDelDirection.CHILD_TO_PARENT);const l=(0,m.extractProps)(t,["alias","config","type","is_meta","inflection_column","inflection_table","order","enabled"]);l.config&&(l.config=s.default.AES.encrypt(JSON.stringify(t.config),null===(o=null===(n=null===(i=p.default.getConfig())||void 0===i?void 0:i.auth)||void 0===n?void 0:n.jwt)||void 0===o?void 0:o.secret).toString()),l.type||(l.type=r.type),await a.metaUpdate(t.projectId,null,u.MetaTable.BASES,l,r.id),await d.default.appendToList(u.CacheScope.BASE,[t.projectId],`${u.CacheScope.BASE}:${r.id}`);const c=await this.get(r.id,a);return t.skipReorder||await this.reorderBases(t.projectId,c.id,a),c}static async list(e,t=p.default.ncMeta){const a=await d.default.getList(u.CacheScope.BASE,[e.projectId]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(e.projectId,null,u.MetaTable.BASES,{orderBy:{order:"asc"}}),await d.default.setList(u.CacheScope.BASE,[e.projectId],i)),i.sort(((e,t)=>{var a,i;return(null!==(a=e.order)&&void 0!==a?a:1/0)-(null!==(i=t.order)&&void 0!==i?i:1/0)})),null==i?void 0:i.map((e=>this.castType(e)))}static async get(e,t=p.default.ncMeta){let a=e&&await d.default.get(`${u.CacheScope.BASE}:${e}`,u.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,u.MetaTable.BASES,e),await d.default.set(`${u.CacheScope.BASE}:${e}`,a)),this.castType(a)}static async getByUUID(e,t=p.default.ncMeta){const a=await t.metaGet2(null,null,u.MetaTable.BASES,{erd_uuid:e});return a?(delete a.config,this.castType(a)):null}static async reorderBases(e,t,a=p.default.ncMeta){const i=await this.list({projectId:e},a);if(t){const e=i.splice(i.indexOf(i.find((e=>e.id===t))),1);e.length&&i.splice(e[0].order-1,0,e[0])}for(const[e,t]of Object.entries(i))await d.default.deepDel(u.CacheScope.BASE,`${u.CacheScope.BASE}:${t.id}`,u.CacheDelDirection.CHILD_TO_PARENT),t.order=parseInt(e)+1,await a.metaUpdate(t.project_id,null,u.MetaTable.BASES,{order:t.order},t.id),await d.default.appendToList(u.CacheScope.BASE,[t.project_id],`${u.CacheScope.BASE}:${t.id}`),await d.default.set(`${u.CacheScope.BASE}:${t.id}`,t)}async getConnectionConfig(){var e;const t=this.getConfig();return"sqlite3"===(null==t?void 0:t.client)&&(t.connection.filename=t.connection.filename||(null===(e=t.connection)||void 0===e?void 0:e.connection.filename)),t}getConfig(){var e,t,a,i,n;if(this.is_meta){const a=null===(t=null===(e=p.default.getConfig())||void 0===e?void 0:e.meta)||void 0===t?void 0:t.db,i=Object.assign({},a);return"sqlite3"===i.client&&(i.connection=a),i}return JSON.parse(s.default.AES.decrypt(this.config,null===(n=null===(i=null===(a=p.default.getConfig())||void 0===a?void 0:a.auth)||void 0===i?void 0:i.jwt)||void 0===n?void 0:n.secret).toString(s.default.enc.Utf8))}getProject(e=p.default.ncMeta){return l.default.get(this.project_id,e)}async delete(e=p.default.ncMeta,{force:t}={}){(await g.list({projectId:this.project_id},e))[0].id!==this.id||t||f.NcError.badRequest("Cannot delete first base");const a=await r.default.list({base_id:this.id,project_id:this.project_id},e),i=[],s={[n.UITypes.Lookup]:1,[n.UITypes.Rollup]:2,[n.UITypes.ForeignKey]:3,[n.UITypes.LinkToAnotherRecord]:4};for(const t of a)for(const a of await t.getColumns(e)){let e=null,t=null;switch(a.uidt){case n.UITypes.Rollup:e=u.MetaTable.COL_ROLLUP,t=u.CacheScope.COL_ROLLUP;break;case n.UITypes.Lookup:e=u.MetaTable.COL_LOOKUP,t=u.CacheScope.COL_LOOKUP;break;case n.UITypes.ForeignKey:case n.UITypes.LinkToAnotherRecord:e=u.MetaTable.COL_RELATIONS,t=u.CacheScope.COL_RELATION}e&&t&&i.push({col:a,colOptionTableName:e,cacheScopeName:t})}i.sort(((e,t)=>s[e.col.uidt]-s[t.col.uidt]));for(const t of i)await e.metaDelete(null,null,t.colOptionTableName,{fk_column_id:t.col.id}),await d.default.deepDel(t.cacheScopeName,`${t.cacheScopeName}:${t.col.id}`,u.CacheDelDirection.CHILD_TO_PARENT);for(const t of a)await t.delete(e,!0);await d.default.deepDel(u.CacheScope.BASE,`${u.CacheScope.BASE}:${this.id}`,u.CacheDelDirection.CHILD_TO_PARENT);const o=await c.default.list(this.project_id,this.id,e);for(const t of o)await c.default.delete(t.id,e);return await h.default.deleteAwait(this),await e.metaDelete(null,null,u.MetaTable.BASES,this.id)}async getModels(e=p.default.ncMeta){return await r.default.list({project_id:this.project_id,base_id:this.id},e)}async shareErd(e=p.default.ncMeta){if(!this.erd_uuid){const t=(0,o.v4)();this.erd_uuid=t;const a=`${u.CacheScope.BASE}:${this.id}`,i=await d.default.get(a,u.CacheGetType.TYPE_OBJECT);i&&(i.erd_uuid=t,await d.default.set(a,i)),await e.metaUpdate(null,null,u.MetaTable.BASES,{erd_uuid:this.erd_uuid},this.id)}return this}async disableShareErd(e=p.default.ncMeta){if(this.erd_uuid){this.erd_uuid=null;const t=`${u.CacheScope.BASE}:${this.id}`,a=await d.default.get(t,u.CacheGetType.TYPE_OBJECT);a&&(a.erd_uuid=null,await d.default.set(t,a)),await e.metaUpdate(null,null,u.MetaTable.BASES,{erd_uuid:this.erd_uuid},this.id)}return this}isMeta(e=!1,t=0){return e?0===t&&this.is_meta:this.is_meta}}t.default=g},83889:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(77961)),o=i(a(32188)),r=i(a(82994)),l=i(a(74317)),c=i(a(73140)),d=i(a(33505)),u=i(a(86026)),p=i(a(99998)),m=i(a(41186)),f=i(a(50944)),h=i(a(78881)),g=a(15147),_=a(33402),b=a(51401),y=i(a(71079)),w=i(a(27552)),v=a(13609),T=i(a(37912)),O=a(36734);class E{constructor(e){Object.assign(this,e)}async getModel(e=w.default.ncMeta){return d.default.getByIdOrName({id:this.fk_model_id},e)}static async insert(e,t=w.default.ncMeta){e.fk_model_id||b.NcError.badRequest("Missing model id");const a=(0,_.extractProps)(e,["id","fk_model_id","column_name","title","uidt","dt","np","ns","clen","cop","pk","rqd","un","ct","ai","unique","cdf","cc","csn","dtx","dtxp","dtxs","au","pv","order","project_id","base_id","system","meta"]);if(a.column_name||(a.column_name=e.cn),a.title||(a.title=e._cn),a.meta&&"object"==typeof a.meta&&(a.meta=JSON.stringify(a.meta)),e.validate&&("string"==typeof e.validate?a.validate=e.validate:a.validate=JSON.stringify(e.validate)),!e.project_id||!e.base_id){const i=await d.default.getByIdOrName({id:e.fk_model_id},t);a.project_id=i.project_id,a.base_id=i.base_id}if(!e.uidt)throw new Error("UI Datatype not found");const i=await t.metaInsert2(null,null,v.MetaTable.COLUMNS,a),n=await this.get({colId:i.id},t);return await T.default.appendToList(v.CacheScope.COLUMN,[e.fk_model_id],`${v.CacheScope.COLUMN}:${i.id}`),await this.insertColOption(e,i.id,t),await u.default.insertColumnToAllViews({fk_column_id:i.id,fk_model_id:e.fk_model_id,show:!0,column_order:e.column_order},t),n}static async insertColOption(e,t,a=w.default.ncMeta){var i,d,u,p;switch(e.uidt||e.ui_data_type){case n.UITypes.Lookup:await r.default.insert({fk_column_id:t,fk_relation_column_id:e.fk_relation_column_id,fk_lookup_column_id:e.fk_lookup_column_id},a);break;case n.UITypes.Rollup:await l.default.insert({fk_column_id:t,fk_relation_column_id:e.fk_relation_column_id,fk_rollup_column_id:e.fk_rollup_column_id,rollup_function:e.rollup_function},a);break;case n.UITypes.Links:case n.UITypes.LinkToAnotherRecord:await o.default.insert({fk_column_id:t,type:e.type,fk_child_column_id:e.fk_child_column_id,fk_parent_column_id:e.fk_parent_column_id,fk_mm_model_id:e.fk_mm_model_id,fk_mm_child_column_id:e.fk_mm_child_column_id,fk_mm_parent_column_id:e.fk_mm_parent_column_id,ur:e.ur,dr:e.dr,fk_index_name:e.fk_index_name,fk_related_model_id:e.fk_related_model_id,virtual:e.virtual},a);break;case n.UITypes.QrCode:await f.default.insert({fk_column_id:t,fk_qr_value_column_id:e.fk_qr_value_column_id},a);break;case n.UITypes.Barcode:await h.default.insert({fk_column_id:t,fk_barcode_value_column_id:e.fk_barcode_value_column_id,barcode_format:e.barcode_format},a);break;case n.UITypes.Formula:await s.default.insert({fk_column_id:t,formula:e.formula,formula_raw:e.formula_raw},a);break;case n.UITypes.MultiSelect:if(null===(i=e.colOptions)||void 0===i?void 0:i.options){const i=[];for(const[a,n]of e.colOptions.options.entries()||[].entries())"enum"!==e.dt&&"set"!==e.dt||(n.title=n.title.trimEnd()),i.push(Object.assign(Object.assign({},n),{fk_column_id:t,order:a+1}));await c.default.bulkInsert(i,a)}else{const i=["#cfdffe","#d0f1fd","#c2f5e8","#ffdaf6","#ffdce5","#fee2d5","#ffeab6","#d1f7c4","#ede2fe","#eeeeee"],n=[];for(const[a,s]of(null===(d=e.dtxp)||void 0===d?void 0:d.split(",").entries())||[].entries())n.push({fk_column_id:t,title:s.replace(/^'/,"").replace(/'$/,""),order:a+1,color:i[a%i.length]});await c.default.bulkInsert(n,a)}break;case n.UITypes.SingleSelect:if(null===(u=e.colOptions)||void 0===u?void 0:u.options){const i=[];for(const[a,n]of e.colOptions.options.entries()||[].entries())"enum"!==e.dt&&"set"!==e.dt||(n.title=n.title.trimEnd()),i.push(Object.assign(Object.assign({},n),{fk_column_id:t,order:a+1}));await c.default.bulkInsert(i,a)}else{const i=["#cfdffe","#d0f1fd","#c2f5e8","#ffdaf6","#ffdce5","#fee2d5","#ffeab6","#d1f7c4","#ede2fe","#eeeeee"],n=[];for(const[a,s]of(null===(p=e.dtxp)||void 0===p?void 0:p.split(",").entries())||[].entries())n.push({fk_column_id:t,title:s.replace(/^'/,"").replace(/'$/,""),order:a+1,color:i[a%i.length]});await c.default.bulkInsert(n,a)}}}async getColOptions(e=w.default.ncMeta){let t;switch(this.uidt){case n.UITypes.Lookup:t=await r.default.read(this.id,e);break;case n.UITypes.Rollup:t=await l.default.read(this.id,e);break;case n.UITypes.LinkToAnotherRecord:t=await o.default.read(this.id,e);break;case n.UITypes.Links:t=await g.LinksColumn.read(this.id,e);break;case n.UITypes.MultiSelect:case n.UITypes.SingleSelect:t=await c.default.read(this.id,e);break;case n.UITypes.Formula:t=await s.default.read(this.id,e);break;case n.UITypes.QrCode:t=await f.default.read(this.id,e);break;case n.UITypes.Barcode:t=await h.default.read(this.id,e)}return this.colOptions=t,t}async loadModel(e=!1){return this.model&&!e||(this.model=await d.default.getByIdOrName({id:this.fk_model_id})),this.model}static async clearList({fk_model_id:e}){await T.default.deepDel(v.CacheScope.COLUMN,`${v.CacheScope.COLUMN}:${e}:list`,v.CacheDelDirection.PARENT_TO_CHILD)}static async clear({id:e}){await T.default.delAll(v.CacheScope.COLUMN,`*${e}*`)}static async list({fk_model_id:e},t=w.default.ncMeta){const a=await T.default.getList(v.CacheScope.COLUMN,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,v.MetaTable.COLUMNS,{condition:{fk_model_id:e},orderBy:{order:"asc"}}),i.forEach((e=>{if(e.meta&&"string"==typeof e.meta)try{e.meta=JSON.parse(e.meta)}catch(t){e.meta={}}})),await T.default.setList(v.CacheScope.COLUMN,[e],i)),i.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),Promise.all(i.map((async e=>{const a=new E(e);return await a.getColOptions(t),a})))}static async get({base_id:e,db_alias:t,colId:a},i=w.default.ncMeta){let n=a&&await T.default.get(`${v.CacheScope.COLUMN}:${a}`,v.CacheGetType.TYPE_OBJECT);if(!n&&(n=await i.metaGet2(e,t,v.MetaTable.COLUMNS,a),n)){try{n.meta=JSON.parse(n.meta)}catch(e){n.meta={}}await T.default.set(`${v.CacheScope.COLUMN}:${a}`,n)}if(n){const e=new E(n);return await e.getColOptions(i),e}return null}static async delete(e,t=w.default.ncMeta){const a=await this.get({colId:e},t);if(!a)return;{const a=await t.metaList2(null,null,v.MetaTable.COL_QRCODE,{condition:{fk_qr_value_column_id:e}});for(const e of a)await E.delete(e.fk_column_id,t)}{const a=await t.metaList2(null,null,v.MetaTable.COL_BARCODE,{condition:{fk_barcode_value_column_id:e}});for(const e of a)await E.delete(e.fk_column_id,t)}{const a=await T.default.getList(v.CacheScope.COL_LOOKUP,[e]);let{list:i}=a;const{isNoneList:n}=a;n||i.length||(i=await t.metaList2(null,null,v.MetaTable.COL_LOOKUP,{condition:{fk_lookup_column_id:e}}));for(const e of i)await E.delete(e.fk_column_id,t)}{const a=await T.default.getList(v.CacheScope.COL_ROLLUP,[e]);let{list:i}=a;const{isNoneList:n}=a;n||i.length||(i=await t.metaList2(null,null,v.MetaTable.COL_ROLLUP,{condition:{fk_rollup_column_id:e}}));for(const e of i)await E.delete(e.fk_column_id,t)}{const i=await T.default.getList(v.CacheScope.COLUMN,[a.fk_model_id]);let{list:o}=i;const{isNoneList:r}=i;r||o.length||(o=await t.metaList2(null,null,v.MetaTable.COLUMNS,{condition:{fk_model_id:a.fk_model_id,uidt:n.UITypes.Formula}})),o=o.filter((e=>e.uidt===n.UITypes.Formula));for(const i of o){const n=await new E(i).getColOptions();(0,y.default)({formula:n,columnId:e,title:null==a?void 0:a.title})&&await s.default.update(i.id,n,t)}}if((0,n.isLinksOrLTAR)(a.uidt)){{const a=await T.default.getList(v.CacheScope.COL_LOOKUP,[e]);let{list:i}=a;const{isNoneList:n}=a;n||i.length||(i=await t.metaList2(null,null,v.MetaTable.COL_LOOKUP,{condition:{fk_relation_column_id:e}}));for(const e of i)await E.delete(e.fk_column_id,t)}{const a=await T.default.getList(v.CacheScope.COL_ROLLUP,[e]);let{list:i}=a;const{isNoneList:n}=a;n||i.length||(i=await t.metaList2(null,null,v.MetaTable.COL_ROLLUP,{condition:{fk_relation_column_id:e}}));for(const e of i)await E.delete(e.fk_column_id,t)}}{const a=await T.default.getList(v.CacheScope.SORT,[e]);let{list:i}=a;const{isNoneList:n}=a;n||i.length||(i=await t.metaList2(null,null,v.MetaTable.SORT,{condition:{fk_column_id:e}}));for(const e of i)await p.default.delete(e.id,t)}{const a=await T.default.getList(v.CacheScope.FILTER_EXP,[e]);let{list:i}=a;const{isNoneList:n}=a;n||i.length||(i=await t.metaList2(null,null,v.MetaTable.FILTER_EXP,{condition:{fk_column_id:e}}));for(const e of i)e.fk_parent_id||await m.default.delete(e.id,t)}let i=null,o=null;switch(a.uidt){case n.UITypes.Rollup:i=v.MetaTable.COL_ROLLUP,o=v.CacheScope.COL_ROLLUP;break;case n.UITypes.Lookup:i=v.MetaTable.COL_LOOKUP,o=v.CacheScope.COL_LOOKUP;break;case n.UITypes.LinkToAnotherRecord:case n.UITypes.Links:i=v.MetaTable.COL_RELATIONS,o=v.CacheScope.COL_RELATION;break;case n.UITypes.MultiSelect:case n.UITypes.SingleSelect:i=v.MetaTable.COL_SELECT_OPTIONS,o=v.CacheScope.COL_SELECT_OPTION;break;case n.UITypes.Formula:i=v.MetaTable.COL_FORMULA,o=v.CacheScope.COL_FORMULA;break;case n.UITypes.QrCode:i=v.MetaTable.COL_QRCODE,o=v.CacheScope.COL_QRCODE;break;case n.UITypes.Barcode:i=v.MetaTable.COL_BARCODE,o=v.CacheScope.COL_BARCODE}i&&o&&(await t.metaDelete(null,null,i,{fk_column_id:a.id}),await T.default.deepDel(o,`${o}:${a.id}`,v.CacheDelDirection.CHILD_TO_PARENT)),await t.metaDelete(null,null,v.MetaTable.GRID_VIEW_COLUMNS,{fk_column_id:a.id});const r=await T.default.get(`${v.CacheScope.GRID_VIEW_COLUMN}:${a.id}`,v.CacheGetType.TYPE_STRING);r&&(await T.default.deepDel(v.CacheScope.GRID_VIEW_COLUMN,`${v.CacheScope.GRID_VIEW_COLUMN}:${r}`,v.CacheDelDirection.CHILD_TO_PARENT),await T.default.del(`${v.CacheScope.GRID_VIEW_COLUMN}:${a.id}`)),await t.metaDelete(null,null,v.MetaTable.FORM_VIEW_COLUMNS,{fk_column_id:a.id});const l=await T.default.get(`${v.CacheScope.FORM_VIEW_COLUMN}:${a.id}`,v.CacheGetType.TYPE_STRING);l&&(await T.default.deepDel(v.CacheScope.FORM_VIEW_COLUMN,`${v.CacheScope.FORM_VIEW_COLUMN}:${l}`,v.CacheDelDirection.CHILD_TO_PARENT),await T.default.del(`${v.CacheScope.FORM_VIEW_COLUMN}:${a.id}`)),await t.metaDelete(null,null,v.MetaTable.KANBAN_VIEW_COLUMNS,{fk_column_id:a.id});const c=await T.default.get(`${v.CacheScope.KANBAN_VIEW_COLUMN}:${a.id}`,v.CacheGetType.TYPE_STRING);c&&(await T.default.deepDel(v.CacheScope.KANBAN_VIEW_COLUMN,`${v.CacheScope.KANBAN_VIEW_COLUMN}:${c}`,v.CacheDelDirection.CHILD_TO_PARENT),await T.default.del(`${v.CacheScope.KANBAN_VIEW_COLUMN}:${a.id}`)),await t.metaDelete(null,null,v.MetaTable.GALLERY_VIEW_COLUMNS,{fk_column_id:a.id});const d=await T.default.get(`${v.CacheScope.GALLERY_VIEW_COLUMN}:${a.id}`,v.CacheGetType.TYPE_STRING);d&&(await T.default.deepDel(v.CacheScope.GALLERY_VIEW_COLUMN,`${v.CacheScope.GALLERY_VIEW_COLUMN}:${d}`,v.CacheDelDirection.CHILD_TO_PARENT),await T.default.del(`${v.CacheScope.GALLERY_VIEW_COLUMN}:${a.id}`));const u=await t.metaList2(null,null,v.MetaTable.COL_RELATIONS,{xcCondition:{_or:[{fk_child_column_id:{eq:a.id}},{fk_parent_column_id:{eq:a.id}},{fk_mm_child_column_id:{eq:a.id}},{fk_mm_parent_column_id:{eq:a.id}}]}});for(const e of u)await E.delete(e.fk_column_id,t);await t.metaDelete(null,null,v.MetaTable.COLUMNS,a.id),await T.default.deepDel(v.CacheScope.COLUMN,`${v.CacheScope.COLUMN}:${a.id}`,v.CacheDelDirection.CHILD_TO_PARENT),await T.default.delAll(v.CacheScope.SINGLE_QUERY,`${a.fk_model_id}:*`)}static async update(e,t,a=w.default.ncMeta){var i;const s=await E.get({colId:e},a);switch(s.uidt){case n.UITypes.Lookup:await a.metaDelete(null,null,v.MetaTable.COL_LOOKUP,{fk_column_id:e}),await T.default.deepDel(v.CacheScope.COL_LOOKUP,`${v.CacheScope.COL_LOOKUP}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT);break;case n.UITypes.Rollup:await a.metaDelete(null,null,v.MetaTable.COL_ROLLUP,{fk_column_id:e}),await T.default.deepDel(v.CacheScope.COL_ROLLUP,`${v.CacheScope.COL_ROLLUP}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT);break;case n.UITypes.LinkToAnotherRecord:await a.metaDelete(null,null,v.MetaTable.COL_RELATIONS,{fk_column_id:e}),await T.default.deepDel(v.CacheScope.COL_RELATION,`${v.CacheScope.COL_RELATION}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT);break;case n.UITypes.Formula:await a.metaDelete(null,null,v.MetaTable.COL_FORMULA,{fk_column_id:e}),await T.default.deepDel(v.CacheScope.COL_FORMULA,`${v.CacheScope.COL_FORMULA}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT);break;case n.UITypes.QrCode:await a.metaDelete(null,null,v.MetaTable.COL_QRCODE,{fk_column_id:e}),await T.default.deepDel(v.CacheScope.COL_QRCODE,`${v.CacheScope.COL_QRCODE}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT);break;case n.UITypes.Barcode:await a.metaDelete(null,null,v.MetaTable.COL_BARCODE,{fk_column_id:e}),await T.default.deepDel(v.CacheScope.COL_BARCODE,`${v.CacheScope.COL_BARCODE}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT);break;case n.UITypes.MultiSelect:case n.UITypes.SingleSelect:await a.metaDelete(null,null,v.MetaTable.COL_SELECT_OPTIONS,{fk_column_id:e}),await T.default.deepDel(v.CacheScope.COL_SELECT_OPTION,`${v.CacheScope.COL_SELECT_OPTION}:${e}:list`,v.CacheDelDirection.PARENT_TO_CHILD)}const o=(0,_.extractProps)(t,["column_name","title","uidt","dt","np","ns","clen","cop","pk","rqd","un","ct","ai","unique","cdf","cc","csn","dtx","dtxp","dtxs","au","pv","system","validate","meta"]);if(t.validate&&("string"==typeof t.validate?o.validate=t.validate:o.validate=JSON.stringify(t.validate)),!n.AllowedColumnTypesForQrAndBarcodes.includes(o.uidt)){const t=await a.metaList2(null,null,v.MetaTable.COL_QRCODE,{condition:{fk_qr_value_column_id:e}}),i=await a.metaList2(null,null,v.MetaTable.COL_BARCODE,{condition:{fk_barcode_value_column_id:e}});for(const e of t)await E.delete(e.fk_column_id,a);for(const e of i)await E.delete(e.fk_column_id,a)}const r=`${v.CacheScope.COLUMN}:${e}`;let l=await T.default.get(r,v.CacheGetType.TYPE_OBJECT);l&&(l=Object.assign(Object.assign({},l),o),await T.default.set(r,l));const c=await T.default.getList(v.CacheScope.COLUMN,[s.fk_model_id]);if(!(null===(i=c.list)||void 0===i?void 0:i.length)){const t=c.list.map((t=>t.id===e?Object.assign(Object.assign({},t),o):t));await T.default.setList(v.CacheScope.COLUMN,[s.fk_model_id],t)}await a.metaUpdate(null,null,v.MetaTable.COLUMNS,Object.assign(Object.assign({},o),{meta:o.meta&&"object"==typeof o.meta?JSON.stringify(o.meta):o.meta}),e),await this.insertColOption(t,e,a),await T.default.delAll(v.CacheScope.SINGLE_QUERY,`${s.fk_model_id}:*`)}static async updateAlias(e,{title:t},a=w.default.ncMeta){const i=`${v.CacheScope.COLUMN}:${e}`,n=await T.default.get(i,v.CacheGetType.TYPE_OBJECT);n&&(n.title=t,await T.default.set(i,n)),await a.metaUpdate(null,null,v.MetaTable.COLUMNS,{title:t},e)}getValidators(){if(this.validate&&"string"==typeof this.validate)try{return JSON.parse(this.validate)}catch(e){}return null}async delete(e=w.default.ncMeta){return await E.delete(this.id,e)}static async checkTitleAvailable({column_name:e,fk_model_id:t,exclude_id:a},i=w.default.ncMeta){return!await i.metaGet2(null,null,v.MetaTable.COLUMNS,{column_name:e,fk_model_id:t},null,a&&{id:{neq:a}})}static async checkAliasAvailable({title:e,fk_model_id:t,exclude_id:a},i=w.default.ncMeta){return!await i.metaGet2(null,null,v.MetaTable.COLUMNS,{title:e,fk_model_id:t},null,a&&{id:{neq:a}})}static async markAsSystemField(e,t=!0,a=w.default.ncMeta){const i=`${v.CacheScope.COLUMN}:${e}`,n=await T.default.get(i,v.CacheGetType.TYPE_OBJECT);n&&(n.system=t,await T.default.set(i,n)),await a.metaUpdate(null,null,v.MetaTable.COLUMNS,{system:t},e)}static getMaxColumnNameLength(e){let t=255;return"mysql2"===e||"mysql"===e?t=64:"pg"===e?t=59:"mssql"===e&&(t=128),t}static async updateMeta({colId:e,meta:t},a=w.default.ncMeta){const i=`${v.CacheScope.COLUMN}:${e}`,n=await T.default.get(i,v.CacheGetType.TYPE_OBJECT);n&&(n.meta=t,await T.default.set(i,n)),await a.metaUpdate(null,null,v.MetaTable.COLUMNS,{meta:(0,O.stringifyMetaProp)(t)},e)}}t.default=E},41186:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(33505)),o=i(a(83889)),r=i(a(85750)),l=i(a(86026)),c=i(a(27552)),d=a(13609),u=i(a(37912)),p=a(51401),m=a(33402);class f{constructor(e){Object.assign(this,e)}static castType(e){return e&&new f(e)}castType(e){return e&&new f(e)}async getModel(e=c.default.ncMeta){return this.fk_view_id?(await l.default.get(this.fk_view_id,e)).getModel(e):s.default.getByIdOrName({id:this.fk_model_id},e)}static async insert(e,t=c.default.ncMeta){var a;const i=(0,m.extractProps)(e,["id","fk_view_id","fk_hook_id","fk_column_id","comparison_op","comparison_sub_op","value","fk_parent_id","is_group","logical_op","project_id","base_id","order"]),n=e.fk_hook_id?"fk_hook_id":"fk_view_id";if(i.order=await t.metaGetNextOrder(d.MetaTable.FILTER_EXP,{[n]:e[n]}),!e.project_id||!e.base_id){let a;e.fk_view_id?a=await l.default.get(e.fk_view_id,t):e.fk_hook_id?a=await r.default.get(e.fk_hook_id,t):e.fk_column_id?a=await o.default.get({colId:e.fk_column_id},t):p.NcError.badRequest("Invalid filter"),null!=a&&(i.project_id=a.project_id,i.base_id=a.base_id)}const s=await t.metaInsert2(null,null,d.MetaTable.FILTER_EXP,i);return(null===(a=null==e?void 0:e.children)||void 0===a?void 0:a.length)&&await Promise.all(e.children.map((a=>this.insert(Object.assign(Object.assign({},a),{fk_parent_id:s.id,[e.fk_hook_id?"fk_hook_id":"fk_view_id"]:e.fk_hook_id?e.fk_hook_id:e.fk_view_id}),t)))),await this.redisPostInsert(s.id,e,t)}static async redisPostInsert(e,t,a=c.default.ncMeta){if(!e||!t.fk_view_id&&!t.fk_hook_id)throw new Error(`Mandatory fields missing in FITLER_EXP cache population : id(${e}), fk_view_id(${t.fk_view_id}), fk_hook_id(${t.fk_hook_id})`);const i=`${d.CacheScope.FILTER_EXP}:${e}`;let n=await u.default.get(i,d.CacheGetType.TYPE_OBJECT);if(!n){n=await a.metaGet2(null,null,d.MetaTable.FILTER_EXP,e);const s=[];s.push(u.default.set(i,n)),t.fk_view_id&&s.push(u.default.appendToList(d.CacheScope.FILTER_EXP,[t.fk_view_id],i)),t.fk_hook_id&&s.push(u.default.appendToList(d.CacheScope.FILTER_EXP,[t.fk_hook_id],i)),t.fk_parent_id&&(t.fk_view_id&&s.push(u.default.appendToList(d.CacheScope.FILTER_EXP,[t.fk_view_id,t.fk_parent_id],i)),t.fk_hook_id&&s.push(u.default.appendToList(d.CacheScope.FILTER_EXP,[t.fk_hook_id,t.fk_parent_id],i)),s.push(u.default.appendToList(d.CacheScope.FILTER_EXP,[t.fk_parent_id],i))),t.fk_column_id&&s.push(u.default.appendToList(d.CacheScope.FILTER_EXP,[t.fk_column_id],i)),await Promise.all(s)}if(t.fk_view_id){const e=await l.default.get(t.fk_view_id,a);await u.default.delAll(d.CacheScope.SINGLE_QUERY,`${e.fk_model_id}:${e.id}:*`)}return this.castType(n)}static async update(e,t,a=c.default.ncMeta){const i=(0,m.extractProps)(t,["fk_column_id","comparison_op","comparison_sub_op","value","fk_parent_id","is_group","logical_op"]);"string"==typeof i.value&&(i.value=i.value.slice(0,255));const n=`${d.CacheScope.FILTER_EXP}:${e}`;let s=await u.default.get(n,d.CacheGetType.TYPE_OBJECT);s&&(s=Object.assign(Object.assign({},s),i),await u.default.set(n,s));const o=await a.metaUpdate(null,null,d.MetaTable.FILTER_EXP,i,e);{const t=await this.get(e,a);if(t.fk_view_id){const e=await l.default.get(t.fk_view_id,a);await u.default.delAll(d.CacheScope.SINGLE_QUERY,`${e.fk_model_id}:${e.id}:*`)}}return o}static async delete(e,t=c.default.ncMeta){const a=await this.get(e,t),i=async e=>{if(e){for(const t of await(null==e?void 0:e.getChildren())||[])await i(t);await t.metaDelete(null,null,d.MetaTable.FILTER_EXP,e.id),await u.default.deepDel(d.CacheScope.FILTER_EXP,`${d.CacheScope.FILTER_EXP}:${e.id}`,d.CacheDelDirection.CHILD_TO_PARENT)}};if(await i(a),a.fk_view_id){const e=await l.default.get(a.fk_view_id,t);await u.default.delAll(d.CacheScope.SINGLE_QUERY,`${e.fk_model_id}:${e.id}:*`)}}getColumn(){return this.fk_column_id?o.default.get({colId:this.fk_column_id}):null}async getGroup(e=c.default.ncMeta){if(!this.fk_parent_id)return null;let t=await u.default.get(`${d.CacheScope.FILTER_EXP}:${this.fk_parent_id}`,2);return t||(t=await e.metaGet2(null,null,d.MetaTable.FILTER_EXP,{id:this.fk_parent_id}),await u.default.set(`${d.CacheScope.FILTER_EXP}:${this.fk_parent_id}`,t)),this.castType(t)}async getChildren(e=c.default.ncMeta){if(this.children)return this.children;if(!this.is_group)return null;const t=await u.default.getList(d.CacheScope.FILTER_EXP,[this.id]);let{list:a}=t;const{isNoneList:i}=t;return i||a.length||(a=await e.metaList2(null,null,d.MetaTable.FILTER_EXP,{condition:{fk_parent_id:this.id},orderBy:{order:"asc"}}),await u.default.setList(d.CacheScope.FILTER_EXP,[this.id],a)),a&&a.map((e=>this.castType(e)))}static async getFilterObject({viewId:e,hookId:t},a=c.default.ncMeta){var i;const s=await u.default.getList(d.CacheScope.FILTER_EXP,[e||t]);let{list:o}=s;const{isNoneList:r}=s;r||o.length||(o=await a.metaList2(null,null,d.MetaTable.FILTER_EXP,{condition:e?{fk_view_id:e}:{fk_hook_id:t},orderBy:{order:"asc"}}),await u.default.setList(d.CacheScope.FILTER_EXP,[e||t],o));const l={is_group:!0,children:[],logical_op:"and"},p={},m={};for(const e of o)e._fk_parent_id?(p[e._fk_parent_id]=p[e._fk_parent_id]||[],p[e._fk_parent_id].push(e),m[e.id]=e,e.column=await new f(e).getColumn(),null===(i=e.column)||void 0===i||i.uidt,n.UITypes.LinkToAnotherRecord):(l.children.push(e),m[l.id]=l);for(const[e,t]of Object.entries(p))(null==m?void 0:m[e])&&(m[e].children=t);return l}static async deleteAll(e,t=c.default.ncMeta){const a=await this.getFilterObject({viewId:e},t),i=async e=>{if(e){for(const t of(null==e?void 0:e.children)||[])await i(t);e.id&&(await t.metaDelete(null,null,d.MetaTable.FILTER_EXP,e.id),await u.default.deepDel(d.CacheScope.FILTER_EXP,`${d.CacheScope.FILTER_EXP}:${e.id}`,d.CacheDelDirection.CHILD_TO_PARENT))}};await i(a);{const a=await l.default.get(e,t);await u.default.delAll(d.CacheScope.SINGLE_QUERY,`${a.fk_model_id}:${a.id}:*`)}}static async deleteAllByHook(e,t=c.default.ncMeta){const a=await this.getFilterObject({hookId:e},t),i=async e=>{if(e){for(const t of(null==e?void 0:e.children)||[])await i(t);e.id&&(await t.metaDelete(null,null,d.MetaTable.FILTER_EXP,e.id),await u.default.deepDel(d.CacheScope.FILTER_EXP,`${d.CacheScope.FILTER_EXP}:${e.id}`,d.CacheDelDirection.CHILD_TO_PARENT))}};await i(a)}static async get(e,t=c.default.ncMeta){let a=e&&await u.default.get(`${d.CacheScope.FILTER_EXP}:${e}`,d.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,d.MetaTable.FILTER_EXP,{id:e}),await u.default.set(`${d.CacheScope.FILTER_EXP}:${e}`,a)),this.castType(a)}static async rootFilterList({viewId:e},t=c.default.ncMeta){var a;const i=await u.default.getList(d.CacheScope.FILTER_EXP,[e]);let{list:n}=i;const{isNoneList:s}=i;return s||n.length||(n=await t.metaList2(null,null,d.MetaTable.FILTER_EXP,{condition:{fk_view_id:e},orderBy:{order:"asc"}}),await u.default.setList(d.CacheScope.FILTER_EXP,[e],n)),null===(a=null==n?void 0:n.filter((e=>!e.fk_parent_id)))||void 0===a?void 0:a.map((e=>this.castType(e)))}static async rootFilterListByHook({hookId:e},t=c.default.ncMeta){const a=await u.default.getList(d.CacheScope.FILTER_EXP,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,d.MetaTable.FILTER_EXP,{condition:{fk_hook_id:e},orderBy:{order:"asc"}}),await u.default.setList(d.CacheScope.FILTER_EXP,[e],i)),null==i?void 0:i.map((e=>this.castType(e)))}static async parentFilterList({parentId:e},t=c.default.ncMeta){const a=await u.default.getList(d.CacheScope.FILTER_EXP,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,d.MetaTable.FILTER_EXP,{condition:{fk_parent_id:e},orderBy:{order:"asc"}}),await u.default.setList(d.CacheScope.FILTER_EXP,[e],i)),null==i?void 0:i.map((e=>this.castType(e)))}static async parentFilterListByHook({hookId:e,parentId:t},a=c.default.ncMeta){const i=await u.default.getList(d.CacheScope.FILTER_EXP,[e,t]);let{list:n}=i;const{isNoneList:s}=i;return s||n.length||(n=await a.metaList2(null,null,d.MetaTable.FILTER_EXP,{condition:{fk_parent_id:t,fk_hook_id:e},orderBy:{order:"asc"}}),await u.default.setList(d.CacheScope.FILTER_EXP,[e,t],n)),null==n?void 0:n.map((e=>this.castType(e)))}static async hasEmptyOrNullFilters(e,t=c.default.ncMeta){return(await t.metaList2(null,null,d.MetaTable.FILTER_EXP,{condition:{project_id:e},xcCondition:{_or:[{comparison_op:{eq:"null"}},{comparison_op:{eq:"notnull"}},{comparison_op:{eq:"empty"}},{comparison_op:{eq:"notempty"}}]}})).length>0}}t.default=f},93805:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(71231)),s=i(a(86026)),o=a(33402),r=i(a(37912)),l=i(a(27552)),c=a(86203),d=a(13609);class u{constructor(e){Object.assign(this,e)}static async get(e,t=l.default.ncMeta){let a=e&&await r.default.get(`${d.CacheScope.FORM_VIEW}:${e}`,d.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,d.MetaTable.FORM_VIEW,{fk_view_id:e}),a&&(a.meta=(0,c.deserializeJSON)(a.meta),await r.default.set(`${d.CacheScope.FORM_VIEW}:${e}`,a))),a&&new u(a)}static async insert(e,t=l.default.ncMeta){const a=(0,o.extractProps)(e,["fk_view_id","project_id","base_id","heading","subheading","success_msg","redirect_url","redirect_after_secs","email","banner_image_url","logo_url","submit_another_form","show_blank_form","meta"]);if(a.meta&&(a.meta=(0,c.serializeJSON)(a.meta)),!e.project_id||!e.base_id){const t=await s.default.get(e.fk_view_id);a.project_id=t.project_id,a.base_id=t.base_id}return await t.metaInsert2(null,null,d.MetaTable.FORM_VIEW,a,!0),this.get(e.fk_view_id,t)}static async update(e,t,a=l.default.ncMeta){const i=`${d.CacheScope.FORM_VIEW}:${e}`;let n=await r.default.get(i,d.CacheGetType.TYPE_OBJECT);const s=(0,o.extractProps)(t,["heading","subheading","success_msg","redirect_url","redirect_after_secs","email","banner_image_url","logo_url","submit_another_form","show_blank_form","meta"]);return n&&(n=Object.assign(Object.assign({},n),s),await r.default.set(i,n)),s.meta&&(s.meta=(0,c.serializeJSON)(s.meta)),await a.metaUpdate(null,null,d.MetaTable.FORM_VIEW,s,{fk_view_id:e})}async getColumns(e=l.default.ncMeta){return this.columns=await n.default.list(this.fk_view_id,e)}static async getWithInfo(e,t=l.default.ncMeta){const a=await this.get(e,t);return await a.getColumns(t),a}}t.default=u},71231:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(86026)),s=i(a(27552)),o=i(a(37912)),r=a(33402),l=a(86203),c=a(13609);class d{constructor(e){Object.assign(this,e)}static async get(e,t=s.default.ncMeta){let a=e&&await o.default.get(`${c.CacheScope.FORM_VIEW_COLUMN}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,c.MetaTable.FORM_VIEW_COLUMNS,e),a.meta=a.meta&&"string"==typeof a.meta?JSON.parse(a.meta):a.meta),await o.default.set(`${c.CacheScope.FORM_VIEW_COLUMN}:${e}`,a),a&&new d(a)}static async insert(e,t=s.default.ncMeta){const a=(0,r.extractProps)(e,["fk_view_id","fk_column_id","show","project_id","base_id","label","help","description","required","enable_scanner","meta"]);if(a.order=await t.metaGetNextOrder(c.MetaTable.FORM_VIEW_COLUMNS,{fk_view_id:a.fk_view_id}),a.meta&&(a.meta=(0,l.serializeJSON)(a.meta)),!a.project_id||!a.base_id){const e=await n.default.get(a.fk_view_id,t);a.project_id=e.project_id,a.base_id=e.base_id}const{id:i,fk_column_id:d}=await t.metaInsert2(null,null,c.MetaTable.FORM_VIEW_COLUMNS,a);await o.default.set(`${c.CacheScope.FORM_VIEW_COLUMN}:${d}`,i);const{list:u}=await o.default.getList(c.CacheScope.FORM_VIEW_COLUMN,[e.fk_view_id]);return(null==u?void 0:u.length)&&await o.default.appendToList(c.CacheScope.FORM_VIEW_COLUMN,[e.fk_view_id],`${c.CacheScope.FORM_VIEW_COLUMN}:${i}`),this.get(i,t)}static async list(e,t=s.default.ncMeta){const a=await o.default.getList(c.CacheScope.FORM_VIEW_COLUMN,[e]);let{list:i}=a;const{isNoneList:n}=a;if(!n&&!i.length){i=await t.metaList2(null,null,c.MetaTable.FORM_VIEW_COLUMNS,{condition:{fk_view_id:e},orderBy:{order:"asc"}});for(const e of i)e.meta=(0,l.deserializeJSON)(e.meta);await o.default.setList(c.CacheScope.FORM_VIEW_COLUMN,[e],i)}return i.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==i?void 0:i.map((e=>new d(e)))}static async update(e,t,a=s.default.ncMeta){const i=(0,r.extractProps)(t,["label","help","description","required","show","order","meta","enable_scanner"]),n=`${c.CacheScope.FORM_VIEW_COLUMN}:${e}`,d=await o.default.get(n,c.CacheGetType.TYPE_OBJECT);return d&&(Object.assign(d,i),await o.default.set(n,d)),i.meta&&(i.meta=(0,l.serializeJSON)(i.meta)),await a.metaUpdate(null,null,c.MetaTable.FORM_VIEW_COLUMNS,i,e)}}t.default=d},77961:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(27552)),s=i(a(37912)),o=a(33402),r=a(13609);class l{constructor(e){Object.assign(this,e)}static async insert(e,t=n.default.ncMeta){const a=(0,o.extractProps)(e,["fk_column_id","formula_raw","formula","error"]);return await t.metaInsert2(null,null,r.MetaTable.COL_FORMULA,a),this.read(e.fk_column_id,t)}static async read(e,t=n.default.ncMeta){let a=e&&await s.default.get(`${r.CacheScope.COL_FORMULA}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,r.MetaTable.COL_FORMULA,{fk_column_id:e}),await s.default.set(`${r.CacheScope.COL_FORMULA}:${e}`,a)),a?new l(a):null}static async update(e,t,a=n.default.ncMeta){const i=(0,o.extractProps)(t,["formula","formula_raw","fk_column_id","error"]),l=`${r.CacheScope.COL_FORMULA}:${e}`;let c=await s.default.get(l,r.CacheGetType.TYPE_OBJECT);c&&(c=Object.assign(Object.assign({},c),i),await s.default.set(l,c)),await a.metaUpdate(null,null,r.MetaTable.COL_FORMULA,i,e)}}t.default=l},29337:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(86026)),o=i(a(27552)),r=i(a(37912)),l=a(33402),c=a(13609);class d{constructor(e){Object.assign(this,e)}static async get(e,t=o.default.ncMeta){let a=e&&await r.default.get(`${c.CacheScope.GALLERY_VIEW}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,c.MetaTable.GALLERY_VIEW,{fk_view_id:e}),await r.default.set(`${c.CacheScope.GALLERY_VIEW}:${e}`,a)),a&&new d(a)}static async insert(e,t=o.default.ncMeta){var a;const i=await s.default.get(e.fk_view_id,t).then((e=>null==e?void 0:e.getModel(t))).then((e=>e.getColumns(t))),r=(0,l.extractProps)(e,["project_id","base_id","fk_view_id","next_enabled","prev_enabled","cover_image_idx","cover_image","restrict_types","restrict_size","restrict_number"]);if(r.fk_cover_image_col_id=(null==e?void 0:e.fk_cover_image_col_id)||(null===(a=null==i?void 0:i.find((e=>e.uidt===n.UITypes.Attachment)))||void 0===a?void 0:a.id),!e.project_id||!e.base_id){const t=await s.default.get(e.fk_view_id);r.project_id=t.project_id,r.base_id=t.base_id}return await t.metaInsert2(null,null,c.MetaTable.GALLERY_VIEW,r,!0),this.get(e.fk_view_id,t)}static async update(e,t,a=o.default.ncMeta){var i;const n=`${c.CacheScope.GALLERY_VIEW}:${e}`;let s=await r.default.get(n,c.CacheGetType.TYPE_OBJECT);const d=(0,l.extractProps)(t,["fk_cover_image_col_id","meta"]);return d.meta&&"object"==typeof d.meta&&(d.meta=JSON.stringify(null!==(i=d.meta)&&void 0!==i?i:{})),s&&(s=Object.assign(Object.assign({},s),d),await r.default.set(n,s)),await a.metaUpdate(null,null,c.MetaTable.GALLERY_VIEW,d,{fk_view_id:e})}}t.default=d},48145:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(86026)),s=i(a(27552)),o=i(a(37912)),r=a(33402),l=a(13609);class c{constructor(e){Object.assign(this,e)}static async get(e,t=s.default.ncMeta){let a=e&&await o.default.get(`${l.CacheScope.GALLERY_VIEW_COLUMN}:${e}`,l.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,l.MetaTable.GALLERY_VIEW_COLUMNS,e),await o.default.set(`${l.CacheScope.GALLERY_VIEW_COLUMN}:${e}`,a)),a&&new c(a)}static async insert(e,t=s.default.ncMeta){const a=(0,r.extractProps)(e,["fk_view_id","fk_column_id","show","project_id","base_id"]);if(a.order=await t.metaGetNextOrder(l.MetaTable.GALLERY_VIEW_COLUMNS,{fk_view_id:e.fk_view_id}),!e.project_id||!e.base_id){const i=await n.default.get(e.fk_view_id,t);a.project_id=i.project_id,a.base_id=i.base_id}const{id:i,fk_column_id:c}=await t.metaInsert2(null,null,l.MetaTable.GALLERY_VIEW_COLUMNS,a);await o.default.set(`${l.CacheScope.GALLERY_VIEW_COLUMN}:${c}`,i);const{list:d}=await o.default.getList(l.CacheScope.GALLERY_VIEW_COLUMN,[e.fk_view_id]);(null==d?void 0:d.length)&&await o.default.appendToList(l.CacheScope.GALLERY_VIEW_COLUMN,[e.fk_view_id],`${l.CacheScope.GALLERY_VIEW_COLUMN}:${i}`);{const a=await n.default.get(e.fk_view_id,t);await o.default.delAll(l.CacheScope.SINGLE_QUERY,`${a.fk_model_id}:${a.id}:*`)}return this.get(i,t)}static async list(e,t=s.default.ncMeta){const a=await o.default.getList(l.CacheScope.GALLERY_VIEW_COLUMN,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,l.MetaTable.GALLERY_VIEW_COLUMNS,{condition:{fk_view_id:e},orderBy:{order:"asc"}}),await o.default.setList(l.CacheScope.GALLERY_VIEW_COLUMN,[e],i)),i.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==i?void 0:i.map((e=>new c(e)))}}t.default=c},70072:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(46725)),s=i(a(86026)),o=i(a(27552)),r=i(a(37912)),l=a(33402),c=a(13609);class d{constructor(e){Object.assign(this,e)}async getColumns(){return this.columns=await n.default.list(this.fk_view_id)}static async get(e,t=o.default.ncMeta){let a=e&&await r.default.get(`${c.CacheScope.GRID_VIEW}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,c.MetaTable.GRID_VIEW,{fk_view_id:e}),await r.default.set(`${c.CacheScope.GRID_VIEW}:${e}`,a)),a&&new d(a)}static async insert(e,t=o.default.ncMeta){const a=(0,l.extractProps)(e,["fk_view_id","project_id","base_id","row_height"]);if(!a.project_id||!a.base_id){const e=await s.default.get(a.fk_view_id,t);a.project_id=e.project_id,a.base_id=e.base_id}return await t.metaInsert2(null,null,c.MetaTable.GRID_VIEW,a,!0),this.get(e.fk_view_id,t)}static async getWithInfo(e,t=o.default.ncMeta){return await this.get(e,t)}static async update(e,t,a=o.default.ncMeta){var i;const n=`${c.CacheScope.GRID_VIEW}:${e}`;let s=await r.default.get(n,c.CacheGetType.TYPE_OBJECT);const d=(0,l.extractProps)(t,["row_height","meta"]);return d.meta&&"object"==typeof d.meta&&(d.meta=JSON.stringify(null!==(i=d.meta)&&void 0!==i?i:{})),s&&(s=Object.assign(Object.assign({},s),d),await r.default.set(n,s)),await a.metaUpdate(null,null,c.MetaTable.GRID_VIEW,d,{fk_view_id:e})}}t.default=d},46725:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(86026)),s=i(a(27552)),o=a(33402),r=i(a(37912)),l=a(13609);class c{constructor(e){Object.assign(this,e)}static async list(e,t=s.default.ncMeta){const a=await r.default.getList(l.CacheScope.GRID_VIEW_COLUMN,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,l.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_view_id:e},orderBy:{order:"asc"}}),await r.default.setList(l.CacheScope.GRID_VIEW_COLUMN,[e],i)),i.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==i?void 0:i.map((e=>new c(e)))}static async get(e,t=s.default.ncMeta){let a=e&&await r.default.get(`${l.CacheScope.GRID_VIEW_COLUMN}:${e}`,l.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,l.MetaTable.GRID_VIEW_COLUMNS,e),await r.default.set(`${l.CacheScope.GRID_VIEW_COLUMN}:${e}`,a)),a&&new c(a)}static async insert(e,t=s.default.ncMeta){var a;const i=(0,o.extractProps)(e,["fk_view_id","fk_column_id","show","project_id","base_id","order","width","group_by","group_by_order","group_by_sort"]);if(i.order=null!==(a=null==e?void 0:e.order)&&void 0!==a?a:await t.metaGetNextOrder(l.MetaTable.GRID_VIEW_COLUMNS,{fk_view_id:e.fk_view_id}),!e.project_id||!e.base_id){const a=await n.default.get(e.fk_view_id,t);i.project_id=a.project_id,i.base_id=a.base_id}const{id:c,fk_column_id:d}=await t.metaInsert2(null,null,l.MetaTable.GRID_VIEW_COLUMNS,i);await r.default.set(`${l.CacheScope.GRID_VIEW_COLUMN}:${d}`,c);const{list:u}=await r.default.getList(l.CacheScope.GRID_VIEW_COLUMN,[e.fk_view_id]);u.length&&await r.default.appendToList(l.CacheScope.GRID_VIEW_COLUMN,[e.fk_view_id],`${l.CacheScope.GRID_VIEW_COLUMN}:${c}`),await n.default.fixPVColumnForView(e.fk_view_id,t);{const a=await n.default.get(e.fk_view_id,t);await r.default.delAll(l.CacheScope.SINGLE_QUERY,`${a.fk_model_id}:${a.id}:*`)}return this.get(c,t)}static async update(e,t,a=s.default.ncMeta){const i=(0,o.extractProps)(t,["order","show","width","group_by","group_by_order","group_by_sort"]),c=`${l.CacheScope.GRID_VIEW_COLUMN}:${e}`;let d=await r.default.get(c,l.CacheGetType.TYPE_OBJECT);d&&(d=Object.assign(Object.assign({},d),i),await r.default.set(c,d));const u=await a.metaUpdate(null,null,l.MetaTable.GRID_VIEW_COLUMNS,i,e);{const t=await this.get(e,a),i=await n.default.get(t.fk_view_id,a);await r.default.delAll(l.CacheScope.SINGLE_QUERY,`${i.fk_model_id}:${i.id}:*`)}return u}}t.default=c},85750:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(33505)),s=i(a(41186)),o=i(a(89072)),r=a(13609),l=i(a(27552)),c=i(a(37912)),d=a(33402),u=a(51401);class p{constructor(e){Object.assign(this,e)}static async get(e,t=l.default.ncMeta){let a=e&&await c.default.get(`${r.CacheScope.HOOK}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,r.MetaTable.HOOKS,e),await c.default.set(`${r.CacheScope.HOOK}:${e}`,a)),a&&new p(a)}async getFilters(e=l.default.ncMeta){return await s.default.rootFilterListByHook({hookId:this.id},e)}static async list(e,t=l.default.ncMeta){const a=await c.default.getList(r.CacheScope.HOOK,[e.fk_model_id]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList(null,null,r.MetaTable.HOOKS,{condition:{fk_model_id:e.fk_model_id},orderBy:{created_at:"asc"}}),await c.default.setList(r.CacheScope.HOOK,[e.fk_model_id],i)),e.event&&(i=i.filter((t=>{var a,i;return(null===(a=t.event)||void 0===a?void 0:a.toLowerCase())===(null===(i=e.event)||void 0===i?void 0:i.toLowerCase())}))),e.operation&&(i=i.filter((t=>{var a,i;return(null===(a=t.operation)||void 0===a?void 0:a.toLowerCase())===(null===(i=e.operation)||void 0===i?void 0:i.toLowerCase())}))),null==i?void 0:i.map((e=>new p(e)))}static async insert(e,t=l.default.ncMeta){const a=(0,d.extractProps)(e,["fk_model_id","title","description","env","type","event","operation","async","url","headers","condition","notification","retries","retry_interval","timeout","active","project_id","base_id"]);if(a.notification&&"object"==typeof a.notification&&(a.notification=JSON.stringify(a.notification)),!e.project_id||!e.base_id){const i=await n.default.getByIdOrName({id:e.fk_model_id},t);a.project_id=i.project_id,a.base_id=i.base_id}a.version="v2";const{id:i}=await t.metaInsert2(null,null,r.MetaTable.HOOKS,a);return await c.default.appendToList(r.CacheScope.HOOK,[e.fk_model_id],`${r.CacheScope.HOOK}:${i}`),this.get(i,t)}static async update(e,t,a=l.default.ncMeta){const i=(0,d.extractProps)(t,["title","description","env","type","event","operation","async","payload","url","headers","condition","notification","retries","retry_interval","timeout","active","version"]);i.version&&i.operation&&"v1"===i.version&&["bulkInsert","bulkUpdate","bulkDelete"].includes(i.operation)&&u.NcError.badRequest(`${i.operation} not supported in v1 hook`),i.notification&&"object"==typeof i.notification&&(i.notification=JSON.stringify(i.notification));const n=`${r.CacheScope.HOOK}:${e}`;let s=await c.default.get(n,r.CacheGetType.TYPE_OBJECT);return s&&(s=Object.assign(Object.assign({},s),i),s.notification=i.notification,await c.default.set(n,s)),await a.metaUpdate(null,null,r.MetaTable.HOOKS,i,e),this.get(e,a)}static async delete(e,t=l.default.ncMeta){const a=await t.metaList2(null,null,r.MetaTable.FILTER_EXP,{condition:{fk_hook_id:e}});for(const e of a)await c.default.deepDel(r.CacheScope.FILTER_EXP,`${r.CacheScope.FILTER_EXP}:${e.id}`,r.CacheDelDirection.CHILD_TO_PARENT),await o.default.delete(e.id);return await c.default.deepDel(r.CacheScope.HOOK,`${r.CacheScope.HOOK}:${e}`,r.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(null,null,r.MetaTable.HOOKS,e)}}t.default=p},89072:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(33505)),o=i(a(83889)),r=i(a(86026)),l=i(a(27552)),c=a(13609),d=i(a(37912)),u=a(33402);class p{constructor(e){Object.assign(this,e)}async getModel(e=l.default.ncMeta){return this.fk_view_id?(await r.default.get(this.fk_view_id,e)).getModel(e):s.default.getByIdOrName({id:this.fk_model_id},e)}static async insert(e,t=l.default.ncMeta){var a;const i=(0,u.extractProps)(e,["id","fk_view_id","fk_column_id","comparison_op","value","fk_parent_id","is_group","logical_op","project_id","base_id"]);if(!e.project_id||!e.base_id){const a=await o.default.get({colId:e.fk_column_id},t);i.project_id=a.project_id,i.base_id=a.base_id}const n=await t.metaInsert2(null,null,c.MetaTable.FILTER_EXP,i);return(null===(a=null==e?void 0:e.children)||void 0===a?void 0:a.length)&&await Promise.all(e.children.map((e=>this.insert(Object.assign(Object.assign({},e),{fk_parent_id:n.id}),t)))),await this.redisPostInsert(n.id,e,t)}static async redisPostInsert(e,t,a=l.default.ncMeta){if(!e||!t.fk_view_id)throw new Error(`Mandatory fields missing in FITLER_EXP cache population : id(${e}), fk_view_id(${t.fk_view_id}), fk_parent_id(${t.fk_view_id})`);const i=`${c.CacheScope.FILTER_EXP}:${e}`;let n=await d.default.get(i,c.CacheGetType.TYPE_OBJECT);if(!n){n=await a.metaGet2(null,null,c.MetaTable.FILTER_EXP,e);const s=[];s.push(d.default.set(i,n)),s.push(d.default.appendToList(c.CacheScope.FILTER_EXP,[t.fk_view_id],i)),t.fk_parent_id&&(s.push(d.default.appendToList(c.CacheScope.FILTER_EXP,[t.fk_view_id,t.fk_parent_id],i)),s.push(d.default.appendToList(c.CacheScope.FILTER_EXP,[t.fk_parent_id],i))),t.fk_column_id&&s.push(d.default.appendToList(c.CacheScope.FILTER_EXP,[t.fk_column_id],i)),await Promise.all(s)}return new p(n)}static async update(e,t,a=l.default.ncMeta){const i=(0,u.extractProps)(t,["fk_column_id","comparison_op","value","fk_parent_id","is_group","logical_op"]),n=`${c.CacheScope.FILTER_EXP}:${e}`;let s=await d.default.get(n,c.CacheGetType.TYPE_OBJECT);s&&(s=Object.assign(Object.assign({},s),i),await d.default.set(n,s)),await a.metaUpdate(null,null,c.MetaTable.FILTER_EXP,i,e)}static async delete(e,t=l.default.ncMeta){const a=await this.get(e),i=async e=>{if(e){for(const t of await(null==e?void 0:e.getChildren())||[])await i(t);await t.metaDelete(null,null,c.MetaTable.FILTER_EXP,e.id),await d.default.deepDel(c.CacheScope.FILTER_EXP,`${c.CacheScope.FILTER_EXP}:${e.id}`,c.CacheDelDirection.CHILD_TO_PARENT)}};await i(a)}getColumn(){return this.fk_column_id?o.default.get({colId:this.fk_column_id}):null}async getChildren(e=l.default.ncMeta){if(this.children)return this.children;if(!this.is_group)return null;const t=await d.default.getList(c.CacheScope.FILTER_EXP,[this.id]);let{list:a}=t;const{isNoneList:i}=t;return i||a.length||(a=await e.metaList2(null,null,c.MetaTable.FILTER_EXP,{condition:{fk_parent_id:this.id}}),await d.default.setList(c.CacheScope.FILTER_EXP,[this.id],a)),a&&a.map((e=>new p(e)))}static async getFilterObject({viewId:e},t=l.default.ncMeta){var a;const i=await d.default.getList(c.CacheScope.FILTER_EXP,[e]);let{list:s}=i;const{isNoneList:o}=i;o||s.length||(s=await t.metaList2(null,null,c.MetaTable.FILTER_EXP,{condition:{fk_view_id:e}}),await d.default.setList(c.CacheScope.FILTER_EXP,[e],s));const r={is_group:!0,children:[],logical_op:"and"},u={},m={};for(const e of s)e._fk_parent_id?(u[e._fk_parent_id]=u[e._fk_parent_id]||[],u[e._fk_parent_id].push(e),m[e.id]=e,e.column=await new p(e).getColumn(),null===(a=e.column)||void 0===a||a.uidt,n.UITypes.LinkToAnotherRecord):(r.children.push(e),m[r.id]=r);for(const[e,t]of Object.entries(u))(null==m?void 0:m[e])&&(m[e].children=t);return r}static async get(e,t=l.default.ncMeta){let a=e&&await d.default.get(`${c.CacheScope.FILTER_EXP}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,c.MetaTable.FILTER_EXP,{id:e}),await d.default.set(`${c.CacheScope.FILTER_EXP}:${e}`,a)),a&&new p(a)}static async rootFilterList({viewId:e},t=l.default.ncMeta){const a=await d.default.getList(c.CacheScope.FILTER_EXP,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,c.MetaTable.FILTER_EXP,{condition:{fk_view_id:e}}),await d.default.setList(c.CacheScope.FILTER_EXP,[e],i)),null==i?void 0:i.map((e=>new p(e)))}}t.default=p},39659:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(85750)),s=i(a(27552)),o=a(33402),r=a(13609);class l{constructor(e){Object.assign(this,e)}static async list(e,{limit:t=25,offset:a=0},i=s.default.ncMeta){const n=await i.metaList2(null,null,r.MetaTable.HOOK_LOGS,Object.assign(Object.assign({condition:{fk_hook_id:e.fk_hook_id}},"ERROR"===process.env.NC_AUTOMATION_LOG_LEVEL&&{xcCondition:{error_message:{neq:null}}}),{orderBy:{created_at:"desc"},limit:t,offset:a}));return null==n?void 0:n.map((e=>new l(e)))}static async insert(e,t=s.default.ncMeta){if("OFF"===process.env.NC_AUTOMATION_LOG_LEVEL)return;const a=(0,o.extractProps)(e,["base_id","project_id","fk_hook_id","type","event","operation","test_call","payload","conditions","notification","error_code","error_message","error","execution_time","response","triggered_by"]);if((!e.project_id||!e.base_id)&&e.fk_hook_id){const i=await n.default.get(e.fk_hook_id,t);a.project_id=i.project_id,a.base_id=i.base_id}return"object"==typeof a.notification&&(a.notification=JSON.stringify(a.notification)),a.execution_time=parseInt(a.execution_time)||0,await t.metaInsert2(null,null,r.MetaTable.HOOK_LOGS,a)}static async count({hookId:e},t=s.default.ncMeta){var a,i;const n=t.knex(r.MetaTable.HOOK_LOGS);return e&&n.where(`${r.MetaTable.HOOK_LOGS}.fk_hook_id`,e),"ERROR"===process.env.NC_AUTOMATION_LOG_LEVEL&&n.whereNotNull(`${r.MetaTable.HOOK_LOGS}.error_message`),null!==(i=null===(a=await n.count("id",{as:"count"}).first())||void 0===a?void 0:a.count)&&void 0!==i?i:0}}t.default=l},35141:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(86026)),o=i(a(27552)),r=i(a(37912)),l=a(33402),c=a(13609);class d{constructor(e){Object.assign(this,e)}static async get(e,t=o.default.ncMeta){let a=e&&await r.default.get(`${c.CacheScope.KANBAN_VIEW}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,c.MetaTable.KANBAN_VIEW,{fk_view_id:e}),await r.default.set(`${c.CacheScope.KANBAN_VIEW}:${e}`,a)),a&&new d(a)}static async IsColumnBeingUsedAsGroupingField(e,t=o.default.ncMeta){return(await t.metaList2(null,null,c.MetaTable.KANBAN_VIEW,{condition:{fk_grp_col_id:e}})).length>0}static async insert(e,t=o.default.ncMeta){var a;const i=await s.default.get(e.fk_view_id,t).then((e=>null==e?void 0:e.getModel(t))).then((e=>e.getColumns(t))),r=(0,l.extractProps)(e,["project_id","base_id","fk_view_id","fk_grp_col_id","meta"]);if(r.fk_cover_image_col_id=(null==e?void 0:e.fk_cover_image_col_id)||(null===(a=null==i?void 0:i.find((e=>e.uidt===n.UITypes.Attachment)))||void 0===a?void 0:a.id),!e.project_id||!e.base_id){const t=await s.default.get(e.fk_view_id);r.project_id=t.project_id,r.base_id=t.base_id}return await t.metaInsert2(null,null,c.MetaTable.KANBAN_VIEW,r,!0),this.get(e.fk_view_id,t)}static async update(e,t,a=o.default.ncMeta){var i;const n=`${c.CacheScope.KANBAN_VIEW}:${e}`;let s=await r.default.get(n,c.CacheGetType.TYPE_OBJECT);const d=(0,l.extractProps)(t,["fk_cover_image_col_id","fk_grp_col_id","meta"]);return d.meta&&"object"==typeof d.meta&&(d.meta=JSON.stringify(null!==(i=d.meta)&&void 0!==i?i:{})),s&&(s=Object.assign(Object.assign({},s),d),await r.default.set(n,s)),await a.metaUpdate(null,null,c.MetaTable.KANBAN_VIEW,d,{fk_view_id:e})}}t.default=d},34653:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(86026)),s=i(a(27552)),o=i(a(37912)),r=a(33402),l=a(13609);class c{constructor(e){Object.assign(this,e)}static async get(e,t=s.default.ncMeta){let a=e&&await o.default.get(`${l.CacheScope.KANBAN_VIEW_COLUMN}:${e}`,l.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,l.MetaTable.KANBAN_VIEW_COLUMNS,e),await o.default.set(`${l.CacheScope.KANBAN_VIEW_COLUMN}:${e}`,a)),a&&new c(a)}static async insert(e,t=s.default.ncMeta){const a=(0,r.extractProps)(e,["fk_view_id","fk_column_id","show","project_id","base_id"]);if(a.order=await t.metaGetNextOrder(l.MetaTable.KANBAN_VIEW_COLUMNS,{fk_view_id:e.fk_view_id}),!e.project_id||!e.base_id){const i=await n.default.get(e.fk_view_id,t);a.project_id=i.project_id,a.base_id=i.base_id}const{id:i,fk_column_id:c}=await t.metaInsert2(null,null,l.MetaTable.KANBAN_VIEW_COLUMNS,a);return await o.default.set(`${l.CacheScope.KANBAN_VIEW_COLUMN}:${c}`,i),await o.default.appendToList(l.CacheScope.KANBAN_VIEW_COLUMN,[e.fk_view_id],`${l.CacheScope.KANBAN_VIEW_COLUMN}:${i}`),this.get(i,t)}static async list(e,t=s.default.ncMeta){const a=await o.default.getList(l.CacheScope.KANBAN_VIEW_COLUMN,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,l.MetaTable.KANBAN_VIEW_COLUMNS,{condition:{fk_view_id:e},orderBy:{order:"asc"}}),await o.default.setList(l.CacheScope.KANBAN_VIEW_COLUMN,[e],i)),i.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==i?void 0:i.map((e=>new c(e)))}}t.default=c},32188:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(33505)),s=i(a(83889)),o=i(a(27552)),r=i(a(37912)),l=a(33402),c=a(13609);class d{constructor(e){this.virtual=!1,Object.assign(this,e)}async getChildColumn(e=o.default.ncMeta){return this.childColumn=await s.default.get({colId:this.fk_child_column_id},e)}async getMMChildColumn(e=o.default.ncMeta){return this.mmChildColumn=await s.default.get({colId:this.fk_mm_child_column_id},e)}async getParentColumn(e=o.default.ncMeta){return this.parentColumn=await s.default.get({colId:this.fk_parent_column_id},e)}async getMMParentColumn(e=o.default.ncMeta){return this.mmParentColumn=await s.default.get({colId:this.fk_mm_parent_column_id},e)}async getMMModel(e=o.default.ncMeta){return this.mmModel=await n.default.getByIdOrName({id:this.fk_mm_model_id},e)}async getRelatedTable(e=o.default.ncMeta){return this.relatedTable=await n.default.getByIdOrName({id:this.fk_related_model_id},e)}static async insert(e,t=o.default.ncMeta){const a=(0,l.extractProps)(e,["fk_column_id","type","fk_child_column_id","fk_parent_column_id","fk_mm_model_id","fk_mm_child_column_id","fk_mm_parent_column_id","ur","dr","fk_index_name","fk_related_model_id","virtual"]);return await t.metaInsert2(null,null,c.MetaTable.COL_RELATIONS,a),this.read(e.fk_column_id,t)}static async read(e,t=o.default.ncMeta){let a=e&&await r.default.get(`${c.CacheScope.COL_RELATION}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,c.MetaTable.COL_RELATIONS,{fk_column_id:e}),await r.default.set(`${c.CacheScope.COL_RELATION}:${e}`,a)),a?new d(a):null}}t.default=d},80483:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(15147),s=i(a(32188)),o=i(a(27552));class r extends s.default{constructor(){super(...arguments),this.rollup_function="count"}get fk_relation_column_id(){return this.fk_column_id}get fk_rollup_column_id(){return"hm"===this.type?this.fk_child_column_id:"mm"===this.type?this.fk_parent_column_id:void 0}async getRelationColumn(e=o.default.ncMeta){return await n.Column.get({colId:this.fk_column_id},e)}async getRollupColumn(e=o.default.ncMeta){return await n.Column.get({colId:this.fk_rollup_column_id},e)}static async read(e,t=o.default.ncMeta){const a=await super.read(e,t);return a&&new r(a)}static async insert(e,t=o.default.ncMeta){const a=await super.insert(e,t);return a&&new r(a)}}t.default=r},82994:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(83889)),s=i(a(27552)),o=i(a(37912)),r=a(33402),l=a(13609);class c{constructor(e){Object.assign(this,e)}async getRelationColumn(){return await n.default.get({colId:this.fk_relation_column_id})}async getLookupColumn(){return await n.default.get({colId:this.fk_lookup_column_id})}static async insert(e,t=s.default.ncMeta){const a=(0,r.extractProps)(e,["fk_column_id","fk_relation_column_id","fk_lookup_column_id"]);return await t.metaInsert2(null,null,l.MetaTable.COL_LOOKUP,a),await o.default.appendToList(l.CacheScope.COL_LOOKUP,[e.fk_lookup_column_id],`${l.CacheScope.COL_LOOKUP}:${e.fk_column_id}`),await o.default.appendToList(l.CacheScope.COL_LOOKUP,[e.fk_relation_column_id],`${l.CacheScope.COL_LOOKUP}:${e.fk_column_id}`),this.read(e.fk_column_id,t)}static async read(e,t=s.default.ncMeta){let a=e&&await o.default.get(`${l.CacheScope.COL_LOOKUP}:${e}`,l.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,l.MetaTable.COL_LOOKUP,{fk_column_id:e}),await o.default.set(`${l.CacheScope.COL_LOOKUP}:${e}`,a)),a?new c(a):null}}t.default=c},78567:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(86026)),s=i(a(17434)),o=a(33402),r=i(a(37912)),l=i(a(27552)),c=a(13609);class d{constructor(e){Object.assign(this,e)}static async get(e,t=l.default.ncMeta){let a=e&&await r.default.get(`${c.CacheScope.MAP_VIEW}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,c.MetaTable.MAP_VIEW,{fk_view_id:e}),await r.default.set(`${c.CacheScope.MAP_VIEW}:${e}`,a)),a&&new d(a)}static async insert(e,t=l.default.ncMeta){const a={project_id:e.project_id,base_id:e.base_id,fk_view_id:e.fk_view_id,fk_geo_data_col_id:e.fk_geo_data_col_id,meta:e.meta},i=await n.default.get(e.fk_view_id);return e.project_id&&e.base_id||(a.project_id=i.project_id,a.base_id=i.base_id),await t.metaInsert2(null,null,c.MetaTable.MAP_VIEW,a,!0),this.get(e.fk_view_id,t)}static async update(e,t,a=l.default.ncMeta){var i;const d=`${c.CacheScope.MAP_VIEW}:${e}`;let u=await r.default.get(d,c.CacheGetType.TYPE_OBJECT);const p=(0,o.extractProps)(t,["fk_geo_data_col_id","meta"]);if(p.meta&&"object"==typeof p.meta&&(p.meta=JSON.stringify(null!==(i=p.meta)&&void 0!==i?i:{})),u&&(u=Object.assign(Object.assign({},u),p),await r.default.set(d,u)),null!=t.fk_geo_data_col_id){const a=(await s.default.list(e)).find((e=>e.fk_column_id===t.fk_geo_data_col_id));await n.default.updateColumn(t.fk_view_id,a.id,{show:!0})}return await a.metaUpdate(null,null,c.MetaTable.MAP_VIEW,p,{fk_view_id:e})}}t.default=d},17434:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(86026)),s=i(a(27552)),o=i(a(37912)),r=a(13609);class l{constructor(e){Object.assign(this,e)}static async get(e,t=s.default.ncMeta){let a=e&&await o.default.get(`${r.CacheScope.MAP_VIEW_COLUMN}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,r.MetaTable.MAP_VIEW_COLUMNS,e),await o.default.set(`${r.CacheScope.MAP_VIEW_COLUMN}:${e}`,a)),a&&new l(a)}static async insert(e,t=s.default.ncMeta){const a={fk_view_id:e.fk_view_id,fk_column_id:e.fk_column_id,order:await t.metaGetNextOrder(r.MetaTable.MAP_VIEW_COLUMNS,{fk_view_id:e.fk_view_id}),show:e.show,project_id:e.project_id,base_id:e.base_id};if(!e.project_id||!e.base_id){const i=await n.default.get(e.fk_view_id,t);a.project_id=i.project_id,a.base_id=i.base_id}const{id:i,fk_column_id:l}=await t.metaInsert2(null,null,r.MetaTable.MAP_VIEW_COLUMNS,a);await o.default.set(`${r.CacheScope.MAP_VIEW_COLUMN}:${l}`,i);const{list:c}=await o.default.getList(r.CacheScope.MAP_VIEW_COLUMN,[e.fk_view_id]);return(null==c?void 0:c.length)&&await o.default.appendToList(r.CacheScope.MAP_VIEW_COLUMN,[e.fk_view_id],`${r.CacheScope.MAP_VIEW_COLUMN}:${i}`),this.get(i,t)}static async list(e,t=s.default.ncMeta){const a=await o.default.getList(r.CacheScope.MAP_VIEW_COLUMN,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,r.MetaTable.MAP_VIEW_COLUMNS,{condition:{fk_view_id:e},orderBy:{order:"asc"}}),await o.default.setList(r.CacheScope.MAP_VIEW_COLUMN,[e],i)),i.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==i?void 0:i.map((e=>new l(e)))}}t.default=l},33505:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(1635)),o=i(a(85750)),r=i(a(67094)),l=i(a(86026)),c=i(a(83889)),d=a(33402),u=a(70939),p=a(51401),m=a(13609),f=i(a(37912)),h=i(a(27552)),g=a(88717),_=a(36734);class b{constructor(e){Object.assign(this,e)}async getColumns(e=h.default.ncMeta){return this.columns=await c.default.list({fk_model_id:this.id},e),this.columns}async getViews(e=!1,t=h.default.ncMeta){return this.views=await l.default.listWithInfo(this.id,t),this.views}get primaryKey(){var e;return this.columns?null===(e=this.columns)||void 0===e?void 0:e.find((e=>e.pk)):null}get primaryKeys(){var e;return this.columns?null===(e=this.columns)||void 0===e?void 0:e.filter((e=>e.pk)):null}get displayValue(){var e;if(!this.columns)return null;const t=null===(e=this.columns)||void 0===e?void 0:e.find((e=>e.pv));if(t)return t;if(this.mm)return this.columns[0];const a=this.columns.indexOf(this.primaryKey);return a<this.columns.length-1?this.columns[a+1]:this.columns[0]}static async insert(e,t,a,i=h.default.ncMeta){const s=(0,d.extractProps)(a,["table_name","title","mm","order","type","id"]);s.mm=!!s.mm,s.order||(s.order=await i.metaGetNextOrder(m.MetaTable.FORM_VIEW_COLUMNS,{project_id:e,base_id:t})),s.type||(s.type=n.ModelTypes.TABLE);const{id:o}=await i.metaInsert2(e,t,m.MetaTable.MODELS,s);t&&await f.default.appendToList(m.CacheScope.MODEL,[e,t],`${m.CacheScope.MODEL}:${o}`),await f.default.appendToList(m.CacheScope.MODEL,[e],`${m.CacheScope.MODEL}:${o}`);const r=await l.default.insert({fk_model_id:o,title:a.title||a.table_name,is_default:!0,type:n.ViewTypes.GRID},i);for(const e of(null==a?void 0:a.columns)||[])await c.default.insert(Object.assign(Object.assign({},e),{fk_model_id:o,view:r}),i);return this.getWithInfo({id:o},i)}static async list({project_id:e,base_id:t},a=h.default.ncMeta){const i=await f.default.getList(m.CacheScope.MODEL,[e,t]);let{list:n}=i;const{isNoneList:s}=i;if(!s&&!n.length){n=await a.metaList2(e,t,m.MetaTable.MODELS,{orderBy:{order:"asc"}});for(const e of n)e.meta=(0,_.parseMetaProp)(e);await f.default.setList(m.CacheScope.MODEL,[e,t],n)}return n.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),n.map((e=>new b(e)))}static async listWithInfo({project_id:e,db_alias:t},a=h.default.ncMeta){const i=await f.default.getList(m.CacheScope.MODEL,[e,t]);let{list:n}=i;const{isNoneList:s}=i;if(!s&&!n.length){n=await a.metaList2(e,t,m.MetaTable.MODELS);for(const e of n)e.meta=(0,_.parseMetaProp)(e);await f.default.setList(m.CacheScope.MODEL,[e],n)}return n.map((e=>new b(e)))}static async clear({id:e}){await f.default.delAll(m.CacheScope.MODEL,`*${e}*`),await c.default.clearList({fk_model_id:e})}static async get(e,t=h.default.ncMeta){let a=e&&await f.default.get(`${m.CacheScope.MODEL}:${e}`,m.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,m.MetaTable.MODELS,e),a&&(a.meta=(0,_.parseMetaProp)(a),await f.default.set(`${m.CacheScope.MODEL}:${a.id}`,a))),a&&new b(a)}static async getByIdOrName(e,t=h.default.ncMeta){const a="id"in e?null==e?void 0:e.id:e;let i=a&&await f.default.get(`${m.CacheScope.MODEL}:${a}`,m.CacheGetType.TYPE_OBJECT);return i||(i=await t.metaGet2(null,null,m.MetaTable.MODELS,a),i&&(i.meta=(0,_.parseMetaProp)(i))),i?(i.meta=(0,_.parseMetaProp)(i),await f.default.set(`${m.CacheScope.MODEL}:${i.id}`,i),new b(i)):null}static async getWithInfo({table_name:e,id:t},a=h.default.ncMeta){let i=t&&await f.default.get(`${m.CacheScope.MODEL}:${t}`,m.CacheGetType.TYPE_OBJECT);if(i||(i=await a.metaGet2(null,null,m.MetaTable.MODELS,t||{table_name:e}),i&&(i.meta=(0,_.parseMetaProp)(i),await f.default.set(`${m.CacheScope.MODEL}:${i.id}`,i))),i){const e=new b(i),t=await e.getColumns(a);return await e.getViews(!1,a),e.columnsById=t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.id]:t})),{}),e}return null}static async getBaseModelSQL(e,t=h.default.ncMeta){const a=(null==e?void 0:e.model)||await this.get(e.id,t);if(!(null==e?void 0:e.viewId)){const i=await l.default.getDefaultView(a.id,t);e.viewId=i.id}return new g.BaseModelSqlv2({dbDriver:e.dbDriver,viewId:e.viewId,model:a})}async delete(e=h.default.ncMeta,t=!1){await r.default.deleteRowComments(this.id,e);for(const t of await this.getViews(!0,e))await t.delete(e);for(const t of await o.default.list({fk_model_id:this.id},e))await o.default.delete(t.id,e);for(const t of await this.getColumns(e)){let a=null,i=null;switch(t.uidt){case n.UITypes.Rollup:a=m.MetaTable.COL_ROLLUP,i=m.CacheScope.COL_ROLLUP;break;case n.UITypes.Lookup:a=m.MetaTable.COL_LOOKUP,i=m.CacheScope.COL_LOOKUP;break;case n.UITypes.ForeignKey:case n.UITypes.LinkToAnotherRecord:a=m.MetaTable.COL_RELATIONS,i=m.CacheScope.COL_RELATION;break;case n.UITypes.MultiSelect:case n.UITypes.SingleSelect:a=m.MetaTable.COL_SELECT_OPTIONS,i=m.CacheScope.COL_SELECT_OPTION;break;case n.UITypes.Formula:a=m.MetaTable.COL_FORMULA,i=m.CacheScope.COL_FORMULA;break;case n.UITypes.QrCode:a=m.MetaTable.COL_QRCODE,i=m.CacheScope.COL_QRCODE;break;case n.UITypes.Barcode:a=m.MetaTable.COL_BARCODE,i=m.CacheScope.COL_BARCODE}a&&i&&(await e.metaDelete(null,null,a,{fk_column_id:t.id}),await f.default.deepDel(i,`${i}:${t.id}`,m.CacheDelDirection.CHILD_TO_PARENT))}if(t){const t=await e.metaList2(null,null,m.MetaTable.COL_RELATIONS,{condition:{fk_related_model_id:this.id}});for(const e of t)await f.default.deepDel(m.CacheScope.COL_RELATION,`${m.CacheScope.COL_RELATION}:${e.fk_column_id}`,m.CacheDelDirection.CHILD_TO_PARENT);await e.metaDelete(null,null,m.MetaTable.COL_RELATIONS,{fk_related_model_id:this.id})}return await f.default.deepDel(m.CacheScope.COLUMN,`${m.CacheScope.COLUMN}:${this.id}`,m.CacheDelDirection.CHILD_TO_PARENT),await e.metaDelete(null,null,m.MetaTable.COLUMNS,{fk_model_id:this.id}),await f.default.deepDel(m.CacheScope.MODEL,`${m.CacheScope.MODEL}:${this.id}`,m.CacheDelDirection.CHILD_TO_PARENT),await e.metaDelete(null,null,m.MetaTable.MODELS,this.id),await f.default.del(`${m.CacheScope.MODEL}:${this.project_id}:${this.id}`),await f.default.del(`${m.CacheScope.MODEL}:${this.project_id}:${this.title}`),!0}async mapAliasToColumn(e,t={isMySQL:!1,isSqlite:!1,isMssql:!1,isPg:!1},a){var i,o;const r={};for(const l of await this.getColumns()){if((0,n.isVirtualCol)(l))continue;let c=void 0!==(null==e?void 0:e[l.column_name])?null==e?void 0:e[l.column_name]:null==e?void 0:e[l.title];if(void 0!==c){if(l.uidt===n.UITypes.Attachment&&"string"!=typeof c&&(c=JSON.stringify(c)),l.uidt===n.UITypes.DateTime&&(0,s.default)(c).isValid()){const{isMySQL:e,isSqlite:i,isMssql:n,isPg:o}=t;c.indexOf("-")<0&&c.indexOf("+")<0&&"Z"!==c.slice(-1)&&(c+="+00:00"),c=e?a.raw("CONVERT_TZ(?, '+00:00', @@GLOBAL.time_zone)",[(0,s.default)(c).utc().format("YYYY-MM-DD HH:mm:ss")]):i?(0,s.default)(c).utc().format("YYYY-MM-DD HH:mm:ssZ"):o?a.raw("? AT TIME ZONE CURRENT_SETTING('timezone')",[(0,s.default)(c).utc().format("YYYY-MM-DD HH:mm:ssZ")]):n?a.raw("SWITCHOFFSET(CONVERT(datetimeoffset, ?), DATENAME(TzOffset, SYSDATETIMEOFFSET()))",[(0,s.default)(c).utc().format("YYYY-MM-DD HH:mm:ssZ")]):(0,s.default)(c).utc().format("YYYY-MM-DD HH:mm:ssZ")}r[(0,u.sanitize)(l.column_name)]=c,t.isPg&&"bytea"===l.dt&&(r[(0,u.sanitize)(l.column_name)]=a.raw(`decode(?, '${"hex"===(null===(i=l.meta)||void 0===i?void 0:i.format)?"hex":"escape"}')`,["hex"===(null===(o=l.meta)||void 0===o?void 0:o.format)&&(c+"").length%2==1?"0"+c:c]))}}return r}async mapColumnToAlias(e){const t={};for(const a of await this.getColumns()){if((0,n.isVirtualCol)(a))continue;let i=void 0!==(null==e?void 0:e[a.title])?null==e?void 0:e[a.title]:null==e?void 0:e[a.column_name];void 0!==i&&(a.uidt===n.UITypes.Attachment&&"string"!=typeof i&&(i=JSON.stringify(i)),t[(0,u.sanitize)(a.title)]=i)}return t}static async updateAliasAndTableName(e,t,a,i=h.default.ncMeta){t||p.NcError.badRequest("Missing 'title' property in body"),a||p.NcError.badRequest("Missing 'table_name' property in body");const s=`${m.CacheScope.MODEL}:${e}`,o=await f.default.get(s,m.CacheGetType.TYPE_OBJECT);let r=Object.assign({},o);o?(o.title=t,o.table_name=a,await f.default.set(s,o)):r=await this.get(e),await f.default.del(`${m.CacheScope.MODEL}:${r.project_id}:${r.base_id}:${r.title}`),await f.default.del(`${m.CacheScope.MODEL}:${r.project_id}:${r.title}`);const l=await i.metaUpdate(null,null,m.MetaTable.MODELS,{title:t,table_name:a},e);await f.default.delAll(m.CacheScope.SINGLE_QUERY,`${e}:*`);for(const t of await this.get(e).then((e=>e.getColumns()))){if(!(0,n.isLinksOrLTAR)(t))continue;const a=await t.getColOptions();a.fk_related_model_id!==e&&await f.default.delAll(m.CacheScope.SINGLE_QUERY,`${a.fk_related_model_id}:*`)}return l}static async markAsMmTable(e,t=!0,a=h.default.ncMeta){const i=`${m.CacheScope.MODEL}:${e}`,n=await f.default.get(i,m.CacheGetType.TYPE_OBJECT);return n&&(n.mm=t,await f.default.set(i,n)),await a.metaUpdate(null,null,m.MetaTable.MODELS,{mm:t},e)}async getAliasColMapping(){return(await this.getColumns()).reduce(((e,t)=>(t.column_name&&(e[t.title]=t.column_name),e)),{})}async getColAliasMapping(){return(await this.getColumns()).reduce(((e,t)=>(t.column_name&&(e[t.column_name]=t.title),e)),{})}static async updateOrder(e,t,a=h.default.ncMeta){const i=`${m.CacheScope.MODEL}:${e}`,n=await f.default.get(i,m.CacheGetType.TYPE_OBJECT);return n&&(n.order=t,await f.default.set(i,n)),await a.metaUpdate(null,null,m.MetaTable.MODELS,{order:t},e)}static async updatePrimaryColumn(e,t,a=h.default.ncMeta){var i;const n=await this.getWithInfo({id:e}),s=n.columns.find((e=>e.id===t));s||p.NcError.badRequest("Column not found");for(const e of(null===(i=n.columns)||void 0===i?void 0:i.filter((e=>e.pv)))||[]){const t=`${m.CacheScope.COLUMN}:${e.id}`,i=await f.default.get(t,m.CacheGetType.TYPE_OBJECT);i&&(i.pv=!1,await f.default.set(t,i)),await a.metaUpdate(null,null,m.MetaTable.COLUMNS,{pv:!1},e.id)}const o=`${m.CacheScope.COLUMN}:${s.id}`,r=await f.default.get(o,m.CacheGetType.TYPE_OBJECT);r&&(r.pv=!0,await f.default.set(o,r)),await a.metaUpdate(null,null,m.MetaTable.COLUMNS,{pv:!0},s.id);const c=await a.metaList2(null,null,m.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_column_id:s.id}});if(c.length)for(const e of c)await l.default.fixPVColumnForView(e.fk_view_id,a);return!0}static async setAsMm(e,t=h.default.ncMeta){const a=`${m.CacheScope.MODEL}:${e}`,i=await f.default.get(a,m.CacheGetType.TYPE_OBJECT);i&&(i.mm=!0,await f.default.set(a,i)),await t.metaUpdate(null,null,m.MetaTable.MODELS,{mm:!0},e)}static async getByAliasOrId({project_id:e,base_id:t,aliasOrId:a},i=h.default.ncMeta){const n=t?`${m.CacheScope.MODEL}:${e}:${t}:${a}`:`${m.CacheScope.MODEL}:${e}:${a}`,s=e&&a&&await f.default.get(n,m.CacheGetType.TYPE_OBJECT);if(!s){const s=t?await i.metaGet2(null,null,m.MetaTable.MODELS,{project_id:e,base_id:t},null,{_or:[{id:{eq:a}},{title:{eq:a}}]}):await i.metaGet2(null,null,m.MetaTable.MODELS,{project_id:e},null,{_or:[{id:{eq:a}},{title:{eq:a}}]});return s&&(await f.default.set(n,s.id),await f.default.set(`${m.CacheScope.MODEL}:${s.id}`,s)),s&&new b(s)}return s&&this.get(s)}static async checkTitleAvailable({table_name:e,project_id:t,base_id:a,exclude_id:i},n=h.default.ncMeta){return!await n.metaGet2(t,a,m.MetaTable.MODELS,{table_name:e},null,i&&{id:{neq:i}})}static async checkAliasAvailable({title:e,project_id:t,base_id:a,exclude_id:i},n=h.default.ncMeta){return!await n.metaGet2(t,a,m.MetaTable.MODELS,{title:e},null,i&&{id:{neq:i}})}async getAliasColObjMap(){return(await this.getColumns()).reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.title]:t})),{})}static async updateMeta(e,t,a=h.default.ncMeta){const i=`${m.CacheScope.MODEL}:${e}`,n=await f.default.get(i,m.CacheGetType.TYPE_OBJECT);if(n)try{n.meta="string"==typeof t?JSON.parse(t):t,await f.default.set(i,n)}catch(e){}return await a.metaUpdate(null,null,m.MetaTable.MODELS,{meta:"object"==typeof t?JSON.stringify(t):t},e)}}t.default=b},42877:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(86026)),s=i(a(27552)),o=a(13609),r=i(a(37912)),l=a(33402);class c{constructor(e){Object.assign(this,e)}static async list(e){const t=await r.default.getList(o.CacheScope.MODEL_ROLE_VISIBILITY,[e]);let{list:a}=t;const{isNoneList:i}=t;return i||a.length||(a=await s.default.ncMeta.metaList2(e,null,o.MetaTable.MODEL_ROLE_VISIBILITY),await r.default.setList(o.CacheScope.MODEL_ROLE_VISIBILITY,[e],a)),null==a?void 0:a.map((e=>new c(e)))}static async get(e,t=s.default.ncMeta){let a=e.fk_view_id&&e.role&&await r.default.get(`${o.CacheScope.MODEL_ROLE_VISIBILITY}:${e.fk_view_id}:${e.role}`,o.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,o.MetaTable.MODEL_ROLE_VISIBILITY,{fk_view_id:e.fk_view_id,role:e.role}),await r.default.set(`${o.CacheScope.MODEL_ROLE_VISIBILITY}:${e.fk_view_id}:${e.role}`,a)),a&&new c(a)}static async update(e,t,a){const i=`${o.CacheScope.MODEL_ROLE_VISIBILITY}:${e}:${t}`,n=await r.default.get(i,o.CacheGetType.TYPE_OBJECT);return n&&(n.disabled=a.disabled,await r.default.set(i,n)),await s.default.ncMeta.metaUpdate(null,null,o.MetaTable.MODEL_ROLE_VISIBILITY,{disabled:a.disabled},{fk_view_id:e,role:t})}async delete(){return await c.delete(this.fk_view_id,this.role)}static async delete(e,t){return await r.default.deepDel(o.CacheScope.MODEL_ROLE_VISIBILITY,`${o.CacheScope.MODEL_ROLE_VISIBILITY}:${e}:${t}`,o.CacheDelDirection.CHILD_TO_PARENT),await s.default.ncMeta.metaDelete(null,null,o.MetaTable.MODEL_ROLE_VISIBILITY,{fk_view_id:e,role:t})}static async insert(e,t=s.default.ncMeta){const a=(0,l.extractProps)(e,["role","disabled","fk_view_id","project_id","base_id"]);if(!a.project_id||!a.base_id){const i=await n.default.get(e.fk_view_id,t);a.project_id=i.project_id,a.base_id=i.base_id}const i=await t.metaInsert2(null,null,o.MetaTable.MODEL_ROLE_VISIBILITY,a),c=`${o.CacheScope.MODEL_ROLE_VISIBILITY}:${e.fk_view_id}:${e.role}`;return a.id=i.id,await r.default.appendToList(o.CacheScope.MODEL_ROLE_VISIBILITY,[a.project_id],c),this.get({fk_view_id:e.fk_view_id,role:e.role},t)}}t.default=c},62274:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(33402),s=i(a(27552)),o=a(13609),r=a(36734);t.default=class{constructor(e){Object.assign(this,e)}static async insert(e,t=s.default.ncMeta){const a=(0,n.extractProps)(e,["body","type","fk_user_id","is_read","is_deleted"]);return a.body=(0,r.stringifyMetaProp)(a,"body"),await t.metaInsert2(null,null,o.MetaTable.NOTIFICATION,a)}static async list(e,t=s.default.ncMeta){const{limit:a=10,offset:i=0}=e,l=(0,n.extractProps)(e,["is_read","is_deleted","fk_user_id"]),c=await t.metaList(null,null,o.MetaTable.NOTIFICATION,{condition:l,limit:a,offset:i});for(const e of c)e.body=(0,r.parseMetaProp)(e,"body");return c}static async count(e,t=s.default.ncMeta){const a=(0,n.extractProps)(e,["is_read","is_deleted","fk_user_id"]);return await t.metaCount(null,null,o.MetaTable.NOTIFICATION,{condition:a})}static async update(e,t,a=s.default.ncMeta){const i=(0,n.extractProps)(t,["body","type","fk_user_id","is_read","is_deleted"]);return"body"in i&&(i.body=(0,r.stringifyMetaProp)(i,"body")),await a.metaUpdate(null,null,o.MetaTable.NOTIFICATION,i,e)}static async markAllAsRead(e,t=s.default.ncMeta){return t.metaUpdate(null,null,o.MetaTable.NOTIFICATION,{is_read:!0},{fk_user_id:e,is_read:!1})}}},4691:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(27552)),s=i(a(37912)),o=a(33402),r=a(13609);class l{constructor(e){Object.assign(this,e)}static async get(e,t=n.default.ncMeta){let a=e&&await s.default.get(`${r.CacheScope.PLUGIN}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,r.MetaTable.PLUGIN,e),await s.default.set(`${r.CacheScope.PLUGIN}:${e}`,a)),a&&new l(a)}static async list(e=n.default.ncMeta){const t=await s.default.getList(r.CacheScope.PLUGIN,[]);let{list:a}=t;const{isNoneList:i}=t;return i||a.length||(a=await e.metaList2(null,null,r.MetaTable.PLUGIN),await s.default.setList(r.CacheScope.PLUGIN,[],a)),a}static async count(e=n.default.ncMeta){var t;return null===(t=await e.knex(r.MetaTable.PLUGIN).count("id",{as:"count"}))||void 0===t?void 0:t.count}static async update(e,t){const a=(0,o.extractProps)(t,["input","active"]);a.input&&"object"==typeof a.input&&(a.input=JSON.stringify(a.input));const i=`${r.CacheScope.PLUGIN}:${e}`;let l=await s.default.get(i,r.CacheGetType.TYPE_OBJECT);return l&&(l=Object.assign(Object.assign({},l),a),await s.default.set(i,l),await s.default.set(`${r.CacheScope.PLUGIN}:${l.title}`,l)),await n.default.ncMeta.metaUpdate(null,null,r.MetaTable.PLUGIN,a,e),this.get(e)}static async isPluginActive(e){var t;return!!(null===(t=await this.getPluginByTitle(e))||void 0===t?void 0:t.active)}static async getPluginByTitle(e,t=n.default.ncMeta){let a=e&&await s.default.get(`${r.CacheScope.PLUGIN}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,r.MetaTable.PLUGIN,{title:e}),await s.default.set(`${r.CacheScope.PLUGIN}:${e}`,a)),a}}t.default=l},61770:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(23520)),s=a(15147),o=i(a(27552)),r=a(13609),l=a(33402),c=i(a(37912)),d=a(36734),u=i(a(19356));class p{constructor(e){this.is_meta=!1,Object.assign(this,e)}static castType(e){return e&&new p(e)}static async createProject(e,t=o.default.ncMeta){var a;const i=(0,l.extractProps)(e,["id","title","prefix","description","is_meta","status","meta","color"]),{id:s}=await t.metaInsert2(null,null,r.MetaTable.PROJECT,i);await c.default.appendToList(r.CacheScope.PROJECT,[],`${r.CacheScope.PROJECT}:${s}`);for(const i of e.bases)await n.default.createBase(Object.assign(Object.assign({type:null===(a=i.config)||void 0===a?void 0:a.client},i),{projectId:s}),t);return await c.default.del(r.CacheScope.INSTANCE_META),this.getWithInfo(s,t)}static async list(e,t=o.default.ncMeta){const a=await c.default.getList(r.CacheScope.PROJECT,[]);let{list:i}=a;const{isNoneList:n}=a;n||i.length||(i=await t.metaList2(null,null,r.MetaTable.PROJECT,{xcCondition:{_or:[{deleted:{eq:!1}},{deleted:{eq:null}}]}}),await c.default.setList(r.CacheScope.PROJECT,[],i)),i=i.filter((e=>0===e.deleted||!1===e.deleted||null===e.deleted));const s=i.map((e=>this.castType(e)));return await Promise.all(s.map((e=>e.getBases(t)))),s}static async get(e,t=o.default.ncMeta){let a=e&&await c.default.get(`${r.CacheScope.PROJECT}:${e}`,r.CacheGetType.TYPE_OBJECT);return a?a.deleted&&(a=null):(a=await t.metaGet2(null,null,r.MetaTable.PROJECT,{id:e,deleted:!1}),a&&(a.meta=(0,d.parseMetaProp)(a),await c.default.set(`${r.CacheScope.PROJECT}:${e}`,a))),this.castType(a)}async getBases(e=o.default.ncMeta){return this.bases=await n.default.list({projectId:this.id},e)}static async getWithInfo(e,t=o.default.ncMeta){let a=e&&await c.default.get(`${r.CacheScope.PROJECT}:${e}`,r.CacheGetType.TYPE_OBJECT);if(a?(null==a?void 0:a.deleted)&&(a=null):(a=await t.metaGet2(null,null,r.MetaTable.PROJECT,{id:e,deleted:!1}),a&&(a.meta=(0,d.parseMetaProp)(a),await c.default.set(`${r.CacheScope.PROJECT}:${e}`,a)),(null==a?void 0:a.uuid)&&await c.default.set(`${r.CacheScope.PROJECT}:${a.uuid}`,e)),a){const e=new p(a);return await e.getBases(t),this.castType(e)}return null}static async softDelete(e,t=o.default.ncMeta){await this.clearConnectionPool(e,t);const a=`${r.CacheScope.PROJECT}:${e}`,i=await c.default.get(a,r.CacheGetType.TYPE_OBJECT);return i&&(await c.default.del(`${r.CacheScope.PROJECT}:${e}`),await c.default.del(`${r.CacheScope.PROJECT}:${i.title}`),await c.default.del(`${r.CacheScope.PROJECT}:${i.uuid}`),await c.default.del(`${r.CacheScope.PROJECT}:ref:${i.title}`),await c.default.del(`${r.CacheScope.PROJECT}:ref:${i.id}`)),await c.default.delAll(r.CacheScope.USER_PROJECT,"*"),await c.default.del(r.CacheScope.INSTANCE_META),await c.default.deepDel(r.CacheScope.PROJECT,`${r.CacheScope.PROJECT}:${e}`,r.CacheDelDirection.CHILD_TO_PARENT),await t.metaUpdate(null,null,r.MetaTable.PROJECT,{deleted:!0},e)}static async update(e,t,a=o.default.ncMeta){const i=(0,l.extractProps)(t,["title","prefix","status","description","meta","color","deleted","order","bases","uuid","password","roles"]),n=`${r.CacheScope.PROJECT}:${e}`;let s=await c.default.get(n,r.CacheGetType.TYPE_OBJECT);return s&&(s.uuid&&i.uuid&&s.uuid!==i.uuid&&(await c.default.del(`${r.CacheScope.PROJECT}:${s.uuid}`),await c.default.set(`${r.CacheScope.PROJECT}:${i.uuid}`,e)),s.uuid&&null===i.uuid&&await c.default.del(`${r.CacheScope.PROJECT}:${s.uuid}`),s.title&&i.title&&s.title!==i.title&&(await c.default.del(`${r.CacheScope.PROJECT}:${s.title}`),await c.default.set(`${r.CacheScope.PROJECT}:${i.title}`,e)),s=Object.assign(Object.assign({},s),i),await c.default.del(r.CacheScope.INSTANCE_META),await c.default.set(n,s)),i.meta&&(i.meta=(0,d.stringifyMetaProp)(i)),await a.metaUpdate(null,null,r.MetaTable.PROJECT,i,e)}static async delete(e,t=o.default.ncMeta){let a=await this.get(e);const i=await s.ProjectUser.getUsersList({project_id:e,offset:0,limit:1e3});for(const t of i)await s.ProjectUser.delete(e,t.id);const l=await n.default.list({projectId:e});for(const e of l)await e.delete(t);return a=await this.get(e),a&&(await c.default.del(`${r.CacheScope.PROJECT}:${a.uuid}`),await c.default.del(`${r.CacheScope.PROJECT}:${a.title}`),await c.default.del(`${r.CacheScope.PROJECT}:ref:${a.title}`),await c.default.del(`${r.CacheScope.PROJECT}:ref:${a.id}`)),await c.default.delAll(r.CacheScope.USER_PROJECT,"*"),await c.default.deepDel(r.CacheScope.PROJECT,`${r.CacheScope.PROJECT}:${e}`,r.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(null,null,r.MetaTable.AUDIT,{project_id:e}),await t.metaDelete(null,null,r.MetaTable.PROJECT,e)}static async getByUuid(e,t=o.default.ncMeta){const a=e&&await c.default.get(`${r.CacheScope.PROJECT}:${e}`,r.CacheGetType.TYPE_OBJECT);let i=null;return a?this.get(a):(i=await o.default.ncMeta.metaGet2(null,null,r.MetaTable.PROJECT,{uuid:e}),i&&(i.meta=(0,d.parseMetaProp)(i),await c.default.set(`${r.CacheScope.PROJECT}:${e}`,null==i?void 0:i.id)),(null==i?void 0:i.id)&&this.get(null==i?void 0:i.id,t))}static async getWithInfoByTitle(e,t=o.default.ncMeta){const a=await this.getByTitle(e,t);return a&&await a.getBases(t),a}static async getByTitle(e,t=o.default.ncMeta){const a=e&&await c.default.get(`${r.CacheScope.PROJECT}:${e}`,r.CacheGetType.TYPE_OBJECT);let i=null;return a?this.get(a):(i=await o.default.ncMeta.metaGet2(null,null,r.MetaTable.PROJECT,{title:e,deleted:!1}),i&&(i.meta=(0,d.parseMetaProp)(i),await c.default.set(`${r.CacheScope.PROJECT}:${e}`,null==i?void 0:i.id)),(null==i?void 0:i.id)&&this.get(null==i?void 0:i.id,t))}static async getByTitleOrId(e,t=o.default.ncMeta){const a=e&&await c.default.get(`${r.CacheScope.PROJECT}:ref:${e}`,r.CacheGetType.TYPE_OBJECT);let i=null;return a?this.get(a):(i=await o.default.ncMeta.metaGet2(null,null,r.MetaTable.PROJECT,{deleted:!1},null,{_or:[{id:{eq:e}},{title:{eq:e}}]}),i&&(i.meta=(0,d.parseMetaProp)(i),await c.default.set(`${r.CacheScope.PROJECT}:ref:${e}`,null==i?void 0:i.id)),(null==i?void 0:i.id)&&this.get(null==i?void 0:i.id,t))}static async getWithInfoByTitleOrId(e,t=o.default.ncMeta){const a=await this.getByTitleOrId(e,t);return a.meta=(0,d.parseMetaProp)(a),a&&await a.getBases(t),a}static async clearConnectionPool(e,t=o.default.ncMeta){const a=await this.get(e,t);if(a){const e=await a.getBases(t);for(const t of e)await u.default.deleteAwait(t)}}}t.default=p},11922:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(89604)),o=i(a(61770)),r=a(13609),l=i(a(27552)),c=i(a(37912)),d=a(33402),u=a(36734);class p{constructor(e){Object.assign(this,e)}static castType(e){return e&&new p(e)}static async insert(e,t=l.default.ncMeta){const a=(0,d.extractProps)(e,["fk_user_id","project_id","roles"]),{project_id:i,fk_user_id:n}=await t.metaInsert2(null,null,r.MetaTable.PROJECT_USERS,a,!0);return await c.default.delAll(r.CacheScope.USER_PROJECT,`${e.fk_user_id}:*`),this.get(i,n,t)}static async get(e,t,a=l.default.ncMeta){let i=e&&t&&await c.default.get(`${r.CacheScope.PROJECT_USER}:${e}:${t}`,r.CacheGetType.TYPE_OBJECT);return i||(i=await a.metaGet2(null,null,r.MetaTable.PROJECT_USERS,{fk_user_id:t,project_id:e}),await c.default.set(`${r.CacheScope.PROJECT_USER}:${e}:${t}`,i)),this.castType(i)}static async getUsersList({project_id:e,limit:t=25,offset:a=0,query:i},n=l.default.ncMeta){var s;const o=n.knex(r.MetaTable.USERS).select(`${r.MetaTable.USERS}.id`,`${r.MetaTable.USERS}.email`,`${r.MetaTable.USERS}.invite_token`,`${r.MetaTable.USERS}.roles as main_roles`,`${r.MetaTable.PROJECT_USERS}.project_id`,`${r.MetaTable.PROJECT_USERS}.roles as roles`).offset(a).limit(t);i&&o.where("email","like",`%${null===(s=i.toLowerCase)||void 0===s?void 0:s.call(i)}%`),o.leftJoin(r.MetaTable.PROJECT_USERS,(function(){this.on(`${r.MetaTable.PROJECT_USERS}.fk_user_id`,"=",`${r.MetaTable.USERS}.id`).andOn(`${r.MetaTable.PROJECT_USERS}.project_id`,"=",n.knex.raw("?",[e]))}));return await o}static async getUsersCount({project_id:e,query:t},a=l.default.ncMeta){var i;const n=a.knex(r.MetaTable.USERS);return t&&n.where("email","like",`%${null===(i=t.toLowerCase)||void 0===i?void 0:i.call(t)}%`),n.leftJoin(r.MetaTable.PROJECT_USERS,(function(){this.on(`${r.MetaTable.PROJECT_USERS}.fk_user_id`,"=",`${r.MetaTable.USERS}.id`).andOn(`${r.MetaTable.PROJECT_USERS}.project_id`,"=",a.knex.raw("?",[e]))})),(await n.count("id",{as:"count"}).first()).count}static async updateRoles(e,t,a,i=l.default.ncMeta){const n=`${r.CacheScope.PROJECT_USER}:${e}:${t}`,o=await c.default.get(n,r.CacheGetType.TYPE_OBJECT);o&&(o.roles=a,await c.default.set(n,o));const d=await s.default.get(t);if(d){const t=d.email;for(const i of[`${r.CacheScope.USER}:${t}___${e}`]){const e=await c.default.get(i,r.CacheGetType.TYPE_OBJECT);e&&(e.roles=a,await c.default.set(i,e))}}return await i.metaUpdate(null,null,r.MetaTable.PROJECT_USERS,{roles:a},{fk_user_id:t,project_id:e})}static async update(e,t,a,i=l.default.ncMeta){const n=(0,d.extractProps)(a,["starred","hidden","order"]),o=`${r.CacheScope.PROJECT_USER}:${e}:${t}`,u=await c.default.get(o,r.CacheGetType.TYPE_OBJECT);u&&(Object.assign(u,n),await c.default.set(o,u));const p=await s.default.get(t);if(p){const t=p.email;for(const a of[`${r.CacheScope.USER}:${t}`,`${r.CacheScope.USER}:${t}___${e}`]){const e=await c.default.get(a,r.CacheGetType.TYPE_OBJECT);e&&(Object.assign(e,n),await c.default.set(a,e))}}return await i.metaUpdate(null,null,r.MetaTable.PROJECT_USERS,n,{fk_user_id:t,project_id:e})}static async delete(e,t,a=l.default.ncMeta){const{email:i}=await a.metaGet2(null,null,r.MetaTable.USERS,{id:t});i&&await c.default.delAll(r.CacheScope.USER,`${i}*`);const n=await c.default.getList(r.CacheScope.USER_PROJECT,[t]);let{list:s}=n;const{isNoneList:o}=n;return!o&&(null==s?void 0:s.length)&&(s=s.filter((t=>t.id!==e)),await c.default.del(`${r.CacheScope.USER_PROJECT}:${t}:list`),s.length>0&&await c.default.setList(r.CacheScope.USER_PROJECT,[t],s)),await c.default.del(`${r.CacheScope.PROJECT_USER}:${e}:${t}`),await a.metaDelete(null,null,r.MetaTable.PROJECT_USERS,{fk_user_id:t,project_id:e})}static async getProjectsIdList(e,t=l.default.ncMeta){return await t.metaList2(null,null,r.MetaTable.PROJECT_USERS,{condition:{fk_user_id:e}})}static async getProjectsList(e,t,a=l.default.ncMeta){const i=a.knex(r.MetaTable.PROJECT).select(`${r.MetaTable.PROJECT}.id`).select(`${r.MetaTable.PROJECT}.title`).select(`${r.MetaTable.PROJECT}.prefix`).select(`${r.MetaTable.PROJECT}.status`).select(`${r.MetaTable.PROJECT}.description`).select(`${r.MetaTable.PROJECT}.meta`).select(`${r.MetaTable.PROJECT}.color`).select(`${r.MetaTable.PROJECT}.is_meta`).select(`${r.MetaTable.PROJECT}.created_at`).select(`${r.MetaTable.PROJECT}.updated_at`).select(`${r.MetaTable.PROJECT_USERS}.starred`).select(`${r.MetaTable.PROJECT_USERS}.roles as project_role`).select(`${r.MetaTable.PROJECT_USERS}.updated_at as last_accessed`).leftJoin(r.MetaTable.PROJECT_USERS,(function(){this.on(`${r.MetaTable.PROJECT_USERS}.project_id`,`${r.MetaTable.PROJECT}.id`),this.andOn(`${r.MetaTable.PROJECT_USERS}.fk_user_id`,a.knex.raw("?",[e]))})).where(`${r.MetaTable.PROJECT_USERS}.fk_user_id`,a.knex.raw("?",[e])).where((function(){this.where(`${r.MetaTable.PROJECT}.deleted`,!1).orWhereNull(`${r.MetaTable.PROJECT}.deleted`)})).where((function(){this.whereNull(`${r.MetaTable.PROJECT_USERS}.roles`).orWhereNot(`${r.MetaTable.PROJECT_USERS}.roles`,n.ProjectRoles.NO_ACCESS)}));t.starred&&i.where(`${r.MetaTable.PROJECT_USERS}.starred`,!0),t.shared&&i.where((function(){this.where((function(){this.where(`${r.MetaTable.PROJECT_USERS}.fk_user_id`,e).whereNot(`${r.MetaTable.PROJECT_USERS}.roles`,n.ProjectRoles.OWNER).whereNotNull(`${r.MetaTable.PROJECT_USERS}.roles`)}))})),t.recent&&i.orderBy(`${r.MetaTable.PROJECT_USERS}.updated_at`,"desc"),i.whereNot(`${r.MetaTable.PROJECT}.deleted`,!0);const s=await i;if(null==s?void 0:s.length){for(const e of s)e.meta=(0,u.parseMetaProp)(e);await c.default.setList(r.CacheScope.USER_PROJECT,[e],s)}const d=s.filter((e=>!(null==t?void 0:t.type)||e.type===t.type)).map((e=>o.default.castType(e)));return await Promise.all(d.map((e=>e.getBases(a)))),d}static async updateOrInsert(e,t,a,i=l.default.ncMeta){return await this.get(e,t,i)?await this.update(e,t,a,i):await this.insert({project_id:e,fk_user_id:t})}}t.default=p},50944:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(27552)),s=i(a(37912)),o=a(33402),r=a(13609),l=a(15147);class c{constructor(e){Object.assign(this,e)}static async insert(e,t=n.default.ncMeta){const a=(0,o.extractProps)(e,["fk_column_id","fk_qr_value_column_id"]);return await t.metaInsert2(null,null,r.MetaTable.COL_QRCODE,a),this.read(e.fk_column_id,t)}static async read(e,t=n.default.ncMeta){let a=e&&await s.default.get(`${r.CacheScope.COL_QRCODE}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,r.MetaTable.COL_QRCODE,{fk_column_id:e}),await s.default.set(`${r.CacheScope.COL_QRCODE}:${e}`,a)),a?new c(a):null}static async update(e,t,a=n.default.ncMeta){const i=(0,o.extractProps)(t,["fk_column_id","fk_qr_value_column_id"]),l=`${r.CacheScope.COL_QRCODE}:${e}`;let c=await s.default.get(l,r.CacheGetType.TYPE_OBJECT);c&&(c=Object.assign(Object.assign({},c),i),await s.default.set(l,c)),await a.metaUpdate(null,null,r.MetaTable.COL_QRCODE,i,e)}async getValueColumn(){return l.Column.get({colId:this.fk_qr_value_column_id})}}t.default=c},74317:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ROLLUP_FUNCTIONS=void 0;const n=i(a(83889)),s=i(a(27552)),o=i(a(37912)),r=a(33402),l=a(13609);t.ROLLUP_FUNCTIONS=["count","min","max","avg","countDistinct","sumDistinct","avgDistinct"];class c{constructor(e){Object.assign(this,e)}static async insert(e,t=s.default.ncMeta){const a=(0,r.extractProps)(e,["fk_column_id","fk_relation_column_id","fk_rollup_column_id","rollup_function"]);return await t.metaInsert2(null,null,l.MetaTable.COL_ROLLUP,a),await o.default.appendToList(l.CacheScope.COL_ROLLUP,[e.fk_rollup_column_id],`${l.CacheScope.COL_ROLLUP}:${e.fk_column_id}`),await o.default.appendToList(l.CacheScope.COL_ROLLUP,[e.fk_relation_column_id],`${l.CacheScope.COL_ROLLUP}:${e.fk_column_id}`),this.read(e.fk_column_id,t)}static async read(e,t=s.default.ncMeta){let a=e&&await o.default.get(`${l.CacheScope.COL_ROLLUP}:${e}`,l.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,l.MetaTable.COL_ROLLUP,{fk_column_id:e}),await o.default.set(`${l.CacheScope.COL_ROLLUP}:${e}`,a)),a?new c(a):null}async getRollupColumn(e=s.default.ncMeta){return n.default.get({colId:this.fk_rollup_column_id},e)}async getRelationColumn(e=s.default.ncMeta){return n.default.get({colId:this.fk_relation_column_id},e)}}t.default=c},73140:function(e,t,a){var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(a(27552)),o=n(a(37912)),r=a(33402),l=a(13609);class c{constructor(e){Object.assign(this,e)}static async insert(e,t=s.default.ncMeta){const a=(0,r.extractProps)(e,["id","title","fk_column_id","color","order"]),{id:i}=await t.metaInsert2(null,null,l.MetaTable.COL_SELECT_OPTIONS,a);return await o.default.appendToList(l.CacheScope.COL_SELECT_OPTION,[e.fk_column_id],`${l.CacheScope.COL_SELECT_OPTION}:${i}`),this.get(i,t)}static async bulkInsert(e,t=s.default.ncMeta){const a=[];for(const t of e){const e=(0,r.extractProps)(t,["id","title","fk_column_id","color","order"]);a.push(e)}const i=await t.bulkMetaInsert(null,null,l.MetaTable.COL_SELECT_OPTIONS,a);for(const e of i)await o.default.appendToList(l.CacheScope.COL_SELECT_OPTION,[e.fk_column_id],`${l.CacheScope.COL_SELECT_OPTION}:${e.id}`),await o.default.set(`${l.CacheScope.COL_SELECT_OPTION}:${e.id}`,e);return!0}static async get(e,t=s.default.ncMeta){let a=e&&await o.default.get(`${l.CacheScope.COL_SELECT_OPTION}:${e}`,l.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,l.MetaTable.COL_SELECT_OPTIONS,e),await o.default.set(`${l.CacheScope.COL_SELECT_OPTION}:${e}`,a)),a&&new c(a)}static async read(e,t=s.default.ncMeta){const a=await o.default.getList(l.CacheScope.COL_SELECT_OPTION,[e]);let{list:n}=a;const{isNoneList:r}=a;return r||n.length||(n=await t.metaList2(null,null,l.MetaTable.COL_SELECT_OPTIONS,{condition:{fk_column_id:e}}),await o.default.setList(l.CacheScope.COL_SELECT_OPTION,[e],n.map((e=>{var{created_at:t,updated_at:a}=e;return i(e,["created_at","updated_at"])})))),(null==n?void 0:n.length)?{options:n.map((e=>{var{created_at:t,updated_at:a}=e,n=i(e,["created_at","updated_at"]);return new c(n)})).sort(((e,t)=>e.order-t.order))}:null}static async find(e,t,a=s.default.ncMeta){const i=await a.metaGet2(null,null,l.MetaTable.COL_SELECT_OPTIONS,{fk_column_id:e,title:t});return i&&new c(i)}}t.default=c},99998:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(33505)),s=i(a(83889)),o=i(a(27552)),r=a(13609),l=i(a(37912)),c=a(33402),d=i(a(86026));class u{constructor(e){Object.assign(this,e)}static async deleteAll(e,t=o.default.ncMeta){await l.default.deepDel(r.CacheScope.SORT,`${r.CacheScope.SORT}:${e}`,r.CacheDelDirection.PARENT_TO_CHILD),await t.metaDelete(null,null,r.MetaTable.SORT,{fk_view_id:e});{const a=await d.default.get(e,t);await l.default.delAll(r.CacheScope.SINGLE_QUERY,`${a.fk_model_id}:${a.id}:*`)}}static async insert(e,t=o.default.ncMeta){var a;const i=(0,c.extractProps)(e,["id","fk_view_id","fk_column_id","direction","project_id","base_id"]);if(i.order=e.push_to_top?1:(+(null===(a=await t.knex(r.MetaTable.SORT).max("order",{as:"order"}).where({fk_view_id:e.fk_view_id}).first())||void 0===a?void 0:a.order)||0)+1,!e.project_id||!e.base_id){const a=await s.default.get({colId:e.fk_column_id},t);i.project_id=a.project_id,i.base_id=a.base_id}e.push_to_top&&await t.knex(r.MetaTable.SORT).where({fk_view_id:e.fk_view_id}).increment("order",1);const n=await t.metaInsert2(null,null,r.MetaTable.SORT,i);if(e.push_to_top){const a=await t.metaList2(null,null,r.MetaTable.SORT,{condition:{fk_view_id:e.fk_view_id},orderBy:{order:"asc"}});await l.default.delAll(r.CacheScope.SORT,`${e.fk_view_id}:*`),await l.default.setList(r.CacheScope.SORT,[e.fk_view_id],a)}else await l.default.appendToList(r.CacheScope.SORT,[e.fk_view_id],`${r.CacheScope.SORT}:${n.id}`),await l.default.appendToList(r.CacheScope.SORT,[e.fk_column_id],`${r.CacheScope.SORT}:${n.id}`);{const e=await d.default.get(n.fk_view_id,t);await l.default.delAll(r.CacheScope.SINGLE_QUERY,`${e.fk_model_id}:${e.id}:*`)}return this.get(n.id,t)}getColumn(){return this.fk_column_id?s.default.get({colId:this.fk_column_id}):null}static async list({viewId:e},t=o.default.ncMeta){if(!e)return null;const a=await l.default.getList(r.CacheScope.SORT,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,r.MetaTable.SORT,{condition:{fk_view_id:e},orderBy:{order:"asc"}}),await l.default.setList(r.CacheScope.SORT,[e],i)),i.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),i.map((e=>new u(e)))}static async update(e,t,a=o.default.ncMeta){const i=`${r.CacheScope.SORT}:${e}`,n=await l.default.get(i,r.CacheGetType.TYPE_OBJECT);n&&(n.fk_column_id=t.fk_column_id,n.direction=t.direction,await l.default.set(i,n));const s=await a.metaUpdate(null,null,r.MetaTable.SORT,{fk_column_id:t.fk_column_id,direction:t.direction},e);{const t=await this.get(e,a),i=await d.default.get(t.fk_view_id,a);await l.default.delAll(r.CacheScope.SINGLE_QUERY,`${i.fk_model_id}:${i.id}:*`)}return s}static async delete(e,t=o.default.ncMeta){const a=await this.get(e,t);if(await l.default.deepDel(r.CacheScope.SORT,`${r.CacheScope.SORT}:${e}`,r.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(null,null,r.MetaTable.SORT,e),null==a?void 0:a.fk_view_id){const e=await d.default.get(a.fk_view_id,t);await l.default.delAll(r.CacheScope.SINGLE_QUERY,`${e.fk_model_id}:${e.id}:*`)}}static async get(e,t=o.default.ncMeta){let a=e&&await l.default.get(`${r.CacheScope.SORT}:${e}`,r.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,r.MetaTable.SORT,e),await l.default.set(`${r.CacheScope.SORT}:${e}`,a)),a&&new u(a)}async getModel(e=o.default.ncMeta){return n.default.getByIdOrName({id:this.fk_view_id},e)}}t.default=u},93758:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(51401),s=a(33402),o=i(a(27552)),r=a(13609);class l{constructor(e){Object.assign(this,e)}static get(e,t=o.default.ncMeta){return t.metaGet(null,null,r.MetaTable.STORE,{key:e})}static async saveOrUpdate(e,t=o.default.ncMeta){e.key||n.NcError.badRequest("Key is required");const a=(0,s.extractProps)(e,["key","value","type","env","tag"]);await l.get(e.key,t)?await t.metaUpdate(null,null,r.MetaTable.STORE,a,{key:e.key}):await t.metaInsert(null,null,r.MetaTable.STORE,a)}}t.default=l},82670:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(27552)),s=a(33402),o=a(13609);class r{constructor(e){Object.assign(this,e)}static async list(e,t=n.default.ncMeta){const a=await t.metaList(null,null,o.MetaTable.SYNC_LOGS,{condition:{project_id:e},orderBy:{created_at:"asc"}});return null==a?void 0:a.map((e=>new r(e)))}static async insert(e,t=n.default.ncMeta){const a=(0,s.extractProps)(e,["project_id","fk_sync_source_id","time_taken","status","status_details"]),{id:i}=await t.metaInsert2(null,null,o.MetaTable.SYNC_LOGS,a);return new r(Object.assign(Object.assign({},a),{id:i}))}static async delete(e,t=n.default.ncMeta){return await t.metaDelete(null,null,o.MetaTable.SYNC_LOGS,e)}}t.default=r},72481:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(89604)),s=a(51401),o=i(a(27552)),r=a(33402),l=a(13609);class c{constructor(e){Object.assign(this,e)}getUser(e=o.default.ncMeta){return n.default.get(this.fk_user_id,e)}static async get(e,t=o.default.ncMeta){const a=await t.metaGet2(null,null,l.MetaTable.SYNC_SOURCE,e);if(a.details&&"string"==typeof a.details)try{a.details=JSON.parse(a.details)}catch(e){}return a&&new c(a)}static async list(e,t,a=o.default.ncMeta){const i=t?{project_id:e,base_id:t}:{project_id:e},n=await a.metaList(null,null,l.MetaTable.SYNC_SOURCE,{condition:i,orderBy:{created_at:"asc"}});for(const e of n)if(e.details&&"string"==typeof e.details)try{e.details=JSON.parse(e.details)}catch(e){}return null==n?void 0:n.map((e=>new c(e)))}static async insert(e,t=o.default.ncMeta){const a=(0,r.extractProps)(e,["id","title","type","details","project_id","base_id","fk_user_id"]);a.details&&"object"==typeof a.details&&(a.details=JSON.stringify(a.details));const{id:i}=await t.metaInsert2(null,null,l.MetaTable.SYNC_SOURCE,a);return this.get(i,t)}static async update(e,t,a=o.default.ncMeta){const i=(0,r.extractProps)(t,["id","title","type","details","deleted","order","project_id","base_id"]);return i.details&&"object"==typeof i.details&&(i.details=JSON.stringify(i.details)),await a.metaUpdate(null,null,l.MetaTable.SYNC_SOURCE,i,e),this.get(e,a)}static async delete(e,t=o.default.ncMeta){return await t.metaDelete(null,null,l.MetaTable.SYNC_SOURCE,e)}static async deleteByUserId(e,t=o.default.ncMeta){return e||s.NcError.badRequest("User Id is required"),await t.metaDelete(null,null,l.MetaTable.SYNC_SOURCE,{fk_user_id:e})}}t.default=c},89604:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=a(51401),o=i(a(27552)),r=a(33402),l=i(a(37912)),c=a(13609),d=a(15147),u=a(95506);class p{constructor(e){Object.assign(this,e)}static castType(e){return e&&new p(e)}static async insert(e,t=o.default.ncMeta){const a=(0,r.extractProps)(e,["id","email","password","salt","refresh_token","invite_token","invite_token_expires","reset_password_expires","reset_password_token","email_verification_token","email_verified","roles","token_version"]);a.email&&(a.email=a.email.toLowerCase());const{id:i}=await t.metaInsert2(null,null,c.MetaTable.USERS,a);return await l.default.del(c.CacheScope.INSTANCE_META),this.get(i,t)}static async update(e,t,a=o.default.ncMeta){var i,n;const d=(0,r.extractProps)(t,["email","password","salt","refresh_token","invite_token","invite_token_expires","reset_password_expires","reset_password_token","email_verification_token","email_verified","roles","token_version"]);if(d.email){d.email=d.email.toLowerCase();const t=await this.getByEmail(d.email,a);t&&t.id!==e&&s.NcError.badRequest("email is in use")}else d.email=null===(n=null===(i=await this.get(e,a))||void 0===i?void 0:i.email)||void 0===n?void 0:n.toLowerCase();const u=await this.get(e,a);await l.default.del(`${c.CacheScope.USER}:${u.email}`),await l.default.delAll(c.CacheScope.USER,`${u.email}___*`);const p=[`${c.CacheScope.USER}:${e}`];for(const e of p){let t=await l.default.get(e,c.CacheGetType.TYPE_OBJECT);t&&(t=Object.assign(Object.assign({},t),d),await l.default.set(e,t))}return await a.metaUpdate(null,null,c.MetaTable.USERS,d,e)}static async getByEmail(e,t=o.default.ncMeta){const a=null==e?void 0:e.toLowerCase();let i=a&&await l.default.get(`${c.CacheScope.USER}:${a}`,c.CacheGetType.TYPE_OBJECT);return i||(i=await t.metaGet2(null,null,c.MetaTable.USERS,{email:a}),await l.default.set(`${c.CacheScope.USER}:${a}`,i)),this.castType(i)}static async isFirst(e=o.default.ncMeta){var t;return!(null===(t=await l.default.getAll(`${c.CacheScope.USER}:*`))||void 0===t?void 0:t.length)&&!await e.metaGet2(null,null,c.MetaTable.USERS,{})}static async count({query:e=""}={},t=o.default.ncMeta){var a;const i=t.knex(c.MetaTable.USERS);return e&&i.where("email","like",`%${null===(a=e.toLowerCase)||void 0===a?void 0:a.call(e)}%`),(await i.count("id",{as:"count"}).first()).count}static async get(e,t=o.default.ncMeta){let a=e&&await l.default.get(`${c.CacheScope.USER}:${e}`,c.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,c.MetaTable.USERS,e),await l.default.set(`${c.CacheScope.USER}:${e}`,a)),this.castType(a)}static async getByRefreshToken(e,t=o.default.ncMeta){return await t.metaGet2(null,null,c.MetaTable.USERS,{refresh_token:e})}static async list({limit:e,offset:t,query:a}={},i=o.default.ncMeta){var n;let s=i.knex(c.MetaTable.USERS);return t&&(s=s.offset(t)),e&&(s=s.limit(e)),s=s.select(`${c.MetaTable.USERS}.id`,`${c.MetaTable.USERS}.email`,`${c.MetaTable.USERS}.email_verified`,`${c.MetaTable.USERS}.invite_token`,`${c.MetaTable.USERS}.created_at`,`${c.MetaTable.USERS}.updated_at`,`${c.MetaTable.USERS}.roles`).select(i.knex(c.MetaTable.PROJECT_USERS).count().whereRaw(`${c.MetaTable.USERS}.id = ${c.MetaTable.PROJECT_USERS}.fk_user_id`).as("projectsCount")),a&&s.where("email","like",`%${null===(n=a.toLowerCase)||void 0===n?void 0:n.call(a)}%`),s}static async delete(e,t=o.default.ncMeta){e||s.NcError.badRequest("userId is required");const a=await this.get(e,t);return a||s.NcError.badRequest("User not found"),await l.default.delAll(c.CacheScope.USER,`${e}___*`),await l.default.delAll(c.CacheScope.USER,`${a.email}___*`),await l.default.del(`${c.CacheScope.USER}:${e}`),await l.default.del(`${c.CacheScope.USER}:${a.email}`),await t.metaDelete(null,null,c.MetaTable.USERS,e)}static async getWithRoles(e,t,a=o.default.ncMeta){var i;const r=null!==(i=t.user)&&void 0!==i?i:await this.get(e,a);r||s.NcError.badRequest("User not found");const l=await new Promise((e=>{t.projectId?d.ProjectUser.get(t.projectId,r.id).then((async t=>{let a=null==t?void 0:t.roles;a="owner"===a?"owner,creator":a,e(a?(0,n.extractRolesObj)(a):null)})):e(null)}));return Object.assign(Object.assign({},(0,u.sanitiseUserObj)(r)),{roles:r.roles?(0,n.extractRolesObj)(r.roles):null,project_roles:l||null})}}t.default=p},86026:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(33505)),o=i(a(93805)),r=i(a(70072)),l=i(a(35141)),c=i(a(29337)),d=i(a(46725)),u=i(a(99998)),p=i(a(41186)),m=i(a(48145)),f=i(a(71231)),h=i(a(34653)),g=i(a(83889)),_=i(a(78567)),b=i(a(17434)),y=a(33402),w=i(a(37912)),v=a(13609),T=i(a(27552)),O=a(36734),{v4:E}=a(25828);class S{constructor(e){Object.assign(this,e)}async getModel(e=T.default.ncMeta){return this.model=await s.default.getByIdOrName({id:this.fk_model_id},e)}async getModelWithInfo(e=T.default.ncMeta){return this.model=await s.default.getWithInfo({id:this.fk_model_id},e)}async getView(){switch(this.type){case n.ViewTypes.GRID:this.view=await r.default.get(this.id);break;case n.ViewTypes.KANBAN:this.view=await l.default.get(this.id);break;case n.ViewTypes.GALLERY:this.view=await c.default.get(this.id);break;case n.ViewTypes.MAP:this.view=await _.default.get(this.id);break;case n.ViewTypes.FORM:this.view=await o.default.get(this.id)}return this.view}async getViewWithInfo(e=T.default.ncMeta){switch(this.type){case n.ViewTypes.GRID:this.view=await r.default.getWithInfo(this.id,e);break;case n.ViewTypes.KANBAN:this.view=await l.default.get(this.id,e);break;case n.ViewTypes.GALLERY:this.view=await c.default.get(this.id,e);break;case n.ViewTypes.MAP:this.view=await _.default.get(this.id,e);break;case n.ViewTypes.FORM:this.view=await o.default.get(this.id,e)}return this.view}static async get(e,t=T.default.ncMeta){let a=e&&await w.default.get(`${v.CacheScope.VIEW}:${e}`,v.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,v.MetaTable.VIEWS,e),a&&(a.meta=(0,O.parseMetaProp)(a),await w.default.set(`${v.CacheScope.VIEW}:${a.id}`,a))),a&&new S(a)}static async getByTitleOrId({fk_model_id:e,titleOrId:t},a=T.default.ncMeta){const i=t&&await w.default.get(`${v.CacheScope.VIEW}:${e}:${t}`,v.CacheGetType.TYPE_OBJECT);if(!i){const i=await a.metaGet2(null,null,v.MetaTable.VIEWS,{fk_model_id:e},null,{_or:[{id:{eq:t}},{title:{eq:t}}]});return i&&(await w.default.set(`${v.CacheScope.VIEW}:${e}:${i.id}`,i),i.meta=(0,O.parseMetaProp)(i),await w.default.set(`${v.CacheScope.VIEW}:${e}:${t}`,i.id)),i&&new S(i)}return i&&this.get((null==i?void 0:i.id)||i)}static async getDefaultView(e,t=T.default.ncMeta){let a=e&&await w.default.get(`${v.CacheScope.VIEW}:${e}:default`,v.CacheGetType.TYPE_OBJECT);return a||(a=await t.metaGet2(null,null,v.MetaTable.VIEWS,{fk_model_id:e,is_default:1},null),a&&(a.meta=(0,O.parseMetaProp)(a),await w.default.set(`${v.CacheScope.VIEW}:${e}:default`,a))),a&&new S(a)}static async list(e,t=T.default.ncMeta){const a=await w.default.getList(v.CacheScope.VIEW,[e]);let{list:i}=a;const{isNoneList:n}=a;if(!n&&!i.length){i=await t.metaList2(null,null,v.MetaTable.VIEWS,{condition:{fk_model_id:e},orderBy:{order:"asc"}});for(const e of i)e.meta=(0,O.parseMetaProp)(e);await w.default.setList(v.CacheScope.VIEW,[e],i)}return i.sort(((e,t)=>(null!=e.order?e.order:1/0)-(null!=t.order?t.order:1/0))),null==i?void 0:i.map((e=>new S(e)))}async getFilters(e=T.default.ncMeta){return this.filter=await p.default.getFilterObject({viewId:this.id},e)}async getSorts(e=T.default.ncMeta){return this.sorts=await u.default.list({viewId:this.id},e)}static async insert(e,t=T.default.ncMeta){const a=(0,y.extractProps)(e,["id","title","is_default","type","fk_model_id","project_id","base_id","meta"]);if(a.order=await t.metaGetNextOrder(v.MetaTable.VIEWS,{fk_model_id:e.fk_model_id}),a.show=!0,a.meta||(a.meta={}),a.meta=(0,O.stringifyMetaProp)(a),!e.project_id||!e.base_id){const i=await s.default.getByIdOrName({id:e.fk_model_id},t);a.project_id=i.project_id,a.base_id=i.base_id}const i=e.copy_from_id&&await S.get(e.copy_from_id,t);await(null==i?void 0:i.getView());const{id:d}=await t.metaInsert2(null,null,v.MetaTable.VIEWS,a);await w.default.appendToList(v.CacheScope.VIEW,[e.fk_model_id],`${v.CacheScope.VIEW}:${d}`);let m=await(await s.default.getByIdOrName({id:e.fk_model_id},t)).getColumns(t);switch(e.type){case n.ViewTypes.GRID:await r.default.insert(Object.assign(Object.assign(Object.assign({},(null==i?void 0:i.view)||{}),e),{fk_view_id:d}),t);break;case n.ViewTypes.MAP:await _.default.insert(Object.assign(Object.assign({},e),{fk_view_id:d}),t);break;case n.ViewTypes.GALLERY:await c.default.insert(Object.assign(Object.assign(Object.assign({},(null==i?void 0:i.view)||{}),e),{fk_view_id:d}),t);break;case n.ViewTypes.FORM:await o.default.insert(Object.assign(Object.assign(Object.assign({heading:e.title},(null==i?void 0:i.view)||{}),e),{fk_view_id:d}),t);break;case n.ViewTypes.KANBAN:e.fk_grp_col_id=e.fk_grp_col_id,await l.default.insert(Object.assign(Object.assign(Object.assign({},(null==i?void 0:i.view)||{}),e),{fk_view_id:d}),t)}if(i){const e=await i.getSorts(t),a=await i.getFilters(t);m=await i.getColumns(t);for(const a of e)await u.default.insert(Object.assign(Object.assign({},a),{fk_view_id:d,id:null}),t);for(const e of a.children)await p.default.insert(Object.assign(Object.assign({},e),{fk_view_id:d,id:null}),t)}{let a=1,s=0,o=0;e.type!==n.ViewTypes.KANBAN||i||m.sort(((e,t)=>{const a=t.pv-e.pv,i=+(t.uidt===n.UITypes.Attachment)-+(e.uidt===n.UITypes.Attachment),s=+(t.uidt===n.UITypes.SingleLineText)-+(e.uidt===n.UITypes.SingleLineText),o=+(t.uidt===n.UITypes.Number)-+(e.uidt===n.UITypes.Number),r=t.order-e.order;return a||i||s||o||r}));for(const r of m){let u=!("show"in r)||r.show;if(e.type===n.ViewTypes.GALLERY){const e=await c.default.get(d,t);r.id===e.fk_cover_image_col_id||r.pv||s<3?(u=!0,s++):u=!1}else if(e.type!==n.ViewTypes.KANBAN||i){if(e.type===n.ViewTypes.MAP&&!i){const e=await _.default.get(d,t);r.id===(null==e?void 0:e.fk_geo_data_col_id)&&(u=!0)}}else{const e=await l.default.get(d,t);r.id===(null==e?void 0:e.fk_grp_col_id)?u=!0:r.id===e.fk_cover_image_col_id||r.pv||o<3&&!(0,n.isSystemColumn)(r)?(u=!0,o++):u=!1}const p=r.fk_column_id?await g.default.get({colId:r.fk_column_id},t):r;(0,n.isSystemColumn)(p)&&(u=!1),await S.insertColumn(Object.assign(Object.assign(Object.assign({order:a++},p),r),{view_id:d,fk_column_id:r.fk_column_id||r.id,show:u,id:null}),t)}}return S.get(d,t)}static async insertColumnToAllViews(e,t=T.default.ncMeta){var a,i;const s={fk_column_id:e.fk_column_id,fk_model_id:e.fk_model_id,order:e.order,show:e.show},o=await this.list(e.fk_model_id,t);for(const r of o){const o=Object.assign(Object.assign({},s),{fk_view_id:r.id});switch((null===(a=e.column_order)||void 0===a?void 0:a.view_id)===r.id&&(o.order=null===(i=e.column_order)||void 0===i?void 0:i.order),r.type){case n.ViewTypes.GRID:await d.default.insert(o,t);break;case n.ViewTypes.GALLERY:await m.default.insert(o,t);break;case n.ViewTypes.MAP:await b.default.insert(Object.assign(Object.assign({},s),{fk_view_id:r.id}),t);break;case n.ViewTypes.KANBAN:await h.default.insert(o,t)}}}static async insertColumn(e,t=T.default.ncMeta){const a=await this.get(e.view_id,t);let i;switch(a.type){case n.ViewTypes.GRID:i=await d.default.insert(Object.assign(Object.assign({},e),{fk_view_id:a.id}),t);break;case n.ViewTypes.GALLERY:i=await m.default.insert(Object.assign(Object.assign({},e),{fk_view_id:a.id}),t);break;case n.ViewTypes.MAP:i=await b.default.insert(Object.assign(Object.assign({},e),{fk_view_id:a.id}),t);break;case n.ViewTypes.FORM:i=await f.default.insert(Object.assign(Object.assign({},e),{fk_view_id:a.id}),t);break;case n.ViewTypes.KANBAN:i=await h.default.insert(Object.assign(Object.assign({},e),{fk_view_id:a.id}),t)}return i}static async listWithInfo(e,t=T.default.ncMeta){const a=await this.list(e,t);for(const e of a)await e.getViewWithInfo(t);return a}static async getColumns(e,t=T.default.ncMeta){let a=[];switch((await this.get(e,t)).type){case n.ViewTypes.GRID:a=await d.default.list(e,t);break;case n.ViewTypes.GALLERY:a=await m.default.list(e,t);break;case n.ViewTypes.MAP:a=await b.default.list(e,t);break;case n.ViewTypes.FORM:a=await f.default.list(e,t);break;case n.ViewTypes.KANBAN:a=await h.default.list(e,t)}return a}async getColumns(e=T.default.ncMeta){return this.columns=await S.getColumns(this.id,e)}static async updateColumn(e,t,a,i=T.default.ncMeta){const s=await this.get(e,i);let o,r;switch(s.type){case n.ViewTypes.GRID:o=v.MetaTable.GRID_VIEW_COLUMNS,r=v.CacheScope.GRID_VIEW_COLUMN;break;case n.ViewTypes.MAP:o=v.MetaTable.MAP_VIEW_COLUMNS,r=v.CacheScope.MAP_VIEW_COLUMN;break;case n.ViewTypes.GALLERY:o=v.MetaTable.GALLERY_VIEW_COLUMNS,r=v.CacheScope.GALLERY_VIEW_COLUMN;break;case n.ViewTypes.KANBAN:o=v.MetaTable.KANBAN_VIEW_COLUMNS,r=v.CacheScope.KANBAN_VIEW_COLUMN;break;case n.ViewTypes.FORM:o=v.MetaTable.FORM_VIEW_COLUMNS,r=v.CacheScope.FORM_VIEW_COLUMN}const l=(0,y.extractProps)(a,["order","show"]);if(s.type===n.ViewTypes.GRID){const e=await i.metaGet2(null,null,v.MetaTable.COLUMNS,{fk_model_id:s.fk_model_id,pv:!0}),a=await i.metaGet2(null,null,v.MetaTable.GRID_VIEW_COLUMNS,{fk_view_id:s.id,fk_column_id:e.id});a&&a.id===t&&(l.order=1,l.show=!0)}const c=`${r}:${t}`;let d=await w.default.get(c,v.CacheGetType.TYPE_OBJECT);d&&(d=Object.assign(Object.assign({},d),l),await w.default.set(c,d));const u=await i.metaUpdate(null,null,o,l,t);return await w.default.delAll(v.CacheScope.SINGLE_QUERY,`${s.fk_model_id}:${s.id}:*`),u}static async insertOrUpdateColumn(e,t,a,i=T.default.ncMeta){const s=await this.get(e),o=this.extractViewColumnsTableName(s),r=await i.metaGet2(null,null,o,{fk_view_id:e,fk_column_id:t});if(r)return await i.metaUpdate(null,null,o,{order:a.order,show:a.show},r.id),await w.default.delAll(v.CacheScope.SINGLE_QUERY,`${s.fk_model_id}:${s.id}:*`),Object.assign(Object.assign({},r),a);switch(s.type){case n.ViewTypes.GRID:return await d.default.insert({fk_view_id:e,fk_column_id:t,order:a.order,show:a.show});case n.ViewTypes.GALLERY:return await m.default.insert({fk_view_id:e,fk_column_id:t,order:a.order,show:a.show});case n.ViewTypes.KANBAN:return await h.default.insert({fk_view_id:e,fk_column_id:t,order:a.order,show:a.show});case n.ViewTypes.MAP:return await b.default.insert({fk_view_id:e,fk_column_id:t,order:a.order,show:a.show});case n.ViewTypes.FORM:return await f.default.insert({fk_view_id:e,fk_column_id:t,order:a.order,show:a.show})}return await i.metaInsert2(s.project_id,s.base_id,o,{fk_view_id:e,fk_column_id:t,order:a.order,show:a.show})}static async getByUUID(e,t=T.default.ncMeta){const a=await t.metaGet2(null,null,v.MetaTable.VIEWS,{uuid:e});return a&&(a.meta=(0,O.parseMetaProp)(a)),a&&new S(a)}static async share(e,t=T.default.ncMeta){var a;const i=await this.get(e);if(!i.uuid){const a=E();i.uuid=a;const n=`${v.CacheScope.VIEW}:${i.id}`,s=await w.default.get(n,v.CacheGetType.TYPE_OBJECT);s&&(s.uuid=a,await w.default.set(n,s)),await t.metaUpdate(null,null,v.MetaTable.VIEWS,{uuid:i.uuid},e)}if(!i.meta||!("allowCSVDownload"in i.meta)){const n=Object.assign(Object.assign({},null!==(a=i.meta)&&void 0!==a?a:{}),{allowCSVDownload:!0}),s=`${v.CacheScope.VIEW}:${i.id}`,o=await w.default.get(s,v.CacheGetType.TYPE_OBJECT);o&&(o.meta=n,await w.default.set(s,o)),await t.metaUpdate(null,null,v.MetaTable.VIEWS,{meta:JSON.stringify(n)},e),i.meta=n}return i}static async passwordUpdate(e,{password:t},a=T.default.ncMeta){const i=`${v.CacheScope.VIEW}:${e}`,n=await w.default.get(i,v.CacheGetType.TYPE_OBJECT);n&&(n.password=t,await w.default.set(i,n)),await a.metaUpdate(null,null,v.MetaTable.VIEWS,{password:t},e)}static async sharedViewDelete(e,t=T.default.ncMeta){const a=`${v.CacheScope.VIEW}:${e}`,i=await w.default.get(a,v.CacheGetType.TYPE_OBJECT);i&&(i.uuid=null,await w.default.set(a,i)),await t.metaUpdate(null,null,v.MetaTable.VIEWS,{uuid:null},e)}static async update(e,t,a=T.default.ncMeta){const i=(0,y.extractProps)(t,["title","order","show_system_fields","lock_type","password","meta","uuid"]),s=`${v.CacheScope.VIEW}:${e}`;let o=await w.default.get(s,v.CacheGetType.TYPE_OBJECT),r=Object.assign({},o);o?(o=Object.assign(Object.assign({},o),i),o.is_default&&await w.default.set(`${v.CacheScope.VIEW}:${o.fk_model_id}:default`,o),await w.default.set(s,o)):r=await this.get(e),await w.default.del(`${v.CacheScope.VIEW}:${r.fk_model_id}:${r.title}`),"meta"in i&&(i.meta=(0,O.stringifyMetaProp)(i)),await a.metaUpdate(null,null,v.MetaTable.VIEWS,i,e);const l=await this.get(e);return l.type===n.ViewTypes.GRID&&"show_system_fields"in i&&await S.fixPVColumnForView(e,a),await w.default.delAll(v.CacheScope.SINGLE_QUERY,`${l.fk_model_id}:${l.id}:*`),l}static async delete(e,t=T.default.ncMeta){const a=await this.get(e,t);await u.default.deleteAll(e,t),await p.default.deleteAll(e,t);const i=this.extractViewTableName(a),n=this.extractViewTableNameScope(a),s=this.extractViewColumnsTableName(a),o=this.extractViewColumnsTableNameScope(a);await t.metaDelete(null,null,s,{fk_view_id:e}),await w.default.deepDel(n,`${n}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(null,null,i,{fk_view_id:e}),await w.default.deepDel(o,`${o}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT),await t.metaDelete(null,null,v.MetaTable.VIEWS,e),await w.default.deepDel(v.CacheScope.VIEW,`${v.CacheScope.VIEW}:${e}`,v.CacheDelDirection.CHILD_TO_PARENT),await w.default.del(`${v.CacheScope.VIEW}:${a.fk_model_id}:${a.title}`),await w.default.del(`${v.CacheScope.VIEW}:${a.fk_model_id}:${a.id}`),await w.default.delAll(v.CacheScope.SINGLE_QUERY,`${a.fk_model_id}:${a.id}:*`)}static extractViewColumnsTableName(e){let t;switch(e.type){case n.ViewTypes.GRID:t=v.MetaTable.GRID_VIEW_COLUMNS;break;case n.ViewTypes.GALLERY:t=v.MetaTable.GALLERY_VIEW_COLUMNS;break;case n.ViewTypes.KANBAN:t=v.MetaTable.KANBAN_VIEW_COLUMNS;break;case n.ViewTypes.FORM:t=v.MetaTable.FORM_VIEW_COLUMNS;break;case n.ViewTypes.MAP:t=v.MetaTable.MAP_VIEW_COLUMNS}return t}static extractViewTableName(e){let t;switch(e.type){case n.ViewTypes.GRID:t=v.MetaTable.GRID_VIEW;break;case n.ViewTypes.GALLERY:t=v.MetaTable.GALLERY_VIEW;break;case n.ViewTypes.KANBAN:t=v.MetaTable.KANBAN_VIEW;break;case n.ViewTypes.FORM:t=v.MetaTable.FORM_VIEW;break;case n.ViewTypes.MAP:t=v.MetaTable.MAP_VIEW}return t}static extractViewColumnsTableNameScope(e){let t;switch(e.type){case n.ViewTypes.GRID:t=v.CacheScope.GRID_VIEW_COLUMN;break;case n.ViewTypes.GALLERY:t=v.CacheScope.GALLERY_VIEW_COLUMN;break;case n.ViewTypes.MAP:t=v.CacheScope.MAP_VIEW_COLUMN;break;case n.ViewTypes.KANBAN:t=v.CacheScope.KANBAN_VIEW_COLUMN;break;case n.ViewTypes.FORM:t=v.CacheScope.FORM_VIEW_COLUMN}return t}static extractViewTableNameScope(e){let t;switch(e.type){case n.ViewTypes.GRID:t=v.CacheScope.GRID_VIEW;break;case n.ViewTypes.GALLERY:t=v.CacheScope.GALLERY_VIEW;break;case n.ViewTypes.MAP:t=v.CacheScope.MAP_VIEW;break;case n.ViewTypes.KANBAN:t=v.CacheScope.KANBAN_VIEW;break;case n.ViewTypes.FORM:t=v.CacheScope.FORM_VIEW}return t}static async showAllColumns(e,t=[],a=T.default.ncMeta){const i=await this.get(e),n=this.extractViewColumnsTableName(i),s=this.extractViewColumnsTableNameScope(i),o=await i.getModel(a).then((e=>e.getColumns())),r=await this.getColumns(e,a),l=r.map((e=>e.fk_column_id)),c=await w.default.getList(s,[e]),{list:d}=c,{isNoneList:u}=c;if(!u&&(null==d?void 0:d.length))for(const e of d)(null==t?void 0:t.length)&&t.includes(e.fk_column_id)||(e.show=!0,await w.default.set(`${s}:${e.id}`,e));for(const i of o){if(null==t?void 0:t.includes(i.id))continue;const s=l.indexOf(i.id);s>-1?await this.updateColumn(e,r[s].id,{show:!0},a):await this.insertColumn({view_id:e,order:await a.metaGetNextOrder(n,{fk_view_id:e}),show:!0,fk_column_id:i.id},a)}}static async hideAllColumns(e,t=[],a=T.default.ncMeta){const i=await this.get(e),s=this.extractViewColumnsTableName(i),o=this.extractViewColumnsTableNameScope(i);if(i.type===n.ViewTypes.GRID){const e=await a.metaGet2(null,null,v.MetaTable.COLUMNS,{fk_model_id:i.fk_model_id,pv:!0});e&&t.push(e.id)}const r=await w.default.getList(o,[e]),{list:l}=r,{isNoneList:c}=r,d=i.type===n.ViewTypes.MAP?[(await _.default.get(e)).fk_geo_data_col_id]:[],u=[...t,...d];if(!c&&(null==l?void 0:l.length))for(const e of l)(null==u?void 0:u.length)&&u.includes(e.fk_column_id)||(e.show=!1,await w.default.set(`${o}:${e.id}`,e));return await a.metaUpdate(null,null,s,{show:!1},{fk_view_id:e},(null==u?void 0:u.length)?{_not:{fk_column_id:{in:t}}}:null)}async delete(e=T.default.ncMeta){await S.delete(this.id,e)}static async shareViewList(e,t=T.default.ncMeta){const a=await w.default.getList(v.CacheScope.VIEW,[e]);let{list:i}=a;const{isNoneList:n}=a;return n||i.length||(i=await t.metaList2(null,null,v.MetaTable.VIEWS,{xcCondition:{fk_model_id:{eq:e},_not:{uuid:{eq:null}}}}),await w.default.setList(v.CacheScope.VIEW,[e],i)),i=i.filter((e=>null!==e.uuid)),null==i?void 0:i.map((e=>new S(e)))}static async fixPVColumnForView(e,t=T.default.ncMeta){const a=await t.metaList2(null,null,v.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_view_id:e},orderBy:{order:"asc"}}),i=[];for(const e of a){const a=await t.metaGet2(null,null,v.MetaTable.COLUMNS,e.fk_column_id);i.push(a)}const n=i.find((e=>e.pv));if(n){const e=a.find((e=>e.fk_column_id===n.id)),i=a.findIndex((e=>e.fk_column_id===n.id)),s=a.map((e=>e.order)),o=Math.min(...s);if(e.show||(await t.metaUpdate(null,null,v.MetaTable.GRID_VIEW_COLUMNS,{show:!0},e.id),await w.default.set(`${v.CacheScope.GRID_VIEW_COLUMN}:${e.id}`,e)),e.order===o&&1===s.filter((e=>e===o)).length)return;if(0!==i){const e=a.splice(i,1);a.unshift(...e)}for(let e=0;e<a.length;e++)await t.metaUpdate(null,null,v.MetaTable.GRID_VIEW_COLUMNS,{order:e+1},a[e].id),await w.default.set(`${v.CacheScope.GRID_VIEW_COLUMN}:${a[e].id}`,a[e])}const s=await t.metaList2(null,null,v.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_view_id:e},orderBy:{order:"asc"}});await w.default.setList(v.CacheScope.GRID_VIEW_COLUMN,[e],s)}}t.default=S},15147:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Notification=t.LinksColumn=t.View=t.User=t.SyncSource=t.SyncLogs=t.Store=t.Sort=t.SelectOption=t.RollupColumn=t.QrCodeColumn=t.ProjectUser=t.Project=t.Plugin=t.ModelRoleVisibility=t.Model=t.MapViewColumn=t.MapView=t.LookupColumn=t.LinkToAnotherRecordColumn=t.KanbanViewColumn=t.KanbanView=t.HookLog=t.HookFilter=t.Hook=t.GridViewColumn=t.GridView=t.GalleryViewColumn=t.GalleryView=t.FormViewColumn=t.FormView=t.FormulaColumn=t.Filter=t.Column=t.Base=t.BarcodeColumn=t.Audit=t.ApiToken=void 0;var n=a(20600);Object.defineProperty(t,"ApiToken",{enumerable:!0,get:function(){return i(n).default}});var s=a(67094);Object.defineProperty(t,"Audit",{enumerable:!0,get:function(){return i(s).default}});var o=a(78881);Object.defineProperty(t,"BarcodeColumn",{enumerable:!0,get:function(){return i(o).default}});var r=a(23520);Object.defineProperty(t,"Base",{enumerable:!0,get:function(){return i(r).default}});var l=a(83889);Object.defineProperty(t,"Column",{enumerable:!0,get:function(){return i(l).default}});var c=a(41186);Object.defineProperty(t,"Filter",{enumerable:!0,get:function(){return i(c).default}});var d=a(77961);Object.defineProperty(t,"FormulaColumn",{enumerable:!0,get:function(){return i(d).default}});var u=a(93805);Object.defineProperty(t,"FormView",{enumerable:!0,get:function(){return i(u).default}});var p=a(71231);Object.defineProperty(t,"FormViewColumn",{enumerable:!0,get:function(){return i(p).default}});var m=a(29337);Object.defineProperty(t,"GalleryView",{enumerable:!0,get:function(){return i(m).default}});var f=a(48145);Object.defineProperty(t,"GalleryViewColumn",{enumerable:!0,get:function(){return i(f).default}});var h=a(70072);Object.defineProperty(t,"GridView",{enumerable:!0,get:function(){return i(h).default}});var g=a(46725);Object.defineProperty(t,"GridViewColumn",{enumerable:!0,get:function(){return i(g).default}});var _=a(85750);Object.defineProperty(t,"Hook",{enumerable:!0,get:function(){return i(_).default}});var b=a(89072);Object.defineProperty(t,"HookFilter",{enumerable:!0,get:function(){return i(b).default}});var y=a(39659);Object.defineProperty(t,"HookLog",{enumerable:!0,get:function(){return i(y).default}});var w=a(35141);Object.defineProperty(t,"KanbanView",{enumerable:!0,get:function(){return i(w).default}});var v=a(34653);Object.defineProperty(t,"KanbanViewColumn",{enumerable:!0,get:function(){return i(v).default}});var T=a(32188);Object.defineProperty(t,"LinkToAnotherRecordColumn",{enumerable:!0,get:function(){return i(T).default}});var O=a(82994);Object.defineProperty(t,"LookupColumn",{enumerable:!0,get:function(){return i(O).default}});var E=a(78567);Object.defineProperty(t,"MapView",{enumerable:!0,get:function(){return i(E).default}});var S=a(17434);Object.defineProperty(t,"MapViewColumn",{enumerable:!0,get:function(){return i(S).default}});var I=a(33505);Object.defineProperty(t,"Model",{enumerable:!0,get:function(){return i(I).default}});var k=a(42877);Object.defineProperty(t,"ModelRoleVisibility",{enumerable:!0,get:function(){return i(k).default}});var C=a(4691);Object.defineProperty(t,"Plugin",{enumerable:!0,get:function(){return i(C).default}});var j=a(61770);Object.defineProperty(t,"Project",{enumerable:!0,get:function(){return i(j).default}});var x=a(11922);Object.defineProperty(t,"ProjectUser",{enumerable:!0,get:function(){return i(x).default}});var R=a(50944);Object.defineProperty(t,"QrCodeColumn",{enumerable:!0,get:function(){return i(R).default}});var A=a(74317);Object.defineProperty(t,"RollupColumn",{enumerable:!0,get:function(){return i(A).default}});var M=a(73140);Object.defineProperty(t,"SelectOption",{enumerable:!0,get:function(){return i(M).default}});var N=a(99998);Object.defineProperty(t,"Sort",{enumerable:!0,get:function(){return i(N).default}});var P=a(93758);Object.defineProperty(t,"Store",{enumerable:!0,get:function(){return i(P).default}});var L=a(82670);Object.defineProperty(t,"SyncLogs",{enumerable:!0,get:function(){return i(L).default}});var $=a(72481);Object.defineProperty(t,"SyncSource",{enumerable:!0,get:function(){return i($).default}});var q=a(89604);Object.defineProperty(t,"User",{enumerable:!0,get:function(){return i(q).default}});var D=a(86026);Object.defineProperty(t,"View",{enumerable:!0,get:function(){return i(D).default}});var U=a(80483);Object.defineProperty(t,"LinksColumn",{enumerable:!0,get:function(){return i(U).default}});var B=a(62274);Object.defineProperty(t,"Notification",{enumerable:!0,get:function(){return i(B).default}})},33792:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasModule=t.dataModuleMetadata=void 0;const s=a(26481),o=a(36188),r=n(a(1738)),l=a(94647),c=a(89214),d=a(39371),u=a(34684),p=a(2389),m=a(84530),f=a(68349),h=a(20727),g=a(15131),_=a(42801),b=a(85564),y=a(42826),w=a(69905),v=a(26234),T=a(22443),O=a(35531),E=a(75885);t.dataModuleMetadata={imports:[o.MulterModule.register({storage:r.default.diskStorage({}),limits:{fieldSize:l.NC_ATTACHMENT_FIELD_SIZE}})],controllers:[..."true"!==process.env.NC_WORKER_CONTAINER?[c.DataTableController,h.DatasController,g.BulkDataAliasController,u.DataAliasController,b.DataAliasNestedController,_.DataAliasExportController,y.OldDatasController,m.PublicDatasController,p.PublicDatasExportController]:[]],providers:[d.DataTableService,f.DatasService,w.BulkDataAliasService,v.DataAliasNestedService,T.OldDatasService,E.PublicDatasService,O.PublicDatasExportService],exports:[f.DatasService,w.BulkDataAliasService,v.DataAliasNestedService,T.OldDatasService,E.PublicDatasService,O.PublicDatasExportService]};let S=class{};S=i([(0,s.Module)(t.dataModuleMetadata)],S),t.DatasModule=S},7214:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getDbRows=t.getColumnByIdOrName=t.serializeCellValue=t.extractCsvData=t.extractXlsxData=t.getViewAndModelByAliasOrId=void 0;const r=a(87049),l=a(68281),c=s(a(6302)),d=o(a(57153)),u=a(51401),p=o(a(89103)),m=a(15147),f=o(a(23520)),h=o(a(83889)),g=o(a(61770)),_=o(a(19356));async function b({value:e,column:t,siteUrl:a}){if(!t)return e;if(!e)return e;switch(null==t?void 0:t.uidt){case l.UITypes.Attachment:{let t=e;try{"string"==typeof e&&(t=JSON.parse(e))}catch(e){}return(t||[]).map((e=>`${encodeURI(e.title)}(${encodeURI(e.path?`${a}/${e.path}`:e.url)})`))}case l.UITypes.Lookup:{const i=await t.getColOptions(),n=await i.getLookupColumn();return(await Promise.all([...Array.isArray(e)?e:[e]].map((async e=>b({value:e,column:n,siteUrl:a}))))).join(", ")}case l.UITypes.LinkToAnotherRecord:{const a=await t.getColOptions(),i=await a.getRelatedTable();return await i.getColumns(),[...Array.isArray(e)?e:[e]].map((e=>{var t;return e[null===(t=i.displayValue)||void 0===t?void 0:t.title]})).join(", ")}default:return e&&"object"==typeof e?JSON.stringify(e):e}}async function y(e){const{baseModel:t,view:a,query:i={},siteUrl:n}=e;let s=+i.offset||0;const o=+process.env.NC_EXPORT_MAX_TIMEOUT||5e3,c=[],d=process.hrtime();let u,m;const f=Object.assign({},i);try{f.filterArr=JSON.parse(f.filterArrJson)}catch(e){}try{f.sortArr=JSON.parse(f.sortArrJson)}catch(e){}for(u=0;u<o;s+=100,m=process.hrtime(d),u=1e3*m[0]+m[1]/1e6){const{ast:e,dependencyFields:o}=await(0,p.default)({query:i,includePkByDefault:!1,model:a.model,view:a}),d=await(0,r.nocoExecute)(e,await t.list(Object.assign(Object.assign(Object.assign({},f),o),{offset:s,limit:100})),{},i);if(!(null==d?void 0:d.length)){s=-1;break}for(const e of d){const t=Object.assign({},e);for(const i of a.model.columns)(0,l.isSystemColumn)(i)&&!a.show_system_fields||(t[i.title]=await b({value:e[i.title],column:i,siteUrl:n}));c.push(t)}}return{offset:s,dbRows:c,elapsed:u}}t.getViewAndModelByAliasOrId=async function(e){const t=await g.default.getWithInfoByTitleOrId(e.projectName),a=await m.Model.getByAliasOrId({project_id:t.id,aliasOrId:e.tableName}),i=e.viewName&&await m.View.getByTitleOrId({titleOrId:e.viewName,fk_model_id:a.id});return a||u.NcError.notFound("Table not found"),e.viewName&&!i&&u.NcError.notFound("View not found"),{model:a,view:i}},t.extractXlsxData=async function(e,t){const a=await f.default.get(e.base_id);await e.getModelWithInfo(),await e.getColumns(),e.model.columns=e.columns.filter((e=>e.show)).map((t=>new h.default(Object.assign(Object.assign({},t),e.model.columnsById[t.fk_column_id])))).filter((t=>!(0,l.isSystemColumn)(t)||e.show_system_fields));const i=await m.Model.getBaseModelSQL({id:e.model.id,viewId:null==e?void 0:e.id,dbDriver:await _.default.get(a)}),{offset:n,dbRows:s,elapsed:o}=await y({baseModel:i,view:e,siteUrl:t.ncSiteUrl,query:t.query}),r=t.query.fields;return{offset:n,dbRows:s,elapsed:o,data:c.utils.json_to_sheet(s,{header:r})}},t.extractCsvData=async function(e,t){const a=await f.default.get(e.base_id),i=t.query.fields;await e.getModelWithInfo(),await e.getColumns(),e.model.columns=e.columns.filter((e=>e.show)).map((t=>new h.default(Object.assign(Object.assign({},t),e.model.columnsById[t.fk_column_id])))).filter((t=>!(0,l.isSystemColumn)(t)||e.show_system_fields));const n=await m.Model.getBaseModelSQL({id:e.model.id,viewId:null==e?void 0:e.id,dbDriver:await _.default.get(a)}),{offset:s,dbRows:o,elapsed:r}=await y({baseModel:n,view:e,query:t.query,siteUrl:t.ncSiteUrl});return{offset:s,dbRows:o,elapsed:r,data:d.default.unparse({fields:e.model.columns.sort(((e,t)=>Array.isArray(i)?i.indexOf(e.title)-i.indexOf(t.title):0)).filter((e=>!i||!Array.isArray(i)||i.includes(e.title))).map((e=>e.title)),data:o},{escapeFormulae:!0})}},t.serializeCellValue=b,t.getColumnByIdOrName=async function(e,t){const a=(await t.getColumns()).find((t=>t.title===e||t.id===e||t.column_name===e));return a||u.NcError.notFound(`Column with id/name '${e}' is not found`),a},t.getDbRows=y},2062:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},74781:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitterModule=void 0;const n=a(26481),s=a(18657);let o=class{};o=i([(0,n.Global)(),(0,n.Module)({providers:[{provide:"IEventEmitter",useFactory:()=>new s.FallbackEventEmitter}],exports:["IEventEmitter"]})],o),t.EventEmitterModule=o},18657:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FallbackEventEmitter=void 0;const n=i(a(51196));t.FallbackEventEmitter=class{constructor(){this.emitter=new n.default}emit(e,t){this.emitter.emit(e,t)}on(e,t){return this.emitter.on(e,t),()=>this.emitter.off(e,t)}removeListener(e,t){this.emitter.off(e,t)}removeAllListeners(e){this.emitter.clearListeners(e)}}},55037:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalModule=t.globalModuleMetadata=t.JwtStrategyProvider=void 0;const s=a(26481),o=a(60136),r=a(12168),l=a(74781),c=a(63960),d=a(66310),u=a(5311),p=n(a(27552)),m=a(33206),f=a(82469),h=a(1119),g=a(91215),_=a(62801),b=a(76670);t.JwtStrategyProvider={provide:f.JwtStrategy,useFactory:async(e,t)=>{const a=t.config;await p.default.initJwt();const i=Object.assign({jwtFromRequest:o.ExtractJwt.fromHeader("xc-auth"),passReqToCallback:!0,secretOrKey:a.auth.jwt.secret},a.auth.jwt.options);return new f.JwtStrategy(i,e)},inject:[h.UsersService,u.MetaService]},t.globalModuleMetadata={imports:[l.EventEmitterModule,(0,s.forwardRef)((()=>b.UsersModule))],providers:[r.InitMetaServiceProvider,m.AppHooksService,t.JwtStrategyProvider,d.GlobalGuard,c.SocketGateway,m.AppHooksService,_.AppHooksListenerService,g.TelemetryService],exports:[u.MetaService,t.JwtStrategyProvider,d.GlobalGuard,m.AppHooksService,_.AppHooksListenerService,g.TelemetryService,..."true"!==process.env.NC_WORKER_CONTAINER?[c.SocketGateway]:[]]};let y=class{};y=i([(0,s.Global)(),(0,s.Module)(t.globalModuleMetadata)],y),t.GlobalModule=y},12168:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InitMetaServiceProvider=void 0;const n=a(87049),s=a(29883),o=a(5311),r=i(a(27552)),l=i(a(70781)),c=i(a(39520)),d=i(a(37912)),u=i(a(16639)),p=i(a(6543)),m=a(15147),f=a(35043);t.InitMetaServiceProvider={useFactory:async e=>{await(0,f.prepareEnv)();const t=await f.NcConfig.createByEnv();process.env.NC_VERSION="0111002",await d.default.init();const a=new o.MetaService(t);return await a.init(),r.default._ncMeta=a,r.default.config=t,r.default.eventEmitter=e,await r.default.initJwt(),await(0,p.default)(a),await l.default.init(r.default.ncMeta),await r.default.loadEEState(),"true"===process.env.NC_CLOUD&&await(0,s.populatePluginsForCloud)({ncMeta:r.default.ncMeta}),await c.default.upgrade({ncMeta:r.default._ncMeta}),n.T.init({instance:u.default}),n.T.emit("evt_app_started",await m.User.count()),a},provide:o.MetaService,inject:["IEventEmitter"]}},2616:function(e,t,a){var i,n,s,o,r=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.QueueService=void 0;const d=a(26481),u=c(a(66998)),p=c(a(51196)),m=a(61074),f=a(62710),h=a(89588),g=a(26094);let _=i=class{constructor(e,t,a){this.jobsEventService=e,this.duplicateProcessor=t,this.atImportProcessor=a,this.jobMap={[g.JobTypes.DuplicateBase]:{this:this.duplicateProcessor,fn:this.duplicateProcessor.duplicateBase},[g.JobTypes.DuplicateModel]:{this:this.duplicateProcessor,fn:this.duplicateProcessor.duplicateModel},[g.JobTypes.AtImport]:{this:this.atImportProcessor,fn:this.atImportProcessor.job}},this.emitter.on(g.JobStatus.ACTIVE,(e=>{const t=this.queueMemory.find((t=>t.id===e.job.id));t.status=g.JobStatus.ACTIVE,this.jobsEventService.onActive.apply(this.jobsEventService,[t])})),this.emitter.on(g.JobStatus.COMPLETED,(e=>{const t=this.queueMemory.find((t=>t.id===e.job.id));t.status=g.JobStatus.COMPLETED,this.jobsEventService.onCompleted.apply(this.jobsEventService,[t,e.result]),this.removeJob(t)})),this.emitter.on(g.JobStatus.FAILED,(e=>{const t=this.queueMemory.find((t=>t.id===e.job.id));t.status=g.JobStatus.FAILED,this.jobsEventService.onFailed.apply(this.jobsEventService,[t,e.error]),this.removeJob(t)}))}async jobWrapper(e){this.emitter.emit(g.JobStatus.ACTIVE,{job:e});try{const t=await this.jobMap[e.name].fn.apply(this.jobMap[e.name].this,[e]);this.emitter.emit(g.JobStatus.COMPLETED,{job:e,result:t})}catch(t){this.emitter.emit(g.JobStatus.FAILED,{job:e,error:t})}}get emitter(){return i.emitter}get queue(){return i.queue}get queueMemory(){return i.queueMemory}get queueIndex(){return i.queueIdCounter}set queueIndex(e){i.queueIdCounter=e}add(e,t){const a=""+this.queueIndex++,i={id:`${a}`,name:e,status:g.JobStatus.WAITING,data:t};return this.queueMemory.push(i),this.queue.add((()=>this.jobWrapper(i))),{id:a,name:e}}getJobs(e){return e=Array.isArray(e)?e:[e],this.queueMemory.filter((t=>e.includes(t.status)))}getJob(e){return this.queueMemory.find((t=>t.id===e))}removeJob(e){const t=this.queueMemory.findIndex((t=>t.id===e.id));t&&this.queueMemory.splice(t,1)}};_.queue=new u.default({concurrency:1}),_.queueIdCounter=1,_.processed=0,_.queueMemory=[],_.emitter=new p.default,_=i=r([(0,d.Injectable)(),l("design:paramtypes",["function"==typeof(n=void 0!==h.JobsEventService&&h.JobsEventService)?n:Object,"function"==typeof(s=void 0!==m.DuplicateProcessor&&m.DuplicateProcessor)?s:Object,"function"==typeof(o=void 0!==f.AtImportProcessor&&f.AtImportProcessor)?o:Object])],_),t.QueueService=_},89588:function(e,t,a){var i,n,s,o,r,l=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsEventService=void 0;const u=a(7010),p=a(37068),m=d(a(55634)),f=a(47020),h=a(26094);let g=class{constructor(e){this.eventEmitter=e}onActive(e){this.eventEmitter.emit(h.JobEvents.STATUS,{id:e.id.toString(),status:h.JobStatus.ACTIVE})}onFailed(e,t){console.error((0,m.default)(`---- !! JOB FAILED !! ----\nid:${e.id}\nerror:${t.name} (${t.message})\n\nstack: ${t.stack}`,{padding:1,borderStyle:"double",borderColor:"yellow"})),this.eventEmitter.emit(h.JobEvents.STATUS,{id:e.id.toString(),status:h.JobStatus.FAILED,data:{error:{message:null==t?void 0:t.message}}})}onCompleted(e,t){this.eventEmitter.emit(h.JobEvents.STATUS,{id:e.id.toString(),status:h.JobStatus.COMPLETED,data:{result:t}})}};l([(0,u.OnQueueActive)(),c("design:type",Function),c("design:paramtypes",["function"==typeof(n=void 0!==p.Job&&p.Job)?n:Object]),c("design:returntype",void 0)],g.prototype,"onActive",null),l([(0,u.OnQueueFailed)(),c("design:type",Function),c("design:paramtypes",["function"==typeof(s=void 0!==p.Job&&p.Job)?s:Object,"function"==typeof(o="undefined"!=typeof Error&&Error)?o:Object]),c("design:returntype",void 0)],g.prototype,"onFailed",null),l([(0,u.OnQueueCompleted)(),c("design:type",Function),c("design:paramtypes",["function"==typeof(r=void 0!==p.Job&&p.Job)?r:Object,Object]),c("design:returntype",void 0)],g.prototype,"onCompleted",null),g=l([(0,u.Processor)(h.JOBS_QUEUE),c("design:paramtypes",["function"==typeof(i=void 0!==f.EventEmitter2&&f.EventEmitter2)?i:Object])],g),t.JobsEventService=g},12064:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsService=void 0;const o=a(26481),r=a(2616),l=a(26094);let c=class{constructor(e){this.fallbackQueueService=e}async add(e,t){return this.fallbackQueueService.add(e,t)}async jobStatus(e){return await(await this.fallbackQueueService.getJob(e)).status}async jobList(){return await this.fallbackQueueService.getJobs([l.JobStatus.ACTIVE,l.JobStatus.WAITING,l.JobStatus.DELAYED,l.JobStatus.PAUSED])}async getJobWithData(e){return(await this.fallbackQueueService.getJobs([l.JobStatus.WAITING,l.JobStatus.ACTIVE,l.JobStatus.DELAYED,l.JobStatus.PAUSED])).find((t=>{for(const a in e){if(!t.data[a])return!1;if(t.data[a]!==e[a])return!1}return!0}))}};c=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==r.QueueService&&r.QueueService)?i:Object])],c),t.JobsService=c},17944:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.elapsedTime=t.initTime=void 0;const i=a(26481),n=a(26094);t.initTime=function(){return{hrTime:process.hrtime()}};t.elapsedTime=function(e,t,a){const s=process.hrtime(e.hrTime)[0].toFixed(3),o=process.hrtime(e.hrTime)[1]/1e6;t&&i.Logger.debug(`${t}: ${s}s ${o}ms`,`${n.JOBS_QUEUE}${a?`:${a}`:""}`),e.hrTime=process.hrtime()}},98600:function(e,t,a){var i,n,s,o,r,l=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsGateway=void 0;const u=a(6279),p=a(43952),m=a(30715),f=a(24340),h=a(47020),g=a(26481),_=a(26094);let b=new URL(process.env.NC_PUBLIC_URL||`http://localhost:${process.env.PORT||"8080"}/`).pathname;b+=b.endsWith("/")?"jobs":"/jobs";let y=class{constructor(e){this.jobsService=e}async onModuleInit(){this.server.use((async(e,t)=>{try{const t=new m.ExecutionContextHost([e.handshake]),a=new((0,f.AuthGuard)("jwt"))(t);await a.canActivate(t)}catch(e){}t()}))}async subscribe(e,t){const{_id:a,data:i}=e;if(Object.keys(i).every((e=>["id"].includes(e)))&&(null==i?void 0:i.id)){(await this.jobsService.jobList()).map((e=>`jobs-${e.id}`)).find((e=>e===`jobs-${i.id}`))&&(t.join(`jobs-${i.id}`),t.emit("subscribed",{_id:a,id:i.id}))}else{const e=await this.jobsService.getJobWithData(i);e&&(t.join(`jobs-${e.id}`),t.emit("subscribed",{_id:a,id:e.id}))}}async status(e,t){const{_id:a,data:i}=e;t.emit("status",{_id:a,id:i.id,status:await this.jobsService.jobStatus(i.id)})}sendJobStatus(e){this.server.to(`jobs-${e.id}`).emit("status",{id:e.id,status:e.status,data:e.data})}sendJobLog(e){this.server.to(`jobs-${e.id}`).emit("log",{id:e.id,data:e.data})}};l([(0,u.WebSocketServer)(),c("design:type","function"==typeof(i=void 0!==p.Server&&p.Server)?i:Object)],y.prototype,"server",void 0),l([(0,u.SubscribeMessage)("subscribe"),d(0,(0,u.MessageBody)()),d(1,(0,u.ConnectedSocket)()),c("design:type",Function),c("design:paramtypes",[Object,"function"==typeof(n=void 0!==p.Socket&&p.Socket)?n:Object]),c("design:returntype","function"==typeof(s="undefined"!=typeof Promise&&Promise)?s:Object)],y.prototype,"subscribe",null),l([(0,u.SubscribeMessage)("status"),d(0,(0,u.MessageBody)()),d(1,(0,u.ConnectedSocket)()),c("design:type",Function),c("design:paramtypes",[Object,"function"==typeof(o=void 0!==p.Socket&&p.Socket)?o:Object]),c("design:returntype","function"==typeof(r="undefined"!=typeof Promise&&Promise)?r:Object)],y.prototype,"status",null),l([(0,h.OnEvent)(_.JobEvents.STATUS),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],y.prototype,"sendJobStatus",null),l([(0,h.OnEvent)(_.JobEvents.LOG),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],y.prototype,"sendJobLog",null),y=l([(0,u.WebSocketGateway)({cors:{origin:"*",allowedHeaders:["xc-auth"],credentials:!0},namespace:b}),d(0,(0,g.Inject)("JobsService")),c("design:paramtypes",[Object])],y),t.JobsGateway=y},25700:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsModule=void 0;const n=a(26481),s=a(7010),o=a(94352),r=a(29245),l=a(2818),c=a(62710),d=a(19997),u=a(61074),p=a(24610),m=a(98600),f=a(6207),h=a(73073),g=a(30132),_=a(12064),b=a(2616),y=a(89588),w=a(26094),v=a(60191),T=a(33792),O=a(55037);let E=class{};E=i([(0,n.Module)({imports:[O.GlobalModule,T.DatasModule,v.MetasModule,...process.env.NC_REDIS_JOB_URL?[s.BullModule.forRoot({url:process.env.NC_REDIS_JOB_URL}),s.BullModule.registerQueue({name:w.JOBS_QUEUE})]:[]],controllers:[..."true"!==process.env.NC_WORKER_CONTAINER?[d.DuplicateController,l.AtImportController]:[]],providers:[..."true"!==process.env.NC_WORKER_CONTAINER?[m.JobsGateway]:[],...process.env.NC_REDIS_JOB_URL?[h.JobsRedisService,g.JobsEventService]:[b.QueueService,y.JobsEventService],{provide:"JobsService",useClass:process.env.NC_REDIS_JOB_URL?f.JobsService:_.JobsService},p.JobsLogService,o.ExportService,r.ImportService,u.DuplicateProcessor,c.AtImportProcessor]})],E),t.JobsModule=E},2818:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AtImportController=void 0;const o=a(26481),r=a(66310),l=a(68382),c=a(15147),d=a(51401),u=a(26094);let p=class{constructor(e){this.jobsService=e}async triggerSync(e){(await this.jobsService.jobList()).find((t=>t.data.syncId===e.params.syncId))&&d.NcError.badRequest("Sync already in progress");const t=await c.SyncSource.get(e.params.syncId),a=await t.getUser();let i=e.ncSiteUrl;process.env.NC_DOCKER&&(i=`http://localhost:${process.env.PORT||8080}`);return{id:(await this.jobsService.add(u.JobTypes.AtImport,Object.assign(Object.assign({syncId:e.params.syncId},(null==t?void 0:t.details)||{}),{projectId:t.project_id,baseId:t.base_id,authToken:"",baseURL:i,user:a}))).id}}async abortImport(e){return{}}};i([(0,o.Post)("/api/v1/db/meta/syncs/:syncId/trigger"),(0,l.Acl)("airtableImport"),(0,o.HttpCode)(200),s(0,(0,o.Request)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],p.prototype,"triggerSync",null),i([(0,o.Post)("/api/v1/db/meta/syncs/:syncId/abort"),(0,l.Acl)("airtableImport"),(0,o.HttpCode)(200),s(0,(0,o.Request)()),n("design:type",Function),n("design:paramtypes",[Object]),n("design:returntype",Promise)],p.prototype,"abortImport",null),p=i([(0,o.Controller)(),(0,o.UseGuards)(r.GlobalGuard),s(0,(0,o.Inject)("JobsService")),n("design:paramtypes",[Object])],p),t.AtImportController=p},62710:function(e,t,a){var i,n,s,o,r,l,c,d,u,p,m,f,h,g,_,b,y=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},w=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getUniqueNameGenerator=t.AtImportProcessor=void 0;const T=a(16464),O=a(68281),E=v(a(94294)),S=v(a(45643)),I=v(a(71569)),k=a(87049),C=v(a(1635)),j=v(a(36619)),x=v(a(32680)),R=a(7010),A=a(37068),M=a(68281),N=v(a(96974)),P=a(24610),L=v(a(37890)),$=a(98744),q=v(a(13527)),D=a(76696),U=a(27695),B=a(69905),F=a(3272),V=a(74500),G=a(99155),H=a(1180),W=a(95524),z=a(36701),J=a(40330),K=a(19316),Y=a(58110),X=a(430),Q=a(42934),Z=a(26094),ee=(0,T.promisify)(S.default.writeFile);C.default.extend(j.default);const te={blue:"#cfdfff",cyan:"#d0f0fd",teal:"#c2f5e9",green:"#d1f7c4",orange:"#fee2d5",yellow:"#ffeab6",red:"#ffdce5",pink:"#ffdaf6",purple:"#ede2fe",gray:"#eee",blueMedium:"#9cc7ff",cyanMedium:"#77d1f3",tealMedium:"#72ddc3",greenMedium:"#93e088",orangeMedium:"#ffa981",yellowMedium:"#ffd66e",redMedium:"#ff9eb7",pinkMedium:"#f99de2",purpleMedium:"#cdb0ff",grayMedium:"#ccc",blueDark:"#2d7ff9",cyanDark:"#18bfff",tealDark:"#20d9d2",greenDark:"#20c933",orangeDark:"#ff6f2c",yellowDark:"#fcb400",redDark:"#f82b60",pinkDark:"#ff08c2",purpleDark:"#8b46ff",grayDark:"#666",blueDarker:"#2750ae",cyanDarker:"#0b76b7",tealDarker:"#06a09b",greenDarker:"#338a17",orangeDarker:"#d74d26",yellowDarker:"#b87503",redDarker:"#ba1e45",pinkDarker:"#b2158b",purpleDarker:"#6b1cb0",grayDarker:"#444"};let ae=class{constructor(e,t,a,i,n,s,o,r,l,c,d,u,p,m,f){this.tablesService=e,this.viewsService=t,this.projectsService=a,this.attachmentsService=i,this.columnsService=n,this.filtersService=s,this.formColumnsService=o,this.formsService=r,this.galleriesService=l,this.gridsService=c,this.projectUsersService=d,this.viewColumnsService=u,this.sortsService=p,this.bulkDataAliasService=m,this.jobsLogService=f,this.dubugLog=(0,N.default)("nc:at-import:processor")}async job(e){const a=e.data,i=new q.default("aTblId","ncId","ncName","ncParent");await i.init();const n=a.user.roles.split(",").reduce(((e,t)=>Object.assign({[t]:!0},e))),s={async addToMappingTbl(e,t,a,n){await i.addRow({aTblId:e,ncId:t,ncName:a,ncParent:n})},async getNcIdFromAtId(e){var t;return null===(t=await i.getRow("aTblId",e,["ncId"]))||void 0===t?void 0:t.ncId},async getNcParentFromAtId(e){var t;return null===(t=await i.getRow("aTblId",e,["ncParent"]))||void 0===t?void 0:t.ncParent},async getNcNameFromAtId(e){var t;return null===(t=await i.getRow("aTblId",e,["ncName"]))||void 0===t?void 0:t.ncName}},o=t=>{this.jobsLogService.sendLog(e,{message:t}),this.dubugLog(t)},r=t=>{h&&this.jobsLogService.sendLog(e,{message:t}),this.dubugLog(t)},l=[],c=()=>h?Date.now():0,d=(e,t)=>{if(!h)return;const a=Date.now()-e;l.push({d:a,e:t})};let u,p;const m=Date.now(),f=!1,h=!1;let g=[],_={};const b=[],y=[],w=[],v="ncRecordId",T="ncRecordHash",S={},j={},R=(0,t.getUniqueNameGenerator)("sheet"),A={sort:0,filter:0,view:{total:0,grid:0,gallery:0,form:0},fetchAt:{count:0,time:0},migrationSkipLog:{count:0,log:[]},data:{records:0,nestedLinks:0}},N=(e,t,a,i)=>{A.migrationSkipLog.count++,A.migrationSkipLog.log.push(`tn[${e}] cn[${t}] type[${a}] :: ${i}`)},P=async e=>{const t=Date.now(),a=await L.default.readView(e),i=Date.now()-t;return A.fetchAt.count++,A.fetchAt.time+=i,h&&await ee(`${e}.json`,a,{spaces:2}),a.view},D=()=>{var e;return null===(e=null==_?void 0:_.bases.find((e=>e.id===a.baseId)))||void 0===e?void 0:e.type},U={foreignKey:O.UITypes.Links,text:O.UITypes.SingleLineText,multilineText:O.UITypes.LongText,richText:O.UITypes.LongText,multipleAttachment:O.UITypes.Attachment,checkbox:O.UITypes.Checkbox,multiSelect:O.UITypes.MultiSelect,select:O.UITypes.SingleSelect,collaborator:O.UITypes.Collaborator,multiCollaborator:O.UITypes.Collaborator,date:O.UITypes.Date,phone:O.UITypes.PhoneNumber,number:O.UITypes.Decimal,rating:O.UITypes.Rating,formula:O.UITypes.Formula,rollup:O.UITypes.Rollup,count:O.UITypes.Count,lookup:O.UITypes.Lookup,autoNumber:O.UITypes.AutoNumber,barcode:O.UITypes.SingleLineText,button:O.UITypes.Button},B=e=>e.replace(/\W+/g,"_").trim(),F=(e,t)=>{let a=B(t);a=null==a?void 0:a.slice(0,60);const i=t.trim().replace(/\./g,"_"),n=e.columns.find((e=>{var t;return(null===(t=e.title)||void 0===t?void 0:t.toLowerCase())===(null==i?void 0:i.toLowerCase())})),s=e.columns.find((e=>{var t;return(null===(t=e.column_name)||void 0===t?void 0:t.toLowerCase())===(null==a?void 0:a.toLowerCase())}));return{title:i+(n?"_2":""),column_name:a+(s?"_2":"")}},V={tables:[],tablesById:{}},G=e=>{for(let t=0;t<g.length;t++){const a=g[t],i=a.columns.find((t=>t.id===e));if(void 0!==i)return{tn:a.name,cn:i.name}}},H=async e=>{const t=await s.getNcParentFromAtId(e),a=await s.getNcIdFromAtId(e);return void 0===a||void 0===t?0:V.tablesById[t].columns.find((e=>e.id===a))},W=async e=>V.tables.find((t=>t.title===e)),z=async({projectName:e})=>{const t={list:[]};t.list=await this.projectsService.projectList({user:{id:a.user.id,roles:(0,M.extractRolesObj)(a.user.roles)}});const i=t.list.find((t=>t.title===e));i&&await this.projectsService.projectSoftDelete({projectId:i.id,user:a.user}),r("Init")},J=e=>{var t,a,i,n,s,o,r,l,c,d;let u=U[e.type];switch(e.type){case"text":"email"===(null===(t=e.typeOptions)||void 0===t?void 0:t.validatorName)?u=O.UITypes.Email:"url"===(null===(a=e.typeOptions)||void 0===a?void 0:a.validatorName)&&(u=O.UITypes.URL);break;case"number":"percentV2"===(null===(i=e.typeOptions)||void 0===i?void 0:i.format)?u=O.UITypes.Percent:"duration"===(null===(n=e.typeOptions)||void 0===n?void 0:n.format)?u=O.UITypes.Duration:"currency"===(null===(s=e.typeOptions)||void 0===s?void 0:s.format)?u=O.UITypes.Currency:(null===(o=e.typeOptions)||void 0===o?void 0:o.precision)>0&&(u=O.UITypes.Decimal);break;case"formula":("CREATED_TIME()"===(null===(r=e.typeOptions)||void 0===r?void 0:r.formulaTextParsed)||"LAST_MODIFIED_TIME()"===(null===(l=e.typeOptions)||void 0===l?void 0:l.formulaTextParsed))&&(u=O.UITypes.DateTime);break;case"computation":"collaborator"===(null===(c=e.typeOptions)||void 0===c?void 0:c.resultType)&&(u=O.UITypes.Collaborator);break;case"date":(null===(d=e.typeOptions)||void 0===d?void 0:d.isDateTime)&&(u=O.UITypes.DateTime)}return u},K=async e=>{switch(e.type){case"select":case"multiSelect":{const t=[];let a=1;for(const[,i]of Object.entries(e.typeOptions.choices)){"multiSelect"===e.type&&(i.name=i.name.replace(/,/g,".")),""===i.name&&(i.name="nc_empty");let n=1;const o=i.name;for(;t.find((e=>e.title.toLowerCase()===i.name.toLowerCase()));)i.name=`${o}_${n++}`;t.push({order:a++,title:i.name,color:te[i.color]?te[i.color]:x.default.random().toHexString()}),await s.addToMappingTbl(i.id,void 0,i.name)}return{type:e.type,data:t}}default:return{type:void 0}}},Y=async e=>{var i;const l=await(async e=>{const i=[];for(let n=0;n<e.length;++n){const s={};a.options.syncViews?A.view.total+=e[n].views.reduce(((e,t)=>["grid","form","gallery"].includes(t.type)?++e:e),0):A.view.total=e.length,s.title=e[n].name;let o=B(e[n].name);o=null==o?void 0:o.slice(0,50),s.table_name=R(o);const r=(0,t.getUniqueNameGenerator)("field");s.columns=[];const l=[{title:v,column_name:v,uidt:O.UITypes.ID,meta:{ag:"nc"}},{title:T,column_name:T,uidt:O.UITypes.SingleLineText,system:!0}];for(let t=0;t<e[n].columns.length;t++){const a=e[n].columns[t];if(["foreignKey","lookup","rollup"].includes(a.type))continue;const i=F(s,a.name),o={title:i.title,column_name:r(i.column_name),uidt:J(a)};if(o.uidt===O.UITypes.Formula){N(e[n].name,i.title,a.type,"column type not supported");continue}"text"===a.type&&(o.dt="text"),["sqlite3","mysql2"].includes(D())&&o.uidt===O.UITypes.Decimal&&(o.dt="double",o.dtxp=22,o.dtxs="2");const l=await K(a);switch(l.type){case"select":case"multiSelect":o.colOptions={options:[...l.data]},["mysql","mysql2"].includes(D())&&(o.dtxp=l.data.map((e=>`'${e.title.replace(/'/gi,"''")}'`)).join(",")||"''")}s.columns.push(o)}s.columns.push(l[0]),s.columns.push(l[1]),i.push(s)}return i})(e);for(let t=0;t<l.length;t++){o(`:: [${t+1}/${l.length}] ${l[t].title}`),r(`NC API: base.tableCreate ${l[t].title}`);let u=c();const p=await this.tablesService.tableCreate({baseId:a.baseId,projectId:_.id,table:l[t],user:a.user});d(u,"dbTable.create"),me(p),await s.addToMappingTbl(e[t].id,p.id,p.title);for(let a=0;a<p.columns.length;a++){const n=null===(i=e[t].columns.find((e=>e.name.trim().replace(/\./g,"_")===p.columns[a].title)))||void 0===i?void 0:i.id;n&&await s.addToMappingTbl(n,p.columns[a].id,p.columns[a].title,p.id)}r(`NC API: dbView.list ${p.id}`),u=c();const m={list:[]};m.list=await this.viewsService.viewList({tableId:p.id,user:{roles:n,project_roles:{owner:!0}}}),d(u,"dbView.list");const f=e[t].views.find((e=>"grid"===e.type));r(`NC API: dbView.update ${m.list[0].id} ${f.name}`),u=c(),await this.viewsService.viewUpdate({viewId:m.list[0].id,view:{title:f.name},user:a.user}),d(u,"dbView.update"),await fe(p.id),await s.addToMappingTbl(f.id,p.views[0].id,f.name,p.id)}return l},X=async e=>{var t,i,n,o;for(let l=0;l<e.length;l++){const u=e[l].columns.filter((e=>"foreignKey"===e.type));if(u.length)for(let p=0;p<u.length;p++){r(`[${l+1}/${e.length}] Configuring Links :: [${p+1}/${u.length}] ${e[l].name}`);{const e=G(u[p].id),a=G(null===(t=u[p].typeOptions)||void 0===t?void 0:t.symmetricColumnId);r(`LTAR ${e.tn}:${e.cn} <${u[p].typeOptions.relationship}> ${null==a?void 0:a.tn}:${null==a?void 0:a.cn}`)}if(oe(u[p].id)){const e=b.findIndex((e=>e.aTbl.tblId===u[p].typeOptions.foreignTableId&&e.aTbl.id===u[p].typeOptions.symmetricColumnId));let t=c();const i=await this.tablesService.getTableWithAccessibleViews({tableId:b[e].nc.childId,user:Object.assign(Object.assign({},a.user),{project_roles:{owner:!0}})});d(t,"dbTable.read"),t=c();const n=await this.tablesService.getTableWithAccessibleViews({tableId:b[e].nc.parentId,user:Object.assign(Object.assign({},a.user),{project_roles:{owner:!0}})});d(t,"dbTable.read");let l=n.columns.find((t=>t.title===b[e].nc.title));if(void 0===l){N(null==n?void 0:n.title,b[e].nc.title,O.UITypes.Links,"Link error");continue}(0,M.isLinksOrLTAR)(l)||(l=n.columns.find((t=>t.title===b[e].nc.title+"_2")));let m={};m="hm"==l.colOptions.type?i.columns.find((e=>(0,M.isLinksOrLTAR)(e)&&e.colOptions.fk_child_column_id===l.colOptions.fk_child_column_id&&e.colOptions.fk_parent_column_id===l.colOptions.fk_parent_column_id)):i.columns.find((e=>(0,M.isLinksOrLTAR)(e)&&e.colOptions.fk_child_column_id===l.colOptions.fk_parent_column_id&&e.colOptions.fk_parent_column_id===l.colOptions.fk_child_column_id&&e.colOptions.fk_mm_model_id===l.colOptions.fk_mm_model_id));const f=i.columns.find((e=>e.title===u[p].name)),h=f?"_2":"",g=F(i,u[p].name);r(`NC API: dbTableColumn.update rename symmetric column ${g.title}`),t=c();const _=await this.columnsService.columnUpdate({columnId:m.id,column:Object.assign(Object.assign({},m),{title:g.title,column_name:g.column_name}),user:a.user});d(t,"dbTableColumn.update"),me(_);const y=null===(o=_.columns.find((e=>e.title===u[p].name+h)))||void 0===o?void 0:o.id;await s.addToMappingTbl(u[p].id,y,u[p].name+h,_.id)}else{const t=await s.getNcIdFromAtId(e[l].id),o=G(null===(i=u[p].typeOptions)||void 0===i?void 0:i.symmetricColumnId);let m=t;o&&(m=(await W(o.tn)).id);let f=c();const h=await this.tablesService.getTableWithAccessibleViews({tableId:t,user:Object.assign(Object.assign({},a.user),{project_roles:{owner:!0}})});d(f,"dbTable.read");const g=F(h,u[p].name);j[h.id]=j[h.id]||{},j[h.id][g.title]=u[p].name,r(`NC API: dbTableColumn.create LinkToAnotherRecord ${g.title}`),f=c();const _=await this.columnsService.columnAdd({tableId:t,column:{uidt:O.UITypes.Links,title:g.title,column_name:g.column_name,parentId:t,childId:m,type:"mm"},req:{user:a.user.email,clientIp:""},user:a.user});d(f,"dbTableColumn.create"),me(_);const y=null===(n=_.columns.find((e=>e.title===g.title)))||void 0===n?void 0:n.id;await s.addToMappingTbl(u[p].id,y,g.title,_.id);const w={nc:{title:g.title,parentId:t,childId:m,type:"mm"},aTbl:Object.assign({tblId:e[l].id},u[p])};b.push(w)}}}},Q=async e=>{var t,i,n,o,l,u,p;for(let u=0;u<e.length;u++){const p=e[u].columns.filter((e=>"lookup"===e.type)),m=await s.getNcIdFromAtId(e[u].id),h=V.tablesById[m];if(p.length)for(let g=0;g<p.length;g++){if(r(`[${u+1}/${e.length}] Configuring Lookup :: [${g+1}/${p.length}] ${e[u].name}`),null===(o=null===(n=null===(i=null===(t=p[g])||void 0===t?void 0:t.typeOptions)||void 0===i?void 0:i.dependencies)||void 0===n?void 0:n.invalidColumnIds)||void 0===o?void 0:o.length){f,N(h.title,p[g].name,p[g].type,"invalid column ID in dependency list");continue}const _=await s.getNcIdFromAtId(p[g].typeOptions.relationColumnId),b=await s.getNcIdFromAtId(p[g].typeOptions.foreignTableRollupColumnId);if(void 0===b||void 0===_){p[g].srcTableId=m,y.push(p[g]);continue}const w=F(h,p[g].name);r(`NC API: dbTableColumn.create LOOKUP ${w.title}`);const v=c(),T=await this.columnsService.columnAdd({tableId:m,column:{uidt:O.UITypes.Lookup,title:w.title,column_name:w.column_name,fk_relation_column_id:_,fk_lookup_column_id:b},req:{user:a.user.email,clientIp:""},user:a.user});d(v,"dbTableColumn.create"),me(T);const E=null===(l=T.columns.find((e=>e.title===p[g].name)))||void 0===l?void 0:l.id;await s.addToMappingTbl(p[g].id,E,p[g].name,T.id)}}let m=2,h=0;for(;y.length;){if(h===y.length){for(let e=0;e<y.length;e++){const t=y[e].typeOptions.foreignTableRollupColumnId,a=G(t);N(null===(u=V.tablesById[y[e].srcTableId])||void 0===u?void 0:u.title,y[e].name,y[e].type,`foreign table field not found [${a.tn}/${a.cn}]`)}f;break}h=y.length;for(let e=0;e<y.length;e++){const t=y[0].srcTableId,i=V.tablesById[t],n=await s.getNcIdFromAtId(y[0].typeOptions.relationColumnId),o=await s.getNcIdFromAtId(y[0].typeOptions.foreignTableRollupColumnId);if(void 0===o||void 0===n)continue;const l=F(i,y[0].name);r(`Configuring Nested Lookup: Level-${m} [${e+1}/${h} ${l.title}]`),r(`NC API: dbTableColumn.create LOOKUP ${l.title}`);const u=c(),f=await this.columnsService.columnAdd({tableId:t,column:{uidt:O.UITypes.Lookup,title:l.title,column_name:l.column_name,fk_relation_column_id:n,fk_lookup_column_id:o},req:{user:a.user.email,clientIp:""},user:a.user});d(u,"dbTableColumn.create"),me(f);const g=null===(p=f.columns.find((e=>e.title===y[0].name)))||void 0===p?void 0:p.id;await s.addToMappingTbl(y[0].id,g,y[0].name,f.id),y.splice(0,1)}m++}},Z=async e=>{var t,i,n,o,l;for(let u=0;u<e.length;u++){const p=e[u].columns.filter((e=>"rollup"===e.type)),m=await s.getNcIdFromAtId(e[u].id),h=V.tablesById[m];if(p.length)for(let g=0;g<p.length;g++){r(`[${u+1}/${e.length}] Configuring Rollup :: [${g+1}/${p.length}] ${e[u].name}`);const _={AND:"",ARRAYCOMPACT:"",ARRAYJOIN:"",ARRAYUNIQUE:"",AVERAGE:"average",CONCATENATE:"",COUNT:"count",COUNTA:"",COUNTALL:"",MAX:"max",MIN:"min",OR:"",SUM:"sum",XOR:""}[p[g].typeOptions.formulaTextParsed.split("(")[0]];if(""===_||void 0===_){N(h.title,p[g].name,p[g].type,`rollup function ${p[g].typeOptions.formulaTextParsed} not supported`);continue}if(null===(o=null===(n=null===(i=null===(t=p[g])||void 0===t?void 0:t.typeOptions)||void 0===i?void 0:i.dependencies)||void 0===n?void 0:n.invalidColumnIds)||void 0===o?void 0:o.length){f,N(h.title,p[g].name,p[g].type,"invalid column ID in dependency list");continue}const b=await s.getNcIdFromAtId(p[g].typeOptions.relationColumnId),y=await s.getNcIdFromAtId(p[g].typeOptions.foreignTableRollupColumnId);if(void 0===y){p[g].srcTableId=m,w.push(p[g]);continue}const v=await H(p[g].typeOptions.foreignTableRollupColumnId);if((null==v?void 0:v.uidt)===O.UITypes.Formula||(null==v?void 0:v.uidt)===O.UITypes.Lookup||(null==v?void 0:v.uidt)===O.UITypes.Rollup||(null==v?void 0:v.uidt)===O.UITypes.Checkbox){N(h.title,p[g].name,p[g].type,"rollup referring to a column type not supported currently");continue}const T=F(h,p[g].name);r(`NC API: dbTableColumn.create ROLLUP ${T.title}`);const E=c(),S=await this.columnsService.columnAdd({tableId:m,column:{uidt:O.UITypes.Rollup,title:T.title,column_name:T.column_name,fk_relation_column_id:b,fk_rollup_column_id:y,rollup_function:_},req:{user:a.user.email,clientIp:""},user:a.user});d(E,"dbTableColumn.create"),me(S);const I=null===(l=S.columns.find((e=>e.title===p[g].name)))||void 0===l?void 0:l.id;await s.addToMappingTbl(p[g].id,I,p[g].name,S.id)}}r(`Nested rollup: ${w.length}`)},ae=async()=>{var e;const t=y.length;for(let i=0;i<y.length;i++){const n=y[0].srcTableId,o=V.tablesById[n],l=await s.getNcIdFromAtId(y[0].typeOptions.relationColumnId),u=await s.getNcIdFromAtId(y[0].typeOptions.foreignTableRollupColumnId);if(void 0===u||void 0===l)continue;const p=F(o,y[0].name);r(`Configuring Lookup over Rollup :: [${i+1}/${t}] ${p.title}`),r(`NC API: dbTableColumn.create LOOKUP ${p.title}`);const m=c(),f=await this.columnsService.columnAdd({tableId:n,column:{uidt:O.UITypes.Lookup,title:p.title,column_name:p.column_name,fk_relation_column_id:l,fk_lookup_column_id:u},req:{user:a.user.email,clientIp:""},user:a.user});d(m,"dbTableColumn.create"),me(f);const h=null===(e=f.columns.find((e=>e.title===y[0].name)))||void 0===e?void 0:e.id;await s.addToMappingTbl(y[0].id,h,y[0].name,f.id),y.splice(0,1)}},ie=async e=>{for(let t=0;t<e.length;t++){r(`[${t+1}/${e.length}] Configuring Display value : ${e[t].name}`);const a=e[t].primaryColumnId,i=await s.getNcIdFromAtId(a);if(i){r("NC API: dbTableColumn.primaryColumnSet");const a=c();await this.columnsService.columnSetAsPrimary({columnId:i}),d(a,"dbTableColumn.primaryColumnSet");const n=await s.getNcIdFromAtId(e[t].id);await fe(n)}}},ne=async(e,t,a)=>{var i;let n;const s=c();return"form"===t?(n=(await this.formsService.formViewGet({formViewId:e})).columns,d(s,"dbView.formRead")):"gallery"===t?(n=(await this.galleriesService.galleryViewGet({galleryViewId:e})).columns,d(s,"dbView.galleryRead")):(n=await this.viewColumnsService.columnList({viewId:e}),d(s,"dbView.gridColumnsList")),null===(i=n.find((e=>e.fk_column_id===a)))||void 0===i?void 0:i.id},se=async(e,t,i)=>{var n,s,r;const l=(0,I.default)(i),c=Object.assign({},i.fields);Object.keys(c).forEach((e=>{const t=e.trim().replace(/\./g,"_");e!==t&&(c[t]=c[e],delete c[e])}));for(const[i,l]of Object.entries(c)){const d=null===(n=t.columns.find((e=>e.title===i)))||void 0===n?void 0:n.uidt;if(l||(0,M.isLinksOrLTAR)(d)||d===O.UITypes.Lookup||d===O.UITypes.Rollup)switch(d){case O.UITypes.Currency:c[i]=(+l).toFixed(2);break;case O.UITypes.LinkToAnotherRecord:case O.UITypes.Links:false,delete c[i];break;case O.UITypes.Lookup:case O.UITypes.Rollup:delete c[i];break;case O.UITypes.Collaborator:if(Array.isArray(l)){let e="";for(let t=0;t<l.length;t++)e+=`${null===(s=l[t])||void 0===s?void 0:s.name} <${null===(r=l[t])||void 0===r?void 0:r.email}>, `,c[i]=e}else c[i]=`${null==l?void 0:l.name} <${null==l?void 0:l.email}>`;break;case O.UITypes.Button:c[i]=`${null==l?void 0:l.label} <${null==l?void 0:l.url}>`;break;case O.UITypes.DateTime:case O.UITypes.CreateTime:case O.UITypes.LastModifiedTime:c[i]=(0,C.default)(l).format("YYYY-MM-DD HH:mm");break;case O.UITypes.Date:/\d{5,}/.test(l)?(c[i]=null,o(`:: Invalid date ${l}`)):c[i]=(0,C.default)(l).format("YYYY-MM-DD");break;case O.UITypes.SingleSelect:""===l&&(c[i]="nc_empty"),c[i]=l;break;case O.UITypes.MultiSelect:c[i]=null==l?void 0:l.map((e=>""===e?"nc_empty":`${e.replace(/,/g,".")}`)).join(",");break;case O.UITypes.Attachment:if(a.options.syncAttachment){let a=[];try{o(` :: Retrieving attachment :: ${null==l?void 0:l.map((e=>{var t,a;return null===(a=null===(t=e.filename)||void 0===t?void 0:t.split("?"))||void 0===a?void 0:a[0]})).join(", ")}`),a=await this.attachmentsService.uploadViaURL({path:`noco/${e.projectName}/${t.title}/${i}`,urls:null==l?void 0:l.map((e=>{var t,a;return{fileName:null===(a=null===(t=e.filename)||void 0===t?void 0:t.split("?"))||void 0===a?void 0:a[0],url:e.url,size:e.size,mimetype:e.type}}))})}catch(e){console.log(e)}c[i]=JSON.stringify(a)}else c[i]=null;break;case O.UITypes.SingleLineText:(null==l?void 0:l.text)&&(c[i]=l.text)}else c[i]=null}return c[v]=i.id,c[T]=l,c},oe=e=>!!b.find((t=>t.aTbl.typeOptions.symmetricColumnId===e)),re=async e=>{r(`Create Project: ${e}`);const t=c();_=await this.projectsService.projectCreate({project:{title:e},user:{id:a.user.id}}),d(t,"project.create")},le=async e=>{r(`Getting project meta: ${e}`);const t=c();_=await this.projectsService.getProjectWithInfo({projectId:e}),d(t,"project.read")},ce=async(e,t)=>{var i;if(e.options.syncViews)for(let e=0;e<t.length;e++){const n=(await W(t[e].name)).id,s=t[e].views.filter((e=>"gallery"===e.type)),l=A.view.grid+A.view.gallery+A.view.form;A.view.gallery+=s.length;for(let u=0;u<s.length;u++){r("   Axios fetch view-data"),await P(s[u].id);const p=null===(i=t[e].views.find((e=>e.id===s[u].id)))||void 0===i?void 0:i.name;o(`:: [${l+u+1}/${A.view.total}] Gallery : ${t[e].name} / ${p}`),r(`NC API dbView.galleryCreate :: ${p}`);const m=c();await this.galleriesService.galleryViewCreate({tableId:n,gallery:{title:p},user:a.user}),d(m,"dbView.galleryCreate"),await fe(n)}}},de=async(e,t)=>{var i,n,l,u,p;if(e.options.syncViews)for(let e=0;e<t.length;e++){const m=await s.getNcIdFromAtId(t[e].id),f=t[e].views.filter((e=>"form"===e.type)),h=A.view.grid+A.view.gallery+A.view.form;A.view.form+=f.length;for(let s=0;s<f.length;s++){r("   Axios fetch view-data");const g=await P(f[s].id),_=null===(i=t[e].views.find((e=>e.id===f[s].id)))||void 0===i?void 0:i.name;o(`:: [${h+s+1}/${A.view.total}] Form : ${t[e].name} / ${_}`);let b="NO_REFRESH",y="Thank you for submitting the form!",w="";(null===(n=g.metadata)||void 0===n?void 0:n.form)&&((null===(l=g.metadata.form)||void 0===l?void 0:l.refreshAfterSubmit)&&(b=g.metadata.form.refreshAfterSubmit),(null===(u=g.metadata.form)||void 0===u?void 0:u.afterSubmitMessage)&&(y=g.metadata.form.afterSubmitMessage),(null===(p=g.metadata.form)||void 0===p?void 0:p.description)&&(w=g.metadata.form.description));const v={title:_,heading:_,subheading:w,success_msg:y,submit_another_form:b.includes("REFRESH_BUTTON"),show_blank_form:b.includes("AUTO_REFRESH")};r(`NC API dbView.formCreate :: ${_}`);const T=c(),O=await this.formsService.formViewCreate({tableId:m,body:v,user:a.user});d(T,"dbView.formCreate"),r(`[${e+1}/${t.length}][Form View][${s+1}/${f.length}] Create ${_}`),await fe(m),r("   Configure show/hide columns"),await ye(O.id,g,t[e].name,_,"form")}}},ue=async(e,t)=>{var i,l,u,p;for(let m=0;m<t.length;m++){const f=await s.getNcIdFromAtId(t[m].id),h=t[m].views.filter((e=>"grid"===e.type));let g=m;a.options.syncViews&&(g=A.view.grid+A.view.gallery+A.view.form),A.view.grid+=h.length;for(let a=0;a<(e.options.syncViews?h.length:1);a++){r("   Axios fetch view-data");const e=await P(h[a].id),_=null===(i=t[m].views.find((e=>e.id===h[a].id)))||void 0===i?void 0:i.name,b=c(),y={list:[]};y.list=await this.viewsService.viewList({tableId:f,user:{roles:n,project_roles:{owner:!0}}}),d(b,"dbView.list");let w=null===(u=null===(l=null==y?void 0:y.list)||void 0===l?void 0:l.find((e=>e.tn===_)))||void 0===u?void 0:u.id;if(o(`:: [${g+a+1}/${A.view.total}] Grid : ${t[m].name} / ${_}`),a>0){r(`NC API dbView.gridCreate :: ${_}`);const e=c(),t=await this.gridsService.gridViewCreate({tableId:f,grid:{title:_}});d(e,"dbView.gridCreate"),await fe(f),await s.addToMappingTbl(h[a].id,t.id,_,f),w=t.id}r("   Configure show/hide columns"),await ye(w,e,t[m].name,_,"grid"),(null==e?void 0:e.filters)&&(r("   Configure filter set"),e.filters.filterSet.find((e=>"nested"===(null==e?void 0:e.type)))||await _e(w,e.filters)),(null===(p=null==e?void 0:e.lastSortsApplied)||void 0===p?void 0:p.sortSet.length)&&(r("   Configure sort set"),await be(w,e.lastSortsApplied))}}},pe=async e=>{const t={owner:"owner",create:"creator",edit:"editor",comment:"commenter",read:"viewer",none:"viewer"},i=e.appBlanket.userInfoById,n=Object.keys(i).length;let s=0;const l=[];for(const[,e]of Object.entries(i)){r(`[${++s}/${n}] NC API auth.projectUserAdd :: ${e.email}`);const i=c();l.push(this.projectUsersService.userInvite({projectId:_.id,projectUser:{email:e.email,roles:t[e.permissionLevel]},req:{user:a.user,clientIp:""}}).catch((e=>e.message?o(`NOTICE: ${e.message}`):console.log(e)))),d(i,"auth.projectUserAdd")}await Promise.all(l)},me=e=>{const t=e.id,a=V.tables.findIndex((e=>e.id===t));-1!==a&&V.tables.splice(a,1),V.tables.push(e),V.tablesById[t]=e},fe=async e=>{const t=c(),i=await this.tablesService.getTableWithAccessibleViews({tableId:e,user:Object.assign(Object.assign({},a.user),{project_roles:{owner:!0}})});d(t,"dbTable.read"),me(i)},he=[],ge={"=":"eq","!=":"neq","<":"lt","<=":"lte",">":"gt",">=":"gte",isEmpty:"empty",isNotEmpty:"notempty",contains:"like",doesNotContain:"nlike",isAnyOf:"anyof",isNoneOf:"nanyof","|":"anyof","&":"allof"},_e=async(e,t)=>{for(let i=0;i<t.filterSet.length;i++){const n=t.filterSet[i],o=await H(n.columnId);if(!o){N(await s.getNcNameFromAtId(e),o.title,o.uidt,"filter config skipped; column not migrated");continue}const r=o.id,l=o.uidt,u=[];if(l!==O.UITypes.Date&&l!==O.UITypes.DateTime){if(l===O.UITypes.SingleSelect||l===O.UITypes.MultiSelect){if("doesNotContain"===n.operator&&(n.operator="isNoneOf"),Array.isArray(n.value)){const e={fk_column_id:r,logical_op:t.conjunction,comparison_op:ge[n.operator],value:(await Promise.all(n.value.map((async e=>await s.getNcNameFromAtId(e))))).join(",")};u.push(e)}else if(n.value){const e={fk_column_id:r,logical_op:t.conjunction,comparison_op:ge[n.operator],value:await s.getNcNameFromAtId(n.value)};u.push(e)}}else if(n.value){const e={fk_column_id:r,logical_op:t.conjunction,comparison_op:ge[n.operator],value:n.value};u.push(e)}for(let t=0;t<u.length;t++){const i=c();await this.filtersService.filterCreate({viewId:e,filter:u[t],user:a.user}),d(i,"dbTableFilter.create"),A.filter++}}else N(await s.getNcNameFromAtId(e),o.title,o.uidt,"filter config skipped; filter over date datatype not supported")}},be=async(e,t)=>{var a;for(let i=0;i<t.sortSet.length;i++){const n=null===(a=await H(t.sortSet[i].columnId))||void 0===a?void 0:a.id;if(n){const a=c();await this.sortsService.sortCreate({viewId:e,sort:{fk_column_id:n,direction:t.sortSet[i].ascending?"asc":"desc"}}),d(a,"dbTableSort.create")}A.sort++}},ye=async(e,t,a,i,n)=>{var o,r,l,u;const p=[v,T],m=t.columnOrder,f=await W(a),h=f.views.find((e=>e.title===i)).id;let g;const _=c();"form"===n?(g=(await this.formsService.formViewGet({formViewId:h})).columns,d(_,"dbView.formRead")):"gallery"===n?(g=(await this.galleriesService.galleryViewGet({galleryViewId:h})).columns,d(_,"dbView.galleryRead")):(g=await this.viewColumnsService.columnList({viewId:h}),d(_,"dbView.gridColumnsList"));for(let e=0;e<p.length;e++){const t=f.columns.find((t=>t.title===p[e])).id,a=null===(o=g.find((e=>e.fk_column_id===t)))||void 0===o?void 0:o.id;if(void 0===a)continue;const i=c();await this.viewColumnsService.columnUpdate({viewId:h,columnId:a,column:{show:!1,order:e+1+m.length}}),d(i,"dbViewColumn.update")}for(let e=0;e<m.length;e++){const a=await s.getNcIdFromAtId(m[e].columnId),i=await ne(h,n,a);if(void 0===i)continue;const o={show:m[e].visibility,order:e+1};if("form"===n&&(null===(u=null===(l=null===(r=null==t?void 0:t.metadata)||void 0===r?void 0:r.form)||void 0===l?void 0:l.fieldsByColumnId)||void 0===u?void 0:u[m[e].columnId])){const a=t.metadata.form.fieldsByColumnId[m[e].columnId],n=Object.assign({},o);(null==a?void 0:a.title)&&(n.label=a.title),(null==a?void 0:a.required)&&(n.required=a.required),(null==a?void 0:a.description)&&(n.description=a.description);const s=c();await this.formColumnsService.columnUpdate({formViewColumnId:i,formViewColumn:n}),d(s,"dbView.formColumnUpdate")}const p=c();await this.viewColumnsService.columnUpdate({viewId:h,columnId:i,column:o}),d(p,"dbViewColumn.update")}};try{o("SDK initialized"),r("Project initialization started"),h&&await z(a),r("Project initialized"),o("Retrieving Airtable schema");const e=await(async e=>{const t=Date.now();if(!e.shareId)throw{message:"Invalid Shared Base ID :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"};if(e.shareId.startsWith("exp")){const t=await L.default.readTemplate(e.shareId);await L.default.initialize(t.template.exploreApplication.shareId)}else await L.default.initialize(e.shareId,e.appId);const a=await L.default.read(),i=Date.now()-t;if(A.fetchAt.count++,A.fetchAt.time+=i,!a.baseId)throw{message:"Invalid Shared Base ID :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"};const n=a.schema;return p=a.baseId,u=new E.default({apiKey:e.apiKey}).base(p),g=n.tableSchemas,h&&await ee("aTblSchema.json",a,{spaces:2}),n})(a),t=e.tableSchemas;if(r("Project schema extraction completed"),a.projectId)await le(a.projectId),a.projectName=null==_?void 0:_.title,a.baseId=a.baseId||_.bases[0].id,r("Getting existing project meta");else{if(!a.projectName)throw new Error("Project name or id not provided");await re(a.projectName),r("Project created")}if(o("Importing Tables..."),await Y(t),r("Table creation completed"),r("Configuring Links"),await X(t),r("Migrating LTAR columns completed"),a.options.syncLookup&&(r("Configuring Lookup"),await Q(t),r("Migrating Lookup columns completed")),a.options.syncRollup&&(r("Configuring Rollup"),await Z(t),r("Migrating Rollup columns completed"),a.options.syncLookup&&(r("Migrating Lookup form Rollup columns"),await ae(),r("Migrating Lookup form Rollup columns completed"))),r("Configuring Display Value column"),await ie(t),r("Configuring Display Value column completed"),a.options.syncUsers&&(o("Configuring User(s)"),await pe(e),r("Adding users completed")),o("Syncing views"),await ue(a,t),await de(a,t),await ce(a,t),r("Syncing views completed"),a.options.syncData)try{const e=c(),i={list:[]};i.list=await this.tablesService.getAccessibleTables({projectId:_.id,baseId:a.baseId,roles:Object.assign(Object.assign({},n),{owner:!0})}),d(e,"base.tableList"),o("Reading Records...");const s={};for(let e=0;e<i.list.length;e++){if(void 0===t.find((t=>t.name===i.list[e].title)))continue;const n=c(),l=await this.tablesService.getTableWithAccessibleViews({tableId:i.list[e].id,user:Object.assign(Object.assign({},a.user),{project_roles:{owner:!0}})});d(n,"dbTable.read"),s[l.id]=await(0,$.importData)({projectName:a.projectId,table:l,base:u,logBasic:o,nocoBaseDataProcessing_v2:se,sDB:a,logDetailed:r,services:{tableService:this.tablesService,bulkDataService:this.bulkDataAliasService}}),A.data.records+=await s[l.id].getCount(),r(`Data inserted from ${l.title}`)}o("Configuring Record Links...");for(let e=0;e<i.list.length;e++){if(void 0===t.find((t=>t.name===i.list[e].title)))continue;const n=await this.tablesService.getTableWithAccessibleViews({tableId:i.list[e].id,user:Object.assign(Object.assign({},a.user),{project_roles:{owner:!0}})});A.data.nestedLinks+=await(0,$.importLTARData)({table:n,projectName:a.projectName,base:u,fields:null,logBasic:o,insertedAssocRef:S,logDetailed:r,records:s[n.id],atNcAliasRef:j,ncLinkMappingTable:b,syncDB:a,services:{tableService:this.tablesService,bulkDataService:this.bulkDataAliasService}})}}catch(e){r(`There was an error while migrating data! Please make sure your API key (${a.apiKey}) is correct.`),r(`Error: ${e}`)}await(async e=>{var t,a,i,n,s,r,c,d;const u={table_name:"",aTbl:{columns:0,links:0,lookup:0,rollup:0},nc:{columns:0,links:0,lookup:0,rollup:0,invalidColumn:0}};for(let o=0;o<e.length;o++){u.table_name=e[o].name;const l=e[o].columns.filter((e=>"foreignKey"===e.type)),p=e[o].columns.filter((e=>"lookup"===e.type)),m=e[o].columns.filter((e=>"rollup"===e.type));let f=0;for(let e=0;e<p.length;e++)(null===(n=null===(i=null===(a=null===(t=p[e])||void 0===t?void 0:t.typeOptions)||void 0===a?void 0:a.dependencies)||void 0===i?void 0:i.invalidColumnIds)||void 0===n?void 0:n.length)&&f++;for(let e=0;e<m.length;e++)(null===(d=null===(c=null===(r=null===(s=m[e])||void 0===s?void 0:s.typeOptions)||void 0===r?void 0:r.dependencies)||void 0===c?void 0:c.invalidColumnIds)||void 0===d?void 0:d.length)&&f++;u.aTbl.columns=e[o].columns.length,u.aTbl.links=l.length,u.aTbl.lookup=p.length,u.aTbl.rollup=m.length;const h=await W(e[o].name),g=h.columns.filter((e=>(0,M.isLinksOrLTAR)(e))),_=h.columns.filter((e=>e.uidt===O.UITypes.Lookup)),b=h.columns.filter((e=>e.uidt===O.UITypes.Rollup));u.nc.columns=h.columns.length-g.length/2,u.nc.links=g.length/2,u.nc.lookup=_.length,u.nc.rollup=b.length,u.nc.invalidColumn=f;const y=JSON.parse(JSON.stringify(u));he.push(y)}const p=he.reduce(((e,t)=>e+t.nc.columns),0),f=he.reduce(((e,t)=>e+t.nc.links),0),g=he.reduce(((e,t)=>e+t.nc.lookup),0),_=he.reduce(((e,t)=>e+t.nc.rollup),0);o("Quick Summary:"),o(`:: Total Tables:   ${e.length}`),o(`:: Total Columns:  ${p}`),o(`::   Links:        ${f}`),o(`::   Lookup:       ${g}`),o(`::   Rollup:       ${_}`),o(`:: Total Filters:  ${A.filter}`),o(`:: Total Sort:     ${A.sort}`),o(`:: Total Views:    ${A.view.total}`),o(`::   Grid:         ${A.view.grid}`),o(`::   Gallery:      ${A.view.gallery}`),o(`::   Form:         ${A.view.form}`),o(`:: Total Records:  ${A.data.records}`),o(`:: Total Nested Links: ${A.data.nestedLinks}`);const b=Date.now()-m;if(o(`:: Migration time:      ${b}`),o(`:: Axios fetch count:   ${A.fetchAt.count}`),o(`:: Axios fetch time:    ${A.fetchAt.time}`),h){await ee("stats.json",l,{spaces:2});const e=[];for(let t=0;t<l.length;t++)e.push(`${l[t].e}, ${l[t].d}`);await ee("stats.csv",e,{spaces:2}),await ee("skip.txt",A.migrationSkipLog.log,{spaces:2})}k.T.event({event:"a:airtable-import:success",data:{stats:{migrationTime:b,totalTables:e.length,totalColumns:p,links:f,lookup:g,rollup:_,totalFilters:A.filter,totalSort:A.sort,view:{total:A.view.total,grid:A.view.grid,gallery:A.view.gallery,form:A.view.form},axios:{count:A.fetchAt.count,time:A.fetchAt.time},totalRecords:A.data.records,nestedLinks:A.data.nestedLinks}}})})(t)}catch(e){if(e.message)throw k.T.event({event:"a:airtable-import:error",data:{error:e.message}}),new Error(e.message);throw e}}};y([(0,R.Process)(Z.JobTypes.AtImport),w("design:type",Function),w("design:paramtypes",["function"==typeof(b=void 0!==A.Job&&A.Job)?b:Object]),w("design:returntype",Promise)],ae.prototype,"job",null),ae=y([(0,R.Processor)(Z.JOBS_QUEUE),w("design:paramtypes",["function"==typeof(i=void 0!==K.TablesService&&K.TablesService)?i:Object,"function"==typeof(n=void 0!==X.ViewsService&&X.ViewsService)?n:Object,"function"==typeof(s=void 0!==z.ProjectsService&&z.ProjectsService)?s:Object,"function"==typeof(o=void 0!==D.AttachmentsService&&D.AttachmentsService)?o:Object,"function"==typeof(r=void 0!==U.ColumnsService&&U.ColumnsService)?r:Object,"function"==typeof(l=void 0!==F.FiltersService&&F.FiltersService)?l:Object,"function"==typeof(c=void 0!==V.FormColumnsService&&V.FormColumnsService)?c:Object,"function"==typeof(d=void 0!==Q.FormsService&&Q.FormsService)?d:Object,"function"==typeof(u=void 0!==G.GalleriesService&&G.GalleriesService)?u:Object,"function"==typeof(p=void 0!==H.GridsService&&H.GridsService)?p:Object,"function"==typeof(m=void 0!==W.ProjectUsersService&&W.ProjectUsersService)?m:Object,"function"==typeof(f=void 0!==Y.ViewColumnsService&&Y.ViewColumnsService)?f:Object,"function"==typeof(h=void 0!==J.SortsService&&J.SortsService)?h:Object,"function"==typeof(g=void 0!==B.BulkDataAliasService&&B.BulkDataAliasService)?g:Object,"function"==typeof(_=void 0!==P.JobsLogService&&P.JobsLogService)?_:Object])],ae),t.AtImportProcessor=ae;t.getUniqueNameGenerator=(e="name")=>{const t={};return(a=e)=>{let i="_"===a?e:a,n=0;for(;i in t;)i=`${a}_${++n}`;return t[i]=!0,i}}},13527:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(12781),s=i(a(20661));class o extends n.Readable{constructor(e,t){super({objectMode:!0}),this.db=e,this.sql=t,this.stmt=this.db.prepare(this.sql),this.on("end",(()=>this.stmt.finalize()))}_read(){const e=this;this.stmt.get((function(t,a){t?e.emit("error",t):(a&&(a=r(a)),e.push(a||null))}))}}function r(e){for(const t of Object.keys(e)){if(e[t]&&e[t].startsWith("JSON::"))try{e[t]=JSON.parse(e[t].replace("JSON::",""))}catch(e){console.log(e)}c(t)!==t&&(e[c(t)]=e[t],delete e[t])}return e}function l(e){return e.replace(/'/g,"''").replace(/[A-Z]/g,(e=>`_${e}`))}function c(e){return e.replace(/''/g,"'").replace(/_[A-Z]/g,(e=>e[1]))}t.default=class{constructor(...e){this.initialized=!1,this.cols=e.map((e=>l(e))),this.db=new Promise(((e,t)=>{const a=new s.default.Database(":memory:"),i=this.cols.length>0?this.cols.join(" TEXT, ")+" TEXT":"mappingPlaceholder TEXT";a.run(`CREATE TABLE mapping (${i})`,(i=>{i&&(console.log(i),t(i)),e(a)}))}))}async init(){this.initialized||(this.db=await this.db,this.initialized=!0)}destroy(){this.initialized&&this.db&&this.db.close()}async addRow(e){if(!this.initialized)throw"Please initialize first!";const t=Object.keys(e).map((e=>l(e))),a=t.map((e=>`'${e}'`)).join(", "),i=t.map((()=>"?")).join(", "),n=[];for(const e of t.filter((e=>!this.cols.includes(e))))n.push(new Promise(((t,a)=>{this.db.run(`ALTER TABLE mapping ADD '${e}' TEXT;`,(i=>{i&&(console.log(i),a(i)),this.cols.push(e),t(!0)}))})));await Promise.all(n);const s=Object.values(e).map((e=>"object"==typeof e?`JSON::${JSON.stringify(e)}`:e));return new Promise(((e,t)=>{this.db.run(`INSERT INTO mapping (${a}) VALUES (${i})`,s,(a=>{a&&(console.log(a),t(a)),e(!0)}))}))}getRow(e,t,a=[]){if(!this.initialized)throw"Please initialize first!";return new Promise(((i,n)=>{e=l(e),a=a.map((e=>l(e))),this.db.get(`SELECT ${a.length?a.join(", "):"*"} FROM mapping WHERE ${e} = ?`,[t],((e,t)=>{e&&(console.log(e),n(e)),t&&(t=r(t)),i(t)}))}))}getCount(){if(!this.initialized)throw"Please initialize first!";return new Promise(((e,t)=>{this.db.get("SELECT COUNT(*) as count FROM mapping",((a,i)=>{a&&(console.log(a),t(a)),e(i.count)}))}))}getStream(e=[]){if(!this.initialized)throw"Please initialize first!";return e=e.map((e=>l(e))),new o(this.db,`SELECT ${e.length?e.join(", "):"*"} FROM mapping`)}getLimit(e,t,a=[]){if(!this.initialized)throw"Please initialize first!";return new Promise(((i,n)=>{a=a.map((e=>l(e))),this.db.all(`SELECT ${a.length?a.join(", "):"*"} FROM mapping LIMIT ${e} OFFSET ${t}`,((e,t)=>{e&&(console.log(e),n(e));for(let e of t)e=r(e);i(t)}))}))}}},37890:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(52167)),s={initialized:!1};async function o(e,t){s.cookie="",t&&""!==t||(t=null);const a=`https://airtable.com/${t?`${t}/`:""}${e}`;try{const e=await n.default.get(a,{headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Linux"',"sec-fetch-dest":"document","sec-fetch-mode":"navigate","sec-fetch-site":"none","sec-fetch-user":"?1","upgrade-insecure-requests":"1","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.88 Safari/537.36"},referrerPolicy:"strict-origin-when-cross-origin",body:null,method:"GET"}).then((e=>{for(const t of e.headers["set-cookie"])s.cookie+=t.split(";")[0]+"; ";return e.data})).catch((()=>{throw{message:"Invalid Shared Base ID :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"}}));s.headers=JSON.parse(e.match(/(?<=var headers =)(.*)(?=;)/g)[0].trim()),s.link=e.match(/(?<=fetch\(")(.*)(?=")/g)[0].trim().replace(/\\u[\dA-F]{4}/gi,(function(e){return String.fromCharCode(parseInt(e.replace(/\\u/g,""),16))})),s.baseInfo=decodeURIComponent(s.link).match(/{(.*)}/g)[0].split("&").reduce(((e,t)=>{try{return Object.assign(e,JSON.parse(t.includes("=")?t.split("=")[1]:t))}catch(a){if(t.includes("="))return Object.assign(e,{[t.split("=")[0]]:t.split("=")[1]})}}),{}),s.baseId=s.baseInfo.applicationId,s.initialized=!0}catch(e){throw console.log(e),s.initialized=!1,e.message?e:{message:"Error processing Shared Base :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"}}}t.default={initialize:o,read:async function(){if(s.initialized){return{schema:(await(0,n.default)("https://airtable.com"+s.link,{headers:Object.assign({accept:"*/*","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Linux"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.88 Safari/537.36","x-time-zone":"Europe/Berlin",cookie:s.cookie},s.headers),referrerPolicy:"no-referrer",body:null,method:"GET"}).then((e=>e.data)).catch((()=>{throw{message:"Error Reading :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"}}))).data,baseId:s.baseId,baseInfo:s.baseInfo}}throw{message:"Error Initializing :: please try again !!"}},readView:async function(e){if(s.initialized){return{view:(await(0,n.default)(`https://airtable.com/v0.3/view/${e}/readData?stringifiedObjectParams=${encodeURIComponent("{}")}&requestId=${s.baseInfo.requestId}&accessPolicy=${encodeURIComponent(JSON.stringify({allowedActions:s.baseInfo.allowedActions,shareId:s.baseInfo.shareId,applicationId:s.baseInfo.applicationId,generationNumber:s.baseInfo.generationNumber,expires:s.baseInfo.expires,signature:s.baseInfo.signature}))}`,{headers:Object.assign({accept:"*/*","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Linux"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.88 Safari/537.36","x-time-zone":"Europe/Berlin",cookie:s.cookie},s.headers),referrerPolicy:"no-referrer",body:null,method:"GET"}).then((e=>e.data)).catch((()=>{throw{message:"Error Reading View :: Ensure www.airtable.com/<SharedBaseID> is accessible. Refer https://bit.ly/3x0OdXI for details"}}))).data}}throw{message:"Error Initializing :: please try again !!"}},readTemplate:async function(e){return s.initialized||await o("shrO8aYf3ybwSdDKn"),{template:await(0,n.default)(`https://www.airtable.com/v0.3/exploreApplications/${e}`,{headers:Object.assign({accept:"*/*","accept-language":"en-US,en;q=0.9","sec-ch-ua":'" Not A;Brand";v="99", "Chromium";v="100", "Google Chrome";v="100"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Linux"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.88 Safari/537.36","x-time-zone":"Europe/Berlin",cookie:s.cookie},s.headers),referrer:"https://www.airtable.com/",referrerPolicy:"same-origin",body:null,method:"GET",mode:"cors",credentials:"include"}).then((e=>e.data)).catch((()=>{throw{message:"Error Fetching :: Ensure www.airtable.com/templates/featured/<TemplateID> is accessible."}}))}}}},98744:function(e,t,a){var i=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,a=e[Symbol.asyncIterator];return a?a.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(a){t[a]=e[a]&&function(t){return new Promise((function(i,n){(function(e,t,a,i){Promise.resolve(i).then((function(t){e({value:t,done:a})}),t)})(i,n,(t=e[a](t)).done,t.value)}))}}},n=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.importLTARData=t.importData=void 0;const o=a(68281),r=s(a(66135)),l=s(a(13527)),c=20,d=51200;async function u({table:e,fields:t,base:a,logBasic:n=(e=>{})}){return new Promise(((s,o)=>{let r=null;const c={pageSize:100};t&&(c.fields=t),a(e.title).select(c).eachPage((async function(t,a){var s,o,c,d;r||(r=new l.default,await r.init());try{for(var u,p=!0,m=i(t);!(s=(u=await m.next()).done);){d=u.value,p=!1;try{const e=d;await r.addRow(Object.assign({id:e.id},e.fields))}finally{p=!0}}}catch(e){o={error:e}}finally{try{p||s||!(c=m.return)||await c.call(m)}finally{if(o)throw o.error}}const f=await r.getCount();n(`:: Reading '${e.title}' data :: ${Math.max(1,f-t.length)} - ${f}`),a()}),(async function(e){if(e)return console.error(e),o(e);s(r)}))}))}t.importData=async function({projectName:e,table:t,base:a,nocoBaseDataProcessing_v2:i,sDB:s,logDetailed:o=(e=>{}),logBasic:l=(e=>{}),services:p}){try{const m=await u({table:t,base:a,logDetailed:o,logBasic:l});return await new Promise((async(a,o)=>{const u=m.getStream(),f=await m.getCount(),h=[];let g=[],_=0,b=0,y=0;u.on("data",(async a=>{h.push(new Promise((async(o,m)=>{try{y++,y>=5&&u.pause();const{id:m}=a,h=n(a,["id"]),w=await i(s,t,{id:m,fields:h});if(g.push(w),b++,b>=c){if((0,r.default)(g)>=d){u.pause();let a=g.splice(0,g.length);await p.bulkDataService.bulkDataInsert({projectName:e,tableName:t.title,body:a,cookie:{},skip_hooks:!0}),l(`:: Importing '${t.title}' data :: ${_} - ${Math.min(_+a.length,f)}`),_+=a.length,a=[],u.resume()}b=0}y--,y<5&&u.resume(),o(!0)}catch(e){m(e)}})))})),u.on("end",(async()=>{try{await Promise.all(h),g.length>0&&(await p.bulkDataService.bulkDataInsert({projectName:e,tableName:t.id,body:g,cookie:{},skip_hooks:!0}),l(`:: Importing '${t.title}' data :: ${_} - ${Math.min(_+g.length,f)}`),_+=g.length,g=[]),a(!0)}catch(e){return o(e)}}))})),m}catch(e){return console.log(e),null}},t.importLTARData=async function({table:e,fields:t,base:a,projectName:s,insertedAssocRef:l={},logDetailed:p=(e=>{}),logBasic:m=(e=>{}),records:f,atNcAliasRef:h,ncLinkMappingTable:g,syncDB:_,services:b}){var y,w,v,T;const O=[],E=f||await u({table:e,fields:t,base:a,logDetailed:p,logBasic:m}),S=await b.tableService.getTableWithAccessibleViews({tableId:e.id,user:_.user});for(const e of S.columns){if(!(0,o.isLinksOrLTAR)(e.uidt)||e.colOptions.type!==o.RelationTypes.MANY_TO_MANY)continue;if(e.colOptions.fk_mm_model_id in l)continue;if(g.every((t=>t.nc.title!==e.title)))continue;l[e.colOptions.fk_mm_model_id]=!0;const t=await b.tableService.getTableWithAccessibleViews({tableId:e.colOptions.fk_mm_model_id,user:_.user});O.push({modelMeta:t,colMeta:e,curCol:t.columns.find((t=>t.id===e.colOptions.fk_mm_child_column_id)),refCol:t.columns.find((t=>t.id===e.colOptions.fk_mm_parent_column_id))})}let I=0;try{for(var k,C=!0,j=i(O);!(y=(k=await j.next()).done);){T=k.value,C=!1;try{const t=T;let a=[],i=0,o=0;await new Promise(((l,u)=>{const p=[],f=E.getStream();f.on("data",(async l=>{p.push(new Promise((async p=>{try{const{id:u}=l,g=n(l,["id"]);if(a.push(...((null==g?void 0:g[h[e.id][t.colMeta.title]])||[]).map((e=>({[t.curCol.title]:l.id,[t.refCol.title]:e})))),o++,o>=c){if((0,r.default)(a)>=d){f.pause();let n=a.splice(0,a.length);m(`:: Importing '${e.title}' LTAR data :: ${i} - ${Math.min(i+n.length,n.length)}`),await b.bulkDataService.bulkDataInsert({projectName:s,tableName:t.modelMeta.id,body:n,cookie:{},skip_hooks:!0}),i+=n.length,n=[],f.resume()}o=0}p(!0)}catch(e){u(e)}})))})),f.on("end",(async()=>{try{await Promise.all(p),a.length>=0&&(m(`:: Importing '${e.title}' LTAR data :: ${i} - ${Math.min(i+a.length,a.length)}`),await b.bulkDataService.bulkDataInsert({projectName:s,tableName:t.modelMeta.title,body:a,cookie:{},skip_hooks:!0}),i+=a.length,a=[]),l(!0)}catch(e){u(e)}}))})),I+=i}finally{C=!0}}}catch(e){w={error:e}}finally{try{C||y||!(v=j.return)||await v.call(j)}finally{if(w)throw w.error}}return I}},19997:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DuplicateController=void 0;const r=a(26481),l=a(68281),c=a(66310),d=a(68382),u=a(36701),p=a(15147),m=a(54123),f=a(26094);let h=class{constructor(e,t){this.jobsService=e,this.projectsService=t}async duplicateBase(e,t,a,i){const n=await p.Project.get(t);if(!n)throw new Error(`Project not found for id '${t}'`);const s=a?await p.Base.get(a):(await n.getBases())[0];if(!s)throw new Error("Base not found!");const o=await p.Project.list({}),r=(0,m.generateUniqueName)(`${n.title} copy`,o.map((e=>e.title))),c=await this.projectsService.projectCreate({project:Object.assign({title:r,status:l.ProjectStatus.JOB},i.project||{}),user:{id:e.user.id}});return{id:(await this.jobsService.add(f.JobTypes.DuplicateBase,{projectId:n.id,baseId:s.id,dupProjectId:c.id,options:i.options||{},req:{user:e.user,clientIp:e.clientIp}})).id,project_id:c.id}}async duplicateModel(e,t,a,i){const n=await p.Project.get(t);if(!n)throw new Error(`Project not found for id '${t}'`);const s=await p.Model.get(a);if(!s)throw new Error("Model not found!");const o=await p.Base.get(s.base_id),r=await o.getModels(),l=(0,m.generateUniqueName)(`${s.title} copy`,r.map((e=>e.title)));return{id:(await this.jobsService.add(f.JobTypes.DuplicateModel,{projectId:n.id,baseId:o.id,modelId:s.id,title:l,options:i.options||{},req:{user:e.user,clientIp:e.clientIp}})).id}}};n([(0,r.Post)("/api/v1/db/meta/duplicate/:projectId/:baseId?"),(0,r.HttpCode)(200),(0,d.Acl)("duplicateBase"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectId")),o(2,(0,r.Param)("baseId")),o(3,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],h.prototype,"duplicateBase",null),n([(0,r.Post)("/api/v1/db/meta/duplicate/:projectId/table/:modelId"),(0,r.HttpCode)(200),(0,d.Acl)("duplicateModel"),o(0,(0,r.Request)()),o(1,(0,r.Param)("projectId")),o(2,(0,r.Param)("modelId")),o(3,(0,r.Body)()),s("design:type",Function),s("design:paramtypes",[Object,String,String,Object]),s("design:returntype",Promise)],h.prototype,"duplicateModel",null),h=n([(0,r.Controller)(),(0,r.UseGuards)(c.GlobalGuard),o(0,(0,r.Inject)("JobsService")),s("design:paramtypes",[Object,"function"==typeof(i=void 0!==u.ProjectsService&&u.ProjectsService)?i:Object])],h),t.DuplicateController=h},61074:function(e,t,a){var i,n,s,o,r,l,c,d=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DuplicateProcessor=void 0;const m=a(12781),f=a(7010),h=a(37068),g=p(a(57153)),_=a(26481),b=a(68281),y=a(15147),w=a(36701),v=a(54123),T=a(69905),O=a(26094),E=a(17944),S=a(94352),I=a(29245);let k=i=class{constructor(e,t,a,n){this.exportService=e,this.importService=t,this.projectsService=a,this.bulkDataService=n,this.logger=new _.Logger(`${O.JOBS_QUEUE}:${i.name}`)}async duplicateBase(e){const t=(0,E.initTime)(),{projectId:a,baseId:i,dupProjectId:n,req:s,options:o}=e.data,r=(null==o?void 0:o.excludeData)||!1,l=(null==o?void 0:o.excludeHooks)||!1,c=(null==o?void 0:o.excludeViews)||!1,d=await y.Project.get(a),u=await y.Project.get(n),p=await y.Base.get(i);try{if(!d||!u||!p)throw new Error("Project or base not found!");const e=s.user,a=(await p.getModels()).filter((e=>e.base_id===p.id&&!e.mm&&"table"===e.type)),i=await this.exportService.serializeModels({modelIds:a.map((e=>e.id)),excludeViews:c,excludeHooks:l,excludeData:r});if((0,E.elapsedTime)(t,`serialize models schema for ${p.project_id}::${p.id}`,"duplicateBase"),!i)throw new Error(`Export failed for base '${p.id}'`);await u.getBases();const n=u.bases[0],o=await this.importService.importModels({user:e,projectId:u.id,baseId:n.id,data:i,req:s});if((0,E.elapsedTime)(t,"import models schema","duplicateBase"),!o)throw new Error(`Import failed for base '${p.id}'`);r||await this.importModelsData({idMap:o,sourceProject:d,sourceModels:a,destProject:u,destBase:n,hrTime:t}),await this.projectsService.projectUpdate({projectId:u.id,project:{status:null},user:s.user})}catch(e){throw(null==u?void 0:u.id)&&await this.projectsService.projectSoftDelete({projectId:u.id,user:s.user}),e}}async duplicateModel(e){const t=(0,E.initTime)(),{projectId:a,baseId:i,modelId:n,title:s,req:o,options:r}=e.data,l=(null==r?void 0:r.excludeData)||!1,c=(null==r?void 0:r.excludeHooks)||!1,d=(null==r?void 0:r.excludeViews)||!1,u=await y.Project.get(a),p=await y.Base.get(i),m=o.user,f=(await p.getModels()).filter((e=>!e.mm&&"table"===e.type)),h=f.find((e=>e.id===n));await h.getColumns();const g=h.columns.filter((e=>(0,b.isLinksOrLTAR)(e))).map((e=>e.colOptions.fk_related_model_id)).filter((e=>e)),_=f.filter((e=>g.includes(e.id))),w=(await this.exportService.serializeModels({modelIds:[n],excludeViews:d,excludeHooks:c,excludeData:l}))[0];if((0,E.elapsedTime)(t,`serialize model schema for ${n}`,"duplicateModel"),!w)throw new Error(`Export failed for base '${p.id}'`);w.model.title=s,w.model.table_name=s.toLowerCase().replace(/ /g,"_");const T=await this.importService.importModels({projectId:a,baseId:i,data:[w],user:m,req:o,externalModels:_});if((0,E.elapsedTime)(t,"import model schema","duplicateModel"),!T)throw new Error(`Import failed for model '${n}'`);if(!l){const e={};for(const t of _){const a=t.columns.filter((e=>(0,b.isLinksOrLTAR)(e)&&"bt"===e.colOptions.type&&e.colOptions.fk_related_model_id===n)).map((e=>e.id));a.length>0&&(e[t.id]=[t.primaryKey.id],e[t.id].push(...a))}await this.importModelsData({idMap:T,sourceProject:u,sourceModels:[h],destProject:u,destBase:p,hrTime:t,modelFieldIds:e,externalModels:_}),(0,E.elapsedTime)(t,"import model data","duplicateModel")}return await y.Model.get((0,v.findWithIdentifier)(T,h.id))}async importModelsData(e){const{idMap:t,sourceProject:a,sourceModels:i,destProject:n,destBase:s,hrTime:o,modelFieldIds:r,externalModels:l}=e;let c=[];for(const e of i){const i=new m.Readable({read(){}}),r=new m.Readable({read(){}});this.exportService.streamModelDataAsCsv({dataStream:i,linkStream:r,projectId:a.id,modelId:e.id,handledMmList:c});const l=await y.Model.get((0,v.findWithIdentifier)(t,e.id));await this.importService.importDataFromCsvStream({idMap:t,dataStream:i,destProject:n,destBase:s,destModel:l}),c=await this.importService.importLinkFromCsvStream({idMap:t,linkStream:r,destProject:n,destBase:s,handledLinks:c}),(0,E.elapsedTime)(o,`import data and links for ${l.title}`,"importModelsData")}if(l)for(const e of l){const i=null==r?void 0:r[e.id];if(!i)continue;const l=new m.Readable({read(){}}),d=new m.Readable({read(){}});this.exportService.streamModelDataAsCsv({dataStream:l,linkStream:d,projectId:a.id,modelId:e.id,handledMmList:c,_fieldIds:i});const u=[];let p=[];const f=await y.Model.get(e.id);await new Promise((e=>{g.default.parse(l,{newline:"\r\n",step:async(e,a)=>{var i;if(u.length){if(0===e.errors.length){const t={};for(let a=0;a<u.length;a++)u[a]&&""!==e.data[a]&&(t[u[a]]=e.data[a]);if(p.push(t),p.length>1e3){a.pause();try{await this.bulkDataService.bulkDataUpdate({projectName:n.id,tableName:f.id,body:p,cookie:null,raw:!0})}catch(e){this.logger.error(e)}p=[],a.resume()}}}else{a.pause();for(const a of e.data){const e=t.get(a);if(e){const t=await y.Column.get({base_id:s.id,colId:e});if(t)if("bt"===(null===(i=t.colOptions)||void 0===i?void 0:i.type)){const a=await y.Column.get({base_id:s.id,colId:t.colOptions.fk_child_column_id});a?u.push(a.column_name):(u.push(null),this.logger.error(`child column not found (${e})`))}else u.push(t.column_name);else u.push(null),this.logger.error(`column not found (${e})`)}else u.push(null),this.logger.error(`id not found (${a})`)}a.resume()}},complete:async()=>{if(p.length>0){try{await this.bulkDataService.bulkDataUpdate({projectName:n.id,tableName:f.id,body:p,cookie:null,raw:!0})}catch(e){this.logger.error(e)}p=[]}e(null)}})})),(0,E.elapsedTime)(o,`map existing links to ${f.title}`,"importModelsData")}}};d([(0,f.Process)(O.JobTypes.DuplicateBase),u("design:type",Function),u("design:paramtypes",["function"==typeof(l=void 0!==h.Job&&h.Job)?l:Object]),u("design:returntype",Promise)],k.prototype,"duplicateBase",null),d([(0,f.Process)(O.JobTypes.DuplicateModel),u("design:type",Function),u("design:paramtypes",["function"==typeof(c=void 0!==h.Job&&h.Job)?c:Object]),u("design:returntype",Promise)],k.prototype,"duplicateModel",null),k=i=d([(0,f.Processor)(O.JOBS_QUEUE),u("design:paramtypes",["function"==typeof(n=void 0!==S.ExportService&&S.ExportService)?n:Object,"function"==typeof(s=void 0!==I.ImportService&&I.ImportService)?s:Object,"function"==typeof(o=void 0!==w.ProjectsService&&w.ProjectsService)?o:Object,"function"==typeof(r=void 0!==T.BulkDataAliasService&&T.BulkDataAliasService)?r:Object])],k),t.DuplicateProcessor=k},94352:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExportService=void 0;const c=a(12781),d=a(68281),u=a(57153),p=a(26481),m=a(17944),f=l(a(19356)),h=a(7214),g=a(54123),_=l(a(70781)),b=a(51401),y=a(68349),w=a(15147);let v=i=class{constructor(e){this.datasService=e,this.logger=new p.Logger(i.name)}async serializeModels(e){const{modelIds:t}=e,a=(null==e?void 0:e.excludeData)||!1,i=(null==e?void 0:e.excludeViews)||!1,n=(null==e?void 0:e.excludeHooks)||!1,s=[],o=new Map,l=[],c=[],u=new Map;for(const e of t){const t=await w.Model.get(e);let p;if(!t)return b.NcError.badRequest(`Model not found for id '${e}'`);const m=l.find((e=>e.id===t.project_id)),h=m||await w.Project.get(t.project_id),_=c.find((e=>e.id===t.base_id)),y=_||await w.Base.get(t.base_id);m||l.push(h),_||c.push(y),u.has(y.id)||u.set(y.id,await(0,g.generateBaseIdMap)(y,o)),await t.getColumns(),await t.getViews(),i&&(t.views=t.views.filter((e=>e.is_default)));for(const e of t.columns){if(await e.getColOptions(),!a&&"pg"===y.type&&e.ai)try{const a=await f.default.getSqlClient(y),i=await a.knex.raw("SELECT pg_get_serial_sequence('??', ?) as seq;",[t.table_name,e.column_name]);if(i.rows.length>0){const e=i.rows[0].seq,t=await a.knex.raw(`SELECT last_value as last FROM ${e};`);t.rows.length>0&&(p=t.rows[0].last)}}catch(e){this.logger.error(e)}if(e.colOptions)for(const[t,a]of Object.entries(e.colOptions))switch(t){case"fk_mm_child_column_id":case"fk_mm_parent_column_id":case"fk_mm_model_id":case"fk_parent_column_id":case"fk_child_column_id":case"fk_related_model_id":case"fk_relation_column_id":case"fk_lookup_column_id":case"fk_rollup_column_id":e.colOptions[t]=o.get(a);break;case"options":for(const t of e.colOptions.options)delete t.id,delete t.fk_column_id;break;case"formula":e.colOptions[t]=e.colOptions[t].replace(/(?<=\{\{).*?(?=\}\})/gm,(e=>o.get(e)));break;case"id":case"created_at":case"updated_at":case"fk_column_id":delete e.colOptions[t]}}for(const e of t.views){if(o.set(e.id,`${o.get(t.id)}::${e.id}`),await e.getColumns(),await e.getFilters(),await e.getSorts(),e.filter){const t=[];for(const a of e.filter.children){const i={id:`${o.get(e.id)}::${a.id}`,fk_column_id:o.get(a.fk_column_id),fk_parent_id:a.fk_parent_id,is_group:a.is_group,logical_op:a.logical_op,comparison_op:a.comparison_op,comparison_sub_op:a.comparison_sub_op,value:a.value};i.is_group&&(delete i.comparison_op,delete i.comparison_sub_op,delete i.value),t.push(i)}e.filter.children=t}if(e.sorts){const t=[];for(const a of e.sorts){const e={fk_column_id:o.get(a.fk_column_id),direction:a.direction};t.push(e)}e.sorts=t}if(e.view)for(const[t,a]of Object.entries(e.view))switch(t){case"fk_column_id":case"fk_cover_image_col_id":case"fk_grp_col_id":e.view[t]=o.get(a);break;case"meta":if(e.type===d.ViewTypes.KANBAN){const t=JSON.parse(e.view.meta);for(const[e,a]of Object.entries(t)){const i=o.get(e);for(const e of a)e.fk_column_id=o.get(e.fk_column_id),delete e.id;t[i]=a,delete t[e]}e.view.meta=t}break;case"created_at":case"updated_at":case"fk_view_id":case"project_id":case"base_id":case"uuid":delete e.view[t]}}const v=[];if(!n){const e=await w.Hook.list({fk_model_id:t.id});for(const t of e){o.set(t.id,`${o.get(t.fk_model_id)}::${t.id}`);const e=await t.getFilters(),a=[];if(e)for(const i of e){const e={id:`${o.get(t.id)}::${i.id}`,fk_column_id:o.get(i.fk_column_id),fk_parent_id:i.fk_parent_id,is_group:i.is_group,logical_op:i.logical_op,comparison_op:i.comparison_op,comparison_sub_op:i.comparison_sub_op,value:i.value};e.is_group&&(delete e.comparison_op,delete e.comparison_sub_op,delete e.value),a.push(e)}v.push({id:o.get(t.id),title:t.title,active:t.active,condition:t.condition,event:t.event,operation:t.operation,notification:t.notification,version:t.version,filters:a})}}s.push({model:{id:o.get(t.id),prefix:h.prefix,title:t.title,table_name:(0,g.clearPrefix)(t.table_name,h.prefix),pgSerialLastVal:p,meta:t.meta,columns:t.columns.map((e=>({id:o.get(e.id),ai:e.ai,column_name:e.column_name,cc:e.cc,cdf:e.cdf,dt:e.dt,dtxp:e.dtxp,dtxs:e.dtxs,meta:e.meta,pk:e.pk,pv:e.pv,order:e.order,rqd:e.rqd,system:e.system,uidt:e.uidt,title:e.title,un:e.un,unique:e.unique,colOptions:e.colOptions})))},views:t.views.map((e=>({id:o.get(e.id),is_default:e.is_default,type:e.type,meta:e.meta,order:e.order,title:e.title,show:e.show,show_system_fields:e.show_system_fields,filter:e.filter,sorts:e.sorts,lock_type:e.lock_type,columns:e.columns.map((e=>{const t=e,{id:a,fk_view_id:i,fk_column_id:n,project_id:s,base_id:l,created_at:c,updated_at:d,uuid:u}=t,p=r(t,["id","fk_view_id","fk_column_id","project_id","base_id","created_at","updated_at","uuid"]);return Object.assign({fk_column_id:o.get(n)},p)})),view:e.view}))),hooks:v})}return s}async streamModelDataAsCsv(e){var t,a,i;const{dataStream:n,linkStream:s,handledMmList:o}=e,{model:r,view:l}=await(0,h.getViewAndModelByAliasOrId)({projectName:e.projectId,tableName:e.modelId,viewName:e.viewId}),c=await w.Base.get(r.base_id);await r.getColumns();const u=new Map;for(const t of r.columns.filter((e=>{var t;return e.uidt===d.UITypes.LinkToAnotherRecord&&"bt"===(null===(t=e.colOptions)||void 0===t?void 0:t.type)}))){await t.getColOptions();const a=r.columns.find((e=>{var a;return e.id===(null===(a=t.colOptions)||void 0===a?void 0:a.fk_child_column_id)}));if(a){if(e._fieldIds&&e._fieldIds.includes(t.id)){e._fieldIds.push(a.id);const i=e._fieldIds.indexOf(t.id);e._fieldIds.splice(i,1)}u.set(a.id,`${t.project_id}::${t.base_id}::${t.fk_model_id}::${t.id}`)}}const p=e._fieldIds?r.columns.filter((t=>{var a;return null===(a=e._fieldIds)||void 0===a?void 0:a.includes(t.id)})).map((e=>e.title)).join(","):r.columns.filter((e=>!(0,d.isLinksOrLTAR)(e))).map((e=>e.title)).join(","),m=r.columns.filter((e=>{var t;return(0,d.isLinksOrLTAR)(e)&&"mm"===(null===(t=e.colOptions)||void 0===t?void 0:t.type)})),g=m.length>0;n.setEncoding("utf8");const _=e=>{for(const t of e)for(const[e,a]of Object.entries(t)){const i=r.columns.find((t=>t.title===e));if(i){const n=`${i.project_id}::${i.base_id}::${i.fk_model_id}::${i.id}`;switch(i.uidt){case d.UITypes.ForeignKey:u.has(i.id)&&(t[u.get(i.id)]=a,delete t[e]);break;case d.UITypes.Attachment:try{t[n]=JSON.stringify(a)}catch(e){t[n]=a}break;case d.UITypes.Formula:case d.UITypes.Lookup:case d.UITypes.Rollup:case d.UITypes.Barcode:case d.UITypes.QrCode:break;default:t[n]=a}delete t[e]}}return{data:e}},b=await w.Model.getBaseModelSQL({id:r.id,viewId:null==l?void 0:l.id,dbDriver:await f.default.get(c)});try{await this.recursiveRead(_,b,n,r,l,0,200,p,!0)}catch(e){throw this.logger.error(e),e}if(g){s.setEncoding("utf8");for(const e of m){if(o.includes(null===(t=e.colOptions)||void 0===t?void 0:t.fk_mm_model_id))continue;const n=await w.Model.get(null===(a=e.colOptions)||void 0===a?void 0:a.fk_mm_model_id);await n.getColumns();const r=n.columns.find((t=>{var a;return t.id===(null===(a=e.colOptions)||void 0===a?void 0:a.fk_mm_child_column_id)})),l=n.columns.find((t=>{var a;return t.id===(null===(a=e.colOptions)||void 0===a?void 0:a.fk_mm_parent_column_id)})),u=r.title,p=l.title,m=n.columns.filter((e=>e.uidt===d.UITypes.ForeignKey)).map((e=>e.title)).join(","),h=t=>(t.map((t=>(t.column=e.id,t.child=t[u],t.parent=t[p],delete t[u],delete t[p],t))),{data:t}),g=200,_=0,b=n.base_id===c.id?c:await w.Base.get(n.base_id),y=await w.Model.getBaseModelSQL({id:n.id,dbDriver:await f.default.get(b)});try{await this.recursiveLinkRead(h,y,s,n,void 0,_,g,m,!0)}catch(e){throw this.logger.error(e),e}o.push(null===(i=e.colOptions)||void 0===i?void 0:i.fk_mm_model_id)}s.push(null)}else s.push(null)}async recursiveRead(e,t,a,i,n,s,o,r,l=!1){return new Promise(((c,d)=>{this.datasService.getDataList({model:i,view:n,query:{limit:o,offset:s,fields:r},baseModel:t}).then((p=>{try{l||a.push("\r\n");const{data:d}=e(p.list);a.push((0,u.unparse)(d,{header:l})),p.pageInfo.isLastPage?(a.push(null),c()):this.recursiveRead(e,t,a,i,n,s+o,o,r).then(c)}catch(e){d(e)}}))}))}async recursiveLinkRead(e,t,a,i,n,s,o,r,l=!1){return new Promise(((c,d)=>{this.datasService.getDataList({model:i,view:n,query:{limit:o,offset:s,fields:r},baseModel:t}).then((p=>{try{l||a.push("\r\n");const{data:d}=e(p.list);d&&a.push((0,u.unparse)(d,{header:l})),p.pageInfo.isLastPage?c():this.recursiveLinkRead(e,t,a,i,n,s+o,o,r).then(c)}catch(e){d(e)}}))}))}async exportBase(e){const t=(0,m.initTime)(),a=await w.Base.get(e.baseId);if(!a)throw b.NcError.badRequest(`Base not found for id '${e.baseId}'`);const i=await w.Project.get(a.project_id),n=(await a.getModels()).filter((e=>e.base_id===a.id&&!e.mm&&"table"===e.type)),s=await this.serializeModels({modelIds:n.map((e=>e.id))});(0,m.elapsedTime)(t,`serialize models for ${a.project_id}::${a.id}`,"exportBase");const o={id:`${i.id}::${a.id}`,models:s},r=await _.default.storageAdapter(),l=`export/${i.id}/${a.id}/${e.path}`;try{const e=new c.Readable({read(){}});e.setEncoding("utf8"),e.push(JSON.stringify(o)),e.push(null),await r.fileCreateByStream(`${l}/schema.json`,e);const s=[],d=new c.Readable({read(){}}),u=r.fileCreateByStream(`${l}/data/links.csv`,d);for(const e of n){const t=new c.Readable({read(){}}),a=new c.Readable({read(){}}),n=new Promise((e=>{a.on("data",(e=>{d.push(e)})),a.on("end",(()=>{d.push("\r\n"),e(null)})),a.on("error",(t=>{this.logger.error(t),e(null)}))})),o=r.fileCreateByStream(`${l}/data/${e.id}.csv`,t);this.streamModelDataAsCsv({dataStream:t,linkStream:a,projectId:i.id,modelId:e.id,handledMmList:s}),await Promise.all([o,n])}d.push(null),await u,(0,m.elapsedTime)(t,`export base ${a.project_id}::${a.id}`,"exportBase")}catch(e){throw b.NcError.badRequest(e)}return{path:l}}};v=i=s([(0,p.Injectable)(),o("design:paramtypes",["function"==typeof(n=void 0!==y.DatasService&&y.DatasService)?n:Object])],v),t.ExportService=v},29245:function(e,t,a){var i,n,s,o,r,l,c,d,u,p,m,f,h,g,_,b=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},w=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},v=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ImportService=void 0;const T=a(68281),O=a(26481),E=v(a(57153)),S=a(68281),I=a(17944),k=a(54123),C=a(51401),j=a(15147),x=a(19316),R=a(27695),A=a(3272),M=a(40330),N=a(58110),P=a(58946),L=a(74500),$=a(1180),q=a(42934),D=a(99155),U=a(12871),B=a(27556),F=a(430),V=v(a(70781)),G=a(69905),H=v(a(19356));let W=i=class{constructor(e,t,a,n,s,o,r,l,c,d,u,p,m,f){this.tablesService=e,this.columnsService=t,this.filtersService=a,this.sortsService=n,this.viewColumnsService=s,this.gridColumnsService=o,this.formColumnsService=r,this.gridsService=l,this.formsService=c,this.galleriesService=d,this.kanbansService=u,this.bulkDataService=p,this.hooksService=m,this.viewsService=f,this.logger=new O.Logger(i.name)}async importModels(e){var t,a,i,n,s,o,r,l,c,d,u,p,m,f;const h=(0,I.initTime)(),g=new Map,_=new Map,b=e=>g.get(e)||_.get(e),y=await j.Project.get(e.projectId);if(!y)return C.NcError.badRequest(`Project not found for id '${e.projectId}'`);const v=await j.Base.get(e.baseId);if(!v)return C.NcError.badRequest(`Base not found for id '${e.baseId}'`);const O=new Map,E=new Map;if(e.data=Array.isArray(e.data)?e.data:e.data.models,e.externalModels)for(const t of e.externalModels){_.set(`${t.project_id}::${t.base_id}::${t.id}`,t.id),await t.getColumns();const e=t.primaryKey;e&&g.set(`${t.project_id}::${t.base_id}::${t.id}::${e.id}`,e.id);for(const e of t.columns)_.set(`${t.project_id}::${t.base_id}::${t.id}::${e.id}`,e.id)}(0,I.elapsedTime)(h,"generate id map for external models","importModels");for(const t of e.data){const a=t.model,i=a.columns.filter((e=>!(0,S.isLinksOrLTAR)(e)&&e.uidt!==T.UITypes.Lookup&&e.uidt!==T.UITypes.Rollup&&e.uidt!==T.UITypes.Formula&&e.uidt!==T.UITypes.ForeignKey)),n=await this.tablesService.tableCreate({projectId:y.id,baseId:v.id,user:e.user,table:(0,k.withoutId)(Object.assign(Object.assign({},a),{columns:i.map((e=>(0,k.withoutId)(e)))}))});g.set(a.id,n.id);for(const e of n.columns){const t=a.columns.find((t=>t.column_name===e.column_name));if(g.set(t.id,e.id),"pg"===v.type&&a.pgSerialLastVal&&e.ai){const t=await H.default.getSqlClient(v);await t.knex.raw("SELECT setval(pg_get_serial_sequence('??', ?), ?);",[n.table_name,e.column_name,a.pgSerialLastVal])}}O.set(a.id,n)}(0,I.elapsedTime)(h,"create tables with static columns","importModels");const x=[];for(const p of e.data){const m=p.model,f=O.get(m.id),h=m.columns.filter((e=>(0,S.isLinksOrLTAR)(e)));for(const p of h)if(p.colOptions){const h=p.colOptions;if(g.has(h.fk_related_model_id)){if("mm"===h.type){if(!E.has(h.fk_mm_model_id)){delete p.column_name;const a=await this.columnsService.columnAdd({tableId:f.id,column:(0,k.withoutId)(Object.assign(Object.assign({},p),{parentId:b((0,k.getParentIdentifier)(h.fk_child_column_id)),childId:b((0,k.getParentIdentifier)(h.fk_parent_column_id)),type:h.type,virtual:h.virtual,ur:h.ur,dr:h.dr})),req:e.req,user:e.user});for(const e of a.columns)if(e.title===p.title){g.set(p.id,e.id),E.set(h.fk_mm_model_id,e.colOptions.fk_mm_model_id);break}const i=(0,k.getParentIdentifier)(h.fk_parent_column_id)===m.id?a:await j.Model.get(b((0,k.getParentIdentifier)(h.fk_parent_column_id)));(0,k.getParentIdentifier)(h.fk_parent_column_id)!==m.id&&await i.getColumns();const n=e.data.find((e=>e.model.id===(0,k.getParentIdentifier)(h.fk_parent_column_id))).model.columns.find((e=>{var t;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_mm_model_id)===h.fk_mm_model_id&&e.id!==p.id}));for(const a of i.columns)if((null===(t=null==a?void 0:a.colOptions)||void 0===t?void 0:t.fk_mm_model_id)===E.get(h.fk_mm_model_id)&&a.id!==b(p.id)){g.set(n.id,a.id),a.title!==n.title&&await this.columnsService.columnUpdate({columnId:a.id,column:Object.assign(Object.assign({},a),{column_name:n.title,title:n.title}),user:e.user});break}}}else if("hm"===h.type){delete p.column_name;const t=await this.columnsService.columnAdd({tableId:f.id,column:(0,k.withoutId)(Object.assign(Object.assign({},p),{parentId:b((0,k.getParentIdentifier)(h.fk_parent_column_id)),childId:b((0,k.getParentIdentifier)(h.fk_child_column_id)),type:h.type,virtual:h.virtual,ur:h.ur,dr:h.dr})),req:e.req,user:e.user});for(const e of t.columns)if(e.title===p.title){g.set(p.id,e.id),g.set(h.fk_parent_column_id,e.colOptions.fk_parent_column_id),g.set(h.fk_child_column_id,e.colOptions.fk_child_column_id);break}const n=h.fk_related_model_id===m.id?t:await j.Model.get(b(h.fk_related_model_id));h.fk_related_model_id!==m.id&&await n.getColumns();const s=e.data.find((e=>e.model.id===h.fk_related_model_id)).model.columns.find((e=>{var t,a;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_parent_column_id)===h.fk_parent_column_id&&(null===(a=e.colOptions)||void 0===a?void 0:a.fk_child_column_id)===h.fk_child_column_id&&e.id!==p.id}));for(const t of n.columns)if(t.id!==b(p.id)&&(null===(a=t.colOptions)||void 0===a?void 0:a.fk_parent_column_id)===b(h.fk_parent_column_id)&&(null===(i=t.colOptions)||void 0===i?void 0:i.fk_child_column_id)===b(h.fk_child_column_id)){g.set(s.id,t.id),t.title!==s.title&&await this.columnsService.columnUpdate({columnId:t.id,column:Object.assign(Object.assign({},t),{column_name:s.title,title:s.title}),user:e.user});break}}}else if(_.has(h.fk_related_model_id))if("mm"===h.type){if(!E.has(h.fk_mm_model_id)){delete p.column_name;const t=await this.columnsService.columnAdd({tableId:f.id,column:(0,k.withoutId)(Object.assign(Object.assign({},p),{parentId:b((0,k.getParentIdentifier)(h.fk_child_column_id)),childId:b((0,k.getParentIdentifier)(h.fk_parent_column_id)),type:h.type,virtual:h.virtual,ur:h.ur,dr:h.dr})),req:e.req,user:e.user});for(const e of t.columns)if(e.title===p.title){g.set(p.id,e.id),E.set(h.fk_mm_model_id,e.colOptions.fk_mm_model_id);break}const a=(0,k.getParentIdentifier)(h.fk_parent_column_id)===m.id?t:await j.Model.get(b((0,k.getParentIdentifier)(h.fk_parent_column_id)));(0,k.getParentIdentifier)(h.fk_parent_column_id)!==m.id&&await a.getColumns();const i=((null===(n=e.data.find((e=>e.model.id===(0,k.getParentIdentifier)(h.fk_parent_column_id))))||void 0===n?void 0:n.model)||e.externalModels.find((e=>e.id===(0,k.getEntityIdentifier)((0,k.getParentIdentifier)(h.fk_parent_column_id))))).columns.find((e=>{var t,a;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_mm_model_id)===h.fk_mm_model_id&&e.id!==p.id||(null===(a=e.colOptions)||void 0===a?void 0:a.fk_mm_model_id)===(0,k.getEntityIdentifier)(h.fk_mm_model_id)&&e.id!==(0,k.getEntityIdentifier)(p.id)}));for(const t of a.columns)if((null===(s=null==t?void 0:t.colOptions)||void 0===s?void 0:s.fk_mm_model_id)===E.get(h.fk_mm_model_id)&&t.id!==b(p.id)){i.id.includes("::")?g.set(i.id,t.id):g.set(`${i.project_id}::${i.base_id}::${i.fk_model_id}::${i.id}`,t.id),i.title=`${i.title} copy`,i.title=(0,k.generateUniqueName)(i.title,a.columns.map((e=>e.title))),t.title!==i.title&&await this.columnsService.columnUpdate({columnId:t.id,column:Object.assign(Object.assign({},t),{column_name:i.title,title:i.title}),user:e.user});break}}}else if("hm"===h.type){if(!E.has(`${h.fk_parent_column_id}::${h.fk_child_column_id}`)){delete p.column_name;const t=await this.columnsService.columnAdd({tableId:f.id,column:(0,k.withoutId)(Object.assign(Object.assign({},p),{parentId:b((0,k.getParentIdentifier)(h.fk_parent_column_id)),childId:b((0,k.getParentIdentifier)(h.fk_child_column_id)),type:h.type,virtual:h.virtual,ur:h.ur,dr:h.dr})),req:e.req,user:e.user});E.set(`${h.fk_parent_column_id}::${h.fk_child_column_id}`,`${h.fk_parent_column_id}::${h.fk_child_column_id}`);for(const e of t.columns)if(e.title===p.title){g.set(p.id,e.id),g.set(h.fk_parent_column_id,e.colOptions.fk_parent_column_id),g.set(h.fk_child_column_id,e.colOptions.fk_child_column_id);break}const a=h.fk_related_model_id===m.id?t:await j.Model.get(b(h.fk_related_model_id));h.fk_related_model_id!==m.id&&await a.getColumns();const i=((null===(o=e.data.find((e=>e.model.id===h.fk_related_model_id)))||void 0===o?void 0:o.model)||e.externalModels.find((e=>e.id===(0,k.getEntityIdentifier)(h.fk_related_model_id)))).columns.find((e=>{var t,a,i,n;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_parent_column_id)===h.fk_parent_column_id&&(null===(a=e.colOptions)||void 0===a?void 0:a.fk_child_column_id)===h.fk_child_column_id&&e.id!==p.id||(null===(i=e.colOptions)||void 0===i?void 0:i.fk_parent_column_id)===(0,k.getEntityIdentifier)(h.fk_parent_column_id)&&(null===(n=e.colOptions)||void 0===n?void 0:n.fk_child_column_id)===(0,k.getEntityIdentifier)(h.fk_child_column_id)&&e.id!==(0,k.getEntityIdentifier)(p.id)}));for(const t of a.columns)if(t.id!==b(p.id)&&(null===(r=t.colOptions)||void 0===r?void 0:r.fk_parent_column_id)===b(h.fk_parent_column_id)&&(null===(l=t.colOptions)||void 0===l?void 0:l.fk_child_column_id)===b(h.fk_child_column_id)){i.id.includes("::")?g.set(i.id,t.id):g.set(`${i.project_id}::${i.base_id}::${i.fk_model_id}::${i.id}`,t.id),i.title=`${i.title} copy`,i.title=(0,k.generateUniqueName)(i.title,a.columns.map((e=>e.title))),t.title!==i.title&&await this.columnsService.columnUpdate({columnId:t.id,column:Object.assign(Object.assign({},t),{column_name:i.title,title:i.title}),user:e.user});break}}}else if("bt"===h.type&&!E.has(`${h.fk_parent_column_id}::${h.fk_child_column_id}`)){delete p.column_name;const t=await this.columnsService.columnAdd({tableId:f.id,column:(0,k.withoutId)(Object.assign(Object.assign({},p),{parentId:b((0,k.getParentIdentifier)(h.fk_parent_column_id)),childId:b((0,k.getParentIdentifier)(h.fk_child_column_id)),type:h.type,virtual:h.virtual,ur:h.ur,dr:h.dr})),req:e.req,user:e.user});E.set(`${h.fk_parent_column_id}::${h.fk_child_column_id}`,`${h.fk_parent_column_id}::${h.fk_child_column_id}`);for(const e of t.columns)if(e.title===p.title){g.set(p.id,e.id),g.set(h.fk_parent_column_id,e.colOptions.fk_parent_column_id),g.set(h.fk_child_column_id,e.colOptions.fk_child_column_id);break}const a=h.fk_related_model_id===m.id?t:await j.Model.get(b(h.fk_related_model_id));h.fk_related_model_id!==m.id&&await a.getColumns();const i=((null===(c=e.data.find((e=>e.model.id===h.fk_related_model_id)))||void 0===c?void 0:c.model)||e.externalModels.find((e=>e.id===(0,k.getEntityIdentifier)(h.fk_related_model_id)))).columns.find((e=>{var t,a,i,n;return(null===(t=e.colOptions)||void 0===t?void 0:t.fk_parent_column_id)===h.fk_parent_column_id&&(null===(a=e.colOptions)||void 0===a?void 0:a.fk_child_column_id)===h.fk_child_column_id&&e.id!==p.id||(null===(i=e.colOptions)||void 0===i?void 0:i.fk_parent_column_id)===(0,k.getEntityIdentifier)(h.fk_parent_column_id)&&(null===(n=e.colOptions)||void 0===n?void 0:n.fk_child_column_id)===(0,k.getEntityIdentifier)(h.fk_child_column_id)&&e.id!==(0,k.getEntityIdentifier)(p.id)}));for(const t of a.columns)if(t.id!==b(p.id)&&(null===(d=t.colOptions)||void 0===d?void 0:d.fk_parent_column_id)===b(h.fk_parent_column_id)&&(null===(u=t.colOptions)||void 0===u?void 0:u.fk_child_column_id)===b(h.fk_child_column_id)){i.id.includes("::")?g.set(i.id,t.id):g.set(`${i.project_id}::${i.base_id}::${i.fk_model_id}::${i.id}`,t.id),i.title=`${i.title} copy`,i.title=(0,k.generateUniqueName)(i.title,a.columns.map((e=>e.title))),t.title!==i.title&&await this.columnsService.columnUpdate({columnId:t.id,column:Object.assign(Object.assign({},t),{column_name:i.title,title:i.title}),user:e.user});break}}}x.push(...m.columns.filter((e=>e.uidt===T.UITypes.Lookup||e.uidt===T.UITypes.Rollup||e.uidt===T.UITypes.Formula)))}(0,I.elapsedTime)(h,"create LTAR columns","importModels");const R=[];for(const e of x){const t=[];if((null===(p=e.colOptions)||void 0===p?void 0:p.fk_lookup_column_id)&&t.push(e.colOptions.fk_lookup_column_id),(null===(m=e.colOptions)||void 0===m?void 0:m.fk_rollup_column_id)&&t.push(e.colOptions.fk_rollup_column_id),null===(f=e.colOptions)||void 0===f?void 0:f.formula){const a=e.colOptions.formula.match(/(?<=\{\{).*?(?=\}\})/gm);a&&a.length>0&&t.push(...e.colOptions.formula.match(/(?<=\{\{).*?(?=\}\})/gm))}let a;for(let e=R.length-1;e>=0;e--)if(t.includes(R[e].id)){a=R[e];break}a?R.splice(R.indexOf(a)+1,0,e):R.unshift(e)}for(const t of R){const{colOptions:a}=t,i=w(t,["colOptions"]);if(t.uidt===T.UITypes.Lookup){if(!b(a.fk_relation_column_id))continue;const n=await this.columnsService.columnAdd({tableId:b((0,k.getParentIdentifier)(t.id)),column:(0,k.withoutId)(Object.assign(Object.assign({},i),{fk_lookup_column_id:b(a.fk_lookup_column_id),fk_relation_column_id:b(a.fk_relation_column_id)})),req:e.req,user:e.user});for(const e of n.columns)if(e.title===t.title){g.set(t.id,e.id);break}}else if(t.uidt===T.UITypes.Rollup){if(!b(a.fk_relation_column_id))continue;const n=await this.columnsService.columnAdd({tableId:b((0,k.getParentIdentifier)(t.id)),column:(0,k.withoutId)(Object.assign(Object.assign({},i),{fk_rollup_column_id:b(a.fk_rollup_column_id),fk_relation_column_id:b(a.fk_relation_column_id),rollup_function:a.rollup_function})),req:e.req,user:e.user});for(const e of n.columns)if(e.title===t.title){g.set(t.id,e.id);break}}else if(t.uidt===T.UITypes.Formula){const n=await this.columnsService.columnAdd({tableId:b((0,k.getParentIdentifier)(t.id)),column:(0,k.withoutId)(Object.assign(Object.assign({},i),{formula_raw:a.formula_raw})),req:e.req,user:e.user});for(const e of n.columns)if(e.title===t.title){g.set(t.id,e.id);break}}}(0,I.elapsedTime)(h,"create referenced columns","importModels");for(const t of e.data){const a=t.model,i=t.views,n=O.get(a.id);await n.getViews();for(const t of i){const a=(0,k.withoutId)(Object.assign({},t)),i=await this.createView(g,n,a,n.views,e.user);if(!i)continue;g.set(t.id,i.id);const s=t.filter.children;for(const t of s){const a=await this.filtersService.filterCreate({viewId:i.id,filter:(0,k.withoutId)(Object.assign(Object.assign({},t),{fk_column_id:b(t.fk_column_id),fk_parent_id:b(t.fk_parent_id)})),user:e.user});g.set(t.id,a.id)}for(const e of t.sorts)await this.sortsService.sortCreate({viewId:i.id,sort:(0,k.withoutId)(Object.assign(Object.assign({},e),{fk_column_id:b(e.fk_column_id)}))});const o=await this.viewColumnsService.columnList({viewId:i.id});for(const e of o){const a=t.columns.find((t=>t.fk_column_id===(0,k.reverseGet)(g,e.fk_column_id)));a&&await this.viewColumnsService.columnUpdate({viewId:i.id,columnId:e.id,column:{show:a.show,order:a.order}})}switch(i.type){case T.ViewTypes.GRID:for(const e of o){const a=t.columns.find((t=>t.fk_column_id===(0,k.reverseGet)(g,e.fk_column_id)));if(!a)continue;const{fk_column_id:i}=a,n=w(a,["fk_column_id"]);await this.gridColumnsService.gridColumnUpdate({gridViewColumnId:e.id,grid:Object.assign({},(0,k.withoutNull)(n))})}break;case T.ViewTypes.FORM:for(const e of o){const a=t.columns.find((t=>t.fk_column_id===(0,k.reverseGet)(g,e.fk_column_id)));if(!a)continue;const{fk_column_id:i}=a,n=w(a,["fk_column_id"]);await this.formColumnsService.columnUpdate({formViewColumnId:e.id,formViewColumn:Object.assign({},(0,k.withoutNull)(n))})}case T.ViewTypes.GALLERY:case T.ViewTypes.KANBAN:}t.order!==i.order&&await this.viewsService.viewUpdate({viewId:i.id,view:{order:t.order},user:e.user})}}(0,I.elapsedTime)(h,"create views","importModels");for(const t of e.data){if(!(null==t?void 0:t.hooks))break;const a=t.model,i=t.hooks,n=O.get(a.id);for(const t of i){const{filters:a}=t,i=w(t,["filters"]),s=(0,k.withoutId)(Object.assign({},i)),o=await this.hooksService.hookCreate({tableId:n.id,hook:Object.assign({},s)});if(o){g.set(t.id,o.id);for(const t of a){const a=await this.filtersService.hookFilterCreate({hookId:o.id,filter:(0,k.withoutId)(Object.assign(Object.assign({},t),{fk_column_id:b(t.fk_column_id),fk_parent_id:b(t.fk_parent_id)})),user:e.user});g.set(t.id,a.id)}}}}return(0,I.elapsedTime)(h,"create hooks","importModels"),g}async createView(e,t,a,i,n){if(a.is_default){const e=i.find((e=>e.is_default));if(e){const t=(0,k.withoutNull)(a.view);t&&await this.gridsService.gridViewUpdate({viewId:e.id,grid:t})}return e}switch(a.type){case T.ViewTypes.GRID:{const e=await this.gridsService.gridViewCreate({tableId:t.id,grid:a}),i=(0,k.withoutNull)(a.view);return i&&await this.gridsService.gridViewUpdate({viewId:e.id,grid:i}),e}case T.ViewTypes.FORM:{const e=await this.formsService.formViewCreate({tableId:t.id,body:a,user:n}),i=(0,k.withoutNull)(a.view);return i&&await this.formsService.formViewUpdate({formViewId:e.id,form:i}),e}case T.ViewTypes.GALLERY:{const i=await this.galleriesService.galleryViewCreate({tableId:t.id,gallery:a,user:n}),s=(0,k.withoutNull)(a.view);if(s){for(const[t,a]of Object.entries(s))if("fk_cover_image_col_id"===t)s[t]=e.get(a);await this.galleriesService.galleryViewUpdate({galleryViewId:i.id,gallery:s})}return i}case T.ViewTypes.KANBAN:{const i=await this.kanbansService.kanbanViewCreate({tableId:t.id,kanban:a,user:n}),s=(0,k.withoutNull)(a.view);if(s){const a=await j.Column.get({base_id:t.base_id,colId:e.get(s.fk_grp_col_id)});for(const[t,i]of Object.entries(s))switch(t){case"fk_grp_col_id":case"fk_cover_image_col_id":s[t]=e.get(i);break;case"meta":{const n={};for(const[t,s]of Object.entries(i)){const i=[];for(const t of s)if(t.fk_column_id){const n=a.colOptions.options.find((e=>e.title===t.title)).id;i.push(Object.assign(Object.assign({},t),{fk_column_id:e.get(t.fk_column_id),id:n}))}else delete t.fk_column_id,i.push(Object.assign(Object.assign({},t),{id:"uncategorized"}));n[e.get(t)]=i}s[t]=n;break}}await this.kanbansService.kanbanViewUpdate({kanbanViewId:i.id,kanban:s})}return i}}return null}async importBase(e){const t=(0,I.initTime)(),{user:a,projectId:i,baseId:n,src:s,req:o}=e,r=await j.Project.get(i),l=await j.Base.get(n);if(!r||!l)throw C.NcError.badRequest("Project or Base not found");switch(s.type){case"local":{const e=s.path.replace(/\/$/,""),c=await V.default.storageAdapter();try{const s=JSON.parse(await c.fileRead(`${e}/schema.json`));(0,I.elapsedTime)(t,"read schema from file","importBase");let d=[];const u=await this.importModels({user:a,projectId:i,baseId:n,data:s,req:o});if((0,I.elapsedTime)(t,"import models schema","importBase"),u){const a=(await c.getDirectoryList(`${e}/data`)).filter((e=>!e.match(/links\.csv$/))),i=`${e}/data/links.csv`;for(const i of a){const a=await c.fileReadByStream(`${e}/data/${i}`),n=(0,k.findWithIdentifier)(u,i.replace(/\.csv$/,"")),s=await j.Model.get(n);this.logger.debug(`Importing ${s.title}...`),await this.importDataFromCsvStream({idMap:u,dataStream:a,destProject:r,destBase:l,destModel:s}),(0,I.elapsedTime)(t,`import data for ${s.title}`,"importBase")}(0,I.elapsedTime)(t);const n=await c.fileReadByStream(i);d=await this.importLinkFromCsvStream({idMap:u,linkStream:n,destProject:r,destBase:l,handledLinks:d}),(0,I.elapsedTime)(t,"import links","importBase")}}catch(e){throw new Error(e)}break}}}importDataFromCsvStream(e){const{idMap:t,dataStream:a,destBase:i,destProject:n,destModel:s}=e,o=[];let r=[];return new Promise((e=>{E.default.parse(a,{newline:"\r\n",step:async(e,a)=>{var l;if(o.length){if(0===e.errors.length){const t={};for(let a=0;a<o.length;a++)o[a]&&""!==e.data[a]&&(t[o[a]]=e.data[a]);if(r.push(t),r.length>1e3){a.pause();try{await this.bulkDataService.bulkDataInsert({projectName:n.id,tableName:s.id,body:r,cookie:null,chunkSize:r.length+1,foreign_key_checks:!!i.isMeta(),raw:!0})}catch(e){this.logger.error(e)}r=[],a.resume()}}}else{a.pause();for(const a of e.data){const e=t.get(a);if(e){const t=await j.Column.get({base_id:i.id,colId:e});if(t)if("bt"===(null===(l=t.colOptions)||void 0===l?void 0:l.type)){const e=await j.Column.get({base_id:i.id,colId:t.colOptions.fk_child_column_id});e?o.push(e.column_name):(o.push(null),this.logger.error(`child column not found (${t.colOptions.fk_child_column_id})`))}else o.push(t.column_name);else o.push(null),this.logger.error(`column not found (${e})`)}else o.push(null),this.logger.error(`id not found (${a})`)}a.resume()}},complete:async()=>{if(r.length>0){try{await this.bulkDataService.bulkDataInsert({projectName:n.id,tableName:s.id,body:r,cookie:null,chunkSize:r.length+1,foreign_key_checks:!!i.isMeta(),raw:!0})}catch(e){this.logger.error(e)}r=[]}e(null)}})}))}async importLinkFromCsvStream(e){const{idMap:t,linkStream:a,destBase:i,destProject:n,handledLinks:s}=e,o={},r=async()=>{for(const[e,t]of Object.entries(o))try{if(0===t.length)continue;await this.bulkDataService.bulkDataInsert({projectName:n.id,tableName:e,body:t,cookie:null,chunkSize:1e3,foreign_key_checks:!!i.isMeta(),raw:!0}),o[e]=[]}catch(e){this.logger.error(e)}};let l=!1,c=-1,d=-1,u=-1;const p={},m={};return new Promise((e=>{E.default.parse(a,{newline:"\r\n",step:async(e,a)=>{if(l){if(0===e.errors.length){const n=e.data[c],l=e.data[d],f=e.data[u];if(n&&l&&f)if(p[f]){const e=p[f].colOptions.fk_mm_model_id,t=m[e];o[e].push({[t.parent]:l,[t.child]:n})}else{a.pause(),await r();const e=await j.Column.get({base_id:i.id,colId:(0,k.findWithIdentifier)(t,f)});if(e){const t=await e.getColOptions(),a=await t.getMMChildColumn(),i=await t.getMMParentColumn();m[e.colOptions.fk_mm_model_id]={parent:i.column_name,child:a.column_name},p[f]=e,s.push(e.colOptions.fk_mm_model_id);const r=e.colOptions.fk_mm_model_id;o[r]=[];const c=m[r];o[r].push({[c.parent]:l,[c.child]:n})}else this.logger.error(`column not found (${f})`);a.resume()}}}else{for(const[t,a]of Object.entries(e.data))"child"===a?c=parseInt(t):"parent"===a?d=parseInt(t):"column"===a&&(u=parseInt(t));l=!0}},complete:async()=>{await r(),e(s)}})}))}};W=i=b([(0,O.Injectable)(),y("design:paramtypes",["function"==typeof(n=void 0!==x.TablesService&&x.TablesService)?n:Object,"function"==typeof(s=void 0!==R.ColumnsService&&R.ColumnsService)?s:Object,"function"==typeof(o=void 0!==A.FiltersService&&A.FiltersService)?o:Object,"function"==typeof(r=void 0!==M.SortsService&&M.SortsService)?r:Object,"function"==typeof(l=void 0!==N.ViewColumnsService&&N.ViewColumnsService)?l:Object,"function"==typeof(c=void 0!==P.GridColumnsService&&P.GridColumnsService)?c:Object,"function"==typeof(d=void 0!==L.FormColumnsService&&L.FormColumnsService)?d:Object,"function"==typeof(u=void 0!==$.GridsService&&$.GridsService)?u:Object,"function"==typeof(p=void 0!==q.FormsService&&q.FormsService)?p:Object,"function"==typeof(m=void 0!==D.GalleriesService&&D.GalleriesService)?m:Object,"function"==typeof(f=void 0!==U.KanbansService&&U.KanbansService)?f:Object,"function"==typeof(h=void 0!==G.BulkDataAliasService&&G.BulkDataAliasService)?h:Object,"function"==typeof(g=void 0!==B.HooksService&&B.HooksService)?g:Object,"function"==typeof(_=void 0!==F.ViewsService&&F.ViewsService)?_:Object])],W),t.ImportService=W},24610:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsLogService=void 0;const o=a(26481),r=a(47020),l=a(26094);let c=class{constructor(e){this.eventEmitter=e}sendLog(e,t){this.eventEmitter.emit(l.JobEvents.LOG,{id:e.id.toString(),data:t})}};c=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==r.EventEmitter2&&r.EventEmitter2)?i:Object])],c),t.JobsLogService=c},30132:function(e,t,a){var i,n,s,o,r,l,c=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsEventService=void 0;const p=a(7010),m=a(37068),f=u(a(55634)),h=a(47020),g=a(73073),_=a(26094);let b=class{constructor(e,t){this.jobsRedisService=e,this.eventEmitter=t}onActive(e){"true"===process.env.NC_WORKER_CONTAINER?this.jobsRedisService.publish(`jobs-${e.id.toString()}`,{cmd:_.JobEvents.STATUS,id:e.id.toString(),status:_.JobStatus.ACTIVE}):this.eventEmitter.emit(_.JobEvents.STATUS,{id:e.id.toString(),status:_.JobStatus.ACTIVE})}onFailed(e,t){console.error((0,f.default)(`---- !! JOB FAILED !! ----\nid:${e.id}\nerror:${t.name} (${t.message})\n\nstack: ${t.stack}`,{padding:1,borderStyle:"double",borderColor:"yellow"})),"true"===process.env.NC_WORKER_CONTAINER?this.jobsRedisService.publish(`jobs-${e.id.toString()}`,{cmd:_.JobEvents.STATUS,id:e.id.toString(),status:_.JobStatus.FAILED,data:{error:{message:null==t?void 0:t.message}}}):(this.jobsRedisService.unsubscribe(`jobs-${e.id.toString()}`),this.eventEmitter.emit(_.JobEvents.STATUS,{id:e.id.toString(),status:_.JobStatus.FAILED,data:{error:{message:null==t?void 0:t.message}}}))}onCompleted(e,t){"true"===process.env.NC_WORKER_CONTAINER?this.jobsRedisService.publish(`jobs-${e.id.toString()}`,{cmd:_.JobEvents.STATUS,id:e.id.toString(),status:_.JobStatus.COMPLETED,data:{result:t}}):(this.jobsRedisService.unsubscribe(`jobs-${e.id.toString()}`),this.eventEmitter.emit(_.JobEvents.STATUS,{id:e.id.toString(),status:_.JobStatus.COMPLETED,data:{result:t}}))}onLog(e){"true"===process.env.NC_WORKER_CONTAINER&&this.jobsRedisService.publish(`jobs-${e.id}`,{cmd:_.JobEvents.LOG,id:e.id,data:e.data})}};c([(0,p.OnQueueActive)(),d("design:type",Function),d("design:paramtypes",["function"==typeof(s=void 0!==m.Job&&m.Job)?s:Object]),d("design:returntype",void 0)],b.prototype,"onActive",null),c([(0,p.OnQueueFailed)(),d("design:type",Function),d("design:paramtypes",["function"==typeof(o=void 0!==m.Job&&m.Job)?o:Object,"function"==typeof(r="undefined"!=typeof Error&&Error)?r:Object]),d("design:returntype",void 0)],b.prototype,"onFailed",null),c([(0,p.OnQueueCompleted)(),d("design:type",Function),d("design:paramtypes",["function"==typeof(l=void 0!==m.Job&&m.Job)?l:Object,Object]),d("design:returntype",void 0)],b.prototype,"onCompleted",null),c([(0,h.OnEvent)(_.JobEvents.LOG),d("design:type",Function),d("design:paramtypes",[Object]),d("design:returntype",void 0)],b.prototype,"onLog",null),b=c([(0,p.Processor)(_.JOBS_QUEUE),d("design:paramtypes",["function"==typeof(i=void 0!==g.JobsRedisService&&g.JobsRedisService)?i:Object,"function"==typeof(n=void 0!==h.EventEmitter2&&h.EventEmitter2)?n:Object])],b),t.JobsEventService=b},73073:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsRedisService=void 0;const o=a(26481),r=s(a(41495));let l=class{constructor(){this.unsubscribeCallbacks={},"true"!==process.env.NC_WORKER_CONTAINER?this.redisSubscriber=new r.default(process.env.NC_REDIS_JOB_URL):this.redisClient=new r.default(process.env.NC_REDIS_JOB_URL)}publish(e,t){if("string"==typeof t)this.redisClient.publish(e,t);else try{this.redisClient.publish(e,JSON.stringify(t))}catch(e){console.error(e)}}subscribe(e,t){this.redisSubscriber.subscribe(e);const a=(e,a)=>{try{a=JSON.parse(a)}catch(e){}t(a)};this.redisSubscriber.on("message",a),this.unsubscribeCallbacks[e]=()=>{this.redisSubscriber.unsubscribe(e),this.redisSubscriber.off("message",a)}}unsubscribe(e){this.unsubscribeCallbacks[e]&&(this.unsubscribeCallbacks[e](),delete this.unsubscribeCallbacks[e])}};l=i([(0,o.Injectable)(),n("design:paramtypes",[])],l),t.JobsRedisService=l},6207:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.JobsService=void 0;const c=a(7010),d=a(26481),u=a(37068),p=a(47020),m=a(73073),f=a(26094);let h=class{constructor(e,t,a){this.jobsQueue=e,this.jobsRedisService=t,this.eventEmitter=a}async onModuleInit(){"true"!==process.env.NC_WORKER_CONTAINER&&await this.jobsQueue.pause(!0)}async add(e,t){const a=(await this.jobsQueue.getWorkers()).length,i=await this.jobsQueue.isPaused(!0);a<1&&i?await this.jobsQueue.resume(!0):a>0&&!i&&await this.jobsQueue.pause(!0);const n=await this.jobsQueue.add(e,t);return this.jobsRedisService.subscribe(`jobs-${n.id.toString()}`,(e=>{const t=e.cmd;switch(delete e.cmd,t){case f.JobEvents.STATUS:this.eventEmitter.emit(f.JobEvents.STATUS,e),[f.JobStatus.COMPLETED,f.JobStatus.FAILED].includes(e.status)&&this.jobsRedisService.unsubscribe(`jobs-${e.id.toString()}`);break;case f.JobEvents.LOG:this.eventEmitter.emit(f.JobEvents.LOG,e)}})),n}async jobStatus(e){const t=await this.jobsQueue.getJob(e);if(t)return await t.getState()}async jobList(){return await this.jobsQueue.getJobs([f.JobStatus.ACTIVE,f.JobStatus.WAITING,f.JobStatus.DELAYED,f.JobStatus.PAUSED])}async getJobWithData(e){return(await this.jobsQueue.getJobs([f.JobStatus.WAITING,f.JobStatus.ACTIVE,f.JobStatus.DELAYED,f.JobStatus.PAUSED])).find((t=>{for(const a in e){if(!t.data[a])return!1;if(t.data[a]!==e[a])return!1}return!0}))}};h=o([(0,d.Injectable)(),l(0,(0,c.InjectQueue)(f.JOBS_QUEUE)),r("design:paramtypes",["function"==typeof(i=void 0!==u.Queue&&u.Queue)?i:Object,"function"==typeof(n=void 0!==m.JobsRedisService&&m.JobsRedisService)?n:Object,"function"==typeof(s=void 0!==p.EventEmitter2&&p.EventEmitter2)?s:Object])],h),t.JobsService=h},60191:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetasModule=t.metaModuleMetadata=void 0;const s=a(26481),o=a(36188),r=n(a(1738)),l=a(55037),c=a(94647),d=a(55213),u=a(46909),p=a(42694),m=a(43735),f=a(32235),h=a(72550),g=a(52868),_=a(90083),b=a(976),y=a(17822),w=a(62421),v=a(58858),T=a(9886),O=a(44610),E=a(49310),S=a(71604),I=a(68531),k=a(16450),C=a(23858),j=a(78609),x=a(90313),R=a(46202),A=a(76691),M=a(2465),N=a(28332),P=a(85370),L=a(88062),$=a(15387),q=a(65697),D=a(71423),U=a(49146),B=a(46460),F=a(76696),V=a(82897),G=a(45239),H=a(69905),W=a(35987),z=a(27695),J=a(3272),K=a(74500),Y=a(42934),X=a(99155),Q=a(58946),Z=a(1180),ee=a(27556),te=a(12871),ae=a(55536),ie=a(80181),ne=a(97982),se=a(73451),oe=a(57909),re=a(7950),le=a(23481),ce=a(59540),de=a(36701),ue=a(47258),pe=a(27744),me=a(40330),fe=a(94163),he=a(19316),ge=a(49313),_e=a(58110),be=a(430),ye=a(67259),we=a(52392),ve=a(95524),Te=a(79689),Oe=a(7688),Ee=a(67184);t.metaModuleMetadata={imports:[o.MulterModule.register({storage:r.default.diskStorage({}),limits:{fieldSize:c.NC_ATTACHMENT_FIELD_SIZE}}),(0,s.forwardRef)((()=>l.GlobalModule))],controllers:[..."true"!==process.env.NC_WORKER_CONTAINER?[d.ApiDocsController,u.ApiTokensController,p.AttachmentsController,m.AuditsController,f.BasesController,h.CachesController,g.ColumnsController,_.FiltersController,b.FormColumnsController,y.FormsController,w.GalleriesController,v.GridColumnsController,T.GridsController,O.HooksController,E.KanbansController,S.MapsController,I.MetaDiffsController,k.ModelVisibilitiesController,C.OrgLcenseController,j.OrgTokensController,x.OrgUsersController,R.PluginsController,we.ProjectUsersController,A.ProjectsController,M.PublicMetasController,U.ViewsController,D.ViewColumnsController,q.UtilsController,$.TablesController,L.SyncController,P.SortsController,N.SharedBasesController,Oe.NotificationsController]:[]],providers:[ye.ApiDocsService,B.ApiTokensService,F.AttachmentsService,V.AuditsService,G.BasesService,W.CachesService,z.ColumnsService,J.FiltersService,K.FormColumnsService,Y.FormsService,X.GalleriesService,Q.GridColumnsService,Z.GridsService,ee.HooksService,te.KanbansService,ae.MapsService,ie.MetaDiffsService,ne.ModelVisibilitiesService,se.OrgLcenseService,oe.OrgTokensEeService,re.OrgTokensService,le.OrgUsersService,ve.ProjectUsersService,ce.PluginsService,ve.ProjectUsersService,de.ProjectsService,ue.PublicMetasService,be.ViewsService,_e.ViewColumnsService,ge.UtilsService,he.TablesService,fe.SyncService,me.SortsService,pe.SharedBasesService,H.BulkDataAliasService,Te.NotificationsService,Ee.NotificationsGateway],exports:[he.TablesService,z.ColumnsService,J.FiltersService,me.SortsService,be.ViewsService,_e.ViewColumnsService,Z.GridsService,Q.GridColumnsService,Y.FormsService,K.FormColumnsService,X.GalleriesService,te.KanbansService,de.ProjectsService,F.AttachmentsService,ve.ProjectUsersService,ee.HooksService]};let Se=class{};Se=i([(0,s.Module)(t.metaModuleMetadata)],Se),t.MetasModule=Se},9551:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.TestModule=void 0;const n=a(26481),s=a(31354);let o=class{};o=i([(0,n.Module)({controllers:[..."true"!==process.env.NC_WORKER_CONTAINER?[s.TestController]:[]]})],o),t.TestModule=o},76670:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersModule=void 0;const n=a(26481),s=a(24340),o=a(36234),r=a(55037),l=a(1119),c=a(17882),d=a(60191);let u=class{};u=i([(0,n.Module)({imports:[(0,n.forwardRef)((()=>r.GlobalModule)),s.PassportModule,(0,n.forwardRef)((()=>d.MetasModule))],controllers:[..."true"!==process.env.NC_WORKER_CONTAINER?[c.UsersController]:[]],providers:[l.UsersService,o.GoogleStrategyProvider],exports:[l.UsersService]})],u),t.UsersModule=u},48138:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=i(a(29336)),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){const a={ACL:"public-read",ContentType:t.mimetype};return new Promise(((i,s)=>{const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),s(e)})),a.Body=o,a.Key=e,this.s3Client.upload(a,((e,t)=>{e&&(console.log("Error",e),s(e)),t&&i(t.Location)}))}))}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{if(t)return n(t);a.Body=o,a.Key=e,a.ContentType=s.headers["content-type"],this.s3Client.upload(a,((e,a)=>{t&&(console.log("Error",t),n(e)),a&&i(a.Location)}))}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}patchRegion(e){return e.startsWith("s3.")&&(e=e.slice(3)),e}async fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){return new Promise(((t,a)=>{this.s3Client.getObject({Key:e},((e,i)=>e?a(e):(null==i?void 0:i.Body)?t(i.Body):a(i)))}))}async init(){const e={params:{Bucket:this.input.bucket},region:this.patchRegion(this.input.region)};e.accessKeyId=this.input.access_key,e.secretAccessKey=this.input.access_secret,e.endpoint=new o.default.Endpoint(`s3.${e.region}.backblazeb2.com`),this.s3Client=new o.default.S3(e)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}}},13359:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(48138));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},69017:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(13359)).default,title:"Backblaze B2",version:"0.0.2",logo:"plugins/backblaze.jpeg",tags:"Storage",description:"Backblaze B2 is enterprise-grade, S3 compatible storage that companies around the world use to store and serve data while improving their cloud OpEx vs. Amazon S3 and others.",inputs:{title:"Configure Backblaze B2",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"e.g. us-west-001",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"i.e. keyID in App Keys",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"i.e. applicationKey in App Keys",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in Backblaze B2",msgOnUninstall:""},category:"Storage"};t.default=s},71481:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(52167));t.default=class{init(){return Promise.resolve(void 0)}async sendMessage(e,t){for(const{webhook_url:a}of null==t?void 0:t.channels)try{return await n.default.post(a,{content:e})}catch(e){throw console.log(e),e}}}},60505:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(71481));class o extends n.XcWebhookNotificationPlugin{getAdapter(){return o.notificationAdapter}async init(e){o.notificationAdapter=new s.default,await o.notificationAdapter.init()}}t.default=o},5259:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(60505)).default,title:"Discord",version:"0.0.1",logo:"plugins/discord.png",description:"Discord is the easiest way to talk over voice, video, and text. Talk, chat, hang out, and stay close with your friends and communities.",price:"Free",tags:"Chat",category:"Chat",inputs:{title:"Configure Discord",array:!0,items:[{key:"channel",label:"Channel Name",placeholder:"Channel Name",type:n.XcType.SingleLineText,required:!0},{key:"webhook_url",label:"Webhook URL",type:n.XcType.Password,placeholder:"Webhook URL",required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and Discord is enabled for notification.",msgOnUninstall:""}};t.default=s},92237:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=a(76685),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){return(await this.storageClient.bucket(this.bucketName).upload(t.path,{destination:e,gzip:!0,metadata:{cacheControl:"public, max-age=31536000"}}))[0].publicUrl()}fileDelete(e){return Promise.resolve(void 0)}fileRead(e){return new Promise(((t,a)=>{const i=this.storageClient.bucket(this.bucketName).file(e);i.exists(((e,n)=>{n?i.download(((i,n)=>e?a(i):t(n))):a(e)}))}))}async init(){const e={};e.credentials={client_email:this.input.client_email,private_key:this.input.private_key.replace(/\\n/gm,"\n")},this.input.project_id&&(e.projectId=this.input.project_id),this.bucketName=this.input.bucket,this.storageClient=new o.Storage(e)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}fileCreateByUrl(e,t){return new Promise(((a,i)=>{(0,r.default)({url:t,encoding:null},((t,n,s)=>{if(t)return i(t);this.storageClient.bucket(this.bucketName).file(e).save(s).then((e=>a(e))).catch(i)}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}}},37972:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(92237));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},12490:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(37972)).default,title:"GCS",version:"0.0.2",logo:"plugins/gcs.png",description:"Google Cloud Storage is a RESTful online file storage web service for storing and accessing data on Google Cloud Platform infrastructure.",price:"Free",tags:"Storage",category:"Storage",inputs:{title:"Configure Google Cloud Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"client_email",label:"Client Email",placeholder:"Client Email",type:n.XcType.SingleLineText,required:!0},{key:"private_key",label:"Private Key",placeholder:"Private Key",type:n.XcType.Password,required:!0},{key:"project_id",label:"Project ID",placeholder:"Project ID",type:n.XcType.SingleLineText,required:!1}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in Google Cloud Storage",msgOnUninstall:""}};t.default=s},65518:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=i(a(29336)),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){const a={ACL:"public-read",ContentType:t.mimetype};return new Promise(((i,s)=>{const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),s(e)})),a.Body=o,a.Key=e,this.s3Client.upload(a,((e,t)=>{e&&(console.log("Error",e),s(e)),t&&i(t.Location)}))}))}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{if(t)return n(t);a.Body=o,a.Key=e,a.ContentType=s.headers["content-type"],this.s3Client.upload(a,((e,a)=>{t&&(console.log("Error",t),n(e)),a&&i(a.Location)}))}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}async fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){return new Promise(((t,a)=>{this.s3Client.getObject({Key:e},((e,i)=>e?a(e):(null==i?void 0:i.Body)?t(i.Body):a(i)))}))}async init(){const e={params:{Bucket:this.input.bucket},region:this.input.region};e.accessKeyId=this.input.access_key,e.secretAccessKey=this.input.access_secret,e.endpoint=new o.default.Endpoint(`${this.input.region}.linodeobjects.com`),this.s3Client=new o.default.S3(e)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}}},75339:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(65518));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},3701:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(75339)).default,title:"Linode Object Storage",version:"0.0.1",logo:"plugins/linode.svg",tags:"Storage",description:"S3-compatible Linode Object Storage makes it easy and more affordable to manage unstructured data such as content assets, as well as sophisticated and data-intensive storage challenges around artificial intelligence and machine learning.",inputs:{title:"Configure Linode Object Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in Linode Object Storage",msgOnUninstall:""},category:"Storage"};t.default=s},74136:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const o=s(a(4245));t.default=class{constructor(e){this.input=e}async init(){var e;this.mailersend=new o.default({api_key:null===(e=this.input)||void 0===e?void 0:e.api_key})}async mailSend(e){const t=[new o.Recipient(e.to)],a=(new o.EmailParams).setFrom(this.input.from).setFromName(this.input.from_name).setRecipients(t).setSubject(e.subject).setHtml(e.html).setText(e.text),i=await this.mailersend.send(a);if(401===i.status)throw new Error(i.status)}async test(e){try{return await this.mailSend({to:e,subject:"Test email",html:"Test email"}),!0}catch(e){throw e}}}},44719:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(74136));class o extends n.XcEmailPlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},26999:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(44719)).default,title:"MailerSend",version:"0.0.1",logo:"plugins/mailersend.svg",description:"MailerSend email client",price:"Free",tags:"Email",category:"Email",inputs:{title:"Configure MailerSend",items:[{key:"api_key",label:"API KEy",placeholder:"eg: ***************",type:n.XcType.Password,required:!0},{key:"from",label:"From",placeholder:"eg: admin@run.com",type:n.XcType.SingleLineText,required:!0},{key:"from_name",label:"From Name",placeholder:"eg: Adam",type:n.XcType.SingleLineText,required:!0}],actions:[{label:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and email notification will use MailerSend configuration",msgOnUninstall:""}};t.default=s},18600:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(52167));t.default=class{init(){return Promise.resolve(void 0)}async sendMessage(e,t){for(const{webhook_url:a}of null==t?void 0:t.channels)try{return await n.default.post(a,{text:e})}catch(e){throw console.log(e),e}}}},66097:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(18600));class o extends n.XcWebhookNotificationPlugin{getAdapter(){return o.notificationAdapter}async init(e){o.notificationAdapter=new s.default,await o.notificationAdapter.init()}}t.default=o},2408:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(66097)).default,title:"Mattermost",version:"0.0.1",logo:"plugins/mattermost.png",description:"Mattermost brings all your team communication into one place, making it searchable and accessible anywhere.",price:"Free",tags:"Chat",category:"Chat",inputs:{title:"Configure Mattermost",array:!0,items:[{key:"channel",label:"Channel Name",placeholder:"Channel Name",type:n.XcType.SingleLineText,required:!0},{key:"webhook_url",label:"Webhook URL",placeholder:"Webhook URL",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and Mattermost is enabled for notification.",msgOnUninstall:""}};t.default=s},51620:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=a(26299),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){return new Promise(((a,i)=>{var s;const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),i(e)}));const r={"Content-Type":t.mimetype};this.minioClient.putObject(null===(s=this.input)||void 0===s?void 0:s.bucket,e,o,r).then((()=>{a(`http${this.input.useSSL?"s":""}://${this.input.endPoint}:${this.input.port}/${this.input.bucket}/${e}`)})).catch(i)}))}async fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){return new Promise(((t,a)=>{this.minioClient.getObject(this.input.bucket,e,((e,i)=>e?a(e):i?t(i):a(i)))}))}async init(){this.input.port=+this.input.port||9e3,this.input.useSSL=!0===this.input.useSSL,this.input.accessKey=this.input.access_key,this.input.secretKey=this.input.access_secret,this.minioClient=new o.Client(this.input)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{var r;if(t)return n(t);a.Body=o,a.Key=e;this.minioClient.putObject(null===(r=this.input)||void 0===r?void 0:r.bucket,e,o,{}).then((()=>{i(`http${this.input.useSSL?"s":""}://${this.input.endPoint}:${this.input.port}/${this.input.bucket}/${e}`)})).catch(n)}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}}},9815:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(51620));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},36098:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(9815)).default,title:"Minio",version:"0.0.1",logo:"plugins/minio.png",description:"MinIO is a High Performance Object Storage released under Apache License v2.0. It is API compatible with Amazon S3 cloud storage service.",price:"Free",tags:"Storage",category:"Storage",inputs:{title:"Configure Minio",items:[{key:"endPoint",label:"Minio Endpoint",placeholder:"Minio Endpoint",type:n.XcType.SingleLineText,required:!0},{key:"port",label:"Port",placeholder:"Port",type:n.XcType.Number,required:!0},{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0},{key:"useSSL",label:"Use SSL",placeholder:"Use SSL",type:n.XcType.Checkbox,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in Minio",msgOnUninstall:""}};t.default=s},40026:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=i(a(29336)),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){const a={ACL:"public-read",ContentType:t.mimetype};return new Promise(((i,s)=>{const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),s(e)})),a.Body=o,a.Key=e,this.s3Client.upload(a,((e,t)=>{e&&(console.log("Error",e),s(e)),t&&i(t.Location)}))}))}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{if(t)return n(t);a.Body=o,a.Key=e,a.ContentType=s.headers["content-type"],this.s3Client.upload(a,((e,a)=>{t&&(console.log("Error",t),n(e)),a&&i(a.Location)}))}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}async fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){return new Promise(((t,a)=>{this.s3Client.getObject({Key:e},((e,i)=>e?a(e):(null==i?void 0:i.Body)?t(i.Body):a(i)))}))}async init(){const e={params:{Bucket:this.input.bucket},region:this.input.region};e.accessKeyId=this.input.access_key,e.secretAccessKey=this.input.access_secret,e.endpoint=new o.default.Endpoint(`s3.${this.input.region}.cloud.ovh.net`),this.s3Client=new o.default.S3(e)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}}},97300:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(40026));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},82281:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(97300)).default,title:"OvhCloud Object Storage",version:"0.0.1",logo:"plugins/ovhCloud.png",tags:"Storage",description:"Upload your files to a space that you can access via HTTPS using the OpenStack Swift API, or the S3 API. ",inputs:{title:"Configure OvhCloud Object Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in OvhCloud Object Storage",msgOnUninstall:""},category:"Storage"};t.default=s},97966:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=i(a(29336)),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){const a={ACL:"public-read",ContentType:t.mimetype};return new Promise(((i,s)=>{const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),s(e)})),a.Body=o,a.Key=e,this.s3Client.upload(a,((e,t)=>{e&&(console.log("Error",e),s(e)),t&&i(t.Location)}))}))}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{if(t)return n(t);a.Body=o,a.Key=e,a.ContentType=s.headers["content-type"],this.s3Client.upload(a,((e,a)=>{t&&(console.log("Error",t),n(e)),a&&i(a.Location)}))}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}async fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){return new Promise(((t,a)=>{this.s3Client.getObject({Key:e},((e,i)=>e?a(e):(null==i?void 0:i.Body)?t(i.Body):a(i)))}))}async init(){const e={params:{Bucket:this.input.bucket},region:this.input.region};e.accessKeyId=this.input.access_key,e.secretAccessKey=this.input.access_secret,this.s3Client=new o.default.S3(e)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}}},1878:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(97966));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},93166:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(1878)).default,title:"S3",version:"0.0.1",logo:"plugins/s3.png",description:"Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance.",inputs:{title:"Configure Amazon S3",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in AWS S3",msgOnUninstall:""},category:n.PluginCategory.STORAGE,tags:"Storage"};t.default=s},46907:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=i(a(29336)),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileRead(e){return new Promise(((t,a)=>{this.s3Client.getObject({Key:e},((e,i)=>e?a(e):(null==i?void 0:i.Body)?t(i.Body):a(i)))}))}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}async fileDelete(e){return Promise.resolve(void 0)}async init(){const e={params:{Bucket:this.input.bucket},region:this.input.region};e.accessKeyId=this.input.access_key,e.secretAccessKey=this.input.access_secret,e.endpoint=new o.default.Endpoint(`s3.${this.input.region}.scw.cloud`),this.s3Client=new o.default.S3(e)}async fileCreate(e,t){const a={ACL:"public-read",ContentType:t.mimetype};return new Promise(((i,s)=>{const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),s(e)})),a.Body=o,a.Key=e,this.s3Client.upload(a,((e,t)=>{e&&(console.log("Error",e),s(e)),t&&i(t.Location)}))}))}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{if(t)return n(t);a.Body=o,a.Key=e,a.ContentType=s.headers["content-type"],this.s3Client.upload(a,((e,a)=>{t&&(console.log("Error",t),n(e)),a&&i(a.Location)}))}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}}},89506:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(46907));class o extends n.XcStoragePlugin{async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}getAdapter(){return o.storageAdapter}}t.default=o},69592:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(89506)).default,title:"Scaleway Object Storage",version:"0.0.1",logo:"plugins/scaleway.png",tags:"Storage",description:"Scaleway Object Storage is an S3-compatible object store from Scaleway Cloud Platform.",inputs:{title:"Setup Scaleway",items:[{key:"bucket",label:"Bucket name",placeholder:"Bucket name",type:n.XcType.SingleLineText,required:!0},{key:"region",label:"Region of bucket",placeholder:"Region of bucket",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed Scaleway Object Storage",msgOnUninstall:""},category:"Storage"};t.default=s},77462:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(45184)),s=i(a(29336));t.default=class{constructor(e){this.input=e}async init(){const e={accessKeyId:this.input.access_key,secretAccessKey:this.input.access_secret,region:this.input.region};this.transporter=n.default.createTransport({SES:new s.default.SES(e)})}async mailSend(e){this.transporter&&this.transporter.sendMail(Object.assign(Object.assign({},e),{from:this.input.from}),((e,t)=>{e?console.log(e):console.log("Message sent: "+t.response)}))}async test(){try{return await this.mailSend({to:this.input.from,subject:"Test email",html:"Test email"}),!0}catch(e){throw e}}}},7354:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(77462));class o extends n.XcEmailPlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},86349:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(7354)).default,title:"SES",version:"0.0.1",logo:"plugins/aws.png",description:"Amazon Simple Email Service (SES) is a cost-effective, flexible, and scalable email service that enables developers to send mail from within any application.",price:"Free",tags:"Email",category:"Email",inputs:{title:"Configure Amazon Simple Email Service (SES)",items:[{key:"from",label:"From",placeholder:"From",type:n.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and email notification will use Amazon SES",msgOnUninstall:""}};t.default=s},24318:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(52167));t.default=class{init(){return Promise.resolve(void 0)}async sendMessage(e,t){for(const{webhook_url:a}of null==t?void 0:t.channels)try{return await n.default.post(a,{text:e})}catch(e){throw console.log(e),e}}}},99105:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(24318));class o extends n.XcWebhookNotificationPlugin{getAdapter(){return o.notificationAdapter}async init(e){o.notificationAdapter=new s.default,await o.notificationAdapter.init()}}t.default=o},72200:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(99105)).default,title:"Slack",version:"0.0.1",logo:"plugins/slack.webp",description:"Slack brings team communication and collaboration into one place so you can get more work done, whether you belong to a large enterprise or a small business. ",price:"Free",tags:"Chat",category:"Chat",inputs:{title:"Configure Slack",array:!0,items:[{key:"channel",label:"Channel Name",placeholder:"Channel Name",type:n.XcType.SingleLineText,required:!0},{key:"webhook_url",label:"Webhook URL",placeholder:"Webhook URL",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and Slack is enabled for notification.",msgOnUninstall:""}};t.default=s},64935:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(45184));t.default=class{constructor(e){this.input=e}async init(){var e,t,a,i,s,o,r,l,c,d,u;const p={host:null===(e=this.input)||void 0===e?void 0:e.host,port:parseInt(null===(t=this.input)||void 0===t?void 0:t.port,10),secure:"boolean"==typeof(null===(a=this.input)||void 0===a?void 0:a.secure)?null===(i=this.input)||void 0===i?void 0:i.secure:"true"===(null===(s=this.input)||void 0===s?void 0:s.secure),ignoreTLS:"boolean"==typeof(null===(o=this.input)||void 0===o?void 0:o.ignoreTLS)?null===(r=this.input)||void 0===r?void 0:r.ignoreTLS:"true"===(null===(l=this.input)||void 0===l?void 0:l.ignoreTLS),auth:{user:null===(c=this.input)||void 0===c?void 0:c.username,pass:null===(d=this.input)||void 0===d?void 0:d.password},tls:{rejectUnauthorized:null===(u=this.input)||void 0===u?void 0:u.rejectUnauthorized}};this.transporter=n.default.createTransport(p)}async mailSend(e){this.transporter&&await this.transporter.sendMail(Object.assign(Object.assign({},e),{from:this.input.from}))}async test(){try{return await this.mailSend({to:this.input.from,subject:"Test email",html:"Test email"}),!0}catch(e){throw console.log("SMTP test error :: ",e),new Error("SMTP test failed, please check server log for more details.")}}}},77725:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(64935));class o extends n.XcEmailPlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},48854:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(77725)).default,title:"SMTP",version:"0.0.2",description:"SMTP email client",price:"Free",tags:"Email",category:"Email",inputs:{title:"Configure Email SMTP",items:[{key:"from",label:"From",placeholder:"eg: admin@run.com",type:n.XcType.SingleLineText,required:!0},{key:"host",label:"Host",placeholder:"eg: smtp.run.com",type:n.XcType.SingleLineText,required:!0},{key:"port",label:"Port",placeholder:"Port",type:n.XcType.SingleLineText,required:!0},{key:"secure",label:"Secure",placeholder:"Secure",type:n.XcType.Checkbox,required:!1},{key:"ignoreTLS",label:"Ignore TLS",placeholder:"Ignore TLS",type:n.XcType.Checkbox,required:!1},{key:"rejectUnauthorized",label:"Reject Unauthorized",placeholder:"Reject Unauthorized",type:n.XcType.Checkbox,required:!1},{key:"username",label:"Username",placeholder:"Username",type:n.XcType.SingleLineText,required:!1},{key:"password",label:"Password",placeholder:"Password",type:n.XcType.Password,required:!1}],actions:[{label:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and email notification will use SMTP configuration",msgOnUninstall:""}};t.default=s},77774:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=i(a(29336)),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){const a={ACL:"public-read",ContentType:t.mimetype};return new Promise(((i,s)=>{const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),s(e)})),a.Body=o,a.Key=e,this.s3Client.upload(a,((e,t)=>{e&&(console.log("Error",e),s(e)),t&&i(t.Location)}))}))}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{if(t)return n(t);a.Body=o,a.Key=e,a.ContentType=s.headers["content-type"],this.s3Client.upload(a,((e,a)=>{t&&(console.log("Error",t),n(e)),a&&i(a.Location)}))}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}async fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){return new Promise(((t,a)=>{this.s3Client.getObject({Key:e},((e,i)=>e?a(e):(null==i?void 0:i.Body)?t(i.Body):a(i)))}))}async init(){const e={params:{Bucket:this.input.bucket},region:this.input.region};e.accessKeyId=this.input.access_key,e.secretAccessKey=this.input.access_secret,e.endpoint=new o.default.Endpoint(`${this.input.region||"nyc3"}.digitaloceanspaces.com`),this.s3Client=new o.default.S3(e)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}}},13290:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(77774));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},95311:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(13290)).default,title:"Spaces",version:"0.0.1",logo:"plugins/spaces.png",description:"Store & deliver vast amounts of content with a simple architecture.",price:"Free",tags:"Storage",category:"Storage",inputs:{title:"DigitalOcean Spaces",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"region",label:"Region",placeholder:"Region",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in DigitalOcean Spaces",msgOnUninstall:""}};t.default=s},7232:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=i(a(71017)),o=a(16464),r=i(a(49443)),l=i(a(52167)),c=a(51401),d=a(35043);t.default=class{constructor(){}async fileCreate(e,t){const a=this.validateAndNormalisePath(e);try{await(0,r.default)(s.default.dirname(a));const e=await(0,o.promisify)(n.default.readFile)(t.path);await(0,o.promisify)(n.default.writeFile)(a,e),await(0,o.promisify)(n.default.unlink)(t.path)}catch(e){throw e}}async fileCreateByUrl(e,t){const a=this.validateAndNormalisePath(e);return new Promise(((e,i)=>{l.default.get(t,{responseType:"stream",headers:{accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","accept-language":"en-US,en;q=0.9","cache-control":"no-cache",pragma:"no-cache","user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36",origin:"https://www.airtable.com/"}}).then((async t=>{await(0,r.default)(s.default.dirname(a));const o=n.default.createWriteStream(a);o.on("finish",(()=>{o.close((t=>{if(t)return i(t);e(null)}))})),o.on("error",(e=>{n.default.unlink(a,(()=>i(e.message)))})),t.data.pipe(o)})).catch((e=>{i(e.message)}))}))}async fileCreateByStream(e,t){return new Promise(((a,i)=>{const o=this.validateAndNormalisePath(e);try{(0,r.default)(s.default.dirname(o)).then((()=>{const e=n.default.createWriteStream(o);e.on("finish",(()=>a())),e.on("error",(e=>i(e))),t.pipe(e)}))}catch(e){throw e}}))}async fileReadByStream(e){const t=this.validateAndNormalisePath(e);return n.default.createReadStream(t,{encoding:"utf8"})}async getDirectoryList(e){const t=this.validateAndNormalisePath(e);return n.default.promises.readdir(t)}fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){try{return await n.default.promises.readFile(this.validateAndNormalisePath(e,!0))}catch(e){throw e}}init(){return Promise.resolve(void 0)}test(){return Promise.resolve(!1)}validateAndNormalisePath(e,t=!1){const a=s.default.resolve((0,d.getToolDir)(),"nc"),i=s.default.resolve(s.default.join((0,d.getToolDir)(),...e.split("/")));return i.startsWith(a)||(t?c.NcError.notFound():c.NcError.badRequest("Invalid path")),i}}},48504:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(52167));t.default=class{init(){return Promise.resolve(void 0)}async sendMessage(e,t){for(const{webhook_url:a}of null==t?void 0:t.channels)try{return await n.default.post(a,{Text:e})}catch(e){throw console.log(e),e}}}},29542:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(48504));class o extends n.XcWebhookNotificationPlugin{getAdapter(){return o.notificationAdapter}async init(e){o.notificationAdapter=new s.default,await o.notificationAdapter.init()}}t.default=o},39047:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(29542)).default,title:"Microsoft Teams",version:"0.0.1",logo:"plugins/teams.ico",description:"Microsoft Teams is for everyone  Instantly go from group chat to video call with the touch of a button.",price:"Free",tags:"Chat",category:"Chat",inputs:{title:"Configure Microsoft Teams",array:!0,items:[{key:"channel",label:"Channel Name",placeholder:"Channel Name",type:n.XcType.SingleLineText,required:!0},{key:"webhook_url",label:"Webhook URL",placeholder:"Webhook URL",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and Microsoft Teams is enabled for notification.",msgOnUninstall:""}};t.default=s},12047:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(37202));t.default=class{constructor(e){this.input=e}async init(){this.client=(0,n.default)(this.input.sid,this.input.token)}async sendMessage(e,t){var a;for(const i of null===(a=null==t?void 0:t.to)||void 0===a?void 0:a.split(/\s*?,\s*?/))try{await this.client.messages.create({body:e,from:this.input.from,to:i})}catch(e){throw console.log(e),e}}}},36323:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(12047));class o extends n.XcWebhookNotificationPlugin{getAdapter(){return o.notificationAdapter}async init(e){o.notificationAdapter=new s.default(e),await o.notificationAdapter.init()}}t.default=o},18427:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(36323)).default,title:"Twilio",version:"0.0.1",logo:"plugins/twilio.png",description:"With Twilio, unite communications and strengthen customer relationships across your business  from marketing and sales to customer service and operations.",price:"Free",tags:"Chat",category:"Twilio",inputs:{title:"Configure Twilio",items:[{key:"sid",label:"Account SID",placeholder:"Account SID",type:n.XcType.SingleLineText,required:!0},{key:"token",label:"Auth Token",placeholder:"Auth Token",type:n.XcType.Password,required:!0},{key:"from",label:"From Phone Number",placeholder:"From Phone Number",type:n.XcType.SingleLineText,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and Twilio is enabled for notification.",msgOnUninstall:""}};t.default=s},70770:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(37202));t.default=class{constructor(e){this.input=e}async init(){this.client=(0,n.default)(this.input.sid,this.input.token)}async sendMessage(e,t){var a;for(const i of null===(a=null==t?void 0:t.to)||void 0===a?void 0:a.split(/\s*?,\s*?/))try{await this.client.messages.create({body:e,from:`whatsapp:${this.input.from}`,to:`whatsapp:${i}`})}catch(e){throw console.log(e),e}}}},54576:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(70770));class o extends n.XcWebhookNotificationPlugin{getAdapter(){return o.notificationAdapter}async init(e){o.notificationAdapter=new s.default(e),await o.notificationAdapter.init()}}t.default=o},60242:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(54576)).default,title:"Whatsapp Twilio",version:"0.0.1",logo:"plugins/whatsapp.png",description:"With Twilio, unite communications and strengthen customer relationships across your business  from marketing and sales to customer service and operations.",price:"Free",tags:"Chat",category:"Twilio",inputs:{title:"Configure Twilio",items:[{key:"sid",label:"Account SID",placeholder:"Account SID",type:n.XcType.SingleLineText,required:!0},{key:"token",label:"Auth Token",placeholder:"Auth Token",type:n.XcType.Password,required:!0},{key:"from",label:"From Phone Number",placeholder:"From Phone Number",type:n.XcType.SingleLineText,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and Whatsapp Twilio is enabled for notification.",msgOnUninstall:""}};t.default=s},90923:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(65759));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},65759:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=i(a(29336)),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){const a={ACL:"public-read",ContentType:t.mimetype};return new Promise(((i,s)=>{const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),s(e)})),a.Body=o,a.Key=e,this.s3Client.upload(a,((e,t)=>{e&&(console.log("Error",e),s(e)),t&&i(t.Location)}))}))}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{if(t)return n(t);a.Body=o,a.Key=e,a.ContentType=s.headers["content-type"],this.s3Client.upload(a,((e,a)=>{t&&(console.log("Error",t),n(e)),a&&i(a.Location)}))}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}async fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){return new Promise(((t,a)=>{this.s3Client.getObject({Key:e},((e,i)=>e?a(e):(null==i?void 0:i.Body)?t(i.Body):a(i)))}))}async init(){const e={params:{Bucket:this.input.bucket},region:this.input.region};e.accessKeyId=this.input.access_key,e.secretAccessKey=this.input.access_secret,e.endpoint=new o.default.Endpoint(this.input.endpoint),this.s3Client=new o.default.S3(e)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}}},68399:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(90923)).default,title:"UpCloud Object Storage",version:"0.0.1",logo:"plugins/upcloud.png",description:"The perfect home for your data. Thanks to the S3-compatible programmable interface,\nyou have a host of options for existing tools and code implementations.\n",tags:"Storage",inputs:{title:"Configure UpCloud Object Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"endpoint",label:"Endpoint",placeholder:"Endpoint",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in UpCloud Object Storage",msgOnUninstall:""},category:"Storage"};t.default=s},47186:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=i(a(29336)),r=i(a(78910)),l=a(41201);t.default=class{constructor(e){this.input=e}async fileCreate(e,t){const a={ACL:"public-read",ContentType:t.mimetype};return new Promise(((i,s)=>{const o=n.default.createReadStream(t.path);o.on("error",(e=>{console.log("File Error",e),s(e)})),a.Body=o,a.Key=e,this.s3Client.upload(a,((e,t)=>{e&&(console.log("Error",e),s(e)),t&&i(t.Location)}))}))}async fileCreateByUrl(e,t){const a={ACL:"public-read"};return new Promise(((i,n)=>{(0,r.default)({url:t,encoding:null},((t,s,o)=>{if(t)return n(t);a.Body=o,a.Key=e,a.ContentType=s.headers["content-type"],this.s3Client.upload(a,((e,a)=>{t&&(console.log("Error",t),n(e)),a&&i(a.Location)}))}))}))}fileCreateByStream(e,t){return Promise.resolve(void 0)}fileReadByStream(e){return Promise.resolve(void 0)}getDirectoryList(e){return Promise.resolve(void 0)}async fileDelete(e){return Promise.resolve(void 0)}async fileRead(e){return new Promise(((t,a)=>{this.s3Client.getObject({Key:e},((e,i)=>e?a(e):(null==i?void 0:i.Body)?t(i.Body):a(i)))}))}async init(){const e={params:{Bucket:this.input.bucket},region:this.input.region};e.accessKeyId=this.input.access_key,e.secretAccessKey=this.input.access_secret,e.endpoint=new o.default.Endpoint(this.input.hostname),this.s3Client=new o.default.S3(e)}async test(){try{const e=(0,l.generateTempFilePath)(),t=n.default.createWriteStream(e);return await(0,l.waitForStreamClose)(t),await this.fileCreate("nc-test-file.txt",{path:e,mimetype:"text/plain",originalname:"temp.txt",size:""}),await(0,s.promisify)(n.default.unlink)(e),!0}catch(e){throw e}}}},70953:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(73134),s=i(a(47186));class o extends n.XcStoragePlugin{getAdapter(){return o.storageAdapter}async init(e){o.storageAdapter=new s.default(e),await o.storageAdapter.init()}}t.default=o},70741:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s={builder:i(a(70953)).default,title:"Vultr Object Storage",version:"0.0.2",logo:"plugins/vultr.png",description:"Using Vultr Object Storage can give flexibility and cloud storage that allows applications greater flexibility and access worldwide.",tags:"Storage",inputs:{title:"Configure Vultr Object Storage",items:[{key:"bucket",label:"Bucket Name",placeholder:"Bucket Name",type:n.XcType.SingleLineText,required:!0},{key:"hostname",label:"Host Name",placeholder:"e.g.: ewr1.vultrobjects.com",type:n.XcType.SingleLineText,required:!0},{key:"access_key",label:"Access Key",placeholder:"Access Key",type:n.XcType.SingleLineText,required:!0},{key:"access_secret",label:"Access Secret",placeholder:"Access Secret",type:n.XcType.Password,required:!0}],actions:[{label:"Test",placeholder:"Test",key:"test",actionType:n.XcActionType.TEST,type:n.XcType.Button},{label:"Save",placeholder:"Save",key:"save",actionType:n.XcActionType.SUBMIT,type:n.XcType.Button}],msgOnInstall:"Successfully installed and attachment will be stored in Vultr Object Storage",msgOnUninstall:""},category:"Storage"};t.default=s},48848:function(e,t,a){var i,n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(a(71017)),o=n(a(33582)),r=n(a(66860)),l=n(a(27552)),c=(0,r.default)();c.enable("trust proxy"),c.use((0,o.default)()),c.use(null!==(i=process.env.NC_DASHBOARD_URL)&&void 0!==i?i:"/dashboard",r.default.static(s.default.join(__dirname,"nc-gui"))),c.set("view engine","ejs"),(async()=>{const e=c.listen(process.env.PORT||8080,(()=>{console.log(`App started successfully.\nVisit -> ${l.default.dashboardUrl}`)}));c.use(await l.default.init({},e,c))})().catch((e=>console.log(e)))},2695:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const o=s(a(49037));t.default=o},67259:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiDocsService=void 0;const s=a(26481),o=n(a(89548)),r=a(51401),l=a(15147);let c=class{async swaggerJson(e){const t=await l.Project.get(e.projectId);t||r.NcError.notFound();const a=await l.Model.list({project_id:e.projectId,base_id:null}),i=await(0,o.default)(t,a);return i.servers=[{url:e.siteUrl},{url:"{customUrl}",variables:{customUrl:{default:e.siteUrl,description:"Provide custom nocodb app base url"}}}],i}};c=i([(0,s.Injectable)()],c),t.ApiDocsService=c},80545:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(90811),s=i(a(27552));t.default=async function({project:e,model:t,columns:a,views:i},o=s.default.ncMeta){const r=await(0,n.getModelPaths)({tableName:t.title,type:t.type,orgs:"v1",columns:a,projectName:e.id});for(const{view:s,columns:o}of i){const i=a.filter((e=>{var t;return null===(t=o.find((t=>t.fk_column_id===e.column.id)))||void 0===t?void 0:t.show}));Object.assign(r,await(0,n.getViewPaths)({tableName:t.title,viewName:s.title,type:t.type,orgs:"v1",columns:i,projectName:e.id}))}return r}},13310:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(46707),s=i(a(27552));t.default=async function({project:e,model:t,columns:a,views:i},o=s.default.ncMeta){const r=(0,n.getModelSchemas)({tableName:t.title,orgs:"v1",projectName:e.title,columns:a});for(const{view:s,columns:o}of i){const i=a.filter((e=>{var t;return null===(t=o.find((t=>t.fk_column_id===e.column.id)))||void 0===t?void 0:t.show}));Object.assign(r,(0,n.getViewSchemas)({tableName:t.title,viewName:s.title,orgs:"v1",columns:i,projectName:e.title}))}return r}},35408:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(82231)),o=i(a(27552));t.default=async(e,t,a=o.default.ncMeta)=>{const i=await t.getBases().then((e=>{var t;return null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.type}));return Promise.all(e.map((async e=>{const t={title:e.title,type:"object",virtual:!0,column:e};switch(e.uidt){case n.UITypes.LinkToAnotherRecord:{const i=await e.getColOptions(a);if(i){const e=await i.getRelatedTable(a);t.type=void 0,t.$ref=`#/components/schemas/${e.title}Request`}}break;case n.UITypes.Formula:case n.UITypes.Lookup:t.type="object";break;case n.UITypes.Rollup:case n.UITypes.Links:t.type="number";break;case n.UITypes.Attachment:t.type="array",t.items={$ref:"#/components/schemas/Attachment"};break;default:t.virtual=!1,s.default.setSwaggerType(e,t,i)}return t})))}},89548:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(14233)),o=i(a(80545)),r=i(a(13310)),l=i(a(35408)),c=i(a(27552));t.default=async function(e,t,a=c.default.ncMeta){const i=Object.assign(Object.assign({},s.default),{paths:{},components:Object.assign(Object.assign({},s.default.components),{schemas:Object.assign({},s.default.components.schemas)})});for(const s of t){let t={};const c=await(0,l.default)(await s.getColumns(a),e,a),d=[];for(const e of await s.getViews(!1,a)||[])e.type===n.ViewTypes.GRID&&d.push({view:e,columns:await e.getColumns(a)});s.mm||(t=await(0,o.default)({project:e,model:s,columns:c,views:d},a));const u=await(0,r.default)({project:e,model:s,columns:c,views:d},a);Object.assign(i.paths,t),Object.assign(i.components.schemas,u)}return i}},90961:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.csvExportResponseHeader=void 0,t.csvExportResponseHeader={"nc-export-offset":{schema:{type:"integer"},description:"Offset of next set of data which will be helpful if there is large amount of data. It will returns `-1` if all set of data exported.",example:"1000"}}},38792:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getNestedParams=t.nestedOffsetParam=t.nestedLimitParam=t.nestedSortParam=t.nestedFieldParam=t.nestedWhereParam=t.csvExportOffsetParam=t.exportTypeParam=t.referencedRowIdParam=t.columnNameParam=t.columnNameQueryParam=t.shuffleParam=t.offsetParam=t.limitParam=t.whereParam=t.sortParam=t.fieldsParam=t.relationTypeParam=t.rowIdParam=void 0;const i=a(68281);t.rowIdParam={schema:{type:"string"},name:"rowId",in:"path",required:!0,example:1,description:"Primary key of the record you want to read. If the table have composite primary key then combine them by using `___` and pass it as primary key."},t.relationTypeParam={schema:{type:"string",enum:["mm","hm"]},name:"relationType",in:"path",required:!0},t.fieldsParam={schema:{type:"string"},in:"query",name:"fields",description:"Array of field names or comma separated filed names to include in the response objects. In array syntax pass it like `fields[]=field1&fields[]=field2` or alternately `fields=field1,field2`."},t.sortParam={schema:{type:"string"},in:"query",name:"sort",description:"Comma separated field names to sort rows, rows will sort in ascending order based on provided columns. To sort in descending order provide `-` prefix along with column name, like `-field`. Example : `sort=field1,-field2`"},t.whereParam={schema:{type:"string"},in:"query",name:"where",description:"This can be used for filtering rows, which accepts complicated where conditions. For more info visit [here](https://docs.nocodb.com/developer-resources/rest-apis#comparison-operators). Example : `where=(field1,eq,value)`"},t.limitParam={schema:{type:"number",minimum:1},in:"query",name:"limit",description:"The `limit` parameter used for pagination, the response collection size depends on limit value with default value `25` and maximum value `1000`, which can be overridden by environment variables `DB_QUERY_LIMIT_DEFAULT` and `DB_QUERY_LIMIT_MAX` respectively.",example:25},t.offsetParam={schema:{type:"number",minimum:0},in:"query",name:"offset",description:"The `offset` parameter used for pagination, the value helps to select collection from a certain index.",example:0},t.shuffleParam={schema:{type:"number",minimum:0,maximum:1},in:"query",name:"shuffle",description:"The `shuffle` parameter used for pagination, the response will be shuffled if it is set to 1.",example:0},t.columnNameQueryParam={schema:{type:"string"},in:"query",name:"column_name",description:"Column name of the column you want to group by, eg. `column_name=column1`"};t.columnNameParam=e=>{const t=[];for(const{column:a}of e)(0,i.isLinksOrLTAR)(a)&&!a.system&&t.push(a.title);return{schema:{type:"string",enum:t},name:"columnName",in:"path",required:!0}},t.referencedRowIdParam={schema:{type:"string"},name:"refRowId",in:"path",required:!0},t.exportTypeParam={schema:{type:"string",enum:["csv","excel"]},name:"type",in:"path",required:!0},t.csvExportOffsetParam={schema:{type:"number",minimum:0},in:"query",name:"offset",description:"Helps to start export from a certain index. You can get the next set of data offset from previous response header named `nc-export-offset`.",example:0};t.nestedWhereParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][where]`,description:`This can be used for filtering rows in nested column \`${e}\`, which accepts complicated where conditions. For more info visit [here](https://docs.nocodb.com/developer-resources/rest-apis#comparison-operators). Example : \`nested[${e}][where]=(field1,eq,value)\``});t.nestedFieldParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][fields]`,description:`Array of field names or comma separated filed names to include in the in nested column \`${e}\` result. In array syntax pass it like \`fields[]=field1&fields[]=field2.\`. Example : \`nested[${e}][fields]=field1,field2\``});t.nestedSortParam=e=>({schema:{type:"string"},in:"query",name:`nested[${e}][sort]`,description:`Comma separated field names to sort rows in nested column \`${e}\` rows, it will sort in ascending order based on provided columns. To sort in descending order provide \`-\` prefix along with column name, like \`-field\`. Example : \`nested[${e}][sort]=field1,-field2\``});t.nestedLimitParam=e=>({schema:{type:"number",minimum:1},in:"query",name:`nested[${e}][limit]`,description:`The \`limit\` parameter used for pagination of nested \`${e}\` rows, the response collection size depends on limit value and default value is \`25\`.`,example:"25"});t.nestedOffsetParam=e=>({schema:{type:"number",minimum:0},in:"query",name:`nested[${e}][offset]`,description:`The \`offset\` parameter used for pagination  of nested \`${e}\` rows, the value helps to select collection from a certain index.`,example:0});t.getNestedParams=async e=>await e.reduce((async(e,{column:a})=>{if(a.uidt===i.UITypes.LinkToAnotherRecord){return(await a.getColOptions()).type!==i.RelationTypes.BELONGS_TO?[...await e,(0,t.nestedWhereParam)(a.title),(0,t.nestedOffsetParam)(a.title),(0,t.nestedLimitParam)(a.title),(0,t.nestedFieldParam)(a.title),(0,t.nestedSortParam)(a.title)]:[...await e,(0,t.nestedFieldParam)(a.title)]}return e}),Promise.resolve([]))},90811:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getViewPaths=t.getModelPaths=void 0;const i=a(68281),n=a(38792),s=a(90961);t.getModelPaths=async e=>Object.assign(Object.assign({[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}`]:Object.assign({get:{summary:`${e.tableName} list`,operationId:`${e.tableName.toLowerCase()}-db-table-row-list`,description:`List of all rows from ${e.tableName} ${e.type} and response data fields can be filtered based on query params.`,tags:[e.tableName],parameters:[n.fieldsParam,n.sortParam,n.whereParam,n.limitParam,n.shuffleParam,n.offsetParam,...await(0,n.getNestedParams)(e.columns)],responses:{200:{description:"OK",content:{"application/json":{schema:o(`${e.tableName}Response`)}}}}}},e.type===i.ModelTypes.TABLE?{post:{summary:`${e.tableName} create`,description:"Insert a new row in table by providing a key value pair object where key refers to the column alias. All the required fields should be included with payload excluding `autoincrement` and column with default value.",operationId:`${e.tableName.toLowerCase()}-create`,responses:{200:{description:"OK",content:{"application/json":{schema:{$ref:`#/components/schemas/${e.tableName}Response`}}}}},tags:[e.tableName],requestBody:{content:{"application/json":{schema:{$ref:`#/components/schemas/${e.tableName}Request`}}}}}}:{}),[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/{rowId}`]:Object.assign({parameters:[n.rowIdParam]},e.type===i.ModelTypes.TABLE?{get:{parameters:[n.fieldsParam],summary:`${e.tableName} read`,description:"Read a row data by using the **primary key** column value.",operationId:`${e.tableName.toLowerCase()}-read`,responses:{201:{description:"Created",content:{"application/json":{schema:{$ref:`#/components/schemas/${e.tableName}Response`}}}}},tags:[e.tableName]},patch:{summary:`${e.tableName} update`,operationId:`${e.tableName.toLowerCase()}-update`,description:"Partial update row in table by providing a key value pair object where key refers to the column alias. You need to only include columns which you want to update.",responses:{200:{description:"OK",content:{"application/json":{schema:{$ref:`#/components/schemas/${e.tableName}Request`}}}}},tags:[e.tableName],requestBody:{content:{"application/json":{schema:{}}}}},delete:{summary:`${e.tableName} delete`,operationId:`${e.tableName.toLowerCase()}-delete`,responses:{200:{description:"OK"}},tags:[e.tableName],description:"Delete a row by using the **primary key** column value."}}:{}),[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/count`]:{get:{summary:`${e.tableName} count`,operationId:`${e.tableName.toLowerCase()}-count`,description:"Get rows count of a table by applying optional filters.",tags:[e.tableName],parameters:[n.whereParam],responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}}}},[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/find-one`]:{get:{summary:`${e.tableName} find-one`,operationId:`${e.tableName.toLowerCase()}-db-table-row-find-one`,description:"Find first record matching the conditions.",tags:[e.tableName],parameters:[n.fieldsParam,n.whereParam,n.sortParam],responses:{200:{description:"OK",content:{"application/json":{schema:{$ref:`#/components/schemas/${e.tableName}Response`}}}}}}},[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/groupby`]:{get:{summary:`${e.tableName} groupby`,operationId:`${e.tableName.toLowerCase()}-groupby`,description:"Group by a column.",tags:[e.tableName],parameters:[n.columnNameQueryParam,n.sortParam,n.whereParam,n.limitParam,n.offsetParam,n.shuffleParam],responses:{200:{description:"OK",content:{"application/json":{schema:{type:"object",properties:{list:{type:"array",items:{$ref:"#/components/schemas/Groupby"}},PageInfo:{$ref:"#/components/schemas/Paginated"}}}}}}}}}},e.type===i.ModelTypes.TABLE?Object.assign({[`/api/v1/db/data/bulk/${e.orgs}/${e.projectName}/${e.tableName}`]:{post:{summary:`${e.tableName} bulk insert`,description:"To insert large amount of data in a single api call you can use this api. It's similar to insert method but here you can pass array of objects to insert into table. Array object will be key value paired column name and value.",operationId:`${e.tableName.toLowerCase()}-bulk-create`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName],requestBody:{content:{"application/json":{schema:{}}}}},patch:{summary:`${e.tableName} bulk  update`,description:"To update multiple records using it's primary key you can use this api. Bulk updated api accepts array object in which each object should contain it's primary columns value mapped to corresponding alias. In addition to primary key you can include the fields which you want to update",operationId:`${e.tableName.toLowerCase()}-bulk-update`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName],requestBody:{content:{"application/json":{schema:{}}}}},delete:{summary:`${e.tableName} bulk delete by IDs`,description:"To delete multiple records using it's primary key you can use this api. Bulk delete api accepts array object in which each object should contain it's primary columns value mapped to corresponding alias.",operationId:`${e.tableName.toLowerCase()}-bulk-delete`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName],requestBody:{content:{"application/json":{schema:{}}}}}},[`/api/v1/db/data/bulk/${e.orgs}/${e.projectName}/${e.tableName}/all`]:{parameters:[n.whereParam],patch:{summary:`${e.tableName} Bulk update with conditions`,description:"This api helps you update multiple table rows in a single api call. You don't have to pass the record id instead you can filter records and apply the changes to filtered records. Payload is similar as normal update in which you can pass any partial row data to be updated.",operationId:`${e.tableName.toLowerCase()}-bulk-update-all`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName],requestBody:{content:{"application/json":{schema:{}}}}},delete:{summary:"Bulk delete with conditions",description:"This api helps you delete multiple table rows in a single api call. You don't have to pass the record id instead you can filter records and delete filtered records.",operationId:`${e.tableName.toLowerCase()}-bulk-delete-all`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName]}}},e.columns.some((e=>(0,i.isLinksOrLTAR)(e.column)&&!e.column.system))?{[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/{rowId}/{relationType}/{columnName}`]:{parameters:[n.rowIdParam,n.relationTypeParam,(0,n.columnNameParam)(e.columns)],get:{summary:"Relation row list",operationId:`${e.tableName.toLowerCase()}-nested-list`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName],parameters:[n.limitParam,n.offsetParam]}},[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/{rowId}/{relationType}/{columnName}/{refRowId}`]:{parameters:[n.rowIdParam,n.relationTypeParam,(0,n.columnNameParam)(e.columns),n.referencedRowIdParam],post:{summary:"Relation row add",operationId:`${e.tableName.toLowerCase()}-nested-add`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName],parameters:[n.limitParam,n.shuffleParam,n.offsetParam],description:""},delete:{summary:"Relation row remove",operationId:`${e.tableName.toLowerCase()}-nested-remove`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName]}},[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/{rowId}/{relationType}/{columnName}/exclude`]:{parameters:[n.rowIdParam,n.relationTypeParam,(0,n.columnNameParam)(e.columns)],get:{summary:"Referenced tables rows excluding current records children/parent",operationId:`${e.tableName.toLowerCase()}-nested-children-excluded-list`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[e.tableName],parameters:[n.limitParam,n.shuffleParam,n.offsetParam]}}}:{}):{}),{[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/export/{type}`]:{parameters:[n.exportTypeParam],get:{summary:"Rows export",operationId:`${e.tableName.toLowerCase()}-csv-export`,description:"Export all the records from a table.Currently we are only supports `csv` export.",tags:[e.tableName],responses:{200:{description:"OK",content:{"application/octet-stream":{schema:{}}},headers:s.csvExportResponseHeader}},parameters:[n.csvExportOffsetParam]}}});function o(e){return{type:"object",properties:{list:{type:"array",items:{$ref:`#/components/schemas/${e}`}},PageInfo:{$ref:"#/components/schemas/Paginated"}}}}t.getViewPaths=async e=>Object.assign(Object.assign({[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/views/${e.viewName}`]:Object.assign({get:{summary:`${e.viewName} list`,operationId:`${e.tableName}-${e.viewName}-row-list`,description:`List of all rows from ${e.viewName} grid view and data of fields can be filtered based on query params. Data and fields in a grid view will be filtered and sorted by default based on the applied options in Dashboard.`,tags:[`${e.viewName} ( ${e.tableName} grid )`],parameters:[n.fieldsParam,n.sortParam,n.whereParam,...await(0,n.getNestedParams)(e.columns)],responses:{200:{description:"OK",content:{"application/json":{schema:o(`${e.tableName}${e.viewName}GridResponse`)}}}}}},e.type===i.ModelTypes.TABLE?{post:{summary:`${e.viewName} create`,description:"Insert a new row in table by providing a key value pair object where key refers to the column alias. All the required fields should be included with payload excluding `autoincrement` and column with default value.",operationId:`${e.tableName}-${e.viewName}-row-create`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[`${e.viewName} ( ${e.tableName} grid )`],requestBody:{content:{"application/json":{schema:{$ref:`#/components/schemas/${e.tableName}${e.viewName}GridRequest`}}}}}}:{}),[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/views/${e.viewName}/count`]:{get:{summary:`${e.viewName} count`,operationId:`${e.tableName}-${e.viewName}-row-count`,description:"",tags:[`${e.viewName} ( ${e.tableName} grid )`],parameters:[n.whereParam],responses:{200:{description:"OK",content:{"application/json":{schema:{type:"object",properties:{count:{type:"number"}}}}}}}}}},e.type===i.ModelTypes.TABLE?{[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/views/${e.viewName}/{rowId}`]:{parameters:[n.rowIdParam],get:{summary:`${e.viewName} read`,description:"Read a row data by using the **primary key** column value.",operationId:`${e.tableName}-${e.viewName}-row-read`,responses:{200:{description:"Created",content:{"application/json":{schema:{$ref:`#/components/schemas/${e.tableName}${e.viewName}GridResponse`}}}}},tags:[`${e.viewName} ( ${e.tableName} grid )`]},patch:{summary:`${e.viewName} update`,description:"Partial update row in table by providing a key value pair object where key refers to the column alias. You need to only include columns which you want to update.",operationId:`${e.tableName}-${e.viewName}-row-update`,responses:{200:{description:"OK",content:{"application/json":{schema:{}}}}},tags:[`${e.viewName} ( ${e.tableName} grid )`],requestBody:{content:{"application/json":{schema:{$ref:`#/components/schemas/${e.tableName}${e.viewName}GridRequest`}}}}},delete:{summary:`${e.viewName} delete`,operationId:`${e.tableName}-${e.viewName}-row-delete`,responses:{200:{description:"OK"}},tags:[`${e.viewName} ( ${e.tableName} grid )`],description:"Delete a row by using the **primary key** column value."}}}:{}),{[`/api/v1/db/data/${e.orgs}/${e.projectName}/${e.tableName}/views/${e.viewName}/export/{type}`]:{parameters:[n.exportTypeParam],get:{summary:`${e.viewName} export`,operationId:`${e.tableName}-${e.viewName}-row-export`,description:"Export all the records from a table view. Currently we are only supports `csv` export.",tags:[`${e.viewName} ( ${e.tableName} grid )`],responses:{200:{description:"OK",content:{"application/octet-stream":{schema:{}}},headers:s.csvExportResponseHeader}},parameters:[]}}})},46707:function(e,t){var a=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.getViewSchemas=t.getModelSchemas=void 0;t.getModelSchemas=e=>{var t,i;return{[`${e.tableName}Response`]:{title:`${e.tableName} Response`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(t=e.columns)||void 0===t?void 0:t.reduce(((e,t)=>{var{title:i,virtual:n,column:s}=t,o=a(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),{[i]:o})}),{}))||{})},[`${e.tableName}Request`]:{title:`${e.tableName} Request`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(i=e.columns)||void 0===i?void 0:i.reduce(((e,t)=>{var{title:i,virtual:n,column:s}=t,o=a(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),n?{}:{[i]:o})}),{}))||{})}}};t.getViewSchemas=e=>{var t,i;return{[`${e.tableName}${e.viewName}GridResponse`]:{title:`${e.tableName} : ${e.viewName} Response`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(t=e.columns)||void 0===t?void 0:t.reduce(((e,t)=>{var{title:i,virtual:n,column:s}=t,o=a(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),{[i]:o})}),{}))||{})},[`${e.tableName}${e.viewName}GridRequest`]:{title:`${e.tableName} : ${e.viewName} Request`,type:"object",description:"","x-internal":!1,properties:Object.assign({},(null===(i=e.columns)||void 0===i?void 0:i.reduce(((e,t)=>{var{title:i,virtual:n,column:s}=t,o=a(t,["title","virtual","column"]);return Object.assign(Object.assign({},e),n?{}:{[i]:o})}),{}))||{})}}}},46460:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiTokensService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(51401),d=a(78829),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async apiTokenList(e){return await u.ApiToken.list(e.userId)}async apiTokenCreate(e){return(0,d.validatePayload)("swagger.json#/components/schemas/ApiTokenReq",e.tokenBody),this.appHooksService.emit(r.AppEvents.API_TOKEN_CREATE,{userId:e.userId,tokenBody:e.tokenBody}),await u.ApiToken.insert(Object.assign(Object.assign({},e.tokenBody),{fk_user_id:e.userId}))}async apiTokenDelete(e){var t;const a=await u.ApiToken.getByToken(e.token);return(0,r.extractRolesObj)(e.user.roles)[r.OrgUserRoles.SUPER_ADMIN]||a.fk_user_id===e.user.id||c.NcError.notFound("Token not found"),this.appHooksService.emit(r.AppEvents.API_TOKEN_DELETE,{userId:null===(t=e.user)||void 0===t?void 0:t.id,token:e.token}),await u.ApiToken.delete(e.token)}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.ApiTokensService=p},62801:function(e,t,a){var i,n,s,o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AppHooksListenerService=void 0;const l=a(26481),c=a(68281),d=a(87049),u=a(15147),p=a(91215),m=a(33206),f=a(15147);let h=i=class{constructor(e,t){this.appHooksService=e,this.telemetryService=t,this.logger=new l.Logger(i.name)}async hookHandler({event:e,data:t}){var a,i;switch(e){case c.AppEvents.PROJECT_INVITE:{const e=t;await this.auditInsert({project_id:e.project.id,op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.INVITE,user:e.invitedBy.email,description:`invited ${e.user.email} to ${e.project.id} project `,ip:e.ip});const a=await f.User.count();this.telemetryService.sendEvent({evt_type:"project:invite",count:a})}break;case c.AppEvents.PROJECT_USER_UPDATE:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.ROLES_MANAGEMENT,user:e.updatedBy.email,description:`Roles for ${e.user.email} with has been updated to ${e.projectUser.roles}`,ip:e.ip})}break;case c.AppEvents.PROJECT_USER_RESEND_INVITE:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.RESEND_INVITE,user:e.user.email,description:`${e.user.email} has been re-invited`,ip:e.ip,project_id:e.project.id})}break;case c.AppEvents.USER_PASSWORD_CHANGE:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.PASSWORD_CHANGE,user:e.user.email,description:"Password has been changed",ip:e.ip})}break;case c.AppEvents.USER_PASSWORD_FORGOT:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.PASSWORD_FORGOT,user:e.user.email,description:"Password Reset has been requested",ip:e.ip})}break;case c.AppEvents.USER_PASSWORD_RESET:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.PASSWORD_RESET,user:e.user.email,description:"Password has been reset",ip:e.ip})}break;case c.AppEvents.USER_EMAIL_VERIFICATION:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.EMAIL_VERIFICATION,user:e.user.email,description:"Email has been verified",ip:e.ip})}break;case c.AppEvents.SHARED_VIEW_DELETE:this.telemetryService.sendEvent({evt_type:"sharedView:deleted"});break;case c.AppEvents.SHARED_VIEW_CREATE:this.telemetryService.sendEvent({evt_type:"sharedView:generated-link"});break;case c.AppEvents.SHARED_VIEW_UPDATE:this.telemetryService.sendEvent({evt_type:"sharedView:updated"});break;case c.AppEvents.VIEW_UPDATE:{const e=t;this.telemetryService.sendEvent({evt_type:"vtable:updated",show_as:null!==(a=e.view.type)&&void 0!==a?a:e.showAs})}break;case c.AppEvents.VIEW_DELETE:this.telemetryService.sendEvent({evt_type:"vtable:deleted"});break;case c.AppEvents.TABLE_UPDATE:this.telemetryService.sendEvent({evt_type:"table:updated"});break;case c.AppEvents.TABLE_CREATE:{const e=t;await this.auditInsert({project_id:e.table.project_id,base_id:e.table.base_id,op_type:c.AuditOperationTypes.TABLE,op_sub_type:c.AuditOperationSubTypes.CREATE,user:null===(i=e.user)||void 0===i?void 0:i.email,description:`Table ${e.table.table_name} with alias ${e.table.title} has been created`,ip:e.ip}),this.telemetryService.sendEvent({evt_type:"table:created"})}break;case c.AppEvents.TABLE_DELETE:{const{table:e,ip:a,user:i}=t;await this.auditInsert({project_id:e.project_id,base_id:e.base_id,op_type:c.AuditOperationTypes.TABLE,op_sub_type:c.AuditOperationSubTypes.DELETE,user:null==i?void 0:i.email,description:`Deleted ${e.type} ${e.table_name} with alias ${e.title}  `,ip:a}),this.telemetryService.sendEvent({evt_type:"table:deleted"})}break;case c.AppEvents.COLUMN_UPDATE:{const{column:e,ip:a,user:i,table:n}=t;await this.auditInsert({project_id:e.project_id,op_type:c.AuditOperationTypes.TABLE_COLUMN,op_sub_type:c.AuditOperationSubTypes.UPDATE,user:null==i?void 0:i.email,description:`The column ${e.column_name} with alias ${e.title} from table ${n.table_name} has been updated`,ip:a}),this.telemetryService.sendEvent({evt_type:"column:updated"})}break;case c.AppEvents.COLUMN_CREATE:{const{column:e,ip:a,user:i,table:n}=t;await this.auditInsert({project_id:n.project_id,op_type:c.AuditOperationTypes.TABLE_COLUMN,op_sub_type:c.AuditOperationSubTypes.CREATE,user:null==i?void 0:i.email,description:`The column ${e.column_name} with alias ${e.title} from table ${n.table_name} has been created`,ip:a}),this.telemetryService.sendEvent({evt_type:"column:created"})}break;case c.AppEvents.COLUMN_DELETE:{const{column:e,ip:a,user:i,table:n}=t;await this.auditInsert({project_id:e.project_id,op_type:c.AuditOperationTypes.TABLE_COLUMN,op_sub_type:c.AuditOperationSubTypes.DELETE,user:null==i?void 0:i.email,description:`The column ${e.column_name} with alias ${e.title} from table ${n.table_name} has been deleted`,ip:a}),this.telemetryService.sendEvent({evt_type:"column:deleted"})}break;case c.AppEvents.USER_SIGNIN:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.SIGNIN,user:e.user.email,ip:e.ip,description:e.auditDescription})}break;case c.AppEvents.USER_SIGNUP:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.AUTHENTICATION,op_sub_type:c.AuditOperationSubTypes.SIGNUP,user:e.user.email,description:"User has signed up",ip:e.ip})}break;case c.AppEvents.ORG_USER_INVITE:{const e=t;this.telemetryService.sendEvent({evt_type:"org:user:invite",count:e.count}),await this.auditInsert({op_type:c.AuditOperationTypes.ORG_USER,op_sub_type:c.AuditOperationSubTypes.INVITE,user:e.invitedBy.email,description:`${e.user.email} has been invited to the organisation`,ip:e.ip})}break;case c.AppEvents.ORG_USER_RESEND_INVITE:{const e=t;await this.auditInsert({op_type:c.AuditOperationTypes.ORG_USER,op_sub_type:c.AuditOperationSubTypes.RESEND_INVITE,user:e.invitedBy.email,description:`${e.user.email} has been re-invited`,ip:e.ip})}break;case c.AppEvents.FILTER_CREATE:{const e=t;this.telemetryService.sendEvent({evt_type:e.hook?"hookFilter:created":"filter:created"})}break;case c.AppEvents.FILTER_DELETE:this.telemetryService.sendEvent({evt_type:"filter:deleted"});break;case c.AppEvents.FILTER_UPDATE:this.telemetryService.sendEvent({evt_type:"filter:updated"});break;case c.AppEvents.SORT_CREATE:this.telemetryService.sendEvent({evt_type:"sort:created"});break;case c.AppEvents.SORT_DELETE:this.telemetryService.sendEvent({evt_type:"sort:deleted"});break;case c.AppEvents.SORT_UPDATE:this.telemetryService.sendEvent({evt_type:"sort:updated"});break;case c.AppEvents.VIEW_COLUMN_CREATE:this.telemetryService.sendEvent({evt_type:"viewColumn:inserted"});break;case c.AppEvents.VIEW_COLUMN_UPDATE:this.telemetryService.sendEvent({evt_type:"viewColumn:updated"});break;case c.AppEvents.RELATION_CREATE:this.telemetryService.sendEvent({evt_type:"relation:created"});break;case c.AppEvents.RELATION_DELETE:this.telemetryService.sendEvent({evt_type:"relation:deleted"});break;case c.AppEvents.API_TOKEN_CREATE:this.telemetryService.sendEvent({evt_type:"apiToken:created"});break;case c.AppEvents.API_TOKEN_DELETE:this.telemetryService.sendEvent({evt_type:"apiToken:deleted"});break;case c.AppEvents.PLUGIN_TEST:this.telemetryService.sendEvent({evt_type:"plugin:tested"});break;case c.AppEvents.PLUGIN_INSTALL:{const{plugin:e}=t;this.telemetryService.sendEvent({evt_type:"plugin:installed",title:e.title})}break;case c.AppEvents.PLUGIN_UNINSTALL:{const{plugin:e}=t;this.telemetryService.sendEvent({evt_type:"plugin:uninstalled",title:e.title})}break;case c.AppEvents.SHARED_BASE_GENERATE_LINK:case c.AppEvents.SHARED_BASE_DELETE_LINK:this.telemetryService.sendEvent({evt_type:"sharedBase:generated-link"});break;case c.AppEvents.BASE_UPDATE:this.telemetryService.sendEvent({evt_type:"base:updated"});break;case c.AppEvents.BASE_DELETE:this.telemetryService.sendEvent({evt_type:"base:deleted"});break;case c.AppEvents.BASE_CREATE:this.telemetryService.sendEvent({evt_type:"base:created"});break;case c.AppEvents.ATTACHMENT_UPLOAD:this.telemetryService.sendEvent({evt_type:"image:uploaded",type:null==t?void 0:t.type});break;case c.AppEvents.WEBHOOK_CREATE:this.telemetryService.sendEvent({evt_type:"webhooks:created"});break;case c.AppEvents.WEBHOOK_DELETE:this.telemetryService.sendEvent({evt_type:"webhooks:deleted"});break;case c.AppEvents.WEBHOOK_UPDATE:this.telemetryService.sendEvent({evt_type:"webhooks:updated"});break;case c.AppEvents.FORM_COLUMN_UPDATE:this.telemetryService.sendEvent({evt_type:"formViewColumn:updated"});break;case c.AppEvents.SYNC_SOURCE_CREATE:this.telemetryService.sendEvent({evt_type:"syncSource:created"});break;case c.AppEvents.SYNC_SOURCE_DELETE:this.telemetryService.sendEvent({evt_type:"syncSource:deleted"});break;case c.AppEvents.VIEW_CREATE:{const e=t;this.telemetryService.sendEvent({evt_type:"vtable:created",show_as:e.showAs})}break;case c.AppEvents.GRID_COLUMN_UPDATE:this.telemetryService.sendEvent({evt_type:"gridViewColumn:updated"});break;case c.AppEvents.WEBHOOK_TEST:this.telemetryService.sendEvent({evt_type:"webhooks:tested"});break;case c.AppEvents.PROJECT_CREATE:{const{xcdb:e}=t;this.telemetryService.sendEvent({evt_type:"project:created",xcdb:e}),this.telemetryService.sendEvent({evt_type:"project:rest"})}break;case c.AppEvents.PROJECT_DELETE:this.telemetryService.sendEvent({evt_type:"project:deleted"});break;case c.AppEvents.PROJECT_UPDATE:this.telemetryService.sendEvent({evt_type:"project:update"});break;case c.AppEvents.UI_ACL_UPDATE:this.telemetryService.sendEvent({evt_type:"uiAcl:updated"});break;case c.AppEvents.META_DIFF_SYNC:t.base?this.telemetryService.sendEvent({evt_type:"baseMetaDiff:synced"}):this.telemetryService.sendEvent({evt_type:"metaDiff:synced"});break;case c.AppEvents.ORG_API_TOKEN_DELETE:this.telemetryService.sendEvent({evt_type:"org:apiToken:deleted"});break;case c.AppEvents.ORG_API_TOKEN_CREATE:this.telemetryService.sendEvent({evt_type:"org:apiToken:created"});break;case c.AppEvents.APIS_CREATED:}}onModuleDestroy(){var e;null===(e=this.unsubscribe)||void 0===e||e.call(this)}onModuleInit(){this.unsubscribe=this.appHooksService.onAll(this.hookHandler.bind(this))}async auditInsert(e){await u.Audit.insert(e);try{d.T.event(Object.assign(Object.assign({},e),{created_at:Date.now()}))}catch(e){this.logger.error(e)}}};h=i=o([(0,l.Injectable)(),r("design:paramtypes",["function"==typeof(n=void 0!==m.AppHooksService&&m.AppHooksService)?n:Object,"function"==typeof(s=void 0!==p.TelemetryService&&p.TelemetryService)?s:Object])],h),t.AppHooksListenerService=h},33206:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AppHooksService=void 0;const r=a(26481),l=a(2062),c="__nc_all_events__";let d=class{constructor(e){this.eventEmitter=e,this.listenerUnsubscribers=new Map}on(e,t){const a=this.eventEmitter.on(e,t);return this.listenerUnsubscribers.set(t,a),a}emit(e,t){this.eventEmitter.emit(e,t),this.eventEmitter.emit(c,{event:e,data:t})}removeListener(e,t){var a;null===(a=this.listenerUnsubscribers.get(t))||void 0===a||a(),this.listenerUnsubscribers.delete(t)}removeListeners(e){return this.eventEmitter.removeAllListeners(e)}removeAllListener(e){var t;null===(t=this.listenerUnsubscribers.get(e))||void 0===t||t(),this.listenerUnsubscribers.delete(e)}onAll(e){const t=this.eventEmitter.on(c,e);return this.listenerUnsubscribers.set(e,t),t}};d=n([(0,r.Injectable)(),o(0,(0,r.Inject)("IEventEmitter")),s("design:paramtypes",["function"==typeof(i=void 0!==l.IEventEmitter&&l.IEventEmitter)?i:Object])],d),t.AppHooksService=d},76696:function(e,t,a){var i,n=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return s(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentsService=void 0;const d=c(a(71017)),u=a(68281),p=a(26481),m=a(30754),f=c(a(32488)),h=a(33206),g=c(a(70781)),_=c(a(7232)),b=r(a(43902));let y=class{constructor(e){this.appHooksService=e}async upload(e){var t,a,i;const n=this.sanitizeUrlPath((null===(a=null===(t=e.path)||void 0===t?void 0:t.toString())||void 0===a?void 0:a.split("/"))||[""]),s=d.default.join("nc","uploads",...n),o=await g.default.storageAdapter(),r=await Promise.all(null===(i=e.files)||void 0===i?void 0:i.map((async e=>{const t=`${(0,m.nanoid)(18)}${d.default.extname(e.originalname)}`,a=await o.fileCreate((0,f.default)(d.default.join(s,t)),e);let i;return a||(i=`download/${n.join("/")}/${t}`),Object.assign(Object.assign(Object.assign({},a?{url:a}:{}),i?{path:i}:{}),{title:e.originalname,mimetype:e.mimetype,size:e.size,icon:b.mimeIcons[d.default.extname(e.originalname).slice(1)]||void 0})})));return this.appHooksService.emit(u.AppEvents.ATTACHMENT_UPLOAD,{type:"file"}),r}async uploadViaURL(e){var t,a,i,n;const s=this.sanitizeUrlPath((null===(a=null===(t=null==e?void 0:e.path)||void 0===t?void 0:t.toString())||void 0===a?void 0:a.split("/"))||[""]),o=d.default.join("nc","uploads",...s),r=await g.default.storageAdapter(),l=await Promise.all(null===(n=null===(i=e.urls)||void 0===i?void 0:i.map)||void 0===n?void 0:n.call(i,(async e=>{const{url:t,fileName:a}=e,i=`${(0,m.nanoid)(18)}${a||t.split("/").pop()}`,n=await r.fileCreateByUrl((0,f.default)(d.default.join(o,i)),t);let l;return n||(l=`download/${s.join("/")}/${i}`),Object.assign(Object.assign(Object.assign({},n?{url:n}:{}),l?{path:l}:{}),{title:i,mimetype:e.mimetype,size:e.size,icon:b.mimeIcons[d.default.extname(i).slice(1)]||void 0})})));return this.appHooksService.emit(u.AppEvents.ATTACHMENT_UPLOAD,{type:"url"}),l}async fileRead(e){const t=new _.default,a=b.default[d.default.extname(e.path).split("/").pop().slice(1)]||"text/plain";return{img:await t.fileRead((0,f.default)(e.path)),type:a}}sanitizeUrlPath(e){return e.map((e=>e.replace(/[/.?#]+/g,"_")))}};y=o([(0,p.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==h.AppHooksService&&h.AppHooksService)?i:Object])],y),t.AttachmentsService=y},82897:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuditsService=void 0;const r=a(26481),l=o(a(73059)),c=a(68281),d=a(62801),u=a(51401),p=a(78829),m=a(15147);let f=class{constructor(e){this.appHooksListenerService=e}async commentRow(e){var t;return(0,p.validatePayload)("swagger.json#/components/schemas/CommentReq",e.body),await m.Audit.insert(Object.assign(Object.assign({},e.body),{user:null===(t=e.user)||void 0===t?void 0:t.email,op_type:c.AuditOperationTypes.COMMENT}))}async auditRowUpdate(e){var t;(0,p.validatePayload)("swagger.json#/components/schemas/AuditRowUpdateReq",e.body);const a=await m.Model.getByIdOrName({id:e.body.fk_model_id});return await m.Audit.insert({fk_model_id:e.body.fk_model_id,row_id:e.rowId,op_type:c.AuditOperationTypes.DATA,op_sub_type:c.AuditOperationSubTypes.UPDATE,description:l.default.sanitize(`Table ${a.table_name} : field ${e.body.column_name} got changed from  ${e.body.prev_value} to ${e.body.value}`),details:l.default.sanitize(`<span class="">${e.body.column_name}</span>\n  : <span class="text-decoration-line-through red px-2 lighten-4 black--text">${e.body.prev_value}</span>\n  <span class="black--text green lighten-4 px-2">${e.body.value}</span>`),ip:e.clientIp,user:null===(t=e.user)||void 0===t?void 0:t.email})}async commentList(e){return await m.Audit.commentsList(e.query)}async auditList(e){return await m.Audit.projectAuditList(e.projectId,e.query)}async auditCount(e){var t;return await m.Audit.projectAuditCount(e.projectId,null===(t=e.query)||void 0===t?void 0:t.baseId)}async commentsCount(e){return await m.Audit.commentsCount({fk_model_id:e.fk_model_id,ids:e.ids})}async commentUpdate(e){(0,p.validatePayload)("swagger.json#/components/schemas/CommentUpdateReq",e.body);return(await m.Audit.get(e.auditId)).user!==e.userEmail&&u.NcError.unauthorized("Unauthorized access"),await m.Audit.commentUpdate(e.auditId,e.body)}async baseAuditList(e){return await m.Audit.baseAuditList(e.baseId,e.query)}async baseAuditCount(e){return await m.Audit.baseAuditCount(e.baseId)}};f=n([(0,r.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==d.AppHooksListenerService&&d.AppHooksListenerService)?i:Object])],f),t.AuditsService=f},12874:function(e,t,a){var i,n=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return s(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=void 0;const u=a(16464),p=a(68281),m=a(26481),f=r(a(98432)),h=a(25828),g=d(a(27552)),_=a(74564),b=a(1119);let y=class{constructor(e){this.usersService=e}async validateUser(e,t){const a=await this.usersService.findOne(e);if(a){const{password:e,salt:i}=a,n=c(a,["password","salt"]),s=await(0,u.promisify)(f.hash)(t,a.salt);if(a.password===s)return n}return null}async login(e){delete e.password,delete e.salt;const t=e;return{token:(0,_.genJwt)(t,g.default.getConfig())}}async signup(e){const{email:t,firstname:a,lastname:i}=e;let{password:n}=e;const s=t.toLowerCase();let o=await this.usersService.findOne(s);const r=await(0,u.promisify)(f.genSalt)(10);n=await(0,u.promisify)(f.hash)(n,r);const l=(0,h.v4)();return o||await this.registerNewUserIfAllowed({firstname:a,lastname:i,email:s,salt:r,password:n,email_verification_token:l}),o=await this.usersService.findOne(s),await this.login(o)}async registerNewUserIfAllowed({firstname:e,lastname:t,email:a,salt:i,password:n,email_verification_token:s}){const o=p.OrgUserRoles.CREATOR;return await this.usersService.insert({firstname:e,lastname:t,email:a,salt:i,password:n,email_verification_token:s,roles:o,token_version:""})}};y=o([(0,m.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==b.UsersService&&b.UsersService)?i:Object])],y),t.AuthService=y},45239:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BasesService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(39097),u=a(40516),p=a(15147);let m=class{constructor(e){this.appHooksService=e}async baseGetWithConfig(e){const t=await p.Base.get(e.baseId);return t.config=await t.getConnectionConfig(),t}async baseUpdate(e){var t;(0,c.validatePayload)("swagger.json#/components/schemas/BaseReq",e.base);const a=e.base,i=await p.Project.getWithInfo(e.projectId),n=await p.Base.updateBase(e.baseId,Object.assign(Object.assign({},a),{type:null===(t=a.config)||void 0===t?void 0:t.client,projectId:i.id,id:e.baseId}));return delete n.config,this.appHooksService.emit(r.AppEvents.BASE_UPDATE,{base:n}),n}async baseList(e){return await p.Base.list({projectId:e.projectId})}async baseDelete(e){const t=await p.Base.get(e.baseId);return await t.delete(),this.appHooksService.emit(r.AppEvents.BASE_DELETE,{base:t}),!0}async baseCreate(e){var t;(0,c.validatePayload)("swagger.json#/components/schemas/BaseReq",e.base);const a=e.base,i=await p.Project.getWithInfo(e.projectId),n=await p.Base.createBase(Object.assign(Object.assign({},a),{type:null===(t=a.config)||void 0===t?void 0:t.client,projectId:i.id}));await(0,u.syncBaseMigration)(i,n);const s=await(0,c.populateMeta)(n,i);return await(0,d.populateRollupColumnAndHideLTAR)(n,i),this.appHooksService.emit(r.AppEvents.APIS_CREATED,{info:s}),delete n.config,this.appHooksService.emit(r.AppEvents.BASE_CREATE,{base:n}),n}};m=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],m),t.BasesService=m},69905:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BulkDataAliasService=void 0;const s=a(26481),o=a(7214),r=n(a(19356)),l=a(15147);let c=class{async getModelViewBase(e){const{model:t,view:a}=await(0,o.getViewAndModelByAliasOrId)(e);return{model:t,view:a,base:await l.Base.get(t.base_id)}}async executeBulkOperation(e){const{model:t,view:a,base:i}=await this.getModelViewBase(e),n=await l.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await r.default.get(i)});return await n[e.operation].apply(null,e.options)}async bulkDataInsert(e){return await this.executeBulkOperation(Object.assign(Object.assign({},e),{operation:"bulkInsert",options:[e.body,{cookie:e.cookie,foreign_key_checks:e.foreign_key_checks,skip_hooks:e.skip_hooks,raw:e.raw}]}))}async bulkDataUpdate(e){return await this.executeBulkOperation(Object.assign(Object.assign({},e),{operation:"bulkUpdate",options:[e.body,{cookie:e.cookie,raw:e.raw}]}))}async bulkDataUpdateAll(e){return await this.executeBulkOperation(Object.assign(Object.assign({},e),{operation:"bulkUpdateAll",options:[e.query,e.body,{cookie:e.cookie}]}))}async bulkDataDelete(e){return await this.executeBulkOperation(Object.assign(Object.assign({},e),{operation:"bulkDelete",options:[e.body,{cookie:e.cookie}]}))}async bulkDataDeleteAll(e){return await this.executeBulkOperation(Object.assign(Object.assign({},e),{operation:"bulkDeleteAll",options:[e.query]}))}};c=i([(0,s.Injectable)()],c),t.BulkDataAliasService=c},35987:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CachesService=void 0;const s=a(26481),o=n(a(37912));let r=class{async cacheGet(){return await o.default.export()}async cacheDelete(){return await o.default.destroy(),!0}};r=i([(0,s.Injectable)()],r),t.CachesService=r},27695:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ColumnsService=t.Altered=void 0;const l=a(26481),c=a(68281),d=a(64190),u=r(a(71569)),p=a(33206),m=r(a(4766)),f=r(a(58564)),h=a(78829),g=a(51401),_=r(a(58177)),b=a(36002),y=r(a(35619)),w=r(a(95391)),v=a(15147),T=r(a(27552)),O=r(a(19356)),E=a(13609),S=a(5311);var I;async function k(e,t,a){if(t[e])return t[e];const i=await a();return t[e]=i,i}!function(e){e[e.NEW_COLUMN=1]="NEW_COLUMN",e[e.DELETE_COLUMN=4]="DELETE_COLUMN",e[e.UPDATE_COLUMN=8]="UPDATE_COLUMN"}(I=t.Altered||(t.Altered={}));let C=class{constructor(e,t){this.metaService=e,this.appHooksService=t,this.deleteHmOrBtRelation=async({relationColOpt:e,base:t,childColumn:a,childTable:i,parentColumn:n,parentTable:s,sqlMgr:o,ncMeta:r=T.default.ncMeta,virtual:l},d=!1)=>{var u,p,m,f;let h;if(h=e?e.fk_index_name:(null===(u=await i.getColumns(r).then((async e=>{for(const t of e)if(t.uidt===c.UITypes.LinkToAnotherRecord){const e=await t.getColOptions(r);if(e.fk_related_model_id===s.id)return{colOptions:e}}})))||void 0===u?void 0:u.colOptions).fk_index_name,!(null==e?void 0:e.virtual)&&!l)try{await o.sqlOpPlus(t,"relationDelete",{childColumn:a.column_name,childTable:i.table_name,parentTable:s.table_name,parentColumn:n.column_name,foreignKeyName:h})}catch(e){console.log(e.message)}if(!e)return;const g=await e.getRelatedTable(r).then((e=>e.getColumns(r))),_="bt"===e.type?"hm":"bt";for(const e of g){if(e.uidt!==c.UITypes.LinkToAnotherRecord)continue;const t=await e.getColOptions(r);if(t.fk_parent_column_id===n.id&&t.fk_child_column_id===a.id&&t.type===_){await v.Column.delete(e.id,r);break}}if(await v.Column.delete(e.fk_column_id,r),!d){const n=await v.Model.getWithInfo({id:i.id},r);if(null==e?void 0:e.virtual){const e=null!==(f=null===(m=null===(p=await o.sqlOp(t,"indexList",{tn:n.table_name}))||void 0===p?void 0:p.data)||void 0===m?void 0:m.list)&&void 0!==f?f:[];for(const i of e)i.cn===a.column_name&&await o.sqlOpPlus(t,"indexDelete",Object.assign(Object.assign({},i),{tn:n.table_name,columns:[a.column_name],indexName:i.index_name}))}const s=Object.assign(Object.assign({},n),{tn:n.table_name,originalColumns:n.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:n.columns.map((e=>e.id===a.id?Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name,altered:I.DELETE_COLUMN}):(e.cn=e.column_name,e)))});await o.sqlOpPlus(t,"tableUpdate",s)}await v.Column.delete(a.id,r)}}async columnUpdate(e){var t,a,i,n,s,o,r,l,d;const u=e.reuse||{},{cookie:p}=e,h=await v.Column.get({colId:e.columnId}),b=await k("table",u,(async()=>v.Model.getWithInfo({id:h.fk_model_id}))),y=await k("base",u,(async()=>v.Base.get(b.base_id))),w=(await k("sqlClient",u,(async()=>O.default.getSqlClient(y)))).knex.clientType(),S=v.Column.getMaxColumnNameLength(w);e.column.column_name.length>S&&g.NcError.badRequest(`Column name ${e.column.column_name} exceeds ${S} characters`),(0,c.isVirtualCol)(e.column)||await v.Column.checkTitleAvailable({column_name:e.column.column_name,fk_model_id:h.fk_model_id,exclude_id:e.columnId})||g.NcError.badRequest("Duplicate column name"),await v.Column.checkAliasAvailable({title:e.column.title,fk_model_id:h.fk_model_id,exclude_id:e.columnId})||g.NcError.badRequest("Duplicate column alias");let C=Object.assign({},e.column);if([c.UITypes.Lookup,c.UITypes.Rollup,c.UITypes.LinkToAnotherRecord,c.UITypes.Formula,c.UITypes.QrCode,c.UITypes.Barcode,c.UITypes.ForeignKey,c.UITypes.Links].includes(h.uidt))if(h.uidt===C.uidt){if([c.UITypes.QrCode,c.UITypes.Barcode].includes(h.uidt))await v.Column.update(h.id,Object.assign(Object.assign({},h),C));else if(h.uidt===c.UITypes.Formula){C.formula=await(0,c.substituteColumnAliasWithIdInFormula)(C.formula_raw||C.formula,b.columns);try{const e=await k("baseModel",u,(async()=>v.Model.getBaseModelSQL({id:b.id,dbDriver:await k("dbDriver",u,(async()=>O.default.get(y)))})));await(0,m.default)(e,C.formula,null,b,null,{},null,!0)}catch(e){console.error(e),g.NcError.badRequest("Invalid Formula")}await v.Column.update(h.id,Object.assign(Object.assign({},h),C))}else C.title!==h.title&&await v.Column.updateAlias(e.columnId,{title:C.title}),"meta"in C&&h.uidt===c.UITypes.Links&&await v.Column.updateMeta({colId:e.columnId,meta:C.meta});await this.updateRollupOrLookup(C,h)}else g.NcError.notImplemented(`Updating ${C.uidt} => ${C.uidt} is not implemented`);else if([c.UITypes.Lookup,c.UITypes.Rollup,c.UITypes.LinkToAnotherRecord,c.UITypes.Formula,c.UITypes.QrCode,c.UITypes.Barcode,c.UITypes.ForeignKey].includes(C.uidt))g.NcError.notImplemented(`Updating ${C.uidt} => ${C.uidt} is not implemented`);else if([c.UITypes.SingleSelect,c.UITypes.MultiSelect].includes(C.uidt)){C=await(0,_.default)(C,y);const l=await k("baseModel",u,(async()=>v.Model.getBaseModelSQL({id:b.id,dbDriver:await k("dbDriver",u,(async()=>O.default.get(y)))})));if(null===(t=C.colOptions)||void 0===t?void 0:t.options){const t=["mysql","mysql2","pg","mssql","sqlite3"],d=await k("dbDriver",u,(async()=>O.default.get(y))),m=d.clientType();if(h.uidt===c.UITypes.MultiSelect&&C.uidt===c.UITypes.SingleSelect&&("mysql"===m||"mysql2"===m?await d.raw("UPDATE ?? SET ?? = SUBSTRING_INDEX(??, ',', 1) WHERE ?? LIKE '%,%';",[b.table_name,h.column_name,h.column_name,h.column_name]):"pg"===m?await d.raw("UPDATE ?? SET ?? = split_part(??, ',', 1);",[b.table_name,h.column_name,h.column_name]):"mssql"===m?await d.raw("UPDATE ?? SET ?? = LEFT(cast(?? as varchar(max)), CHARINDEX(',', ??) - 1) WHERE CHARINDEX(',', ??) > 0;",[b.table_name,h.column_name,h.column_name,h.column_name,h.column_name]):"sqlite3"===m&&await d.raw("UPDATE ?? SET ?? = substr(??, 1, instr(??, ',') - 1) WHERE ?? LIKE '%,%';",[b.table_name,h.column_name,h.column_name,h.column_name,h.column_name])),null===(a=h.colOptions)||void 0===a?void 0:a.options)for(const e of h.colOptions.options.filter((e=>null===e.order)))e.title=e.title.replace(/^'/,"").replace(/'$/,"");const _=C.colOptions.options.map((e=>e.title.replace(/'/g,"''")));if(C.cdf){if(C.uidt===c.UITypes.SingleSelect)_.includes(C.cdf.replace(/'/g,"''"))||g.NcError.badRequest(`Default value '${C.cdf}' is not a select option.`);else for(const e of C.cdf.split(","))_.includes(e.replace(/'/g,"''"))||g.NcError.badRequest(`Default value '${e}' is not a select option.`);C.cdf="mysql"===m||"mysql2"===m?C.cdf.replace(/'/g,"'"):C.cdf.replace(/'/g,"''"),"pg"===m&&(C.cdf=`'${C.cdf}'`)}const w=C.colOptions.options.map((e=>e.title));if(w.some((function(e){return w.indexOf(e)!==w.lastIndexOf(e)}))&&g.NcError.badRequest("Duplicates are not allowed!"),w.some((function(e){return""===e}))&&g.NcError.badRequest("Empty options are not allowed!"),"enum"===C.dt||"set"===C.dt)for(const e of C.colOptions.options)e.title=e.title.trimEnd();if(C.uidt===c.UITypes.SingleSelect?C.dtxp=(null===(i=C.colOptions)||void 0===i?void 0:i.options.length)?`${C.colOptions.options.map((e=>`'${e.title.replace(/'/gi,"''")}'`)).join(",")}`:"":C.uidt===c.UITypes.MultiSelect&&(C.dtxp=(null===(n=C.colOptions)||void 0===n?void 0:n.options.length)?`${C.colOptions.options.map((e=>(e.title.includes(",")&&g.NcError.badRequest("Illegal char(',') for MultiSelect"),`'${e.title.replace(/'/gi,"''")}'`))).join(",")}`:""),"mysql"!==m&&"mysql2"!==m||(C.colOptions.options.length||C.dtxp&&""!==C.dtxp||(C.dtxp="''"),"set"===C.dt&&(null===(s=C.colOptions)||void 0===s?void 0:s.options.length)>64&&(C.dt="text")),null===(o=h.colOptions)||void 0===o?void 0:o.options)for(const e of h.colOptions.options.filter((e=>!C.colOptions.options.find((t=>t.id===e.id)))))t.includes(m)||h.uidt!==c.UITypes.MultiSelect||g.NcError.badRequest("Your database not yet supported for this operation. Please remove option from records manually before dropping."),h.uidt===c.UITypes.SingleSelect?"mssql"===m?await d.raw("UPDATE ?? SET ?? = NULL WHERE ?? LIKE ?",[b.table_name,h.column_name,h.column_name,e.title]):await l.bulkUpdateAll({where:`(${h.title},eq,${e.title})`},{[h.column_name]:null},{cookie:p}):h.uidt===c.UITypes.MultiSelect&&("mysql"===m||"mysql2"===m?"set"===C.dt?await d.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), ',')) WHERE FIND_IN_SET(?, ??)",[b.table_name,h.column_name,h.column_name,e.title,e.title,h.column_name]):await d.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), ','))",[b.table_name,h.column_name,h.column_name,e.title]):"pg"===m?await d.raw("UPDATE ?? SET ??  = array_to_string(array_remove(string_to_array(??, ','), ?), ',')",[b.table_name,h.column_name,h.column_name,e.title]):"mssql"===m?await d.raw("UPDATE ?? SET ?? = substring(replace(concat(',', ??, ','), concat(',', ?, ','), ','), 2, len(replace(concat(',', ??, ','), concat(',', ?, ','), ',')) - 2)",[b.table_name,h.column_name,h.column_name,e.title,h.column_name,e.title]):"sqlite3"===m&&await d.raw("UPDATE ?? SET ?? = TRIM(REPLACE(',' || ?? || ',', ',' || ? || ',', ','), ',')",[b.table_name,h.column_name,h.column_name,e.title]));const T=[];if(null===(r=h.colOptions)||void 0===r?void 0:r.options){const a=h.colOptions.options.map((e=>e.title));for(const i of h.colOptions.options.filter((e=>C.colOptions.options.find((t=>t.id===e.id&&t.title!==e.title))))){t.includes(m)||h.uidt!==c.UITypes.MultiSelect||g.NcError.badRequest("Your database not yet supported for this operation. Please remove option from records manually before updating.");const n=Object.assign({},C.colOptions.options.find((e=>i.id===e.id)));if(a.includes(n.title)){const e=Object.assign({},n);let t=1;for(;a.includes(n.title);)n.title=`${e.title}_${t++}`;T.push({def_option:e,temp_title:n.title})}if(!("mysql"!==m&&"mysql2"!==m||"enum"!==h.dt&&"set"!==h.dt)){h.colOptions.options.push({title:n.title});let t="";h.uidt===c.UITypes.SingleSelect?t=h.colOptions.options.length?`${h.colOptions.options.map((e=>`'${e.title.replace(/'/gi,"''")}'`)).join(",")}`:"":h.uidt===c.UITypes.MultiSelect&&(t=h.colOptions.options.length?`${h.colOptions.options.map((e=>{if(e.title.includes(","))throw g.NcError.badRequest("Illegal char(',') for MultiSelect"),new Error("");return`'${e.title.replace(/'/gi,"''")}'`})).join(",")}`:"");const a=Object.assign(Object.assign({},b),{tn:b.table_name,originalColumns:b.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:await Promise.all(b.columns.map((async a=>{if(a.id===e.columnId){const e=Object.assign(Object.assign(Object.assign({},a),h),{cn:h.column_name,cno:a.column_name,dtxp:t,altered:I.UPDATE_COLUMN});return Promise.resolve(e)}return a.cn=a.column_name,Promise.resolve(a)})))}),i=await k("sqlMgr",u,(async()=>f.default.getSqlMgr({id:y.project_id})));await i.sqlOpPlus(y,"tableUpdate",a),await v.Column.update(e.columnId,Object.assign({},h))}h.uidt===c.UITypes.SingleSelect?"mssql"===m?await d.raw("UPDATE ?? SET ?? = ? WHERE ?? LIKE ?",[b.table_name,h.column_name,n.title,h.column_name,i.title]):await l.bulkUpdateAll({where:`(${h.title},eq,${i.title})`},{[h.column_name]:n.title},{cookie:p}):h.uidt===c.UITypes.MultiSelect&&("mysql"===m||"mysql2"===m?"set"===C.dt?await d.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), CONCAT(',', ?, ','))) WHERE FIND_IN_SET(?, ??)",[b.table_name,h.column_name,h.column_name,i.title,n.title,i.title,h.column_name]):await d.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), CONCAT(',', ?, ',')))",[b.table_name,h.column_name,h.column_name,i.title,n.title]):"pg"===m?await d.raw("UPDATE ?? SET ??  = array_to_string(array_replace(string_to_array(??, ','), ?, ?), ',')",[b.table_name,h.column_name,h.column_name,i.title,n.title]):"mssql"===m?await d.raw("UPDATE ?? SET ?? = substring(replace(concat(',', ??, ','), concat(',', ?, ','), concat(',', ?, ',')), 2, len(replace(concat(',', ??, ','), concat(',', ?, ','), concat(',', ?, ','))) - 2)",[b.table_name,h.column_name,h.column_name,i.title,n.title,h.column_name,i.title,n.title]):"sqlite3"===m&&await d.raw("UPDATE ?? SET ?? = TRIM(REPLACE(',' || ?? || ',', ',' || ? || ',', ',' || ? || ','), ',')",[b.table_name,h.column_name,h.column_name,i.title,n.title]))}}for(const e of T){const t=e.def_option;h.uidt===c.UITypes.SingleSelect?"mssql"===m?await d.raw("UPDATE ?? SET ?? = ? WHERE ?? LIKE ?",[b.table_name,h.column_name,t.title,h.column_name,e.temp_title]):await l.bulkUpdateAll({where:`(${h.title},eq,${e.temp_title})`},{[h.column_name]:t.title},{cookie:p}):h.uidt===c.UITypes.MultiSelect&&("mysql"===m||"mysql2"===m?"set"===C.dt?await d.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), CONCAT(',', ?, ','))) WHERE FIND_IN_SET(?, ??)",[b.table_name,h.column_name,h.column_name,e.temp_title,t.title,e.temp_title,h.column_name]):await d.raw("UPDATE ?? SET ?? = TRIM(BOTH ',' FROM REPLACE(CONCAT(',', ??, ','), CONCAT(',', ?, ','), CONCAT(',', ?, ',')))",[b.table_name,h.column_name,h.column_name,e.temp_title,t.title,e.temp_title,h.column_name]):"pg"===m?await d.raw("UPDATE ?? SET ??  = array_to_string(array_replace(string_to_array(??, ','), ?, ?), ',')",[b.table_name,h.column_name,h.column_name,e.temp_title,t.title]):"mssql"===m?await d.raw("UPDATE ?? SET ?? = substring(replace(concat(',', ??, ','), concat(',', ?, ','), concat(',', ?, ',')), 2, len(replace(concat(',', ??, ','), concat(',', ?, ','), concat(',', ?, ','))) - 2)",[b.table_name,h.column_name,h.column_name,e.temp_title,t.title,h.column_name,e.temp_title,t.title]):"sqlite3"===m&&await d.raw("UPDATE ?? SET ?? = TRIM(REPLACE(',' || ?? || ',', ',' || ? || ',', ',' || ? || ','), ',')",[b.table_name,h.column_name,h.column_name,e.temp_title,t.title]))}}const d=Object.assign(Object.assign({},b),{tn:b.table_name,originalColumns:b.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:await Promise.all(b.columns.map((async t=>{if(t.id===e.columnId){const e=Object.assign(Object.assign(Object.assign({},t),C),{cn:C.column_name,cno:t.column_name,altered:I.UPDATE_COLUMN});if(t.column_name!=C.column_name){const e=await T.default.ncMeta.knex(E.MetaTable.COL_FORMULA).where("formula","like",`%${t.id}%`);if(e){const a=t;a.column_name=C.column_name,a.title=C.title;for(const i of e){const e=i.formula,n=(0,c.substituteColumnIdWithAliasInFormula)(e,[a]);await v.FormulaColumn.update(t.id,{formula_raw:n})}}}return Promise.resolve(e)}return t.cn=t.column_name,Promise.resolve(t)})))}),m=await k("sqlMgr",u,(async()=>f.default.getSqlMgr({id:y.project_id})));await m.sqlOpPlus(y,"tableUpdate",d),await v.Column.update(e.columnId,Object.assign({},C))}else{C=await(0,_.default)(C,y);const t=Object.assign(Object.assign({},b),{tn:b.table_name,originalColumns:b.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:await Promise.all(b.columns.map((async t=>{if(t.id===e.columnId){const e=Object.assign(Object.assign(Object.assign({},t),C),{cn:C.column_name,cno:t.column_name,altered:I.UPDATE_COLUMN});if(t.column_name!=C.column_name){const e=await T.default.ncMeta.knex(E.MetaTable.COL_FORMULA).where("formula","like",`%${t.id}%`);if(e){const a=t;a.column_name=C.column_name,a.title=C.title;for(const i of e){const e=i.formula,n=(0,c.substituteColumnIdWithAliasInFormula)(e,[a]);await v.FormulaColumn.update(t.id,{formula_raw:n})}}}return Promise.resolve(e)}return t.cn=t.column_name,Promise.resolve(t)})))}),a=await k("sqlMgr",u,(async()=>f.default.getSqlMgr({id:y.project_id})));await a.sqlOpPlus(y,"tableUpdate",t),await v.Column.update(e.columnId,Object.assign({},C))}return await b.getColumns(),this.appHooksService.emit(c.AppEvents.COLUMN_UPDATE,{table:b,column:h,user:null===(l=e.req)||void 0===l?void 0:l.user,ip:null===(d=e.req)||void 0===d?void 0:d.clientIp}),b}async columnGet(e){return v.Column.get({colId:e.columnId})}async columnSetAsPrimary(e){const t=await v.Column.get({colId:e.columnId});return v.Model.updatePrimaryColumn(t.fk_model_id,t.id)}async columnAdd(e){var t,a,i,n,s,o,r,l;(0,h.validatePayload)("swagger.json#/components/schemas/ColumnReq",e.column);const d=e.reuse||{},u=await k("table",d,(async()=>v.Model.getWithInfo({id:e.tableId}))),p=await k("base",d,(async()=>v.Base.get(u.base_id))),b=await k("project",d,(async()=>p.getProject()));if(e.column.title||e.column.column_name){const t=(await k("dbDriver",d,(async()=>O.default.get(p)))).clientType(),a=v.Column.getMaxColumnNameLength(t);(e.column.title||e.column.column_name).length>a&&g.NcError.badRequest(`Column name ${e.column.title||e.column.column_name} exceeds ${a} characters`)}(0,c.isVirtualCol)(e.column)||await v.Column.checkTitleAvailable({column_name:e.column.column_name,fk_model_id:e.tableId})||g.NcError.badRequest("Duplicate column name"),await v.Column.checkAliasAvailable({title:e.column.title||e.column.column_name,fk_model_id:e.tableId})||g.NcError.badRequest("Duplicate column alias");let y=e.column;switch(y.uidt){case c.UITypes.Rollup:await(0,h.validateRollupPayload)(e.column),await v.Column.insert(Object.assign(Object.assign({},y),{fk_model_id:u.id}));break;case c.UITypes.Lookup:await(0,h.validateLookupPayload)(e.column),await v.Column.insert(Object.assign(Object.assign({},y),{fk_model_id:u.id}));break;case c.UITypes.Links:case c.UITypes.LinkToAnotherRecord:await this.createLTARColumn(Object.assign(Object.assign({},e),{base:p,project:b,reuse:d})),this.appHooksService.emit(c.AppEvents.RELATION_DELETE,{column:Object.assign(Object.assign({},y),{fk_model_id:e.tableId,project_id:b.id,base_id:p.id})});break;case c.UITypes.QrCode:case c.UITypes.Barcode:await v.Column.insert(Object.assign(Object.assign({},y),{fk_model_id:u.id}));break;case c.UITypes.Formula:y.formula=await(0,c.substituteColumnAliasWithIdInFormula)(y.formula_raw||y.formula,u.columns);try{const e=await k("baseModel",d,(async()=>v.Model.getBaseModelSQL({id:u.id,dbDriver:await k("dbDriver",d,(async()=>O.default.get(p)))})));await(0,m.default)(e,y.formula,null,u,null,{},null,!0)}catch(e){console.error(e),g.NcError.badRequest("Invalid Formula")}await v.Column.insert(Object.assign(Object.assign({},y),{fk_model_id:u.id}));break;default:{if(y=await(0,_.default)(y,p),y.uidt===c.UITypes.Duration&&(y.dtxp="20",y.dtxs="4"),[c.UITypes.SingleSelect,c.UITypes.MultiSelect].includes(y.uidt)){const e=(await O.default.get(p)).clientType(),n=y.colOptions.options.map((e=>e.title.replace(/'/g,"''")));if(y.dtxs="",y.cdf){if(y.uidt===c.UITypes.SingleSelect)n.includes(y.cdf.replace(/'/g,"''"))||g.NcError.badRequest(`Default value '${y.cdf}' is not a select option.`);else for(const e of y.cdf.split(","))n.includes(e.replace(/'/g,"''"))||g.NcError.badRequest(`Default value '${e}' is not a select option.`);y.cdf="mysql"===e||"mysql2"===e?y.cdf.replace(/'/g,"'"):y.cdf.replace(/'/g,"''"),"pg"===e&&(y.cdf=`'${y.cdf}'`)}const s=y.colOptions.options.map((e=>e.title));if(s.some((function(e){return s.indexOf(e)!==s.lastIndexOf(e)}))&&g.NcError.badRequest("Duplicates are not allowed!"),s.some((function(e){return""===e}))&&g.NcError.badRequest("Empty options are not allowed!"),"enum"===y.dt||"set"===y.dt)for(const e of y.colOptions.options)e.title=e.title.trimEnd();y.uidt===c.UITypes.SingleSelect?y.dtxp=(null===(t=y.colOptions)||void 0===t?void 0:t.options.length)?`${y.colOptions.options.map((e=>`'${e.title.replace(/'/gi,"''")}'`)).join(",")}`:"":y.uidt===c.UITypes.MultiSelect&&(y.dtxp=(null===(a=y.colOptions)||void 0===a?void 0:a.options.length)?`${y.colOptions.options.map((e=>(e.title.includes(",")&&g.NcError.badRequest("Illegal char(',') for MultiSelect"),`'${e.title.replace(/'/gi,"''")}'`))).join(",")}`:""),"mysql"!==e&&"mysql2"!==e||(y.colOptions.options.length||y.dtxp&&""!==y.dtxp||(y.dtxp="''"),"set"===y.dt&&(null===(i=y.colOptions)||void 0===i?void 0:i.options.length)>64&&(y.dt="text"))}const e=Object.assign(Object.assign({},u),{tn:u.table_name,originalColumns:u.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),columns:[...u.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),Object.assign(Object.assign({},y),{cn:y.column_name,altered:I.NEW_COLUMN})]}),r=await k("sqlClient",d,(async()=>O.default.getSqlClient(p))),l=await k("sqlMgr",d,(async()=>f.default.getSqlMgr({id:p.project_id})));await l.sqlOpPlus(p,"tableUpdate",e);const m=(null===(o=null===(s=await r.columnList({tn:u.table_name,schema:null===(n=p.getConfig())||void 0===n?void 0:n.schema}))||void 0===s?void 0:s.data)||void 0===o?void 0:o.list).find((e=>e.cn===y.column_name))||{};await v.Column.insert(Object.assign(Object.assign(Object.assign({},y),m),{dtxp:[c.UITypes.MultiSelect,c.UITypes.SingleSelect].includes(y.uidt)?y.dtxp:m.dtxp,fk_model_id:u.id}))}}return await u.getColumns(),this.appHooksService.emit(c.AppEvents.COLUMN_CREATE,{table:u,column:Object.assign(Object.assign({},y),{fk_model_id:u.id}),user:null===(r=e.req)||void 0===r?void 0:r.user,ip:null===(l=e.req)||void 0===l?void 0:l.clientIp}),u}async columnDelete(e,t=this.metaService){var a,i;const n=e.reuse||{},s=await v.Column.get({colId:e.columnId},t),o=await k("table",n,(async()=>v.Model.getWithInfo({id:s.fk_model_id},t))),r=await k("base",n,(async()=>v.Base.get(o.base_id,t))),l=await k("sqlMgr",n,(async()=>f.default.getSqlMgr({id:r.project_id},t)));switch(s.uidt){case c.UITypes.Lookup:case c.UITypes.Rollup:case c.UITypes.QrCode:case c.UITypes.Barcode:case c.UITypes.Formula:await v.Column.delete(e.columnId,t);break;case c.UITypes.Links:case c.UITypes.LinkToAnotherRecord:{const e=await s.getColOptions(t),a=await e.getChildColumn(t),i=await a.getModel(t),n=await e.getParentColumn(t),o=await n.getModel(t);switch(e.type){case"bt":case"hm":await this.deleteHmOrBtRelation({relationColOpt:e,base:r,childColumn:a,childTable:i,parentColumn:n,parentTable:o,sqlMgr:l,ncMeta:t});break;case"mm":{const s=await e.getMMModel(t),d=await e.getMMParentColumn(t),u=await e.getMMChildColumn(t);await this.deleteHmOrBtRelation({relationColOpt:null,parentColumn:n,childTable:s,sqlMgr:l,parentTable:o,childColumn:d,base:r,ncMeta:t,virtual:!!e.virtual},!0),await this.deleteHmOrBtRelation({relationColOpt:null,parentColumn:a,childTable:s,sqlMgr:l,parentTable:i,childColumn:u,base:r,ncMeta:t,virtual:!!e.virtual},!0);const p=await e.getRelatedTable(t).then((e=>e.getColumns(t)));for(const e of p){if(!(0,c.isLinksOrLTAR)(e.uidt))continue;const i=await e.getColOptions(t);if("mm"===i.type&&i.fk_parent_column_id===a.id&&i.fk_child_column_id===n.id&&i.fk_mm_model_id===s.id&&i.fk_mm_parent_column_id===u.id&&i.fk_mm_child_column_id===d.id){await v.Column.delete(e.id,t);break}}await v.Column.delete(e.fk_column_id,t),await s.getColumns(t);for(const e of s.columns){if(!(0,c.isLinksOrLTAR)(e.uidt))continue;"bt"===(await e.getColOptions(t)).type&&await v.Column.delete(e.id,t)}await o.getColumns(t);for(const e of o.columns){if(!(0,c.isLinksOrLTAR)(e.uidt))continue;(await e.getColOptions(t)).fk_related_model_id===s.id&&await v.Column.delete(e.id,t)}await i.getColumns(t);for(const e of i.columns){if(!(0,c.isLinksOrLTAR)(e.uidt))continue;(await e.getColOptions(t)).fk_related_model_id===s.id&&await v.Column.delete(e.id,t)}await s.getColumns(t),2===s.columns.length&&(s.tn=s.table_name,await l.sqlOpPlus(r,"tableDelete",s),await s.delete(t))}}}this.appHooksService.emit(c.AppEvents.RELATION_DELETE,{column:s});break;case c.UITypes.ForeignKey:g.NcError.notImplemented();break;case c.UITypes.SingleSelect:s.uidt===c.UITypes.SingleSelect&&await v.KanbanView.IsColumnBeingUsedAsGroupingField(s.id)&&g.NcError.badRequest(`The column '${s.column_name}' is being used in Kanban View. Please delete Kanban View first.`);default:{const a=Object.assign(Object.assign({},o),{tn:o.table_name,originalColumns:o.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name,cno:e.column_name}))),columns:o.columns.map((t=>t.id===e.columnId?Object.assign(Object.assign({},t),{cn:t.column_name,cno:t.column_name,altered:I.DELETE_COLUMN}):(t.cn=t.column_name,t)))});await l.sqlOpPlus(r,"tableUpdate",a),await v.Column.delete(e.columnId,t)}}await o.getColumns(t);const d=(0,y.default)(o.columns);return d&&await v.Model.updatePrimaryColumn(d.fk_model_id,d.id,t),this.appHooksService.emit(c.AppEvents.COLUMN_DELETE,{table:o,column:s,user:null===(a=e.req)||void 0===a?void 0:a.user,ip:null===(i=e.req)||void 0===i?void 0:i.clientIp}),o}async createLTARColumn(e){var t,a,i,n,s,o,r,l;(0,w.default)(["parentId","childId","type"],e.column);const u=null!==(t=e.reuse)&&void 0!==t?t:{},p=await v.Model.getWithInfo({id:e.column.parentId}),m=await v.Model.getWithInfo({id:e.column.childId});let g;const _=await k("sqlMgr",u,(async()=>f.default.getSqlMgr({id:e.base.project_id}))),y=e.column.uidt===c.UITypes.Links;if(e.base.isMeta()&&(e.column.virtual=!0),"hm"===e.column.type||"bt"===e.column.type){const t=(0,b.getUniqueColumnName)(await m.getColumns(),`${p.table_name}_id`);let a;{const i={cn:t,title:t,column_name:t,rqd:!1,pk:!1,ai:!1,cdf:null,dt:p.primaryKey.dt,dtxp:p.primaryKey.dtxp,dtxs:p.primaryKey.dtxs,un:p.primaryKey.un,altered:I.NEW_COLUMN},n=Object.assign(Object.assign({},m),{tn:m.table_name,originalColumns:m.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),columns:[...m.columns.map((e=>Object.assign(Object.assign({},e),{cn:e.column_name}))),i]});await _.sqlOpPlus(e.base,"tableUpdate",n);const{id:s}=await v.Column.insert(Object.assign(Object.assign({},i),{uidt:c.UITypes.ForeignKey,fk_model_id:m.id}));g=await v.Column.get({colId:s}),e.column.virtual||(a=(0,h.generateFkName)(p,m),await _.sqlOpPlus(e.base,"relationCreate",{childColumn:t,childTable:m.table_name,parentTable:p.table_name,onDelete:"NO ACTION",onUpdate:"NO ACTION",type:"real",parentColumn:p.primaryKey.column_name,foreignKeyName:a})),("pg"===e.base.type||e.column.virtual)&&await this.createColumnIndex({column:new v.Column(Object.assign(Object.assign({},i),{fk_model_id:m.id})),base:e.base,sqlMgr:_})}await(0,h.createHmAndBtColumn)(m,p,g,e.column.type,e.column.title,a,e.column.virtual,null,e.column.meta,y)}else if("mm"===e.column.type){const t=`${null!==(i=null===(a=e.project)||void 0===a?void 0:a.prefix)&&void 0!==i?i:""}_nc_m2m_${(0,h.randomID)()}`,u=t,f=p.primaryKey,g=m.primaryKey,w=[],T="table1_id",O="table2_id";w.push({cn:O,column_name:O,title:O,rqd:!0,pk:!0,ai:!1,cdf:null,dt:g.dt,dtxp:g.dtxp,dtxs:g.dtxs,un:g.un,altered:1,uidt:c.UITypes.ForeignKey},{cn:T,column_name:T,title:T,rqd:!0,pk:!0,ai:!1,cdf:null,dt:f.dt,dtxp:f.dtxp,dtxs:f.dtxs,un:f.un,altered:1,uidt:c.UITypes.ForeignKey}),await _.sqlOpPlus(e.base,"tableCreate",{tn:t,_tn:u,columns:w});const E=await v.Model.insert(e.project.id,e.base.id,{table_name:t,title:u,mm:!0,columns:w});let S,I;if(!e.column.virtual){S=(0,h.generateFkName)(p,m),I=(0,h.generateFkName)(p,m);const a=Object.assign(Object.assign({},e.column),{childTable:t,childColumn:T,parentTable:p.table_name,parentColumn:f.column_name,type:"real",foreignKeyName:S}),i=Object.assign(Object.assign({},e.column),{childTable:t,childColumn:O,parentTable:m.table_name,parentColumn:g.column_name,type:"real",foreignKeyName:I});await _.sqlOpPlus(e.base,"relationCreate",a),await _.sqlOpPlus(e.base,"relationCreate",i)}const k=null===(n=await E.getColumns())||void 0===n?void 0:n.find((e=>e.column_name===T)),C=null===(s=await E.getColumns())||void 0===s?void 0:s.find((e=>e.column_name===O));await(0,h.createHmAndBtColumn)(E,m,C,null,null,S,e.column.virtual,!0),await(0,h.createHmAndBtColumn)(E,p,k,null,null,I,e.column.virtual,!0),await v.Column.insert({title:(0,b.getUniqueColumnAliasName)(await m.getColumns(),(0,d.pluralize)(p.title)),uidt:y?c.UITypes.Links:c.UITypes.LinkToAnotherRecord,type:"mm",fk_model_id:m.id,fk_child_column_id:g.id,fk_parent_column_id:f.id,fk_mm_model_id:E.id,fk_mm_child_column_id:C.id,fk_mm_parent_column_id:k.id,fk_related_model_id:p.id,virtual:e.column.virtual,meta:{plural:(0,d.pluralize)(p.title),singular:(0,d.singularize)(p.title)},system:p.id===m.id}),await v.Column.insert({title:(0,b.getUniqueColumnAliasName)(await p.getColumns(),null!==(o=e.column.title)&&void 0!==o?o:(0,d.pluralize)(m.title)),uidt:y?c.UITypes.Links:c.UITypes.LinkToAnotherRecord,type:"mm",fk_model_id:p.id,fk_child_column_id:f.id,fk_parent_column_id:g.id,fk_mm_model_id:E.id,fk_mm_child_column_id:k.id,fk_mm_parent_column_id:C.id,fk_related_model_id:m.id,virtual:e.column.virtual,meta:{plural:(null===(r=e.column.meta)||void 0===r?void 0:r.plural)||(0,d.pluralize)(m.title),singular:(null===(l=e.column.meta)||void 0===l?void 0:l.singular)||(0,d.singularize)(m.title)}}),"pg"===e.base.type&&(await this.createColumnIndex({column:new v.Column(Object.assign(Object.assign({},w[0]),{fk_model_id:E.id})),base:e.base,sqlMgr:_}),await this.createColumnIndex({column:new v.Column(Object.assign(Object.assign({},w[1]),{fk_model_id:E.id})),base:e.base,sqlMgr:_}))}}async createColumnIndex({column:e,sqlMgr:t,base:a,indexName:i=null,nonUnique:n=!0}){const s=await e.getModel(),o={columns:[e.column_name],tn:s.table_name,non_unique:n,indexName:i};t.sqlOpPlus(a,"indexCreate",o)}async updateRollupOrLookup(e,t){c.UITypes.Lookup===t.uidt&&(0,h.validateRequiredField)(e,["fk_lookup_column_id","fk_relation_column_id"])?(await(0,h.validateLookupPayload)(e,t.id),await v.Column.update(t.id,e)):c.UITypes.Rollup===t.uidt&&(0,h.validateRequiredField)(e,["fk_relation_column_id","fk_rollup_column_id","rollup_function"])&&(await(0,h.validateRollupPayload)(e),await v.Column.update(t.id,e))}async columnsHash(e){const t=await v.Model.getWithInfo({id:e});t||g.NcError.badRequest("Table not found");const a=await t.getColumns();return{hash:(0,u.default)(a)}}async columnBulk(e,t,a){var i,n;const s=await v.Model.getWithInfo({id:e});s||g.NcError.badRequest("Table not found");const o=await s.getColumns();(0,u.default)(o)!==t.hash&&g.NcError.badRequest("Columns are updated by someone else! Your changes are rejected. Please refresh the page and try again.");const r=await v.Base.get(s.base_id);r||g.NcError.badRequest("Base not found");const l=await r.getProject();l||g.NcError.badRequest("Project not found");const c=await O.default.get(r),d=await O.default.getSqlClient(r),p=await f.default.getSqlMgr({id:r.project_id}),m=await v.Model.getBaseModelSQL({id:s.id,dbDriver:c});c&&d&&p&&m||g.NcError.badRequest("There was an error handling your request");const h={table:s,base:r,project:l,dbDriver:c,sqlClient:d,sqlMgr:p,baseModel:m},_=t.ops;for(const e of _)"update"===e.op?e.column&&(null===(i=e.column)||void 0===i?void 0:i.id)||g.NcError.badRequest("Bad request, update operation requires column id"):"delete"===e.op?e.column&&(null===(n=e.column)||void 0===n?void 0:n.id)||g.NcError.badRequest("Bad request, delete operation requires column id"):"add"===e.op&&(e.column||g.NcError.badRequest("Bad request, add operation requires column"));const b=[];for(const t of _){const i=t.column;if("add"===t.op)try{await this.columnAdd({tableId:e,column:i,req:a,user:a.user,reuse:h})}catch(e){b.push(Object.assign(Object.assign({},t),{error:e.message}))}else if("update"===t.op)try{await this.columnUpdate({columnId:t.column.id,column:i,req:a,user:a.user,reuse:h})}catch(e){b.push(Object.assign(Object.assign({},t),{error:e.message}))}else if("delete"===t.op)try{await this.columnDelete({columnId:t.column.id,req:a,user:a.user})}catch(e){b.push(Object.assign(Object.assign({},t),{error:e.message}))}}return{failedOps:b}}};C=s([(0,l.Injectable)(),o("design:paramtypes",["function"==typeof(i=void 0!==S.MetaService&&S.MetaService)?i:Object,"function"==typeof(n=void 0!==p.AppHooksService&&p.AppHooksService)?n:Object])],C),t.ColumnsService=C},26234:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataAliasNestedService=void 0;const s=a(26481),o=a(68281),r=a(51401),l=a(60498),c=a(7214),d=a(15147),u=n(a(19356));let p=class{async mmList(e){const{model:t,view:a}=await(0,c.getViewAndModelByAliasOrId)(e);t||r.NcError.notFound("Table not found");const i=await d.Base.get(t.base_id),n=await d.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await u.default.get(i)}),s=await(0,c.getColumnByIdOrName)(e.columnName,t);s&&[o.UITypes.LinkToAnotherRecord,o.UITypes.Links].includes(s.uidt)||r.NcError.badRequest("Column is not LTAR");const p=await n.mmList({colId:s.id,parentId:e.rowId},e.query),m=await n.mmListCount({colId:s.id,parentId:e.rowId});return new l.PagedResponseImpl(p,Object.assign({count:m},e.query))}async mmExcludedList(e){const{model:t,view:a}=await(0,c.getViewAndModelByAliasOrId)(e);t||r.NcError.notFound("Table not found");const i=await d.Base.get(t.base_id),n=await d.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await u.default.get(i)}),s=await(0,c.getColumnByIdOrName)(e.columnName,t),o=await n.getMmChildrenExcludedList({colId:s.id,pid:e.rowId},e.query),p=await n.getMmChildrenExcludedListCount({colId:s.id,pid:e.rowId},e.query);return new l.PagedResponseImpl(o,Object.assign({count:p},e.query))}async hmExcludedList(e){const{model:t,view:a}=await(0,c.getViewAndModelByAliasOrId)(e);t||r.NcError.notFound("Table not found");const i=await d.Base.get(t.base_id),n=await d.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await u.default.get(i)}),s=await(0,c.getColumnByIdOrName)(e.columnName,t),o=await n.getHmChildrenExcludedList({colId:s.id,pid:e.rowId},e.query),p=await n.getHmChildrenExcludedListCount({colId:s.id,pid:e.rowId},e.query);return new l.PagedResponseImpl(o,Object.assign({count:p},e.query))}async btExcludedList(e){const{model:t,view:a}=await(0,c.getViewAndModelByAliasOrId)(e);t||r.NcError.notFound("Table not found");const i=await d.Base.get(t.base_id),n=await d.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await u.default.get(i)}),s=await(0,c.getColumnByIdOrName)(e.columnName,t),o=await n.getBtChildrenExcludedList({colId:s.id,cid:e.rowId},e.query),p=await n.getBtChildrenExcludedListCount({colId:s.id,cid:e.rowId},e.query);return new l.PagedResponseImpl(o,Object.assign({count:p},e.query))}async hmList(e){const{model:t,view:a}=await(0,c.getViewAndModelByAliasOrId)(e);t||r.NcError.notFound("Table not found");const i=await d.Base.get(t.base_id),n=await d.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await u.default.get(i)}),s=await(0,c.getColumnByIdOrName)(e.columnName,t);[o.UITypes.LinkToAnotherRecord,o.UITypes.Links].includes(s.uidt)||r.NcError.badRequest("Column is not LTAR");const p=await n.hmList({colId:s.id,id:e.rowId},e.query),m=await n.hmListCount({colId:s.id,id:e.rowId});return new l.PagedResponseImpl(p,Object.assign({count:m},e.query))}async relationDataRemove(e){const{model:t,view:a}=await(0,c.getViewAndModelByAliasOrId)(e);t||r.NcError.notFound("Table not found");const i=await d.Base.get(t.base_id),n=await d.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await u.default.get(i)}),s=await(0,c.getColumnByIdOrName)(e.columnName,t);return await n.removeChild({colId:s.id,childId:e.refRowId,rowId:e.rowId,cookie:e.cookie}),!0}async relationDataAdd(e){const{model:t,view:a}=await(0,c.getViewAndModelByAliasOrId)(e);t||r.NcError.notFound("Table not found");const i=await d.Base.get(t.base_id),n=await d.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await u.default.get(i)}),s=await(0,c.getColumnByIdOrName)(e.columnName,t);return await n.addChild({colId:s.id,childId:e.refRowId,rowId:e.rowId,cookie:e.cookie}),!0}};p=i([(0,s.Injectable)()],p),t.DataAliasNestedService=p},39371:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DataTableService=void 0;const r=a(26481),l=a(68281),c=a(87049),d=a(68349),u=a(51401),p=o(a(89103)),m=a(60498),f=a(15147),h=o(a(19356));let g=class{constructor(e){this.datasService=e}async dataList(e){const{model:t,view:a}=await this.getModelAndView(e);return await this.datasService.getDataList({model:t,view:a,query:e.query})}async dataRead(e){const{model:t,view:a}=await this.getModelAndView(e),i=await f.Base.get(t.base_id),n=await f.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await h.default.get(i)}),s=await n.readByPk(e.rowId,!1,e.query);return s||u.NcError.notFound("Row not found"),s}async dataInsert(e){const{model:t,view:a}=await this.getModelAndView(e),i=await f.Base.get(t.base_id),n=await f.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await h.default.get(i)}),s=await n.bulkInsert(Array.isArray(e.body)?e.body:[e.body],{cookie:e.cookie,insertOneByOneAsFallback:!0});return Array.isArray(e.body)?s:s[0]}async dataUpdate(e){const{model:t,view:a}=await this.getModelAndView(e);await this.checkForDuplicateRow({rows:e.body,model:t});const i=await f.Base.get(t.base_id),n=await f.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await h.default.get(i)});return await n.bulkUpdate(Array.isArray(e.body)?e.body:[e.body],{cookie:e.cookie,throwExceptionIfNotExist:!0}),this.extractIdObj({body:e.body,model:t})}async dataDelete(e){const{model:t,view:a}=await this.getModelAndView(e);await this.checkForDuplicateRow({rows:e.body,model:t});const i=await f.Base.get(t.base_id),n=await f.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await h.default.get(i)});return await n.bulkDelete(Array.isArray(e.body)?e.body:[e.body],{cookie:e.cookie,throwExceptionIfNotExist:!0}),this.extractIdObj({body:e.body,model:t})}async dataCount(e){const{model:t,view:a}=await this.getModelAndView(e),i=await f.Base.get(t.base_id),n=await f.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await h.default.get(i)}),s=Object.assign({},e.query);try{s.filterArr=JSON.parse(s.filterArrJson)}catch(e){}return{count:await n.count(s)}}async getModelAndView(e){const t=await f.Model.get(e.modelId);if(t||u.NcError.notFound(`Table with id '${e.modelId}' not found`),e.projectId&&t.project_id!==e.projectId)throw new Error("Table not belong to project");let a;return e.viewId&&(a=await f.View.get(e.viewId),(!a||a.fk_model_id&&a.fk_model_id!==e.modelId)&&u.NcError.unprocessableEntity(`View with id '${e.viewId}' not found`)),{model:t,view:a}}async extractIdObj({model:e,body:t}){const a=await e.getColumns().then((e=>e.filter((e=>e.pk)))),i=(Array.isArray(t)?t:[t]).map((e=>a.reduce(((t,a)=>(t[a.title]=e[a.title],t)),{})));return Array.isArray(t)?i:i[0]}async checkForDuplicateRow({rows:e,model:t}){if(!e||!Array.isArray(e)||1===e.length)return;await t.getColumns();const a=new Set;for(const i of e){let e;e=1===t.primaryKeys.length?i[t.primaryKey.title]:t.primaryKeys.map((e=>i[e.title])).join("___"),a.has(e)&&u.NcError.unprocessableEntity("Duplicate row with id "+e),a.add(e)}}async nestedDataList(e){var t,a;const{model:i,view:n}=await this.getModelAndView(e),s=await f.Base.get(i.base_id),o=await f.Model.getBaseModelSQL({id:i.id,viewId:null==n?void 0:n.id,dbDriver:await h.default.get(s)});await o.exist(e.rowId)||u.NcError.notFound(`Row with id '${e.rowId}' not found`);const r=await this.getColumn(e),d=await r.getColOptions(),g=await d.getRelatedTable(),{ast:_,dependencyFields:b}=await(0,p.default)({model:g,query:e.query,extractOnlyPrimaries:!((null===(t=e.query)||void 0===t?void 0:t.f)||(null===(a=e.query)||void 0===a?void 0:a.fields))}),y=b;try{y.filterArr=JSON.parse(y.filterArrJson)}catch(e){}try{y.sortArr=JSON.parse(y.sortArrJson)}catch(e){}let w,v;return d.type===l.RelationTypes.MANY_TO_MANY?(w=await o.mmList({colId:r.id,parentId:e.rowId},y),v=await o.mmListCount({colId:r.id,parentId:e.rowId})):d.type===l.RelationTypes.HAS_MANY?(w=await o.hmList({colId:r.id,id:e.rowId},y),v=await o.hmListCount({colId:r.id,id:e.rowId})):w=await o.btRead({colId:r.id,id:e.rowId},e.query),w=await(0,c.nocoExecute)(_,w,{},y),d.type===l.RelationTypes.BELONGS_TO?w:new m.PagedResponseImpl(w,Object.assign({count:v},e.query))}async getColumn(e){const t=await f.Column.get({colId:e.columnId});return t||u.NcError.notFound(`Column with id '${e.columnId}' not found`),t.fk_model_id!==e.modelId&&u.NcError.badRequest("Column not belong to model"),(0,l.isLinksOrLTAR)(t)||u.NcError.badRequest("Column is not LTAR"),t}async nestedLink(e){this.validateIds(e.refRowIds);const{model:t,view:a}=await this.getModelAndView(e),i=await f.Base.get(t.base_id),n=await f.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await h.default.get(i)}),s=await this.getColumn(e);return await n.addLinks({colId:s.id,childIds:Array.isArray(e.refRowIds)?e.refRowIds:[e.refRowIds],rowId:e.rowId,cookie:e.cookie}),!0}async nestedUnlink(e){this.validateIds(e.refRowIds);const{model:t,view:a}=await this.getModelAndView(e);t||u.NcError.notFound("Table with id "+e.modelId+" not found");const i=await f.Base.get(t.base_id),n=await f.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await h.default.get(i)}),s=await this.getColumn(e);return await n.removeLinks({colId:s.id,childIds:Array.isArray(e.refRowIds)?e.refRowIds:[e.refRowIds],rowId:e.rowId,cookie:e.cookie}),!0}validateIds(e){if(Array.isArray(e)){const t=new Map,a=new Set;for(const i of e)null==i&&u.NcError.unprocessableEntity("Invalid row id "+i),t.has(i)?a.add(i):t.set(i,!0);a.size>0&&u.NcError.unprocessableEntity("Child record with id ["+[...a].join(", ")+"] are duplicated")}else null==e&&u.NcError.unprocessableEntity("Invalid row id "+e)}};g=n([(0,r.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==d.DatasService&&d.DatasService)?i:Object])],g),t.DataTableService=g},68349:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DatasService=void 0;const c=a(26481),d=a(68281),u=o(a(6302)),p=l(a(57153)),m=a(87049),f=a(7214),h=a(15147),g=a(51401),_=l(a(89103)),b=a(60498),y=l(a(19356));let w=class{constructor(){}async dataList(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e);return await this.getDataList({model:t,view:a,query:e.query})}async dataFindOne(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e);return await this.getFindOne({model:t,view:a,query:e.query})}async dataGroupBy(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e);return await this.getDataGroupBy({model:t,view:a,query:e.query})}async dataCount(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e),i=await h.Base.get(t.base_id),n=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(i)}),s=Object.assign({},e.query);try{s.filterArr=JSON.parse(s.filterArrJson)}catch(e){}return{count:await n.count(s)}}async dataInsert(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e),i=await h.Base.get(t.base_id),n=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(i)});return await n.insert(e.body,null,e.cookie)}async dataUpdate(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e),i=await h.Base.get(t.base_id),n=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(i)});return await n.updateByPk(e.rowId,e.body,null,e.cookie,e.disableOptimization)}async dataDelete(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e),i=await h.Base.get(t.base_id),n=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(i)});if(!i.isMeta()){const a=await n.hasLTARData(e.rowId,t);a.length&&g.NcError.badRequest(a)}return await n.delByPk(e.rowId,null,e.cookie)}async getDataList(e){const{model:t,view:a,query:i={}}=e,n=await h.Base.get(t.base_id),s=e.baseModel||await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),{ast:o,dependencyFields:r}=await(0,_.default)({model:t,query:i,view:a}),l=r;try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}try{l.sortArr=JSON.parse(l.sortArrJson)}catch(e){}let c=[],d=0;try{c=await(0,m.nocoExecute)(o,await s.list(l),{},l),d=await s.count(l)}catch(e){console.log(e),g.NcError.internalServerError("Please check server log for more details")}return new b.PagedResponseImpl(c,Object.assign(Object.assign({},i),{count:d}))}async getFindOne(e){const{model:t,view:a,query:i={}}=e,n=await h.Base.get(t.base_id),s=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),o=Object.assign({},i);try{o.filterArr=JSON.parse(o.filterArrJson)}catch(e){}try{o.sortArr=JSON.parse(o.sortArrJson)}catch(e){}const{ast:r,dependencyFields:l}=await(0,_.default)({model:t,query:o,view:a}),c=await s.findOne(Object.assign(Object.assign({},o),l));return c?await(0,m.nocoExecute)(r,c,{},l):{}}async getDataGroupBy(e){const{model:t,view:a,query:i={}}=e,n=await h.Base.get(t.base_id),s=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),o=Object.assign({},i);try{o.filterArr=JSON.parse(o.filterArrJson)}catch(e){}try{o.sortArr=JSON.parse(o.sortArrJson)}catch(e){}const r=await s.groupBy(o),l=await s.groupByCount(o);return new b.PagedResponseImpl(r,Object.assign(Object.assign({},i),{count:l}))}async dataRead(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e),i=await h.Base.get(t.base_id),n=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(i)}),s=await n.readByPk(e.rowId,!1,e.query,{getHiddenColumn:e.getHiddenColumn});return s||g.NcError.notFound("Row not found"),s}async dataExist(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e),i=await h.Base.get(t.base_id),n=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(i)});return await n.exist(e.rowId)}async groupedDataList(e){const{model:t,view:a}=await(0,f.getViewAndModelByAliasOrId)(e);return await this.getGroupedDataList({model:t,view:a,query:e.query,columnId:e.columnId})}async getGroupedDataList(e){const{model:t,view:a,query:i={}}=e,n=await h.Base.get(t.base_id),s=await h.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),{ast:o,dependencyFields:r}=await(0,_.default)({model:t,query:i,view:a}),l=Object.assign({},r);try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}try{l.sortArr=JSON.parse(l.sortArrJson)}catch(e){}try{l.options=JSON.parse(l.optionsArrJson)}catch(e){}let c=[];const d=await s.groupedList(Object.assign(Object.assign({},l),{groupColumnId:e.columnId}));c=await(0,m.nocoExecute)({key:1,value:o},d,{},l);const u=await s.groupedListCount(Object.assign(Object.assign({},l),{groupColumnId:e.columnId}));return c=c.map((e=>{var t,a;const n=null!==(a=null===(t=u.find((t=>t.key===e.key)))||void 0===t?void 0:t.count)&&void 0!==a?a:0;return e.value=new b.PagedResponseImpl(e.value,Object.assign(Object.assign({},i),{count:n})),e})),c}async dataListByViewId(e){const t=await h.View.get(e.viewId),a=await h.Model.getByIdOrName({id:(null==t?void 0:t.fk_model_id)||e.viewId});return a||g.NcError.notFound("Table not found"),await this.getDataList({model:a,view:t,query:e.query})}async mmList(e){var t;const a=await h.View.get(e.viewId),i=await h.Model.getByIdOrName({id:(null==a?void 0:a.fk_model_id)||e.viewId});i||g.NcError.notFound("Table not found");const n=await h.Base.get(i.base_id),s=await h.Model.getBaseModelSQL({id:i.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),o=`${i.title}List`,r={[o]:1},l=null===(t=await(0,m.nocoExecute)(r,{[o]:async t=>await s.mmList({colId:e.colId,parentId:e.rowId},t)},{},{nested:{[o]:e.query}}))||void 0===t?void 0:t[o],c=await s.mmListCount({colId:e.colId,parentId:e.rowId});return new b.PagedResponseImpl(l,Object.assign({count:c},e.query))}async mmExcludedList(e){var t;const a=await h.View.get(e.viewId),i=await h.Model.getByIdOrName({id:(null==a?void 0:a.fk_model_id)||e.viewId});i||g.NcError.notFound("Table not found");const n=await h.Base.get(i.base_id),s=await h.Model.getBaseModelSQL({id:i.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),o="List",r={[o]:1},l=null===(t=await(0,m.nocoExecute)(r,{[o]:async t=>await s.getMmChildrenExcludedList({colId:e.colId,pid:e.rowId},t)},{},{nested:{[o]:e.query}}))||void 0===t?void 0:t[o],c=await s.getMmChildrenExcludedListCount({colId:e.colId,pid:e.rowId},e.query);return new b.PagedResponseImpl(l,Object.assign({count:c},e.query))}async hmExcludedList(e){var t;const a=await h.View.get(e.viewId),i=await h.Model.getByIdOrName({id:(null==a?void 0:a.fk_model_id)||e.viewId});i||g.NcError.notFound("Table not found");const n=await h.Base.get(i.base_id),s=await h.Model.getBaseModelSQL({id:i.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),o="List",r={[o]:1},l=null===(t=await(0,m.nocoExecute)(r,{[o]:async t=>await s.getHmChildrenExcludedList({colId:e.colId,pid:e.rowId},t)},{},{nested:{[o]:e.query}}))||void 0===t?void 0:t[o],c=await s.getHmChildrenExcludedListCount({colId:e.colId,pid:e.rowId},e.query);return new b.PagedResponseImpl(l,Object.assign({count:c},e.query))}async btExcludedList(e){var t;const a=await h.View.get(e.viewId),i=await h.Model.getByIdOrName({id:(null==a?void 0:a.fk_model_id)||e.viewId});if(!i)return g.NcError.notFound("Table not found");const n=await h.Base.get(i.base_id),s=await h.Model.getBaseModelSQL({id:i.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),o="List",r={[o]:1},l=null===(t=await(0,m.nocoExecute)(r,{[o]:async t=>await s.getBtChildrenExcludedList({colId:e.colId,cid:e.rowId},t)},{},{nested:{[o]:e.query}}))||void 0===t?void 0:t[o],c=await s.getBtChildrenExcludedListCount({colId:e.colId,cid:e.rowId},e.query);return new b.PagedResponseImpl(l,Object.assign({count:c},e.query))}async hmList(e){var t;const a=await h.View.get(e.viewId),i=await h.Model.getByIdOrName({id:(null==a?void 0:a.fk_model_id)||e.viewId});i||g.NcError.notFound("Table not found");const n=await h.Base.get(i.base_id),s=await h.Model.getBaseModelSQL({id:i.id,viewId:null==a?void 0:a.id,dbDriver:await y.default.get(n)}),o=`${i.title}List`,r={[o]:1},l=null===(t=await(0,m.nocoExecute)(r,{[o]:async t=>await s.hmList({colId:e.colId,id:e.rowId},t)},{},{nested:{[o]:e.query}}))||void 0===t?void 0:t[o],c=await s.hmListCount({colId:e.colId,id:e.rowId});return new b.PagedResponseImpl(l,{totalRows:c})}async dataReadByViewId(e){try{const t=await h.Model.getByIdOrName({id:e.viewId});t||g.NcError.notFound("Table not found");const a=await h.Base.get(t.base_id),i=await h.Model.getBaseModelSQL({id:t.id,dbDriver:await y.default.get(a)}),{ast:n,dependencyFields:s}=await(0,_.default)({model:t,query:e.query});return await(0,m.nocoExecute)(n,await i.readByPk(e.rowId,!1),{},s)}catch(e){console.log(e),g.NcError.internalServerError("Please check server log for more details")}}async dataInsertByViewId(e){const t=await h.Model.getByIdOrName({id:e.viewId});if(!t)return g.NcError.notFound("Table not found");const a=await h.Base.get(t.base_id),i=await h.Model.getBaseModelSQL({id:t.id,dbDriver:await y.default.get(a)});return await i.insert(e.body,null,e.cookie)}async dataUpdateByViewId(e){const t=await h.Model.getByIdOrName({id:e.viewId});t||g.NcError.notFound("Table not found");const a=await h.Base.get(t.base_id),i=await h.Model.getBaseModelSQL({id:t.id,dbDriver:await y.default.get(a)});return await i.updateByPk(e.rowId,e.body,null,e.cookie)}async dataDeleteByViewId(e){const t=await h.Model.getByIdOrName({id:e.viewId});t||g.NcError.notFound("Table not found");const a=await h.Base.get(t.base_id),i=await h.Model.getBaseModelSQL({id:t.id,dbDriver:await y.default.get(a)});return await i.delByPk(e.rowId,null,e.cookie)}async relationDataDelete(e){const t=await h.View.get(e.viewId),a=await h.Model.getByIdOrName({id:(null==t?void 0:t.fk_model_id)||e.viewId});a||g.NcError.notFound("Table not found");const i=await h.Base.get(a.base_id),n=await h.Model.getBaseModelSQL({id:a.id,viewId:null==t?void 0:t.id,dbDriver:await y.default.get(i)});return await n.removeChild({colId:e.colId,childId:e.childId,rowId:e.rowId,cookie:e.cookie}),!0}async relationDataAdd(e){const t=await h.View.get(e.viewId),a=await h.Model.getByIdOrName({id:(null==t?void 0:t.fk_model_id)||e.viewId});a||g.NcError.notFound("Table not found");const i=await h.Base.get(a.base_id),n=await h.Model.getBaseModelSQL({id:a.id,viewId:null==t?void 0:t.id,dbDriver:await y.default.get(i)});return await n.addChild({colId:e.colId,childId:e.childId,rowId:e.rowId,cookie:e.cookie}),!0}async getViewAndModelFromRequestByAliasOrId(e){const t=await h.Project.getWithInfoByTitleOrId(e.params.projectName),a=await h.Model.getByAliasOrId({project_id:t.id,aliasOrId:e.params.tableName}),i=e.params.viewName&&await h.View.getByTitleOrId({titleOrId:e.params.viewName,fk_model_id:a.id});return a||g.NcError.notFound("Table not found"),{model:a,view:i}}async extractXlsxData(e){const{view:t,query:a,siteUrl:i}=e,n=await h.Base.get(t.base_id);await t.getModelWithInfo(),await t.getColumns(),t.model.columns=t.columns.filter((e=>e.show)).map((e=>new h.Column(Object.assign(Object.assign({},e),t.model.columnsById[e.fk_column_id])))).filter((e=>!(0,d.isSystemColumn)(e)||t.show_system_fields));const s=await h.Model.getBaseModelSQL({id:t.model.id,viewId:null==t?void 0:t.id,dbDriver:await y.default.get(n)}),{offset:o,dbRows:r,elapsed:l}=await(0,f.getDbRows)({baseModel:s,view:t,query:a,siteUrl:i}),c=a.fields;return{offset:o,dbRows:r,elapsed:l,data:u.utils.json_to_sheet(r,{header:c})}}async extractCsvData(e,t){const a=await h.Base.get(e.base_id),i=t.query.fields;await e.getModelWithInfo(),await e.getColumns(),e.model.columns=e.columns.filter((e=>e.show)).map((t=>new h.Column(Object.assign(Object.assign({},t),e.model.columnsById[t.fk_column_id])))).filter((t=>!(0,d.isSystemColumn)(t)||e.show_system_fields));const n=await h.Model.getBaseModelSQL({id:e.model.id,viewId:null==e?void 0:e.id,dbDriver:await y.default.get(a)}),{offset:s,dbRows:o,elapsed:r}=await(0,f.getDbRows)({baseModel:n,view:e,query:t.query,siteUrl:t.ncSiteUrl});return{offset:s,dbRows:o,elapsed:r,data:p.default.unparse({fields:e.model.columns.sort(((e,t)=>Array.isArray(i)?i.indexOf(e.title)-i.indexOf(t.title):0)).filter((e=>!i||!Array.isArray(i)||i.includes(e.title))).map((e=>e.title)),data:o},{escapeFormulae:!0})}}async serializeCellValue({value:e,column:t,siteUrl:a}){if(!t)return e;if(!e)return e;switch(null==t?void 0:t.uidt){case d.UITypes.Attachment:{let t=e;try{"string"==typeof e&&(t=JSON.parse(e))}catch(e){}return(t||[]).map((e=>`${encodeURI(e.title)}(${encodeURI(e.path?`${a}/${e.path}`:e.url)})`))}case d.UITypes.Lookup:{const i=await t.getColOptions(),n=await i.getLookupColumn();return(await Promise.all([...Array.isArray(e)?e:[e]].map((async e=>(0,f.serializeCellValue)({value:e,column:n,siteUrl:a}))))).join(", ")}case d.UITypes.LinkToAnotherRecord:{const a=await t.getColOptions(),i=await a.getRelatedTable();return await i.getColumns(),[...Array.isArray(e)?e:[e]].map((e=>{var t;return e[null===(t=i.displayValue)||void 0===t?void 0:t.title]})).join(", ")}default:return e&&"object"==typeof e?JSON.stringify(e):e}}async getColumnByIdOrName(e,t){const a=(await t.getColumns()).find((t=>t.title===e||t.id===e||t.column_name===e));return a||g.NcError.notFound(`Column with id/name '${e}' is not found`),a}};w=s([(0,c.Injectable)(),r("design:paramtypes",[])],w),t.DatasService=w},3272:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FiltersService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async hookFilterCreate(e){(0,c.validatePayload)("swagger.json#/components/schemas/FilterReq",e.filter);const t=await u.Hook.get(e.hookId);t||d.NcError.badRequest("Hook not found");const a=await u.Filter.insert(Object.assign(Object.assign({},e.filter),{fk_hook_id:e.hookId}));return this.appHooksService.emit(r.AppEvents.FILTER_CREATE,{filter:a,hook:t}),a}async hookFilterList(e){return u.Filter.rootFilterListByHook({hookId:e.hookId})}async filterDelete(e){const t=await u.Filter.get(e.filterId);return t||d.NcError.badRequest("Filter not found"),await u.Filter.delete(e.filterId),this.appHooksService.emit(r.AppEvents.FILTER_DELETE,{filter:t}),!0}async filterCreate(e){(0,c.validatePayload)("swagger.json#/components/schemas/FilterReq",e.filter);const t=await u.View.get(e.viewId),a=await u.Filter.insert(Object.assign(Object.assign({},e.filter),{fk_view_id:e.viewId}));return this.appHooksService.emit(r.AppEvents.FILTER_CREATE,{filter:a,view:t}),a}async filterUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/FilterReq",e.filter);const t=await u.Filter.get(e.filterId);t||d.NcError.badRequest("Filter not found");const a=await u.Filter.update(e.filterId,e.filter);return this.appHooksService.emit(r.AppEvents.FILTER_UPDATE,{filter:t}),a}async filterChildrenList(e){return u.Filter.parentFilterList({parentId:e.filterId})}async filterGet(e){return await u.Filter.get(e.filterId)}async filterList(e){return await u.Filter.rootFilterList({viewId:e.viewId})}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.FiltersService=p},74500:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FormColumnsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(15147);let u=class{constructor(e){this.appHooksService=e}async columnUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/FormColumnReq",e.formViewColumn);const t=await d.FormViewColumn.update(e.formViewColumnId,e.formViewColumn);return this.appHooksService.emit(r.AppEvents.FORM_COLUMN_UPDATE,{}),t}};u=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],u),t.FormColumnsService=u},42934:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.FormsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async formViewGet(e){return await u.FormView.getWithInfo(e.formViewId)}async formViewCreate(e){(0,c.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",e.body);const t=await u.View.insert(Object.assign(Object.assign({},e.body),{fk_model_id:e.tableId,type:r.ViewTypes.FORM}));return this.appHooksService.emit(r.AppEvents.VIEW_CREATE,{view:t,showAs:"form"}),this.appHooksService.emit(r.AppEvents.VIEW_CREATE,{user:e.user,view:t}),t}async formViewUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/FormUpdateReq",e.form);const t=await u.View.get(e.formViewId);t||d.NcError.badRequest("View not found");const a=await u.FormView.update(e.formViewId,e.form);return this.appHooksService.emit(r.AppEvents.VIEW_UPDATE,{view:t,showAs:"form"}),a}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.FormsService=p},99155:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GalleriesService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async galleryViewGet(e){return await u.GalleryView.get(e.galleryViewId)}async galleryViewCreate(e){(0,c.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",e.gallery);const t=await u.View.insert(Object.assign(Object.assign({},e.gallery),{fk_model_id:e.tableId,type:r.ViewTypes.GALLERY}));return this.appHooksService.emit(r.AppEvents.VIEW_CREATE,{view:t,showAs:"gallery"}),t}async galleryViewUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/GalleryUpdateReq",e.gallery);const t=await u.View.get(e.galleryViewId);t||d.NcError.badRequest("View not found");const a=await u.GalleryView.update(e.galleryViewId,e.gallery);return this.appHooksService.emit(r.AppEvents.VIEW_UPDATE,{view:t,showAs:"gallery"}),a}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.GalleriesService=p},58946:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GridColumnsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(15147);let u=class{constructor(e){this.appHooksService=e}async columnList(e){return await d.GridViewColumn.list(e.gridViewId)}async gridColumnUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/GridColumnReq",e.grid);const t=await d.GridViewColumn.update(e.gridViewColumnId,e.grid);return this.appHooksService.emit(r.AppEvents.GRID_COLUMN_UPDATE,{}),t}};u=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],u),t.GridColumnsService=u},1180:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.GridsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async gridViewCreate(e){(0,c.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",e.grid);const t=await u.View.insert(Object.assign(Object.assign({},e.grid),{fk_model_id:e.tableId,type:r.ViewTypes.GRID}));return this.appHooksService.emit(r.AppEvents.VIEW_CREATE,{view:t,showAs:"grid"}),this.appHooksService.emit(r.AppEvents.VIEW_CREATE,{view:t}),t}async gridViewUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/GridUpdateReq",e.grid);const t=await u.View.get(e.viewId);t||d.NcError.badRequest("View not found");const a=await u.GridView.update(e.viewId,e.grid);return this.appHooksService.emit(r.AppEvents.VIEW_UPDATE,{view:t,showAs:"map"}),a}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.GridsService=p},17276:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HookHandlerService=t.HANDLE_WEBHOOK=void 0;const l=a(26481),c=a(68281),d=r(a(49632)),u=r(a(70781)),p=a(58632),m=a(2062),f=r(a(2370)),h=a(15147);t.HANDLE_WEBHOOK="__nc_handleHooks";let g=class{constructor(e){this.eventEmitter=e}async handleHooks({hookName:e,prevData:t,newData:a,user:i,viewId:n,modelId:s,tnPath:o}){var r;const l=await h.View.get(n),m=await h.Model.get(s);if(("after.insert"===e||"after.bulkInsert"===e)&&l.type===c.ViewTypes.FORM)try{const e=await l.getView(),{columns:t}=await h.FormView.getWithInfo(e.fk_view_id),i=await m.getColumns(),n=t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.fk_column_id]:t})),{});let s=1;const g=null==i?void 0:i.map((t=>Object.assign(Object.assign(Object.assign(Object.assign({},t),{fk_column_id:t.id,fk_view_id:e.fk_view_id}),n[t.id]?n[t.id]:{}),{order:n[t.id]&&n[t.id].order||s++,id:n[t.id]&&n[t.id].id}))).sort(((e,t)=>e.order-t.order)).filter((e=>e.show&&e.uidt!==c.UITypes.Rollup&&e.uidt!==c.UITypes.Lookup&&e.uidt!==c.UITypes.Formula&&e.uidt!==c.UITypes.QrCode&&e.uidt!==c.UITypes.Barcode&&e.uidt!==c.UITypes.SpecificDBType)).sort(((e,t)=>e.order-t.order)).map((e=>Object.assign(Object.assign({},e),{required:!!e.required}))),_=Object.entries(JSON.parse(null==e?void 0:e.email)||{}).filter((e=>e[1])).map((e=>e[0]));if(null==_?void 0:_.length){const t=(0,p._transformSubmittedFormDataForEmail)(a,e,g);null===(r=await u.default.emailAdapter(!1))||void 0===r||r.mailSend({to:_.join(","),subject:"NocoDB Form",html:d.default.render(f.default,{data:t,tn:o,_tn:m.title})})}}catch(e){console.log(e)}try{const[n,o]=e.split("."),r=await h.Hook.list({fk_model_id:s,event:n,operation:o});for(const e of r)e.active&&(0,p.invokeWebhook)(e,m,l,t,a,i)}catch(t){console.log("hooks :: error",e,t)}}onModuleInit(){this.unsubscribe=this.eventEmitter.on(t.HANDLE_WEBHOOK,this.handleHooks.bind(this))}onModuleDestroy(){var e;null===(e=this.unsubscribe)||void 0===e||e.call(this)}};g=n([(0,l.Injectable)(),o(0,(0,l.Inject)("IEventEmitter")),s("design:paramtypes",["function"==typeof(i=void 0!==m.IEventEmitter&&m.IEventEmitter)?i:Object])],g),t.HookHandlerService=g},27556:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.HooksService=void 0;const r=a(26481),l=a(68281),c=a(33206),d=a(78829),u=a(51401),p=a(6526),m=a(58632),f=o(a(27552)),h=a(15147);let g=class{constructor(e){this.appHooksService=e}validateHookPayload(e){let t={};try{t="string"==typeof e?JSON.parse(e):e}catch(e){}"URL"!==t.type&&"true"===process.env.NC_CLOUD&&u.NcError.badRequest("Only URL notification is supported")}async hookList(e){return await h.Hook.list({fk_model_id:e.tableId})}async hookLogList(e){return await h.HookLog.list({fk_hook_id:e.hookId},e.query)}async hookCreate(e){(0,d.validatePayload)("swagger.json#/components/schemas/HookReq",e.hook),this.validateHookPayload(e.hook.notification);const t=await h.Hook.insert(Object.assign(Object.assign({},e.hook),{fk_model_id:e.tableId}));return this.appHooksService.emit(l.AppEvents.WEBHOOK_CREATE,{hook:t}),t}async hookDelete(e){const t=await h.Hook.get(e.hookId);return t||u.NcError.badRequest("Hook not found"),await h.Hook.delete(e.hookId),this.appHooksService.emit(l.AppEvents.WEBHOOK_DELETE,{hook:t}),!0}async hookUpdate(e){(0,d.validatePayload)("swagger.json#/components/schemas/HookReq",e.hook);const t=await h.Hook.get(e.hookId);t||u.NcError.badRequest("Hook not found"),this.validateHookPayload(e.hook.notification);const a=await h.Hook.update(e.hookId,e.hook);return this.appHooksService.emit(l.AppEvents.WEBHOOK_UPDATE,{hook:Object.assign(Object.assign({},t),e.hook)}),a}async hookTest(e){var t;(0,d.validatePayload)("swagger.json#/components/schemas/HookTestReq",e.hookTest),this.validateHookPayload(null===(t=e.hookTest.hook)||void 0===t?void 0:t.notification);const a=await h.Model.getByIdOrName({id:e.tableId}),{hook:i,payload:{data:n,user:s}}=e.hookTest;try{await(0,m.invokeWebhook)(new h.Hook(i),a,null,null,n,s,null==i?void 0:i.filters,!0,!0)}catch(e){throw e}finally{this.appHooksService.emit(l.AppEvents.WEBHOOK_TEST,{hook:i})}return!0}async tableSampleData(e){const t=new h.Model(await h.Model.getByIdOrName({id:e.tableId}));return"v1"===e.version||"v2"===e.version&&f.default.isEE()?await(0,p.populateSamplePayload)(t,!1,e.operation):await(0,p.populateSamplePayloadV2)(t,!1,e.operation)}async hookLogCount(e){return await h.HookLog.count({hookId:e.hookId})}};g=n([(0,r.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==c.AppHooksService&&c.AppHooksService)?i:Object])],g),t.HooksService=g},12871:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.KanbansService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async kanbanViewGet(e){return await u.KanbanView.get(e.kanbanViewId)}async kanbanViewCreate(e){(0,c.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",e.kanban);const t=await u.View.insert(Object.assign(Object.assign({},e.kanban),{fk_model_id:e.tableId,type:r.ViewTypes.KANBAN}));return this.appHooksService.emit(r.AppEvents.VIEW_CREATE,{view:t,showAs:"kanban",user:e.user}),t}async kanbanViewUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/KanbanUpdateReq",e.kanban);const t=await u.View.get(e.kanbanViewId);t||d.NcError.badRequest("View not found");const a=await u.KanbanView.update(e.kanbanViewId,e.kanban);return this.appHooksService.emit(r.AppEvents.VIEW_UPDATE,{view:t,showAs:"kanban"}),a}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.KanbansService=p},55536:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.MapsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async mapViewGet(e){return await u.MapView.get(e.mapViewId)}async mapViewCreate(e){(0,c.validatePayload)("swagger.json#/components/schemas/ViewCreateReq",e.map);const t=await u.View.insert(Object.assign(Object.assign({},e.map),{fk_model_id:e.tableId,type:r.ViewTypes.MAP}));return this.appHooksService.emit(r.AppEvents.VIEW_CREATE,{view:t,showAs:"map"}),t}async mapViewUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/MapUpdateReq",e.map);const t=await u.View.get(e.mapViewId);t||d.NcError.badRequest("View not found");const a=await u.MapView.update(e.mapViewId,e.map);return this.appHooksService.emit(r.AppEvents.VIEW_UPDATE,{view:t,showAs:"map"}),a}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.MapsService=p},80181:function(e,t,a){var i,n=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return s(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MetaDiffsService=t.MetaDiffType=void 0;const d=a(26481),u=a(68281),p=a(64190),m=a(33206),f=c(a(60854)),h=c(a(8609)),g=r(a(10460)),_=a(36002),b=c(a(35619)),y=a(51401),w=c(a(74721)),v=c(a(19356)),T=a(15147);var O;!function(e){e.TABLE_NEW="TABLE_NEW",e.TABLE_REMOVE="TABLE_REMOVE",e.TABLE_COLUMN_ADD="TABLE_COLUMN_ADD",e.TABLE_COLUMN_TYPE_CHANGE="TABLE_COLUMN_TYPE_CHANGE",e.TABLE_COLUMN_PROPS_CHANGED="TABLE_COLUMN_PROPS_CHANGED",e.TABLE_COLUMN_REMOVE="TABLE_COLUMN_REMOVE",e.VIEW_NEW="VIEW_NEW",e.VIEW_REMOVE="VIEW_REMOVE",e.VIEW_COLUMN_ADD="VIEW_COLUMN_ADD",e.VIEW_COLUMN_TYPE_CHANGE="VIEW_COLUMN_TYPE_CHANGE",e.VIEW_COLUMN_REMOVE="VIEW_COLUMN_REMOVE",e.TABLE_RELATION_ADD="TABLE_RELATION_ADD",e.TABLE_RELATION_REMOVE="TABLE_RELATION_REMOVE",e.TABLE_VIRTUAL_M2M_REMOVE="TABLE_VIRTUAL_M2M_REMOVE"}(O=t.MetaDiffType||(t.MetaDiffType={}));const E=[O.VIEW_COLUMN_REMOVE,O.TABLE_RELATION_REMOVE];let S=class{constructor(e){this.appHooksService=e}async getMetaDiff(e,t,a){var i,n,s,o,r,l,c,d,p,m,f,h,g,_,b,y,w,v,T,E,S,I,k,C,j,x,R,A,M,N;if(a.is_meta)return[];const P=[],L=[],$=null===(o=null===(s=null===(n=await e.tableList({schema:null===(i=a.getConfig())||void 0===i?void 0:i.schema}))||void 0===n?void 0:n.data)||void 0===s?void 0:s.list)||void 0===o?void 0:o.filter((e=>{var i;return!(null==t?void 0:t.prefix)||!a.is_meta||(null===(i=e.tn)||void 0===i?void 0:i.startsWith(null==t?void 0:t.prefix))})),q={},D=await a.getModels(),U=[],B=[];for(const e of D)e.type===u.ModelTypes.TABLE?U.push(e):e.type===u.ModelTypes.VIEW&&B.push(e);const F=null===(c=null===(l=await e.relationListAll({schema:null===(r=a.getConfig())||void 0===r?void 0:r.schema}))||void 0===l?void 0:l.data)||void 0===c?void 0:c.list;for(const t of $){if("nc_evolutions"===t.tn)continue;const i=U.findIndex((e=>e.table_name===t.tn));if(-1===i){P.push({table_name:t.tn,base_id:a.id,type:u.ModelTypes.TABLE,detectedChanges:[{type:O.TABLE_NEW,msg:"New table"}]});continue}const n=U[i];U.splice(i,1);const s={title:n.title,meta:n.meta,table_name:t.tn,base_id:a.id,type:u.ModelTypes.TABLE,detectedChanges:[]};P.push(s),q[t.tn]=null===(m=null===(p=await e.columnList({tn:t.tn,schema:null===(d=a.getConfig())||void 0===d?void 0:d.schema}))||void 0===p?void 0:p.data)||void 0===m?void 0:m.list,await n.getColumns();for(const e of q[t.tn]){const t=n.columns.findIndex((t=>t.column_name===e.cn));if(-1===t){s.detectedChanges.push({type:O.TABLE_COLUMN_ADD,msg:`New column(${e.cn})`,cn:e.cn,id:n.id});continue}const[a]=n.columns.splice(t,1);a.dt!==e.dt&&s.detectedChanges.push({type:O.TABLE_COLUMN_TYPE_CHANGE,msg:`Column type changed(${e.cn})`,cn:a.column_name,id:n.id,column:a}),!!a.pk==!!e.pk&&!!a.rqd==!!e.rqd&&!!a.un==!!e.un&&!!a.ai==!!e.ai&&!!a.unique==!!e.unique||s.detectedChanges.push({type:O.TABLE_COLUMN_PROPS_CHANGED,msg:`Column properties changed (${e.cn})`,cn:a.column_name,id:n.id,column:a})}for(const e of n.columns)[u.UITypes.LinkToAnotherRecord,u.UITypes.Links,u.UITypes.Rollup,u.UITypes.Lookup,u.UITypes.Formula].includes(e.uidt)?(0,u.isLinksOrLTAR)(e.uidt)&&L.push(e):s.detectedChanges.push({type:O.TABLE_COLUMN_REMOVE,msg:`Column removed(${e.column_name})`,cn:e.column_name,id:n.id,column:e,colId:e.id})}for(const e of U)P.push({table_name:e.table_name,meta:e.meta,base_id:a.id,type:u.ModelTypes.TABLE,detectedChanges:[{type:O.TABLE_REMOVE,msg:"Table removed",tn:e.table_name,id:e.id,model:e}]});for(const t of L){const i=await t.getColOptions(),n=await i.getParentColumn(),s=await i.getChildColumn(),o=await n.getModel(),r=await s.getModel();if(i.type===u.RelationTypes.MANY_TO_MANY){const l=await i.getMMModel(),c=$.find((e=>e.tn===o.table_name)),d=$.find((e=>e.tn===l.table_name));if(!c){P.find((e=>e.table_name===r.table_name)).detectedChanges.push({type:O.TABLE_VIRTUAL_M2M_REMOVE,msg:`Many to many removed(${c.tn} removed)`,colId:t.id,column:t});continue}if(!d){P.find((e=>e.table_name===r.table_name)).detectedChanges.push({type:O.TABLE_VIRTUAL_M2M_REMOVE,msg:`Many to many removed(${l.table_name} removed)`,colId:t.id,column:t});continue}const u=q[r.table_name]=q[r.table_name]||(null===(g=null===(h=await e.columnList({tn:r.table_name,schema:null===(f=a.getConfig())||void 0===f?void 0:f.schema}))||void 0===h?void 0:h.data)||void 0===g?void 0:g.list),p=q[o.table_name]=q[o.table_name]||(null===(y=null===(b=await e.columnList({tn:o.table_name,schema:null===(_=a.getConfig())||void 0===_?void 0:_.schema}))||void 0===b?void 0:b.data)||void 0===y?void 0:y.list),m=q[d.tn]=q[d.tn]||(null===(T=null===(v=await e.columnList({tn:d.tn,schema:null===(w=a.getConfig())||void 0===w?void 0:w.schema}))||void 0===v?void 0:v.data)||void 0===T?void 0:T.list),E=await i.getMMChildColumn(),S=await i.getMMParentColumn();(p.every((e=>e.cn!==n.column_name))||u.every((e=>e.cn!==s.column_name))||m.every((e=>e.cn!==E.column_name))||m.every((e=>e.cn!==S.column_name)))&&P.find((e=>e.table_name===r.table_name)).detectedChanges.push({type:O.TABLE_VIRTUAL_M2M_REMOVE,msg:"Many to many removed(One of the relation column removed)",colId:t.id,column:t});continue}if(t.colOptions.virtual)continue;const l=F.find((e=>e.cn===s.column_name&&e.tn===r.table_name&&e.rcn===n.column_name&&e.rtn===o.table_name));l?(l.found=l.found||{},l.found[i.type]||(l.found[i.type]=!0)):P.find((e=>e.table_name===(i.type===u.RelationTypes.BELONGS_TO?r.table_name:o.table_name))).detectedChanges.push({type:O.TABLE_RELATION_REMOVE,tn:r.table_name,rtn:o.table_name,cn:s.column_name,rcn:n.column_name,msg:"Relation removed",colId:t.id,column:t})}for(const e of F)(null===(E=null==e?void 0:e.found)||void 0===E?void 0:E[u.RelationTypes.BELONGS_TO])||null===(S=P.find((t=>t.table_name===e.tn)))||void 0===S||S.detectedChanges.push({type:O.TABLE_RELATION_ADD,tn:e.tn,rtn:e.rtn,cn:e.cn,rcn:e.rcn,msg:"New relation added",relationType:u.RelationTypes.BELONGS_TO,cstn:e.cstn}),(null===(I=null==e?void 0:e.found)||void 0===I?void 0:I[u.RelationTypes.HAS_MANY])||null===(k=P.find((t=>t.table_name===e.rtn)))||void 0===k||k.detectedChanges.push({type:O.TABLE_RELATION_ADD,tn:e.tn,rtn:e.rtn,cn:e.cn,rcn:e.rcn,msg:"New relation added",relationType:u.RelationTypes.HAS_MANY});const V=null===(R=null===(x=null===(j=await e.viewList({schema:null===(C=a.getConfig())||void 0===C?void 0:C.schema}))||void 0===j?void 0:j.data)||void 0===x?void 0:x.list)||void 0===R?void 0:R.map((e=>(e.type="view",e.tn=e.view_name,e))).filter((e=>{var i;return!(null==t?void 0:t.prefix)||!a.is_meta||(null===(i=e.tn)||void 0===i?void 0:i.startsWith(null==t?void 0:t.prefix))}));for(const t of V){const i=B.findIndex((e=>e.table_name===t.tn));if(-1===i){P.push({table_name:t.tn,base_id:a.id,type:u.ModelTypes.VIEW,detectedChanges:[{type:O.VIEW_NEW,msg:"New view"}]});continue}const n=B[i];B.splice(i,1);const s={title:n.title,meta:n.meta,table_name:t.tn,base_id:a.id,type:u.ModelTypes.VIEW,detectedChanges:[]};P.push(s),q[t.tn]=null===(N=null===(M=await e.columnList({tn:t.tn,schema:null===(A=a.getConfig())||void 0===A?void 0:A.schema}))||void 0===M?void 0:M.data)||void 0===N?void 0:N.list,await n.getColumns();for(const e of q[t.tn]){const t=n.columns.findIndex((t=>t.column_name===e.cn));if(-1===t){s.detectedChanges.push({type:O.VIEW_COLUMN_ADD,msg:`New column(${e.cn})`,cn:e.cn,id:n.id});continue}const[a]=n.columns.splice(t,1);a.dt!==e.dt&&s.detectedChanges.push({type:O.TABLE_COLUMN_TYPE_CHANGE,msg:`Column type changed(${e.cn})`,cn:a.column_name,id:n.id,column:a})}for(const e of n.columns)[u.UITypes.LinkToAnotherRecord,u.UITypes.Rollup,u.UITypes.Lookup,u.UITypes.Formula,u.UITypes.Links].includes(e.uidt)||s.detectedChanges.push({type:O.VIEW_COLUMN_REMOVE,msg:`Column removed(${e.column_name})`,cn:e.column_name,id:n.id,column:e,colId:e.id})}for(const e of B)P.push({table_name:e.table_name,meta:e.meta,base_id:a.id,type:u.ModelTypes.TABLE,detectedChanges:[{type:O.VIEW_REMOVE,msg:"Table removed",tn:e.table_name,id:e.id,model:e}]});return P}async metaDiff(e){const t=await T.Project.getWithInfo(e.projectId);let a=[];for(const e of t.bases)try{if(e.is_meta)continue;const i=await v.default.getSqlClient(e);a=a.concat(await this.getMetaDiff(i,t,e))}catch(e){console.log(e)}return a}async baseMetaDiff(e){const t=await T.Project.getWithInfo(e.projectId),a=await T.Base.get(e.baseId);let i=[];const n=await v.default.getSqlClient(a);return i=await this.getMetaDiff(n,t,a),i}async metaDiffSync(e){var t,a,i,n,s,o,r,l,c,d,m,y,S,I,k,C,j,x,R;const A=await T.Project.getWithInfo(e.projectId);for(const e of A.bases){if(e.is_meta)continue;const M=[],N=await v.default.getSqlClient(e),P=await this.getMetaDiff(N,A,e);for(const{table_name:w,detectedChanges:v}of P){v.sort(((e,t)=>E.indexOf(t.type)-E.indexOf(e.type)));for(const E of v)switch(E.type){case O.TABLE_NEW:{const s=null===(n=null===(i=null===(a=await N.columnList({tn:w,schema:null===(t=e.getConfig())||void 0===t?void 0:t.schema}))||void 0===a?void 0:a.data)||void 0===i?void 0:i.list)||void 0===n?void 0:n.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})));(0,b.default)(s);const o=await T.Model.insert(A.id,e.id,{table_name:w,title:(0,g.default)(w,e.is_meta?A.prefix:"",e),type:u.ModelTypes.TABLE});for(const t of s)await T.Column.insert(Object.assign(Object.assign({uidt:(0,h.default)(e,t),fk_model_id:o.id},t),{title:(0,g.getColumnNameAlias)(t.column_name,e)}))}break;case O.VIEW_NEW:{const t=null===(l=null===(r=null===(o=await N.columnList({tn:w,schema:null===(s=e.getConfig())||void 0===s?void 0:s.schema}))||void 0===o?void 0:o.data)||void 0===r?void 0:r.list)||void 0===l?void 0:l.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})));(0,b.default)(t);const a=await T.Model.insert(A.id,e.id,{table_name:w,title:(0,g.default)(w,A.prefix,e),type:u.ModelTypes.VIEW});for(const i of t)await T.Column.insert(Object.assign(Object.assign({uidt:(0,h.default)(e,i),fk_model_id:a.id},i),{title:(0,g.getColumnNameAlias)(i.column_name,e)}))}break;case O.TABLE_REMOVE:case O.VIEW_REMOVE:await E.model.delete();break;case O.TABLE_COLUMN_ADD:case O.VIEW_COLUMN_ADD:{const t=(null===(y=null===(m=null===(d=await N.columnList({tn:w,schema:null===(c=e.getConfig())||void 0===c?void 0:c.schema}))||void 0===d?void 0:d.data)||void 0===m?void 0:m.list)||void 0===y?void 0:y.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===E.cn));t.uidt=(0,h.default)(e,t),t.title=(0,g.getColumnNameAlias)(t.cn,e),await T.Column.insert(Object.assign({fk_model_id:E.id},t))}break;case O.TABLE_COLUMN_TYPE_CHANGE:case O.VIEW_COLUMN_TYPE_CHANGE:{const t=(null===(C=null===(k=null===(I=await N.columnList({tn:w,schema:null===(S=e.getConfig())||void 0===S?void 0:S.schema}))||void 0===I?void 0:I.data)||void 0===k?void 0:k.list)||void 0===C?void 0:C.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===E.cn)),a=f.default.create({client:e.type},{});t.uidt=a.getUIDataType(t),t.title=E.column.title,await T.Column.update(E.column.id,t)}break;case O.TABLE_COLUMN_PROPS_CHANGED:{const e=(null===(R=null===(x=null===(j=await N.columnList({tn:w}))||void 0===j?void 0:j.data)||void 0===x?void 0:x.list)||void 0===R?void 0:R.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===E.cn));if(!e)break;const{pk:t,ai:a,rqd:i,un:n,unique:s}=e;await T.Column.update(E.column.id,{pk:t,ai:a,rqd:i,un:n,unique:s})}break;case O.TABLE_COLUMN_REMOVE:case O.VIEW_COLUMN_REMOVE:case O.TABLE_RELATION_REMOVE:case O.TABLE_VIRTUAL_M2M_REMOVE:await E.column.delete();break;case O.TABLE_RELATION_ADD:M.push((async()=>{const t=await T.Model.getByIdOrName({project_id:e.project_id,base_id:e.id,table_name:E.rtn}),a=await T.Model.getByIdOrName({project_id:e.project_id,base_id:e.id,table_name:E.tn}),i=await t.getColumns().then((e=>e.find((e=>e.column_name===E.rcn)))),n=await a.getColumns().then((e=>e.find((e=>e.column_name===E.cn))));if(await T.Column.update(n.id,Object.assign(Object.assign({},n),{uidt:u.UITypes.ForeignKey,system:!0})),E.relationType===u.RelationTypes.BELONGS_TO){const e=(0,_.getUniqueColumnAliasName)(a.columns,`${t.title||t.table_name}`);await T.Column.insert({uidt:u.UITypes.LinkToAnotherRecord,title:e,fk_model_id:a.id,fk_related_model_id:t.id,type:u.RelationTypes.BELONGS_TO,fk_parent_column_id:i.id,fk_child_column_id:n.id,virtual:!1,fk_index_name:E.cstn})}else if(E.relationType===u.RelationTypes.HAS_MANY){const e=(0,_.getUniqueColumnAliasName)(a.columns,(0,p.pluralize)(a.title||a.table_name));await T.Column.insert({uidt:u.UITypes.Links,title:e,fk_model_id:t.id,fk_related_model_id:a.id,type:u.RelationTypes.HAS_MANY,fk_parent_column_id:i.id,fk_child_column_id:n.id,virtual:!1,fk_index_name:E.cstn,meta:{plural:(0,p.pluralize)(a.title),singular:(0,p.singularize)(a.title)}})}}))}}await w.default.executeOperations(M,e.type),await this.extractAndGenerateManyToManyRelations(await e.getModels())}return this.appHooksService.emit(u.AppEvents.META_DIFF_SYNC,{project:A}),!0}async baseMetaDiffSync(e){var t,a,i,n,s,o,r,l,c,d,m,E,S,I,k,C,j,x,R;const A=await T.Project.getWithInfo(e.projectId),M=await T.Base.get(e.baseId);M.is_meta&&y.NcError.badRequest("Cannot sync meta base");const N=[],P=await v.default.getSqlClient(M),L=await this.getMetaDiff(P,A,M);for(const{table_name:e,detectedChanges:y}of L)for(const w of y)switch(w.type){case O.TABLE_NEW:{const s=null===(n=null===(i=null===(a=await P.columnList({tn:e,schema:null===(t=M.getConfig())||void 0===t?void 0:t.schema}))||void 0===a?void 0:a.data)||void 0===i?void 0:i.list)||void 0===n?void 0:n.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})));(0,b.default)(s);const o=await T.Model.insert(A.id,M.id,{table_name:e,title:(0,g.default)(e,M.is_meta?A.prefix:"",M),type:u.ModelTypes.TABLE});for(const e of s)await T.Column.insert(Object.assign(Object.assign({uidt:(0,h.default)(M,e),fk_model_id:o.id},e),{title:(0,g.getColumnNameAlias)(e.column_name,M)}))}break;case O.VIEW_NEW:{const t=null===(l=null===(r=null===(o=await P.columnList({tn:e,schema:null===(s=M.getConfig())||void 0===s?void 0:s.schema}))||void 0===o?void 0:o.data)||void 0===r?void 0:r.list)||void 0===l?void 0:l.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})));(0,b.default)(t);const a=await T.Model.insert(A.id,M.id,{table_name:e,title:(0,g.default)(e,A.prefix,M),type:u.ModelTypes.VIEW});for(const e of t)await T.Column.insert(Object.assign(Object.assign({uidt:(0,h.default)(M,e),fk_model_id:a.id},e),{title:(0,g.getColumnNameAlias)(e.column_name,M)}))}break;case O.TABLE_REMOVE:case O.VIEW_REMOVE:await w.model.delete();break;case O.TABLE_COLUMN_ADD:case O.VIEW_COLUMN_ADD:{const t=(null===(E=null===(m=null===(d=await P.columnList({tn:e,schema:null===(c=M.getConfig())||void 0===c?void 0:c.schema}))||void 0===d?void 0:d.data)||void 0===m?void 0:m.list)||void 0===E?void 0:E.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===w.cn));t.uidt=(0,h.default)(M,t),t.title=(0,g.getColumnNameAlias)(t.cn,M),await T.Column.insert(Object.assign({fk_model_id:w.id},t))}break;case O.TABLE_COLUMN_TYPE_CHANGE:case O.VIEW_COLUMN_TYPE_CHANGE:{const t=(null===(C=null===(k=null===(I=await P.columnList({tn:e,schema:null===(S=M.getConfig())||void 0===S?void 0:S.schema}))||void 0===I?void 0:I.data)||void 0===k?void 0:k.list)||void 0===C?void 0:C.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===w.cn)),a=f.default.create({client:M.type},{});t.uidt=a.getUIDataType(t),t.title=w.column.title,await T.Column.update(w.column.id,t)}break;case O.TABLE_COLUMN_PROPS_CHANGED:{const t=(null===(R=null===(x=null===(j=await P.columnList({tn:e}))||void 0===j?void 0:j.data)||void 0===x?void 0:x.list)||void 0===R?void 0:R.map((e=>Object.assign(Object.assign({},e),{column_name:e.cn})))).find((e=>e.cn===w.cn));if(!t)break;const{pk:a,ai:i,rqd:n,un:s,unique:o}=t;await T.Column.update(w.column.id,{pk:a,ai:i,rqd:n,un:s,unique:o})}break;case O.TABLE_COLUMN_REMOVE:case O.VIEW_COLUMN_REMOVE:case O.TABLE_RELATION_REMOVE:case O.TABLE_VIRTUAL_M2M_REMOVE:await w.column.delete();break;case O.TABLE_RELATION_ADD:N.push((async()=>{const e=await T.Model.getByIdOrName({project_id:M.project_id,base_id:M.id,table_name:w.rtn}),t=await T.Model.getByIdOrName({project_id:M.project_id,base_id:M.id,table_name:w.tn}),a=await e.getColumns().then((e=>e.find((e=>e.column_name===w.rcn)))),i=await t.getColumns().then((e=>e.find((e=>e.column_name===w.cn))));if(await T.Column.update(i.id,Object.assign(Object.assign({},i),{uidt:u.UITypes.ForeignKey,system:!0})),w.relationType===u.RelationTypes.BELONGS_TO){const n=(0,_.getUniqueColumnAliasName)(t.columns,`${e.title||e.table_name}`);await T.Column.insert({uidt:u.UITypes.LinkToAnotherRecord,title:n,fk_model_id:t.id,fk_related_model_id:e.id,type:u.RelationTypes.BELONGS_TO,fk_parent_column_id:a.id,fk_child_column_id:i.id,virtual:!1})}else if(w.relationType===u.RelationTypes.HAS_MANY){const n=(0,_.getUniqueColumnAliasName)(t.columns,(0,p.pluralize)(t.title||t.table_name));await T.Column.insert({uidt:u.UITypes.Links,title:n,fk_model_id:e.id,fk_related_model_id:t.id,type:u.RelationTypes.HAS_MANY,fk_parent_column_id:a.id,fk_child_column_id:i.id,virtual:!1})}}))}return await w.default.executeOperations(N,M.type),await this.extractAndGenerateManyToManyRelations(await M.getModels()),this.appHooksService.emit(u.AppEvents.META_DIFF_SYNC,{project:A,base:M}),!0}async isMMRelationExist(e,t,a){let i=!1;const n=await a.getColOptions();for(const a of await e.getColumns())if((0,u.isLinksOrLTAR)(a.uidt)){const e=await a.getColOptions();if(e&&e.type===u.RelationTypes.MANY_TO_MANY&&e.fk_mm_model_id===t.id&&e.fk_child_column_id===n.fk_parent_column_id&&e.fk_mm_child_column_id===n.fk_child_column_id){i=!0;break}}return i}async extractAndGenerateManyToManyRelations(e){for(const t of e){await t.getColumns();const e=t.columns.filter((e=>!(0,u.isVirtualCol)(e))),a=[];for(const e of t.columns)if(e.uidt==u.UITypes.LinkToAnotherRecord){const t=await e.getColOptions();(null==t?void 0:t.type)===u.RelationTypes.BELONGS_TO&&a.push(e)}if(2===(null==a?void 0:a.length)&&e.length<5&&2===t.primaryKeys.length){const e=await a[0].colOptions.getRelatedTable(),i=await a[1].colOptions.getRelatedTable();await e.getColumns(),await i.getColumns();const n=await this.isMMRelationExist(e,t,a[0]),s=await this.isMMRelationExist(i,t,a[1]);n||await T.Column.insert({title:(0,_.getUniqueColumnAliasName)(e.columns,(0,p.pluralize)(i.title)),fk_model_id:e.id,fk_related_model_id:i.id,fk_mm_model_id:t.id,fk_child_column_id:a[0].colOptions.fk_parent_column_id,fk_parent_column_id:a[1].colOptions.fk_parent_column_id,fk_mm_child_column_id:a[0].colOptions.fk_child_column_id,fk_mm_parent_column_id:a[1].colOptions.fk_child_column_id,type:u.RelationTypes.MANY_TO_MANY,uidt:u.UITypes.Links,meta:{plural:(0,p.pluralize)(i.title),singular:(0,p.singularize)(i.title)}}),s||await T.Column.insert({title:(0,_.getUniqueColumnAliasName)(i.columns,(0,p.pluralize)(e.title)),fk_model_id:i.id,fk_related_model_id:e.id,fk_mm_model_id:t.id,fk_child_column_id:a[1].colOptions.fk_parent_column_id,fk_parent_column_id:a[0].colOptions.fk_parent_column_id,fk_mm_child_column_id:a[1].colOptions.fk_child_column_id,fk_mm_parent_column_id:a[0].colOptions.fk_child_column_id,type:u.RelationTypes.MANY_TO_MANY,uidt:u.UITypes.Links,meta:{plural:(0,p.pluralize)(e.title),singular:(0,p.singularize)(e.title)}}),await T.Model.markAsMmTable(t.id,!0);for(const e of[a[0],a[1]]){const t=await e.colOptions,a=await t.getRelatedTable();for(const e of await a.getColumns()){if(!(0,u.isLinksOrLTAR)(e.uidt))continue;const a=await e.getColOptions();if(a&&a.type===u.RelationTypes.HAS_MANY&&(a.fk_child_column_id===t.fk_child_column_id&&a.fk_parent_column_id===t.fk_parent_column_id)){await T.Column.markAsSystemField(e.id);break}}}}else t.mm&&await T.Model.markAsMmTable(t.id,!1)}}};S=o([(0,d.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==m.AppHooksService&&m.AppHooksService)?i:Object])],S),t.MetaDiffsService=S},97982:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ModelVisibilitiesService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async xcVisibilityMetaSetAll(e){(0,c.validatePayload)("swagger.json#/components/schemas/VisibilityRuleReq",e.visibilityRule);const t=await u.Project.getWithInfo(e.projectId);t||d.NcError.badRequest("Project not found");for(const t of e.visibilityRule)for(const a of Object.keys(t.disabled)){(await u.View.get(t.id)).project_id!==e.projectId&&d.NcError.badRequest("View does not belong to the project");const i=await u.ModelRoleVisibility.get({role:a,fk_view_id:t.id});i?t.disabled[a]?i.disabled||await u.ModelRoleVisibility.update(t.id,a,{disabled:t.disabled[a]}):await i.delete():t.disabled[a]&&await u.ModelRoleVisibility.insert({fk_view_id:t.id,disabled:t.disabled[a],role:a})}return this.appHooksService.emit(r.AppEvents.UI_ACL_UPDATE,{project:t}),!0}async xcVisibilityMetaGet(e){const{includeM2M:t=!0,projectId:a,models:i}=null!=e?e:{},n=["owner","creator","viewer","editor","commenter","guest"].reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:!1})),{});let s=i||await u.Model.list({project_id:a,base_id:void 0});s=t?s:s.filter((e=>!e.mm));const o=await s.reduce((async(e,t)=>{const a=await e,i=await t.getViews();for(const e of i)a[e.id]=Object.assign(Object.assign({ptn:t.table_name,_ptn:t.title,ptype:t.type,tn:e.title,_tn:e.title,table_meta:t.meta},e),{disabled:Object.assign({},n)});return a}),Promise.resolve({})),r=await u.ModelRoleVisibility.list(a);for(const e of r)o[e.fk_view_id]&&(o[e.fk_view_id].disabled[e.role]=!!e.disabled);return Object.values(o)}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.ModelVisibilitiesService=p},79689:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(51401),d=a(60498),u=a(15147);let p=class{constructor(e){this.appHooks=e}async insertNotification(e){this.appHooks.emit("notification",e),await u.Notification.insert(e)}async hookHandler({event:e,data:t}){switch(e){case r.AppEvents.PROJECT_INVITE:{const{project:e,user:a,invitedBy:i}=t;await this.insertNotification({fk_user_id:a.id,type:r.AppEvents.PROJECT_INVITE,body:{id:e.id,title:e.title,type:e.type,invited_by:i.email}})}break;case r.AppEvents.WELCOME:{const{user:e}=t;await this.insertNotification({fk_user_id:e.id,type:r.AppEvents.WELCOME,body:{}})}}}onModuleDestroy(){this.appHooks.removeAllListener(this.hookHandler)}onModuleInit(){this.appHooks.onAll(this.hookHandler.bind(this))}async notificationList(e){try{const{limit:t=10,offset:a=0}=e,i=await u.Notification.list({fk_user_id:e.user.id,limit:t,offset:a,is_deleted:!1}),n=await u.Notification.count({fk_user_id:e.user.id,is_deleted:!1}),s=await u.Notification.count({fk_user_id:e.user.id,is_deleted:!1,is_read:!1});return new d.PagedResponseImpl(i,{limit:e.limit,offset:e.offset,count:n},{unreadCount:s})}catch(e){throw console.log(e),e}}async notificationUpdate(e){return await u.Notification.update(e.notificationId,e.body),!0}async markAllRead(e){var t;return(null===(t=e.user)||void 0===t?void 0:t.id)||c.NcError.badRequest("User id is required"),await u.Notification.markAllAsRead(e.user.id),!0}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.NotificationsService=p},73451:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgLcenseService=void 0;const s=a(26481),o=a(94647),r=a(78829),l=n(a(27552)),c=a(15147);let d=class{async licenseGet(){const e=await c.Store.get(o.NC_LICENSE_KEY);return{key:null==e?void 0:e.value}}async licenseSet(e){return(0,r.validatePayload)("swagger.json#/components/schemas/LicenseReq",e),await c.Store.saveOrUpdate({value:e.key,key:o.NC_LICENSE_KEY}),await l.default.loadEEState(),!0}};d=i([(0,s.Injectable)()],d),t.OrgLcenseService=d},57909:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgTokensEeService=void 0;const n=a(26481),s=a(68281),o=a(60498),r=a(15147);let l=class{async apiTokenListEE(e){let t=e.user.id;return(0,s.extractRolesObj)(e.user.roles)[s.OrgUserRoles.SUPER_ADMIN]&&(t=void 0),new o.PagedResponseImpl(await r.ApiToken.listWithCreatedBy(Object.assign(Object.assign({},e.query),{fk_user_id:t})),Object.assign(Object.assign({},e.query||{}),{count:await r.ApiToken.count({})}))}};l=i([(0,n.Injectable)()],l),t.OrgTokensEeService=l},7950:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgTokensService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(60498),p=a(15147);let m=class{constructor(e){this.appHooksService=e}async apiTokenList(e){const t=e.user.id;let a=!1;return(0,r.extractRolesObj)(e.user.roles)[r.OrgUserRoles.SUPER_ADMIN]&&(a=!0),new u.PagedResponseImpl(await p.ApiToken.listWithCreatedBy(Object.assign(Object.assign({},e.query),{fk_user_id:t,includeUnmappedToken:a})),Object.assign(Object.assign({},e.query),{count:await p.ApiToken.count({includeUnmappedToken:a,fk_user_id:t})}))}async apiTokenCreate(e){var t;(0,c.validatePayload)("swagger.json#/components/schemas/ApiTokenReq",e.apiToken);const a=await p.ApiToken.insert(Object.assign(Object.assign({},e.apiToken),{fk_user_id:e.user.id}));return this.appHooksService.emit(r.AppEvents.ORG_API_TOKEN_CREATE,{tokenBody:e.apiToken,userId:null===(t=e.user)||void 0===t?void 0:t.id}),a}async apiTokenDelete(e){var t;const a=e.user.id,i=await p.ApiToken.getByToken(e.token);(0,r.extractRolesObj)(e.user.roles)[r.OrgUserRoles.SUPER_ADMIN]||i.fk_user_id===a||d.NcError.notFound("Token not found");const n=await p.ApiToken.delete(e.token);return this.appHooksService.emit(r.AppEvents.ORG_API_TOKEN_DELETE,{token:e.token,userId:null===(t=e.user)||void 0===t?void 0:t.id}),n}};m=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],m),t.OrgTokensService=m},23481:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrgUsersService=void 0;const l=a(26481),c=a(68281),d=a(25828),u=r(a(71564)),p=a(33206),m=a(95524),f=a(94647),h=a(78829),g=a(51401),_=a(33402),b=a(56248),y=a(15147),w=r(a(27552)),v=a(13609);let T=class{constructor(e,t){this.projectUSerService=e,this.appHooksService=t}async userList(e){return await y.User.list(e.query)}async userUpdate(e){(0,h.validatePayload)("swagger.json#/components/schemas/OrgUserReq",e.user);const t=(0,_.extractProps)(e.user,["roles"]),a=await y.User.get(e.userId);return(0,c.extractRolesObj)(a.roles)[c.OrgUserRoles.SUPER_ADMIN]&&g.NcError.badRequest("Cannot update super admin roles"),await y.User.update(e.userId,Object.assign(Object.assign({},t),{token_version:(0,b.randomTokenString)()}))}async userDelete(e){const t=await w.default.ncMeta.startTransaction();try{const a=await y.User.get(e.userId,t);(0,c.extractRolesObj)(a.roles)[c.OrgUserRoles.SUPER_ADMIN]&&g.NcError.badRequest("Cannot delete super admin");const i=await y.ProjectUser.getProjectsIdList(e.userId,t);for(const e of i)await y.ProjectUser.delete(e.project_id,e.fk_user_id,t);await y.SyncSource.deleteByUserId(e.userId,t),await y.User.delete(e.userId,t),await t.commit()}catch(e){throw await t.rollback(e),e}return!0}async userAdd(e){(0,h.validatePayload)("swagger.json#/components/schemas/OrgUserReq",e.user),e.user.roles&&![c.OrgUserRoles.VIEWER,c.OrgUserRoles.CREATOR].includes(e.user.roles)&&g.NcError.badRequest("Invalid role");const t=(e.user.email||"").toLowerCase().split(/\s*,\s*/).map((e=>e.trim())),a=t.filter((e=>!u.default.isEmail(e)));if(!t.length)return g.NcError.badRequest("Invalid email address");a.length&&g.NcError.badRequest("Invalid email address : "+a.join(", "));const i=(0,d.v4)(),n=[];for(const a of t){let s=await y.User.getByEmail(a);if(s)g.NcError.badRequest("User already exist");else try{s=await y.User.insert({invite_token:i,invite_token_expires:new Date(Date.now()+864e5),email:a,roles:e.user.roles||c.OrgUserRoles.VIEWER,token_version:(0,b.randomTokenString)()});const n=await y.User.count();if(this.appHooksService.emit(c.AppEvents.ORG_USER_INVITE,{invitedBy:e.req.user,user:s,count:n,ip:e.req.clientIp}),1===t.length&&!await this.projectUSerService.sendInviteEmail(a,i,e.req))return{invite_token:i,email:a};this.projectUSerService.sendInviteEmail(a,i,e.req)}catch(e){if(console.log(e),1===t.length)throw e;n.push({email:a,error:e.message})}}return 1===t.length?{msg:"success"}:{invite_token:i,emails:t,error:n}}async userSettings(e){g.NcError.notImplemented()}async userInviteResend(e){const t=await y.User.get(e.userId);t||g.NcError.badRequest(`User with id '${e.userId}' not found`);const a=(0,d.v4)();await y.User.update(t.id,{invite_token:a,invite_token_expires:new Date(Date.now()+864e5)});return await w.default.ncMeta.metaGet2(null,null,v.MetaTable.PLUGIN,{category:c.PluginCategory.EMAIL,active:!0})||g.NcError.badRequest("No Email Plugin is found. Please go to App Store to configure first or copy the invitation URL to users instead."),await this.projectUSerService.sendInviteEmail(t.email,a,e.req),this.appHooksService.emit(c.AppEvents.ORG_USER_RESEND_INVITE,{invitedBy:e.req.user,user:t,ip:e.req.clientIp}),!0}async generateResetUrl(e){const t=await y.User.get(e.userId);t||g.NcError.badRequest(`User with id '${e.userId}' not found`);const a=(0,d.v4)();return await y.User.update(t.id,{email:t.email,reset_password_token:a,reset_password_expires:new Date(Date.now()+36e5),token_version:(0,b.randomTokenString)()}),{reset_password_token:a,reset_password_url:e.siteUrl+`/auth/password/reset/${a}`}}async appSettingsGet(){var e;let t={};try{t=JSON.parse(null===(e=await y.Store.get(f.NC_APP_SETTINGS))||void 0===e?void 0:e.value)}catch(e){}return t}async appSettingsSet(e){return await y.Store.saveOrUpdate({value:JSON.stringify(e.settings),key:f.NC_APP_SETTINGS}),!0}};T=s([(0,l.Injectable)(),o("design:paramtypes",["function"==typeof(i=void 0!==m.ProjectUsersService&&m.ProjectUsersService)?i:Object,"function"==typeof(n=void 0!==p.AppHooksService&&p.AppHooksService)?n:Object])],T),t.OrgUsersService=T},59540:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PluginsService=void 0;const r=a(26481),l=a(68281),c=a(33206),d=a(78829),u=o(a(70781)),p=a(15147);let m=class{constructor(e){this.appHooksService=e}async pluginList(){return await p.Plugin.list()}async pluginTest(e){return(0,d.validatePayload)("swagger.json#/components/schemas/PluginTestReq",e.body),this.appHooksService.emit(l.AppEvents.PLUGIN_TEST,{testBody:e.body}),await u.default.test(e.body)}async pluginRead(e){return await p.Plugin.get(e.pluginId)}async pluginUpdate(e){(0,d.validatePayload)("swagger.json#/components/schemas/PluginReq",e.plugin);const t=await p.Plugin.update(e.pluginId,e.plugin);return this.appHooksService.emit(t.active?l.AppEvents.PLUGIN_INSTALL:l.AppEvents.PLUGIN_UNINSTALL,{plugin:t}),t}async isPluginActive(e){return await p.Plugin.isPluginActive(e.pluginTitle)}async webhookPluginList(){return(await p.Plugin.list()).filter((e=>["Slack","Microsoft Teams","Discord","Mattermost"].includes(e.title)))}};m=n([(0,r.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==c.AppHooksService&&c.AppHooksService)?i:Object])],m),t.PluginsService=m},95524:function(e,t,a){var i,n=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return s(t,e),t},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectUsersService=void 0;const d=a(26481),u=a(68281),p=a(25828),m=r(a(49632)),f=c(a(71564)),h=c(a(37912)),g=a(78829),_=c(a(27552)),b=a(33206),y=a(51401),w=c(a(70781)),v=a(60498),T=a(56248),O=a(15147),E=a(13609),S=a(33402),I=a(31339);let k=class{constructor(e){this.appHooksService=e}async userList(e){return new v.PagedResponseImpl(await O.ProjectUser.getUsersList(Object.assign(Object.assign({},e.query),{project_id:e.projectId})),Object.assign(Object.assign({},e.query),{count:await O.ProjectUser.getUsersCount(Object.assign({project_id:e.projectId},e.query))}))}async userInvite(e){(0,g.validatePayload)("swagger.json#/components/schemas/ProjectUserReq",e.projectUser),(0,I.getProjectRolePower)({project_roles:(0,u.extractRolesObj)(e.projectUser.roles)})>(0,I.getProjectRolePower)(e.req.user)&&y.NcError.badRequest("Insufficient privilege to invite with this role"),[u.ProjectRoles.CREATOR,u.ProjectRoles.EDITOR,u.ProjectRoles.COMMENTER,u.ProjectRoles.VIEWER,u.ProjectRoles.NO_ACCESS].includes(e.projectUser.roles)||y.NcError.badRequest("Invalid role");const t=(e.projectUser.email||"").toLowerCase().split(/\s*,\s*/).map((e=>e.trim())),a=t.filter((e=>!f.default.isEmail(e)));if(!t.length)return y.NcError.badRequest("Invalid email address");a.length&&y.NcError.badRequest("Invalid email address : "+a.join(", "));const i=(0,p.v4)(),n=[];for(const a of t){const s=await O.User.getByEmail(a),o=await O.Project.get(e.projectId);if(!o)return y.NcError.badRequest("Invalid project id");if(s){const t=await O.ProjectUser.get(e.projectId,s.id),i=await O.Project.get(e.projectId);if(!i)return y.NcError.badRequest("Invalid project id");t&&y.NcError.badRequest(`${s.email} with role ${t.roles} already exists in this project`),await O.ProjectUser.insert({project_id:e.projectId,fk_user_id:s.id,roles:e.projectUser.roles||"editor"}),this.appHooksService.emit(u.AppEvents.PROJECT_INVITE,{project:i,user:s,invitedBy:e.req.user,ip:e.req.clientIp});const n=await h.default.get(`${E.CacheScope.USER}:${a}___${e.projectId}`,E.CacheGetType.TYPE_OBJECT);n&&(n.roles=e.projectUser.roles||"editor",await h.default.set(`${E.CacheScope.USER}:${a}___${e.projectId}`,n))}else try{const n=await O.User.insert({invite_token:i,invite_token_expires:new Date(Date.now()+864e5),email:a,roles:u.OrgUserRoles.VIEWER,token_version:(0,T.randomTokenString)()});if(await O.ProjectUser.insert({project_id:e.projectId,fk_user_id:n.id,roles:e.projectUser.roles}),this.appHooksService.emit(u.AppEvents.PROJECT_INVITE,{project:o,user:n,invitedBy:e.req.user,ip:e.req.clientIp}),1===t.length&&!await this.sendInviteEmail(a,i,e.req))return{invite_token:i,email:a};this.sendInviteEmail(a,i,e.req)}catch(e){if(console.log(e),1===t.length)throw e;n.push({email:a,error:e.message})}}return 1===t.length?{msg:"The user has been invited successfully"}:{invite_token:i,emails:t,error:n}}async projectUserUpdate(e){(0,g.validatePayload)("swagger.json#/components/schemas/ProjectUserReq",e.projectUser),e.projectId||y.NcError.badRequest("Missing project id");const t=await O.Project.get(e.projectId);if(!t)return y.NcError.badRequest("Invalid project id");e.projectUser.roles.includes(u.ProjectRoles.OWNER)&&y.NcError.badRequest("Owner cannot be updated"),[u.ProjectRoles.CREATOR,u.ProjectRoles.EDITOR,u.ProjectRoles.COMMENTER,u.ProjectRoles.VIEWER,u.ProjectRoles.NO_ACCESS].includes(e.projectUser.roles)||y.NcError.badRequest("Invalid role");const a=await O.User.get(e.userId);a||y.NcError.badRequest(`User with id '${e.userId}' doesn't exist`);const i=await O.User.getWithRoles(e.userId,{user:a,projectId:e.projectId});return i||y.NcError.badRequest(`User with id '${e.userId}' doesn't exist in this project`),(0,I.getProjectRolePower)(i)>=(0,I.getProjectRolePower)(e.req.user)&&y.NcError.badRequest("Insufficient privilege to update user"),await O.ProjectUser.updateRoles(e.projectId,e.userId,e.projectUser.roles),this.appHooksService.emit(u.AppEvents.PROJECT_USER_UPDATE,{project:t,user:a,updatedBy:e.req.user,ip:e.req.clientIp,projectUser:e.projectUser}),{msg:"User has been updated successfully"}}async projectUserDelete(e){var t,a,i,n,s;const o=e.projectId;if((null===(t=e.req.user)||void 0===t?void 0:t.id)===e.userId&&y.NcError.badRequest("Admin can't delete themselves!"),!(null===(i=null===(a=e.req.user)||void 0===a?void 0:a.roles)||void 0===i?void 0:i.owner)){(null===(n=(await O.User.get(e.userId)).roles)||void 0===n?void 0:n.split(",").includes("super"))&&y.NcError.forbidden("Insufficient privilege to delete a super admin user.");const t=await O.ProjectUser.get(o,e.userId);(null===(s=null==t?void 0:t.roles)||void 0===s?void 0:s.split(",").includes("super"))&&y.NcError.forbidden("Insufficient privilege to delete a owner user.")}return await O.ProjectUser.delete(o,e.userId),!0}async projectUserInviteResend(e){const t=await O.User.get(e.userId);t||y.NcError.badRequest(`User with id '${e.userId}' not found`);const a=await O.Project.get(e.projectId);if(!a)return y.NcError.badRequest("Invalid project id");const i=(0,p.v4)();await O.User.update(t.id,{invite_token:i,invite_token_expires:new Date(Date.now()+864e5)});return await _.default.ncMeta.metaGet2(null,null,E.MetaTable.PLUGIN,{category:u.PluginCategory.EMAIL,active:!0})||y.NcError.badRequest("No Email Plugin is found. Please go to App Store to configure first or copy the invitation URL to users instead."),await this.sendInviteEmail(t.email,i,e.req),this.appHooksService.emit(u.AppEvents.PROJECT_USER_RESEND_INVITE,{project:a,user:t,invitedBy:e.req.user,ip:e.req.clientIp,projectUser:e.projectUser}),!0}async sendInviteEmail(e,t,i){var n,s,o,l;try{const c=(await Promise.resolve().then((()=>r(a(21507))))).default,d=await w.default.emailAdapter();if(d)return await d.mailSend({to:e,subject:"Verify email",html:m.render(c,{signupLink:`${i.ncSiteUrl}${null===(n=_.default.getConfig())||void 0===n?void 0:n.dashboardPath}#/signup/${t}`,projectName:null===(s=i.body)||void 0===s?void 0:s.projectName,roles:((null===(o=i.body)||void 0===o?void 0:o.roles)||"").split(",").map((e=>e.replace(/^./,(e=>e.toUpperCase())))).join(", "),adminEmail:null===(l=i.user)||void 0===l?void 0:l.email})}),!0}catch(e){throw console.log("Warning : `mailSend` failed, Please configure emailClient configuration.",e.message),e}}async projectUserMetaUpdate(e){var t,a,i;const n=(0,S.extractProps)(e.body,["starred","order","hidden"]);return Object.keys(n).length&&(await O.ProjectUser.get(e.projectId,null===(t=e.user)||void 0===t?void 0:t.id)?await O.ProjectUser.update(e.projectId,null===(i=e.user)||void 0===i?void 0:i.id,n):await O.ProjectUser.insert(Object.assign(Object.assign({},n),{project_id:e.projectId,fk_user_id:null===(a=e.user)||void 0===a?void 0:a.id}))),!0}};k=o([(0,d.Injectable)(),l("design:paramtypes",["function"==typeof(i=void 0!==b.AppHooksService&&b.AppHooksService)?i:Object])],k),t.ProjectUsersService=k},21507:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!doctype html>\n<html>\n<head>\n    <meta name="viewport" content="width=device-width">\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n    <title>Simple Transactional Email</title>\n    <style>\n        @media only screen and (max-width: 620px) {\n            table[class=body] h1 {\n                font-size: 28px !important;\n                margin-bottom: 10px !important;\n            }\n\n            table[class=body] p,\n            table[class=body] ul,\n            table[class=body] ol,\n            table[class=body] td,\n            table[class=body] span,\n            table[class=body] a {\n                font-size: 16px !important;\n            }\n\n            table[class=body] .wrapper,\n            table[class=body] .article {\n                padding: 10px !important;\n            }\n\n            table[class=body] .content {\n                padding: 0 !important;\n            }\n\n            table[class=body] .container {\n                padding: 0 !important;\n                width: 100% !important;\n            }\n\n            table[class=body] .main {\n                border-left-width: 0 !important;\n                border-radius: 0 !important;\n                border-right-width: 0 !important;\n            }\n\n            table[class=body] .btn table {\n                width: 100% !important;\n            }\n\n            table[class=body] .btn a {\n                width: 100% !important;\n            }\n\n            table[class=body] .img-responsive {\n                height: auto !important;\n                max-width: 100% !important;\n                width: auto !important;\n            }\n        }\n\n        @media all {\n            .ExternalClass {\n                width: 100%;\n            }\n\n            .ExternalClass,\n            .ExternalClass p,\n            .ExternalClass span,\n            .ExternalClass font,\n            .ExternalClass td,\n            .ExternalClass div {\n                line-height: 100%;\n            }\n\n            .apple-link a {\n                color: inherit !important;\n                font-family: inherit !important;\n                font-size: inherit !important;\n                font-weight: inherit !important;\n                line-height: inherit !important;\n                text-decoration: none !important;\n            }\n\n            #MessageViewBody a {\n                color: inherit;\n                text-decoration: none;\n                font-size: inherit;\n                font-family: inherit;\n                font-weight: inherit;\n                line-height: inherit;\n            }\n\n            .btn-primary table td:hover {\n                background-color: #34495e !important;\n            }\n\n            .btn-primary a:hover {\n                background-color: #34495e !important;\n                border-color: #34495e !important;\n            }\n        }\n    </style>\n</head>\n<body class=""\n      style="background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;">\n<span class="preheader"\n      style="color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;">This is preheader text. Some clients will show this text as a preview.</span>\n<table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body"\n       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;"\n       width="100%" bgcolor="#f6f6f6">\n    <tr>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n        <td class="container"\n            style="font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;"\n            width="580" valign="top">\n            <div class="content"\n                 style="box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;">\n\n                \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n                <table role="presentation" class="main"\n                       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;"\n                       width="100%">\n\n                    \x3c!-- START MAIN CONTENT AREA --\x3e\n                    <tr>\n                        <td class="wrapper"\n                            style="font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;"\n                            valign="top">\n                            <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                   style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                                   width="100%">\n                                <tr>\n                                    <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;"\n                                        valign="top">\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Hi,</p>\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            I invited you to be "<%- roles -%>" of the NocoDB project "<%- projectName %>".\n                                            Click the button below to to accept my invitation.</p>\n                                        <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                               class="btn btn-primary"\n                                               style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; box-sizing: border-box; width: 100%;"\n                                               width="100%">\n                                            <tbody>\n                                            <tr>\n                                                <td align="left"\n                                                    style="font-family: sans-serif; font-size: 14px; vertical-align: top; padding-bottom: 15px;"\n                                                    valign="top">\n                                                    <table role="presentation" border="0" cellpadding="0"\n                                                           cellspacing="0"\n                                                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: auto;">\n                                                        <tbody>\n                                                        <tr>\n                                                            <td style="font-family: sans-serif; font-size: 14px; vertical-align: top; border-radius: 5px; text-align: center; background-color: #3498db;"\n                                                                valign="top" align="center" bgcolor="#1088ff"><a\n                                                                        href="<%- signupLink %>" target="_blank"\n                                                                        style="border: solid 1px rgb(23, 139, 255); border-radius: 5px; box-sizing: border-box; cursor: pointer; display: inline-block; font-size: 14px; font-weight: bold; margin: 0; padding: 12px 25px; text-decoration: none; text-transform: capitalize; background-color: rgb(23, 139, 255); border-color: #3498db; color: #ffffff;">Signup</a>\n                                                            </td>\n                                                        </tr>\n                                                        </tbody>\n                                                    </table>\n                                                </td>\n                                            </tr>\n                                            </tbody>\n                                        </table>\n                                        <p style="font-family: sans-serif; font-size: 14px; font-weight: normal; margin: 0; margin-bottom: 15px;">\n                                            Thanks regards <%- adminEmail %>.</p>\n                                    </td>\n                                </tr>\n                            </table>\n                        </td>\n                    </tr>\n\n                    \x3c!-- END MAIN CONTENT AREA --\x3e\n                </table>\n                \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n                \x3c!-- START FOOTER --\x3e\n                <div class="footer" style="clear: both; margin-top: 10px; text-align: center; width: 100%;">\n                    <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                           width="100%">\n                        <tr>\n                            <td class="content-block"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <span class="apple-link"\n                                      style="color: #999999; font-size: 12px; text-align: center;"></span>\n                                \x3c!--                <br> Don\'t like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.--\x3e\n                            </td>\n                        </tr>\n                        <tr>\n                            <td class="content-block powered-by"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <a href="http://nocodb.com/">NocoDB</a>\n                                \x3c!--                Powered by <a href="http://htmlemail.io">HTMLemail</a>.--\x3e\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                \x3c!-- END FOOTER --\x3e\n\n            </div>\n        </td>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n    </tr>\n</table>\n</body>\n</html>\n'},36701:function(e,t,a){var i,n,s,o=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&o(t,e,a);return r(t,e),t},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectsService=void 0;const p=a(16464),m=a(26481),f=c(a(73059)),h=a(30754),g=a(68281),_=a(33206),b=a(78829),y=a(51401),w=a(33402),v=u(a(40516)),T=a(15147),O=u(a(27552)),E=a(35043),S=a(5311),I=a(13609),k=a(19316),C=(0,h.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz_",4);let j=class{constructor(e,t,a){this.appHooksService=e,this.metaService=t,this.tablesService=a}async projectList(e){var t;return(0,g.extractRolesObj)(null===(t=e.user)||void 0===t?void 0:t.roles)[g.OrgUserRoles.SUPER_ADMIN]?await T.Project.list(e.query):await T.ProjectUser.getProjectsList(e.user.id,e.query)}async getProjectWithInfo(e){return await T.Project.getWithInfo(e.projectId)}sanitizeProject(e){var t;const a=Object.assign({},e);return null===(t=a.bases)||void 0===t||t.forEach((e=>{["config"].forEach((t=>delete e[t]))})),a}async projectUpdate(e){(0,b.validatePayload)("swagger.json#/components/schemas/ProjectUpdateReq",e.project);const t=await T.Project.getWithInfo(e.projectId),a=(0,w.extractPropsAndSanitize)(null==e?void 0:e.project,["title","meta","color","status"]);await this.validateProjectTitle(a,t);const i=await T.Project.update(e.projectId,a);return this.appHooksService.emit(g.AppEvents.PROJECT_UPDATE,{project:t,user:e.user}),i}async validateProjectTitle(e,t){(null==e?void 0:e.title)&&t.title!==e.title&&await T.Project.getByTitle(e.title)&&y.NcError.badRequest("Project title already in use")}async projectSoftDelete(e){const t=await T.Project.getWithInfo(e.projectId);return t||y.NcError.notFound("Project not found"),await T.Project.softDelete(e.projectId),this.appHooksService.emit(g.AppEvents.PROJECT_DELETE,{project:t,user:e.user}),!0}async projectCreate(e){var t;(0,b.validatePayload)("swagger.json#/components/schemas/ProjectReq",e.project);const i=await this.metaService.genNanoid(I.MetaTable.PROJECT),n=e.project;if(n.id=i,n.external)process.env.NC_CONNECT_TO_EXTERNAL_DB_DISABLED&&y.NcError.badRequest("Connecting to external db is disabled"),n.is_meta=!1;else{const e=C();if(n.prefix=`nc_${e}__`,n.is_meta=!0,"true"===process.env.NC_MINIMAL_DBS){const e=a(57147),t=(0,E.getToolDir)(),i=(0,h.customAlphabet)("1234567890abcdefghijklmnopqrstuvwxyz",14);await(0,p.promisify)(e.exists)(`${t}/nc_minimal_dbs`)||await(0,p.promisify)(e.mkdir)(`${t}/nc_minimal_dbs`);const s=i(),o=f.sanitize(n.title);n.prefix="",n.bases=[{type:"sqlite3",is_meta:!1,config:{client:"sqlite3",connection:{client:"sqlite3",database:o,connection:{filename:`${t}/nc_minimal_dbs/${o}_${s}.db`}}},inflection_column:"camelize",inflection_table:"camelize"}]}else{const e=null===(t=O.default.getConfig().meta)||void 0===t?void 0:t.db;n.bases=[{type:null==e?void 0:e.client,config:null,is_meta:!0,inflection_column:"camelize",inflection_table:"camelize"}]}}(null==n?void 0:n.title.length)>50&&y.NcError.badRequest("Project title exceeds 50 characters"),n.title=f.sanitize(n.title),n.slug=n.title;const s=await T.Project.createProject(n);await T.ProjectUser.insert({fk_user_id:e.user.id,project_id:s.id,roles:"owner"}),await(0,v.default)(s);for(const e of await s.getBases())if("true"!==process.env.NC_CLOUD&&!s.is_meta){const t=await(0,b.populateMeta)(e,s);this.appHooksService.emit(g.AppEvents.APIS_CREATED,{info:t}),delete e.config}return this.appHooksService.emit(g.AppEvents.PROJECT_CREATE,{project:s,user:e.user,xcdb:!n.external}),s}async createDefaultProject(e){const t=await this.projectCreate({project:{title:"Getting Started",type:"database"},user:e.user}),a=g.SqlUiFactory.create({client:t.bases[0].type}),i=null==a?void 0:a.getNewTableColumns(),n=await this.tablesService.tableCreate({projectId:t.id,baseId:t.bases[0].id,table:{title:"Features",table_name:"Features",columns:i},user:e.user});return t.tables=[n],t}};j=l([(0,m.Injectable)(),d("design:paramtypes",["function"==typeof(i=void 0!==_.AppHooksService&&_.AppHooksService)?i:Object,"function"==typeof(n=void 0!==S.MetaService&&S.MetaService)?n:Object,"function"==typeof(s=void 0!==k.TablesService&&k.TablesService)?s:Object])],j),t.ProjectsService=j},35531:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicDatasExportService=void 0;const n=a(26481);let s=class{};s=i([(0,n.Injectable)()],s),t.PublicDatasExportService=s},75885:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicDatasService=t.sanitizeUrlPath=void 0;const s=n(a(71017)),o=a(26481),r=a(30754),l=a(68281),c=n(a(32488)),d=a(87049),u=a(51401),p=n(a(89103)),m=n(a(70781)),f=a(60498),h=a(7214),g=n(a(19356)),_=a(43902),b=a(15147);function y(e){return e.map((e=>e.replace(/[/.?#]+/g,"_")))}t.sanitizeUrlPath=y;let w=class{async dataList(e){const t=await b.View.getByUUID(e.sharedViewUuid);if(t||u.NcError.notFound("Not found"),t.type!==l.ViewTypes.GRID&&t.type!==l.ViewTypes.KANBAN&&t.type!==l.ViewTypes.GALLERY&&t.type!==l.ViewTypes.MAP&&u.NcError.notFound("Not found"),t.password&&t.password!==e.password)return u.NcError.forbidden(l.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);const a=await b.Model.getByIdOrName({id:null==t?void 0:t.fk_model_id}),i=await b.Base.get(a.base_id),n=await b.Model.getBaseModelSQL({id:a.id,viewId:null==t?void 0:t.id,dbDriver:await g.default.get(i)}),s=Object.assign({},e.query);try{s.filterArr=JSON.parse(s.filterArrJson)}catch(e){}try{s.sortArr=JSON.parse(s.sortArrJson)}catch(e){}let o=[],r=0;try{const{ast:i}=await(0,p.default)({query:e.query,model:a,view:t});o=await(0,d.nocoExecute)(i,await n.list(s),{},s),r=await n.count(s)}catch(e){console.log(e),u.NcError.internalServerError("Please check server log for more details")}return new f.PagedResponseImpl(o,Object.assign(Object.assign({},e.query),{count:r}))}async groupedDataList(e){const t=await b.View.getByUUID(e.sharedViewUuid);if(t||u.NcError.notFound("Not found"),t.type!==l.ViewTypes.GRID&&t.type!==l.ViewTypes.KANBAN&&t.type!==l.ViewTypes.GALLERY&&u.NcError.notFound("Not found"),t.password&&t.password!==e.password)return u.NcError.forbidden(l.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);const a=await b.Model.getByIdOrName({id:null==t?void 0:t.fk_model_id});return await this.getGroupedDataList({model:a,view:t,query:e.query,groupColumnId:e.groupColumnId})}async getGroupedDataList(e){const{model:t,view:a,query:i={},groupColumnId:n}=e,s=await b.Base.get(e.model.base_id),o=await b.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await g.default.get(s)}),{ast:r}=await(0,p.default)({model:t,query:e.query,view:a}),l=Object.assign({},i);try{l.filterArr=JSON.parse(l.filterArrJson)}catch(e){}try{l.sortArr=JSON.parse(l.sortArrJson)}catch(e){}try{l.options=JSON.parse(l.optionsArrJson)}catch(e){}let c=[];try{const e=await o.groupedList(Object.assign(Object.assign({},l),{groupColumnId:n}));c=await(0,d.nocoExecute)({key:1,value:r},e,{},l);const t=await o.groupedListCount(Object.assign(Object.assign({},l),{groupColumnId:n}));c=c.map((e=>{var a,n;const s=null!==(n=null===(a=t.find((t=>t.key===e.key)))||void 0===a?void 0:a.count)&&void 0!==n?n:0;return e.value=new f.PagedResponseImpl(e.value,Object.assign(Object.assign({},i),{count:s})),e}))}catch(e){console.log(e),u.NcError.internalServerError("Please check server log for more details")}return c}async dataGroupBy(e){const t=await b.View.getByUUID(e.sharedViewUuid);if(t||u.NcError.notFound("Not found"),t.type!==l.ViewTypes.GRID&&u.NcError.notFound("Not found"),t.password&&t.password!==e.password)return u.NcError.forbidden(l.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);const a=await b.Model.getByIdOrName({id:null==t?void 0:t.fk_model_id});return await this.getDataGroupBy({model:a,view:t,query:e.query})}async getDataGroupBy(e){try{const{model:t,view:a,query:i={}}=e,n=await b.Base.get(t.base_id),s=await b.Model.getBaseModelSQL({id:t.id,viewId:null==a?void 0:a.id,dbDriver:await g.default.get(n)}),o=Object.assign({},i);try{o.filterArr=JSON.parse(o.filterArrJson)}catch(e){}try{o.sortArr=JSON.parse(o.sortArrJson)}catch(e){}const r=await s.groupBy(o),l=await s.groupByCount(o);return new f.PagedResponseImpl(r,Object.assign(Object.assign({},i),{count:l}))}catch(e){console.log(e),u.NcError.internalServerError("Please check server log for more details")}}async dataInsert(e){var t;const a=await b.View.getByUUID(e.sharedViewUuid);if(a||u.NcError.notFound(),a.type!==l.ViewTypes.FORM&&u.NcError.notFound(),a.password&&a.password!==e.password)return u.NcError.forbidden(l.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);const i=await b.Model.getByIdOrName({id:null==a?void 0:a.fk_model_id}),n=await b.Base.get(i.base_id),o=await n.getProject(),d=await b.Model.getBaseModelSQL({id:i.id,viewId:null==a?void 0:a.id,dbDriver:await g.default.get(n)});await a.getViewWithInfo(),await a.getColumns(),await a.getModelWithInfo(),await a.model.getColumns();const p=a.model.columns=a.columns.filter((e=>e.show)).reduce(((e,t)=>(e[a.model.columnsById[t.fk_column_id].title]=new b.Column(Object.assign(Object.assign({},t),a.model.columnsById[t.fk_column_id])),e)),{});let f=null==e?void 0:e.body;"string"==typeof f&&(f=JSON.parse(f));const h=Object.entries(f).reduce(((e,[t,a])=>(t in p&&(e[t]=a),e)),{}),w={},v=await m.default.storageAdapter();for(const a of e.files||[]){const e=null===(t=null==a?void 0:a.fieldname)||void 0===t?void 0:t.replace(/^_|\[\d*]$/g,""),n=y(["noco",o.title,i.title,e]);if(e in p&&p[e].uidt===l.UITypes.Attachment){w[e]=w[e]||[];const t=`${(0,r.nanoid)(18)}${s.default.extname(a.originalname)}`,i=await v.fileCreate((0,c.default)(s.default.join("nc","uploads",...n,t)),a);let o;i||(o=`download/${n.join("/")}/${t}`),w[e].push(Object.assign(Object.assign(Object.assign({},i?{url:i}:{}),o?{path:o}:{}),{title:a.originalname,mimetype:a.mimetype,size:a.size,icon:_.mimeIcons[s.default.extname(a.originalname).slice(1)]||void 0}))}}for(const[e,t]of Object.entries(w))h[e]=JSON.stringify(t);return await d.nestedInsert(h,null)}async relDataList(e){const t=await b.View.getByUUID(e.sharedViewUuid);t||u.NcError.notFound("Not found"),t.type!==l.ViewTypes.FORM&&t.type!==l.ViewTypes.GALLERY&&u.NcError.notFound("Not found"),t.password&&t.password!==e.password&&u.NcError.forbidden(l.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);const a=await b.Column.get({colId:e.columnId}),i=await a.getColOptions(),n=await i.getRelatedTable(),s=await b.Base.get(n.base_id),o=await b.Model.getBaseModelSQL({id:n.id,viewId:null==t?void 0:t.id,dbDriver:await g.default.get(s)}),{ast:r,dependencyFields:c}=await(0,p.default)({query:e.query,model:n,extractOnlyPrimaries:!0});let m=[],h=0;try{m=m=await(0,d.nocoExecute)(r,await o.list(c),{},c),h=await o.count(c)}catch(e){console.log(e),u.NcError.internalServerError("Please check server log for more details")}return new f.PagedResponseImpl(m,Object.assign(Object.assign({},e.query),{count:h}))}async publicMmList(e){var t;const a=await b.View.getByUUID(e.sharedViewUuid);a||u.NcError.notFound("Not found"),a.type!==l.ViewTypes.GRID&&a.type!==l.ViewTypes.KANBAN&&a.type!==l.ViewTypes.GALLERY&&u.NcError.notFound("Not found"),a.password&&a.password!==e.password&&u.NcError.forbidden(l.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);(await(0,h.getColumnByIdOrName)(e.columnId,await a.getModel())).fk_model_id!==a.fk_model_id&&u.NcError.badRequest("Column doesn't belongs to the model");const i=await b.Base.get(a.base_id),n=await b.Model.getBaseModelSQL({id:a.fk_model_id,viewId:null==a?void 0:a.id,dbDriver:await g.default.get(i)}),s="List",o={[s]:1},r=null===(t=await(0,d.nocoExecute)(o,{[s]:async t=>await n.mmList({colId:e.columnId,parentId:e.rowId},t)},{},{nested:{[s]:e.query}}))||void 0===t?void 0:t[s],c=await n.mmListCount({colId:e.columnId,parentId:e.rowId});return new f.PagedResponseImpl(r,Object.assign(Object.assign({},e.query),{count:c}))}async publicHmList(e){var t;const a=await b.View.getByUUID(e.sharedViewUuid);a||u.NcError.notFound("Not found"),a.type!==l.ViewTypes.GRID&&a.type!==l.ViewTypes.KANBAN&&a.type!==l.ViewTypes.GALLERY&&u.NcError.notFound("Not found"),a.password&&a.password!==e.password&&u.NcError.forbidden(l.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD);(await(0,h.getColumnByIdOrName)(e.columnId,await a.getModel())).fk_model_id!==a.fk_model_id&&u.NcError.badRequest("Column doesn't belongs to the model");const i=await b.Base.get(a.base_id),n=await b.Model.getBaseModelSQL({id:a.fk_model_id,viewId:null==a?void 0:a.id,dbDriver:await g.default.get(i)}),s="List",o={[s]:1},r=null===(t=await(0,d.nocoExecute)(o,{[s]:async t=>await n.hmList({colId:e.columnId,id:e.rowId},t)},{},{nested:{[s]:e.query}}))||void 0===t?void 0:t[s],c=await n.hmListCount({colId:e.columnId,id:e.rowId});return new f.PagedResponseImpl(r,Object.assign(Object.assign({},e.query),{count:c}))}};w=i([(0,o.Injectable)()],w),t.PublicDatasService=w},47258:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.PublicMetasService=void 0;const n=a(26481),s=a(68281),o=a(68281),r=a(51401),l=a(15147);let c=class{async viewMetaGet(e){const t=await l.View.getByUUID(e.sharedViewUuid);t||r.NcError.notFound("Not found"),t.password&&t.password!==e.password&&r.NcError.forbidden(s.ErrorMessages.INVALID_SHARED_VIEW_PASSWORD),await t.getFilters(),await t.getSorts(),await t.getViewWithInfo(),await t.getColumns(),await t.getModelWithInfo(),await t.model.getColumns();const a=await l.Base.get(t.model.base_id);t.client=a.type,delete t.password,t.model.columns=t.columns.filter((e=>{const a=t.model.columnsById[e.fk_column_id];return e.show||a.rqd&&!a.cdf&&!a.ai||a.pk||t.model.columns.some((a=>(0,o.isLinksOrLTAR)(a.uidt)&&a.colOptions.type===s.RelationTypes.BELONGS_TO&&t.columns.some((e=>e.fk_column_id===a.id&&e.show))&&a.colOptions.fk_child_column_id===e.fk_column_id))})).map((e=>new l.Column(Object.assign(Object.assign({},e),t.model.columnsById[e.fk_column_id]))));const i={};for(const e of t.model.columns)await this.extractRelatedMetas({col:e,relatedMetas:i});return t.relatedMetas=i,t}async extractRelatedMetas({col:e,relatedMetas:t={}}){(0,o.isLinksOrLTAR)(e.uidt)?await this.extractLTARRelatedMetas({ltarColOption:await e.getColOptions(),relatedMetas:t}):s.UITypes.Lookup===e.uidt&&await this.extractLookupRelatedMetas({lookupColOption:await e.getColOptions(),relatedMetas:t})}async extractLTARRelatedMetas({ltarColOption:e,relatedMetas:t={}}){t[e.fk_related_model_id]=await l.Model.getWithInfo({id:e.fk_related_model_id}),"mm"===e.type&&(t[e.fk_mm_model_id]=await l.Model.getWithInfo({id:e.fk_mm_model_id}))}async extractLookupRelatedMetas({lookupColOption:e,relatedMetas:t={}}){const a=await l.Column.get({colId:e.fk_relation_column_id}),i=await l.Column.get({colId:e.fk_lookup_column_id});t[a.fk_model_id]||(t[a.fk_model_id]=await l.Model.getWithInfo({id:a.fk_model_id})),t[i.fk_model_id]||(t[i.fk_model_id]=await l.Model.getWithInfo({id:i.fk_model_id})),await this.extractRelatedMetas({col:i,relatedMetas:t})}async publicSharedBaseGet(e){const t=await l.Project.getByUuid(e.sharedBaseUuid);return t||r.NcError.notFound(),{project_id:t.id}}};c=i([(0,n.Injectable)()],c),t.PublicMetasService=c},27744:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SharedBasesService=void 0;const o=a(26481),r=a(68281),l=a(25828),c=a(33206),d=a(78829),u=a(51401),p=a(15147),m="/nc";let f=class{constructor(e){this.appHooksService=e}async createSharedBaseLink(e){(0,d.validatePayload)("swagger.json#/components/schemas/SharedBaseReq",e);const t=await p.Project.get(e.projectId);let a=null==e?void 0:e.roles;(!a||"editor"!==a&&"viewer"!==a)&&(a="viewer"),t||u.NcError.badRequest("Invalid project id");const i={uuid:(0,l.v4)(),password:null==e?void 0:e.password,roles:a};return await p.Project.update(t.id,i),i.url=`${e.siteUrl}${m}#/nc/base/${i.uuid}`,delete i.password,this.appHooksService.emit(r.AppEvents.SHARED_BASE_GENERATE_LINK,{link:i.url,project:t}),i}async updateSharedBaseLink(e){(0,d.validatePayload)("swagger.json#/components/schemas/SharedBaseReq",e);const t=await p.Project.get(e.projectId);let a=e.roles;(!a||"editor"!==a&&"viewer"!==a)&&(a="viewer"),t||u.NcError.badRequest("Invalid project id");const i={uuid:t.uuid||(0,l.v4)(),password:e.password,roles:a};return await p.Project.update(t.id,i),i.url=`${e.siteUrl}${m}#/nc/base/${i.uuid}`,delete i.password,this.appHooksService.emit(r.AppEvents.SHARED_BASE_GENERATE_LINK,{link:i.url,project:t}),i}async disableSharedBaseLink(e){const t=await p.Project.get(e.projectId);t||u.NcError.badRequest("Invalid project id");return await p.Project.update(t.id,{uuid:null}),this.appHooksService.emit(r.AppEvents.SHARED_BASE_DELETE_LINK,{project:t}),{uuid:null}}async getSharedBaseLink(e){const t=await p.Project.get(e.projectId);t||u.NcError.badRequest("Invalid project id");const a={uuid:t.uuid,roles:t.roles};return a.uuid&&(a.url=`${e.siteUrl}${m}#/nc/base/${a.shared_base_id}`),a}};f=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==c.AppHooksService&&c.AppHooksService)?i:Object])],f),t.SharedBasesService=f},40330:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SortsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async sortGet(e){return u.Sort.get(e.sortId)}async sortDelete(e){const t=await u.Sort.get(e.sortId);return t||d.NcError.badRequest("Sort not found"),await u.Sort.delete(e.sortId),this.appHooksService.emit(r.AppEvents.SORT_CREATE,{sort:t}),!0}async sortUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/SortReq",e.sort);const t=await u.Sort.get(e.sortId);t||d.NcError.badRequest("Sort not found");const a=await u.Sort.update(e.sortId,e.sort);return this.appHooksService.emit(r.AppEvents.SORT_UPDATE,{sort:t}),a}async sortCreate(e){(0,c.validatePayload)("swagger.json#/components/schemas/SortReq",e.sort);const t=await u.Sort.insert(Object.assign(Object.assign({},e.sort),{fk_view_id:e.viewId}));return this.appHooksService.emit(r.AppEvents.SORT_CREATE,{sort:t}),t}async sortList(e){return u.Sort.list({viewId:e.viewId})}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.SortsService=p},94163:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(51401),d=a(60498),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async syncSourceList(e){return new d.PagedResponseImpl(await u.SyncSource.list(e.projectId,e.baseId))}async syncCreate(e){const t=await u.Project.getWithInfo(e.projectId),a=await u.SyncSource.insert(Object.assign(Object.assign({},e.syncPayload),{fk_user_id:e.userId,base_id:e.baseId?e.baseId:t.bases[0].id,project_id:e.projectId}));return this.appHooksService.emit(r.AppEvents.SYNC_SOURCE_CREATE,{syncSource:a}),a}async syncDelete(e){const t=await u.SyncSource.get(e.syncId);t||c.NcError.badRequest("Sync source not found");const a=await u.SyncSource.delete(e.syncId);return this.appHooksService.emit(r.AppEvents.SYNC_SOURCE_DELETE,{syncSource:t}),a}async syncUpdate(e){const t=await u.SyncSource.get(e.syncId);t||c.NcError.badRequest("Sync source not found");const a=await u.SyncSource.update(e.syncId,e.syncPayload);return this.appHooksService.emit(r.AppEvents.SYNC_SOURCE_UPDATE,{syncSource:t}),a}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.SyncService=p},19316:function(e,t,a){var i,n,s,o=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&o(t,e,a);return r(t,e),t},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TablesService=void 0;const p=a(26481),m=u(a(73059)),f=a(68281),h=a(68281),g=a(80181),_=a(27695),b=a(33206),y=u(a(58564)),w=a(51401),v=u(a(58177)),T=u(a(8609)),O=c(a(10460)),E=u(a(35619)),S=a(15147),I=u(a(27552)),k=u(a(19356)),C=a(78829);let j=class{constructor(e,t,a){this.metaDiffService=e,this.appHooksService=t,this.columnsService=a}async tableUpdate(e){var t;const a=await S.Model.get(e.tableId),i=await S.Project.getWithInfo(e.table.project_id||e.projectId),n=i.bases.find((e=>e.id===a.base_id));if(a.project_id!==i.id&&w.NcError.badRequest("Model does not belong to project"),"meta"in e.table)return await S.Model.updateMeta(e.tableId,e.table.meta),!0;e.table.table_name||w.NcError.badRequest("Missing table name `table_name` property in request body"),n.isMeta(!0)&&i.prefix&&!n.isMeta(!0,1)&&(e.table.table_name.startsWith(i.prefix)||(e.table.table_name=`${i.prefix}${e.table.table_name}`)),e.table.table_name=m.default.sanitize(e.table.table_name),/^\s+|\s+$/.test(e.table.table_name)&&w.NcError.badRequest("Leading or trailing whitespace not allowed in table names"),await S.Model.checkTitleAvailable({table_name:e.table.table_name,project_id:i.id,base_id:n.id})||w.NcError.badRequest("Duplicate table name"),e.table.title||(e.table.title=(0,O.default)(e.table.table_name,i.prefix,n)),await S.Model.checkAliasAvailable({title:e.table.title,project_id:i.id,base_id:n.id})||w.NcError.badRequest("Duplicate table alias");const s=await y.default.getSqlMgr(i);let o=255;const r=(await k.default.getSqlClient(n)).knex.clientType();return"mysql2"===r||"mysql"===r?o=64:"pg"===r?o=63:"mssql"===r&&(o=128),e.table.table_name.length>o&&w.NcError.badRequest(`Table name exceeds ${o} characters`),await s.sqlOpPlus(n,"tableRename",Object.assign(Object.assign({},e.table),{tn:e.table.table_name,tn_old:a.table_name,schema:null===(t=n.getConfig())||void 0===t?void 0:t.schema})),await S.Model.updateAliasAndTableName(e.tableId,e.table.title,e.table.table_name),this.appHooksService.emit(h.AppEvents.TABLE_UPDATE,{table:a,user:e.user}),!0}reorderTable(e){return S.Model.updateOrder(e.tableId,e.order)}async tableDelete(e){var t;const a=await S.Model.getByIdOrName({id:e.tableId});await a.getColumns();const i=await S.Project.getWithInfo(a.project_id),n=i.bases.find((e=>e.id===a.base_id)),s=a.columns.filter((e=>(0,f.isLinksOrLTAR)(e)));if((null==s?void 0:s.length)&&!n.isMeta()){const e=await Promise.all(s.map((async e=>e.getColOptions().then((e=>e.getRelatedTable())).then())));w.NcError.badRequest(`Table can't be deleted since Table is being referred in following tables : ${e.join(", ")}. Delete LinkToAnotherRecord columns and try again.`)}const o=await I.default.ncMeta.startTransaction();let r;try{for(const t of s)t.system||await S.Column.get({colId:t.id},o)&&await this.columnsService.columnDelete({req:e.req,columnId:t.id,user:e.user},o);const l=await y.default.getSqlMgr(i,o);a.tn=a.table_name,a.columns=a.columns.filter((e=>!(0,f.isVirtualCol)(e))),a.columns.forEach((e=>{e.cn=e.column_name})),a.type===f.ModelTypes.TABLE?await l.sqlOpPlus(n,"tableDelete",a):a.type===f.ModelTypes.VIEW&&await l.sqlOpPlus(n,"viewDelete",Object.assign(Object.assign({},a),{view_name:a.table_name})),this.appHooksService.emit(h.AppEvents.TABLE_DELETE,{table:a,user:e.user,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp}),r=await a.delete(o),await o.commit()}catch(e){throw await o.rollback(),e}return r}async getTableWithAccessibleViews(e){const t=await S.Model.getWithInfo({id:e.tableId});t||w.NcError.notFound("Table not found");const a=await this.xcVisibilityMetaGet(t.project_id,[t]);return t.views=a.filter((t=>{var a;return Object.keys(null===(a=e.user)||void 0===a?void 0:a.roles).some((a=>{var i;return(null===(i=e.user)||void 0===i?void 0:i.roles[a])&&!t.disabled[a]}))})),t}async xcVisibilityMetaGet(e,t=null,a=!0){const i=["owner","creator","viewer","editor","commenter","guest"].reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:!1})),{});let n=t||await S.Model.list({project_id:e,base_id:void 0});n=a?n:n.filter((e=>!e.mm));const s=await n.reduce((async(e,t)=>{const a=await e,n=await t.getViews();for(const e of n)a[e.id]=Object.assign(Object.assign({ptn:t.table_name,_ptn:t.title,ptype:t.type,tn:e.title,_tn:e.title,table_meta:t.meta},e),{disabled:Object.assign({},i)});return a}),Promise.resolve({})),o=await S.ModelRoleVisibility.list(e);for(const e of o)s[e.fk_view_id]&&(s[e.fk_view_id].disabled[e.role]=!!e.disabled);return Object.values(s)}async getAccessibleTables(e){const t=(await this.xcVisibilityMetaGet(e.projectId)).reduce(((t,a)=>(t[a.fk_model_id]=t[a.fk_model_id]||0,Object.values(f.ProjectRoles).some((t=>e.roles[t]&&!a.disabled[t]))&&t[a.fk_model_id]++,t)),{}),a=(await S.Model.list({project_id:e.projectId,base_id:e.baseId})).filter((e=>t[e.id]));return e.includeM2M?a:a.filter((e=>!e.mm))}async tableCreate(e){var t,a,i,n,s,o,r;(0,C.validatePayload)("swagger.json#/components/schemas/TableReq",e.table);const l=Object.assign({},e.table),c=await S.Project.getWithInfo(e.projectId);let d=c.bases[0];e.baseId&&(d=c.bases.find((t=>t.id===e.baseId))),(!l.table_name||c.prefix&&c.prefix===l.table_name)&&w.NcError.badRequest("Missing table name `table_name` property in request body"),d.is_meta&&c.prefix&&(l.table_name.startsWith(c.prefix)||(l.table_name=`${c.prefix}_${l.table_name}`)),l.table_name=m.default.sanitize(l.table_name),/^\s+|\s+$/.test(l.table_name)&&w.NcError.badRequest("Leading or trailing whitespace not allowed in table names"),await S.Model.checkTitleAvailable({table_name:l.table_name,project_id:c.id,base_id:d.id})||w.NcError.badRequest("Duplicate table name"),l.title||(l.title=(0,O.default)(l.table_name,c.prefix,d)),await S.Model.checkAliasAvailable({title:l.title,project_id:c.id,base_id:d.id})||w.NcError.badRequest("Duplicate table alias");const u=await y.default.getSqlMgr(c),p=await k.default.getSqlClient(d);let g=255;const _=p.knex.clientType();"mysql2"===_||"mysql"===_?g=64:"pg"===_?g=63:"mssql"===_&&(g=128),l.table_name.length>g&&w.NcError.badRequest(`Table name exceeds ${g} characters`);const b=S.Column.getMaxColumnNameLength(_);for(const t of e.table.columns)t.column_name.length>b&&w.NcError.badRequest(`Column name ${t.column_name} exceeds ${b} characters`);l.columns=await Promise.all(null===(t=e.table.columns)||void 0===t?void 0:t.map((async e=>Object.assign(Object.assign({},await(0,v.default)(e,d)),{cn:e.column_name,column_name:e.column_name})))),await u.sqlOpPlus(d,"tableCreate",Object.assign(Object.assign({},l),{tn:l.table_name}));const I=null===(n=null===(i=await p.columnList({tn:l.table_name,schema:null===(a=d.getConfig())||void 0===a?void 0:a.schema}))||void 0===i?void 0:i.data)||void 0===n?void 0:n.list,j=await S.Model.list({project_id:c.id,base_id:d.id});(0,E.default)(e.table.columns);const x=await S.Model.insert(c.id,d.id,Object.assign(Object.assign({},l),{columns:I.map(((t,a)=>{var i,n;const s=null===(n=null===(i=e.table)||void 0===i?void 0:i.columns)||void 0===n?void 0:n.find((e=>t.cn===e.column_name));return Object.assign(Object.assign(Object.assign(Object.assign({},s),{uidt:(null==s?void 0:s.uidt)||t.uidt||(0,T.default)(d,t)}),t),{dtxp:[f.UITypes.MultiSelect,f.UITypes.SingleSelect].includes(s.uidt)?s.dtxp:t.dtxp,title:(null==s?void 0:s.title)||(0,O.getColumnNameAlias)(t.cn,d),column_name:t.cn,order:a+1})})),order:+(null!==(o=null===(s=null==j?void 0:j.pop())||void 0===s?void 0:s.order)&&void 0!==o?o:0)+1}));return this.appHooksService.emit(h.AppEvents.TABLE_CREATE,{table:x,user:e.user,ip:null===(r=e.req)||void 0===r?void 0:r.clientIp}),x}};j=l([(0,p.Injectable)(),d("design:paramtypes",["function"==typeof(i=void 0!==g.MetaDiffsService&&g.MetaDiffsService)?i:Object,"function"==typeof(n=void 0!==b.AppHooksService&&b.AppHooksService)?n:Object,"function"==typeof(s=void 0!==_.ColumnsService&&_.ColumnsService)?s:Object])],j),t.TablesService=j},91215:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a};Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryService=void 0;const o=a(26481),r=a(87049),l=a(87049);let c=class{constructor(){this.defaultPayload={package_id:r.packageInfo.version}}sendEvent(e){var{evt_type:t}=e,a=s(e,["evt_type"]);"$pageview"===t?l.T.page(Object.assign(Object.assign({},a),{event_name:t})):l.T.event(Object.assign(Object.assign({},a),{event_name:t}))}};c=i([(0,o.Injectable)(),n("design:paramtypes",[])],c),t.TelemetryService=c},74564:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.setTokenCookie=t.randomTokenString=t.genJwt=void 0;const r=o(a(6113)),l=s(a(99344));t.genJwt=function(e,t){return l.sign({email:e.email,id:e.id,roles:e.roles,token_version:e.token_version},t.auth.jwt.secret,Object.assign({expiresIn:"10h"},t.auth.jwt.options))},t.randomTokenString=function(){return r.default.randomBytes(40).toString("hex")},t.setTokenCookie=function(e,t){const a={httpOnly:!0,expires:new Date(Date.now()+6048e5),domain:process.env.NC_BASE_HOST_NAME||void 0};e.cookie("refresh_token",t,a)}},1119:function(e,t,a){var i,n,s,o=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},c=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&o(t,e,a);return r(t,e),t},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UsersService=void 0;const p=a(16464),m=a(26481),f=a(68281),h=a(25828),g=a(71564),_=a(87049),b=c(a(49632)),y=u(a(98432)),w=a(74564),v=a(94647),T=a(33206),O=a(78829),E=a(5311),S=a(13609),I=u(a(27552)),k=a(15147),C=a(56248),j=u(a(70781)),x=a(51401),R=a(36701);let A=class{constructor(e,t,a){this.metaService=e,this.appHooksService=t,this.projectsService=a}validateEmailPattern(e){const t=process.env.NC_AUTH_EMAIL_PATTERN;if(t){new RegExp(t).test(e)||x.NcError.forbidden("Not allowed to signup/signin with this email")}}async findOne(e){const t=e.toLowerCase();return await this.metaService.metaGet(null,null,S.MetaTable.USERS,{email:t})}async insert(e){var t;return this.metaService.metaInsert2(null,null,S.MetaTable.USERS,Object.assign(Object.assign({},e),{email:null===(t=e.email)||void 0===t?void 0:t.toLowerCase()}))}async registerNewUserIfAllowed({email:e,salt:t,password:a,email_verification_token:i}){var n;this.validateEmailPattern(e);let s=f.OrgUserRoles.CREATOR;const o=await k.User.isFirst();if(o&&"true"!==process.env.NC_CLOUD)s=`${f.OrgUserRoles.CREATOR},${f.OrgUserRoles.SUPER_ADMIN}`,_.T.emit("evt",{evt_type:"project:invite",count:1});else{let e={};try{e=JSON.parse(null===(n=await k.Store.get(v.NC_APP_SETTINGS))||void 0===n?void 0:n.value)}catch(e){}(null==e?void 0:e.invite_only_signup)?x.NcError.badRequest("Not allowed to signup, contact super admin."):s=f.OrgUserRoles.VIEWER}const r=(0,C.randomTokenString)(),l=await k.User.insert({email:e,salt:t,password:a,email_verification_token:i,roles:s,token_version:r});return o&&"true"!==process.env.NC_CLOUD&&(l.createdProject=await this.createDefaultProject(l)),l}async passwordChange(e){var t;(0,O.validatePayload)("swagger.json#/components/schemas/PasswordChangeReq",e.body);const{currentPassword:a,newPassword:i}=e.body;if(!a||!i)return x.NcError.badRequest("Missing new/old password");const{valid:n,error:s}=(0,f.validatePassword)(i);n||x.NcError.badRequest(`Password : ${s}`);const o=await k.User.getByEmail(e.user.email);if(await(0,p.promisify)(y.default.hash)(a,o.salt)!==o.password)return x.NcError.badRequest("Current password is wrong");const r=await(0,p.promisify)(y.default.genSalt)(10),l=await(0,p.promisify)(y.default.hash)(i,r);return await k.User.update(o.id,{salt:r,password:l,email:o.email,token_version:(0,C.randomTokenString)()}),this.appHooksService.emit(f.AppEvents.USER_PASSWORD_CHANGE,{user:o,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp}),!0}async passwordForgot(e){var t;(0,O.validatePayload)("swagger.json#/components/schemas/PasswordForgotReq",e.body);const i=e.body.email;i||x.NcError.badRequest("Please enter your email address.");const n=i.toLowerCase(),s=await k.User.getByEmail(n);if(!s)return x.NcError.badRequest("Your email has not been registered.");{const i=(0,h.v4)();await k.User.update(s.id,{email:s.email,reset_password_token:i,reset_password_expires:new Date(Date.now()+36e5),token_version:(0,C.randomTokenString)()});try{const t=(await Promise.resolve().then((()=>c(a(28429))))).default;await j.default.emailAdapter().then((a=>a.mailSend({to:s.email,subject:"Password Reset Link",text:`Visit following link to update your password : ${e.siteUrl}/auth/password/reset/${i}.`,html:b.render(t,{resetLink:e.siteUrl+`/auth/password/reset/${i}`})})))}catch(e){return console.log(e),x.NcError.badRequest("Email Plugin is not found. Please contact administrators to configure it in App Store first.")}this.appHooksService.emit(f.AppEvents.USER_PASSWORD_FORGOT,{user:s,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp})}return!0}async tokenValidate(e){const t=e.token,a=await I.default.ncMeta.metaGet(null,null,S.MetaTable.USERS,{reset_password_token:t});return a&&a.email||x.NcError.badRequest("Invalid reset url"),new Date(a.reset_password_expires)<new Date&&x.NcError.badRequest("Password reset url expired"),!0}async passwordReset(e){var t;(0,O.validatePayload)("swagger.json#/components/schemas/PasswordResetReq",e.body);const{token:a,body:i}=e,n=await I.default.ncMeta.metaGet(null,null,S.MetaTable.USERS,{reset_password_token:a});n||x.NcError.badRequest("Invalid reset url"),n.reset_password_expires<new Date&&x.NcError.badRequest("Password reset url expired"),n.provider&&"local"!==n.provider&&x.NcError.badRequest("Email registered via social account");const{valid:s,error:o}=(0,f.validatePassword)(i.password);s||x.NcError.badRequest(`Password : ${o}`);const r=await(0,p.promisify)(y.default.genSalt)(10),l=await(0,p.promisify)(y.default.hash)(i.password,r);return await k.User.update(n.id,{salt:r,password:l,email:n.email,reset_password_expires:null,reset_password_token:"",token_version:(0,C.randomTokenString)()}),this.appHooksService.emit(f.AppEvents.USER_PASSWORD_RESET,{user:n,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp}),!0}async emailVerification(e){const{token:t,req:a}=e,i=await I.default.ncMeta.metaGet(null,null,S.MetaTable.USERS,{email_verification_token:t});return i||x.NcError.badRequest("Invalid verification url"),await k.User.update(i.id,{email:i.email,email_verification_token:"",email_verified:!0}),this.appHooksService.emit(f.AppEvents.USER_EMAIL_VERIFICATION,{user:i,ip:null==a?void 0:a.clientIp}),!0}async refreshToken(e){var t,a;try{(null===(a=null===(t=e.req)||void 0===t?void 0:t.cookies)||void 0===a?void 0:a.refresh_token)||x.NcError.badRequest("Missing refresh token");const i=await k.User.getByRefreshToken(e.req.cookies.refresh_token);i||x.NcError.badRequest("Invalid refresh token");const n=(0,C.randomTokenString)();return await k.User.update(i.id,{email:i.email,refresh_token:n}),(0,w.setTokenCookie)(e.res,n),{token:(0,w.genJwt)(i,I.default.getConfig())}}catch(e){x.NcError.badRequest(e.message)}}async signup(e){var t;(0,O.validatePayload)("swagger.json#/components/schemas/SignUpReq",e.body);const{email:i,token:n,ignore_subscribe:s}=e.req.body;let{password:o}=e.req.body;const{valid:r,error:l}=(0,f.validatePassword)(o);r||x.NcError.badRequest(`Password : ${l}`),(0,g.isEmail)(i)||x.NcError.badRequest("Invalid email");const d=i.toLowerCase();this.validateEmailPattern(d);let u=await k.User.getByEmail(d);u&&n&&(n!==u.invite_token?x.NcError.badRequest("Invalid invite url"):u.invite_token_expires<new Date&&x.NcError.badRequest("Expired invite url, Please contact super admin to get a new invite url"));const m=await(0,p.promisify)(y.default.genSalt)(10);o=await(0,p.promisify)(y.default.hash)(o,m);const v=(0,h.v4)();let T;if(s||_.T.emit("evt_subscribe",d),u)n?await k.User.update(u.id,{salt:m,password:o,email_verification_token:v,invite_token:null,invite_token_expires:null,email:u.email}):x.NcError.badRequest("User already exist");else{const{createdProject:e}=await this.registerNewUserIfAllowed({email:d,salt:m,password:o,email_verification_token:v});T=e}u=await k.User.getByEmail(d);try{const t=(await Promise.resolve().then((()=>c(a(49185))))).default;await(await j.default.emailAdapter()).mailSend({to:d,subject:"Verify email",html:b.render(t,{verifyLink:e.req.ncSiteUrl+`/email/verify/${u.email_verification_token}`})})}catch(e){console.log("Warning : `mailSend` failed, Please configure emailClient configuration.")}const E=(0,C.randomTokenString)();return await k.User.update(u.id,{refresh_token:E,email:u.email}),(0,w.setTokenCookie)(e.res,E),this.appHooksService.emit(f.AppEvents.USER_SIGNUP,{user:u,ip:null===(t=e.req)||void 0===t?void 0:t.clientIp}),this.appHooksService.emit(f.AppEvents.WELCOME,{user:u}),Object.assign(Object.assign({},await this.login(u)),{createdProject:T})}async login(e){return this.appHooksService.emit(f.AppEvents.USER_SIGNIN,{user:e}),{token:(0,w.genJwt)(e,I.default.getConfig())}}async signOut(e){try{this.clearCookie(e);const t=e.req.user;return(null==t?void 0:t.id)&&await k.User.update(t.id,{refresh_token:null,token_version:(0,C.randomTokenString)()}),{msg:"Signed out successfully"}}catch(e){x.NcError.badRequest(e.message)}}clearCookie(e){e.res.clearCookie("refresh_token")}async createDefaultProject(e){return await this.projectsService.createDefaultProject({user:e})}};A=l([(0,m.Injectable)(),d("design:paramtypes",["function"==typeof(i=void 0!==E.MetaService&&E.MetaService)?i:Object,"function"==typeof(n=void 0!==T.AppHooksService&&T.AppHooksService)?n:Object,"function"==typeof(s=void 0!==R.ProjectsService&&R.ProjectsService)?s:Object])],A),t.UsersService=A},49313:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UtilsService=void 0;const r=a(26481),l=o(a(52167)),c=a(57795),d=a(68281),u=a(35793),p=a(94647),m=o(a(65813)),f=a(51401),h=a(15147),g=o(a(27552)),_=o(a(19356)),b=a(13609),y=a(93006),w=a(67478),v={releaseVersion:null,lastFetched:null},T={dateStrings:!0};let O=class{constructor(e){this.configService=e,this.extractResultOrNull=e=>e.map((e=>"fulfilled"===e.status?e.value:(console.log(e.reason),null)))}async versionInfo(){if(!v.lastFetched||v.lastFetched&&v.lastFetched<Date.now()-36e5){const e=await l.default.get("https://api.github.com/repos/nocodb/nocodb/tags",{timeout:5e3}).then((e=>e.data.map((e=>e.name)).filter((e=>(0,c.validate)(e)&&!e.includes("finn")&&!e.includes("beta"))).sort(((e,t)=>(0,c.compareVersions)(t,e))))).catch((()=>null));e&&e.length>0&&(v.releaseVersion=e[0]),v.lastFetched=Date.now()}return{currentVersion:w.packageVersion,releaseVersion:v.releaseVersion}}async appHealth(){return{message:"OK",timestamp:Date.now(),uptime:process.uptime()}}async _axiosRequestMake(e){const{apiMeta:t}=e.body;if(null==t?void 0:t.body)try{t.body=JSON.parse(t.body)}catch(e){console.log(e)}if(null==t?void 0:t.auth)try{t.auth=JSON.parse(t.auth)}catch(e){console.log(e)}t.response={};const a={params:t.parameters?t.parameters.reduce(((e,t)=>(t.name&&t.enabled&&(e[t.name]=t.value),e)),{}):{},url:t.url,method:t.method||"GET",data:t.body||{},headers:t.headers?t.headers.reduce(((e,t)=>(t.name&&t.enabled&&(e[t.name]=t.value),e)),{}):{},responseType:t.responseType||"json",withCredentials:!0},i=await(0,l.default)(a);return null==i?void 0:i.data}async axiosRequestMake(e){const{apiMeta:{url:t}}=e.body,a=/.*\.(xls|xlsx|xlsm|ods|ots)/,i=/.*\.(csv)/;return/(10)(\.([2]([0-5][0-5]|[01234][6-9])|[1][0-9][0-9]|[1-9][0-9]|[0-9])){3}|(172)\.(1[6-9]|2[0-9]|3[0-1])(\.(2[0-4][0-9]|25[0-5]|[1][0-9][0-9]|[1-9][0-9]|[0-9])){2}|(192)\.(168)(\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){2}|(0.0.0.0)|localhost?/g.test(t)||!i.test(t)&&!a.test(t)?{}:((i||a)&&(e.body.apiMeta.responseType="arraybuffer"),await this._axiosRequestMake({body:e.body}))}async urlToDbConfig(e){const{url:t}=e.body;try{return(0,y.jdbcToXcConfig)(t)}catch(e){return f.NcError.internalServerError("Please check server log for more details")}}async aggregatedMetaInfo(){const[e,t]=await Promise.all([h.Project.list({}),g.default.ncMeta.metaCount(null,null,b.MetaTable.USERS)]),a={projectCount:e.length,projects:[],userCount:t,sharedBaseCount:0};return a.projects.push(...this.extractResultOrNull(await Promise.allSettled(e.map((async e=>{e.uuid&&a.sharedBaseCount++;const[t,i,n,s,o,r,l,c]=this.extractResultOrNull(await Promise.allSettled([g.default.ncMeta.metaCount(e.id,null,b.MetaTable.MODELS,{condition:{type:"table"}}),g.default.ncMeta.metaCount(e.id,null,b.MetaTable.MODELS,{condition:{type:"view"}}),(async()=>(await g.default.ncMeta.metaList2(e.id,null,b.MetaTable.VIEWS)).reduce(((e,t)=>{switch(e.total++,t.type){case d.ViewTypes.GRID:e.gridCount++,t.uuid&&e.sharedGridCount++;break;case d.ViewTypes.FORM:e.formCount++,t.uuid&&e.sharedFormCount++;break;case d.ViewTypes.GALLERY:e.galleryCount++,t.uuid&&e.sharedGalleryCount++;break;case d.ViewTypes.KANBAN:e.kanbanCount++,t.uuid&&e.sharedKanbanCount++}return t.uuid&&(t.password&&e.sharedLockedCount++,e.sharedTotal++),e}),{formCount:0,gridCount:0,galleryCount:0,kanbanCount:0,total:0,sharedFormCount:0,sharedGridCount:0,sharedGalleryCount:0,sharedKanbanCount:0,sharedTotal:0,sharedLockedCount:0}))(),g.default.ncMeta.metaCount(e.id,null,b.MetaTable.HOOKS),g.default.ncMeta.metaCount(e.id,null,b.MetaTable.FILTER_EXP),g.default.ncMeta.metaCount(e.id,null,b.MetaTable.SORT),e.getBases().then((async e=>this.extractResultOrNull(await Promise.allSettled(e.map((async e=>{var t,a,i;return null===(i=null===(a=(t=await _.default.getSqlClient(e)).totalRecords)||void 0===a?void 0:a.call(t))||void 0===i?void 0:i.then((e=>null==e?void 0:e.data))})))))),g.default.ncMeta.metaCount(null,null,b.MetaTable.PROJECT_USERS,{condition:{project_id:e.id},aggField:"*"})]));return{tableCount:{table:t,view:i},external:!e.is_meta,viewCount:n,webhookCount:s,filterCount:o,sortCount:r,rowCount:l,userCount:c}}))))),a}async testConnection(e){return await m.default.testConnection(e.body)}async appInfo(e){var t;const a=!await h.User.isFirst(),i=!!(process.env.NC_OIDC_ISSUER&&process.env.NC_OIDC_AUTHORIZATION_URL&&process.env.NC_OIDC_TOKEN_URL&&process.env.NC_OIDC_USERINFO_URL&&process.env.NC_OIDC_CLIENT_ID&&process.env.NC_OIDC_CLIENT_SECRET),n=i?null!==(t=process.env.NC_OIDC_PROVIDER_NAME)&&void 0!==t?t:"OpenID Connect":null;return{authType:"jwt",projectHasAdmin:a,firstUser:!a,type:"rest",env:process.env.NODE_ENV,googleAuthEnabled:!(!process.env.NC_GOOGLE_CLIENT_ID||!process.env.NC_GOOGLE_CLIENT_SECRET),githubAuthEnabled:!(!process.env.NC_GITHUB_CLIENT_ID||!process.env.NC_GITHUB_CLIENT_SECRET),oidcAuthEnabled:i,oidcProviderName:n,oneClick:!!process.env.NC_ONE_CLICK,connectToExternalDB:!process.env.NC_CONNECT_TO_EXTERNAL_DB_DISABLED,version:w.packageVersion,defaultLimit:Math.max(Math.min(+process.env.DB_QUERY_LIMIT_DEFAULT||25,+process.env.DB_QUERY_LIMIT_MAX||100),+process.env.DB_QUERY_LIMIT_MIN||1),timezone:T.timezone,ncMin:!!process.env.NC_MIN,teleEnabled:"true"!==process.env.NC_DISABLE_TELE,auditEnabled:"true"!==process.env.NC_DISABLE_AUDIT,ncSiteUrl:e.req.ncSiteUrl,ee:g.default.isEE(),ncAttachmentFieldSize:p.NC_ATTACHMENT_FIELD_SIZE,ncMaxAttachmentsAllowed:+(process.env.NC_MAX_ATTACHMENTS_ALLOWED||10),isCloud:"true"===process.env.NC_CLOUD,automationLogLevel:process.env.NC_AUTOMATION_LOG_LEVEL||"OFF",baseHostName:process.env.NC_BASE_HOST_NAME,disableEmailAuth:this.configService.get("auth.disableEmailAuth",{infer:!0}),mainSubDomain:this.configService.get("mainSubDomain",{infer:!0}),dashboardPath:this.configService.get("dashboardPath",{infer:!0})}}};O=n([(0,r.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==u.ConfigService&&u.ConfigService)?i:Object])],O),t.UtilsService=O},58110:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewColumnsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(15147);let u=class{constructor(e){this.appHooksService=e}async columnList(e){return await d.View.getColumns(e.viewId,void 0)}async columnAdd(e){(0,c.validatePayload)("swagger.json#/components/schemas/ViewColumnReq",e.column);const t=await d.View.insertOrUpdateColumn(e.viewId,e.column.fk_column_id,{order:e.column.order,show:e.column.show});return this.appHooksService.emit(r.AppEvents.VIEW_COLUMN_CREATE,{viewColumn:t}),t}async columnUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/ViewColumnUpdateReq",e.column);const t=await d.View.updateColumn(e.viewId,e.columnId,e.column);return this.appHooksService.emit(r.AppEvents.VIEW_COLUMN_UPDATE,{viewColumn:e.column}),t}};u=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],u),t.ViewColumnsService=u},430:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ViewsService=void 0;const o=a(26481),r=a(68281),l=a(33206),c=a(78829),d=a(51401),u=a(15147);let p=class{constructor(e){this.appHooksService=e}async viewList(e){const t=await u.Model.get(e.tableId),a=await async function(e){const{includeM2M:t=!0,projectId:a,models:i}=null!=e?e:{},n=["owner","creator","viewer","editor","commenter","guest"].reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:!1})),{});let s=i||await u.Model.list({project_id:a,base_id:void 0});s=t?s:s.filter((e=>!e.mm));const o=await s.reduce((async(e,t)=>{const a=await e,i=await t.getViews();for(const e of i)a[e.id]=Object.assign(Object.assign({ptn:t.table_name,_ptn:t.title,ptype:t.type,tn:e.title,_tn:e.title,table_meta:t.meta},e),{disabled:Object.assign({},n)});return a}),Promise.resolve({})),r=await u.ModelRoleVisibility.list(a);for(const e of r)o[e.fk_view_id]&&(o[e.fk_view_id].disabled[e.role]=!!e.disabled);return Object.values(o)}({projectId:t.project_id,models:[t]}),i=a.filter((t=>Object.values(r.ProjectRoles).some((a=>{var i,n;return(null===(n=null===(i=null==e?void 0:e.user)||void 0===i?void 0:i.project_roles)||void 0===n?void 0:n[a])&&!t.disabled[a]}))));return i}async shareView(e){const t=await u.View.share(e.viewId),a=await u.View.get(e.viewId);return a||d.NcError.badRequest("View not found"),this.appHooksService.emit(r.AppEvents.SHARED_VIEW_CREATE,{user:e.user,view:a}),t}async viewUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/ViewUpdateReq",e.view);const t=await u.View.get(e.viewId);t||d.NcError.badRequest("View not found");const a=await u.View.update(e.viewId,e.view);return this.appHooksService.emit(r.AppEvents.VIEW_UPDATE,{view:Object.assign(Object.assign({},t),e.view),user:e.user}),a}async viewDelete(e){const t=await u.View.get(e.viewId);return t||d.NcError.badRequest("View not found"),await u.View.delete(e.viewId),this.appHooksService.emit(r.AppEvents.VIEW_DELETE,{view:t,user:e.user}),!0}async shareViewUpdate(e){(0,c.validatePayload)("swagger.json#/components/schemas/SharedViewReq",e.sharedView);const t=await u.View.get(e.viewId);t||d.NcError.badRequest("View not found");const a=await u.View.update(e.viewId,e.sharedView);return this.appHooksService.emit(r.AppEvents.SHARED_VIEW_UPDATE,{user:e.user,view:t}),a}async shareViewDelete(e){const t=await u.View.get(e.viewId);return t||d.NcError.badRequest("View not found"),await u.View.sharedViewDelete(e.viewId),this.appHooksService.emit(r.AppEvents.SHARED_VIEW_DELETE,{user:e.user,view:t}),!0}async showAllColumns(e){return await u.View.showAllColumns(e.viewId,e.ignoreIds||[]),!0}async hideAllColumns(e){return await u.View.hideAllColumns(e.viewId,e.ignoreIds||[]),!0}async shareViewList(e){return await u.View.shareViewList(e.tableId)}};p=n([(0,o.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==l.AppHooksService&&l.AppHooksService)?i:Object])],p),t.ViewsService=p},286:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenStrategy=void 0;const n=a(26481),s=a(24340),o=a(68281),r=a(72004),l=a(15147),c=a(95506);let d=class extends((0,s.PassportStrategy)(r.Strategy,"authtoken")){async validate(e,t){try{let a;if(e.headers["xc-token"]){const i=await l.ApiToken.getByToken(e.headers["xc-token"]);if(!i)return t({msg:"Invalid token"});if(a={is_api_token:!0},!i.fk_user_id)return a.project_roles=(0,o.extractRolesObj)(o.ProjectRoles.EDITOR),t(null,a);const n=await l.User.get(i.fk_user_id);if(!n)return t({msg:"User not found"});if(Object.assign(a,{id:n.id,roles:(0,o.extractRolesObj)(n.roles)}),e.ncProjectId){const i=await l.ProjectUser.get(e.ncProjectId,n.id);return a.project_roles=(0,o.extractRolesObj)(null==i?void 0:i.roles),a.project_roles.owner&&(a.project_roles.creator=!0),t(null,(0,c.sanitiseUserObj)(a))}}return t(null,(0,c.sanitiseUserObj)(a))}catch(e){return t(e)}}};d=i([(0,n.Injectable)()],d),t.AuthTokenStrategy=d},60375:function(e,t,a){var i=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseViewStrategy=void 0;const n=a(26481),s=a(24340),o=a(72004),r=a(68281),l=a(15147);let c=class extends((0,s.PassportStrategy)(o.Strategy,"base-view")){async validate(e,t){try{let a;if(e.headers["xc-shared-base-id"]){const i=await l.Project.getByUuid(e.headers["xc-shared-base-id"]);if(!i||e.ncProjectId!==i.id)return t(new n.UnauthorizedException);a={roles:(0,r.extractRolesObj)(null==i?void 0:i.roles),project_roles:(0,r.extractRolesObj)(null==i?void 0:i.roles)}}t(null,a)}catch(e){t(e)}}};c=i([(0,n.Injectable)()],c),t.BaseViewStrategy=c},54077:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BasicStrategy=void 0;const o=a(50466),r=a(26481),l=a(24340),c=a(35793);let d=class extends((0,l.PassportStrategy)(o.BasicStrategy)){constructor(e){super({passReqToCallback:!0}),this.configService=e,this.validate=async(e,t,a)=>{const i=this.configService.get("basicAuth",{infer:!0});if(i.username===t&&i.password===a)return!0;throw new r.UnauthorizedException}}};d=n([(0,r.Injectable)(),s("design:paramtypes",["function"==typeof(i=void 0!==c.ConfigService&&c.ConfigService)?i:Object])],d),t.BasicStrategy=d},36234:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(a,i){t(a,i,e)}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleStrategyProvider=t.GoogleStrategy=void 0;const l=a(16464),c=a(26481),d=a(24340),u=a(84743),p=r(a(98432)),m=r(a(27552)),f=a(1119),h=a(15147),g=a(95506);let _=class extends((0,d.PassportStrategy)(u.Strategy,"google")){constructor(e,t){super(e),this.usersService=t}async validate(e,t,a,i,n){const s=i.emails[0].value;try{const t=await h.User.getByEmail(s);if(!t){const e=await(0,l.promisify)(p.default.genSalt)(10),t=await this.usersService.registerNewUserIfAllowed({email_verification_token:null,email:i.emails[0].value,password:"",salt:e});return n(null,(0,g.sanitiseUserObj)(t))}if(!e.ncProjectId)return n(null,(0,g.sanitiseUserObj)(t));h.ProjectUser.get(e.ncProjectId,t.id).then((async e=>{t.roles=(null==e?void 0:e.roles)||t.roles,t.roles="owner"===t.roles?"owner,creator":t.roles,n(null,(0,g.sanitiseUserObj)(t))})).catch((e=>n(e)))}catch(e){return n(e)}}authorizationParams(e){const t=super.authorizationParams(e);return e.state&&(t.state=e.state),t}async authenticate(e,t){var a,i;const n=await h.Plugin.getPluginByTitle("Google");if(n&&n.input){const e=JSON.parse(n.input);process.env.NC_GOOGLE_CLIENT_ID=e.client_id,process.env.NC_GOOGLE_CLIENT_SECRET=e.client_secret}return process.env.NC_GOOGLE_CLIENT_ID&&process.env.NC_GOOGLE_CLIENT_SECRET?super.authenticate(e,Object.assign(Object.assign({},t),{clientID:null!==(a=process.env.NC_GOOGLE_CLIENT_ID)&&void 0!==a?a:"",clientSecret:null!==(i=process.env.NC_GOOGLE_CLIENT_SECRET)&&void 0!==i?i:"",callbackURL:e.ncSiteUrl+m.default.getConfig().dashboardPath,passReqToCallback:!0,scope:["profile","email"],state:e.query.state})):this.error({message:"Google client id or secret not found. Please add it in plugin settings or define env variables."})}};_=n([(0,c.Injectable)(),o(0,(0,c.Optional)()),s("design:paramtypes",[Object,"function"==typeof(i=void 0!==f.UsersService&&f.UsersService)?i:Object])],_),t.GoogleStrategy=_,t.GoogleStrategyProvider={provide:_,inject:[f.UsersService],useFactory:async e=>{var t,a;const i={clientID:null!==(t=process.env.NC_GOOGLE_CLIENT_ID)&&void 0!==t?t:"dummy-id",clientSecret:null!==(a=process.env.NC_GOOGLE_CLIENT_SECRET)&&void 0!==a?a:"dummy-secret",callbackURL:"http://localhost:8080/dahsboard",passReqToCallback:!0,scope:["profile","email"]};return new _(i,e)}}},82469:function(e,t,a){var i,n=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.JwtStrategy=void 0;const o=a(26481),r=a(24340),l=a(60136),c=a(15147),d=a(1119);let u=class extends((0,r.PassportStrategy)(l.Strategy)){constructor(e,t){super(Object.assign({expiresIn:"10h"},e)),this.userService=t}async validate(e,t){if(!(null==t?void 0:t.email))return t;const a=await c.User.getByEmail(null==t?void 0:t.email);if(!a.token_version||!t.token_version||a.token_version!==t.token_version)throw new Error("Token Expired. Please login again.");return c.User.getWithRoles(a.id,{user:a,projectId:e.ncProjectId})}};u=n([(0,o.Injectable)(),s("design:paramtypes",[Object,"function"==typeof(i=void 0!==d.UsersService&&d.UsersService)?i:Object])],u),t.JwtStrategy=u},85059:function(e,t,a){var i,n,s=this&&this.__decorate||function(e,t,a,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,a):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,a,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(o=(s<3?n(o):s>3?n(t,a,o):n(t,a))||o);return s>3&&o&&Object.defineProperty(t,a,o),o},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStrategy=void 0;const r=a(57055),l=a(24340),c=a(26481),d=a(35793),u=a(68281),p=a(12874),m=a(51401);let f=class extends((0,l.PassportStrategy)(r.Strategy)){constructor(e,t){super({usernameField:"email",passwordField:"password"}),this.authService=e,this.config=t}async validate(e,t){this.config.get("auth.disableEmailAuth",{infer:!0})&&m.NcError.forbidden("Not available");const a=await this.authService.validateUser(e,t);return a||m.NcError.badRequest("Invalid credentials"),a.roles=(0,u.extractRolesObj)(a.roles),a}};f=s([(0,c.Injectable)(),o("design:paramtypes",["function"==typeof(i=void 0!==p.AuthService&&p.AuthService)?i:Object,"function"==typeof(n=void 0!==d.ConfigService&&d.ConfigService)?n:Object])],f),t.LocalStrategy=f},74721:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(96974));t.default=class{static async executeOperations(e,t){if("oracledb"===t||"mssql"===t)for(const t of e)await t();else await Promise.all(e.map((async e=>{await e()})))}static enableOrDisableDebugLog(e){const t=n.default.disable().split(",").filter((e=>e.trim()));for(const[a,i]of Object.entries(e))if(i)t.includes(a)||t.push(a);else{const e=t.indexOf(a);e>-1&&t.splice(e,1)}n.default.enable(t.join(","))}}},65377:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(68281),n={org:[i.OrgUserRoles.VIEWER,i.OrgUserRoles.CREATOR],project:[i.ProjectRoles.VIEWER,i.ProjectRoles.COMMENTER,i.ProjectRoles.EDITOR,i.ProjectRoles.CREATOR,i.ProjectRoles.OWNER]},s={org:["apiTokenList","apiTokenCreate","apiTokenDelete","projectList","projectCreate","passwordChange","isPluginActive","pluginList","pluginTest","pluginRead","pluginUpdate","commandPalette","testConnection","genericGPT","cacheGet","cacheDelete","upload","uploadViaURL"],project:["formViewGet","projectGet","tableGet","dataList","dataRead","dataExist","dataFindOne","dataGroupBy","exportCsv","exportExcel","sortList","filterList","projectInfoGet","projectUserMetaUpdate","galleryViewGet","kanbanViewGet","gridViewUpdate","groupedDataList","mmList","hmList","commentRow","projectCost","tableList","viewList","functionList","sequenceList","procedureList","columnList","triggerList","relationList","relationListAll","indexList","list","dataCount","swaggerJson","commentList","commentsCount","hideAllColumns","showAllColumns","auditRowUpdate","dataUpdate","dataDelete","dataInsert","viewColumnUpdate","sortCreate","sortUpdate","sortDelete","filterCreate","filterUpdate","filterDelete","filterGet","filterChildrenRead","mmExcludedList","hmExcludedList","btExcludedList","gridColumnUpdate","bulkDataInsert","bulkDataUpdate","bulkDataUpdateAll","bulkDataDelete","bulkDataDeleteAll","relationDataRemove","relationDataAdd","projectApiTokenList","projectApiTokenCreate","projectApiTokenDelete"]},o={guest:{},[i.OrgUserRoles.SUPER_ADMIN]:"*",[i.ProjectRoles.VIEWER]:{include:{formViewGet:!0,projectGet:!0,tableGet:!0,dataList:!0,dataRead:!0,dataExist:!0,dataFindOne:!0,dataGroupBy:!0,exportCsv:!0,exportExcel:!0,sortList:!0,filterList:!0,projectInfoGet:!0,projectUserMetaUpdate:!0,galleryViewGet:!0,kanbanViewGet:!0,groupedDataList:!0,mmList:!0,hmList:!0,projectCost:!0,tableList:!0,viewList:!0,functionList:!0,sequenceList:!0,procedureList:!0,columnList:!0,triggerList:!0,relationList:!0,relationListAll:!0,indexList:!0,list:!0,dataCount:!0,swaggerJson:!0}},[i.ProjectRoles.COMMENTER]:{include:{commentList:!0,commentsCount:!0,commentRow:!0}},[i.ProjectRoles.EDITOR]:{include:{hideAllColumns:!0,showAllColumns:!0,auditRowUpdate:!0,dataUpdate:!0,dataDelete:!0,dataInsert:!0,viewColumnUpdate:!0,gridViewUpdate:!0,sortCreate:!0,sortUpdate:!0,sortDelete:!0,filterCreate:!0,filterUpdate:!0,filterDelete:!0,filterGet:!0,filterChildrenRead:!0,mmExcludedList:!0,hmExcludedList:!0,btExcludedList:!0,gridColumnUpdate:!0,bulkDataInsert:!0,bulkDataUpdate:!0,bulkDataUpdateAll:!0,bulkDataDelete:!0,bulkDataDeleteAll:!0,relationDataRemove:!0,relationDataAdd:!0}},[i.ProjectRoles.CREATOR]:{exclude:{projectDelete:!0}},[i.ProjectRoles.OWNER]:{exclude:{pluginList:!0,pluginTest:!0,pluginRead:!0,pluginUpdate:!0,isPluginActive:!0,createBase:!0}},[i.OrgUserRoles.VIEWER]:{include:{apiTokenList:!0,apiTokenCreate:!0,apiTokenDelete:!0,passwordChange:!0,projectList:!0,testConnection:!0}},[i.OrgUserRoles.CREATOR]:{include:{upload:!0,uploadViaURL:!0,isPluginActive:!0,projectCreate:!0}}};{const e={},t=[];Object.keys(s).forEach((a=>{if(s[a].forEach((a=>{e[a]?t.push(a):e[a]=!0})),t.length)throw new Error(`Duplicate permissions found in scope ${a}. Please remove duplicate permissions: ${t.join(", ")}`)}))}Object.values(n).forEach((e=>{const t={},a=[];if(e.forEach((e=>{const i=o[e].include||o[e].exclude||{};Object.keys(i).forEach((e=>{t[e]&&a.push(e),t[e]=!0}))})),a.length)throw new Error(`Duplicate permissions found in roles ${e.join(", ")}. Please remove duplicate permissions: ${a.join(", ")}`)})),Object.entries(o).forEach((([e,t])=>{if("*"===t)return;if("guest"===e)return;let a=null;if(Object.entries(n).forEach((([t,i])=>{i.includes(e)&&(a=t)})),!a)throw new Error(`Role ${e} does not belong to any scope, please assign it to a scope`);const i=s[a];if(!i)throw new Error(`Scope ${a} does not exist, please create it in permissionScopes`);const o=[];if(Object.keys(t.include||{}).forEach((e=>{i.includes(e)||o.push(e)})),o.length)throw new Error(`Role ${e} has permissions that do not belong to its scope ${a}. Please remove or add these permissions: ${o.join(", ")}`)})),Object.values(n).forEach((e=>{let t=0;for(const a of e)0!==t?"*"!==o[a]&&(o[a].include&&Object.assign(o[a].include,o[e[t-1]].include),t++):t++})),Object.values(n).forEach((e=>{const t=[...e].reverse();let a=0;for(const i of t)0!==a?"*"!==o[i]&&(o[i].exclude&&Object.assign(o[i].exclude,o[e[a-1]].exclude),a++):a++})),Object.values(o).forEach((e=>{if("*"!==e&&e.include&&e.exclude)throw new Error(`Role ${e} has both include and exclude permissions. Please remove one of them`)})),t.default=o},29883:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.populatePluginsForCloud=void 0;const n=i(a(93166)),s=i(a(86349)),o=a(13609),r=i(a(27552));t.populatePluginsForCloud=async({ncMeta:e=r.default.ncMeta})=>{if(!(process.env.NC_CLOUD_S3_ACCESS_KEY&&process.env.NC_CLOUD_S3_ACCESS_SECRET&&process.env.NC_CLOUD_S3_BUCKET_NAME&&process.env.NC_CLOUD_S3_REGION))throw new Error("S3 env variables not found");const t=await e.metaGet2(null,null,o.MetaTable.PLUGIN,{title:n.default.title});if(!t)throw new Error("S3 plugin not found");const a=t.input?JSON.parse(t.input):{},i={access_key:process.env.NC_CLOUD_S3_ACCESS_KEY,access_secret:process.env.NC_CLOUD_S3_ACCESS_SECRET,bucket:process.env.NC_CLOUD_S3_BUCKET_NAME,region:process.env.NC_CLOUD_S3_REGION};if(Object.keys(i).some((e=>a[e]!==i[e]))&&await e.metaUpdate(null,null,o.MetaTable.PLUGIN,{input:JSON.stringify(i),active:!0},t.id),!(process.env.NC_CLOUD_SES_ACCESS_KEY&&process.env.NC_CLOUD_SES_ACCESS_SECRET&&process.env.NC_CLOUD_SES_REGION&&process.env.NC_CLOUD_SES_FROM))throw new Error("SES env variables not found");const l=await e.metaGet2(null,null,o.MetaTable.PLUGIN,{title:s.default.title});if(!l)throw new Error("SES plugin not found");const c=l.input?JSON.parse(l.input):{},d={access_key:process.env.NC_CLOUD_SES_ACCESS_KEY,access_secret:process.env.NC_CLOUD_SES_ACCESS_SECRET,region:process.env.NC_CLOUD_SES_REGION,from:process.env.NC_CLOUD_SES_FROM};Object.keys(d).some((e=>c[e]!==d[e]))&&await e.metaUpdate(null,null,o.MetaTable.PLUGIN,{input:JSON.stringify(d),active:!0},l.id)}},9997:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(57147)),s=a(16464),o=a(35043),r=i(a(47668)),l=a(59204);class c{static setXcMeta(e){this.metaKnex=e}static delete({dbAlias:e="db",env:t="_noco",projectId:a}){var i,n,s;if(null===(s=null===(n=null===(i=this.connectionRefs)||void 0===i?void 0:i[a])||void 0===n?void 0:n[t])||void 0===s?void 0:s[e])try{this.connectionRefs[a][t][e].destroy(),delete this.connectionRefs[a][t][e]}catch(e){console.log(e)}}static async get({dbAlias:e="db",env:t="_noco",config:a,projectId:i}){var r,c,d,u,p,m,f,h,g,_;if(null===(d=null===(c=null===(r=this.connectionRefs)||void 0===r?void 0:r[i])||void 0===c?void 0:c[t])||void 0===d?void 0:d[e])return null===(m=null===(p=null===(u=this.connectionRefs)||void 0===u?void 0:u[i])||void 0===p?void 0:p[t])||void 0===m?void 0:m[e];if(this.connectionRefs[i]=this.connectionRefs[i]||{},this.connectionRefs[i][t]=this.connectionRefs[i][t]||{},(null==a?void 0:a.prefix)&&this.metaKnex)this.connectionRefs[i][t][e]=null===(f=this.metaKnex)||void 0===f?void 0:f.knex;else{const r=this.getConnectionConfig(a,t,e);(null===(h=null==r?void 0:r.connection)||void 0===h?void 0:h.ssl)&&"object"==typeof(null===(g=null==r?void 0:r.connection)||void 0===g?void 0:g.ssl)&&(r.connection.ssl.caFilePath&&!r.connection.ssl.ca&&(r.connection.ssl.ca=(await(0,s.promisify)(n.default.readFile)(r.connection.ssl.caFilePath)).toString(),delete r.connection.ssl.caFilePath),r.connection.ssl.keyFilePath&&!r.connection.ssl.key&&(r.connection.ssl.key=(await(0,s.promisify)(n.default.readFile)(r.connection.ssl.keyFilePath)).toString(),delete r.connection.ssl.keyFilePath),r.connection.ssl.certFilePath&&!r.connection.ssl.cert&&(r.connection.ssl.cert=(await(0,s.promisify)(n.default.readFile)(r.connection.ssl.certFilePath)).toString(),delete r.connection.ssl.certFilePath));const c="sqlite3"===(null==r?void 0:r.client);(null===(_=null==r?void 0:r.connection)||void 0===_?void 0:_.port)&&(r.connection.port=+r.connection.port),this.connectionRefs[i][t][e]=(0,l.XKnex)(c?r.connection:Object.assign(Object.assign({},r),{connection:Object.assign(Object.assign(Object.assign({},o.defaultConnectionConfig),r.connection),{typeCast(e,t){const a=t();return a instanceof Buffer?[...a].map((e=>("00"+e.toString(16)).slice(-2))).join(""):a}})})),c&&this.connectionRefs[i][t][e].raw("PRAGMA journal_mode=WAL;").then((()=>{}))}return this.connectionRefs[i][t][e]}static getConnectionConfig(e,t,a){var i,n,s;return null===(s=null===(n=null===(i=null==e?void 0:e.envs)||void 0===i?void 0:i[t])||void 0===n?void 0:n.db)||void 0===s?void 0:s.find((e=>{var t;return(null===(t=null==e?void 0:e.meta)||void 0===t?void 0:t.dbAlias)===a}))}static async getSqlClient({projectId:e,dbAlias:t="db",env:a="_noco",config:i}){const n=this.get({dbAlias:t,env:a,config:i,projectId:e});return r.default.create(Object.assign({knex:n},this.getConnectionConfig(i,a,t)))}}t.default=c,c.connectionRefs={}},19356:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(35043),s=i(a(47668)),o=a(59204),r=i(a(27552));class l{static async destroyAll(){for(const e in this.connectionRefs)for(const t in this.connectionRefs[e])await this.connectionRefs[e][t].destroy()}static delete(e){var t,a,i,n,s;if(null===(a=null===(t=this.connectionRefs)||void 0===t?void 0:t[e.project_id])||void 0===a?void 0:a[e.id])try{(null===(n=null===(i=this.connectionRefs)||void 0===i?void 0:i[e.project_id])||void 0===n?void 0:n[e.id]).destroy(),null===(s=this.connectionRefs)||void 0===s||delete s[e.project_id][e.id]}catch(e){console.log(e)}}static async deleteAwait(e){var t,a,i,n,s;if(null===(a=null===(t=this.connectionRefs)||void 0===t?void 0:t[e.project_id])||void 0===a?void 0:a[e.id])try{const t=null===(n=null===(i=this.connectionRefs)||void 0===i?void 0:i[e.project_id])||void 0===n?void 0:n[e.id];await t.destroy(),null===(s=this.connectionRefs)||void 0===s||delete s[e.project_id][e.id]}catch(e){console.log(e)}}static async get(e){var t,a,i,s,l;if(e.isMeta())return r.default.ncMeta.knex;if(null===(a=null===(t=this.connectionRefs)||void 0===t?void 0:t[e.project_id])||void 0===a?void 0:a[e.id])return null===(s=null===(i=this.connectionRefs)||void 0===i?void 0:i[e.project_id])||void 0===s?void 0:s[e.id];this.connectionRefs[e.project_id]=(null===(l=this.connectionRefs)||void 0===l?void 0:l[e.project_id])||{};const c=await e.getConnectionConfig();return this.connectionRefs[e.project_id][e.id]=(0,o.XKnex)(Object.assign(Object.assign(Object.assign({},n.defaultConnectionOptions),c),{connection:Object.assign(Object.assign(Object.assign({},n.defaultConnectionConfig),c.connection),{typeCast(e,t){const a=t();return a instanceof Buffer?[...a].map((e=>("00"+e.toString(16)).slice(-2))).join(""):a}})})),this.connectionRefs[e.project_id][e.id]}static async getSqlClient(e,t=null){const a=t||await this.get(e);return s.default.create(Object.assign({knex:a},await e.getConnectionConfig()))}}t.default=l,l.connectionRefs={}},2370:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default='<!doctype html>\n<html>\n<head>\n    <meta name="viewport" content="width=device-width">\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">\n    <title>NocoDB forms: someone has responded to Form</title>\n    <style>\n        @media only screen and (max-width: 620px) {\n            table[class=body] h1 {\n                font-size: 28px !important;\n                margin-bottom: 10px !important;\n            }\n\n            table[class=body] p,\n            table[class=body] ul,\n            table[class=body] ol,\n            table[class=body] td,\n            table[class=body] span,\n            table[class=body] a {\n                font-size: 16px !important;\n            }\n\n            table[class=body] .wrapper,\n            table[class=body] .article {\n                padding: 10px !important;\n            }\n\n            table[class=body] .content {\n                padding: 0 !important;\n            }\n\n            table[class=body] .container {\n                padding: 0 !important;\n                width: 100% !important;\n            }\n\n            table[class=body] .main {\n                border-left-width: 0 !important;\n                border-radius: 0 !important;\n                border-right-width: 0 !important;\n            }\n\n            table[class=body] .btn table {\n                width: 100% !important;\n            }\n\n            table[class=body] .btn a {\n                width: 100% !important;\n            }\n\n            table[class=body] .img-responsive {\n                height: auto !important;\n                max-width: 100% !important;\n                width: auto !important;\n            }\n        }\n\n        @media all {\n            .ExternalClass {\n                width: 100%;\n            }\n\n            .ExternalClass,\n            .ExternalClass p,\n            .ExternalClass span,\n            .ExternalClass font,\n            .ExternalClass td,\n            .ExternalClass div {\n                line-height: 100%;\n            }\n\n            .apple-link a {\n                color: inherit !important;\n                font-family: inherit !important;\n                font-size: inherit !important;\n                font-weight: inherit !important;\n                line-height: inherit !important;\n                text-decoration: none !important;\n            }\n\n            #MessageViewBody a {\n                color: inherit;\n                text-decoration: none;\n                font-size: inherit;\n                font-family: inherit;\n                font-weight: inherit;\n                line-height: inherit;\n            }\n\n            .btn-primary table td:hover {\n                background-color: #34495e !important;\n            }\n\n            .btn-primary a:hover {\n                background-color: #34495e !important;\n                border-color: #34495e !important;\n            }\n        }\n    </style>\n</head>\n<body class=""\n      style="background-color: #f6f6f6; font-family: sans-serif; -webkit-font-smoothing: antialiased; font-size: 14px; line-height: 1.4; margin: 0; padding: 0; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%;">\n<span class="preheader"\n      style="color: transparent; display: none; height: 0; max-height: 0; max-width: 0; opacity: 0; overflow: hidden; mso-hide: all; visibility: hidden; width: 0;">NocoDB forms: someone has responded to Form</span>\n<table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body"\n       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #f6f6f6; width: 100%;"\n       width="100%" bgcolor="#f6f6f6">\n    <tr>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n        <td class="container"\n            style="font-family: sans-serif; font-size: 14px; vertical-align: top; display: block; max-width: 580px; padding: 10px; width: 580px; margin: 0 auto;"\n            width="580" valign="top">\n            <div class="content"\n                 style="box-sizing: border-box; display: block; margin: 0 auto; max-width: 580px; padding: 10px;">\n\n                \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n                <table role="presentation" class="main"\n                       style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; background: #ffffff; border-radius: 3px; width: 100%;"\n                       width="100%">\n\n                    \x3c!-- START MAIN CONTENT AREA --\x3e\n                    <tr>\n                        <td class="wrapper"\n                            style="font-family: sans-serif; font-size: 14px; vertical-align: top; box-sizing: border-box; padding: 20px;"\n                            valign="top">\n                            <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                                   style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                                   width="100%">\n                                   \n                                   <tr>\n                                   <td style="font-family: sans-serif; font-size: 14px;padding: 20px 5px 10px 5px; " colspan="2">\n                                     <a href="https://github.com/nocodb/nocodb" target="_blank">\n                                        <img src="https://www.nocodb.com/brand/x1.png" alt="NocoDB" width="70" style=" vertical-align: middle"> <h2 style="margin-left: 10px;display: inline-block">NocoDB</h2>\n                                     </a>\n                                   </td>\n                                   </tr>\n                                   <tr>\n                                   <td style="font-family: sans-serif; font-size: 14px;line-height: 20px; vertical-align: top;padding: 10px 5px 40px 5px; " colspan="2">\n                                     Someone has responded to Form. A record has been added to the subscriptions table in <span style="font-weight: bold"><%- _tn %></span>.\n                                   </td>\n                                   </tr>\n                                   \n                                <% Object.keys(data).forEach(function(prop) { \n                                if(data[prop] !== null && data[prop] !== undefined && data[prop] !== \'\'){\n                                %>\n                                  <tr>\n                                      <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;padding: 20px 5px 20px 5px;text-transform: capitalize "\n                                          valign="top">\n                                            <%- prop %>\n                                      </td>\n                                      <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;padding: 20px 5px 20px 5px;"\n                                          valign="top">\n                                            <%- data[prop] %>\n                                      </td>\n                                  </tr>\n                                <% }\n                                }); %>\n                            </table>\n                        </td>\n                    </tr>\n\n                    \x3c!-- END MAIN CONTENT AREA --\x3e\n                </table>\n                \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n                \x3c!-- START FOOTER --\x3e\n                <div class="footer" style="clear: both; margin-top: 10px; text-align: center; width: 100%;">\n                    <table role="presentation" border="0" cellpadding="0" cellspacing="0"\n                           style="border-collapse: separate; mso-table-lspace: 0pt; mso-table-rspace: 0pt; width: 100%;"\n                           width="100%">\n                        <tr>\n                            <td class="content-block"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <span class="apple-link"\n                                      style="color: #999999; font-size: 12px; text-align: center;"></span>\n                                \x3c!--                <br> Don\'t like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.--\x3e\n                            </td>\n                        </tr>\n                        <tr>\n                            <td class="content-block powered-by"\n                                style="font-family: sans-serif; vertical-align: top; padding-bottom: 10px; padding-top: 10px; color: #999999; font-size: 12px; text-align: center;"\n                                valign="top" align="center">\n                                <a href="https://github.com/nocodb/nocodb">NocoDB</a>\n                                \x3c!--                Powered by <a href="http://htmlemail.io">HTMLemail</a>.--\x3e\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                \x3c!-- END FOOTER --\x3e\n\n            </div>\n        </td>\n        <td style="font-family: sans-serif; font-size: 14px; vertical-align: top;" valign="top">&nbsp;</td>\n    </tr>\n</table>\n</body>\n</html>\n'},91010:(e,t)=>{function a(e,t,a){let i,n,s=void 0===a?2166136261:a;for(i=0,n=e.length;i<n;i++)s^=e.charCodeAt(i),s+=(s<<1)+(s<<4)+(s<<7)+(s<<8)+(s<<24);return t?("0000000"+(s>>>0).toString(16)).substr(-8):s>>>0}function i(e){const t=a(e,!0);return t+a(t+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.getParamsHash=t.hash64=t.ROOT_ALIAS=t.getAliasGenerator=void 0,t.getAliasGenerator=function(e="__nc_"){let t=0;return()=>`${e}${t++}`},t.ROOT_ALIAS="__nc_root",t.hash64=i;t.getParamsHash=e=>{let t="";for(const[a,i]of Object.entries(e).sort())["limit","offset"].includes(a)||(t+=`${a}:${i}`);return i(t)}},70578:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.convertToTargetFormat=t.parseStringDate=t.getDateTimeFormat=t.getDateFormat=t.validateDateWithUnknownFormat=t.validateDateFormat=t.dateFormats=void 0;const n=i(a(1635));t.dateFormats=["DD-MM-YYYY","MM-DD-YYYY","YYYY-MM-DD","DD/MM/YYYY","MM/DD/YYYY","YYYY/MM/DD","DD MM YYYY","MM DD YYYY","YYYY MM DD"],t.validateDateFormat=function(e){return t.dateFormats.includes(e)},t.validateDateWithUnknownFormat=function(e){for(const a of t.dateFormats){if((0,n.default)(e,a,!0).isValid())return!0;for(const t of["HH:mm","HH:mm:ss","HH:mm:ss.SSS"])if((0,n.default)(e,`${a} ${t}`,!0).isValid())return!0}return!1},t.getDateFormat=function(e){for(const a of t.dateFormats)if((0,n.default)(e,a,!0).isValid())return a;return"YYYY/MM/DD"},t.getDateTimeFormat=function(e){for(const a of t.dateFormats)for(const t of["HH:mm","HH:mm:ss","HH:mm:ss.SSS"]){const i=`${a} ${t}`;if((0,n.default)(e,i,!0).isValid())return i}return"YYYY/MM/DD"},t.parseStringDate=function(e,t){const a=(0,n.default)(e);return e=a.isValid()?a.format("YYYY-MM-DD"):(0,n.default)(e,t).format("YYYY-MM-DD")},t.convertToTargetFormat=function(e,a,i){return t.dateFormats.includes(a)&&t.dateFormats.includes(i)?(0,n.default)(e,a).format(i):e}},16639:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(13609),s=i(a(27552)),o=i(a(37912));t.default=async function(e=!1,t=s.default.ncMeta){var a,i,r;try{let l=await o.default.get(n.CacheScope.INSTANCE_META,n.CacheGetType.TYPE_OBJECT);if(!l||e){const e=await t.knex(n.MetaTable.PROJECT).count("id as count").first().where("deleted",!1).where("is_meta",!0).then((e=>e.count)),c=await t.knex(n.MetaTable.PROJECT).count("id as count").first().where("deleted",!1).where("is_meta",!1).then((e=>e.count)),d=await t.knex(n.MetaTable.USERS).count("id as count").first().then((e=>e.count)),u=await t.knex("nc_store").select("created_at").where("key","nc_server_id").first().then((e=>e.created_at));l={projectsMeta:e,projectsExt:c,impacted:d,nc_db_type:null===(r=null===(i=null===(a=s.default.getConfig())||void 0===a?void 0:a.meta)||void 0===i?void 0:i.db)||void 0===r?void 0:r.client,created:u},await o.default.set(n.CacheScope.INSTANCE_META,l)}return l}catch(e){return{}}}},13609:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.DB_TYPES=t.COMPARISON_SUB_OPS=t.IS_WITHIN_COMPARISON_SUB_OPS=t.COMPARISON_OPS=t.CacheDelDirection=t.CacheGetType=t.CacheScope=t.sakilaTableNames=t.orderedMetaTables=t.MetaTable=void 0,function(e){e.PROJECT="nc_projects_v2",e.BASES="nc_bases_v2",e.MODELS="nc_models_v2",e.COLUMNS="nc_columns_v2",e.COLUMN_VALIDATIONS="nc_columns_validations_v2",e.COL_PROPS="nc_col_props_v2",e.COL_RELATIONS="nc_col_relations_v2",e.COL_SELECT_OPTIONS="nc_col_select_options_v2",e.COL_LOOKUP="nc_col_lookup_v2",e.COL_ROLLUP="nc_col_rollup_v2",e.COL_FORMULA="nc_col_formula_v2",e.COL_QRCODE="nc_col_qrcode_v2",e.COL_BARCODE="nc_col_barcode_v2",e.FILTER_EXP="nc_filter_exp_v2",e.SORT="nc_sort_v2",e.SHARED_VIEWS="nc_shared_views_v2",e.ACL="nc_acl_v2",e.FORM_VIEW="nc_form_view_v2",e.FORM_VIEW_COLUMNS="nc_form_view_columns_v2",e.GALLERY_VIEW="nc_gallery_view_v2",e.GALLERY_VIEW_COLUMNS="nc_gallery_view_columns_v2",e.GRID_VIEW="nc_grid_view_v2",e.GRID_VIEW_COLUMNS="nc_grid_view_columns_v2",e.KANBAN_VIEW="nc_kanban_view_v2",e.KANBAN_VIEW_COLUMNS="nc_kanban_view_columns_v2",e.USERS="nc_users_v2",e.ORGS="nc_orgs_v2",e.TEAMS="nc_teams_v2",e.TEAM_USERS="nc_team_users_v2",e.VIEWS="nc_views_v2",e.AUDIT="nc_audit_v2",e.HOOKS="nc_hooks_v2",e.HOOK_LOGS="nc_hook_logs_v2",e.PLUGIN="nc_plugins_v2",e.PROJECT_USERS="nc_project_users_v2",e.MODEL_ROLE_VISIBILITY="nc_disabled_models_for_role_v2",e.API_TOKENS="nc_api_tokens",e.SYNC_SOURCE="nc_sync_source_v2",e.SYNC_LOGS="nc_sync_logs_v2",e.MAP_VIEW="nc_map_view_v2",e.MAP_VIEW_COLUMNS="nc_map_view_columns_v2",e.STORE="nc_store",e.NOTIFICATION="notification"}(a=t.MetaTable||(t.MetaTable={})),t.orderedMetaTables=[a.MODEL_ROLE_VISIBILITY,a.PLUGIN,a.AUDIT,a.TEAM_USERS,a.TEAMS,a.ORGS,a.PROJECT_USERS,a.USERS,a.MAP_VIEW,a.MAP_VIEW_COLUMNS,a.KANBAN_VIEW_COLUMNS,a.KANBAN_VIEW,a.GRID_VIEW_COLUMNS,a.GRID_VIEW,a.GALLERY_VIEW_COLUMNS,a.GALLERY_VIEW,a.FORM_VIEW_COLUMNS,a.FORM_VIEW,a.SHARED_VIEWS,a.SORT,a.FILTER_EXP,a.HOOK_LOGS,a.HOOKS,a.VIEWS,a.COL_FORMULA,a.COL_ROLLUP,a.COL_LOOKUP,a.COL_SELECT_OPTIONS,a.COL_RELATIONS,a.COLUMN_VALIDATIONS,a.COLUMNS,a.MODELS,a.BASES,a.PROJECT],t.sakilaTableNames=["actor","address","category","city","country","customer","film","film_actor","film_category","film_text","inventory","language","payment","rental","staff","store","actor_info","customer_list","film_list","nicer_but_slower_film_list","sales_by_film_category","sales_by_store","staff_list"],function(e){e.PROJECT="project",e.BASE="base",e.MODEL="model",e.COLUMN="column",e.COL_PROP="colProp",e.COL_RELATION="colRelation",e.COL_SELECT_OPTION="colSelectOption",e.COL_LOOKUP="colLookup",e.COL_ROLLUP="colRollup",e.COL_FORMULA="colFormula",e.COL_QRCODE="colQRCode",e.COL_BARCODE="colBarcode",e.FILTER_EXP="filterExp",e.SORT="sort",e.SHARED_VIEW="sharedView",e.ACL="acl",e.FORM_VIEW="formView",e.FORM_VIEW_COLUMN="formViewColumn",e.GALLERY_VIEW="galleryView",e.GALLERY_VIEW_COLUMN="galleryViewColumn",e.GRID_VIEW="gridView",e.GRID_VIEW_COLUMN="gridViewColumn",e.KANBAN_VIEW="kanbanView",e.MAP_VIEW="mapView",e.MAP_VIEW_COLUMN="mapViewColumn",e.KANBAN_VIEW_COLUMN="kanbanViewColumn",e.USER="user",e.ORGS="orgs",e.TEAM="team",e.TEAM_USER="teamUser",e.VIEW="view",e.AUDIT="audit",e.HOOK="hook",e.PLUGIN="plugin",e.PROJECT_USER="projectUser",e.MODEL_ROLE_VISIBILITY="modelRoleVisibility",e.API_TOKEN="apiToken",e.INSTANCE_META="instanceMeta",e.USER_PROJECT="userProject",e.DASHBOARD_PROJECT_DB_PROJECT_LINKING="dashboardProjectDBProjectLinking",e.SINGLE_QUERY="singleQuery"}(t.CacheScope||(t.CacheScope={})),function(e){e.TYPE_ARRAY="TYPE_ARRAY",e.TYPE_OBJECT="TYPE_OBJECT",e.TYPE_STRING="TYPE_STRING"}(t.CacheGetType||(t.CacheGetType={})),function(e){e.PARENT_TO_CHILD="PARENT_TO_CHILD",e.CHILD_TO_PARENT="CHILD_TO_PARENT"}(t.CacheDelDirection||(t.CacheDelDirection={})),t.COMPARISON_OPS=["eq","neq","not","like","nlike","empty","notempty","null","notnull","checked","notchecked","blank","notblank","allof","anyof","nallof","nanyof","gt","lt","gte","lte","ge","le","in","isnot","is","isWithin","btw","nbtw"],t.IS_WITHIN_COMPARISON_SUB_OPS=["pastWeek","pastMonth","pastYear","nextWeek","nextMonth","nextYear","pastNumberOfDays","nextNumberOfDays"],t.COMPARISON_SUB_OPS=["today","tomorrow","yesterday","oneWeekAgo","oneWeekFromNow","oneMonthAgo","oneMonthFromNow","daysAgo","daysFromNow","exactDate",...t.IS_WITHIN_COMPARISON_SUB_OPS],t.DB_TYPES=["mysql2","sqlite3","mysql","mssql","snowflake","oracledb","pg"]},95506:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),t.isEE=void 0,n(a(91010),t),n(a(63519),t),t.isEE=!1},43902:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mimeIcons=void 0,t.default={123:"application/vnd.lotus-1-2-3",x3d:"application/vnd.hzn-3d-crossword","3gp":"video/3gpp","3g2":"video/3gpp2",mseq:"application/vnd.mseq",pwn:"application/vnd.3m.post-it-notes",plb:"application/vnd.3gpp.pic-bw-large",psb:"application/vnd.3gpp.pic-bw-small",pvb:"application/vnd.3gpp.pic-bw-var",tcap:"application/vnd.3gpp2.tcap","7z":"application/x-7z-compressed",abw:"application/x-abiword",ace:"application/x-ace-compressed",acc:"application/vnd.americandynamics.acc",acu:"application/vnd.acucobol",atc:"application/vnd.acucorp",adp:"audio/adpcm",aab:"application/x-authorware-bin",aam:"application/x-authorware-map",aas:"application/x-authorware-seg",air:"application/vnd.adobe.air-application-installer-package+zip",swf:"application/x-shockwave-flash",fxp:"application/vnd.adobe.fxp",pdf:"application/pdf",ppd:"application/vnd.cups-ppd",dir:"application/x-director",xdp:"application/vnd.adobe.xdp+xml",xfdf:"application/vnd.adobe.xfdf",aac:"audio/x-aac",ahead:"application/vnd.ahead.space",azf:"application/vnd.airzip.filesecure.azf",azs:"application/vnd.airzip.filesecure.azs",azw:"application/vnd.amazon.ebook",ami:"application/vnd.amiga.ami","/A":"application/andrew-inset",apk:"application/vnd.android.package-archive",cii:"application/vnd.anser-web-certificate-issue-initiation",fti:"application/vnd.anser-web-funds-transfer-initiation",atx:"application/vnd.antix.game-component",dmg:"application/x-apple-diskimage",mpkg:"application/vnd.apple.installer+xml",aw:"application/applixware",les:"application/vnd.hhe.lesson-player",swi:"application/vnd.aristanetworks.swi",s:"text/x-asm",atomcat:"application/atomcat+xml",atomsvc:"application/atomsvc+xml","atom, .xml":"application/atom+xml",ac:"application/pkix-attr-cert",aif:"audio/x-aiff",avi:"video/x-msvideo",aep:"application/vnd.audiograph",dxf:"image/vnd.dxf",dwf:"model/vnd.dwf",par:"text/plain-bas",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",torrent:"application/x-bittorrent",cod:"application/vnd.rim.cod",mpm:"application/vnd.blueice.multipass",bmi:"application/vnd.bmi",sh:"application/x-sh",btif:"image/prs.btif",rep:"application/vnd.businessobjects",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",c:"text/x-c",cdxml:"application/vnd.chemdraw+xml",css:"text/css",cdx:"chemical/x-cdx",cml:"chemical/x-cml",csml:"chemical/x-csml",cdbcmsg:"application/vnd.contact.cmsg",cla:"application/vnd.claymore",c4g:"application/vnd.clonk.c4group",sub:"image/vnd.dvb.subtitle",cdmia:"application/cdmi-capability",cdmic:"application/cdmi-container",cdmid:"application/cdmi-domain",cdmio:"application/cdmi-object",cdmiq:"application/cdmi-queue",c11amc:"application/vnd.cluetrust.cartomobile-config",c11amz:"application/vnd.cluetrust.cartomobile-config-pkg",ras:"image/x-cmu-raster",dae:"model/vnd.collada+xml",csv:"text/csv",cpt:"application/mac-compactpro",wmlc:"application/vnd.wap.wmlc",cgm:"image/cgm",ice:"x-conference/x-cooltalk",cmx:"image/x-cmx",xar:"application/vnd.xara",cmc:"application/vnd.cosmocaller",cpio:"application/x-cpio",clkx:"application/vnd.crick.clicker",clkk:"application/vnd.crick.clicker.keyboard",clkp:"application/vnd.crick.clicker.palette",clkt:"application/vnd.crick.clicker.template",clkw:"application/vnd.crick.clicker.wordbank",wbs:"application/vnd.criticaltools.wbs+xml",cryptonote:"application/vnd.rig.cryptonote",cif:"chemical/x-cif",cmdf:"chemical/x-cmdf",cu:"application/cu-seeme",cww:"application/prs.cww",curl:"text/vnd.curl",dcurl:"text/vnd.curl.dcurl",mcurl:"text/vnd.curl.mcurl",scurl:"text/vnd.curl.scurl",car:"application/vnd.curl.car",pcurl:"application/vnd.curl.pcurl",cmp:"application/vnd.yellowriver-custom-menu",dssc:"application/dssc+der",xdssc:"application/dssc+xml",deb:"application/x-debian-package",uva:"audio/vnd.dece.audio",uvi:"image/vnd.dece.graphic",uvh:"video/vnd.dece.hd",uvm:"video/vnd.dece.mobile",uvu:"video/vnd.uvvu.mp4",uvp:"video/vnd.dece.pd",uvs:"video/vnd.dece.sd",uvv:"video/vnd.dece.video",dvi:"application/x-dvi",seed:"application/vnd.fdsn.seed",dtb:"application/x-dtbook+xml",res:"application/x-dtbresource+xml",ait:"application/vnd.dvb.ait",svc:"application/vnd.dvb.service",eol:"audio/vnd.digital-winds",djvu:"image/vnd.djvu",dtd:"application/xml-dtd",mlp:"application/vnd.dolby.mlp",wad:"application/x-doom",dpg:"application/vnd.dpgraph",dra:"audio/vnd.dra",dfac:"application/vnd.dreamfactory",dts:"audio/vnd.dts",dtshd:"audio/vnd.dts.hd",dwg:"image/vnd.dwg",geo:"application/vnd.dynageo",es:"application/ecmascript",mag:"application/vnd.ecowin.chart",mmr:"image/vnd.fujixerox.edmics-mmr",rlc:"image/vnd.fujixerox.edmics-rlc",exi:"application/exi",mgz:"application/vnd.proteus.magazine",epub:"application/epub+zip",eml:"message/rfc822",nml:"application/vnd.enliven",xpr:"application/vnd.is-xpr",xif:"image/vnd.xiff",xfdl:"application/vnd.xfdl",emma:"application/emma+xml",ez2:"application/vnd.ezpix-album",ez3:"application/vnd.ezpix-package",fst:"image/vnd.fst",fvt:"video/vnd.fvt",fbs:"image/vnd.fastbidsheet",fe_launch:"application/vnd.denovo.fcselayout-link",f4v:"video/x-f4v",flv:"video/x-flv",fpx:"image/vnd.fpx",npx:"image/vnd.net-fpx",flx:"text/vnd.fmi.flexstor",fli:"video/x-fli",ftc:"application/vnd.fluxtime.clip",fdf:"application/vnd.fdf",f:"text/x-fortran",mif:"application/vnd.mif",fm:"application/vnd.framemaker",fh:"image/x-freehand",fsc:"application/vnd.fsc.weblaunch",fnc:"application/vnd.frogans.fnc",ltf:"application/vnd.frogans.ltf",ddd:"application/vnd.fujixerox.ddd",xdw:"application/vnd.fujixerox.docuworks",xbd:"application/vnd.fujixerox.docuworks.binder",oas:"application/vnd.fujitsu.oasys",oa2:"application/vnd.fujitsu.oasys2",oa3:"application/vnd.fujitsu.oasys3",fg5:"application/vnd.fujitsu.oasysgp",bh2:"application/vnd.fujitsu.oasysprs",spl:"application/x-futuresplash",fzs:"application/vnd.fuzzysheet",g3:"image/g3fax",gmx:"application/vnd.gmx",gtw:"model/vnd.gtw",txd:"application/vnd.genomatix.tuxedo",ggb:"application/vnd.geogebra.file",ggt:"application/vnd.geogebra.tool",gdl:"model/vnd.gdl",gex:"application/vnd.geometry-explorer",gxt:"application/vnd.geonext",g2w:"application/vnd.geoplan",g3w:"application/vnd.geospace",gsf:"application/x-font-ghostscript",bdf:"application/x-font-bdf",gtar:"application/x-gtar",texinfo:"application/x-texinfo",gnumeric:"application/x-gnumeric",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz",gpx:"application/gpx+xml",gqf:"application/vnd.grafeq",gif:"image/gif",gv:"text/vnd.graphviz",gac:"application/vnd.groove-account",ghf:"application/vnd.groove-help",gim:"application/vnd.groove-identity-message",grv:"application/vnd.groove-injector",gtm:"application/vnd.groove-tool-message",tpl:"application/vnd.groove-tool-template",vcg:"application/vnd.groove-vcard",h261:"video/h261",h263:"video/h263",h264:"video/h264",hpid:"application/vnd.hp-hpid",hps:"application/vnd.hp-hps",hdf:"application/x-hdf",rip:"audio/vnd.rip",hbci:"application/vnd.hbci",jlt:"application/vnd.hp-jlyt",pcl:"application/vnd.hp-pcl",hpgl:"application/vnd.hp-hpgl",hvs:"application/vnd.yamaha.hv-script",hvd:"application/vnd.yamaha.hv-dic",hvp:"application/vnd.yamaha.hv-voice","sfd-hdstx":"application/vnd.hydrostatix.sof-data",stk:"application/hyperstudio",hal:"application/vnd.hal+xml",html:"text/html",irm:"application/vnd.ibm.rights-management",sc:"application/vnd.ibm.secure-container",ics:"text/calendar",icc:"application/vnd.iccprofile",ico:"image/x-icon",igl:"application/vnd.igloader",ief:"image/ief",ivp:"application/vnd.immervision-ivp",ivu:"application/vnd.immervision-ivu",rif:"application/reginfo+xml","3dml":"text/vnd.in3d.3dml",spot:"text/vnd.in3d.spot",igs:"model/iges",i2g:"application/vnd.intergeo",cdy:"application/vnd.cinderella",xpw:"application/vnd.intercon.formnet",fcs:"application/vnd.isac.fcs",ipfix:"application/ipfix",cer:"application/pkix-cert",pki:"application/pkixcmp",crl:"application/pkix-crl",pkipath:"application/pkix-pkipath",igm:"application/vnd.insors.igm",rcprofile:"application/vnd.ipunplugged.rcprofile",irp:"application/vnd.irepository.package+xml",jad:"text/vnd.sun.j2me.app-descriptor",jar:"application/java-archive",class:"application/java-vm",jnlp:"application/x-java-jnlp-file",ser:"application/java-serialized-object",java:"text/x-java-source,java",js:"application/javascript",json:"application/json",joda:"application/vnd.joost.joda-archive",jpm:"video/jpm",jpeg:"image/x-citrix-jpeg",jpg:"image/x-citrix-jpeg",pjpeg:"image/pjpeg",jpgv:"video/jpeg",ktz:"application/vnd.kahootz",mmd:"application/vnd.chipnuts.karaoke-mmd",karbon:"application/vnd.kde.karbon",chrt:"application/vnd.kde.kchart",kfo:"application/vnd.kde.kformula",flw:"application/vnd.kde.kivio",kon:"application/vnd.kde.kontour",kpr:"application/vnd.kde.kpresenter",ksp:"application/vnd.kde.kspread",kwd:"application/vnd.kde.kword",htke:"application/vnd.kenameaapp",kia:"application/vnd.kidspiration",kne:"application/vnd.kinar",sse:"application/vnd.kodak-descriptor",lasxml:"application/vnd.las.las+xml",latex:"application/x-latex",lbd:"application/vnd.llamagraphics.life-balance.desktop",lbe:"application/vnd.llamagraphics.life-balance.exchange+xml",jam:"application/vnd.jam",apr:"application/vnd.lotus-approach",pre:"application/vnd.lotus-freelance",nsf:"application/vnd.lotus-notes",org:"application/vnd.lotus-organizer",scm:"application/vnd.lotus-screencam",lwp:"application/vnd.lotus-wordpro",lvp:"audio/vnd.lucent.voice",m3u:"audio/x-mpegurl",m4v:"video/x-m4v",hqx:"application/mac-binhex40",portpkg:"application/vnd.macports.portpkg",mgp:"application/vnd.osgeo.mapguide.package",mrc:"application/marc",mrcx:"application/marcxml+xml",mxf:"application/mxf",nbp:"application/vnd.wolfram.player",ma:"application/mathematica",mathml:"application/mathml+xml",mbox:"application/mbox",mc1:"application/vnd.medcalcdata",mscml:"application/mediaservercontrol+xml",cdkey:"application/vnd.mediastation.cdkey",mwf:"application/vnd.mfer",mfm:"application/vnd.mfmp",msh:"model/mesh",mads:"application/mads+xml",mets:"application/mets+xml",mods:"application/mods+xml",meta4:"application/metalink4+xml",mcd:"application/vnd.mcd",flo:"application/vnd.micrografx.flo",igx:"application/vnd.micrografx.igx",es3:"application/vnd.eszigno3+xml",mdb:"application/x-msaccess",asf:"video/x-ms-asf",exe:"application/x-msdownload",cil:"application/vnd.ms-artgalry",cab:"application/vnd.ms-cab-compressed",ims:"application/vnd.ms-ims",application:"application/x-ms-application",clp:"application/x-msclip",mdi:"image/vnd.ms-modi",eot:"application/vnd.ms-fontobject",xls:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xltm:"application/vnd.ms-excel.template.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",chm:"application/vnd.ms-htmlhelp",crd:"application/x-mscardfile",lrm:"application/vnd.ms-lrm",mvb:"application/x-msmediaview",mny:"application/x-msmoney",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",obd:"application/x-msbinder",thmx:"application/vnd.ms-officetheme",onetoc:"application/onenote",pya:"audio/vnd.ms-playready.media.pya",pyv:"video/vnd.ms-playready.media.pyv",ppt:"application/vnd.ms-powerpoint",ppam:"application/vnd.ms-powerpoint.addin.macroenabled.12",sldm:"application/vnd.ms-powerpoint.slide.macroenabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroenabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroenabled.12",potm:"application/vnd.ms-powerpoint.template.macroenabled.12",mpp:"application/vnd.ms-project",pub:"application/x-mspublisher",scd:"application/x-msschedule",xap:"application/x-silverlight-app",stl:"application/vnd.ms-pki.stl",cat:"application/vnd.ms-pki.seccat",vsd:"application/vnd.visio",vsdx:"application/vnd.visio2013",wm:"video/x-ms-wm",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",wmx:"video/x-ms-wmx",wmd:"application/x-ms-wmd",wpl:"application/vnd.ms-wpl",wmz:"application/x-ms-wmz",wmv:"video/x-ms-wmv",wvx:"video/x-ms-wvx",wmf:"application/x-msmetafile",trm:"application/x-msterminal",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",dotm:"application/vnd.ms-word.template.macroenabled.12",wri:"application/x-mswrite",wps:"application/vnd.ms-works",xbap:"application/x-ms-xbap",xps:"application/vnd.ms-xpsdocument",mid:"audio/midi",mpy:"application/vnd.ibm.minipay",afp:"application/vnd.ibm.modcap",rms:"application/vnd.jcp.javame.midlet-rms",tmo:"application/vnd.tmobile-livetv",prc:"application/x-mobipocket-ebook",mbk:"application/vnd.mobius.mbk",dis:"application/vnd.mobius.dis",plc:"application/vnd.mobius.plc",mqy:"application/vnd.mobius.mqy",msl:"application/vnd.mobius.msl",txf:"application/vnd.mobius.txf",daf:"application/vnd.mobius.daf",fly:"text/vnd.fly",mpc:"application/vnd.mophun.certificate",mpn:"application/vnd.mophun.application",mj2:"video/mj2",mpga:"audio/mpeg",mxu:"video/vnd.mpegurl",mpeg:"video/mpeg",m21:"application/mp21",mp4a:"audio/mp4",mp4:"application/mp4",m3u8:"application/vnd.apple.mpegurl",mus:"application/vnd.musician",msty:"application/vnd.muvee.style",mxml:"application/xv+xml",ngdat:"application/vnd.nokia.n-gage.data","n-gage":"application/vnd.nokia.n-gage.symbian.install",ncx:"application/x-dtbncx+xml",nc:"application/x-netcdf",nlu:"application/vnd.neurolanguage.nlu",dna:"application/vnd.dna",nnd:"application/vnd.noblenet-directory",nns:"application/vnd.noblenet-sealer",nnw:"application/vnd.noblenet-web",rpst:"application/vnd.nokia.radio-preset",rpss:"application/vnd.nokia.radio-presets",n3:"text/n3",edm:"application/vnd.novadigm.edm",edx:"application/vnd.novadigm.edx",ext:"application/vnd.novadigm.ext",gph:"application/vnd.flographit",ecelp4800:"audio/vnd.nuera.ecelp4800",ecelp7470:"audio/vnd.nuera.ecelp7470",ecelp9600:"audio/vnd.nuera.ecelp9600",oda:"application/oda",ogx:"application/ogg",oga:"audio/ogg",ogv:"video/ogg",dd2:"application/vnd.oma.dd2+xml",oth:"application/vnd.oasis.opendocument.text-web",opf:"application/oebps-package+xml",qbo:"application/vnd.intu.qbo",oxt:"application/vnd.openofficeorg.extension",osf:"application/vnd.yamaha.openscoreformat",weba:"audio/webm",webm:"video/webm",odc:"application/vnd.oasis.opendocument.chart",otc:"application/vnd.oasis.opendocument.chart-template",odb:"application/vnd.oasis.opendocument.database",odf:"application/vnd.oasis.opendocument.formula",odft:"application/vnd.oasis.opendocument.formula-template",odg:"application/vnd.oasis.opendocument.graphics",otg:"application/vnd.oasis.opendocument.graphics-template",odi:"application/vnd.oasis.opendocument.image",oti:"application/vnd.oasis.opendocument.image-template",odp:"application/vnd.oasis.opendocument.presentation",otp:"application/vnd.oasis.opendocument.presentation-template",ods:"application/vnd.oasis.opendocument.spreadsheet",ots:"application/vnd.oasis.opendocument.spreadsheet-template",odt:"application/vnd.oasis.opendocument.text",odm:"application/vnd.oasis.opendocument.text-master",ott:"application/vnd.oasis.opendocument.text-template",ktx:"image/ktx",sxc:"application/vnd.sun.xml.calc",stc:"application/vnd.sun.xml.calc.template",sxd:"application/vnd.sun.xml.draw",std:"application/vnd.sun.xml.draw.template",sxi:"application/vnd.sun.xml.impress",sti:"application/vnd.sun.xml.impress.template",sxm:"application/vnd.sun.xml.math",sxw:"application/vnd.sun.xml.writer",sxg:"application/vnd.sun.xml.writer.global",stw:"application/vnd.sun.xml.writer.template",otf:"application/x-font-otf",osfpvg:"application/vnd.yamaha.openscoreformat.osfpvg+xml",dp:"application/vnd.osgi.dp",pdb:"application/vnd.palm",p:"text/x-pascal",paw:"application/vnd.pawaafile",pclxl:"application/vnd.hp-pclxl",efif:"application/vnd.picsel",pcx:"image/x-pcx",psd:"image/vnd.adobe.photoshop",prf:"application/pics-rules",pic:"image/x-pict",chat:"application/x-chat",p10:"application/pkcs10",p12:"application/x-pkcs12",p7m:"application/pkcs7-mime",p7s:"application/pkcs7-signature",p7r:"application/x-pkcs7-certreqresp",p7b:"application/x-pkcs7-certificates",p8:"application/pkcs8",plf:"application/vnd.pocketlearn",pnm:"image/x-portable-anymap",pbm:"image/x-portable-bitmap",pcf:"application/x-font-pcf",pfr:"application/font-tdpfr",pgn:"application/x-chess-pgn",pgm:"image/x-portable-graymap",png:"image/x-png",ppm:"image/x-portable-pixmap",pskcxml:"application/pskc+xml",pml:"application/vnd.ctc-posml",ai:"application/postscript",pfa:"application/x-font-type1",pbd:"application/vnd.powerbuilder6",pgp:"application/pgp-signature",box:"application/vnd.previewsystems.box",ptid:"application/vnd.pvi.ptid1",pls:"application/pls+xml",str:"application/vnd.pg.format",ei6:"application/vnd.pg.osasli",dsc:"text/prs.lines.tag",psf:"application/x-font-linux-psf",qps:"application/vnd.publishare-delta-tree",wg:"application/vnd.pmi.widget",qxd:"application/vnd.quark.quarkxpress",esf:"application/vnd.epson.esf",msf:"application/vnd.epson.msf",ssf:"application/vnd.epson.ssf",qam:"application/vnd.epson.quickanime",qfx:"application/vnd.intu.qfx",qt:"video/quicktime",rar:"application/x-rar-compressed",ram:"audio/x-pn-realaudio",rmp:"audio/x-pn-realaudio-plugin",rsd:"application/rsd+xml",rm:"application/vnd.rn-realmedia",bed:"application/vnd.realvnc.bed",mxl:"application/vnd.recordare.musicxml",musicxml:"application/vnd.recordare.musicxml+xml",rnc:"application/relax-ng-compact-syntax",rdz:"application/vnd.data-vision.rdz",rdf:"application/rdf+xml",rp9:"application/vnd.cloanto.rp9",jisp:"application/vnd.jisp",rtf:"application/rtf",rtx:"text/richtext",link66:"application/vnd.route66.link66+xml","rss, .xml":"application/rss+xml",shf:"application/shf+xml",st:"application/vnd.sailingtracker.track",svg:"image/svg+xml",sus:"application/vnd.sus-calendar",sru:"application/sru+xml",setpay:"application/set-payment-initiation",setreg:"application/set-registration-initiation",sema:"application/vnd.sema",semd:"application/vnd.semd",semf:"application/vnd.semf",see:"application/vnd.seemail",snf:"application/x-font-snf",spq:"application/scvp-vp-request",spp:"application/scvp-vp-response",scq:"application/scvp-cv-request",scs:"application/scvp-cv-response",sdp:"application/sdp",etx:"text/x-setext",movie:"video/x-sgi-movie",ifm:"application/vnd.shana.informed.formdata",itp:"application/vnd.shana.informed.formtemplate",iif:"application/vnd.shana.informed.interchange",ipk:"application/vnd.shana.informed.package",tfi:"application/thraud+xml",shar:"application/x-shar",rgb:"image/x-rgb",slt:"application/vnd.epson.salt",aso:"application/vnd.accpac.simply.aso",imp:"application/vnd.accpac.simply.imp",twd:"application/vnd.simtech-mindmapper",csp:"application/vnd.commonspace",saf:"application/vnd.yamaha.smaf-audio",mmf:"application/vnd.smaf",spf:"application/vnd.yamaha.smaf-phrase",teacher:"application/vnd.smart.teacher",svd:"application/vnd.svd",rq:"application/sparql-query",srx:"application/sparql-results+xml",gram:"application/srgs",grxml:"application/srgs+xml",ssml:"application/ssml+xml",skp:"application/vnd.koan",sgml:"text/sgml",sdc:"application/vnd.stardivision.calc",sda:"application/vnd.stardivision.draw",sdd:"application/vnd.stardivision.impress",smf:"application/vnd.stardivision.math",sdw:"application/vnd.stardivision.writer",sgl:"application/vnd.stardivision.writer-global",sm:"application/vnd.stepmania.stepchart",sit:"application/x-stuffit",sitx:"application/x-stuffitx",sdkm:"application/vnd.solent.sdkm+xml",xo:"application/vnd.olpc-sugar",au:"audio/basic",wqd:"application/vnd.wqd",sis:"application/vnd.symbian.install",smi:"application/smil+xml",xsm:"application/vnd.syncml+xml",bdm:"application/vnd.syncml.dm+wbxml",xdm:"application/vnd.syncml.dm+xml",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",sbml:"application/sbml+xml",tsv:"text/tab-separated-values",tiff:"image/tiff",tao:"application/vnd.tao.intent-module-archive",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",tfm:"application/x-tex-tfm",tei:"application/tei+xml",txt:"text/plain",dxp:"application/vnd.spotfire.dxp",sfs:"application/vnd.spotfire.sfs",tsd:"application/timestamped-data",tpt:"application/vnd.trid.tpt",mxs:"application/vnd.triscape.mxs",t:"text/troff",tra:"application/vnd.trueapp",ttf:"application/x-font-ttf",ttl:"text/turtle",umj:"application/vnd.umajin",uoml:"application/vnd.uoml+xml",unityweb:"application/vnd.unity",ufd:"application/vnd.ufdl",uri:"text/uri-list",utz:"application/vnd.uiq.theme",ustar:"application/x-ustar",uu:"text/x-uuencode",vcs:"text/x-vcalendar",vcf:"text/x-vcard",vcd:"application/x-cdlink",vsf:"application/vnd.vsf",wrl:"model/vrml",vcx:"application/vnd.vcx",mts:"model/vnd.mts",vtu:"model/vnd.vtu",vis:"application/vnd.visionary",viv:"video/vnd.vivo",ccxml:"application/ccxml+xml,",vxml:"application/voicexml+xml",src:"application/x-wais-source",wbxml:"application/vnd.wap.wbxml",wbmp:"image/vnd.wap.wbmp",wav:"audio/x-wav",davmount:"application/davmount+xml",woff:"application/x-font-woff",wspolicy:"application/wspolicy+xml",webp:"image/webp",wtb:"application/vnd.webturbo",wgt:"application/widget",hlp:"application/winhlp",wml:"text/vnd.wap.wml",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wpd:"application/vnd.wordperfect",stf:"application/vnd.wt.stf",wsdl:"application/wsdl+xml",xbm:"image/x-xbitmap",xpm:"image/x-xpixmap",xwd:"image/x-xwindowdump",der:"application/x-x509-ca-cert",fig:"application/x-xfig",xhtml:"application/xhtml+xml",xml:"application/xml",xdf:"application/xcap-diff+xml",xenc:"application/xenc+xml",xer:"application/patch-ops-error+xml",rl:"application/resource-lists+xml",rs:"application/rls-services+xml",rld:"application/resource-lists-diff+xml",xslt:"application/xslt+xml",xop:"application/xop+xml",xpi:"application/x-xpinstall",xspf:"application/xspf+xml",xul:"application/vnd.mozilla.xul+xml",xyz:"chemical/x-xyz",yaml:"text/yaml",yang:"application/yang",yin:"application/yin+xml",zir:"application/vnd.zul",zip:"application/zip",zmm:"application/vnd.handheld-entertainment+xml",zaz:"application/vnd.zzazz.deck+xml"};t.mimeIcons={pdf:"mdi-pdf-box",docx:"mdi-file-word-outline",dotx:"mdi-file-word-outline",odt:"mdi-file-word-outline",odm:"mdi-file-word-outline",ott:"mdi-file-word-outline",ppt:"mdi-file-powerpoint-box",pptx:"mdi-file-powerpoint-box",sldx:"mdi-file-powerpoint-box",ppsx:"mdi-file-powerpoint-box",potx:"mdi-file-powerpoint-box",xls:"mdi-file-excel-outline",xlam:"mdi-file-excel-outline",xlsb:"mdi-file-excel-outline",xltm:"mdi-file-excel-outline",xlsm:"mdi-file-excel-outline"}},36734:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyMetaProp=t.parseMetaProp=void 0,t.parseMetaProp=function(e,t="meta"){if(e)try{return"string"==typeof e[t]?JSON.parse(e[t]):e[t]}catch(e){return{}}},t.stringifyMetaProp=function(e,t="meta"){if(!e)return null;try{return"string"==typeof e[t]?e[t]:JSON.stringify(e[t])}catch(e){return"{}"}}},20173:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&i(t,e,a);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NcConfig=void 0;const r=s(a(71017)),l=o(a(57147)),c=a(16464),d=a(93006),u=a(83490),p=a(47668);class m{constructor(){this.meta={db:{client:u.DriverClient.SQLITE,connection:{filename:"noco.db"}}}}static async create(e){var t,a,i;const{meta:n,secret:s,port:o,worker:p,tryMode:f,publicUrl:h,dashboardPath:g}=e,_=new m;if(_.auth={jwt:{secret:s}},_.port=+(null!=o?o:8080),_.toolDir=(0,d.getToolDir)(),_.worker=null!=p&&p,_.env="_noco",_.workingEnv="_noco",_.projectType="rest",(null===(i=null===(a=null===(t=_.meta)||void 0===t?void 0:t.db)||void 0===a?void 0:a.connection)||void 0===i?void 0:i.filename)&&(_.meta.db.connection.filename=r.join(_.toolDir,_.meta.db.connection.filename)),f)_.try=!0,_.meta.db={client:u.DriverClient.SQLITE,connection:":memory:",pool:{min:1,max:1,idleTimeoutMillis:36e7}};else if(null==n?void 0:n.metaUrl)_.meta.db=await(0,d.metaUrlToDbConfig)(n.metaUrl);else if(null==n?void 0:n.metaJson)_.meta.db=JSON.parse(n.metaJson);else if(null==n?void 0:n.metaJsonFile){if(!await(0,c.promisify)(l.default.exists)(n.metaJsonFile))throw new Error(`NC_DB_JSON_FILE not found: ${n.metaJsonFile}`);const e=await(0,c.promisify)(l.default.readFile)(n.metaJsonFile,{encoding:"utf8"});_.meta.db=JSON.parse(e)}h&&(_.publicUrl=h),_.dashboardPath=g||"/dashboard";try{await _.metaDbCreateIfNotExist()}catch(e){throw new Error(e)}return _}static async createByEnv(){var e;return m.create({meta:{metaUrl:process.env.NC_DB,metaJson:process.env.NC_DB_JSON,metaJsonFile:process.env.NC_DB_JSON_FILE},secret:process.env.NC_AUTH_JWT_SECRET,port:process.env.NC_PORT,tryMode:!!process.env.NC_TRY,worker:!!process.env.NC_WORKER,dashboardPath:null!==(e=process.env.NC_DASHBOARD_URL)&&void 0!==e?e:"/dashboard",publicUrl:process.env.NC_PUBLIC_URL})}async metaDbCreateIfNotExist(){var e,t,a,i,n,s,o,r;if("sqlite3"===(null===(t=null===(e=this.meta)||void 0===e?void 0:e.db)||void 0===t?void 0:t.client)){const e=await p.SqlClientFactory.create(Object.assign(Object.assign({},this.meta.db),{connection:this.meta.db}));if(!(null===(i=null===(a=this.meta.db)||void 0===a?void 0:a.connection)||void 0===i?void 0:i.filename))throw new Error("Configuration missing meta db connection");await e.createDatabaseIfNotExists({database:null===(s=null===(n=this.meta.db)||void 0===n?void 0:n.connection)||void 0===s?void 0:s.filename}),await e.knex.destroy()}else{const e=await p.SqlClientFactory.create(this.meta.db);if(!(null===(r=null===(o=this.meta.db)||void 0===o?void 0:o.connection)||void 0===r?void 0:r.database))throw new Error("Configuration missing meta db connection");await e.createDatabaseIfNotExists(this.meta.db.connection),await e.knex.destroy()}}}t.NcConfig=m},97882:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DriverClient=t.knownQueryParams=t.avoidSSL=t.defaultConnectionOptions=t.defaultConnectionConfig=t.defaultClientPortMapping=t.driverClientMapping=void 0,t.driverClientMapping={mysql:"mysql2",mariadb:"mysql2",postgres:"pg",postgresql:"pg",sqlite:"sqlite3",mssql:"mssql"},t.defaultClientPortMapping={mysql:3306,mysql2:3306,postgres:5432,pg:5432,mssql:1433},t.defaultConnectionConfig={dateStrings:!0},t.defaultConnectionOptions={pool:{min:0,max:10}},t.avoidSSL=["localhost","127.0.0.1","host.docker.internal","172.17.0.1"],t.knownQueryParams=[{parameter:"database",aliases:["d","db"]},{parameter:"password",aliases:["p"]},{parameter:"user",aliases:["u"]},{parameter:"title",aliases:["t"]},{parameter:"keyFilePath",aliases:[]},{parameter:"certFilePath",aliases:[]},{parameter:"caFilePath",aliases:[]},{parameter:"ssl",aliases:[]},{parameter:"options",aliases:["opt","opts"]}],function(e){e.MYSQL="mysql2",e.MSSQL="mssql",e.PG="pg",e.SQLITE="sqlite3",e.SNOWFLAKE="snowflake"}(t.DriverClient||(t.DriverClient={}))},93006:function(e,t,a){var i=this&&this.__rest||function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(a[i[n]]=e[i[n]])}return a},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.metaUrlToDbConfig=t.xcUrlToDbConfig=t.jdbcToXcUrl=t.jdbcToXcConfig=t.getToolDir=t.prepareEnv=void 0;const s=n(a(57147)),o=a(84269),r=a(16464),l=n(a(49593)),c=a(97882),d=a(83490);function u(e){e.replace(/^jdbc:/,"");const t=(0,l.default)(e),a={};for(const[e,i]of Object.entries(t)){const t=c.knownQueryParams.find((t=>t.parameter===e||t.aliases.includes(e)));t?a[t.parameter]=i:a[e]=i}(null==a?void 0:a.port)||(a.port=c.defaultClientPortMapping[c.driverClientMapping[a.driver]||a.driver]);const{driver:n,host:s,port:o,database:r,user:d,password:u}=a,p=i(a,["driver","host","port","database","user","password"]),m=[];for(const[e,t]of Object.entries(p))m.push(`${e}=${t}`);return`${c.driverClientMapping[n]||n}://${s}${o?`:${o}`:""}?${d?`u=${d}&`:""}${u?`p=${u}&`:""}${r?`d=${r}&`:""}${m.join("&")}`}t.prepareEnv=async function(){if(process.env.NC_DATABASE_URL_FILE||process.env.DATABASE_URL_FILE){const e=await(0,r.promisify)(s.default.readFile)(process.env.NC_DATABASE_URL_FILE||process.env.DATABASE_URL_FILE,"utf-8");process.env.NC_DB=u(e)}else(process.env.NC_DATABASE_URL||process.env.DATABASE_URL)&&(process.env.NC_DB=u(process.env.NC_DATABASE_URL||process.env.DATABASE_URL))},t.getToolDir=function(){return process.env.NC_TOOL_DIR||process.cwd()},t.jdbcToXcConfig=function(e){e.replace(/^jdbc:/,"");const t=(0,l.default)(e),a={};for(const[e,i]of Object.entries(t)){const t=c.knownQueryParams.find((t=>t.parameter===e||t.aliases.includes(e)));t?a[t.parameter]=i:a[e]=i}(null==a?void 0:a.port)||(a.port=c.defaultClientPortMapping[c.driverClientMapping[a.driver]||a.driver]);const{driver:n}=a,s=i(a,["driver"]),o=c.driverClientMapping[n]||n;return"pg"!==o||(null==s?void 0:s.ssl)||c.avoidSSL.includes(s.host)||(s.ssl=!0),{client:o,connection:Object.assign({},s)}},t.jdbcToXcUrl=u,t.xcUrlToDbConfig=function(e,t="",a){const i=new o.URL(e);let n;if(i.protocol.startsWith("sqlite3"))n={client:"sqlite3",connection:{client:"sqlite3",connection:{filename:i.searchParams.get("d")||i.searchParams.get("database")},database:i.searchParams.get("d")||i.searchParams.get("database")}};else{const e={};for(const[t,a]of i.searchParams.entries()){const i=c.knownQueryParams.find((e=>e.parameter===t||e.aliases.includes(t)));i?e[i.parameter]=a:e[t]=a}n={client:i.protocol.replace(":",""),connection:Object.assign(Object.assign({},e),{host:i.hostname,port:+i.port}),acquireConnectionTimeout:6e5},process.env.NODE_TLS_REJECT_UNAUTHORIZED&&(n.connection.ssl=!0),i.searchParams.get("keyFilePath")&&i.searchParams.get("certFilePath")&&i.searchParams.get("caFilePath")&&(n.connection.ssl={keyFilePath:i.searchParams.get("keyFilePath"),certFilePath:i.searchParams.get("certFilePath"),caFilePath:i.searchParams.get("caFilePath")})}return Object.assign(n,{meta:{tn:"nc_evolutions",allSchemas:!!i.searchParams.get("allSchemas")||!(i.searchParams.get("d")||i.searchParams.get("database")),api:{prefix:i.searchParams.get("apiPrefix")||"",swagger:!0,type:a||i.searchParams.get("api")||i.searchParams.get("a")||"rest"},dbAlias:i.searchParams.get("dbAlias")||`db${t}`,metaTables:"db",migrations:{disabled:!1,name:"nc_evolutions"}}}),n},t.metaUrlToDbConfig=async function(e){var t,a;const i=new o.URL(e);let n;if(i.protocol.startsWith("sqlite3")){const e=i.searchParams.get("d")||i.searchParams.get("database");n=Object.assign({client:d.DriverClient.SQLITE,connection:{filename:e}},":memory:"===e?{pool:{min:1,max:1,idleTimeoutMillis:36e7}}:{})}else{const e={};for(const[t,a]of i.searchParams.entries()){const i=c.knownQueryParams.find((e=>e.parameter===t||e.aliases.includes(t)));i?e[i.parameter]=a:e[t]=a}n=Object.assign(Object.assign({client:i.protocol.replace(":",""),connection:Object.assign(Object.assign(Object.assign({},c.defaultConnectionConfig),e),{host:i.hostname,port:+i.port}),acquireConnectionTimeout:6e5},c.defaultConnectionOptions),i.searchParams.has("search_path")?{searchPath:i.searchParams.get("search_path").split(",")}:{}),process.env.NODE_TLS_REJECT_UNAUTHORIZED&&(n.connection.ssl=!0)}return i.searchParams.forEach(((e,t)=>{let a=e;"true"===a?a=!0:"false"===a?a=!1:/^\d+$/.test(a)&&(a=+a),["password","p","database","d","user","u","search_path"].includes(t)||t.split(".").reduce(((e,t,i,n)=>e[t]=i===n.length-1?a:e[t]||{}),n)})),(null===(t=null==n?void 0:n.connection)||void 0===t?void 0:t.ssl)&&"object"==typeof(null===(a=null==n?void 0:n.connection)||void 0===a?void 0:a.ssl)&&(n.connection.ssl.caFilePath&&!n.connection.ssl.ca&&(n.connection.ssl.ca=(await(0,r.promisify)(s.default.readFile)(n.connection.ssl.caFilePath)).toString(),delete n.connection.ssl.caFilePath),n.connection.ssl.keyFilePath&&!n.connection.ssl.key&&(n.connection.ssl.key=(await(0,r.promisify)(s.default.readFile)(n.connection.ssl.keyFilePath)).toString(),delete n.connection.ssl.keyFilePath),n.connection.ssl.certFilePath&&!n.connection.ssl.cert&&(n.connection.ssl.cert=(await(0,r.promisify)(s.default.readFile)(n.connection.ssl.certFilePath)).toString(),delete n.connection.ssl.certFilePath)),n}},35043:function(e,t,a){var i=this&&this.__createBinding||(Object.create?function(e,t,a,i){void 0===i&&(i=a);var n=Object.getOwnPropertyDescriptor(t,a);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,i,n)}:function(e,t,a,i){void 0===i&&(i=a),e[i]=t[a]}),n=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||i(t,e,a)};Object.defineProperty(t,"__esModule",{value:!0}),n(a(93006),t),n(a(83490),t),n(a(97882),t),n(a(20173),t)},83490:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DriverClient=void 0;const i=a(97882);Object.defineProperty(t,"DriverClient",{enumerable:!0,get:function(){return i.DriverClient}})},67478:function(e,t,a){var i,n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.packageInfo=t.packageVersion=void 0;const s=n(a(57147)),o=n(a(71017));let r={};t.packageInfo=r;try{t.packageInfo=r=JSON.parse(s.default.readFileSync(o.default.join(process.cwd(),"node_modules","nocodb","package.json"),"utf8"))}catch(e){try{t.packageInfo=r=JSON.parse(s.default.readFileSync(o.default.join(o.default.dirname(null===(i=process.pkg)||void 0===i?void 0:i.defaultEntrypoint),"node_modules","nocodb","package.json"),"utf8"))}catch(e){try{t.packageInfo=r=JSON.parse(s.default.readFileSync(o.default.join(process.cwd(),"package.json"),"utf8"))}catch(e){}}}const l=null==r?void 0:r.version;t.packageVersion=l},41201:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.waitForStreamClose=t.generateTempFilePath=void 0;const n=i(a(71017)),s=i(a(22037));t.generateTempFilePath=function(){return n.default.join(s.default.tmpdir(),"temp.txt")},t.waitForStreamClose=async function(e){return new Promise(((t,a)=>{e.once("finish",(()=>{t()})).once("error",(e=>{a(e)})),e.end()}))}},31339:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getProjectRolePower=void 0;const i=a(68281),n=a(51401);t.getProjectRolePower=function(e){const t=[...i.OrderedProjectRoles].reverse();let a=null,s=-1;for(const i of Object.keys(e.project_roles)){const e=t.indexOf(i);e>s&&(a=i,s=e)}const o=t.indexOf(a);return-1===o&&n.NcError.badRequest("Forbidden"),o}},63519:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sanitiseUserObj=void 0;const a=new Set(["password","salt","refresh_token","invite_token","invite_token_expires","reset_password_expires","reset_password_token","email_verification_token","created_at","updated_at"]);t.sanitiseUserObj=function(e){return Object.entries(e).reduce(((e,[t,i])=>(a.has(t)||(e[t]=i),e)),{})}},86203:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeJSON=t.serializeJSON=void 0;t.serializeJSON=e=>"string"==typeof e?e:JSON.stringify(e);t.deserializeJSON=e=>{var t;if("object"==typeof e)return null!=e?e:{};try{return null!==(t=JSON.parse(e))&&void 0!==t?t:{}}catch(e){return{}}}},39520:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(96974)),s=a(87049),o=i(a(55634)),r=i(a(79334)),l=i(a(29254)),c=i(a(70588)),d=i(a(94408)),u=i(a(74490)),p=i(a(19579)),m=i(a(49617)),f=i(a(42027)),h=i(a(47544)),g=i(a(37487)),_=i(a(33107)),b=i(a(87097)),y=i(a(43429)),w=i(a(6348)),v=i(a(6079)),T=(0,n.default)("nc:version-upgrader");class O{static async upgrade(e){var t,a,i,n,r,l,c;let d;this.log("upgrade :");try{if(e.ncMeta=await e.ncMeta.startTransaction(),!await(null===(i=null===(a=null===(t=e.ncMeta.knexConnection)||void 0===t?void 0:t.schema)||void 0===a?void 0:a.hasTable)||void 0===i?void 0:i.call(a,"nc_store")))return;this.log("upgrade : Getting configuration from meta database");const o=await e.ncMeta.metaGet("","","nc_store",{key:this.STORE_KEY}),l=this.getUpgraderList();if(o){const t=JSON.parse(o.value);if(t.version!==process.env.NC_VERSION){d=t.version;for(const a of l)if(a.name>t.version&&(this.log("upgrade : Upgrading '%s' => '%s'",t.version,a.name),await(null===(n=null==a?void 0:a.handler)||void 0===n?void 0:n.call(a,e)),o.version=a.name,await e.ncMeta.metaUpdate("","","nc_store",{value:JSON.stringify({version:o.version})},{key:O.STORE_KEY})),a.name===process.env.NC_VERSION)break;o.version=process.env.NC_VERSION}}else{this.log("upgrade : Inserting config to meta database");const t={},a="true"!==process.env.NC_CLOUD&&(null===(r=await e.ncMeta.projectList())||void 0===r?void 0:r.length);t.version=a?"0009000":process.env.NC_VERSION,await e.ncMeta.metaInsert("","","nc_store",{key:O.STORE_KEY,value:JSON.stringify(t)}),a&&await this.upgrade(e)}await e.ncMeta.commit(),s.T.emit("evt",{evt_type:"appMigration:upgraded",from:d,to:process.env.NC_VERSION})}catch(t){throw await e.ncMeta.rollback(t),s.T.emit("evt",{evt_type:"appMigration:failed",from:d,to:process.env.NC_VERSION,msg:t.message,err:null===(c=null===(l=null==t?void 0:t.stack)||void 0===l?void 0:l.split)||void 0===c?void 0:c.call(l,"\n").slice(0,2).join("\n")}),console.log(function(e,t,a){const i=`Migration from ${t} to ${a} failed`;return(0,o.default)(`Error\n-----\n${e.stack}\n\n\nPlease raise an issue in our github by using following link : \nhttps://github.com/nocodb/nocodb/issues/new?labels=Type%3A%20Bug&template=bug_report.md\n\nOr contact us in our Discord community by following link :\nhttps://discord.gg/5RgZmkW ( message @o1lab, @pranavxc or @wingkwong )`,{title:i,padding:1,borderColor:"yellow"})}(t,d,process.env.NC_VERSION)),t}}static log(e,...t){T(`${e}`,...t)}static getUpgraderList(){return[{name:"0009000",handler:null},{name:"0009044",handler:null},{name:"0011043",handler:_.default},{name:"0011045",handler:g.default},{name:"0090000",handler:h.default},{name:"0098004",handler:f.default},{name:"0098005",handler:m.default},{name:"0100002",handler:p.default},{name:"0101002",handler:r.default},{name:"0104002",handler:l.default},{name:"0104004",handler:d.default},{name:"0105002",handler:c.default},{name:"0105003",handler:u.default},{name:"0105004",handler:b.default},{name:"0107004",handler:y.default},{name:"0108002",handler:w.default},{name:"0111002",handler:v.default}]}}t.default=O,O.STORE_KEY="NC_CONFIG_MAIN"},79334:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=a(37533),o=i(a(19356)),r=i(a(33505)),l=i(a(23520)),c=a(13609);function d(e,t){var a,i;const n=null===(i=(a=e).searchPath)||void 0===i?void 0:i.call(a),s=e.clientType();return"mssql"===s&&n?e.raw("??.??",[n,t.table_name]).toQuery():"snowflake"===s?[e.client.config.connection.database,e.client.config.connection.schema,t.table_name].join("."):t.table_name}t.default=async function({ncMeta:e}){const t=await e.metaList2(null,null,c.MetaTable.BASES);for(const a of t){const t=new l.default(a);if(!t.project_id)continue;const i=await e.metaGet2(null,null,c.MetaTable.PROJECT,{id:t.project_id});if(!i)continue;const u=i.deleted,p=t.is_meta?e.knexConnection:await o.default.get(t),m=await t.getModels(e),f={projectTitle:i.title,connection:p.client.config.connection};for(const t of m)try{if(!await p.schema.hasTable(d(p,t)))continue;const a=[],i=await(await r.default.get(t.id,e)).getColumns(e).then((async e=>{const a=[];for(const i of e)(i.uidt===n.UITypes.Attachment||i.pk)&&await p.schema.hasColumn(d(p,t),i.column_name)&&a.push(i);return a})),s=i.filter((e=>e.uidt===n.UITypes.Attachment)).map((e=>e.column_name));if(0===s.length)continue;const o=i.filter((e=>e.pk)).map((e=>e.column_name)),l=await p(d(p,t)).select();for(const e of l)for(const i of s){let n;try{n="string"==typeof e[i]?JSON.parse(e[i]):e[i]}catch(e){}if(Array.isArray(n)&&n){const s=[];for(const e of n)if("url"in e&&"string"==typeof e.url){const t=e.url.match(/^(.*)\/download\/(.*)$/);if(t){const a=`download/${t[2]}`;s.push(Object.assign(Object.assign({},e),{path:a}))}else s.push(e)}const r=o.map((t=>({[t]:e[t]}))).reduce(((e,t)=>Object.assign(e,t)),{});a.push(await p(d(p,t)).update({[i]:JSON.stringify(s)}).where(r))}}await Promise.all(a)}catch(e){if(!u)throw(0,s.throwTimeoutError)(e,f),e}}}},29254:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=a(37533),o=i(a(19356)),r=i(a(33505)),l=i(a(23520)),c=a(13609);function d(e,t){var a,i;const n=null===(i=(a=e).searchPath)||void 0===i?void 0:i.call(a),s=e.clientType();return"mssql"===s&&n?e.raw("??.??",[n,t.table_name]).toQuery():"snowflake"===s?[e.client.config.connection.database,e.client.config.connection.schema,t.table_name].join("."):t.table_name}t.default=async function({ncMeta:e}){const t=await e.metaList2(null,null,c.MetaTable.BASES);for(const a of t){const t=new l.default(a);if(!t.project_id)continue;const i=await e.metaGet2(null,null,c.MetaTable.PROJECT,{id:t.project_id});if(!i)continue;const u=i.deleted,p=t.is_meta?e.knexConnection:await o.default.get(t),m=await t.getModels(e),f={projectTitle:i.title,connection:p.client.config.connection};for(const t of m)try{if(!await p.schema.hasTable(d(p,t)))continue;const a=[],i=await(await r.default.get(t.id,e)).getColumns(e).then((async e=>{const a=[];for(const i of e)(i.uidt===n.UITypes.Attachment||i.pk)&&await p.schema.hasColumn(d(p,t),i.column_name)&&a.push(i);return a})),s=i.filter((e=>e.uidt===n.UITypes.Attachment)).map((e=>e.column_name));if(0===s.length)continue;const o=i.filter((e=>e.pk)).map((e=>e.column_name)),l=await p(d(p,t)).select();for(const e of l){const i=o.map((t=>({[t]:e[t]}))).reduce(((e,t)=>Object.assign(e,t)),{});for(const n of s)if("string"==typeof e[n])try{JSON.parse(e[n]);continue}catch(s){try{let s=e[n];s=JSON.parse(`[${s.slice(1,s.length-1)}]`);const o=[];for(const e of s)o.push(JSON.parse(e));a.push(await p(d(p,t)).update({[n]:JSON.stringify(o)}).where(i))}catch(e){continue}}}await Promise.all(a)}catch(e){if(!u)throw(0,s.throwTimeoutError)(e,f),e}}}},42027:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(68281),n=a(13609);t.default=async function(e){await e.ncMeta.knex.update({uidt:i.UITypes.Number}).where({uidt:i.UITypes.Count}).orWhere({uidt:i.UITypes.AutoNumber}).table(n.MetaTable.COLUMNS)}},19579:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(13609),s=i(a(86026)),o=i(a(85750)),r=i(a(83889));t.default=async function({ncMeta:e}){const t=await e.metaList2(null,null,n.MetaTable.FILTER_EXP);for(const a of t){let t;if(a.fk_view_id)t=await s.default.get(a.fk_view_id,e);else if(a.fk_hook_id)t=await o.default.get(a.fk_hook_id,e);else{if(!a.fk_column_id)continue;t=await r.default.get({colId:a.fk_column_id},e)}t&&(a.project_id!==t.project_id&&await e.metaUpdate(null,null,n.MetaTable.FILTER_EXP,{base_id:t.base_id,project_id:t.project_id},a.id))}}},94408:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=a(13609),o=i(a(83889)),r=i(a(41186)),l=i(a(61770)),c=(e,t)=>{const a=[];return["eq","neq"].includes(e.comparison_op)&&a.push(r.default.delete(e.id,t)),a},d=(e,t)=>{const a=[];return["gt","lt","gte","lte"].includes(e.comparison_op)&&a.push(r.default.delete(e.id,t)),a},u=(e,t)=>{const a=[];return["like","nlike"].includes(e.comparison_op)&&a.push(r.default.delete(e.id,t)),a},p=(e,t)=>{const a=[];return["empty","null"].includes(e.comparison_op)?a.push(r.default.update(e.id,{comparison_op:"blank"},t)):["notempty","notnull"].includes(e.comparison_op)&&a.push(r.default.update(e.id,{comparison_op:"notblank"},t)),a},m=async(e,t,a)=>{if(!["eq","neq"].includes(e.comparison_op))return;if(!e.value)return await r.default.delete(e.id,a);const i=e.value.split(","),n=await t.getColOptions(),s=[];for(const e of i)n.options.includes(e)&&s.push(e);const o=s.join(",");if(!o)return await r.default.delete(e.id,a);const l=[];return"eq"===e.comparison_op?l.push(r.default.update(e.id,{comparison_op:"anyof",value:o},a)):"neq"===e.comparison_op&&l.push(r.default.update(e.id,{comparison_op:"nanyof",value:o},a)),await Promise.all(l)},f=(e,t)=>{const a=[],i=["true","True","1","T","Y"],n=["false","False","0","F","N"];return["empty","null"].includes(e.comparison_op)?a.push(r.default.update(e.id,{comparison_op:"notchecked"},t)):["notempty","notnull"].includes(e.comparison_op)?a.push(r.default.update(e.id,{comparison_op:"checked"},t)):"eq"===e.comparison_op?i.includes(e.value)?a.push(r.default.update(e.id,{comparison_op:"checked",value:""},t)):n.includes(e.value)?a.push(r.default.update(e.id,{comparison_op:"notchecked",value:""},t)):a.push(r.default.delete(e.id,t)):"neq"===e.comparison_op&&(n.includes(e.value)?a.push(r.default.update(e.id,{comparison_op:"checked",value:""},t)):i.includes(e.value)?a.push(r.default.update(e.id,{comparison_op:"notchecked",value:""},t)):a.push(r.default.delete(e.id,t))),a};t.default=async function({ncMeta:e}){await async function(e){const t=await e.metaList2(null,null,s.MetaTable.FILTER_EXP);for(const a of t){if(!a.fk_column_id||a.is_group)continue;const t=await o.default.get({colId:a.fk_column_id},e);[n.UITypes.SingleLineText,n.UITypes.LongText,n.UITypes.PhoneNumber,n.UITypes.Email,n.UITypes.URL].includes(t.uidt)?await Promise.all(d(a,e)):[n.UITypes.Duration,n.UITypes.Currency,n.UITypes.Percent,n.UITypes.Number,n.UITypes.Decimal,n.UITypes.Rating,n.UITypes.Rollup,n.UITypes.SingleSelect].includes(t.uidt)?await Promise.all([...u(a,e),...p(a,e)]):t.uidt===n.UITypes.Checkbox?await Promise.all(f(a,e)):t.uidt===n.UITypes.MultiSelect?(await Promise.all([...u(a,e),...p(a,e)]),await m(a,t,e)):t.uidt===n.UITypes.Attachment?await Promise.all([...d(a,e),...c(a,e),...p(a,e)]):t.uidt===n.UITypes.LinkToAnotherRecord||t.uidt===n.UITypes.Lookup?await Promise.all([...d(a,e),...p(a,e)]):t.uidt===n.UITypes.Duration&&await Promise.all([...u(a,e),...p(a,e)])}}(e),await async function(e){var t,a;const i={},n=await e.metaList2(null,null,s.MetaTable.FILTER_EXP),o=[];for(const e of n)["notempty","notnull","empty","null"].includes(e.comparison_op)&&(i[e.project_id]=!0);const r=await e.metaList2(null,null,s.MetaTable.PROJECT),c={showNullAndEmptyInFilter:!1};for(const n of r){const s=n.meta;let r=c;try{r=null!==(t="string"==typeof s?JSON.parse(s):s)&&void 0!==t?t:c}catch(e){}r=Object.assign(Object.assign({},r),{showNullAndEmptyInFilter:null!==(a=i[n.id])&&void 0!==a&&a}),o.push(l.default.update(n.id,{meta:JSON.stringify(r)},e))}await Promise.all(o)}(e)}},74490:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=a(13609),o=i(a(83889)),r=i(a(41186));function l(e,t){const a=[];return["like","nlike"].includes(e.comparison_op)&&a.push(r.default.delete(e.id,t)),a}function c(e,t){const a=[];return["eq","neq"].includes(e.comparison_op)&&a.push(r.default.update(e.id,{comparison_sub_op:"exactDate"},t)),a}function d(e,t){const a=[];return["empty","null"].includes(e.comparison_op)?a.push(r.default.update(e.id,{comparison_op:"blank"},t)):["notempty","notnull"].includes(e.comparison_op)&&a.push(r.default.update(e.id,{comparison_op:"notblank"},t)),a}t.default=async function({ncMeta:e}){const t=await e.metaList2(null,null,s.MetaTable.FILTER_EXP);for(const a of t){if(!a.fk_column_id||a.is_group)continue;const t=await o.default.get({colId:a.fk_column_id},e);[n.UITypes.Date,n.UITypes.DateTime].includes(t.uidt)?await Promise.all([...l(a,e),...d(a,e),...c(a,e)]):[n.UITypes.Time,n.UITypes.Year].includes(t.uidt)&&await Promise.all([...l(a,e),...d(a,e)])}}},87097:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(13609);t.default=async function({ncMeta:e}){const t=[],a=await e.metaList2(null,null,i.MetaTable.HOOKS);for(const n of a)t.push(e.metaUpdate(null,null,i.MetaTable.HOOKS,{version:"v1"},n.id));await Promise.all(t)}},43429:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(75666)),s=a(15147),o=a(13609);t.default=async function({ncMeta:e}){const t=[],a=await e.metaList2(null,null,o.MetaTable.BASES);for(const i of a){let a;try{a=JSON.parse(n.default.AES.decrypt(i.config,"temporary-key").toString(n.default.enc.Utf8)),t.push(s.Base.updateBase(i.id,{id:i.id,projectId:i.project_id,config:a,skipReorder:!0},e))}catch(e){}}await Promise.all(t)}},33107:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e){var t;const a=await e.ncMeta.projectList();for(const i of a){const a=JSON.parse(i.config),n=null===(t=a.envs)||void 0===t?void 0:t.dev;a.workingEnv="_noco",n&&(a.envs._noco=n,delete a.envs.dev),await e.ncMeta.projectUpdate(null==i?void 0:i.id,a)}}},37487:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e){const t=await e.ncMeta.projectList();for(const a of t){const t=JSON.parse(a.config);t.env="_noco",await e.ncMeta.projectUpdate(null==a?void 0:a.id,t)}}},49617:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=a(94647),o=i(a(93758)),r=a(13609);t.default=async function({ncMeta:e}){const t=await e.metaList2(null,null,r.MetaTable.USERS);for(const a of t)a.roles=a.roles.split(",").map((e=>"user"===e?n.OrgUserRoles.CREATOR:"user-new"===e?n.OrgUserRoles.VIEWER:e)).join(","),await e.metaUpdate(null,null,r.MetaTable.USERS,{roles:a.roles},a.id);process.env.NC_INVITE_ONLY_SIGNUP&&await o.default.saveOrUpdate({value:'{ "invite_only_signup": true }',key:s.NC_APP_SETTINGS},e)}},47544:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=i(a(36367)),o=a(36002),r=i(a(27552)),l=i(a(33505)),c=i(a(11922)),d=i(a(61770)),u=i(a(89604)),p=i(a(83889)),m=i(a(74721)),f=i(a(86026)),h=i(a(99998)),g=i(a(41186)),_=i(a(42877)),b=a(13609),y=i(a(85750)),w=i(a(71231)),v=i(a(46725)),T=i(a(67094));t.default=async function(e){const t=e.ncMeta,a=await e.ncMeta.projectList();for(const t of a){const a=new s.default({ncMeta:e.ncMeta},{workingEnv:"_noco"},t);await a.init()}const i=await async function(e=r.default.ncMeta){const t=await e.metaList(null,null,"xc_users"),a={};for(const i of t){const t=await u.default.insert(i,e);a[t.id]=t}return a}(t),E=await async function(e=r.default.ncMeta){var t,a,i;const n=await e.projectList(),s={};for(const o of n){const n=JSON.parse(o.config),r={id:o.id,prefix:n.prefix,is_meta:!!n.prefix,title:null==n?void 0:n.title,bases:null===(i=null===(a=null===(t=null==n?void 0:n.envs)||void 0===t?void 0:t._noco)||void 0===a?void 0:a.db)||void 0===i?void 0:i.map((e=>{const t=e&&e.meta&&e.meta.inflection||{};return{is_meta:!!n.prefix,type:e.client,config:e,inflection_column:t.cn,inflection_table:t.tn}}))},l=await d.default.createProject(r,e);s[l.id]=l}return s}(t);await async function(e,t,a=r.default.ncMeta){const i=await a.metaList(null,null,"nc_projects_users");for(const n of i)n.project_id in e&&n.user_id in t&&await c.default.insert({project_id:n.project_id,fk_user_id:n.user_id,roles:n.roles},a)}(E,i,t);const S=await async function(e=r.default.ncMeta){var t,a,i,s,c;const u=await e.metaList(null,null,"nc_models"),_=await e.metaList(null,null,"nc_relations"),b=[],y={},T={},E={},S={},I={},k={},C=[],j=[],x=[],R=[];for(const i of u){let s={};if(i.query_params&&(s=JSON.parse(i.query_params)),"table"===i.type||"view"===i.type){const r=await d.default.getWithInfo(i.project_id,e);if(!r)continue;const c=r.bases[0].id,u=JSON.parse(i.meta),m=await l.default.insert(r.id,c,{order:i.order,table_name:i.title,title:i.alias,type:"table"===i.type?n.ModelTypes.TABLE:n.ModelTypes.VIEW,mm:!!i.mm},e);b.push(m);const h=y[r.id]=y[r.id]||{};y[r.id][m.table_name]=m,T[r.id]=T[r.id]||{},T[r.id][m.title]=m;const g=E[r.id]=E[r.id]||{};E[r.id][m.table_name]=E[r.id][m.table_name]||{};const w=S[r.id]=S[r.id]||{};S[r.id][m.table_name]=S[r.id][m.table_name]||{},I[r.id]=I[r.id]||{},I[r.id][i.title]=I[r.id][i.title]||{},k[r.id]=k[r.id]||{},k[r.id][i.title]=k[r.id][i.title]||{};for(const a of u.columns){let i=!1;(null===(t=u.belongsTo)||void 0===t?void 0:t.find((e=>e.cn===a.cn)))&&(i=!0,a.uidt=n.UITypes.ForeignKey),a.uidt===n.UITypes.Rating&&(a.uidt=n.UITypes.Number);const s=await p.default.insert(Object.assign(Object.assign({},a),{title:a._cn,column_name:a.cn,system:i,fk_model_id:m.id}),e);g[m.table_name][s.column_name]=w[m.table_name][s.title]=s}for(const t of u.v)if(t.mm||t.hm||t.bt){const a=t;C.push((async()=>{var t,i,s,o,l,d,u,f;const b=a.hm||a.bt||a.mm,y=null===(i=null===(t=null==g?void 0:g[b.tn])||void 0===t?void 0:t[b.cn])||void 0===i?void 0:i.id,v=null===(s=null==h?void 0:h[b.tn])||void 0===s?void 0:s.id,T=null===(l=null===(o=null==g?void 0:g[b.rtn])||void 0===o?void 0:o[b.rcn])||void 0===l?void 0:l.id,O=null===(d=null==h?void 0:h[b.rtn])||void 0===d?void 0:d.id;let E,S,I;a.mm&&(E=h[b.vtn].id,S=g[b.vtn][b.vcn].id,I=g[b.vtn][b.vrcn].id);let k=!1;if(a.mm){const e=_.find((e=>e.rtn===a.mm.tn&&e.rcn===a.mm.cn&&e.tn===a.mm.vtn&&e.cn===a.mm.vcn));k="virtual"===(null==e?void 0:e.type)}else a.hm?k="virtual"===(null===(u=_.find((e=>e.rtn===a.hm.rtn&&e.tn===a.hm.tn&&e.rcn===a.hm.rcn&&e.cn===a.hm.cn)))||void 0===u?void 0:u.type):a.bt&&(k="virtual"===(null===(f=_.find((e=>e.rtn===a.bt.rtn&&e.tn===a.bt.tn&&e.rcn===a.bt.rcn&&e.cn===a.bt.cn)))||void 0===f?void 0:f.type));const C=await p.default.insert({project_id:r.id,db_alias:c,fk_model_id:m.id,_cn:a._cn,uidt:n.UITypes.LinkToAnotherRecord,type:a.hm?"hm":a.mm?"mm":"bt",fk_child_column_id:y,fk_parent_column_id:T,fk_index_name:b.fkn,ur:b.ur,dr:b.dr,fk_mm_model_id:E,fk_mm_child_column_id:S,fk_mm_parent_column_id:I,fk_related_model_id:a.hm?v:O,virtual:k},e);w[m.table_name][C.title]=C}))}else j.push((async()=>{var a,i;if(t.lk){const a=t,i={_cn:a._cn};i.fk_lookup_column_id=g[a.lk.ltn][a.lk.lcn].id;const s=Object.values(w[m.table_name]);for(const t of s)if(t.uidt===n.UITypes.LinkToAnotherRecord){const n=await t.getColOptions(e);if(n.type===a.lk.type&&n.fk_child_column_id===g[a.lk.tn][a.lk.cn].id&&n.fk_parent_column_id===g[a.lk.rtn][a.lk.rcn].id&&("mm"!==n.type||n.fk_mm_model_id===h[a.lk.vtn].id)){i.fk_relation_column_id=t.id;break}}if(!i.fk_relation_column_id)throw new Error("relation not found");const o=await p.default.insert(Object.assign(Object.assign({uidt:n.UITypes.Lookup},i),{fk_model_id:m.id}),e);w[m.table_name][o.title]=o}else if(t.rl){const a=t,i={title:a._cn,rollup_function:a.rl.fn};i.fk_rollup_column_id=g[a.rl.rltn][a.rl.rlcn].id;const s=Object.values(w[m.table_name]);for(const t of s)if(t.uidt===n.UITypes.LinkToAnotherRecord){const n=await t.getColOptions(e);if(n.type===a.rl.type&&n.fk_child_column_id===g[a.rl.tn][a.rl.cn].id&&n.fk_parent_column_id===g[a.rl.rtn][a.rl.rcn].id&&("mm"!==n.type||n.fk_mm_model_id===h[a.rl.vtn].id)){i.fk_relation_column_id=t.id;break}}if(!i.fk_relation_column_id)throw new Error("relation not found");const o=await p.default.insert(Object.assign(Object.assign({uidt:n.UITypes.Rollup},i),{fk_model_id:m.id}),e);w[m.table_name][o.title]=o}else if(t.formula){const s=t,o={_cn:s._cn};if(null===(i=null===(a=null==s?void 0:s.formula)||void 0===a?void 0:a.error)||void 0===i?void 0:i.length)o.error=Array.isArray(s.formula.error)?s.formula.error.join(","):s.formula.error;else try{o.formula=await(0,n.substituteColumnAliasWithIdInFormula)(s.formula.value,await m.getColumns(e))}catch(e){o.error="Invalid formula"}o.formula_raw=s.formula.value;const r=await p.default.insert(Object.assign(Object.assign({uidt:n.UITypes.Formula},o),{fk_model_id:m.id}),e);w[m.table_name][r.title]=r}}));const O=null===(a=u.hasMany)||void 0===a?void 0:a.filter((e=>!u.v.find((t=>t.hm&&t.hm.rtn===e.rtn&&t.hm.rcn===e.rcn&&t.hm.tn===e.tn&&t.hm.cn===e.cn))));for(const t of O)C.push((async()=>{var a,i,s,l,d,u;const f=null===(i=null===(a=null==g?void 0:g[t.tn])||void 0===a?void 0:a[t.cn])||void 0===i?void 0:i.id,b=null===(s=null==h?void 0:h[t.tn])||void 0===s?void 0:s.id,y=null===(d=null===(l=null==g?void 0:g[t.rtn])||void 0===l?void 0:l[t.rcn])||void 0===d?void 0:d.id,v="virtual"===(null===(u=_.find((e=>e.rtn===t.rtn&&e.tn===t.tn&&e.rcn===t.rcn&&e.cn===t.cn)))||void 0===u?void 0:u.type),T=await p.default.insert({project_id:r.id,db_alias:c,fk_model_id:m.id,_cn:(0,o.getUniqueColumnAliasName)([],`${t.tn}List`),uidt:n.UITypes.LinkToAnotherRecord,type:"hm",fk_child_column_id:f,fk_parent_column_id:y,fk_index_name:t.fkn,ur:t.ur,dr:t.dr,fk_related_model_id:b,system:!0,virtual:v},e);w[m.table_name][T.title]=T}));x.push((async()=>{var t,a;const n=await f.default.list(m.id,e).then((e=>e[0]));I[r.id][i.title][n.title]=n,k[r.id][i.title][n.title]=s;const o=await f.default.getColumns(n.id,e),l=Object.entries(w[m.table_name]).sort((([e],[t])=>{var a,i;return((null===(a=(null==s?void 0:s.fieldsOrder)||[])||void 0===a?void 0:a.indexOf(e))+1||1/0)-((null===(i=(null==s?void 0:s.fieldsOrder)||[])||void 0===i?void 0:i.indexOf(t))+1||1/0)}));let c=1;for(const[i,n]of l){const r=o.find((e=>n.id===e.fk_column_id));r&&await v.default.update(r.id,{order:c++,show:!(null==s?void 0:s.showFields)||((null===(t=null==s?void 0:s.showFields)||void 0===t?void 0:t[i])||!1),width:null===(a=null==s?void 0:s.columnsWidth)||void 0===a?void 0:a[i]},e)}await f.default.update(n.id,{show_system_fields:s.showSystemFields,order:i.view_order},e)}))}else R.push(i)}const A=null===(c=null===(s=null===(i=r.default.getConfig())||void 0===i?void 0:i.meta)||void 0===s?void 0:s.db)||void 0===c?void 0:c.client;return await m.default.executeOperations(C,A),await m.default.executeOperations(j,A),await m.default.executeOperations(x,A),await async function({views:e,objModelRef:t,objModelColumnAliasRef:a,objViewRef:i,objViewQPRef:s},o){var r,l,c,u,p,m,h,g,_,b,y,T,O,E,S,I,k,C,j,x,R,A,M,N;for(const P of e){const e=await d.default.getWithInfo(P.project_id,o),L=e.bases[0].id;let $={};P.query_params&&($=JSON.parse(P.query_params)),s[e.id][P.parent_model_title][P.title]=$;const q={title:P.title,show:!0,order:P.view_order,fk_model_id:t[e.id][P.parent_model_title].id,project_id:e.id,base_id:L};if("grid"===P.show_as)q.type=n.ViewTypes.GRID;else if("gallery"===P.show_as)q.type=n.ViewTypes.GALLERY,q.fk_cover_image_col_id=null===(r=a[e.id][P.parent_model_title][$.coverImageField])||void 0===r?void 0:r.id;else{if("form"!==P.show_as)throw new Error("not implemented");q.type=n.ViewTypes.FORM,q.heading=null===(c=null===(l=$.extraViewParams)||void 0===l?void 0:l.formParams)||void 0===c?void 0:c.name,q.subheading=null===(p=null===(u=$.extraViewParams)||void 0===u?void 0:u.formParams)||void 0===p?void 0:p.description,q.success_msg=null===(g=null===(h=null===(m=$.extraViewParams)||void 0===m?void 0:m.formParams)||void 0===h?void 0:h.submit)||void 0===g?void 0:g.message,q.redirect_url=null===(y=null===(b=null===(_=$.extraViewParams)||void 0===_?void 0:_.formParams)||void 0===b?void 0:b.submit)||void 0===y?void 0:y.submitRedirectUrl,q.email=JSON.stringify(null===(O=null===(T=$.extraViewParams)||void 0===T?void 0:T.formParams)||void 0===O?void 0:O.emailMe),q.submit_another_form=null===(S=null===(E=$.extraViewParams)||void 0===E?void 0:E.formParams)||void 0===S?void 0:S.submit.showAnotherSubmit,q.show_blank_form=null===(C=null===(k=null===(I=$.extraViewParams)||void 0===I?void 0:I.formParams)||void 0===k?void 0:k.submit)||void 0===C?void 0:C.showBlankForm}const D=await f.default.insert(q,o);i[e.id][P.parent_model_title][D.title]=D;const U=await f.default.getColumns(D.id,o),B=Object.entries(a[e.id][P.parent_model_title]).sort((([e],[t])=>{var a,i;return((null===(a=(null==$?void 0:$.fieldsOrder)||[])||void 0===a?void 0:a.indexOf(e))+1||1/0)-((null===(i=(null==$?void 0:$.fieldsOrder)||[])||void 0===i?void 0:i.indexOf(t))+1||1/0)}));let F=1;for(const[e,t]of B){const a=U.find((e=>t.id===e.fk_column_id)),i=F++,n=!(null==$?void 0:$.showFields)||((null===(j=null==$?void 0:$.showFields)||void 0===j?void 0:j[e])||!1);if("form"===P.show_as){const t=null===(A=null===(R=null===(x=null==$?void 0:$.extraViewParams)||void 0===x?void 0:x.formParams)||void 0===R?void 0:R.fields)||void 0===A?void 0:A[e];await w.default.update(a.id,{help:null===(M=null==t?void 0:t.help)||void 0===M?void 0:M.slice(0,254),label:null==t?void 0:t.label,required:null==t?void 0:t.required,description:null==t?void 0:t.description,order:i,show:n},o)}else if("grid"===P.show_as){const a=U.find((e=>t.id===e.fk_column_id));if(!a)continue;await v.default.update(a.id,{order:i,show:n,width:null===(N=null==$?void 0:$.columnsWidth)||void 0===N?void 0:N[e]},o)}else await f.default.updateColumn(D.id,a.id,{order:i,show:n},o)}await f.default.update(D.id,{show_system_fields:$.showSystemFields,order:P.view_order},o)}}({metas:u,views:R,objModelRef:y,objModelColumnAliasRef:S,objModelColumnRef:E,objViewRef:I,objViewQPRef:k,objModelAliasRef:T},e),await async function({objModelColumnAliasRef:e,objViewRef:t,objViewQPRef:a,objModelColumnRef:i},n){var s,o,r,l,c,d,u,p,m,_,b,y,w,v;for(const T of Object.keys(t))for(const E of Object.keys(t[T]))for(const[S,I]of Object.entries(t[T][E])){const t=a[T][E][S];(null===(s=null==t?void 0:t.viewStatus)||void 0===s?void 0:s.type)&&(null===(o=null==t?void 0:t.viewStatus)||void 0===o?void 0:o.type)!==I.lock_type&&(await f.default.update(I.id,{lock_type:null===(r=null==t?void 0:t.viewStatus)||void 0===r?void 0:r.type},n),I.lock_type=null===(l=null==t?void 0:t.viewStatus)||void 0===l?void 0:l.type);for(const a of t.sortList||[])await h.default.insert({fk_column_id:a.field&&(null===(m=(null===(d=null===(c=e[T])||void 0===c?void 0:c[E])||void 0===d?void 0:d[a.field])||(null===(p=null===(u=i[T])||void 0===u?void 0:u[E])||void 0===p?void 0:p[a.field]))||void 0===m?void 0:m.id)||null,fk_view_id:I.id,direction:"-"===a.order?"desc":"asc"},n);for(const a of t.filters||[])await g.default.insert({fk_column_id:a.field&&(null===(v=(null===(b=null===(_=null==e?void 0:e[T])||void 0===_?void 0:_[E])||void 0===b?void 0:b[a.field])||(null===(w=null===(y=null==i?void 0:i[T])||void 0===y?void 0:y[E])||void 0===w?void 0:w[a.field]))||void 0===v?void 0:v.id)||null,fk_view_id:I.id,comparison_op:O[a.op],logical_op:a.logicOp,value:a.value},n)}}({metas:u,views:R,objModelRef:y,objModelColumnAliasRef:S,objModelColumnRef:E,objViewRef:I,objViewQPRef:k,objModelAliasRef:T},e),{metas:u,views:R,objModelRef:y,objModelColumnAliasRef:S,objModelColumnRef:E,objViewRef:I,objViewQPRef:k,objModelAliasRef:T}}(t);await async function(e,t){var a,i,n,s,o,r,l,c,d,u,p,m,f,h,g,b,y;const w=await t.metaList(null,null,"nc_disabled_models_for_role");for(const v of w){if(!(null==v?void 0:v.title))continue;let w;if("vtable"===v.type){if(!v.parent_model_title)continue;w=null===(c=null===(l=null===(a=e.objViewRef[v.project_id])||void 0===a?void 0:a[null===(r=(null===(n=null===(i=e.objModelRef)||void 0===i?void 0:i[v.project_id])||void 0===n?void 0:n[v.parent_model_title])||(null===(o=null===(s=e.objModelAliasRef)||void 0===s?void 0:s[v.project_id])||void 0===o?void 0:o[v.parent_model_title]))||void 0===r?void 0:r.table_name])||void 0===l?void 0:l[v.title])||void 0===c?void 0:c.id}else w=(null===(p=null===(u=null===(d=e.objViewRef)||void 0===d?void 0:d[v.project_id])||void 0===u?void 0:u[v.title])||void 0===p?void 0:p[null===(h=null===(f=null===(m=e.objModelRef)||void 0===m?void 0:m[v.project_id])||void 0===f?void 0:f[v.title])||void 0===h?void 0:h.title].id)||(null===(y=null===(b=null===(g=e.objViewRef[v.project_id])||void 0===g?void 0:g[v.title])||void 0===b?void 0:b[v.title])||void 0===y?void 0:y.id);w&&await _.default.insert({role:v.role,fk_view_id:w,disabled:v.disabled},t)}}(S,t),await async function(e,t){var a,i,n,s,o,r,l,c,d,u,p,m,h,g,_,b;const y=await t.metaList(null,null,"nc_shared_views");for(const w of y){let y;w.view_name&&w.model_name&&(y="table"!==w.view_type&&"view"!==w.view_type?null===(c=null===(l=null===(a=e.objViewRef[w.project_id])||void 0===a?void 0:a[null===(r=(null===(n=null===(i=e.objModelRef)||void 0===i?void 0:i[w.project_id])||void 0===n?void 0:n[w.model_name])||(null===(o=null===(s=e.objModelAliasRef)||void 0===s?void 0:s[w.project_id])||void 0===o?void 0:o[w.model_name]))||void 0===r?void 0:r.title])||void 0===l?void 0:l[w.view_name])||void 0===c?void 0:c.id:(null===(h=null===(u=null===(d=e.objViewRef[w.project_id])||void 0===d?void 0:d[w.model_name])||void 0===u?void 0:u[null===(m=null===(p=e.objModelRef[w.project_id])||void 0===p?void 0:p[w.model_name])||void 0===m?void 0:m.title])||void 0===h?void 0:h.id)||(null===(b=null===(_=null===(g=e.objViewRef[w.project_id])||void 0===g?void 0:g[w.model_name])||void 0===_?void 0:_[w.model_name])||void 0===b?void 0:b.id),y&&await f.default.update(y,{uuid:w.view_id,password:w.password},t))}}(S,t),await async function(e){const t=await e.metaList(null,null,"nc_shared_bases");for(const a of t)await d.default.update(a.project_id,{uuid:a.shared_base_id,password:a.password,roles:a.roles},e)}(t),await async function(e){const t=await e.metaList(null,null,"nc_plugins");for(const a of t)await e.metaInsert2(null,null,b.MetaTable.PLUGIN,{title:a.title,description:a.description,active:a.active,version:a.version,docs:a.docs,status:a.status,status_details:a.status_details,logo:a.logo,tags:a.tags,category:a.category,input:a.input,input_schema:a.input_schema,creator:a.creator,creator_website:a.creator_website,price:a.price})}(t),await async function(e,t){var a;const i=await t.metaList(null,null,"nc_hooks");for(const n of i){if(!n.project_id||!(null===(a=e.objModelRef[null==n?void 0:n.project_id])||void 0===a?void 0:a[null==n?void 0:n.tn]))continue;const i=await y.default.insert({fk_model_id:e.objModelRef[n.project_id][n.tn].id,project_id:n.project_id,title:n.title,description:n.description,env:n.env,type:n.type,event:n.event,operation:n.operation,async:n.async,payload:n.payload,url:n.url,headers:n.headers,condition:!!n.condition,notification:n.notification,retries:n.retries,retry_interval:n.retry_interval,timeout:n.timeout,active:n.active},t);let s=[];try{s=JSON.parse(n.condition)}catch(e){}for(const a of s||[])await g.default.insert({fk_column_id:a.field?(e.objModelColumnRef[n.project_id][n.tn][a.field]||e.objModelColumnAliasRef[n.project_id][n.tn][a.field]).id:null,fk_hook_id:i.id,logical_op:a.logicOp,comparison_op:O[a.op],value:a.value},t)}}(S,t),await async function(e,t,a){var i,n,s,o,r,l,c,d,u,p,m,f;const h=await a.metaList(null,null,"nc_audit");for(const g of h){if(!(g.project_id in t))continue;const h={user:g.user,ip:g.ip,project_id:g.project_id,row_id:g.model_id,op_type:g.op_type,op_sub_type:g.op_sub_type,status:g.status,description:g.description,details:g.details};if(g.model_name){const t=(null===(n=null===(i=e.objModelAliasRef)||void 0===i?void 0:i[g.project_id])||void 0===n?void 0:n[g.model_name])||(null===(o=null===(s=e.objModelRef)||void 0===s?void 0:s[g.project_id])||void 0===o?void 0:o[g.model_name])||(null===(l=null===(r=e.objModelRef)||void 0===r?void 0:r[g.project_id])||void 0===l?void 0:l[null===(d=null===(c=e.metas)||void 0===c?void 0:c.find((e=>e.id==g.model_id)))||void 0===d?void 0:d.title])||(null===(p=null===(u=e.objModelAliasRef)||void 0===u?void 0:u[g.project_id])||void 0===p?void 0:p[null===(f=null===(m=e.metas)||void 0===m?void 0:m.find((e=>e.id==g.model_id)))||void 0===f?void 0:f.alias]);if(!t)continue;h.fk_model_id=t.id}await T.default.insert(h,a)}}(S,E,t)};const O={"is like":"like",">":"gt","<":"lt",">=":"gte","<=":"lte","is equal":"eq","is not null":"notnull","is null":"null","is not equal":"neq","is not like":"nlike"}},70588:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(13609);t.default=async function({ncMeta:e}){const t=await e.metaList2(null,null,i.MetaTable.GRID_VIEW_COLUMNS),a=[...new Set(t.map((e=>e.fk_view_id)))];for(const t of a){const a=await e.metaList2(null,null,i.MetaTable.GRID_VIEW_COLUMNS,{condition:{fk_view_id:t},orderBy:{order:"asc"}}),n=[];for(const t of a){const a=await e.metaGet(null,null,i.MetaTable.COLUMNS,{id:t.fk_column_id});n.push(a)}if(!n.some((e=>e.pv))){const t=n.findIndex((e=>e.pk));t===n.length-1?t>0?await e.metaUpdate(null,null,i.MetaTable.COLUMNS,{pv:!0},n[t-1].id):n.length>0&&await e.metaUpdate(null,null,i.MetaTable.COLUMNS,{pv:!0},n[0].id):t>-1?await e.metaUpdate(null,null,i.MetaTable.COLUMNS,{pv:!0},n[t+1].id):n.length>0&&await e.metaUpdate(null,null,i.MetaTable.COLUMNS,{pv:!0},n[0].id)}const s=n.find((e=>e.pv));if(s){const t=a.find((e=>e.fk_column_id===s.id)),n=a.findIndex((e=>e.fk_column_id===s.id)),o=a.map((e=>e.order)),r=Math.min(...o);if(t.show||await e.metaUpdate(null,null,i.MetaTable.GRID_VIEW_COLUMNS,{show:!0},t.id),t.order===r&&1===o.filter((e=>e===r)).length)continue;if(0!==n){const e=a.splice(n,1);a.unshift(...e)}for(let t=0;t<a.length;t++)await e.metaUpdate(null,null,i.MetaTable.GRID_VIEW_COLUMNS,{order:t+1},a[t].id)}}}},37533:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.throwTimeoutError=void 0,t.throwTimeoutError=function(e,t){if(["EHOSTDOWN","ETIMEDOUT","EHOSTUNREACH","ENOTFOUND","ECONNREFUSED"].includes(e.code)){let e="";throw t.connection.filename?e=t.connection.filename:t.connection.database&&t.connection.host&&t.connection.port&&(e=`${t.connection.database} (${t.connection.host}:${t.connection.port})`),new Error(`Failed to connect the database ${e} for Project ${t.projectTitle}.\n       Please fix the connection issue or remove the project before trying to upgrade.`)}}},6079:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(26481),s=a(68281),o=a(13609),r=a(15147),l=i(a(19356)),c=a(15147),d=new n.Logger("LTARIndexUpgrader");async function u({model:e,indexes:t,ncMeta:a,sqlClient:i}){for(const n of await e.getColumns(a)){if(n.uidt!==s.UITypes.LinkToAnotherRecord)continue;const e=await n.getColOptions(a);if(e&&e.type===s.RelationTypes.BELONGS_TO){const n=await e.getChildColumn(a),s=await n.getModel(a);if(t.find((e=>e.cn===n.column_name)))continue;d.log(`Creating index for column '${n.column_name}'`);const o={columns:[n.column_name],tn:s.table_name,non_unique:!0};await i.indexCreate(o)}}}async function p({ncMeta:e,base:t}){var a,i;const n=await l.default.getSqlClient(t,e.knex),s=await e.metaList2(null,t.id,o.MetaTable.MODELS);for(const t of s){d.log(`Upgrading model '${t.title}'`),d.log(`Fetching index list of model '${t.title}'`);const s=null!==(i=null===(a=(await n.indexList({tn:t.table_name})).data)||void 0===a?void 0:a.list)&&void 0!==i?i:[],o=s.filter(((e,t)=>s.every(((a,i)=>t===i||a.key_name!==e.key_name))));await u({ncMeta:e,model:new c.Model(t),sqlClient:n,indexes:o}),d.log(`Upgraded model '${t.title}'`)}}t.default=async function({ncMeta:e}){d.log("Starting upgrade for LTAR relations in XCDB bases to add missing index");const t=await e.metaList2(null,null,o.MetaTable.BASES,{condition:{is_meta:1},orderBy:{}});if(t.length){for(const a of t){const t=new r.Base(a);if("pg"!==e.knex.clientType())continue;const i=await t.getProject(e);i&&!i.deleted&&(d.log(`Upgrading base '${t.alias}'(${i.title})`),await p({ncMeta:e,base:t}),d.log(`Upgraded base '${t.alias}'(${i.title})`))}d.log("Finished upgrade for LTAR relations in XCDB bases to add missing index")}}},6348:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=a(68281),s=a(13609),o=i(a(37912)),r=a(15147),l=i(a(19356)),c=a(13609),d=a(15147);async function u({model:e,relations:t,ncMeta:a,sqlClient:i}){for(const r of await e.getColumns(a)){if(r.uidt!==n.UITypes.LinkToAnotherRecord)continue;const e=await r.getColOptions(a);if(!e)continue;switch(e.type){case n.RelationTypes.HAS_MANY:{if(e.virtual)break;const n=await e.getParentColumn(a),s=await e.getChildColumn(a),o=await n.getModel(a),r=await s.getModel(a),l=t.find((e=>n.column_name===e.rcn&&s.column_name===e.cn&&o.table_name===e.rtn&&r.table_name===e.tn));if(l&&(await i.relationDelete({parentColumn:l.rcn,childColumn:l.cn,parentTable:l.rtn,childTable:l.tn,foreignKeyName:l.cstn}),"pg"!==a.knex.clientType())){const e={columns:[l.cn],tn:l.tn,non_unique:!0};await i.indexCreate(e)}}}await a.metaUpdate(null,null,s.MetaTable.COL_RELATIONS,{virtual:!0},e.id);const l=await o.default.get(`${c.CacheScope.COL_RELATION}:${e.fk_column_id}`,c.CacheGetType.TYPE_OBJECT);l&&(l.virtual=!0,await o.default.set(`${c.CacheScope.COL_RELATION}:${e.fk_column_id}`,l))}}async function p({ncMeta:e,base:t,relations:a}){const i=await l.default.getSqlClient(t,e.knex),n=await e.metaList2(null,t.id,s.MetaTable.MODELS);for(const t of n)await u({ncMeta:e,model:new d.Model(t),sqlClient:i,relations:a})}t.default=async function({ncMeta:e}){var t,a;const i=await e.metaList2(null,null,s.MetaTable.BASES,{condition:{is_meta:1},orderBy:{}});if(!i.length)return;const n=await l.default.getSqlClient(new r.Base(i[0]),e.knex),o=null===(a=null===(t=await n.relationListAll())||void 0===t?void 0:t.data)||void 0===a?void 0:a.list;for(const t of i)await p({ncMeta:e,base:new r.Base(t),relations:o})}},44653:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(a(96974)),s=a(66860),o=i(a(64190)),r=i(a(68257)),l=i(a(35313)),c=i(a(94701)),d=i(a(60854)),u=i(a(9997)),p=(0,n.default)("nc:api:base");t.default=class{get knex(){var e;return(null===(e=this.sqlClient)||void 0===e?void 0:e.knex)||this.dbDriver}get prefix(){var e;return null===(e=this.projectBuilder)||void 0===e?void 0:e.prefix}get apiType(){var e,t,a;return null===(a=null===(t=null===(e=this.connectionConfig)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.api)||void 0===a?void 0:a.type}get apiPrefix(){var e,t,a;return null===(a=null===(t=null===(e=this.connectionConfig)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.api)||void 0===a?void 0:a.prefix}get dbAlias(){var e,t;return null===(t=null===(e=this.connectionConfig)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.dbAlias}get router(){return this.apiRouter||(this.baseLog("router : Initializing builder router"),this.apiRouter=(0,s.Router)(),this.projectBuilder.router.use("/",this.apiRouter)),this.apiRouter}get routeVersionLetter(){var e,t,a;return(null===(a=null===(t=null===(e=this.connectionConfig)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.api)||void 0===a?void 0:a.prefix)||"v1"}get projectId(){var e;return null===(e=this.projectBuilder)||void 0===e?void 0:e.id}get xcModels(){return this.models}get client(){var e;return null===(e=this.connectionConfig)||void 0===e?void 0:e.client}constructor(e,t,a,i){this.tablesCount=0,this.relationsCount=0,this.viewsCount=0,this.functionsCount=0,this.proceduresCount=0,this.models={},this.app=e,this.config=a,this.connectionConfig=i,this.metas={},this.procedureOrFunctionAcls={},this.hooks={},this.formViews={},this.projectBuilder=t}getDbType(){return this.connectionConfig.client}getDbName(){var e;return null===(e=this.connectionConfig.connection)||void 0===e?void 0:e.database}getDbAlias(){var e,t;return null===(t=null===(e=this.connectionConfig)||void 0===e?void 0:e.meta)||void 0===t?void 0:t.dbAlias}async getSqlClient(){return u.default.getSqlClient({dbAlias:this.dbAlias,env:this.config.env,config:this.config,projectId:this.projectId})}async xcUpgrade(){var e,t,a,i,n,s;const o=[{name:"0009000",handler:null},{name:"0009044",handler:this.ncUpManyToMany.bind(this)},{name:"0083006",handler:r.default},{name:"0083007",handler:l.default},{name:"0083008",handler:c.default},{name:"0084002",handler:this.ncUpAddNestedResolverArgs.bind(this)}];if(!await(null===(i=null===(a=null===(t=null===(e=this.xcMeta)||void 0===e?void 0:e.knex)||void 0===t?void 0:t.schema)||void 0===a?void 0:a.hasTable)||void 0===i?void 0:i.call(a,"nc_store")))return;this.baseLog("xcUpgrade : Getting configuration from meta database");const d=await this.xcMeta.metaGet(this.projectId,this.dbAlias,"nc_store",{key:"NC_CONFIG"});if(d){const e=JSON.parse(d.value);if(e.version!==process.env.NC_VERSION){for(const t of o)if(t.name>e.version&&(this.baseLog("xcUpgrade : Upgrading '%s' => '%s'",e.version,t.name),await(null===(n=null==t?void 0:t.handler)||void 0===n?void 0:n.call(t,{xcMeta:this.xcMeta,builder:this,dbAlias:this.dbAlias,projectId:this.projectId})),e.version=t.name,await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_store",{value:JSON.stringify(e)},{key:"NC_CONFIG"})),t.name===process.env.NC_VERSION)break;e.version=process.env.NC_VERSION,await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_store",{value:JSON.stringify(e)},{key:"NC_CONFIG"})}}else{this.baseLog("xcUpgrade : Inserting config to meta database");const e=JSON.parse(JSON.stringify(this.config));delete e.envs;const t=null===(s=await this.xcMeta.metaList(this.projectId,this.dbAlias,"nc_models"))||void 0===s?void 0:s.length;e.version=t?"0009000":process.env.NC_VERSION,await this.xcMeta.metaInsert(this.projectId,this.dbAlias,"nc_store",{key:"NC_CONFIG",value:JSON.stringify(e)}),t&&await this.xcUpgrade()}}getProjectId(){return this.projectId}async init(){await this.xcUpgrade()}async initDbDriver(){this.dbDriver=await u.default.get({dbAlias:this.dbAlias,env:this.config.env,config:this.config,projectId:this.projectId}),this.sqlClient=await u.default.getSqlClient({dbAlias:this.dbAlias,env:this.config.env,config:this.config,projectId:this.projectId})}baseLog(e,...t){p(`${this.dbAlias} : ${e}`,...t)}generateContextForTable(e,t,a,i,n,s="table",r){this.baseLog("generateContextForTable : '%s' %s",e,s);for(const e of t)e._cn=e._cn||this.getColumnNameAlias(e);const l=r||this.getTableNameAlias(e);return{dbType:this.connectionConfig.client,tn:e,_tn:l,tn_camelize:o.default.camelize(l),tn_camelize_low:o.default.camelize(l,!0),columns:t,relations:a,hasMany:i,belongsTo:n,dbAlias:"",routeVersionLetter:this.routeVersionLetter,type:s,project_id:this.projectId}}getColumnNameAlias(e,t){var a,i,n,s,o,r,l;return(null===(s=null===(n=null===(i=null===(a=this.metas)||void 0===a?void 0:a[t])||void 0===i?void 0:i.columns)||void 0===n?void 0:n.find((t=>t.cn===e.cn)))||void 0===s?void 0:s._cn)||e._cn||this.getInflectedName(e.cn,null===(l=null===(r=null===(o=this.connectionConfig)||void 0===o?void 0:o.meta)||void 0===r?void 0:r.inflection)||void 0===l?void 0:l.cn)}getInflectedName(e,t){let a=e;return process.env.NC_INFLECTION&&(t="camelize"),t&&"none"!==t&&(a=t.split(",").reduce(((e,t)=>{var a;return(null===(a=null===o.default||void 0===o.default?void 0:o.default[t])||void 0===a?void 0:a.call(o.default,e))||e}),a)),"graphql"===this.apiType?a.replace(/[^_\da-z]/gi,"_"):a}async ncUpAddNestedResolverArgs(e){}getTableNameAlias(e){var t,a,i,n,s,o,r,l,c;let d=e;if(null===(a=null===(t=this.metas)||void 0===t?void 0:t[d])||void 0===a?void 0:a._tn)return null===(n=null===(i=this.metas)||void 0===i?void 0:i[d])||void 0===n?void 0:n._tn;(null===(s=this.projectBuilder)||void 0===s?void 0:s.prefix)&&(d=d.replace(null===(o=this.projectBuilder)||void 0===o?void 0:o.prefix,""));const u=null==d?void 0:d.replace(/^(?=\d+)/,"ISN___");return this.getInflectedName(u,null===(c=null===(l=null===(r=this.connectionConfig)||void 0===r?void 0:r.meta)||void 0===l?void 0:l.inflection)||void 0===c?void 0:c.tn)}async ncUpManyToMany(e){const t=await this.xcMeta.metaList(this.projectId,this.dbAlias,"nc_models",{fields:["meta"],condition:{type:"table"}});if(!t.length)return;const a=[];for(const e of t){const t=JSON.parse(e.meta);a.push(t);const i=this.generateContextForTable(t.tn,t.columns,[],t.hasMany,t.belongsTo,t.type,t._tn);t.v=d.default.create(this.connectionConfig,{dir:"",ctx:i,filename:""}).getVitualColumns(),d.default.create(this.connectionConfig,{}).mapDefaultDisplayValue(t.columns),await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_models",{meta:JSON.stringify(t)},{title:t.tn})}return await this.getManyToManyRelations({localMetas:a}),a}async getManyToManyRelations({parent:e=null,child:t=null,localMetas:a=null}={}){var i;const n=new Set,s=new Set;if(a)for(const e of a)this.metas[e.tn]=e;for(const a of Object.values(this.metas))if(2===(null===(i=a.belongsTo)||void 0===i?void 0:i.length)&&a.columns.length<5){if(e&&t&&(![e,t].includes(a.belongsTo[0].rtn)||![e,t].includes(a.belongsTo[1].rtn)))continue;const i=this.metas[a.belongsTo[0].rtn],o=this.metas[a.belongsTo[1].rtn];i.manyToMany=i.manyToMany||[],i.manyToMany.every((e=>e.vtn!==a.tn))&&(i.manyToMany.push({tn:i.tn,cn:a.belongsTo[0].rcn,vtn:a.tn,vcn:a.belongsTo[0].cn,vrcn:a.belongsTo[1].cn,rtn:a.belongsTo[1].rtn,rcn:a.belongsTo[1].rcn,_tn:i._tn,_cn:a.belongsTo[0]._rcn,_rtn:a.belongsTo[1]._rtn,_rcn:a.belongsTo[1]._rcn}),n.add(i)),o!==i&&(o.manyToMany=o.manyToMany||[],o.manyToMany.every((e=>e.vtn!==a.tn))&&(o.manyToMany.push({tn:o.tn,cn:a.belongsTo[1].rcn,vtn:a.tn,vcn:a.belongsTo[1].cn,vrcn:a.belongsTo[0].cn,rtn:a.belongsTo[0].rtn,rcn:a.belongsTo[0].rcn,_tn:o._tn,_cn:a.belongsTo[1]._rcn,_rtn:a.belongsTo[0]._rtn,_rcn:a.belongsTo[0]._rcn}),n.add(o))),s.add(a)}for(const a of n){let i;if(e&&t)try{i=JSON.parse((await this.xcMeta.metaGet(this.projectId,this.dbAlias,"nc_models",{title:a.tn})).query_params)}catch(e){}a.v=[...a.v.filter((e=>!(e.hm&&a.manyToMany.some((t=>e.hm.tn===t.vtn))))),...a.manyToMany.filter(((e,t)=>!a.v.some((t=>t.mm&&(t.mm.tn===e.tn&&e.rtn===t.mm.rtn||t.mm.rtn===e.tn&&e.tn===t.mm.rtn)&&e.vtn===t.mm.vtn))&&!a.manyToMany.some(((a,i)=>i!==t&&a.tn===e.tn&&e.rtn===a.rtn&&e.vtn===a.vtn)))).map((e=>((null==i?void 0:i.showFields)&&!(`${e._tn} <=> ${e._rtn}`in i.showFields)&&(i.showFields[`${e._tn} <=> ${e._rtn}`]=!0),{mm:e,_cn:`${e._tn} <=> ${e._rtn}`})))],await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_models",Object.assign({meta:JSON.stringify(a)},i?{query_params:JSON.stringify(i)}:{}),{title:a.tn})}for(const e of s)await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_models",{mm:1},{title:e.tn});return n}}},36367:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=a(66860),n=a(30153),s=a(74773),o=a(47668);t.default=class{constructor(e,t,a){this.apiBuilders=[],this.apiInfInfoList=[],this.app=e,this.appConfig=t,a&&(this.id=a.id,this.title=a.title,this.description=a.description,this._config=Object.assign(Object.assign({},this.appConfig),JSON.parse(a.config)),this.router=(0,i.Router)())}async init(e){try{this.startTime=Date.now();const e=[];await this._createApiBuilder();for(const t of this.apiBuilders){let a;t instanceof s.RestApiBuilder?(console.log(`Creating REST APIs ${t.getDbType()} - > ${t.getDbName()}`),a=await t.init()):t instanceof n.GqlApiBuilder&&(console.log(`Creating GraphQL APIs ${t.getDbType()} - > ${t.getDbName()}`),a=await t.init()),e.push(a)}}catch(e){throw console.log(e),e}}async _createApiBuilder(){var e,t,a,i,r,l,c,d,u,p,m;this.apiBuilders.splice(0,this.apiBuilders.length);let f=0;const h=[];for(const u of(null===(i=null===(t=null===(e=this.config)||void 0===e?void 0:e.envs)||void 0===t?void 0:t[null===(a=this.appConfig)||void 0===a?void 0:a.workingEnv])||void 0===i?void 0:i.db)||[]){let e;switch(u.meta.api.type){case"graphql":e=n.GqlApiBuilder;break;case"rest":e=s.RestApiBuilder}if(null===(r=null==u?void 0:u.connection)||void 0===r?void 0:r.database){const t=Object.assign(Object.assign({},u),{meta:Object.assign(Object.assign({},u.meta),{api:Object.assign(Object.assign({},u.meta.api),{prefix:u.meta.api.prefix||this.genVer(f)})})});this.apiBuilders.push(new e(this.app,this,this.config,t,this.app.ncMeta)),h.push(t),f++}else if(null===(l=u.meta)||void 0===l?void 0:l.allSchemas){const t=await o.SqlClientFactory.create(Object.assign(Object.assign({},u),{connection:Object.assign(Object.assign({},u.connection),{database:void 0})})),a=null===(d=null===(c=await t.schemaList({}))||void 0===c?void 0:c.data)||void 0===d?void 0:d.list;for(const t of a){const a=Object.assign(Object.assign({},u),{connection:Object.assign(Object.assign({},u.connection),{database:t.schema_name}),meta:Object.assign(Object.assign({},u.meta),{dbAlias:f?u.meta.dbAlias+f:u.meta.dbAlias,api:Object.assign(Object.assign({},u.meta.api),{prefix:u.meta.api.prefix||this.genVer(f)})})});this.apiBuilders.push(new e(this.app,this,this.config,a,this.app.ncMeta)),h.push(a),f++}t.knex.destroy()}}(null===(m=null===(p=null===(u=this.config)||void 0===u?void 0:u.envs)||void 0===p?void 0:p[this.appConfig.workingEnv])||void 0===m?void 0:m.db)&&this.config.envs[this.appConfig.workingEnv].db.splice(0,this.config.envs[this.appConfig.workingEnv].db.length,...h)}genVer(e){return e.toString(26).split("").map((e=>"vwxyzabcdefghijklmnopqrstu"[parseInt(e,26)])).join("")+"1"}static triggerGarbageCollect(){try{global.gc&&global.gc()}catch(e){console.log("`node --expose-gc index.js`"),process.exit()}}get prefix(){var e;return null===(e=this.config)||void 0===e?void 0:e.prefix}get config(){return this._config}updateConfig(e){this._config=Object.assign(Object.assign({},this.appConfig),JSON.parse(e))}}},30153:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GqlApiBuilder=void 0;const n=a(66860),s=i(a(44653)),o=i(a(81984));class r extends s.default{constructor(e,t,a,i,s){super(e,t,a,i),this.type="gql",this.config=a,this.connectionConfig=i,this.gqlRouter=(0,n.Router)(),this.xcMeta=s}async init(){await super.init()}async ncUpAddNestedResolverArgs(e){const t=await this.xcMeta.metaList(this.projectId,this.dbAlias,"nc_models",{fields:["meta"],condition:{type:"table"}});if(t.length)for(const e of t){const t=JSON.parse(e.meta),a=this.generateContextForTable(t.tn,t.columns,[],t.hasMany,t.belongsTo,t.type,t._tn),i=o.default.create(this.connectionConfig,{dir:"",ctx:Object.assign(Object.assign({},a),{manyToMany:t.manyToMany}),filename:""}).getString();await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_models",{schema:i},{title:t.tn,type:"table"})}}async ncUpManyToMany(e){const t=await super.ncUpManyToMany(e);if(t)for(const e of t){const t=this.generateContextForTable(e.tn,e.columns,[],e.hasMany,e.belongsTo,e.type,e._tn),a=o.default.create(this.connectionConfig,{dir:"",ctx:Object.assign(Object.assign({},t),{manyToMany:e.manyToMany}),filename:""}).getString();if(await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_models",{schema:a},{title:e.tn,type:"table"}),e.manyToMany)for(const t of e.manyToMany)await this.xcMeta.metaInsert(this.projectId,this.dbAlias,"nc_loaders",{title:`${t.tn}Mm${t.rtn}List`,parent:t.tn,child:t.rtn,relation:"mm",resolver:"mmlist"})}}}t.GqlApiBuilder=r},68257:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e){const t=await e.xcMeta.metaList(e.projectId,e.dbAlias,"nc_models",{xcCondition:{_or:[{type:{eq:"table"}},{type:{eq:"view"}}]}});let a=0;for(const i of t){await e.xcMeta.metaUpdate(e.projectId,e.dbAlias,"nc_models",{order:++a,view_order:1},i.id);const t=await e.xcMeta.metaList(e.projectId,e.dbAlias,"nc_models",{condition:{parent_model_title:i.title}});let n=1;for(const a of t)await e.xcMeta.metaUpdate(e.projectId,e.dbAlias,"nc_models",{view_order:++n},a.id)}}},35313:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e){const t=await e.xcMeta.metaList(e.projectId,e.dbAlias,"nc_models",{condition:{type:"vtable"}});for(const a of t)await e.xcMeta.metaUpdate(e.projectId,e.dbAlias,"nc_disabled_models_for_role",{parent_model_title:a.parent_model_title},{type:"vtable",title:a.title})}},94701:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=async function(e){try{const t=await e.xcMeta.metaList(e.projectId,e.dbAlias,"nc_relations"),a=[];for(const e of t){if("real"!==e.type||a.includes(e))continue;const i=t.findIndex((t=>t!==e&&t.tn===e.tn&&t.rtn===e.rtn&&t.cn===e.cn&&t.rcn===e.rcn&&"real"===t.type));i>-1&&a.push(t[i])}for(const t of a){await e.xcMeta.metaDelete(e.projectId,e.dbAlias,"nc_relations",t.id);{const a=await e.xcMeta.metaGet(e.projectId,e.dbAlias,"nc_models",{type:"table",title:t.tn}),i=JSON.parse(a.meta),n=i.belongsTo.filter((e=>e.tn===t.tn&&e.rtn===t.rtn&&e.cn===t.cn&&e.rcn===t.rcn&&"real"===e.type));(null==n?void 0:n.length)>1&&i.belongsTo.splice(i.belongsTo.indexOf(n[1]),1),await e.xcMeta.metaUpdate(e.projectId,e.dbAlias,"nc_models",{meta:JSON.stringify(i)},{type:"table",title:t.tn})}{const a=await e.xcMeta.metaGet(e.projectId,e.dbAlias,"nc_models",{type:"table",title:t.rtn}),i=JSON.parse(a.meta),n=i.hasMany.filter((e=>e.tn===t.tn&&e.rtn===t.rtn&&e.cn===t.cn&&e.rcn===t.rcn&&"real"===e.type));(null==n?void 0:n.length)>1&&i.hasMany.splice(i.hasMany.indexOf(n[1]),1),await e.xcMeta.metaUpdate(e.projectId,e.dbAlias,"nc_models",{meta:JSON.stringify(i)},{type:"table",title:t.rtn})}}}catch(e){console.log(e)}}},74773:function(e,t,a){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RestApiBuilder=void 0;const n=i(a(20091)),s=i(a(44653)),o=i(a(74721)),r=i(a(52440)),l=i(a(2211));class c extends s.default{constructor(e,t,a,i,s){super(e,t,a,i),this.type="rest",(0,n.default)(this),this.routers={},this.hooks={},this.xcMeta=s}async init(){await super.init()}async ncUpManyToMany(e){const t=await super.ncUpManyToMany(e);if(t)for(const e of t){const t=this.generateContextForTable(e.tn,e.columns,[],e.hasMany,e.belongsTo,e.type,e._tn),a=new r.default({dir:"",ctx:t,filename:""}).getObjectWithoutFunctions().map(((t,a)=>async()=>{await this.xcMeta.metaGet(this.projectId,this.dbAlias,"nc_routes",{path:t.path,tn:e.tn,title:e.tn,type:t.type})?await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_routes",{order:a},{path:t.path,tn:e.tn,title:e.tn,type:t.type}):await this.xcMeta.metaInsert(this.projectId,this.dbAlias,"nc_routes",{acl:JSON.stringify(t.acl),handler:JSON.stringify(t.handler),order:a,path:t.path,tn:e.tn,title:e.tn,type:t.type})}));await o.default.executeOperations(a,this.connectionConfig.client)}}async getManyToManyRelations(e={}){const t=await super.getManyToManyRelations(e);for(const e of t){const t=this.generateContextForTable(e.tn,e.columns,[...e.belongsTo,...e.hasMany],e.hasMany,e.belongsTo),a=await new l.default({dir:"",ctx:Object.assign(Object.assign({},t),{v:e.v}),filename:""}).getObject(),i=await this.xcMeta.metaGet(this.projectId,this.dbAlias,"nc_models",{title:e.tn,type:"table"}),n=JSON.parse(i.schema);n.definitions=a.definitions,await this.xcMeta.metaUpdate(this.projectId,this.dbAlias,"nc_models",{schema:JSON.stringify(n)},{title:e.tn,type:"table"})}return t}}t.RestApiBuilder=c},76685:e=>{e.exports=require("@google-cloud/storage")},7010:e=>{e.exports=require("@nestjs/bull")},26481:e=>{e.exports=require("@nestjs/common")},35793:e=>{e.exports=require("@nestjs/config")},50143:e=>{e.exports=require("@nestjs/core")},30715:e=>{e.exports=require("@nestjs/core/helpers/execution-context-host")},47020:e=>{e.exports=require("@nestjs/event-emitter")},24340:e=>{e.exports=require("@nestjs/passport")},36188:e=>{e.exports=require("@nestjs/platform-express")},65715:e=>{e.exports=require("@nestjs/platform-socket.io")},6279:e=>{e.exports=require("@nestjs/websockets")},9856:e=>{e.exports=require("@sentry/node")},94294:e=>{e.exports=require("airtable")},75888:e=>{e.exports=require("ajv")},34638:e=>{e.exports=require("ajv-formats")},20091:e=>{e.exports=require("auto-bind")},29336:e=>{e.exports=require("aws-sdk")},52167:e=>{e.exports=require("axios")},98432:e=>{e.exports=require("bcryptjs")},55634:e=>{e.exports=require("boxen")},37068:e=>{e.exports=require("bull")},10308:e=>{e.exports=require("clear")},34357:e=>{e.exports=require("colors")},57795:e=>{e.exports=require("compare-versions")},79710:e=>{e.exports=require("cookie-parser")},33582:e=>{e.exports=require("cors")},75666:e=>{e.exports=require("crypto-js")},65826:e=>{e.exports=require("dataloader")},1635:e=>{e.exports=require("dayjs")},53291:e=>{e.exports=require("dayjs/plugin/timezone")},36619:e=>{e.exports=require("dayjs/plugin/utc")},46778:e=>{e.exports=require("dayjs/plugin/utc.js")},96974:e=>{e.exports=require("debug")},25142:e=>{e.exports=require("dotenv")},49632:e=>{e.exports=require("ejs")},51196:e=>{e.exports=require("emittery")},66860:e=>{e.exports=require("express")},48673:e=>{e.exports=require("fast-levenshtein")},54230:e=>{e.exports=require("glob")},62097:e=>{e.exports=require("handlebars")},64190:e=>{e.exports=require("inflection")},41495:e=>{e.exports=require("ioredis")},992:e=>{e.exports=require("ioredis-mock")},71363:e=>{e.exports=require("is-docker")},73059:e=>{e.exports=require("isomorphic-dompurify")},64923:e=>{e.exports=require("jsep")},45643:e=>{e.exports=require("jsonfile")},99344:e=>{e.exports=require("jsonwebtoken")},40514:e=>{e.exports=require("knex")},76918:e=>{e.exports=require("lodash/find")},48425:e=>{e.exports=require("lodash/findIndex")},98492:e=>{e.exports=require("lodash/groupBy")},89699:e=>{e.exports=require("lodash/isEmpty")},87413:e=>{e.exports=require("lodash/mapKeys")},69309:e=>{e.exports=require("lodash/uniqBy")},4245:e=>{e.exports=require("mailersend")},26299:e=>{e.exports=require("minio")},49443:e=>{e.exports=require("mkdirp")},1738:e=>{e.exports=require("multer")},30754:e=>{e.exports=require("nanoid")},87049:e=>{e.exports=require("nc-help")},58890:e=>{e.exports=require("nc-lib-gui")},73134:e=>{e.exports=require("nc-plugin")},45184:e=>{e.exports=require("nodemailer")},71569:e=>{e.exports=require("object-hash")},66135:e=>{e.exports=require("object-sizeof")},66998:e=>{e.exports=require("p-queue")},57153:e=>{e.exports=require("papaparse")},49593:e=>{e.exports=require("parse-database-url")},72004:e=>{e.exports=require("passport-custom")},84743:e=>{e.exports=require("passport-google-oauth20")},50466:e=>{e.exports=require("passport-http")},60136:e=>{e.exports=require("passport-jwt")},57055:e=>{e.exports=require("passport-local")},35900:e=>{e.exports=require("pg")},78910:e=>{e.exports=require("request")},52316:e=>{e.exports=require("request-ip")},21964:e=>{e.exports=require("rxjs")},32488:e=>{e.exports=require("slash")},43952:e=>{e.exports=require("socket.io")},20661:e=>{e.exports=require("sqlite3")},32680:e=>{e.exports=require("tinycolor2")},37202:e=>{e.exports=require("twilio")},84269:e=>{e.exports=require("url")},16464:e=>{e.exports=require("util")},25828:e=>{e.exports=require("uuid")},71564:e=>{e.exports=require("validator")},6302:e=>{e.exports=require("xlsx")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},12781:e=>{e.exports=require("stream")},49037:e=>{e.exports=JSON.parse('{"openapi":"3.1.0","x-stoplight":{"id":"qiz1rcfqd2jy6"},"info":{"title":"nocodb","version":"1.0","description":"NocoDB API Documentation"},"x-tagGroups":[{"name":"Auth APIs","tags":["Auth","API Token"]},{"name":"Public APIs","tags":["Public"]},{"name":"Data APIs","tags":["DB Table Row","DB View Row","Storage"]},{"name":"Meta APIs","tags":["Base","DB Table","DB Table Column","DB Table Filter","DB Table Sort","DB Table Webhook","DB Table Webhook Filter","DB View","DB View Column","DB View Share","Plugin","Project","Utils"]},{"name":"Organisation APIs","tags":["Org App Settings","Org License","Org Tokens","Org Users"]}],"servers":[{"url":"http://localhost:8080"}],"paths":{"/api/v1/auth/user/signup":{"post":{"summary":"Signup","operationId":"auth-signup","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string","description":"The signed JWT token for information exchange","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IndAbm9jb2RiLmNvbSIsImZpcnN0bmFtZSI6bnVsbCwibGFzdG5hbWUiOm51bGwsImlkIjoidXNfYjN4bzJpNDRueDV5OWwiLCJyb2xlcyI6Im9yZy1sZXZlbC1jcmVhdG9yLHN1cGVyIiwidG9rZW5fdmVyc2lvbiI6ImJmMTc3ZGUzYjk3YjAzMjY4YjU0NGZmMjMzNGU5YjFhMGUzYzgxM2NiYzliOTJkYWMwYmM5NTRiNmUzN2ZjMTJjYmFkNDM2NmIwYzExZTdjIiwiaWF0IjoxNjc4MDc4NDMyLCJleHAiOjE2NzgxMTQ0MzJ9.gzwp_svZlbA5PV_eawYV-9UFjZVjniy-tCDce16xrkI"}}},"examples":{"Example 1":{"value":{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IndAbm9jb2RiLmNvbSIsImZpcnN0bmFtZSI6bnVsbCwibGFzdG5hbWUiOm51bGwsImlkIjoidXNfYjN4bzJpNDRueDV5OWwiLCJyb2xlcyI6Im9yZy1sZXZlbC1jcmVhdG9yLHN1cGVyIiwidG9rZW5fdmVyc2lvbiI6ImJmMTc3ZGUzYjk3YjAzMjY4YjU0NGZmMjMzNGU5YjFhMGUzYzgxM2NiYzliOTJkYWMwYmM5NTRiNmUzN2ZjMTJjYmFkNDM2NmIwYzExZTdjIiwiaWF0IjoxNjc4MDc4NDMyLCJleHAiOjE2NzgxMTQ0MzJ9.gzwp_svZlbA5PV_eawYV-9UFjZVjniy-tCDce16xrkI"}}}}}},"400":{"description":"Bad Request","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string"}}},"examples":{"Invalid email":{"value":{"msg":"Invalid email"}},"Invalid invite url":{"value":{"msg":"Invalid invite url"}},"Expired invite url":{"value":{"msg":"Expired invite url, Please contact super admin to get a new invite url"}},"User already exist":{"value":{"msg":"User already exist"}},"Invite only signup":{"value":{"msg":"Not allowed to signup, contact super admin"}}}}}}},"tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignUpReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","password":"password123456789","firstname":"Alice","lastname":"Smith","token":null,"ignore_subscribe":0}}}}}},"description":"Create a new user with provided email and password and first user is marked as super admin. "}},"/api/v1/auth/user/signout":{"post":{"summary":"Signout","operationId":"auth-signout","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","description":"Success Message","example":"Signed out successfully"}}},"examples":{"Example 1":{"value":{"msg":"Signed out successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"description":"Clear refresh token from the database and cookie."},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/auth/user/signin":{"post":{"summary":"Signin","operationId":"auth-signin","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string","description":"The signed JWT token for information exchange","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IndAbm9jb2RiLmNvbSIsImZpcnN0bmFtZSI6bnVsbCwibGFzdG5hbWUiOm51bGwsImlkIjoidXNfYjN4bzJpNDRueDV5OWwiLCJyb2xlcyI6Im9yZy1sZXZlbC1jcmVhdG9yLHN1cGVyIiwidG9rZW5fdmVyc2lvbiI6ImJmMTc3ZGUzYjk3YjAzMjY4YjU0NGZmMjMzNGU5YjFhMGUzYzgxM2NiYzliOTJkYWMwYmM5NTRiNmUzN2ZjMTJjYmFkNDM2NmIwYzExZTdjIiwiaWF0IjoxNjc4MDc4NDMyLCJleHAiOjE2NzgxMTQ0MzJ9.gzwp_svZlbA5PV_eawYV-9UFjZVjniy-tCDce16xrkI"}}},"examples":{"Example 1":{"value":{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IndAbm9jb2RiLmNvbSIsImZpcnN0bmFtZSI6bnVsbCwibGFzdG5hbWUiOm51bGwsImlkIjoidXNfYjN4bzJpNDRueDV5OWwiLCJyb2xlcyI6Im9yZy1sZXZlbC1jcmVhdG9yLHN1cGVyIiwidG9rZW5fdmVyc2lvbiI6ImJmMTc3ZGUzYjk3YjAzMjY4YjU0NGZmMjMzNGU5YjFhMGUzYzgxM2NiYzliOTJkYWMwYmM5NTRiNmUzN2ZjMTJjYmFkNDM2NmIwYzExZTdjIiwiaWF0IjoxNjc4MDc4NDMyLCJleHAiOjE2NzgxMTQ0MzJ9.gzwp_svZlbA5PV_eawYV-9UFjZVjniy-tCDce16xrkI"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SignInReq"},"examples":{"example-1":{"value":{"email":"user@example.com","password":"Password"}}}}}},"description":"Authenticate existing user with their email and password. Successful login will return a JWT access-token. "},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/auth/user/me":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get User Info","operationId":"auth-me","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserInfo"},"examples":{"example-1":{"value":{"id":"us_8kugj628ebjngs","email":"user@example.com","email_verified":true,"firstname":"Alice","lastname":"Smith","roles":"org-level-viewer"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"description":"Returns authenticated user info","parameters":[{"schema":{"$ref":"#/components/schemas/Id"},"in":"query","name":"project_id","description":"Pass project id to get project specific roles along with user info"}]}},"/api/v1/auth/password/forgot":{"post":{"summary":"Forget Password","operationId":"auth-password-forgot","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"q9s5vh2i34x6c"},"example":"Please check your email to reset the password","description":"Success Message"}}},"examples":{"Example 1":{"value":{"msg":"Please check your email to reset the password"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Emails user with a reset url.","tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordForgotReq"},"examples":{"Example 1":{"value":{"email":"user@example.com"}}}}},"description":"Pass registered user email id in request body"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/auth/password/change":{"post":{"summary":"Change Password","operationId":"auth-password-change","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","description":"Success Message"}}},"examples":{"Success response":{"value":{"msg":"Password has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Change password of authenticated user with a new one.","tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordChangeReq"},"examples":{"example-1":{"value":{"currentPassword":"currentPassword","newPassword":"newPassword"}}}}},"description":"Old password need to be passed along with new password for changing password."}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/auth/token/validate/{token}":{"post":{"summary":"Verify Reset Token","operationId":"auth-password-reset-token-validate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"unxdsok22kg1y"},"example":"Token has been validated successfully","description":"Success Message"}}},"examples":{"Example 1":{"value":{"msg":"Token has been validated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Validate password reset url token.","tags":["Auth"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"name":"token","in":"path","required":true,"description":"Reset Token"}]},"/api/v1/auth/email/validate/{token}":{"post":{"summary":"Verify Email","operationId":"auth-email-validate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"u49sbr20s9rgf"},"description":"Success Message","example":"Email has been verified successfully"}}},"examples":{"Example 1":{"value":{"msg":"Email has been verified successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Api for verifying email where token need to be passed which is shared to user email.","tags":["Auth"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"name":"token","in":"path","required":true,"description":"Validation Token"}]},"/api/v1/auth/password/reset/{token}":{"post":{"summary":"Reset Password","operationId":"auth-password-reset","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"2to6ro4121rfx"},"description":"Success Message","example":"Password has been reset successfully"}}},"examples":{"Example 1":{"value":{"msg":"Password has been reset successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Update user password to new by using reset token.","tags":["Auth"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PasswordResetReq"},"examples":{"Example 1":{"value":{"password":"newpassword"}}}}}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"name":"token","in":"path","required":true,"description":"Reset Password Token"}]},"/api/v1/auth/token/refresh":{"post":{"summary":"Refresh Token","operationId":"auth-token-refresh","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string","description":"New access token for user","example":"96751db2d53fb834382b682268874a2ea9ee610e4d904e688d1513f11d3c30d62d36d9e05dec0d63"}}},"examples":{"Example 1":{"value":{"token":"96751db2d53fb834382b682268874a2ea9ee610e4d904e688d1513f11d3c30d62d36d9e05dec0d63"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Regenerate user refresh token","tags":["Auth"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/tokens":{"get":{"summary":"List Organisation API Tokens","operationId":"org-tokens-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenList"},"examples":{"Example 1":{"value":{"list":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all organisation API tokens.  Access with API tokens will be blocked.","tags":["Org Tokens"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Create Organisation API Token","operationId":"org-tokens-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiToken"},"examples":{"Example 1":{"value":{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenReq"},"examples":{"Example 1":{"value":{"description":"This API token is for ABC application"}}}}}},"tags":["Org Tokens"],"description":"Creat an organisation API token. Access with API tokens will be blocked."}},"/api/v1/tokens/{token}":{"parameters":[{"schema":{"type":"string"},"name":"token","in":"path","required":true,"description":"API Token"}],"delete":{"summary":"Delete Organisation API Tokens","operationId":"org-tokens-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Org Tokens"],"description":"Delete an organisation API token. Access with API tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/license":{"get":{"summary":"Get App License","operationId":"org-license-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"key":{"type":"string","description":"Application license key"}}},"examples":{"Example 1":{"value":{"key":"195f7bcc-c3e1-43c5-b23c-8d8127280e7d"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the application license key. Exclusive for super admin.","tags":["Org License"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Create App License","operationId":"org-license-set","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"wsiywigeb9hjl"},"example":"The license key has been saved"}}},"examples":{"Example 1":{"value":{"msg":"The license key has been saved"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LicenseReq"},"examples":{"Example 1":{"value":{"key":"1234567890"}}}}}},"tags":["Org License"],"description":"Set the application license key. Exclusive for super admin.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/app-settings":{"get":{"summary":"Get App Settings","operationId":"org-app-settings-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"invite_only_signup":{"type":"boolean","description":"Status of invite only signup","example":true}}},"examples":{"Example 1":{"value":{"invite_only_signup":true}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the application settings. Exclusive for super admin.","tags":["Org App Settings"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Create App Settings","operationId":"org-app-settings-set","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"6qbh8ijtc4tva"},"example":"The app settings have been saved"}}},"examples":{"Example 1":{"value":{"msg":"The app settings have been saved"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"invite_only_signup":{"type":"boolean","description":"Status of invite only signup","example":true}}},"examples":{"Example 1":{"value":{"invite_only_signup":true}}}}}},"tags":["Org App Settings"],"description":"Update the application settings. Exclusive for super admin.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/users":{"get":{"summary":"List Organisation Users","operationId":"org-users-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserList"},"examples":{"Example 1":{"value":{"list":[{"email":"user@example.com","email_verified":true,"firstname":"Alice","id":"us_8kugj628ebjngs","lastname":"Smith","roles":"org-level-viewer"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all organisation users. Exclusive for Super Admin. Access with API Tokens will be blocked.","tags":["Org Users"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Create Organisation User","operationId":"org-users-add","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"invite_token":"c22c129f-d947-4030-a838-1b498fce21bb","email":"w123@nocodb.com"}},"properties":{"invite_token":{"type":"string","description":"Invite Token"},"email":{"type":"string","description":"User email","example":"user@example.com"}}},"examples":{"Example 1":{"value":{"invite_token":"c22c129f-d947-4030-a838-1b498fce21bb","email":"user@example.com"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrgUserReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","roles":"org-level-creator"}}}}}},"tags":["Org Users"],"description":"Create an organisation user. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/users/{userId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"patch":{"summary":"Update Organisation User","operationId":"org-users-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"6oa45bkw7j57j"},"example":"The user has been updated successfully"}}},"examples":{"Example 1":{"value":{"msg":"The user has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Org Users"],"description":"Update an organisation user by User ID. Exclusive for Super Admin. Access with API Tokens will be blocked.","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/OrgUserReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","roles":"org-level-creator"}}}}},"description":""}},"delete":{"summary":"Delete Organisation User","operationId":"org-users-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"buvrqjvv255tf"},"example":"The user has been deleted successfully","description":"Sucess Message"}}},"examples":{"Example 1":{"value":{"msg":"The user has been deleted successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Org Users"],"description":"Delete an organisation user by User ID. Exclusive for Super Admin. Access with API Tokens will be blocked."}},"/api/v1/users/{username}":{"parameters":[{"schema":{"type":"string"},"name":"username","in":"path","required":true}],"get":{"summary":"Organisation User GetByUsername","operationId":"org-users-get-by-username","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}},"tags":["Org users"],"description":"Organisation User GetByUsername"}},"/api/v1/users/{userId}/resend-invite":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"post":{"summary":"Invite Organisation User","operationId":"org-users-resend-invite","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"aixfqd9jfh5pq"},"example":"The invitation has been sent to the target user","description":"Success Message"}}},"examples":{"Example 1":{"value":{"msg":"The invitation has been sent to the target user"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Org Users"],"description":"Resend Invitation to a specific user. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/users/{userId}/profile":{"parameters":[{"schema":{"type":"string"},"name":"userId","in":"path","required":true}],"post":{"summary":"Organisation User Profile - Create","operationId":"org-users-profile-create","responses":{"200":{"description":"OK"}},"tags":["Org users"],"description":"Create Organisation User Profile","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}},"get":{"summary":"Organisation User Profile - Get","operationId":"org-users-profile-get","responses":{"200":{"description":"OK"}},"description":"Get Organisation User Profile","tags":["Org users"]},"patch":{"summary":"","operationId":"org-users-profile-update","responses":{"200":{"description":"OK"}},"description":"Update Organisation User Profile\\n","tags":["Org users"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/User"}}}}}},"/api/v1/users/{userId}/follower":{"parameters":[{"schema":{"type":"string"},"name":"userId","in":"path","required":true}],"post":{"summary":"Organisation User Follower - Create","operationId":"org-users-follower-create","responses":{"200":{"description":"OK"}},"tags":["Org users"],"description":"Create Organisation User Follower Relationship (Follow)","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Follower"}}}}},"get":{"summary":"Organisation User Follower - List","operationId":"org-users-follower-list","responses":{"200":{"description":"OK"}},"description":"List Organisation User Followers","tags":["Org users"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Follower"}}}}},"delete":{"summary":"Organisation User Follower - Delete","operationId":"org-users-follower-delete","responses":{"200":{"description":"OK"}},"tags":["Org users"],"description":"Delete Organisation User Follower Relationship (Unfollow)","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Follower"}}},"description":""}}},"/api/v1/users/{userId}/following":{"parameters":[{"schema":{"type":"string"},"name":"userId","in":"path","required":true}],"get":{"summary":"Organisation User Following - List","operationId":"org-users-following-list","responses":{"200":{"description":"OK"}},"description":"List Organisation User Following","tags":["Org users"]}},"/api/v1/users/{userId}/isFollowing/{followerId}":{"parameters":[{"schema":{"type":"string"},"name":"userId","in":"path","required":true},{"schema":{"type":"string"},"name":"followerId","in":"path","required":true}],"get":{"summary":"Organisation User IsFollowing","operationId":"org-users-is-following","responses":{"200":{"description":"OK"}},"description":"Check if Organisation User is following someone","tags":["Org users"]}},"/api/v1/users/{userId}/generate-reset-url":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"post":{"summary":"Generate Organisation User Password Reset Token","operationId":"org-users-generate-password-reset-token","tags":["Org Users"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"reset_password_token":{"type":"string","description":"Password Reset Token for the user"},"reset_password_url":{"type":"string","description":"Password Reset URL for the user"}}},"examples":{"Example 1":{"value":{"reset_password_token":"string","reset_password_url":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Generate Password Reset Token for Organisation User. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{projectId}/users":{"get":{"summary":"List Project Users","operationId":"auth-project-user-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"users":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"minItems":1,"items":{"$ref":"#/components/schemas/User"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"]}}},"examples":{"Example 1":{"value":{"users":{"list":[{"email":"user@example.com","email_verified":true,"firstname":"Alice","id":"us_8kugj628ebjngs","lastname":"Smith","roles":"org-level-viewer"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all users in the given project.","tags":["Auth"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"post":{"summary":"Create Project User","operationId":"auth-project-user-add","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"waau9tvy75zsd"},"description":"Success Message for inviting single email","example":"The user has been invited successfully"},"invite_token":{"type":"string","x-stoplight":{"id":"yx0s35u8ds3p7"},"example":"8354ddba-a769-4d64-8397-eccb2e2b3c06"},"error":{"type":"array","x-stoplight":{"id":"yhfi6wzhr6zr1"},"items":{"x-stoplight":{"id":"ce0hlv3d0f96j"},"type":"object","properties":{"email":{"type":"string","x-stoplight":{"id":"dgnh01j4lxvl1"},"example":"w@nocodb.com"},"error":{"type":"string","x-stoplight":{"id":"7dgttqiijg8no"},"example":"<ERROR_MESSAGE>"}}}},"email":{"type":"string","x-stoplight":{"id":"08pqst2q30vot"},"example":"w@nocodb.com"}}},"examples":{"Inviting a user without any errors":{"value":{"msg":"The user has been invited successfully"}},"Inviting a user but invitation email failed to send":{"value":{"invite_token":"8354ddba-a769-4d64-8397-eccb2e2b3c06","email":"w@nocodb.com"}},"Inviting multiple users":{"value":{"invite_token":"8354ddba-a769-4d64-8397-eccb2e2b3c06","error":[{"email":"w@nocodb.com","error":"<ERROR MESSAGE>"}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectUserReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","roles":"owner"}}}}}},"tags":["Auth"],"description":"Create a user and add it to the given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{projectId}/info":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"get":{"summary":"Get Project info","operationId":"project-meta-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"Node":{"type":"string","description":"Node version","example":"v12.16.1"},"Arch":{"type":"string","description":"Architecture type","example":"x64"},"Platform":{"type":"string","description":"Platform type","example":"linux"},"Docker":{"type":"boolean","description":"Is docker","example":false},"Database":{"type":"string","description":"Database type","example":"postgres"},"ProjectOnRootDB":{"type":"boolean","description":"Is project on rootdb","example":false},"RootDB":{"type":"string","description":"Root database type","example":"postgres"},"PackageVersion":{"type":"string","description":"Package version","example":"1.0.0"}}},"examples":{"Example 1":{"value":{"Node":"v12.16.1","Arch":"x64","Platform":"linux","Docker":false,"Database":"postgres","ProjectOnRootDB":false,"RootDB":"postgres","PackageVersion":"1.0.0"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Project"],"description":"Get info such as node version, arch, platform, is docker, rootdb and package version of a given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{projectId}/users/{userId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"patch":{"summary":"Update Project User","operationId":"auth-project-user-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"5a2q8as60daly"},"description":"Success Message","example":"The user has been updated successfully"}}},"examples":{"Example 1":{"value":{"msg":"The user has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectUserReq"},"examples":{"Example 1":{"value":{"email":"user@example.com","roles":"owner"}}}}}},"tags":["Auth"],"description":"Update a given user in a given project. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Project User","operationId":"auth-project-user-remove","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"5h7c9lqh5ynve"},"example":"The user has been updated successfully","description":"Success Message"}}},"examples":{"Example 1":{"value":{"msg":"The user has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"description":"Delete a given user in a given project. Exclusive for Super Admin. Access with API Tokens will be blocked.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{projectId}/visibility-rules":{"get":{"summary":"Get UI ACL","operationId":"project-model-visibility-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{}},"examples":{"Example 1":{"value":[{"ptn":"nc_09gt___Sheet-1","_ptn":"Sheet-1","ptype":"table","tn":"Sheet-1","_tn":"Sheet-1","table_meta":null,"id":"vw_75neroyqdye94k","base_id":"ds_eol59jg2l4zwev","project_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","title":"Sheet-1","type":3,"is_default":true,"show_system_fields":null,"lock_type":"collaborative","uuid":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f","password":null,"show":true,"order":1,"created_at":"2023-03-08T10:44:55.253Z","updated_at":"2023-03-10T07:18:44.908Z","meta":{"allowCSVDownload":true},"view":{"fk_view_id":"vw_75neroyqdye94k","base_id":"ds_eol59jg2l4zwev","project_id":"p_63b4q0qengen1x","uuid":null,"created_at":"2023-03-08T10:44:55.288Z","updated_at":"2023-03-08T10:44:55.288Z","meta":null,"row_height":null},"disabled":{"owner":false,"creator":false,"viewer":false,"editor":false,"commenter":false,"guest":false}}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Hide / show views based on user role","tags":["Project"],"parameters":[{"schema":{"type":"boolean"},"in":"query","name":"includeM2M"},{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"post":{"summary":"Create UI ACL","operationId":"project-model-visibility-set","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"2txh071wsodys"},"example":"UI ACL has been created successfully"}}},"examples":{"Example 1":{"value":{"msg":"UI ACL has been created successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VisibilityRuleReq"}}}},"tags":["Project"],"description":"Hide / show views based on user role","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"List Projects","operationId":"project-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectList"},"examples":{"Example 1":{"value":{"list":[{"bases":[{"alias":"string","config":null,"created_at":"2023-03-01 14:27:36","enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"project_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my project description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-project","updated_at":"2023-03-01 14:27:36"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all project meta data","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Project"]},"post":{"summary":"Create Project","operationId":"project-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Project"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/ProjectReq"},{"type":"object","properties":{"external":{"type":"boolean","default":false,"description":"If true, the project will us an external database else it will use the root database"}}}]},"examples":{"Example 1":{"value":{"bases":[{"alias":"string","config":null,"enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"project_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my project description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-project","external":false}}}}}},"tags":["Project"],"description":"Create a new project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/duplicate/{projectId}/{baseId}":{"post":{"summary":"Duplicate Project Base","operationId":"project-base-duplicate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"id":{"type":"string"},"project_id":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"options":{"type":"object","properties":{"excludeData":{"type":"boolean","required":false},"excludeViews":{"type":"boolean","required":false},"excludeHooks":{"type":"boolean","required":false}}},"project":{"type":"object","required":false}}},"examples":{"Example 1":{"value":{"excludeData":true,"excludeViews":true,"excludeHooks":true}}}}}},"tags":["Project"],"description":"Duplicate a project","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"ds_124hhlkbeasewh","type":"string"},"name":"baseId","in":"path","required":false,"description":"Unique Base ID"}]}},"/api/v1/db/meta/duplicate/{projectId}":{"post":{"summary":"Duplicate Project","operationId":"project-duplicate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"id":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"options":{"type":"object","properties":{"excludeData":{"type":"boolean","required":false},"excludeViews":{"type":"boolean","required":false},"excludeHooks":{"type":"boolean","required":false}}},"project":{"type":"object","required":false}}},"examples":{"Example 1":{"value":{"excludeData":true,"excludeViews":true,"excludeHooks":true}}}}}},"tags":["Project"],"description":"Duplicate a project","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}]}},"/api/v1/db/meta/projects/{projectId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"get":{"summary":"Get Project","operationId":"project-read","description":"Get the info of a given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Project"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Project"},"examples":{"Example 1":{"value":{"bases":[{"alias":"string","config":null,"enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"project_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my project description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-project"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"delete":{"summary":"Delete Project","operationId":"project-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Project"],"description":"Delete the given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Project","operationId":"project-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Project"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectUpdateReq"},"examples":{"Example 1":{"value":{"color":"#24716E","meta":null,"title":"My Project"}}}}}},"description":"Update the given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{projectId}/user":{"parameters":[{"schema":{"type":"string"},"name":"projectId","in":"path","required":true}],"patch":{"summary":"Project user meta update","operationId":"project-user-meta-update","responses":{"200":{"description":"OK"}},"tags":["Project"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectUserMetaReq"}}}}}},"/api/v1/db/meta/projects/{projectId}/bases/{baseId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"},{"schema":{"type":"string","pattern":"ds_j04jmxh5xg10lu"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"Get Base","operationId":"base-read","description":"Get the base details of a given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Base"},"examples":{"Example 1":{"value":{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"project_id":"p_01clqvzik3izk6","type":"mysql2"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"delete":{"summary":"Delete Base","operationId":"base-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"description":"Delete the base details of a given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Base","operationId":"base-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"Example 1":{"value":{"id":"ds_rrplkgy0pq1f3c","project_id":"p_63b4q0qengen1x","alias":"sakila","meta":null,"is_meta":null,"type":"mysql2","inflection_column":"camelize","inflection_table":"camelize","created_at":"2023-03-11T10:31:15.341Z","updated_at":"2023-03-11T10:32:25.763Z","enabled":true,"order":2}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"alias":"sakila","type":"mysql2","config":{"client":"mysql2","connection":{"host":"localhost","port":"3306","user":"root","password":"password","database":"sakila"}},"inflection_column":"camelize","inflection_table":"camelize"}}}}}},"description":"Update the base details of a given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/:projectId/bases/:baseId/sqlView":{"parameters":[{"schema":{"type":"string"},"name":"projectId","in":"path","required":true},{"schema":{"type":"string"},"name":"baseId","in":"path","required":true}],"post":{"summary":"Create sql view","operationId":"create-sql-view","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"tags":["Base"],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"view_name":{"type":"string"},"view_definition":{"type":"string"}}}}}}}},"/api/v1/db/meta/projects/{projectId}/bases/":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"get":{"summary":"List Bases","operationId":"base-list","description":"Get project base list","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BaseList"},"examples":{"Example 1":{"value":{"list":[{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"project_id":"p_01clqvzik3izk6","type":"mysql2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"post":{"summary":"Create Base","operationId":"base-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Base"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/Base"},{"type":"object","properties":{"external":{"type":"boolean","default":false}}}]},"examples":{"Example 1":{"value":{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"project_id":"p_01clqvzik3izk6","type":"mysql2","external":false}}}}}},"tags":["Base"],"description":"Create a new base on a given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{projectId}/bases/{baseId}/share/erd":{"parameters":[{"schema":{"type":"string"},"name":"projectId","in":"path","required":true},{"schema":{"type":"string"},"name":"baseId","in":"path","required":true}],"post":{"summary":"share ERD view","operationId":"base-share-erd","tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Base"}}}}}},"delete":{"summary":"","operationId":"base-disable-share-erd","responses":{"200":{"description":"OK"}},"tags":["Base"]}},"/api/v1/db/meta/projects/{projectId}/shared":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"get":{"summary":"Get Project Shared Base","operationId":"project-shared-base-get","description":"Get Project Shared Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Project"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"uuid":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"url":{"type":"string","format":"uri"},"roles":{"type":"string","example":"viewer"}}},"examples":{"Example 1":{"value":{"uuid":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11","url":"http://example.com","roles":"viewer"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"delete":{"summary":"Delete Project Shared Base","operationId":"project-shared-base-disable","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Project"],"description":"Delete Project Shared Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create Project Shared Base","operationId":"project-shared-base-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"uuid":{"$ref":"#/components/schemas/StringOrNull"},"roles":{"$ref":"#/components/schemas/StringOrNull"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Project"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedBaseReq"},"examples":{"Example 1":{"value":{"roles":"editor","password":"password123"}}}}}},"description":"Create Project Shared Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Project Shared Base","operationId":"project-shared-base-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"uuid":{"type":"string","format":"uuid","example":"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11"},"url":{"type":"string","format":"uri"},"roles":{"type":"string","example":"viewer"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedBaseReq"},"examples":{"Example 1":{"value":{"password":"password123","roles":"editor"}}}}}},"tags":["Project"],"description":"Update Project Shared Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{projectId}/cost":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"get":{"summary":"Project Cost","operationId":"project-cost","description":"Calculate the Project Cost","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Project"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"x-internal":true}},"/api/v1/db/meta/projects/{projectId}/tables":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"post":{"summary":"Create Table","operationId":"db-table-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Table"},"examples":{"Example 1":{"value":{"base_id":"ds_g4ccx6e77h1dmi","columns":[{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":1,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}],"columnsById":{"cl_c5knoi4xs4sfpt":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_jpl0qu4gj4rexq":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_m4wkaqgqqjzoeh":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_phvuuwjrzcdo0g":{"ai":1,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}},"created_at":"2023-03-02 17:04:06","deleted":null,"enabled":1,"id":"md_rsu68aqjsbyqtl","meta":null,"mm":0,"order":1,"pinned":null,"project_id":"p_xm3thidrblw4n7","schema":null,"table_name":"nc_vm5q___Table1","tags":null,"title":"Table1","type":"table","updated_at":"2023-03-02 17:04:08","views":[{"_ptn":"Table1","_tn":"Table1","base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","disabled":{"commenter":false,"creator":false,"editor":false,"guest":false,"owner":false,"viewer":false},"fk_model_id":"md_rsu68aqjsbyqtl","id":"vw_p2jcatxz4mvcfw","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","ptn":"nc_vm5q___Table1","ptype":"table","show":1,"show_system_fields":null,"table_meta":null,"title":"Table1","tn":"Table1","type":3,"updated_at":"2023-03-02 17:04:06","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","fk_view_id":"vw_p2jcatxz4mvcfw","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:04:06","uuid":null}}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TableReq"}}}},"tags":["DB Table"],"description":"Create a new table in a given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"List Tables","operationId":"db-table-list","responses":{"200":{"$ref":"#/components/responses/TableList"},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"type":"number"},"in":"query","name":"page"},{"schema":{"type":"number"},"in":"query","name":"pageSize"},{"schema":{"type":"string"},"in":"query","name":"sort"},{"schema":{"type":"boolean"},"in":"query","name":"includeM2M"}],"tags":["DB Table"],"description":"List all tables in a given project"}},"/api/v1/db/meta/tables/{tableId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"Read Table","operationId":"db-table-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Table"},"examples":{"Example 1":{"value":{"id":"md_rsu68aqjsbyqtl","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","table_name":"nc_vm5q___Table1","title":"Table1","type":"table","meta":null,"schema":null,"enabled":1,"mm":0,"tags":null,"pinned":null,"deleted":null,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:08","columns":[{"id":"cl_phvuuwjrzcdo0g","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Id","column_name":"id","uidt":"ID","dt":"int","np":"10","ns":"0","clen":null,"cop":"1","pk":1,"pv":null,"rqd":1,"un":1,"ct":"int unsigned","ai":1,"unique":0,"cdf":null,"cc":"","csn":null,"dtx":"specificType","dtxp":"","dtxs":"0","au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},{"id":"cl_c5knoi4xs4sfpt","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Title","column_name":"title","uidt":"SingleLineText","dt":"varchar","np":null,"ns":null,"clen":"45","cop":"2","pk":0,"pv":1,"rqd":0,"un":0,"ct":"varchar(45)","ai":0,"unique":0,"cdf":null,"cc":"","csn":"utf8mb4","dtx":"specificType","dtxp":"45","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":2,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},{"id":"cl_jpl0qu4gj4rexq","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"CreatedAt","column_name":"created_at","uidt":"DateTime","dt":"timestamp","np":null,"ns":null,"clen":null,"cop":"3","pk":0,"pv":null,"rqd":0,"un":0,"ct":"timestamp","ai":0,"unique":0,"cdf":"CURRENT_TIMESTAMP","cc":"","csn":null,"dtx":"specificType","dtxp":"0","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":3,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},{"id":"cl_m4wkaqgqqjzoeh","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"UpdatedAt","column_name":"updated_at","uidt":"DateTime","dt":"timestamp","np":null,"ns":null,"clen":null,"cop":"4","pk":0,"pv":null,"rqd":0,"un":0,"ct":"timestamp","ai":0,"unique":0,"cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","cc":"","csn":null,"dtx":"specificType","dtxp":"0","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":4,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null}],"views":[{"ptn":"nc_vm5q___Table1","_ptn":"Table1","ptype":"table","tn":"Table1","_tn":"Table1","table_meta":null,"id":"vw_p2jcatxz4mvcfw","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Table1","type":3,"is_default":1,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":1,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":{},"view":{"fk_view_id":"vw_p2jcatxz4mvcfw","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","uuid":null,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null,"row_height":null},"disabled":{"owner":false,"creator":false,"viewer":false,"editor":false,"commenter":false,"guest":false}}],"columnsById":{"cl_phvuuwjrzcdo0g":{"id":"cl_phvuuwjrzcdo0g","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Id","column_name":"id","uidt":"ID","dt":"int","np":"10","ns":"0","clen":null,"cop":"1","pk":1,"pv":null,"rqd":1,"un":1,"ct":"int unsigned","ai":1,"unique":0,"cdf":null,"cc":"","csn":null,"dtx":"specificType","dtxp":"","dtxs":"0","au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},"cl_c5knoi4xs4sfpt":{"id":"cl_c5knoi4xs4sfpt","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Title","column_name":"title","uidt":"SingleLineText","dt":"varchar","np":null,"ns":null,"clen":"45","cop":"2","pk":0,"pv":1,"rqd":0,"un":0,"ct":"varchar(45)","ai":0,"unique":0,"cdf":null,"cc":"","csn":"utf8mb4","dtx":"specificType","dtxp":"45","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":2,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},"cl_jpl0qu4gj4rexq":{"id":"cl_jpl0qu4gj4rexq","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"CreatedAt","column_name":"created_at","uidt":"DateTime","dt":"timestamp","np":null,"ns":null,"clen":null,"cop":"3","pk":0,"pv":null,"rqd":0,"un":0,"ct":"timestamp","ai":0,"unique":0,"cdf":"CURRENT_TIMESTAMP","cc":"","csn":null,"dtx":"specificType","dtxp":"0","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":3,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null},"cl_m4wkaqgqqjzoeh":{"id":"cl_m4wkaqgqqjzoeh","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"UpdatedAt","column_name":"updated_at","uidt":"DateTime","dt":"timestamp","np":null,"ns":null,"clen":null,"cop":"4","pk":0,"pv":null,"rqd":0,"un":0,"ct":"timestamp","ai":0,"unique":0,"cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","cc":"","csn":null,"dtx":"specificType","dtxp":"0","dtxs":null,"au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":4,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null}}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table"],"description":"Read the table meta data by the given table ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Table","operationId":"db-table-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"5a0g9yvs4e678"},"example":"The table has been updated successfully"}}},"examples":{"Example 1":{"value":{"msg":"The table has been updated successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table"],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"table_name":{"type":"string","description":"Table name","example":"users"},"title":{"type":"string","description":"Table title","example":"Users"},"project_id":{"type":"string","description":"Project ID","example":"p_124hhlkbeasewh"},"meta":{"$ref":"#/components/schemas/Meta"}}},"examples":{"Example 1":{"value":{"table_name":"users","title":"Users","project_id":"p_124hhlkbeasewh","meta":null}}}}}},"description":"Update the table meta data by the given table ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Table","operationId":"db-table-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table"],"description":"Delete the table meta data by the given table ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/duplicate/{projectId}/table/{tableId}":{"post":{"summary":"Duplicate Table","operationId":"db-table-duplicate","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"id":{"type":"string"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"options":{"type":"object","properties":{"excludeData":{"type":"boolean","required":false},"excludeViews":{"type":"boolean","required":false},"excludeHooks":{"type":"boolean","required":false}}}}},"examples":{"Example 1":{"value":{"excludeData":true,"excludeViews":true}}}}}},"tags":["DB Table"],"description":"Duplicate a table","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"md_124hhlkbeasewh","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}]}},"/api/v1/db/meta/projects/{projectId}/{baseId}/tables":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"},{"schema":{"type":"string","pattern":"ds_j04jmxh5xg10lu"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"get":{"summary":"List Tables","operationId":"table-list","responses":{"200":{"$ref":"#/components/responses/TableList"},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"},{"schema":{"type":"number"},"in":"query","name":"page"},{"schema":{"type":"number"},"in":"query","name":"pageSize"},{"schema":{"type":"string"},"in":"query","name":"sort"},{"schema":{"type":"boolean"},"in":"query","name":"includeM2M"}],"tags":["Base"],"description":"List all tables in a given Project and Base"},"post":{"summary":"Create Table","operationId":"table-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Table"},"examples":{"Example 1":{"value":{"base_id":"ds_g4ccx6e77h1dmi","columns":[{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":1,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}],"columnsById":{"cl_c5knoi4xs4sfpt":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_jpl0qu4gj4rexq":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_m4wkaqgqqjzoeh":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_phvuuwjrzcdo0g":{"ai":1,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}},"created_at":"2023-03-02 17:04:06","deleted":null,"enabled":1,"id":"md_rsu68aqjsbyqtl","meta":null,"mm":0,"order":1,"pinned":null,"project_id":"p_xm3thidrblw4n7","schema":null,"table_name":"nc_vm5q___Table1","tags":null,"title":"Table1","type":"table","updated_at":"2023-03-02 17:04:08","views":[{"_ptn":"Table1","_tn":"Table1","base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","disabled":{"commenter":false,"creator":false,"editor":false,"guest":false,"owner":false,"viewer":false},"fk_model_id":"md_rsu68aqjsbyqtl","id":"vw_p2jcatxz4mvcfw","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","ptn":"nc_vm5q___Table1","ptype":"table","show":1,"show_system_fields":null,"table_meta":null,"title":"Table1","tn":"Table1","type":3,"updated_at":"2023-03-02 17:04:06","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","fk_view_id":"vw_p2jcatxz4mvcfw","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:04:06","uuid":null}}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TableReq"},"examples":{"Example 1":{"value":{"columns":[{"ai":false,"altered":1,"cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","ck":false,"clen":45,"column_name":"updated_at","ct":"varchar(45)","dt":"timestamp","dtx":"specificType","dtxp":"","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"UpdatedAt","uicn":"","uidt":"DateTime","uip":"","un":false},{"ai":false,"altered":1,"cdf":"CURRENT_TIMESTAMP","ck":false,"clen":45,"column_name":"created_at","ct":"varchar(45)","dt":"timestamp","dtx":"specificType","dtxp":"","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"CreatedAt","uicn":"","uidt":"DateTime","uip":"","un":false},{"ai":false,"altered":1,"cdf":null,"ck":false,"clen":45,"column_name":"title","ct":"varchar(45)","dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"Title","uicn":"","uidt":"SingleLineText","uip":"","un":false},{"ai":true,"altered":1,"cdf":null,"ck":false,"clen":null,"column_name":"id","ct":"int(11)","dt":"int","dtx":"integer","dtxp":"11","dtxs":"","np":11,"nrqd":false,"ns":0,"pk":true,"rqd":true,"title":"Id","uicn":"","uidt":"ID","uip":"","un":true}],"table_name":"Sheet-1","title":"Sheet-1"}}}}}},"tags":["Base"],"description":"Create a new table in a given Project and Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/reorder":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Reorder Table","operationId":"db-table-reorder","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"order":{"type":"number"}}},"examples":{"Example 1":{"value":{"order":0}}}}}},"tags":["DB Table"],"description":"Update the order of the given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/columns":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Column","operationId":"db-table-column-create","responses":{"200":{"description":"OK"},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ColumnReq"},"examples":{"Example 1":{"value":{"ai":0,"au":0,"base_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"validate":null,"virtual":null}}}}}},"tags":["DB Table Column"],"description":"Create a new column in a given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/columns/{columnId}":{"parameters":[{"schema":{"type":"string"},"name":"columnId","in":"path","required":true}],"patch":{"summary":"Update Column","operationId":"db-table-column-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Column"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ColumnReq"}}}},"tags":["DB Table Column"],"description":"Update the existing column by the given column ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Column","operationId":"db-table-column-delete","responses":{"200":{"description":"OK"},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Column"],"description":"Delete the existing column by the given column ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Column","operationId":"db-table-column-get","responses":{"200":{"description":"OK"},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Column"],"description":"Get the existing column by the given column ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/columns/{columnId}/primary":{"parameters":[{"schema":{"type":"string"},"name":"columnId","in":"path","required":true}],"post":{"summary":"Create Primary Value","operationId":"db-table-column-primary-column-set","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Column"],"description":"Set a primary value on a given column","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/views":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"List Views","operationId":"db-view-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewList"},"examples":{"Example 1":{"value":{"list":[{"alias":"string","column":[{"alias":"string","auto_increment":true,"auto_update_timestamp":true,"base_id":"string","character_maximum_length":"string","character_set_name":"string","colOptions":{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true},"column_comment":"string","column_default":"string","column_ordinal_position":"string","column_type":"string","data_type":"string","data_type_x":"string","data_type_x_precision":"string","data_type_x_scale":"string","deleted":true,"fk_model_id":"string","id":"string","numeric_precision":"string","numeric_scale":"string","order":0,"primary_key":true,"primary_value":true,"rqd":"string","title":"string","ui_data_type":"string","un":"string","unique":true,"visible":true}],"columnByIds":{},"deleted":true,"enabled":true,"fk_base_id":"string","fk_project_id":"string","id":"string","order":0,"parent_id":"string","pinned":true,"show_as":"string","tags":"string","title":"string","type":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"List all views in a given Table.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"patch":{"summary":"Update View","operationId":"db-view-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":"{\\"allowCSVDownload\\":true}","order":1,"password":"password123","project_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Grid View 1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewUpdateReq"},"examples":{"Example 1":{"value":{"title":"Grid View 1","uuid":"e2457bbf-e29c-4fec-866e-fe3b01dba57f","password":"password123","lock_type":"collaborative","meta":"{\\"allowCSVDownload\\":true}","order":1,"show_system_fields":0}}}}}},"tags":["DB View"],"description":"Update the view with the given view Id.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete View","operationId":"db-view-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Delete the view with the given view Id.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/show-all":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"post":{"summary":"Show All Columns In View","operationId":"db-view-show-all-column","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Show All Columns in a given View","parameters":[{"schema":{"type":"array"},"in":"query","name":"ignoreIds"},{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/hide-all":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"post":{"summary":"Hide All Columns In View","operationId":"db-view-hide-all-column","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"ignoreIds"},{"$ref":"#/components/parameters/xc-auth"}],"description":"Hide All Columns in a given View"}},"/api/v1/db/meta/tables/{tableId}/share":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"List Shared Views","operationId":"db-view-share-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewList"},"examples":{"Example 1":{"value":{"list":[{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"project_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all shared views in a given Table","tags":["DB View Share"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/share":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"post":{"summary":"Create Shared View","operationId":"db-view-share-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewReq"},"examples":{"Example 1":{"value":{"meta":{},"password":"123456789"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Share"],"description":"Create a shared view in a given View..","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Shared View","operationId":"db-view-share-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedView"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewReq"}}},"description":""},"tags":["DB View Share"],"description":"Update a shared view in a given View..","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Shared View","operationId":"db-view-share-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Delete a shared view in a given View.","tags":["DB View Share"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/columns":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"get":{"summary":"List Columns In View","operationId":"db-view-column-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ColumnList"},"examples":{"Example 1":{"value":{"list":[{"ai":0,"au":0,"base_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Column"],"description":"List all columns by ViewID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create Column in View","operationId":"db-view-column-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Column"},"examples":{"Example 1":{"value":{"ai":0,"au":0,"base_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Column"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewColumnReq"},"examples":{"Example 1":{"value":{"fk_column_id":"cl_m4wkaqgqqjzoeh","show":0,"order":1}}}}}},"description":"Create a new column in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/columns/{columnId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}],"patch":{"summary":"Update View Column","operationId":"db-view-column-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Column"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewColumnUpdateReq"},"examples":{"Example 1":{"value":{"show":0,"order":1}}}}}},"description":"Update a column in a View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/sorts":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"get":{"summary":"List View Sorts","operationId":"db-table-sort-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SortList"},"examples":{"Example 1":{"value":{"list":[{"id":"so_xd4t51uv60ghzl","fk_column_id":"cl_l11b769pe2j1ce","fk_model_id":"md_ehn5izr99m7d45","base_id":"ds_3l9qx8xqksenrl","direction":"desc","order":1,"project_id":"p_9sx43moxhqtjm3"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"description":"List all the sort data in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Update View Sort","operationId":"db-table-sort-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"requestBody":{"content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/SortReq"},{"type":"object","properties":{"push_to_top":{"type":"boolean","example":true,"description":"Push the sort to the top of the list"}}}]}}}},"description":"Update the sort data in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/sorts/{sortId}":{"parameters":[{"schema":{"type":"string","example":"so_xd4t51uv60ghzl"},"name":"sortId","in":"path","description":"Unique Sort ID","required":true}],"get":{"summary":"Get Sort","operationId":"db-table-sort-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Sort"},"examples":{"Example 1":{"value":{"id":"so_xd4t51uv60ghzl","fk_column_id":"cl_l11b769pe2j1ce","fk_model_id":"md_ehn5izr99m7d45","base_id":"ds_3l9qx8xqksenrl","direction":"desc","order":1,"project_id":"p_9sx43moxhqtjm3"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"description":"Get the sort data by Sort ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Sort","operationId":"db-table-sort-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SortReq"},"examples":{"Example 1":{"value":{"direction":"asc","fk_column_id":"cl_l11b769pe2j1ce"}}}}}},"description":"Update the sort data by Sort ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Sort","operationId":"db-table-sort-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Sort"],"description":"Delete the sort data by Sort ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/views/{viewId}/filters":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"get":{"summary":"Get View Filter","operationId":"db-table-filter-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterList"},"examples":{"Example 1":{"value":{"list":[{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"description":"Get the filter data in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create View Filter","operationId":"db-table-filter-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Filter"},"examples":{"Example 1":{"value":{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterReq"},"examples":{"Example 1":{"value":{"comparison_op":"eq","comparison_sub_op":null,"fk_column_id":"cl_d7ah9n2qfupgys","is_group":false,"logical_op":"and","value":"foo"}}}}}},"description":"Update the filter data in a given View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/hooks/{hookId}/filters":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"hk_0063k4o1frnxbr"},"name":"hookId","in":"path","required":true,"description":"Unique Hook ID"}],"get":{"summary":"Get Hook Filter","operationId":"db-table-webhook-filter-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterList"},"examples":{"Example 1":{"value":{"list":[{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook Filter"],"description":"Get the filter data in a given Hook","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create Hook Filter","operationId":"db-table-webhook-filter-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Filter"},"examples":{"Example 1":{"value":{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook Filter"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterReq"},"examples":{"Example 1":{"value":{"comparison_op":"eq","comparison_sub_op":null,"fk_column_id":"cl_d7ah9n2qfupgys","is_group":false,"logical_op":"and","value":"foo"}}}}}},"description":"Create filter(s) in a given Hook","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/hooks/{hookId}/logs":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"hk_0063k4o1frnxbr"},"name":"hookId","in":"path","required":true,"description":"Unique Hook ID"}],"get":{"summary":"List Hook Logs","operationId":"db-table-webhook-logs-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookLogList"},"examples":{"Example 1":{"value":{"list":[{"base_id":"ds_jxuewivwbxeum2","event":"after","execution_time":"98","fk_hook_id":"hk_035ijv5qdi97y5","id":"string","notifications":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}}","operation":"insert","payload":"{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}","project_id":"p_tbhl1hnycvhe5l","response":"{\\"status\\":200,\\"statusText\\":\\"OK\\",\\"headers\\":{\\"server\\":\\"nginx\\",\\"content-type\\":\\"text/plain; charset=UTF-8\\",\\"transfer-encoding\\":\\"chunked\\",\\"connection\\":\\"close\\",\\"vary\\":\\"Accept-Encoding\\",\\"x-request-id\\":\\"53844a7d-ede8-4798-adf7-8af441908a72\\",\\"x-token-id\\":\\"6eb45ce5-b611-4be1-8b96-c2965755662b\\",\\"cache-control\\":\\"no-cache, private\\",\\"date\\":\\"Fri, 24 Mar 2023 10:50:10 GMT\\"},\\"config\\":{\\"url\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\",\\"method\\":\\"post\\",\\"data\\":\\"{\\\\\\"type\\\\\\":\\\\\\"records.after.insert\\\\\\",\\\\\\"id\\\\\\":\\\\\\"a77d97dc-a3e4-4719-9b46-45f93e0cc99a\\\\\\",\\\\\\"data\\\\\\":{\\\\\\"table_id\\\\\\":\\\\\\"md_d8v403o74mf5lf\\\\\\",\\\\\\"table_name\\\\\\":\\\\\\"Sheet-2\\\\\\"}}\\",\\"headers\\":{\\"Accept\\":\\"application/json, text/plain, */*\\",\\"Content-Type\\":\\"application/x-www-form-urlencoded\\",\\"User-Agent\\":\\"axios/0.21.4\\",\\"Content-Length\\":138},\\"params\\":{}}}","test_call":0,"triggered_by":"w@nocodb.com","type":"URL"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook Logs"],"description":"List the log data in a given Hook","parameters":[{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/filters/{filterId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","pattern":"fi_pgfuo11uhn2xeo"},"name":"filterId","in":"path","required":true,"description":"Unique Filter ID"}],"get":{"summary":"Get Filter","operationId":"db-table-filter-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Filter"},"examples":{"Example 1":{"value":{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"description":"Get the filter data with a given Filter ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Filter","operationId":"db-table-filter-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterReq"},"examples":{"Example 1":{"value":{"comparison_op":"eq","comparison_sub_op":null,"fk_column_id":"cl_d7ah9n2qfupgys","is_group":false,"logical_op":"and","value":"foo"}}}}}},"description":"Update the filter data with a given Filter ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Filter","operationId":"db-table-filter-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"description":"Delete the filter data with a given Filter ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/filters/{filterGroupId}/children":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"fi_pgfuo11uhn2xeo","description":"Filter Group ID"},"name":"filterGroupId","in":"path","required":true}],"get":{"summary":"Get Filter Group Children","operationId":"db-table-filter-children-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterList"},"examples":{"Example 1":{"value":{"list":[{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Filter"],"description":"Get Filter Group Children of a given group ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/grids":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Grid View","operationId":"db-view-grid-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_o50jiw9v2txktv","base_id":"ds_a95vextjl510z7","project_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Grid-1","type":3,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":2,"created_at":"2023-03-13T07:29:16.610Z","updated_at":"2023-03-13T07:29:16.610Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Grid View","type":3,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null}}}}}},"description":"Create a new grid view in a given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/forms":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Form View","operationId":"db-view-form-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_a830n4bmwk8wlp","base_id":"ds_a95vextjl510z7","project_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Form-1","type":1,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":4,"created_at":"2023-03-13T07:29:19.957Z","updated_at":"2023-03-13T07:29:19.957Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Create a new form view in a given Table","tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Form View","type":1,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null}}}}}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/forms/{formViewId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"vw_6fqln9vdytdv8q"},"name":"formViewId","in":"path","required":true,"description":"Unique Form View ID"}],"patch":{"summary":"Update Form View","operationId":"db-view-form-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FormUpdateReq"},"examples":{"Example 1":{"value":{"banner_image_url":null,"email":"user@example.com","heading":"My Form","lock_type":"collaborative","logo_url":null,"meta":null,"redirect_after_secs":null,"redirect_url":null,"show_blank_form":0,"subheading":"My Form Subheading","submit_another_form":0,"success_msg":"Thank you for the submission.","title":"Form View 1"}}}}}},"description":"Update the form data by Form ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Form","operationId":"db-view-form-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Form"},"examples":{"Example 1":{"value":{"base_id":"ds_g4ccx6e77h1dmi","banner_image_url":null,"columns":[{"id":"fvc_ugj9zo5bzocxtl","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_view_id":"vw_kdf5cr7qmhksek","fk_column_id":"cl_phvuuwjrzcdo0g","uuid":null,"label":null,"help":null,"description":null,"required":null,"show":0,"order":1,"created_at":"2023-03-04 16:40:47","updated_at":"2023-03-04 16:40:47","meta":{}}],"email":"user@example.com","fk_model_id":"md_rsu68aqjsbyqtl","heading":"My Form","lock_type":"collaborative","logo_url":null,"meta":null,"redirect_after_secs":null,"redirect_url":null,"show_blank_form":0,"subheading":"My Form Subheading","submit_another_form":0,"success_msg":"Thank you for the submission.","title":"Form View 1"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the form data by Form ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/form-columns/{formViewColumnId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"fvc_1m9b0aub791d4m","type":"string"},"name":"formViewColumnId","in":"path","required":true,"description":"Unique Form View Column ID"}],"patch":{"summary":"Update Form Column","operationId":"db-view-form-column-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FormColumnReq"},"examples":{"Example 1":{"value":{"description":null,"help":"This is a help text","label":"Form Label","meta":null,"order":1,"required":0,"show":0}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FormColumnReq"}}}},"description":"Update the form column(s) by Form View Column ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/grids/{viewId}":{"parameters":[{"schema":{"type":"string","example":"vw_wtdg2meyig5l4q"},"name":"viewId","in":"path","required":true,"description":"Unique View ID"}],"patch":{"summary":"Update Grid View","operationId":"db-view-grid-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GridUpdateReq"},"examples":{"Example 1":{"value":{"row_height":1,"meta":null}}}}}},"description":"Update Grid View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/grids/{gridId}/grid-columns":{"parameters":[{"schema":{"type":"string","example":"vw_q6k13mmygdi3yz"},"name":"gridId","in":"path","required":true,"description":"Grid View ID"}],"get":{"summary":"List Grid Columns","operationId":"db-view-grid-columns-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/GridColumn"}},"examples":{"Example 1":{"value":[{"id":"nc_c8jz4kxe6xvh11","fk_view_id":"vw_p2jcatxz4mvcfw","fk_column_id":"cl_c5knoi4xs4sfpt","project_id":"p_xm3thidrblw4n7","base_id":"ds_g4ccx6e77h1dmi","show":0,"order":1,"width":"200px","help":null}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"List all columns in the given Grid","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/grid-columns/{columnId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}],"patch":{"summary":"Update Grid Column","operationId":"db-view-grid-column-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GridColumnReq"},"examples":{"Example 1":{"value":{"fk_column_id":"cl_c5knoi4xs4sfpt","label":"My Column","width":"200px"}}}}}},"description":"Update grid column(s) in the given Grid","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/galleries":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Gallery View","operationId":"db-view-gallery-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_qp94qfnvffgk5f","base_id":"ds_a95vextjl510z7","project_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Gallery-1","type":2,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":3,"created_at":"2023-03-13T07:29:18.707Z","updated_at":"2023-03-13T07:29:18.707Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Gallery View","type":2,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null}}}}}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/galleries/{galleryViewId}":{"parameters":[{"schema":{"type":"string","example":"vw_1eq2wk2xe3a9j5"},"name":"galleryViewId","in":"path","required":true,"description":"Unique Gallery View ID"}],"patch":{"summary":"Update Gallery View","operationId":"db-view-gallery-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GalleryUpdateReq"},"examples":{"Example 1":{"value":{"fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","meta":null}}}}}},"description":"Update the Gallery View data with Gallery ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Gallery View","operationId":"db-view-gallery-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Gallery"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the Gallery View data with Gallery ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/kanbans":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Kanban View","operationId":"db-view-kanban-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"id":"vw_569sqsrp2vuff4","base_id":"ds_a95vextjl510z7","project_id":"p_slkm6i3v31q4bc","fk_model_id":"md_8hr3xndx8umuce","title":"Kanban-1","type":4,"is_default":null,"show_system_fields":null,"lock_type":"collaborative","uuid":null,"password":null,"show":true,"order":5,"created_at":"2023-03-13T07:29:21.387Z","updated_at":"2023-03-13T07:29:21.387Z","meta":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Kanban View","type":4,"copy_from_id":null,"fk_grp_col_id":"cl_g0a89q9xdry3lu","fk_geo_data_col_id":null}}}}}},"description":"Create a new Kanban View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/kanbans/{kanbanViewId}":{"parameters":[{"schema":{"type":"string","example":"vw_1eq2wk2xe3a9j5"},"name":"kanbanViewId","in":"path","required":true,"description":"Unique Kanban View ID"}],"patch":{"summary":"Update Kanban View","operationId":"db-view-kanban-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/KanbanUpdateReq"},"examples":{"Example 1":{"value":{"fk_grp_col_id":"cl_g0a89q9xdry3lu","fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","meta":{"cl_g0a89q9xdry3lu":[{"id":"uncategorized","title":null,"order":0,"color":"#c2f5e8","collapsed":false},{"id":"sl_ihyva6jx6dg0fc","fk_column_id":"cl_g0a89q9xdry3lu","title":"a","color":"#cfdffe","order":1,"collapsed":false},{"id":"sl_gqdm5v6t8aetoa","fk_column_id":"cl_g0a89q9xdry3lu","title":"b","color":"#d0f1fd","order":2,"collapsed":false},{"id":"sl_eipnl0kn7a9d3c","fk_column_id":"cl_g0a89q9xdry3lu","title":"cc","color":"#c2f5e8","order":3,"collapsed":false},{"id":"sl_dei8p2jq0cnlv0","fk_column_id":"cl_g0a89q9xdry3lu","title":"d","color":"#ffdaf6","order":4,"collapsed":false}]}}}}}}},"description":"Update the Kanban View data with Kanban ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Kanban View","operationId":"db-view-kanban-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Kanban"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the Kanban View data by Kanban ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/maps":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Create Map View","operationId":"db-view-map-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/View"},"examples":{"Example 1":{"value":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewCreateReq"},"examples":{"Example 1":{"value":{"title":"My Map View","type":5,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":"cl_uu1meolj00tlrq"}}}}},"description":""},"description":"Create a new Map View","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/maps/{mapViewId}":{"parameters":[{"schema":{"type":"string","example":"vw_1eq2wk2xe3a9j5"},"name":"mapViewId","in":"path","required":true,"description":"Unique Map View ID"}],"patch":{"summary":"Update Map View","operationId":"db-view-map-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MapUpdateReq"},"examples":{"Example 1":{"value":{"fk_geo_data_col_id":"cl_8iw2o4ejzvdyna","meta":null}}}}}},"description":"Update the Map View data by Map ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Get Map View","operationId":"db-view-map-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Map"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View"],"description":"Get the Map View data by Map ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/projects/{projectId}/meta-diff":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"post":{"summary":"Sync Meta","operationId":"project-meta-diff-sync","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"la6fd99uw6eao"},"example":"The meta has been synchronized successfully"}}},"examples":{"Example 1":{"value":{"msg":"The meta has been synchronized successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Project"],"description":"Synchronise the meta data difference between NC_DB and external data sources ","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Meta Diff","operationId":"project-meta-diff-get","parameters":[{"$ref":"#/components/parameters/xc-auth"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Project"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"awdkjwr7uultr"},"type":"object","properties":{"table_name":{"type":"string","x-stoplight":{"id":"jjj8ufafq1sd2"},"description":"Table Name","example":"Table 1"},"base_id":{"type":"string","x-stoplight":{"id":"smx2or6bv1xym"},"description":"Base ID","example":"ds_rrplkgy0pq1f3c"},"type":{"type":"string","x-stoplight":{"id":"zr19ahh1s6d13"},"description":"Change Type","example":"table"},"detectedChanges":{"type":"array","x-stoplight":{"id":"bptxla2y27aq6"},"description":"Detected Changes","items":{"x-stoplight":{"id":"ob16o1ln7xy8o"},"type":"object"}}}}},"examples":{"Example 1":{"value":[{"table_name":"_nc_m2m_uuv_xzru3m","base_id":"ds_rrplkgy0pq1f3c","type":"table","detectedChanges":[{"type":"TABLE_NEW","msg":"New table"},{"type":"TABLE_RELATION_ADD","tn":"_nc_m2m_uuv_xzru3m","rtn":"Sheet-1","cn":"table1_id","rcn":"id","msg":"New relation added","relationType":"bt","cstn":"_nc_m2m_uuv_xzru3m_table1_id_foreign"},{"type":"TABLE_RELATION_ADD","tn":"_nc_m2m_uuv_xzru3m","rtn":"address","cn":"table2_id","rcn":"address_id","msg":"New relation added","relationType":"bt","cstn":"_nc_m2m_uuv_xzru3m_table2_id_foreign"}]}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the meta data difference between NC_DB and external data sources "}},"/api/v1/db/meta/projects/{projectId}/meta-diff/{baseId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"},{"schema":{"type":"string","pattern":"ds_j04jmxh5xg10lu"},"name":"baseId","in":"path","required":true,"description":"Unique Base ID"}],"post":{"summary":"Synchronise Base Meta","operationId":"base-meta-diff-sync","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"acy7tx4rounqw"},"example":"The base meta has been synchronized successfully"}}},"examples":{"Example 1":{"value":{"msg":"The base meta has been synchronized successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Base"],"description":"Synchronise the meta data difference between NC_DB and external data sources in a given Base","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"get":{"summary":"Base Meta Diff","operationId":"base-meta-diff-get","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Base"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"pav4jmel1ebeu"},"type":"object","properties":{"table_name":{"type":"string","x-stoplight":{"id":"xjw4k4httzmaf"},"description":"Table Name","example":"Table 1"},"base_id":{"type":"string","x-stoplight":{"id":"l1o3qhkgagsdl"},"example":"ds_rrplkgy0pq1f3c","description":"Base ID"},"type":{"type":"string","x-stoplight":{"id":"v5ciaygrj64uh"},"description":"Change Type","example":"table"},"detectedChanges":{"type":"array","x-stoplight":{"id":"wqn5noi0e46q8"},"description":"Detected Changes","items":{"x-stoplight":{"id":"r2roo274wquvf"},"type":"object"}}}}},"examples":{"Example 1":{"value":[{"table_name":"_nc_m2m_uuv_xzru3m","base_id":"ds_rrplkgy0pq1f3c","type":"table","detectedChanges":[{"type":"TABLE_NEW","msg":"New table"},{"type":"TABLE_RELATION_ADD","tn":"_nc_m2m_uuv_xzru3m","rtn":"Sheet-1","cn":"table1_id","rcn":"id","msg":"New relation added","relationType":"bt","cstn":"_nc_m2m_uuv_xzru3m_table1_id_foreign"},{"type":"TABLE_RELATION_ADD","tn":"_nc_m2m_uuv_xzru3m","rtn":"address","cn":"table2_id","rcn":"address_id","msg":"New relation added","relationType":"bt","cstn":"_nc_m2m_uuv_xzru3m_table2_id_foreign"}]}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the meta data difference between NC_DB and external data sources in a given Base"}},"/api/v1/db/meta/projects/{projectId}/has-empty-or-null-filters":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"get":{"summary":"List Empty & Null Filter","operationId":"project-has-empty-or-null-filters","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Project"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Check if a project contains empty and null filters. Used in `Show NULL and EMPTY in Filter` in Project Setting.","x-internal":true}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"}],"get":{"summary":"List Table Rows","operationId":"db-table-row-list","description":"List all table rows in a given table and project","tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"g92aqxk869a7o"},"description":"List of data objects","items":{"x-stoplight":{"id":"rnbt8ubciknfd"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"7f38yyzdg03x5"},"description":"Paginated Info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"post":{"summary":"Create Table Row","operationId":"db-table-row-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:10:53.567Z","UpdatedAt":"2023-03-11T09:10:53.567Z"}}}}}},"description":"Create a new row in a given table and project.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/find-one":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"}],"get":{"summary":"Find One Table Row","operationId":"db-table-row-find-one","description":"Return the first result of the target Table Row","tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:10:53.567Z","UpdatedAt":"2023-03-11T09:10:53.567Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/groupby":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"in":"query","name":"column_name","description":"Column name of the column you want to group by, eg. `column_name=column1`"}],"get":{"summary":"Group By Table Row","operationId":"db-table-row-group-by","description":"Get the result grouped by the given query","tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}}}}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/views/{viewName}/group/{columnId}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string","example":"p_tbhl1hnycvhe5l"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string","example":"md_5hua2iqloqirhd"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string","example":"vw_mldv0a5mtwh1la"},"name":"viewName","in":"path","required":true,"description":"View Name"},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}],"get":{"summary":"Table Group by Column","operationId":"db-view-row-grouped-data-list","description":"Get the grouped data By Column ID. Used in Kanban View.","tags":["DB View Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{}},"examples":{"Example 1":{"value":[{"key":"a","value":{"list":[{"Id":2,"Title":"foo","SingleSelect":"a"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":"b","value":{"list":[{"Id":3,"Title":"bar","SingleSelect":"b"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":null,"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null},{"Id":5,"Title":"xyz","SingleSelect":null}],"pageInfo":{"totalRows":2,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/group/{columnId}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string","example":"p_tbhl1hnycvhe5l"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string","example":"md_5hua2iqloqirhd"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"}],"get":{"summary":"Table Group by Column","operationId":"db-table-row-grouped-data-list","description":"Get the grouped data By Column ID. Used in Kanban View.","tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{}},"examples":{"Example 1":{"value":[{"key":"a","value":{"list":[{"Id":2,"Title":"foo","SingleSelect":"a"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":"b","value":{"list":[{"Id":3,"Title":"bar","SingleSelect":"b"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":null,"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null},{"Id":5,"Title":"xyz","SingleSelect":null}],"pageInfo":{"totalRows":2,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/views/{viewName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true}],"get":{"summary":"List Table View Rows","operationId":"db-view-row-list","description":"List all table view rows","tags":["DB View Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"schema":{"type":"number"},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"okd8utzm9xqet"},"description":"List of table view rows","items":{"x-stoplight":{"id":"j758lsjv53o4q"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"hylgqzgm8yhye"},"description":"Paginated Info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"baz","SingleSelect":null,"Sheet-1 List":[{"Id":1,"Title":"baz"}],"LTAR":[{"Id":1,"Title":"baz"}]},{"Id":2,"Title":"foo","SingleSelect":"a","Sheet-1 List":[{"Id":2,"Title":"foo"}],"LTAR":[{"Id":2,"Title":"foo"}]},{"Id":3,"Title":"bar","SingleSelect":"b","Sheet-1 List":[],"LTAR":[]}],"pageInfo":{"totalRows":3,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}},"post":{"summary":"Create Table View Row","operationId":"db-view-row-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"col1":"foo","col2":"bar","CreatedAt":"2023-03-11T08:48:25.598Z","UpdatedAt":"2023-03-11T08:48:25.598Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"col1":"foo","col2":"bar"}}}}}},"description":"Create a new row in the given Table View"}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/views/{viewName}/find-one":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true}],"get":{"summary":"Find One Table View Row","operationId":"db-view-row-find-one","description":"Return the first result of table view rows with the given query","tags":["DB View Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields"},{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:10:53.567Z","UpdatedAt":"2023-03-11T09:10:53.567Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/views/{viewName}/groupby":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true},{"schema":{"type":"string"},"in":"query","name":"column_name","description":"Column name of the column you want to group by, eg. `column_name=column1`"}],"get":{"summary":"Group By Table View Row","operationId":"db-view-row-group-by","description":"Get the table view rows grouped by the given query","tags":["DB View Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"sort"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}}}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/views/{viewName}/count":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string","example":"vw_75neroyqdye94k"},"name":"viewName","in":"path","required":true,"description":"View Name"}],"get":{"summary":"Count Table View Rows","operationId":"db-view-row-count","description":"Count how many rows in the given Table View","tags":["DB View Row"],"parameters":[{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{},"in":"query","name":"nested","description":"Query params for nested data"},{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"count":{"type":"number","x-stoplight":{"id":"hwq29x70rcipi"}}}},"examples":{"Example 1":{"value":{"count":25}}}}}}}}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/views/{viewName}/{rowId}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string","example":"vw_75neroyqdye94k"},"name":"viewName","in":"path","required":true,"description":"View Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"get":{"summary":"Get Table View Row","operationId":"db-view-row-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:11:47.437Z","UpdatedAt":"2023-03-11T09:11:47.784Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the target Table View Row","tags":["DB View Row"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Table View Row","operationId":"db-view-row-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"bar","CreatedAt":"2023-03-11T09:11:47.437Z","UpdatedAt":"2023-03-11T09:20:21.133Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Title":"bar"}}}}}},"description":"Update the target Table View Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Table View Row","operationId":"db-view-row-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB View Row"],"description":"Delete the target Table View Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/views/{viewName}/{rowId}/exist":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"get":{"summary":"Does Table View Row Exist","operationId":"db-view-row-exist","responses":{"201":{"description":"Created","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Check row with provided primary key exists or not","tags":["DB View Row"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/{rowId}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"name":"getHiddenColumn","in":"query","description":"To get Hidden Columns","required":false,"schema":{"type":"boolean"}}],"get":{"summary":"Get Table Row","operationId":"db-table-row-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"Example 1":{"value":{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T09:11:47.437Z","UpdatedAt":"2023-03-11T09:11:47.784Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the Table Row by Row ID","tags":["DB Table Row"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Update Table Row","operationId":"db-table-row-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"Title":"bar","CreatedAt":"2023-03-11T09:11:47.437Z","UpdatedAt":"2023-03-11T09:20:21.133Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Title":"bar"}}}}}},"description":"Update the Table Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Table Row","operationId":"db-table-row-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"description":"Delete the Table Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/{rowId}/exist":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"get":{"summary":"Does Table Row Exist","operationId":"db-table-row-exist","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number"},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"check row with provided primary key exists or not","tags":["DB Table Row"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/bulk/{orgs}/{projectName}/{tableName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"}],"post":{"summary":"Bulk Insert Table Rows","operationId":"db-table-row-bulk-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","description":"List of returned IDs","items":{"x-stoplight":{"id":"dbkhyd3mnajax"},"type":"object","properties":{"id":{"type":"string","x-stoplight":{"id":"lnwqjl14f287f"}}}}},"examples":{"Example 1":{"value":[{"id":1},{"id":2}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"array","description":"List of data objects","items":{"x-stoplight":{"id":"7u0mp8nzlvysz"},"type":"object"}},"examples":{"Example 1":{"value":[{"Title":"abc"},{"Title":"def"}]}}}},"description":""},"description":"Bulk insert table rows in one go.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"patch":{"summary":"Bulk Update Table Rows by IDs","operationId":"db-table-row-bulk-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","description":"List of returned values. 1 means successful. 0 means failed.","items":{"x-stoplight":{"id":"ga0xhsahovdt7"},"type":"number"}},"examples":{"Example 1":{"value":[1,1]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"array","description":"List of data objects","items":{"x-stoplight":{"id":"q2xtbf29i1s5n"},"type":"object"}},"examples":{"Example 1":{"value":[{"Id":"1","Title":"123"},{"Id":"2","Title":"456"}]}}}}},"description":"Bulk Update Table Rows by given IDs","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Bulk Delete Table Rows by IDs","operationId":"db-table-row-bulk-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"b9o9o2r6ipho9"},"type":"number"}},"examples":{"Example 1":{"value":[1,1]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"sd8udhhjnqiay"},"type":"object"}},"examples":{"Example 1":{"value":[{"Id":"1"},{"Id":"2"}]}}}},"description":""},"description":"Bulk Delete Table Rows by given IDs","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/bulk/{orgs}/{projectName}/{tableName}/all":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"in":"query","name":"where"},{"schema":{"type":"string"},"in":"query","name":"viewId"}],"patch":{"summary":"Bulk Update Table Rows with Conditions","operationId":"db-table-row-bulk-update-all","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{},"examples":{"Example 1":{"value":[{"Id":"1"},{"Id":"2"}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Title":"foo"}}}}}},"description":"Bulk Update all Table Rows if the condition is true","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Bulk Delete Table Rows with Conditions","operationId":"db-table-row-bulk-delete-all","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"9gcl3ok7is3y0"},"type":"object"}},"examples":{"Example 1":{"value":[1,1]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"requestBody":{"content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Title":"foo"}}}}}},"description":"Bulk Delete all Table Rows if the condition is true","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/views/{viewName}/export/{type}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string"},"name":"viewName","in":"path","required":true},{"schema":{"type":"string","enum":["csv","excel"]},"name":"type","in":"path","required":true}],"get":{"summary":"Export Table View Rows","operationId":"db-view-row-export","description":"Export Table View Rows by CSV or Excel","tags":["DB View Row"],"wrapped":true,"responses":{"200":{"description":"OK","content":{"application/octet-stream":{"schema":{}}},"headers":{"nc-export-offset":{"schema":{"type":"integer"},"description":"The starting offset of the next set of rows"}}},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/export/{type}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"type":"string","enum":["csv","excel"]},"name":"type","in":"path","required":true}],"get":{"summary":"Export Table View Rows","operationId":"db-table-row-csv-export","description":"Export Table View Rows by CSV or Excel","tags":["DB Table Row"],"wrapped":true,"responses":{"200":{"description":"OK","content":{"application/octet-stream":{"schema":{}}},"headers":{"nc-export-offset":{"schema":{"type":"integer"},"description":"The starting offset of the next set of rows"}}},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/{rowId}/{relationType}/{columnName}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string","enum":["mm","hm","bt"]},"name":"relationType","in":"path","required":true,"description":"Relation Type"},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true,"description":"Column Name"}],"get":{"summary":"List Nested Relations Rows","operationId":"db-table-row-nested-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"parameters":[{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"schema":{"type":"string"},"in":"query","name":"where"},{"$ref":"#/components/parameters/xc-auth"}],"description":"List all nested relations rows"}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/{rowId}/{relationType}/{columnName}/{refRowId}":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string","enum":["mm","hm","bt"]},"name":"relationType","in":"path","required":true},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true},{"schema":{"type":"string"},"name":"refRowId","in":"path","required":true}],"post":{"summary":"Create Nested Relations Row","operationId":"db-table-row-nested-add","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"m6jox00hxgd6s"},"example":"The relation data has been created successfully"}}},"examples":{"Example 1":{"value":{"msg":"The relation data has been created successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"$ref":"#/components/parameters/xc-auth"}],"description":"Create a new nested relations row"},"delete":{"summary":"Delete Nested Relations Row","operationId":"db-table-row-nested-remove","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"vo3x8xf3j2xlb"},"example":"The relation data has been deleted successfully"}}},"examples":{"Example 1":{"value":{"msg":"The relation data has been deleted successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"description":"Delete a new nested relations row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/data/{orgs}/{projectName}/{tableName}/{rowId}/{relationType}/{columnName}/exclude":{"parameters":[{"schema":{"type":"string"},"name":"orgs","in":"path","required":true,"description":"Organisation Name. Currently `noco` will be used."},{"schema":{"type":"string"},"name":"projectName","in":"path","required":true,"description":"Project Name"},{"schema":{"type":"string"},"name":"tableName","in":"path","required":true,"description":"Table Name"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string","enum":["mm","hm","bt"]},"name":"relationType","in":"path","required":true},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true}],"get":{"summary":"Referenced Table Rows Excluding Current Record\'s Children / Parent","operationId":"db-table-row-nested-children-excluded-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Row"],"parameters":[{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"schema":{"type":"string"},"in":"query","name":"where"},{"$ref":"#/components/parameters/xc-auth"}],"description":"Get the table rows but exculding the current record\'s children and parent"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/group/{columnId}":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"$ref":"#/components/schemas/Id","example":"cl_8iw2o4ejzvdyna","type":"string"},"name":"columnId","in":"path","required":true,"description":"Unique Column ID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List Shared View Grouped Data","operationId":"public-grouped-data-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"bldcv1pwuri5s"},"type":"object","properties":{"key":{"type":"string","x-stoplight":{"id":"n0ujmkbyhgsxo"},"description":"The Grouped Key"},"value":{"type":"object","x-stoplight":{"id":"0xsi3jvwn7duo"},"description":"the paginated result of the given key","required":["list","pageInfo"],"properties":{"list":{"type":"array","x-stoplight":{"id":"jw8dmo16txbjv"},"description":"List of the target data","items":{"x-stoplight":{"id":"xcu8vxmf5ygyi"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"1gsbgwi9bg8s5"},"description":"Paginated Info"}}}},"required":["key","value"]}},"examples":{"Example 1":{"value":[{"key":"a","value":{"list":[{"Id":2,"Title":"foo","s":"a"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":"b","value":{"list":[{"Id":3,"Title":"bar","s":"b"}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}},{"key":null,"value":{"list":[{"Id":1,"Title":"baz","s":null}],"pageInfo":{"totalRows":1,"page":1,"pageSize":25,"isFirstPage":true,"isLastPage":true}}}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"}],"description":"List Shared View Grouped Data"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/rows":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List Shared View Rows","operationId":"public-data-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewList"},"examples":{"Example 1":{"value":{"list":[{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"}],"description":"List all shared view rows"},"post":{"summary":"Create Share View Row","operationId":"public-data-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object"},"examples":{"Example 1":{"value":{"Id":1,"col1":"foo","col2":"bar","CreatedAt":"2023-03-11T08:48:25.598Z","UpdatedAt":"2023-03-11T08:48:25.598Z"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"multipart/form-data":{}},"description":""},"tags":["Public"],"parameters":[{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"description":"Create a new row for the target shared view"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/groupby":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List Shared View Rows","operationId":"public-data-group-by","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewList"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"},{"schema":{"type":"string"},"in":"query","name":"column_name","description":"Columns to group by"}],"description":"List all shared view rows grouped by a column"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/rows/{rowId}/{relationType}/{columnName}":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"},{"schema":{"type":"string","enum":["mm","hm","bt"]},"name":"relationType","in":"path","required":true,"description":"Relation Type"},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true,"description":"Column Name"}],"get":{"summary":"List Nested List Data","operationId":"public-data-nested-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"gvblksjzjfyg7"},"description":"List of data objects","items":{"x-stoplight":{"id":"8assgoc1vtcs9"},"type":"object"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"if546w1yuo6fw"},"description":"Paginated info"}},"required":["list","pageInfo"]},"examples":{"Example 1":{"value":{"list":[{"Id":1,"Title":"foo","CreatedAt":"2023-03-11T08:41:41.356Z","UpdatedAt":"2023-03-11T08:41:41.356Z"},{"Id":2,"Title":"bar","CreatedAt":"2023-03-11T08:41:45.330Z","UpdatedAt":"2023-03-11T08:41:45.330Z"},{"Id":3,"Title":"baz","CreatedAt":"2023-03-11T08:48:25.598Z","UpdatedAt":"2023-03-11T08:48:25.598Z"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":1,"sort":"string","totalRows":3}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"}],"description":"List all nested list data in a given shared view"}},"/api/v1/db/public/shared-view/{sharedViewUuid}/rows/export/{type}":{"parameters":[{"schema":{"type":"string","example":"76d44b86-bc65-4500-8956-ab512c80ab25"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string","enum":["csv","excel"],"example":"csv"},"name":"type","in":"path","required":true,"description":"Export Type"}],"get":{"summary":"Export Rows in Share View","operationId":"public-csv-export","description":"Export all rows in Share View in a CSV / Excel Format","wrapped":true,"responses":{"200":{"description":"OK","content":{"application/octet-stream":{"schema":{}}},"headers":{"nc-export-offset":{"schema":{"type":"integer"},"description":"The starting offset of the next set of rows"}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"]}},"/api/v1/db/public/shared-view/{sharedViewUuid}/nested/{columnName}":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"name":"columnName","in":"path","required":true,"description":"Column Name"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"List Nested Data Relation","operationId":"public-data-relation-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"parameters":[{"schema":{"type":"array"},"in":"query","name":"fields","description":"Which fields to be shown"},{"schema":{"oneOf":[{"type":"array","items":{"type":"string"}},{"type":"string"}]},"in":"query","name":"sort","description":"The result will be sorted based on `sort` query"},{"schema":{"type":"string"},"in":"query","name":"where","description":"Extra filtering"},{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset","description":"Offset in rows"},{"schema":{"type":"integer","minimum":1},"in":"query","name":"limit","description":"Limit in rows"},{"schema":{"type":"string"},"in":"query","name":"sortArrJson","description":"Used for multiple sort queries"},{"schema":{"type":"string"},"in":"query","name":"filterArrJson","description":"Used for multiple filter queries"}],"tags":["Public"],"description":"List Nested Data Relation"}},"/api/v1/db/public/shared-base/{sharedBaseUuid}/meta":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedBaseUuid","in":"path","required":true,"description":"Shared Base UUID"}],"get":{"summary":"Get Share Base Meta","operationId":"public-shared-base-get","description":"Get Share Base Meta","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"project_id":{"type":"string","description":"Project ID"}}},"examples":{"Example 1":{"value":{"project_id":"p_63b4q0qengen1x"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"]}},"/api/v1/db/public/shared-view/{sharedViewUuid}/meta":{"parameters":[{"schema":{"type":"string","example":"24a6d0bb-e45d-4b1a-bfef-f492d870de9f"},"name":"sharedViewUuid","in":"path","required":true,"description":"Shared View UUID"},{"schema":{"type":"string"},"in":"header","name":"xc-password","description":"Shared view password"}],"get":{"summary":"Get Share View Meta","operationId":"public-shared-view-meta-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/View"},{"type":"object","properties":{"relatedMetas":{},"client":{"type":"string"},"base_id":{"type":"string"},"columns":{"allOf":[{"anyOf":[{"$ref":"#/components/schemas/GridColumn"},{"$ref":"#/components/schemas/FormColumn"},{"$ref":"#/components/schemas/GalleryColumn"}]},{"$ref":"#/components/schemas/Column"}]},"model":{"$ref":"#/components/schemas/Table"}}},{"type":"object","properties":{"view":{"anyOf":[{"$ref":"#/components/schemas/Form"},{"$ref":"#/components/schemas/Grid"},{"$ref":"#/components/schemas/Gallery"}]}}}]}},"application/xml":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Public"],"description":"Get Share View Meta"}},"/api/v1/db/public/shared-erd/{sharedErdUuid}/meta":{"parameters":[{"schema":{"type":"string"},"name":"sharedErdUuid","in":"path","required":true}],"get":{"summary":"","operationId":"public-shared-erd-meta-get","tags":["Public"],"description":"","parameters":[]}},"/api/v1/db/meta/audits/comments":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"List Comments in Audit","operationId":"utils-comment-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"x-stoplight":{"id":"5zto1xohsngbu"},"type":"array","items":{"$ref":"#/components/schemas/Audit","x-stoplight":{"id":"d22zkup0c0l80"}}}},"required":["list"]},"examples":{"Example 1":{"value":{"list":[{"id":"adt_3sii7erfwrlegb","user":"w@nocodb.com","ip":null,"base_id":null,"project_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","row_id":"1","op_type":"COMMENT","op_sub_type":null,"status":null,"description":"bar","details":null,"created_at":"2023-03-13T09:39:14.225Z","updated_at":"2023-03-13T09:39:14.225Z"},{"id":"adt_fezs668qbxj8gc","user":"w@nocodb.com","ip":null,"base_id":null,"project_id":"p_63b4q0qengen1x","fk_model_id":"md_5mipbdg6ketmv8","row_id":"1","op_type":"COMMENT","op_sub_type":null,"status":null,"description":"foo","details":null,"created_at":"2023-03-13T09:39:13.321Z","updated_at":"2023-03-13T09:39:13.321Z"}]}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all comments","parameters":[{"schema":{"type":"string","example":"10"},"in":"query","name":"row_id","required":true,"description":"Row ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"md_c6csq89tl37jm5"},"in":"query","name":"fk_model_id","required":true,"description":"Foreign Key to Model"},{"schema":{"type":"boolean","example":true},"in":"query","name":"comments_only","description":"Is showing comments only?"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Utils"]},"post":{"summary":"Comment Rows","operationId":"utils-comment-row","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Audit"},"examples":{"Example 1":{"value":{"user":"w@nocodb.com","row_id":"1","fk_model_id":"md_5mipbdg6ketmv8","op_type":"COMMENT","description":"qq","project_id":"p_63b4q0qengen1x","id":"adt_vx58jpp0loo8qy"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommentReq"},"examples":{"Example 1":{"value":{"description":"This is the comment for the row","fk_model_id":"md_ehn5izr99m7d45","row_id":"3"}}}}}},"tags":["Utils"],"description":"Create a new comment in a row. Logged in Audit.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/audits/{auditId}/comment":{"parameters":[{"schema":{"type":"string","example":"adt_zlskd6rlf3liay"},"name":"auditId","in":"path","required":true,"description":"Audit ID"},{"name":"xc-auth","in":"header","required":false,"schema":{"type":"string"},"description":"Auth Token is a JWT Token generated based on the logged-in user. By default, the token is only valid for 10 hours. However, you can change the value by defining it using environment variable NC_JWT_EXPIRES_IN."}],"patch":{"summary":"Update Comment in Audit","operationId":"utils-comment-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}}},"tags":["Utils"],"description":"Update comment in Audit","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CommentUpdateReq"},"examples":{"Example 1":{"value":{"description":"This is the comment for the row"}}}}}}}},"/api/v1/db/meta/audits/comments/count":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Count Comments","operationId":"utils-comment-count","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"array","items":{"x-stoplight":{"id":"ziwcy4va5r1ao"},"type":"object","properties":{"count":{"type":"string","x-stoplight":{"id":"5r91gkxmaiyv4"},"description":"The number of comments","example":"4"},"row_id":{"type":"string","x-stoplight":{"id":"08sgorhq172sm"},"description":"Row ID","example":"1"}},"required":["count","row_id"]}},"examples":{"Example 1":{"value":[{"count":"4","row_id":"1"}]}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Return the number of comments in the given query.","parameters":[{"in":"query","name":"ids","required":true,"description":"Comment IDs"},{"schema":{"$ref":"#/components/schemas/Id"},"in":"query","name":"fk_model_id","required":true,"description":"Foreign Key to Model"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Utils"]}},"/api/v1/db/meta/projects/{projectId}/audits":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}],"get":{"summary":"List Audits in Project","operationId":"project-audit-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"minItems":1,"items":{"$ref":"#/components/schemas/Audit"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"]}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all audit data in the given project","parameters":[{"schema":{"type":"integer","minimum":0},"in":"query","name":"offset"},{"schema":{"type":"integer","maximum":1},"in":"query","name":"limit"},{"schema":{"type":"string"},"in":"query","name":"baseId"},{"$ref":"#/components/parameters/xc-auth"}],"tags":["Project"]}},"/api/v1/db/meta/audits/rows/{rowId}/update":{"parameters":[{"schema":{"example":"1"},"name":"rowId","in":"path","required":true,"description":"Unique Row ID"}],"post":{"summary":"Update Audit Row","operationId":"utils-audit-row-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Audit"},"examples":{"Example 1":{"value":{"user":"w@nocodb.com","row_id":"1","fk_model_id":"md_5mipbdg6ketmv8","op_type":"COMMENT","description":"Table Sheet-1 : field Column A got changed from foo to bar","project_id":"p_63b4q0qengen1x","id":"adt_vx58jpp0loo8qy"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditRowUpdateReq"},"examples":{"Example 1":{"value":{"column_name":"baz","fk_model_id":"md_ehn5izr99m7d45","row_id":"1","prev_value":"foo","value":"bar"}}}}}},"description":"Update Audit Row","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/hooks":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"List Table Hooks","operationId":"db-table-webhook-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookList"},"examples":{"Example 1":{"value":{"list":[{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all hook records in the given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["DB Table Webhook"]},"post":{"summary":"Create Table Hook","operationId":"db-table-webhook-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Hook"},"examples":{"Example 1":{"value":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Create a hook in the given table","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookReq"},"examples":{"Example 1":{"value":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook","condition":false}}}}}},"tags":["DB Table Webhook"]}},"/api/v1/db/meta/tables/{tableId}/hooks/test":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Test Hook","operationId":"db-table-webhook-test","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"l5k90tzuvvv1g"},"example":"The hook has been tested successfully"}}},"examples":{"Example 1":{"value":{"msg":"The hook has been tested successfully"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookTestReq"},"examples":{"Example 1":{"value":{"hook":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"},"payload":{"data":{"Id":1,"Title":"Sample Text","CreatedAt":"2023-03-03T10:03:06.484Z","UpdatedAt":"2023-03-03T10:03:06.484Z","attachment":[{"url":"https://nocodb.com/dummy.png","title":"image.png","mimetype":"image/png","size":0}],"f":"Sample Output"}}}}}}}},"description":"Test the hook in the given Table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/hooks/samplePayload/{operation}/{version}":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"},{"schema":{"type":"string","enum":["insert","update","delete","bulkInsert","bulkUpdate","bulkDelete"]},"name":"operation","in":"path","required":true,"description":"Hook Operation"},{"schema":{"type":"string","enum":["v1","v2"]},"name":"version","in":"path","required":true,"description":"Hook Version"}],"get":{"summary":"Get Sample Hook Payload","operationId":"db-table-webhook-sample-payload-get","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"data":{"type":"object","x-stoplight":{"id":"qifsikf69hqbl"},"description":"Sample Payload Data"}}},"examples":{"Example 1":{"value":{"data":{"Id":1,"Title":"Sample Text","CreatedAt":"2023-03-13T04:59:49.363Z","UpdatedAt":"2023-03-13T04:59:49.363Z"}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Get the sample hook payload","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["DB Table Webhook"]}},"/api/v1/db/meta/hooks/{hookId}":{"parameters":[{"schema":{"type":"string","example":"hk_0063k4o1frnxbr"},"name":"hookId","in":"path","required":true,"description":"Unique Hook ID"}],"patch":{"summary":"Update Hook","operationId":"db-table-webhook-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Hook"},"examples":{"Example 1":{"value":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Hook"},"examples":{"Example 1":{"value":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}}}}}},"description":"Update the exsiting hook by its ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Hook","operationId":"db-table-webhook-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["DB Table Webhook"],"description":"Delete the exsiting hook by its ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/plugins":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"List Plugins","operationId":"plugin-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"minItems":1,"items":{"$ref":"#/components/schemas/Plugin"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all plugins","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Plugin"]}},"/api/v1/db/meta/plugins/webhook":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Webhook List Plugins","operationId":"plugin-webhook-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"list":{"type":"array","uniqueItems":true,"minItems":1,"items":{"$ref":"#/components/schemas/Plugin"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"List all webhook plugins","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Plugin"]}},"/api/v1/db/meta/plugins/{pluginTitle}/status":{"parameters":[{"schema":{"type":"string"},"name":"pluginTitle","in":"path","required":true,"description":"Plugin Title"}],"get":{"summary":"Get Plugin Status","operationId":"plugin-status","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Check plugin is active or not","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Plugin"],"x-internal":false}},"/api/v1/db/meta/plugins/test":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Test Plugin","operationId":"plugin-test","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Test if the plugin is working with the given configurations","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"tags":["Plugin"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PluginTestReq"},"examples":{"Example 1":{"value":{"title":"Plugin Foo","input":"{\\"bucket\\":\\"my-bucket\\",\\"region\\":\\"us-west-004\\",\\"access_key\\":\\"redacted\\",\\"access_secret\\":\\"redacted\\"}","category":"Email"}}}}}}}},"/api/v1/db/meta/plugins/{pluginId}":{"parameters":[{"schema":{"type":"string"},"name":"pluginId","in":"path","required":true,"description":"Plugin ID"}],"patch":{"summary":"Update Plugin","operationId":"plugin-update","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Plugin"],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PluginReq"}}}},"description":"Update the plugin data by ID","parameters":[{"$ref":"#/components/parameters/xc-auth"}],"x-internal":false},"get":{"summary":"Get Plugin","operationId":"plugin-read","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Plugin"}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Plugin"],"description":"Get the plugin data by ID","x-internal":false}},"/api/v1/db/meta/connection/test":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Test DB Connection","operationId":"utils-test-connection","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"number"},"message":{"type":"string"},"data":{"type":"object","x-stoplight":{"id":"6orbk04w97ien"}}}},"examples":{"Example 1":{"value":{"code":0,"message":"","data":{}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"requestBody":{"content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"client":"mysql2","connection":{"host":"localhost","port":"3306","user":"root","password":"password","database":null}}},"properties":{"client":{"description":"DB Type","enum":["mssql","mysql","mysql2","oracledb","pg","snowflake","sqlite3"],"example":"mysql2","type":"string"},"connection":{"type":"object","properties":{"host":{"type":"string"},"port":{"type":"string"},"user":{"type":"string"},"password":{"type":"string"},"database":{"$ref":"#/components/schemas/StringOrNull"}}}}},"examples":{"Example 1":{"value":{"client":"mysql2","connection":{"host":"localhost","port":"3306","user":"root","password":"password","database":null}}}}}}},"description":"Test the DB Connection","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/connection/select":{"parameters":[],"post":{"summary":"","operationId":"utils-select-query","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{}}}}},"tags":["Utils"],"requestBody":{"content":{"application/json":{}}},"description":""}},"/api/v1/url_to_config":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Convert JDBC URL to Config","operationId":"utils-url-to-config","tags":["Utils"],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"url":{"type":"string","x-stoplight":{"id":"fgdbmcjjtkky5"},"description":"JDBC URL","example":"jdbc:mysql://username:password@localhost:3306/sakila"}}},"examples":{"Example 1":{"value":{"url":"jdbc:mysql://username:password@localhost:3306/sakila"}}}}}},"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"client":"mysql2","connection":{"user":"username","password":"password","database":"sakila","host":"localhost","port":"3306"}}},"properties":{"client":{"description":"DB Type","enum":["mssql","mysql","mysql2","oracledb","pg","snowflake","sqlite3"],"example":"mysql2","type":"string"},"connection":{"type":"object","description":"Connection Config","properties":{"user":{"type":"string","description":"DB User"},"password":{"type":"string","description":"DB Password"},"database":{"type":"string","description":"DB Name"},"host":{"type":"string","description":"DB Host"},"port":{"type":"string","description":"DB Host"}}}}},"examples":{"Example 1":{"value":{"client":"mysql2","connection":{"user":"username","password":"password","database":"sakila","host":"localhost","port":"3306"}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Extract XC URL From JDBC and parse to connection config","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/nocodb/info":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get App Info","operationId":"utils-app-info","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"authType":"jwt","projectHasAdmin":true,"firstUser":false,"type":"rest","googleAuthEnabled":false,"githubAuthEnabled":false,"oneClick":false,"connectToExternalDB":true,"version":"0.105.3","defaultLimit":25,"ncMin":false,"teleEnabled":false,"auditEnabled":true,"ncSiteUrl":"http://localhost:8080","ee":false,"ncAttachmentFieldSize":20971520,"ncMaxAttachmentsAllowed":10}},"properties":{"authType":{"type":"string"},"projectHasAdmin":{"type":"boolean"},"firstUser":{"type":"boolean"},"type":{"type":"string"},"googleAuthEnabled":{"type":"boolean"},"githubAuthEnabled":{"type":"boolean"},"oneClick":{"type":"boolean"},"connectToExternalDB":{"type":"boolean"},"version":{"type":"string"},"defaultLimit":{"type":"number"},"ncMin":{"type":"boolean"},"teleEnabled":{"type":"boolean"},"auditEnabled":{"type":"boolean"},"ncSiteUrl":{"type":"string"},"ee":{"type":"boolean"},"ncAttachmentFieldSize":{"type":"number"},"ncMaxAttachmentsAllowed":{"type":"number"},"isCloud":{"type":"boolean","x-stoplight":{"id":"bstdkpky2131f"}},"automationLogLevel":{"type":"string","x-stoplight":{"id":"uc3vaotye2eu8"},"enum":["OFF","ERROR","ALL"],"example":"OFF"}}},"examples":{"Example 1":{"value":{"authType":"jwt","projectHasAdmin":true,"firstUser":false,"type":"rest","googleAuthEnabled":false,"githubAuthEnabled":false,"oneClick":false,"connectToExternalDB":true,"version":"0.105.3","defaultLimit":25,"ncMin":false,"teleEnabled":false,"auditEnabled":true,"ncSiteUrl":"http://localhost:8080","ee":false,"ncAttachmentFieldSize":20971520,"ncMaxAttachmentsAllowed":10,"isCloud":false,"automationLogLevel":"OFF"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"description":"Get the application info such as authType, defaultLimit, version and etc.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/axiosRequestMake":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"post":{"summary":"Axios Request","operationId":"utils-axios-request-make","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Generic Axios Call","requestBody":{"content":{"application/json":{"schema":{"type":"object"}}}},"tags":["Utils"],"x-internal":true,"parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/version":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get App Version","operationId":"utils-app-version","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"currentVersion":"0.105.3","releaseVersion":"0.105.3"}},"properties":{"currentVersion":{"type":"string","description":"Current NocoDB Version","example":"0.104.0"},"releaseVersion":{"type":"string","description":"Latest Release Version","example":"0.105.3"}}},"examples":{"Example 1":{"value":{"currentVersion":"0.104.0","releaseVersion":"0.105.3"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"description":"Get the application version","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/health":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get Application Health Status","operationId":"utils-app-health","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","x-examples":{"Example 1":{"message":"OK","timestamp":1678702175755,"uptime":1618.996877834}},"properties":{"message":{"type":"string","example":"OK"},"timestamp":{"type":"string","example":"1678702175755"},"uptime":{"type":"string","example":"1618.996877834"}}},"examples":{"Example 1":{"value":{"message":"OK","timestamp":1678702175755,"uptime":1618.996877834}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"description":"Get Application Health Status","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/aggregated-meta-info":{"parameters":[{"$ref":"#/components/parameters/xc-auth"}],"get":{"summary":"Get Aggregated Meta Info","operationId":"utils-aggregated-meta-info","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"projectCount":{"type":"integer"},"projects":{"type":"array","items":{"type":"object","properties":{"tableCount":{"type":"object","properties":{"table":{"type":"integer","description":"Table Count"},"view":{"type":"integer","description":"View Count"}}},"external":{"type":"boolean","description":"External Project","default":false},"viewCount":{"type":"object","properties":{"formCount":{"type":"integer","description":"Form Count"},"gridCount":{"type":"integer","description":"Grid Count"},"galleryCount":{"type":"integer","description":"Gallery Count"},"kanbanCount":{"type":"integer","description":"Kanban Count"},"total":{"type":"integer","description":"Total View Count"},"sharedFormCount":{"type":"integer","description":"Shared Form Count"},"sharedGridCount":{"type":"integer","description":"Shared Grid Count"},"sharedGalleryCount":{"type":"integer","description":"Shared Gallery Count"},"sharedKanbanCount":{"type":"integer","description":"Shared Kanban Count"},"sharedTotal":{"type":"integer","description":"Shared Total View Count"},"sharedLockedCount":{"type":"integer","description":"Shared Locked View Count"}}},"webhookCount":{"type":"integer","description":"Webhook Count"},"filterCount":{"type":"integer","description":"Filter Count"},"sortCount":{"type":"integer","description":"Sort Count"},"rowCount":{"type":"array","items":{"type":"object","properties":{"TotalRecords":{"type":"string"}}},"description":"Row Count"},"userCount":{"type":"integer","description":"Total project user Count"}}}},"userCount":{"type":"integer","description":"Total user Count"},"sharedBaseCount":{"type":"integer","description":"Total shared base Count"}},"x-examples":{"Example 1":{"projectCount":1,"projects":[{"tableCount":{"table":3,"view":0},"external":false,"viewCount":{"formCount":0,"gridCount":3,"galleryCount":0,"kanbanCount":0,"total":3,"sharedFormCount":0,"sharedGridCount":0,"sharedGalleryCount":0,"sharedKanbanCount":0,"sharedTotal":0,"sharedLockedCount":0},"webhookCount":0,"filterCount":0,"sortCount":0,"rowCount":[{"TotalRecords":"76"}],"userCount":1}],"userCount":1,"sharedBaseCount":0}}},"examples":{"example-1":{"value":{"projectCount":1,"projects":[{"tableCount":{"table":3,"view":0},"external":false,"viewCount":{"formCount":0,"gridCount":3,"galleryCount":0,"kanbanCount":0,"total":3,"sharedFormCount":0,"sharedGridCount":0,"sharedGalleryCount":0,"sharedKanbanCount":0,"sharedTotal":0,"sharedLockedCount":0},"webhookCount":0,"filterCount":0,"sortCount":0,"rowCount":[{"TotalRecords":"76"}],"userCount":1}],"userCount":1,"sharedBaseCount":0}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Utils"],"description":"Get Aggregated Meta Info such as tableCount, dbViewCount, viewCount and etc.","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/cache":{"get":{"summary":"Get Cache","tags":["Utils"],"responses":{},"operationId":"utils-cache-get","description":"Get All K/V pairs in NocoCache","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"delete":{"summary":"Delete Cache","operationId":"utils-cache-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"boolean"},"examples":{"Example 1":{"value":true}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"description":"Delete All K/V pairs in NocoCache","tags":["Utils"],"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"/api/v1/db/meta/projects/{projectId}/api-tokens":{"get":{"summary":"List API Tokens in Project","tags":["API Token"],"responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenList"},"examples":{"Example 1":{"value":{"list":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"operationId":"api-token-list","description":"List API Tokens in the given project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"post":{"summary":"Create API Token","operationId":"api-token-create","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiToken"},"examples":{"Example 1":{"value":{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenReq"},"examples":{"Example 1":{"value":{"description":"This API token is for ABC application"}}}}},"description":""},"tags":["API Token"],"description":"Create API Token in a project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"}]},"/api/v1/db/meta/projects/{projectId}/api-tokens/{token}":{"delete":{"summary":"Delete API Token","operationId":"api-token-delete","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"number","example":1},"examples":{"Example 1":{"value":1}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["API Token"],"description":"Delete the given API Token in project","parameters":[{"$ref":"#/components/parameters/xc-auth"}]},"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"},{"schema":{"type":"string","example":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"},"name":"token","in":"path","required":true,"description":"API Token"}]},"/api/v1/db/storage/upload":{"post":{"summary":"Attachment Upload","operationId":"storage-upload","responses":{},"tags":["Storage"],"requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/AttachmentReq"},"examples":{"Example 1":{"value":{"mimetype":"image/jpeg","path":"download/noco/jango_fett/Table1/attachment/uVbjPVQxC_SSfs8Ctx.jpg","size":13052,"title":"22bc-kavypmq4869759 (1).jpg"}}}}},"description":""},"parameters":[{"schema":{"type":"string","example":"download/noco/jango_fett/Table1/attachment/uVbjPVQxC_SSfs8Ctx.jpg"},"name":"path","in":"query","required":true,"description":"Target File Path"},{"$ref":"#/components/parameters/xc-auth"}],"description":"Upload attachment"}},"/api/v1/db/storage/upload-by-url":{"post":{"summary":"Attachment Upload by URL","operationId":"storage-upload-by-url","responses":{},"tags":["Storage"],"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/AttachmentReq"}},"examples":{}}}},"parameters":[{"schema":{"type":"string","example":"download/noco/jango_fett/Table1/attachment/c7z_UF8sZBgJUxMjpN.jpg"},"name":"path","in":"query","description":"Target File Path","required":true},{"$ref":"#/components/parameters/xc-auth"}],"description":"Upload attachment by URL. Used in Airtable Migration."}},"/api/v1/db/meta/projects/{projectId}/users/{userId}/resend-invite":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"p_124hhlkbeasewh","type":"string"},"name":"projectId","in":"path","required":true,"description":"Unique Project ID"},{"schema":{"$ref":"#/components/schemas/Id","example":"us_b3xo2i44nx5y9l"},"name":"userId","in":"path","required":true,"description":"Unique User ID"}],"post":{"summary":"Resend User Invitation","operationId":"auth-project-user-resend-invite","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"m570oh5j3afjt"},"description":"Success Message","example":"The invitation has been sent to the user"}}},"examples":{"Example 1":{"value":{"msg":"The invitation has been sent to the user"}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"tags":["Auth"],"description":"Resend Invitation to a specific user","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/notifications":{"get":{"summary":"Notification list","operationId":"notification-list","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationList"}}}}},"tags":["Notification"],"description":"List notifications","parameters":[{"schema":{"type":"boolean"},"name":"is_read","in":"query","required":false},{"schema":{"type":"number"},"name":"limit","in":"query","required":false},{"schema":{"type":"number"},"name":"offset","in":"query","required":false}]}},"/api/v1/notifications/{notificationId}":{"patch":{"summary":"Notification update","operationId":"notification-update","responses":{"200":{"description":"OK"}},"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/NotificationUpdate"}}}},"tags":["Notification"],"description":"Notificattion update"},"delete":{"summary":"Delete notification","operationId":"notification-delete","responses":{"200":{"description":"OK"}},"tags":["Notification"],"description":"Delete notification"},"parameters":[{"schema":{"type":"string"},"name":"notificationId","in":"path","required":true}]},"/api/v1/notifications/mark-all-read":{"post":{"summary":"Mark all notifications as read","operationId":"notification-mark-all-as-read","responses":{"200":{"description":"OK"}},"tags":["Notification"],"description":"Mark all notifications as read"}},"/api/v1/db/meta/tables/{tableId}/columns/hash":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"get":{"summary":"Get columns hash for table","operationId":"db-table-column-hash","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"hash":{"type":"string","description":"Columns hash"}}}}}}},"tags":["DB Table Column"],"description":"Get columns hash for table","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}},"/api/v1/db/meta/tables/{tableId}/columns/bulk":{"parameters":[{"schema":{"$ref":"#/components/schemas/Id","example":"md_w9gpnaousnfss1","type":"string"},"name":"tableId","in":"path","required":true,"description":"Unique Table ID"}],"post":{"summary":"Bulk create-update-delete columns","operationId":"db-table-column-bulk","responses":{"200":{"description":"OK","content":{"application/json":{"schema":{"type":"object","properties":{"failedOps":{"type":"array","items":{"schema":{"type":"object","properties":{"op":{"type":"string","enum":["add","update","delete"],"required":true},"column":{"$ref":"#/components/schemas/Column","required":true},"error":{}}}}}}}}}},"400":{"$ref":"#/components/responses/BadRequest"}},"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"hash":{"type":"string","description":"Columns hash"},"ops":{"type":"array","items":{"schema":{"type":"object","properties":{"op":{"type":"string"},"column":{"type":"object"}}}}}}}}}},"tags":["DB Table Column"],"description":"Bulk create-update-delete columns","parameters":[{"$ref":"#/components/parameters/xc-auth"}]}}},"components":{"schemas":{"ApiToken":{"description":"Model for API Token","examples":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"title":"API Token Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique API Token ID"},"fk_user_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to User"},"description":{"type":"string","description":"API Token Description","example":"This API Token is for ABC application"},"token":{"type":"string","description":"API Token","example":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}},"x-stoplight":{"id":"c7i7cfci4kobt"}},"ApiTokenReq":{"description":"Model for API Token Request","examples":[{"description":"This API token is for ABC application"}],"title":"API Token Request Model","type":"object","properties":{"description":{"description":"Description of the API token","maxLength":255,"type":"string","example":"This API Token is for ABC application"}},"x-stoplight":{"id":"53ux6deypkuwb"}},"ApiTokenList":{"description":"Model for API Token List","x-stoplight":{"id":"t24xmch4x2o30"},"examples":[{"list":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"API Token List Model","type":"object","properties":{"list":{"type":"array","example":[{"list":[{"id":"1","fk_user_id":"us_b3xo2i44nx5y9l","description":"This API Token is for ABC application","token":"DYh540o8hbWpUGdarekECKLdN5OhlgCUWutVJYX2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"x-stoplight":{"id":"c7xu43yjgyjww"},"description":"List of api token objects","items":{"$ref":"#/components/schemas/ApiToken","x-stoplight":{"id":"5ih4l0ix2tr5q"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"0w8ktfnx3pusz"},"description":"Model for Paginated"}},"required":["list","pageInfo"]},"Attachment":{"description":"Model for Attachment","examples":[{"data":null,"mimetype":"image/jpeg","path":"download/noco/jango_fett/Table1/attachment/c7z_UF8sZBgJUxMjpN.jpg","size":12345,"title":"kavypmq4869759.jpg"}],"title":"Attachment Model","type":"object","properties":{"data":{"description":"Data for uploading"},"mimetype":{"type":"string","description":"The mimetype of the attachment"},"path":{"type":"string","description":"File Path"},"size":{"type":"number","description":"Attachment Size"},"title":{"type":"string","description":"The title of the attachment. Used in UI."},"url":{"type":"string","description":"Attachment URL"}},"x-stoplight":{"id":"mjewsbpmazrwe"}},"AttachmentReq":{"description":"Model for Attachment Request","type":"object","x-examples":{"Example 1":{"mimetype":"image/jpeg","path":"download/noco/jango_fett/Table1/attachment/uVbjPVQxC_SSfs8Ctx.jpg","size":13052,"title":"22bc-kavypmq4869759 (1).jpg"}},"title":"Attachment Request Model","properties":{"mimetype":{"type":"string","description":"The mimetype of the attachment"},"path":{"type":"string","description":"The file path of the attachment"},"size":{"type":"number","description":"The size of the attachment"},"title":{"type":"string","description":"The title of the attachment used in UI"},"url":{"type":"string","description":"Attachment URL to be uploaded via upload-by-url"}},"x-stoplight":{"id":"6cr1iwhbyxncd"}},"Audit":{"description":"Model for Audit","examples":[{"id":"adt_l5we7pkx70vaao","user":"w@nocodb.com","ip":"::ffff:127.0.0.1","base_id":"ds_3l9qx8xqksenrl","project_id":"p_9sx43moxhqtjm3","fk_model_id":"md_ehn5izr99m7d45","row_id":"rec0Adp9PMG9o7uJy","op_type":"AUTHENTICATION","op_sub_type":"UPDATE","status":"string","description":"Table nc_snms___Table_1 : field Date got changed from  2023-03-12 to ","details":"<span class=\\"\\">Date</span>   : <span class=\\"text-decoration-line-through red px-2 lighten-4 black--text\\">2023-03-12</span>   <span class=\\"black--text green lighten-4 px-2\\"></span>"}],"title":"Audit Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"user":{"type":"string","description":"The user name performing the action","example":"w@nocodb.com"},"ip":{"type":"string","example":"::ffff:127.0.0.1","description":"IP address from the user"},"base_id":{"type":"string","description":"Base ID in where action is performed","example":"ds_3l9qx8xqksenrl"},"project_id":{"type":"string","description":"Project ID in where action is performed","example":"p_9sx43moxhqtjm3"},"fk_model_id":{"type":"string","description":"Model ID in where action is performed","example":"md_ehn5izr99m7d45"},"row_id":{"type":"string","description":"Row ID","example":"rec0Adp9PMG9o7uJy"},"op_type":{"type":"string","description":"Operation Type","example":"AUTHENTICATION","enum":["COMMENT","DATA","PROJECT","VIRTUAL_RELATION","RELATION","TABLE_VIEW","TABLE","VIEW","META","WEBHOOKS","AUTHENTICATION","TABLE_COLUMN","ORG_USER"]},"op_sub_type":{"type":"string","description":"Operation Sub Type","example":"UPDATE","enum":["UPDATE","INSERT","BULK_INSERT","BULK_UPDATE","BULK_DELETE","LINK_RECORD","UNLINK_RECORD","DELETE","CREATE","RENAME","IMPORT_FROM_ZIP","EXPORT_TO_FS","EXPORT_TO_ZIP","SIGNIN","SIGNUP","PASSWORD_RESET","PASSWORD_FORGOT","PASSWORD_CHANGE","EMAIL_VERIFICATION","ROLES_MANAGEMENT","INVITE","RESEND_INVITE"]},"status":{"type":"string","description":"Audit Status"},"description":{"type":"string","description":"Description of the action","example":"Table nc_snms___Table_1 : field Date got changed from  2023-03-12 to "},"details":{"type":"string","description":"Detail","example":"<span class=\\"\\">Date</span>   : <span class=\\"text-decoration-line-through red px-2 lighten-4 black--text\\">2023-03-12</span>   <span class=\\"black--text green lighten-4 px-2\\"></span>"}},"x-stoplight":{"id":"n44nqsmhm56c7"}},"AuditRowUpdateReq":{"description":"Model for Audit Row Update Request","examples":[{"column_name":"baz","fk_model_id":"md_ehn5izr99m7d45","row_id":"rec0Adp9PMG9o7uJy","prev_value":"foo","value":"bar"}],"title":"Audit Row Update Request Model","type":"object","properties":{"column_name":{"type":"string","description":"Column Name","example":"baz"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_ehn5izr99m7d45"},"row_id":{"type":"string","example":"rec0Adp9PMG9o7uJy","description":"Row ID"},"prev_value":{"description":"The previous value before the action"},"value":{"description":"The current value after the action"}},"x-stoplight":{"id":"2fzwvc4m1k5or"}},"Base":{"description":"Model for Base","examples":[{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"project_id":"p_01clqvzik3izk6","type":"mysql2"}],"title":"Base Model","type":"object","properties":{"alias":{"$ref":"#/components/schemas/StringOrNull","description":"Base Name - Default BASE will be null by default"},"config":{"description":"Base Configuration"},"enabled":{"$ref":"#/components/schemas/Bool","description":"Is this base enabled"},"id":{"description":"Unique Base ID","type":"string"},"inflection_column":{"description":"Inflection for columns","example":"camelize","type":"string"},"inflection_table":{"description":"Inflection for tables","example":"camelize","type":"string"},"is_meta":{"$ref":"#/components/schemas/Bool","description":"Is the data source connected externally"},"is_local":{"$ref":"#/components/schemas/Bool","description":"Is the data source minimal db"},"order":{"description":"The order of the list of bases","example":1,"type":"number"},"project_id":{"description":"The project ID that this base belongs to","type":"string"},"type":{"description":"DB Type","enum":["mssql","mysql","mysql2","oracledb","pg","snowflake","sqlite3"],"example":"mysql2","type":"string"}},"x-stoplight":{"id":"qyzsky82ovjiv"}},"BaseList":{"description":"Model for Base List","examples":[{"list":[{"alias":null,"config":"<ENCRYPTED>","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"project_id":"p_01clqvzik3izk6","type":"mysql2"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Base List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"sakila","config":"<ENCRYPTED>","created_at":"2023-03-02 11:28:17","enabled":1,"id":"ds_btbdt19zde0gj9","inflection_column":"camelize","inflection_table":"camelize","is_meta":null,"meta":null,"order":2,"project_id":"p_01clqvzik3izk6","type":"mysql2","updated_at":"2023-03-02 11:28:17"},{"alias":null,"config":"<ENCRYPTED>","created_at":"2023-03-01 16:31:49","enabled":1,"id":"ds_krsappzu9f8vmo","inflection_column":"camelize","inflection_table":"camelize","is_meta":1,"meta":null,"order":1,"project_id":"p_01clqvzik3izk6","type":"mysql2","updated_at":"2023-03-02 11:28:17"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":2,"totalRows":2}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"1q3ny60j1g4z2"},"description":"List of base objects","items":{"$ref":"#/components/schemas/Base","x-stoplight":{"id":"udd0nrcv6pq8d"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"xqwcniocq37hk"},"description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"tty21vb01bfr0"}},"BaseReq":{"description":"Model for Base Request","examples":[{"alias":"My Base","config":null,"inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"type":"mysql"}],"properties":{"alias":{"description":"Base Name - Default BASE will be null by default","example":"My Base","maxLength":128,"type":"string"},"config":{"description":"Base Configuration"},"inflection_column":{"description":"Inflection for columns","example":"camelize","type":"string"},"inflection_table":{"description":"Inflection for tables","example":"camelize","type":"string"},"is_meta":{"description":"Is the data source connected externally","type":"boolean"},"is_local":{"description":"Is the data source minimal db","type":"boolean"},"type":{"description":"DB Type","enum":["mssql","mysql","mysql2","oracledb","pg","snowflake","sqlite3"],"type":"string"}},"title":"Base Request","type":"object","x-stoplight":{"id":"ky2ak9xsyl3b5"}},"Bool":{"description":"Model for Bool","examples":[true],"oneOf":[{"description":"0 or 1","example":0,"type":"integer"},{"description":"true or false","type":"boolean"},{"type":"null"}],"title":"Bool Model","x-stoplight":{"id":"y0m76u8t9x2tn"}},"Column":{"description":"Model for Column","examples":[{"ai":0,"au":0,"base_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}],"title":"Column Model","type":"object","properties":{"ai":{"$ref":"#/components/schemas/Bool","description":"Is Auto-Increment?"},"au":{"$ref":"#/components/schemas/Bool","description":"Auto Update Timestamp"},"base_id":{"description":"Base ID that this column belongs to","example":"ds_krsappzu9f8vmo","type":"string"},"cc":{"description":"Column Comment","type":"string"},"cdf":{"$ref":"#/components/schemas/StringOrNull","description":"Column Default"},"clen":{"description":"Character Maximum Length","oneOf":[{"type":"integer"},{"type":"null"},{"type":"string"}]},"colOptions":{"anyOf":[{"$ref":"#/components/schemas/Formula"},{"$ref":"#/components/schemas/LinkToAnotherRecord"},{"$ref":"#/components/schemas/Lookup"},{"$ref":"#/components/schemas/Rollup"},{"$ref":"#/components/schemas/SelectOptions"},{"type":"object"}],"description":"Column Options"},"column_name":{"description":"Column Name","example":"title","type":"string"},"cop":{"description":"Column Ordinal Position","type":"string"},"csn":{"$ref":"#/components/schemas/StringOrNull","description":"Character Set Name"},"ct":{"description":"Column Type","example":"varchar(45)","type":"string"},"deleted":{"$ref":"#/components/schemas/Bool","description":"Is Deleted?"},"dt":{"description":"Data Type in DB","example":"varchar","type":"string"},"dtx":{"description":"Data Type X","example":"specificType","type":"string"},"dtxp":{"description":"Data Type X Precision","oneOf":[{"type":"null"},{"type":"number"},{"type":"string"}]},"dtxs":{"description":"Data Type X Scale","oneOf":[{"type":"null"},{"type":"number"},{"type":"string"}]},"fk_model_id":{"description":"Model ID that this column belongs to","example":"md_yvwvbt2i78rgcm","type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info"},"np":{"description":"Numeric Precision","oneOf":[{"type":"integer"},{"type":"null"},{"type":"string"}]},"ns":{"description":"Numeric Scale","oneOf":[{"type":"integer"},{"type":"null"},{"type":"string"}]},"order":{"description":"The order of the list of columns","type":"number"},"pk":{"$ref":"#/components/schemas/Bool","description":"Is Primary Key?"},"pv":{"$ref":"#/components/schemas/Bool","description":"Is Primary Value?"},"rqd":{"$ref":"#/components/schemas/Bool","description":"Is Required?"},"system":{"$ref":"#/components/schemas/Bool","description":"Is System Column?"},"title":{"description":"Column Title","example":"Title","type":"string"},"uidt":{"description":"The data type in UI","example":"SingleLineText","enum":["Attachment","AutoNumber","Barcode","Button","Checkbox","Collaborator","Count","CreateTime","Currency","Date","DateTime","Decimal","Duration","Email","Formula","ForeignKey","GeoData","Geometry","ID","JSON","LastModifiedTime","LongText","LinkToAnotherRecord","Lookup","MultiSelect","Number","Percent","PhoneNumber","Rating","Rollup","SingleLineText","SingleSelect","SpecificDBType","Time","URL","Year","QrCode","Links"],"type":"string"},"un":{"$ref":"#/components/schemas/Bool","description":"Is Unsigned?"},"unique":{"$ref":"#/components/schemas/Bool","description":"Is unique?"},"visible":{"$ref":"#/components/schemas/Bool","description":"Is Visible?"}},"x-stoplight":{"id":"y9jx9r6o6x0h6"}},"ColumnList":{"description":"Model for Column List","examples":[{"list":[{"ai":0,"au":0,"base_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Column List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"c6lpw8px25356"},"description":"List of column objects","items":{"$ref":"#/components/schemas/Column","x-stoplight":{"id":"zbm89i86dr73y"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"ko0s0z13h4hsw"}}},"required":["list","pageInfo"],"x-stoplight":{"id":"rsk9o5cs00wh5"}},"ColumnReq":{"allOf":[{"anyOf":[{"$ref":"#/components/schemas/FormulaColumnReq"},{"$ref":"#/components/schemas/LinkToAnotherColumnReq"},{"$ref":"#/components/schemas/LookupColumnReq"},{"$ref":"#/components/schemas/NormalColumnRequest"},{"$ref":"#/components/schemas/RollupColumnReq"}]},{"properties":{"column_name":{"type":"string"},"column_order":{"description":"Column order in a specific view","properties":{"order":{"type":"number"},"view_id":{"type":"string"}},"type":"object"},"title":{"maxLength":255,"minLength":1,"type":"string"}},"required":["title"]}],"description":"Model for Column Request","examples":[{"ai":0,"au":0,"base_id":"ds_krsappzu9f8vmo","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 13:14:16","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_yvwvbt2i78rgcm","id":"cl_0j9gv0oi8vjy46","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_01clqvzik3izk6","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 13:14:16","validate":null,"virtual":null}],"title":"Column Request Model","type":"object","x-stoplight":{"id":"aipiq4098ocg3"}},"CommentReq":{"description":"Model for Comment Request","examples":[{"description":"This is the comment for the row","fk_model_id":"md_ehn5izr99m7d45","row_id":"3"}],"title":"Comment Request Model","type":"object","properties":{"description":{"type":"string","description":"Description for the target row","example":"This is the comment for the row"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_ehn5izr99m7d45"},"row_id":{"type":"string","description":"Row ID","example":"3"}},"required":["fk_model_id","row_id"],"x-stoplight":{"id":"ohotsd0vq6d8w"}},"CommentUpdateReq":{"description":"Model for Comment Update Request","x-stoplight":{"id":"5shp04hfghm3a"},"examples":[{"description":"This is the comment for the row"}],"title":"Comment Update Request Model","type":"object","properties":{"description":{"type":"string","description":"Description for the target row","example":"This is the comment for the row"}}},"Filter":{"description":"Model for Filter","examples":[{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"properties":{"base_id":{"description":"Unqiue Base ID","readOnly":true,"type":"string"},"children":{"description":"Children filters. Available when the filter is grouped.","items":{"$ref":"#/components/schemas/Filter"},"type":"array"},"comparison_op":{"description":"Comparison Operator","anyOf":[{"enum":["allof","anyof","blank","btw","checked","empty","eq","ge","gt","gte","in","is","isWithin","isnot","le","like","lt","lte","nallof","nanyof","nbtw","neq","nlike","not","notblank","notchecked","notempty","notnull","null"],"type":"string"},{"type":"null"}]},"comparison_sub_op":{"anyOf":[{"enum":["daysAgo","daysFromNow","exactDate","nextMonth","nextNumberOfDays","nextWeek","nextYear","oneMonthAgo","oneMonthFromNow","oneWeekAgo","oneWeekFromNow","pastMonth","pastNumberOfDays","pastWeek","pastYear","today","tomorrow","yesterday"],"type":"string"},{"type":"null"}],"description":"Comparison Sub-Operator"},"fk_column_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Column"},"fk_hook_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Hook"},"fk_model_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Model"},"fk_parent_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to parent group."},"fk_view_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to View"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"is_group":{"description":"Is this filter grouped?","oneOf":[{"type":"boolean"},{"type":"integer"},{"type":"null"}]},"logical_op":{"description":"Logical Operator","enum":["and","not","or"],"type":"string"},"project_id":{"description":"Unique Project ID","readOnly":true,"type":"string"},"value":{"description":"The filter value. Can be NULL for some operators."}},"readOnly":true,"title":"Filter Model","type":"object","x-stoplight":{"id":"txz3lsqh1rbsu"}},"FilterList":{"description":"Model for Filter List","examples":[{"list":[{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Filter List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"22sgv37ve9kxo"},"description":"List of filter objects","items":{"$ref":"#/components/schemas/Filter","x-stoplight":{"id":"ttw5rxhy83k8p"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"7cyrb1770mrzz"}}},"required":["list","pageInfo"],"x-stoplight":{"id":"wbc42cyev1qzt"}},"FilterLogList":{"description":"Model for Filter Log List","x-stoplight":{"id":"jbgae8q40szhc"},"examples":[{"list":[{"base_id":"ds_g4ccx6e77h1dmi","comparison_op":"eq","comparison_sub_op":null,"created_at":"2023-03-02 18:18:05","fk_column_id":"cl_d7ah9n2qfupgys","fk_hook_id":null,"fk_parent_id":null,"fk_view_id":"vw_b739e29vqmrxnf","id":"fi_xn647tpmdq8fu8","is_group":null,"logical_op":"and","order":1,"project_id":"p_xm3thidrblw4n7","updated_at":"2023-03-02 18:18:05","value":"foo"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Filter Log List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"22sgv37ve9kxo"},"description":"List of filter objects","items":{"$ref":"#/components/schemas/Filter","x-stoplight":{"id":"ttw5rxhy83k8p"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"7cyrb1770mrzz"}}},"required":["list","pageInfo"]},"FilterReq":{"description":"Model for Filter Request","examples":[{"comparison_op":"eq","comparison_sub_op":null,"fk_column_id":"cl_d7ah9n2qfupgys","is_group":false,"logical_op":"and","value":"foo"}],"title":"Filter Request Model","type":"object","x-stoplight":{"id":"f95qy45zzlhei"},"properties":{"comparison_op":{"description":"Comparison Operator","anyOf":[{"enum":["allof","anyof","blank","btw","checked","empty","eq","ge","gt","gte","in","is","isWithin","isnot","le","like","lt","lte","nallof","nanyof","nbtw","neq","nlike","not","notblank","notchecked","notempty","notnull","null"],"type":"string"},{"type":"null"}]},"comparison_sub_op":{"anyOf":[{"enum":["daysAgo","daysFromNow","exactDate","nextMonth","nextNumberOfDays","nextWeek","nextYear","oneMonthAgo","oneMonthFromNow","oneWeekAgo","oneWeekFromNow","pastMonth","pastNumberOfDays","pastWeek","pastYear","today","tomorrow","yesterday"],"type":"string"},{"type":"null"}],"description":"Comparison Sub-Operator"},"fk_column_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Column"},"fk_parent_id":{"$ref":"#/components/schemas/StringOrNull","description":"Belong to which filter ID"},"is_group":{"$ref":"#/components/schemas/Bool","description":"Is this filter grouped?"},"logical_op":{"description":"Logical Operator","enum":["and","not","or"],"type":"string"},"value":{"description":"The filter value. Can be NULL for some operators."}},"readOnly":true},"Follower":{"properties":{"fk_follower_id":{"type":"string"}},"title":"Follower","type":"object","x-stoplight":{"id":"a3aza5b3wavkv"}},"Form":{"description":"Model for Form","examples":[{"base_id":"ds_g4ccx6e77h1dmi","banner_image_url":null,"columns":[{"id":"fvc_ugj9zo5bzocxtl","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_view_id":"vw_kdf5cr7qmhksek","fk_column_id":"cl_phvuuwjrzcdo0g","uuid":null,"label":null,"help":null,"description":null,"required":null,"show":0,"order":1,"created_at":"2023-03-04 16:40:47","updated_at":"2023-03-04 16:40:47","meta":{}}],"email":"user@example.com","fk_model_id":"md_rsu68aqjsbyqtl","heading":"My Form","lock_type":"collaborative","logo_url":null,"meta":null,"redirect_after_secs":null,"redirect_url":null,"show_blank_form":0,"subheading":"My Form Subheading","submit_another_form":0,"success_msg":"Thank you for the submission.","title":"Form View 1"}],"title":"Form Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID","x-stoplight":{"id":"z6wjvs00d3qfk"}},"banner_image_url":{"$ref":"#/components/schemas/StringOrNull","description":"Banner Image URL. Not in use currently."},"columns":{"type":"array","description":"Form Columns","items":{"$ref":"#/components/schemas/FormColumn"}},"email":{"$ref":"#/components/schemas/StringOrNull","description":"Email to sned after form is submitted"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_rsu68aqjsbyqtl"},"base_id":{"type":"string","description":"Base ID","example":"md_rsu68aqjsbyqtl","x-stoplight":{"id":"kfz7tve8nzj6f"}},"heading":{"type":"string","description":"The heading of the form","example":"My Form"},"lock_type":{"enum":["collaborative","locked","personal"],"type":"string","description":"Lock Type of this view","example":"collaborative"},"logo_url":{"$ref":"#/components/schemas/StringOrNull","description":"Logo URL. Not in use currently."},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info for this view"},"redirect_after_secs":{"$ref":"#/components/schemas/StringOrNull","description":"The numbers of seconds to redirect after form submission"},"redirect_url":{"$ref":"#/components/schemas/StringOrNull","description":"URL to redirect after submission"},"show_blank_form":{"$ref":"#/components/schemas/Bool","description":"Show `Blank Form` after 5 seconds"},"subheading":{"type":"string","description":"The subheading of the form","example":"My Form Subheading"},"submit_another_form":{"$ref":"#/components/schemas/Bool","description":"Show `Submit Another Form` button"},"success_msg":{"$ref":"#/components/schemas/StringOrNull","description":"Custom message after the form is successfully submitted"},"title":{"type":"string","description":"Form View Title","example":"Form View 1"}},"x-stoplight":{"id":"szw7mwcmvrj90"}},"FormUpdateReq":{"description":"Model for Form Update Request","examples":[{"banner_image_url":null,"email":"user@example.com","heading":"My Form","logo_url":null,"meta":null,"redirect_after_secs":null,"redirect_url":null,"show_blank_form":0,"subheading":"My Form Subheading","submit_another_form":0,"success_msg":"Thank you for the submission."}],"title":"Form Update Request Model","type":"object","properties":{"banner_image_url":{"$ref":"#/components/schemas/StringOrNull","description":"Banner Image URL. Not in use currently."},"email":{"$ref":"#/components/schemas/StringOrNull","description":"Email to sned after form is submitted"},"heading":{"description":"The heading of the form","example":"My Form","maxLength":255,"type":"string"},"logo_url":{"$ref":"#/components/schemas/StringOrNull","description":"Logo URL. Not in use currently."},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info for this view"},"redirect_after_secs":{"$ref":"#/components/schemas/StringOrNull","description":"The numbers of seconds to redirect after form submission"},"redirect_url":{"$ref":"#/components/schemas/StringOrNull","description":"URL to redirect after submission"},"show_blank_form":{"$ref":"#/components/schemas/Bool","description":"Show `Blank Form` after 5 seconds"},"subheading":{"$ref":"#/components/schemas/StringOrNull","description":"The subheading of the form"},"submit_another_form":{"$ref":"#/components/schemas/Bool","description":"Show `Submit Another Form` button"},"success_msg":{"$ref":"#/components/schemas/StringOrNull","description":"Custom message after the form is successfully submitted"}},"x-stoplight":{"id":"gqdmtil2ni0ln"}},"FormColumn":{"description":"Model for Form Column","examples":[{"id":"fvc_1m9b0aub791d4m","description":null,"fk_column_id":"cl_ah9zavkn25ihyd","fk_view_id":"vw_6fqln9vdytdv8q","help":"This is a help text","label":"Form Label","meta":null,"order":1,"required":0,"show":0,"uuid":null}],"title":"Form Column Model","type":"object","x-examples":{"example-1":{"_cn":"first_name","alias":"first_name","created_at":"2022-02-15 12:39:04","description":"dsdsdsdsd","fk_column_id":"cl_yvyhsl9u81tokc","fk_view_id":"vw_s1pf4umdnikoyn","help":null,"id":"fvc_8z1i7t8aswkqxx","label":"dsdsds","order":1,"required":false,"show":1,"enable_scanner":true,"updated_at":"2022-02-15 12:39:16","uuid":null}},"properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"description":{"$ref":"#/components/schemas/StringOrNull","description":"Form Column Description (Not in use)"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_view_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to View"},"help":{"$ref":"#/components/schemas/StringOrNull","description":"Form Column Help Text"},"label":{"$ref":"#/components/schemas/StringOrNull","description":"Form Column Label"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info"},"order":{"type":"number","description":"The order among all the columns in the form","example":1},"required":{"$ref":"#/components/schemas/Bool","description":"Is this form column required in submission?"},"show":{"$ref":"#/components/schemas/Bool","description":"Is this column shown in Form?"},"enable_scanner":{"$ref":"#/components/schemas/Bool","description":"Indicates whether the \'Fill by scan\' button is visible for this column or not.","example":true},"uuid":{"$ref":"#/components/schemas/StringOrNull","description":"Form Column UUID (Not in use)"}},"x-stoplight":{"id":"rs2uh5opf10q6"}},"FormColumnReq":{"description":"Model for Form Column Request","examples":[{"description":null,"help":"This is a help text","label":"Form Label","meta":null,"order":1,"required":0,"show":0}],"title":"Form Column Request Model","type":"object","x-examples":{"example-1":{"_cn":"first_name","alias":"first_name","created_at":"2022-02-15 12:39:04","description":"dsdsdsdsd","fk_column_id":"cl_yvyhsl9u81tokc","fk_view_id":"vw_s1pf4umdnikoyn","help":null,"id":"fvc_8z1i7t8aswkqxx","label":"dsdsds","order":1,"required":false,"show":1,"updated_at":"2022-02-15 12:39:16","uuid":null}},"properties":{"description":{"$ref":"#/components/schemas/StringOrNull","description":"Form Column Description (Not in use)"},"help":{"$ref":"#/components/schemas/StringOrNull","description":"Form Column Help Text"},"label":{"$ref":"#/components/schemas/StringOrNull","description":"Form Column Label"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info"},"order":{"type":"number","description":"The order among all the columns in the form"},"required":{"$ref":"#/components/schemas/Bool","description":"Is this form column required in submission?"},"show":{"$ref":"#/components/schemas/Bool","description":"Is this column shown in Form?"}},"x-stoplight":{"id":"a1vgymjna1ose"}},"Formula":{"description":"Model for Formula","examples":[{"error":"Error Message shows here","fk_column_id":"cl_h2micb4jdnmsh1","formula":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","formula_raw":"CONCAT(\\"FOO\\", {Title})","id":"fm_1lo8wqtvvipdns"}],"title":"Formula Model","type":"object","properties":{"error":{"description":"Error Message","type":"string"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"formula":{"description":"Formula with column ID replaced","example":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","type":"string"},"formula_raw":{"description":"Original Formula inputted in UI","example":"CONCAT(\\"FOO\\", {Title})","type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"}},"x-stoplight":{"id":"syn5ameyiipp7"}},"FormulaColumnReq":{"description":"Model for Formula Column Request","examples":[{"formula":"CONCAT(\\"FOO\\", {{cl_c5knoi4xs4sfpt}})","formula_raw":"CONCAT(\\"FOO\\", {Title})","title":"Formula","uidt":"Formula"}],"title":"Formula Column Request Model","type":"object","properties":{"formula":{"description":"Formula with column ID replaced","type":"string"},"formula_raw":{"description":"Original Formula inputted in UI","type":"string"},"title":{"description":"Formula Title","maxLength":255,"minLength":1,"type":"string"},"uidt":{"description":"UI Data Type","enum":["Formula"],"type":"string"}},"x-stoplight":{"id":"tvczns7x7nj73"}},"Gallery":{"description":"Model for Gallery","examples":[{"alias":"string","columns":[{"fk_col_id":"string","fk_gallery_id":"string","help":"string","id":"string","label":"string"}],"cover_image":"string","cover_image_idx":0,"deleted":true,"fk_cover_image_col_id":"string","fk_model_id":"string","fk_view_id":"string","lock_type":"collaborative","next_enabled":true,"order":0,"prev_enabled":true,"restrict_number":"string","restrict_size":"string","restrict_types":"string","title":"string"}],"properties":{"alias":{"type":"string"},"columns":{"items":{"$ref":"#/components/schemas/GalleryColumn"},"type":"array"},"cover_image":{"type":"string"},"cover_image_idx":{"type":"integer"},"deleted":{"$ref":"#/components/schemas/Bool"},"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Cover Image Column"},"fk_model_id":{"type":"string","description":"Foreign Key to Model"},"fk_view_id":{"type":"string","description":"Foreign Key to View"},"lock_type":{"enum":["collaborative","locked","personal"],"type":"string"},"next_enabled":{"$ref":"#/components/schemas/Bool"},"order":{"type":"number","description":"Order of Gallery"},"prev_enabled":{"$ref":"#/components/schemas/Bool"},"restrict_number":{"type":"string"},"restrict_size":{"type":"string"},"restrict_types":{"type":"string"},"title":{"type":"string"}},"title":"Gallery Model","type":"object","x-stoplight":{"id":"brih3mxjli606"}},"GalleryColumn":{"description":"Model for Gallery Column","examples":[{"fk_col_id":"string","fk_gallery_id":"string","help":"string","id":"string","label":"string"}],"properties":{"fk_col_id":{"type":"string"},"fk_gallery_id":{"type":"string"},"help":{"type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"label":{"type":"string"}},"title":"Gallery Column Model","type":"object","x-stoplight":{"id":"auloy6128iwh9"}},"GalleryUpdateReq":{"description":"Model for Gallery View Update Request","x-stoplight":{"id":"8o7b279bp9wmg"},"examples":[{"fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","meta":null}],"title":"Gallery View Update Request Model","type":"object","properties":{"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"The id of the column that contains the cover image"},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"zhp6jkrr54wuf"},"description":"Meta Info"}}},"GeoLocation":{"description":"Model for Geo Location","examples":[{"latitude":18.52139,"longitude":179.87295}],"properties":{"latitude":{"description":"The latitude of the location","example":18.52139,"exclusiveMaximum":90,"exclusiveMinimum":-90,"format":"double","type":"number"},"longitude":{"description":"The longitude of the location","example":179.87295,"exclusiveMaximum":180,"exclusiveMinimum":-180,"format":"double","type":"number"}},"title":"Geo Location Model","type":"object","x-stoplight":{"id":"jv0zkileq99er"}},"Grid":{"description":"Model for Grid","examples":[{"project_id":"p_xm3thidrblw4n7","base_id":"ds_g4ccx6e77h1dmi","fk_view_id":"vw_p2jcatxz4mvcfw","row_height":1,"meta":null,"columns":[{"id":"cl_phvuuwjrzcdo0g","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Id","column_name":"id","uidt":"ID","dt":"int","np":"10","ns":"0","clen":null,"cop":"1","pk":1,"pv":null,"rqd":1,"un":1,"ct":"int unsigned","ai":1,"unique":0,"cdf":null,"cc":"","csn":null,"dtx":"specificType","dtxp":"","dtxs":"0","au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null}]}],"title":"Grid Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID","x-stoplight":{"id":"e3ti3fc0ocjyu"}},"project_id":{"$ref":"#/components/schemas/Id","description":"Project ID","x-stoplight":{"id":"e3ti3fc0ocjyu"}},"base_id":{"$ref":"#/components/schemas/Id","description":"Base ID","x-stoplight":{"id":"m8v3iyf1tidy9"}},"fk_view_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to View","x-stoplight":{"id":"m8v3iyf1tidy9"}},"row_height":{"type":"number","example":1,"description":"Row Height"},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"n8cud3jyqw5yv"},"description":"Meta info for Grid Model"},"columns":{"type":"array","x-stoplight":{"id":"22y0gipx2jdf8"},"description":"Grid View Columns","items":{"$ref":"#/components/schemas/GridColumn","x-stoplight":{"id":"nmzp6w3o6b24u"}}}},"x-stoplight":{"id":"wlj101286bua3"}},"Grid - copy":{"description":"Model for Grid","x-stoplight":{"id":"9hiq0xt18jao0"},"examples":[{"project_id":"p_xm3thidrblw4n7","base_id":"ds_g4ccx6e77h1dmi","fk_view_id":"vw_p2jcatxz4mvcfw","row_height":1,"meta":null,"columns":[{"id":"cl_phvuuwjrzcdo0g","base_id":"ds_g4ccx6e77h1dmi","project_id":"p_xm3thidrblw4n7","fk_model_id":"md_rsu68aqjsbyqtl","title":"Id","column_name":"id","uidt":"ID","dt":"int","np":"10","ns":"0","clen":null,"cop":"1","pk":1,"pv":null,"rqd":1,"un":1,"ct":"int unsigned","ai":1,"unique":0,"cdf":null,"cc":"","csn":null,"dtx":"specificType","dtxp":"","dtxs":"0","au":0,"validate":null,"virtual":null,"deleted":null,"system":0,"order":1,"created_at":"2023-03-02 17:04:06","updated_at":"2023-03-02 17:04:06","meta":null}]}],"title":"Grid Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID","x-stoplight":{"id":"e3ti3fc0ocjyu"}},"project_id":{"$ref":"#/components/schemas/Id","description":"Project ID","x-stoplight":{"id":"e3ti3fc0ocjyu"}},"base_id":{"$ref":"#/components/schemas/Id","description":"Base ID","x-stoplight":{"id":"m8v3iyf1tidy9"}},"fk_view_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to View","x-stoplight":{"id":"m8v3iyf1tidy9"}},"row_height":{"type":"number","example":1,"description":"Row Height"},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"n8cud3jyqw5yv"},"description":"Meta info for Grid Model"},"columns":{"type":"array","x-stoplight":{"id":"22y0gipx2jdf8"},"description":"Grid View Columns","items":{"$ref":"#/components/schemas/GridColumn","x-stoplight":{"id":"nmzp6w3o6b24u"}}}}},"GridColumn":{"description":"Model for Grid Column","examples":[{"id":"nc_c8jz4kxe6xvh11","fk_view_id":"vw_p2jcatxz4mvcfw","fk_column_id":"cl_c5knoi4xs4sfpt","project_id":"p_xm3thidrblw4n7","base_id":"ds_g4ccx6e77h1dmi","show":0,"order":1,"width":"200px","help":null,"group_by":0,"group_by_order":null,"group_by_sort":null}],"title":"Grid Column Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID","x-stoplight":{"id":"jc14yojp52rqj"}},"fk_view_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to View","x-stoplight":{"id":"vl18dbt5c2r8r"}},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column","x-stoplight":{"id":"2drg88fmodf3v"}},"project_id":{"$ref":"#/components/schemas/Id","description":"Project ID","x-stoplight":{"id":"2drg88fmodf3v"}},"base_id":{"$ref":"#/components/schemas/Id","description":"Base ID","x-stoplight":{"id":"2drg88fmodf3v"}},"show":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"d47eer13oa8yr"}},"order":{"type":"number","x-stoplight":{"id":"d47eer13oa8yr"},"example":1,"description":"Grid Column Order"},"width":{"type":"string","description":"Column Width","example":"200px"},"help":{"$ref":"#/components/schemas/StringOrNull","description":"Column Help Text","x-stoplight":{"id":"azwh6zn37qzkc"}},"group_by":{"$ref":"#/components/schemas/Bool","description":"Group By"},"group_by_order":{"type":"number","description":"Group By Order","example":1},"group_by_sort":{"$ref":"#/components/schemas/StringOrNull","description":"Group By Sort","example":"asc"}},"x-stoplight":{"id":"195gzd7s6p7nv"}},"GridColumnReq":{"description":"Model for Grid Column Request","examples":[{"fk_column_id":"cl_c5knoi4xs4sfpt","label":"My Column","width":"200px"}],"properties":{"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"help":{"maxLength":255,"type":"string"},"label":{"description":"The label of the column","example":"My Column","maxLength":255,"type":"string"},"width":{"description":"The width of the column","example":"200px","maxLength":255,"pattern":"^[0-9]+(px|%)$","type":"string"},"group_by":{"$ref":"#/components/schemas/Bool","description":"Group By"},"group_by_order":{"type":"number","description":"Group By Order","example":1},"group_by_sort":{"$ref":"#/components/schemas/StringOrNull","description":"Group By Sort","example":"asc"}},"title":"Grid Column Request Model","type":"object","x-stoplight":{"id":"9yhalgmix6d0m"}},"GridUpdateReq":{"description":"Model for Grid View Update","x-stoplight":{"id":"v0hz01gynll1t"},"examples":[{"row_height":"1","meta":null}],"title":"Grid View Update Model","type":"object","properties":{"row_height":{"type":"number","x-stoplight":{"id":"m5976ax1q13cr"},"description":"Row Height","example":1},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"dugbkhe9iupqu"},"description":"Meta Info for grid view"}}},"Hook":{"description":"Model for Hook","examples":[{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}],"title":"Hook Model","type":"object","x-stoplight":{"id":"5jvfnece2nu6w"},"properties":{"active":{"$ref":"#/components/schemas/Bool","description":"Is the hook active?"},"async":{"$ref":"#/components/schemas/Bool","description":"Is the hook aysnc?"},"description":{"type":"string","description":"Hook Description","example":"This is my hook description"},"env":{"type":"string","example":"all","description":"Environment for the hook"},"event":{"enum":["after","before"],"type":"string","description":"Event Type for the operation","example":"after"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_rsu68aqjsbyqtl"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"notification":{"description":"Hook Notification including info such as type, payload, method, body, and etc","type":["object","string"]},"operation":{"enum":["insert","update","delete","bulkInsert","bulkUpdate","bulkDelete"],"type":"string","description":"Hook Operation","example":"insert"},"retries":{"type":"number","description":"Retry Count","example":10},"retry_interval":{"type":"number","description":"Retry Interval","example":60000},"timeout":{"type":"number","example":60000,"description":"Timeout"},"title":{"type":"string","description":"Hook Title","example":"My Webhook"},"type":{"type":"string","description":"Hook Type"},"version":{"type":"string","x-stoplight":{"id":"socewqvadj91n"},"example":"v2","description":"Hook Version","enum":["v1","v2"]}}},"HookReq":{"description":"Model for Hook","x-stoplight":{"id":"btj9o665l08xj"},"examples":[{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook","condition":false}],"title":"Hook Request Model","type":"object","properties":{"active":{"$ref":"#/components/schemas/Bool","description":"Is the hook active?"},"async":{"$ref":"#/components/schemas/Bool","description":"Is the hook aysnc?"},"description":{"$ref":"#/components/schemas/StringOrNull","description":"Hook Description"},"env":{"type":"string","example":"all","description":"Environment for the hook"},"event":{"enum":["after","before"],"type":"string","description":"Event Type for the operation","example":"after"},"fk_model_id":{"type":"string","description":"Foreign Key to Model","example":"md_rsu68aqjsbyqtl"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"notification":{"description":"Hook Notification including info such as type, payload, method, body, and etc","type":["object","string"]},"operation":{"enum":["insert","update","delete","bulkInsert","bulkUpdate","bulkDelete"],"type":"string","description":"Hook Operation","example":"insert"},"retries":{"type":"number","description":"Retry Count","example":10},"retry_interval":{"type":"number","description":"Retry Interval","example":60000},"timeout":{"type":"number","example":60000,"description":"Timeout"},"title":{"type":"string","description":"Hook Title","example":"My Webhook"},"type":{"type":["string","null"],"description":"Hook Type"},"condition":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"wwzoum7rrlwun"},"description":"Is this hook assoicated with some filters"}},"required":["event","notification","operation","title"]},"HookList":{"description":"Model for Hook List","examples":[{"list":[{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Hook List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"minItems":1,"type":"array","uniqueItems":true,"description":"List of hook objects","items":{"$ref":"#/components/schemas/Hook"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"],"x-stoplight":{"id":"oza9z6dpygn29"}},"HookLog":{"description":"Model for Hook Log","examples":[{"base_id":"ds_jxuewivwbxeum2","event":"after","execution_time":"98","fk_hook_id":"hk_035ijv5qdi97y5","id":"string","notifications":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}}","operation":"insert","payload":"{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}","project_id":"p_tbhl1hnycvhe5l","response":"{\\"status\\":200,\\"statusText\\":\\"OK\\",\\"headers\\":{\\"server\\":\\"nginx\\",\\"content-type\\":\\"text/plain; charset=UTF-8\\",\\"transfer-encoding\\":\\"chunked\\",\\"connection\\":\\"close\\",\\"vary\\":\\"Accept-Encoding\\",\\"x-request-id\\":\\"53844a7d-ede8-4798-adf7-8af441908a72\\",\\"x-token-id\\":\\"6eb45ce5-b611-4be1-8b96-c2965755662b\\",\\"cache-control\\":\\"no-cache, private\\",\\"date\\":\\"Fri, 24 Mar 2023 10:50:10 GMT\\"},\\"config\\":{\\"url\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\",\\"method\\":\\"post\\",\\"data\\":\\"{\\\\\\"type\\\\\\":\\\\\\"records.after.insert\\\\\\",\\\\\\"id\\\\\\":\\\\\\"a77d97dc-a3e4-4719-9b46-45f93e0cc99a\\\\\\",\\\\\\"data\\\\\\":{\\\\\\"table_id\\\\\\":\\\\\\"md_d8v403o74mf5lf\\\\\\",\\\\\\"table_name\\\\\\":\\\\\\"Sheet-2\\\\\\"}}\\",\\"headers\\":{\\"Accept\\":\\"application/json, text/plain, */*\\",\\"Content-Type\\":\\"application/x-www-form-urlencoded\\",\\"User-Agent\\":\\"axios/0.21.4\\",\\"Content-Length\\":138},\\"params\\":{}}}","test_call":0,"triggered_by":"w@nocodb.com","type":"URL"}],"title":"Hook Log Model","type":"object","x-stoplight":{"id":"alkb2a68ewbpz"},"properties":{"base_id":{"type":"string","description":"Unique Base ID","example":"ds_jxuewivwbxeum2"},"conditions":{"type":"string","description":"Hook Conditions"},"error":{"$ref":"#/components/schemas/StringOrNull","description":"Error"},"error_code":{"$ref":"#/components/schemas/StringOrNull","description":"Error Code"},"error_message":{"$ref":"#/components/schemas/StringOrNull","description":"Error Message"},"event":{"type":"string","description":"Hook Event","example":"after","enum":["after","before"]},"execution_time":{"type":"string","description":"Execution Time in milliseconds","example":"98"},"fk_hook_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Hook"},"id":{"$ref":"#/components/schemas/StringOrNull","description":"Unique ID"},"notifications":{"type":"string","description":"Hook Notification"},"operation":{"type":"string","description":"Hook Operation","enum":["insert","update","delete","bulkInsert","bulkUpdate","bulkDelete"],"example":"insert"},"payload":{"type":"string","description":"Hook Payload","example":"{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"https://webhook.site/6eb45ce5-b611-4be1-8b96-c2965755662b\\"}"},"project_id":{"type":"string","description":"Project ID","example":"p_tbhl1hnycvhe5l"},"response":{"$ref":"#/components/schemas/StringOrNull","description":"Hook Response"},"test_call":{"$ref":"#/components/schemas/Bool","description":"Is this testing hook call?"},"triggered_by":{"$ref":"#/components/schemas/StringOrNull","description":"Who triggered the hook?"},"type":{"type":"string","example":"URL","description":"Hook Type"}}},"HookLogList":{"description":"Model for Hook Log List","x-stoplight":{"id":"ck3ymtqepbl7e"},"examples":[],"title":"Hook Log List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"minItems":1,"type":"array","uniqueItems":true,"description":"List of hook objects","items":{"$ref":"#/components/schemas/HookLog"}},"pageInfo":{"$ref":"#/components/schemas/Paginated"}},"required":["list","pageInfo"]},"HookTestReq":{"description":"Model for Hook Test Request","examples":[{"hook":{"active":0,"async":0,"description":"This is my hook description","env":"all","event":"after","fk_model_id":"md_rsu68aqjsbyqtl","id":"string","notification":"{\\"type\\":\\"URL\\",\\"payload\\":{\\"method\\":\\"POST\\",\\"body\\":\\"{{ json data }}\\",\\"headers\\":[{}],\\"parameters\\":[{}],\\"auth\\":\\"\\",\\"path\\":\\"http://example.com\\"}}","null":null,"operation":"insert","retries":10,"retry_interval":60000,"timeout":60000,"title":"My Webhook"},"payload":{"data":{"Id":1,"Title":"Sample Text","CreatedAt":"2023-03-03T10:03:06.484Z","UpdatedAt":"2023-03-03T10:03:06.484Z","attachment":[{"url":"https://nocodb.com/dummy.png","title":"image.png","mimetype":"image/png","size":0}],"f":"Sample Output"}}}],"title":"Hook Test Request Model","type":"object","properties":{"hook":{"$ref":"#/components/schemas/HookReq"},"payload":{"description":"Payload to be sent"}},"required":["hook","payload"],"x-stoplight":{"id":"fmxwekzyi46za"}},"Id":{"description":"Model for ID","examples":["string"],"maxLength":20,"minLength":0,"title":"ID Model","type":"string","x-stoplight":{"id":"upw7it13u2dkn"}},"Kanban":{"description":"Model for Kanban","examples":[{"id":"vw_wqs4zheuo5lgdy","fk_grp_col_id":"cl_3704cxcbqt7sj7","fk_view_id":"vw_wqs4zheuo5lgdy","fk_cover_image_col_id":null,"columns":[{"id":"kvc_2skkg5mi1eb37f","fk_column_id":"cl_hzos4ghyncqi4k","fk_view_id":"vw_wqs4zheuo5lgdy","base_id":"ds_hd4ojj0xpquaam","project_id":"p_kzfl5lb0t3tcok","title":"string","show":0,"order":"1"}],"meta":null,"title":"My Kanban"}],"title":"Kanban Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_grp_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Grouping Field Column ID"},"fk_view_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"1kgw1w06b97nl"},"description":"View ID"},"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Cover Image Column ID"},"columns":{"type":"array","description":"Kanban Columns","items":{"$ref":"#/components/schemas/KanbanColumn"}},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info for Kanban"},"title":{"type":"string","description":"Kanban Title","example":"My Kanban"}},"x-stoplight":{"id":"gu721t0zw7jqq"}},"KanbanColumn":{"description":"Model for Kanban Column","examples":[{"id":"kvc_2skkg5mi1eb37f","fk_column_id":"cl_hzos4ghyncqi4k","fk_view_id":"vw_wqs4zheuo5lgdy","base_id":"ds_hd4ojj0xpquaam","project_id":"p_kzfl5lb0t3tcok","title":"string","show":0,"order":"1"}],"title":"Kanban Column Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_view_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"t1fy4zy561ih8"},"description":"Foreign Key to View"},"base_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Baes ID\\n"},"project_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Project ID"},"title":{"x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Project ID","type":"string"},"show":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"uqq8xmyz97t1u"},"description":"Is this column shown?"},"order":{"type":"number","x-stoplight":{"id":"pbnchzgci5dwa"},"example":1,"description":"Column Order"}},"x-stoplight":{"id":"psbv6c6y9qvbu"}},"KanbanUpdateReq":{"description":"Model for Kanban Update Request","examples":[{"fk_grp_col_id":"cl_g0a89q9xdry3lu","fk_cover_image_col_id":"cl_ib8l4j1kiu1efx","meta":{"cl_g0a89q9xdry3lu":[{"id":"uncategorized","title":null,"order":0,"color":"#c2f5e8","collapsed":false},{"id":"sl_ihyva6jx6dg0fc","fk_column_id":"cl_g0a89q9xdry3lu","title":"a","color":"#cfdffe","order":1,"collapsed":false},{"id":"sl_gqdm5v6t8aetoa","fk_column_id":"cl_g0a89q9xdry3lu","title":"b","color":"#d0f1fd","order":2,"collapsed":false},{"id":"sl_eipnl0kn7a9d3c","fk_column_id":"cl_g0a89q9xdry3lu","title":"cc","color":"#c2f5e8","order":3,"collapsed":false},{"id":"sl_dei8p2jq0cnlv0","fk_column_id":"cl_g0a89q9xdry3lu","title":"d","color":"#ffdaf6","order":4,"collapsed":false}]}}],"title":"Kanban Update Request Model","type":"object","properties":{"fk_grp_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Grouping Field Column"},"fk_cover_image_col_id":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"81wn4hzj76wod"},"description":"Foreign Key to Cover Image Column"},"meta":{"$ref":"#/components/schemas/Meta","x-stoplight":{"id":"stsvdmkli1b0r"},"description":"Meta Info"}},"x-stoplight":{"id":"9zirjgj9k1gqa"}},"LicenseReq":{"description":"Model for Kanban Request","examples":[{"key":"1234567890"}],"properties":{"key":{"description":"The license key","example":"1234567890","maxLength":255,"type":"string"}},"title":"License Key Request Model","type":"object","x-stoplight":{"id":"4vo9hms4s6uie"}},"LinkToAnotherColumnReq":{"description":"Model for LinkToAnotherColumn Request","examples":[{"childId":"string","parentId":"string","title":"string","type":"hm","uidt":"LinkToAnotherRecord","virtual":true}],"properties":{"childId":{"$ref":"#/components/schemas/Id","description":"Foreign Key to chhild column"},"parentId":{"$ref":"#/components/schemas/Id","description":"Foreign Key to parent column"},"title":{"maxLength":255,"minLength":1,"type":"string","description":"The title of the virtual column"},"type":{"enum":["bt","hm","mm"],"type":"string","description":"The type of the relationship"},"uidt":{"enum":["LinkToAnotherRecord","Links"],"type":"string","description":"Abstract type of the relationship"},"virtual":{"$ref":"#/components/schemas/Bool","description":"Is this relationship virtual?"}},"required":["childId","parentId","title","type","uidt"],"title":"LinkToAnotherColumn Request Model","type":"object","x-stoplight":{"id":"ke4urwgcmt83x"}},"LinkToAnotherRecord":{"description":"Model for LinkToAnotherRecord","examples":[{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","fk_related_model_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true}],"properties":{"deleted":{"type":"string"},"dr":{"type":"string"},"fk_child_column_id":{"type":"string"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_index_name":{"type":"string"},"fk_mm_child_column_id":{"type":"string"},"fk_mm_model_id":{"type":"string"},"fk_mm_parent_column_id":{"type":"string"},"fk_parent_column_id":{"type":"string"},"fk_related_model_id":{"type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"order":{"type":"string"},"type":{"type":"string"},"ur":{"type":"string"},"virtual":{"$ref":"#/components/schemas/Bool"}},"title":"LinkToAnotherRecord Model","type":"object","x-stoplight":{"id":"tcn1muyj67810"}},"Lookup":{"description":"Model for Lookup","examples":[{"id":"lk_mngsu0e45njbxr","fk_column_id":"cl_vdiy9bz7h11kdm","fk_relation_column_id":"cl_5jestblzneb649","fk_lookup_column_id":"cl_4cm47dtjphgqkv","order":1}],"title":"Lookup Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_lookup_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Lookup Column"},"fk_relation_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Relation Column"},"order":{"type":"number","description":"The order among the list","example":1}},"x-stoplight":{"id":"53ff6kxwlgjrb"}},"LookupColumnReq":{"description":"Model for Lookup Column Request","examples":[{"fk_relation_column_id":"cl_5jestblzneb649","fk_lookup_column_id":"cl_4cm47dtjphgqkv","title":"My Lookup","uidt":"Lookup"}],"title":"Lookup Column Request Model","type":"object","properties":{"fk_lookup_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Lookup Column"},"fk_relation_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Relation Column"},"title":{"maxLength":255,"type":"string","description":"Lookup Title","example":"My Lookup"},"uidt":{"enum":["Lookup"],"type":"string","description":"UI DataType"}},"x-stoplight":{"id":"rmmtwpsofeqo5"}},"Map":{"description":"Model for Map","examples":[{"base_id":"ds_g4ccx6e77h1dmi","columns":[{"base_id":"ds_g4ccx6e77h1dmi","fk_column_id":"cl_8iw2o4ejzvdyna","fk_view_id":"vw_qjt7klod1p9kyv","id":"nc_46xcacqn4rc9xf","order":1,"project_id":"p_xm3thidrblw4n7","show":1}],"fk_geo_data_col_id":"cl_8iw2o4ejzvdyna","fk_view_id":"vw_qjt7klod1p9kyv","meta":{},"order":0,"project_id":"p_xm3thidrblw4n7","show":true,"title":"My Map"}],"properties":{"base_id":{"description":"The ID of the base that this view belongs to","example":"ds_g4ccx6e77h1dmi","type":"string"},"columns":{"description":"Columns in this view","items":{"$ref":"#/components/schemas/MapColumn"},"type":"array"},"fk_geo_data_col_id":{"description":"Foreign Key to GeoData Column","example":"cl_8iw2o4ejzvdyna","type":"string"},"fk_view_id":{"description":"Unique ID for Map","example":"vw_qjt7klod1p9kyv","type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data for this view"},"order":{"description":"The order of the map list","type":"number"},"project_id":{"description":"The ID of the project that this view belongs to","example":"p_xm3thidrblw4n7","type":"string"},"show":{"description":"To show this Map or not","type":"boolean"},"title":{"description":"Title of Map View","example":"My Map","type":"string"}},"title":"Map Model","type":"object","x-stoplight":{"id":"bg6hvpyk90f0p"}},"MapUpdateReq":{"description":"Model for Map","x-stoplight":{"id":"2me98w8ot1e6o"},"examples":[{"fk_geo_data_col_id":"cl_8iw2o4ejzvdyna","meta":null}],"title":"Map View Update Request Model","type":"object","properties":{"fk_geo_data_col_id":{"description":"Foreign Key to GeoData Column","example":"cl_8iw2o4ejzvdyna","type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data for this view"}}},"MapColumn":{"description":"Model for Map Column","examples":[{"base_id":"ds_g4ccx6e77h1dmi","fk_column_id":"cl_8iw2o4ejzvdyna","fk_view_id":"vw_qjt7klod1p9kyv","id":"nc_46xcacqn4rc9xf","order":1,"project_id":"p_xm3thidrblw4n7","show":1}],"properties":{"base_id":{"description":"The ID of the base that this map column belongs to","example":"ds_g4ccx6e77h1dmi","type":"string"},"fk_column_id":{"description":"Foreign Key to Column","example":"cl_8iw2o4ejzvdyna","type":"string"},"fk_view_id":{"description":"Foreign Key to View","example":"vw_qjt7klod1p9kyv","type":"string"},"id":{"description":"Unique ID of Map Column","example":"nc_46xcacqn4rc9xf","type":"string"},"order":{"description":"the order in the list of map columns","example":1,"type":"number"},"project_id":{"description":"The ID of the project that this map column belongs to","example":"p_xm3thidrblw4n7","type":"string"},"show":{"description":"Whether to show this column or not","example":1,"type":"number"}},"title":"Map Column Model","type":"object","x-stoplight":{"id":"01nfqgzhqlqoe"}},"Meta":{"description":"Model for Meta","examples":[{}],"oneOf":[{"type":"null"},{"type":"object"},{"type":"string"}],"title":"Meta Model","x-stoplight":{"id":"daskjldw4zldd"}},"ModelRoleVisibility":{"description":"Model for ModelRoleVisibility","examples":[{"base_id":"string","disabled":true,"fk_model_id":"string","fk_view_id":"string","id":"string","project_id":"string","role":"string"}],"properties":{"base_id":{"type":"string"},"disabled":{"$ref":"#/components/schemas/Bool"},"fk_model_id":{"type":"string"},"fk_view_id":{"type":"string"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"project_id":{"type":"string"},"role":{"type":"string"}},"title":"ModelRoleVisibility Model","type":"object","x-stoplight":{"id":"cxh7walcnpkn0"}},"NormalColumnRequest":{"description":"Model for Normal Column Request","examples":[{"ai":true,"au":true,"cc":"string","cdf":"string","column_name":"string","csn":"string","dt":"string","dtx":"string","dtxp":0,"dtxs":0,"np":0,"ns":0,"pk":true,"pv":true,"rqd":true,"title":"string","uidt":"ID","un":true,"unique":true}],"properties":{"ai":{"$ref":"#/components/schemas/Bool","description":"Is this column auto-incremented?"},"au":{"$ref":"#/components/schemas/Bool","description":"Is this column auto-updated datetime field?"},"cc":{"$ref":"#/components/schemas/StringOrNull","description":"Column Comment"},"cdf":{"$ref":"#/components/schemas/StringOrNull","description":"Column Default Value"},"column_name":{"maxLength":255,"minLength":1,"type":"string","description":"Column Name"},"csn":{"$ref":"#/components/schemas/StringOrNull"},"dt":{"type":"string","description":"Data Type"},"dtx":{"$ref":"#/components/schemas/StringOrNull","description":"Data Type Extra"},"dtxp":{"oneOf":[{"type":"string"},{"type":"number"},{"type":"null"}],"description":"Data Type Extra Precision"},"dtxs":{"oneOf":[{"$ref":"#/components/schemas/StringOrNull"},{"type":"number"}],"description":"Data Type Extra Scale"},"np":{"oneOf":[{"$ref":"#/components/schemas/StringOrNull"},{"type":"integer"}],"description":"Numeric Precision"},"ns":{"oneOf":[{"$ref":"#/components/schemas/StringOrNull"},{"type":"integer"}],"description":"Numeric Scale"},"pk":{"$ref":"#/components/schemas/Bool","description":"Is this column a primary key?"},"pv":{"$ref":"#/components/schemas/Bool","description":"Is this column a primary value?"},"rqd":{"$ref":"#/components/schemas/Bool","description":"Is this column required?"},"title":{"maxLength":255,"type":"string","description":"Column Title"},"uidt":{"enum":["Attachment","AutoNumber","Barcode","Button","Checkbox","Collaborator","Count","CreateTime","Currency","Date","DateTime","Decimal","Duration","Email","Formula","ForeignKey","GeoData","Geometry","ID","JSON","LastModifiedTime","LongText","LinkToAnotherRecord","Lookup","MultiSelect","Number","Percent","PhoneNumber","Rating","Rollup","SingleLineText","SingleSelect","SpecificDBType","Time","URL","Year","QrCode","Links"],"type":"string","description":"UI Data Type"},"un":{"$ref":"#/components/schemas/Bool","description":"Is this column unique?"},"unique":{"$ref":"#/components/schemas/Bool","description":"Is this column unique?"}},"title":"Normal Column Request Model","type":"object","required":["column_name"],"x-stoplight":{"id":"fn3gqmojvswv2"}},"OrgUserReq":{"description":"Model for Organisation User Update Request","examples":[{"email":"user@example.com","roles":"org-level-creator"}],"properties":{"email":{"format":"email","type":"string"},"roles":{"enum":["org-level-creator","org-level-viewer"],"type":"string","description":"Roles for the project user"}},"title":"Organisation User Request Model","type":"object","x-stoplight":{"id":"n484boi6jv3up"}},"Paginated":{"description":"Model for Paginated","examples":[{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}],"properties":{"isFirstPage":{"description":"Is the current page the first page","type":"boolean"},"isLastPage":{"description":"Is the current page the last page","type":"boolean"},"page":{"description":"The current page","example":1,"type":"number"},"pageSize":{"description":"The number of pages","example":10,"type":"number"},"totalRows":{"description":"The number of rows in the given result","example":1,"type":"number"}},"title":"Paginated Model","type":"object","x-stoplight":{"id":"2x65v3n9xo8q3"}},"Password":{"description":"Model for Password","example":"password123456789","examples":["password123456789"],"minLength":8,"title":"Password Model","type":"string","x-stoplight":{"id":"s7gk265anpyc7"}},"PasswordChangeReq":{"description":"Model for Password Change Request","examples":[{"currentPassword":"currentpassword","newPassword":"newpassword"}],"properties":{"currentPassword":{"type":"string"},"newPassword":{"minLength":8,"type":"string"}},"required":["currentPassword","newPassword"],"title":"Password Change Request Model","type":"object","x-stoplight":{"id":"wvritsht82jyy"}},"PasswordForgotReq":{"description":"Model for Password Forgot Request","examples":[{"email":"user@example.com"}],"properties":{"email":{"description":"Email address of the user","format":"email","type":"string"}},"required":["email"],"title":"Password Forgot Request Model","type":"object","x-stoplight":{"id":"qj6pb0nc6dtb1"}},"PasswordResetReq":{"description":"Model for Password Reset Request","examples":[{"password":"newpassword"}],"properties":{"password":{"description":"New password","example":"newpassword","minLength":8,"type":"string"}},"required":["password"],"title":"Password Reset Request Model","type":"object","x-stoplight":{"id":"24ig9uh9evw2p"}},"Plugin":{"description":"Model for Plugin","examples":[{"id":"nc_tljibbzcyjrhcc","title":"S3","description":"Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance.","active":true,"rating":null,"version":"0.0.1","docs":null,"status":"install","status_details":null,"logo":"plugins/s3.png","icon":null,"tags":"Storage","category":"Storage","input_schema":"{\\"title\\":\\"Configure Amazon S3\\",\\"items\\":[{\\"key\\":\\"bucket\\",\\"label\\":\\"Bucket Name\\",\\"placeholder\\":\\"Bucket Name\\",\\"type\\":\\"SingleLineText\\",\\"required\\":true},{\\"key\\":\\"region\\",\\"label\\":\\"Region\\",\\"placeholder\\":\\"Region\\",\\"type\\":\\"SingleLineText\\",\\"required\\":true},{\\"key\\":\\"access_key\\",\\"label\\":\\"Access Key\\",\\"placeholder\\":\\"Access Key\\",\\"type\\":\\"SingleLineText\\",\\"required\\":true},{\\"key\\":\\"access_secret\\",\\"label\\":\\"Access Secret\\",\\"placeholder\\":\\"Access Secret\\",\\"type\\":\\"Password\\",\\"required\\":true}],\\"actions\\":[{\\"label\\":\\"Test\\",\\"placeholder\\":\\"Test\\",\\"key\\":\\"test\\",\\"actionType\\":\\"TEST\\",\\"type\\":\\"Button\\"},{\\"label\\":\\"Save\\",\\"placeholder\\":\\"Save\\",\\"key\\":\\"save\\",\\"actionType\\":\\"SUBMIT\\",\\"type\\":\\"Button\\"}],\\"msgOnInstall\\":\\"Successfully installed and attachment will be stored in AWS S3\\",\\"msgOnUninstall\\":\\"\\"}","input":"{\\"bucket\\":\\"my-bucket\\",\\"region\\":\\"us-west-004\\",\\"access_key\\":\\"redacted\\",\\"access_secret\\":\\"redacted\\"}","creator":null,"creator_website":null,"price":null}],"title":"Plugin Model","type":"object","properties":{"active":{"$ref":"#/components/schemas/Bool","description":"Is plguin active?"},"category":{"type":"string","description":"Plugin Category","example":"Storage"},"creator":{"type":"string","description":"Plugin Creator (Not in use)"},"creator_website":{"type":"string","description":"Plugin Creator website (Not in use)"},"description":{"type":"string","description":"Plugin Description","example":"Amazon Simple Storage Service (Amazon S3) is an object storage service that offers industry-leading scalability, data availability, security, and performance."},"docs":{"type":"string","description":"Documentation of plugin (Not in use)"},"icon":{"type":"string","description":"Plugin Icon (Not in use)"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"input":{"oneOf":[{"$ref":"#/components/schemas/StringOrNull"},{"type":"integer"}],"description":"Plugin Input"},"input_schema":{"type":"string","description":"Plugin Input Schema\\n"},"logo":{"type":"string","description":"Plugin logo","example":"plugins/s3.png"},"price":{"type":"string","description":"Plugin Price (Not in use)"},"rating":{"type":"number","description":"Plugin Rating (Not in use)"},"status":{"type":"string","description":"Plugin Status","example":"install"},"status_details":{"type":"string","description":"Not in use"},"tags":{"type":"string","description":"Plugin tags","example":"Storage"},"title":{"type":"string","description":"Plugin Title"},"version":{"type":"string","description":"Plugin Version","example":"0.0.1"}},"x-stoplight":{"id":"xxoy0oe5kab93"}},"PluginReq":{"description":"Model for Plugin Request","examples":[{"active":0,"input":"{\\"bucket\\":\\"my-bucket\\",\\"region\\":\\"us-west-004\\",\\"access_key\\":\\"redacted\\",\\"access_secret\\":\\"redacted\\"}"}],"title":"Plugin Reqeust","type":"object","x-stoplight":{"id":"qcriv4xl88hyu"},"properties":{"active":{"$ref":"#/components/schemas/Bool","description":"Is Plugin Active?"},"input":{"description":"Plugin Input","oneOf":[{"type":"string"},{"type":"null"}]}}},"PluginTestReq":{"description":"Model for Plugin Test Request","examples":[{"title":"Plugin Foo","input":"{\\"bucket\\":\\"my-bucket\\",\\"region\\":\\"us-west-004\\",\\"access_key\\":\\"redacted\\",\\"access_secret\\":\\"redacted\\"}","category":"Email"}],"title":"Plugin Test Request Model","type":"object","properties":{"title":{"maxLength":45,"type":"string","description":"Plugin Title"},"input":{"oneOf":[{"type":"string","description":"Plugin Input as JSON string"},{"description":"Plugin Input","type":"object"}]},"category":{"x-stoplight":{"id":"rg3i3ov9rs6d0"},"type":"string","example":"Email"}},"required":["title","input","category"],"x-stoplight":{"id":"zrvjtpfx9wc54"}},"Project":{"description":"Model for Project","examples":[{"bases":[{"alias":"string","config":null,"enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"project_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my project description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-project"}],"title":"Project Model","type":"object","properties":{"bases":{"description":"List of base models","type":"array","items":{"$ref":"#/components/schemas/Base"}},"color":{"description":"Primary Theme Color","example":"#24716E","type":"string"},"deleted":{"$ref":"#/components/schemas/Bool","description":"Is the project deleted"},"description":{"description":"Project Description","example":"This is my project description","type":"string"},"id":{"description":"Unique Project ID","example":"p_124hhlkbeasewh","type":"string"},"is_meta":{"$ref":"#/components/schemas/Bool"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Info such as theme colors"},"order":{"description":"The order in project list","type":"number"},"prefix":{"description":"Project prefix. Used in XCDB only.","example":"nc_vm5q__","type":"string"},"type":{"type":"string","enum":["database","documentation","dashboard"]},"linked_db_projects":{"description":"List of linked Database Projects that this project has access to (only used in Dashboard projects so far)","type":"array","items":{"$ref":"#/components/schemas/Project"}},"status":{"type":"string"},"title":{"description":"Project Title","example":"my-project","type":"string"}},"x-stoplight":{"id":"t8uouhop01ndi"}},"ProjectList":{"description":"Model for Project List","examples":[{"list":[{"bases":[{"alias":"string","config":null,"created_at":"2023-03-01 14:27:36","enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"project_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my project description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-project","updated_at":"2023-03-01 14:27:36"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Project List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"description":"List of Project Models","minItems":1,"type":"array","uniqueItems":true,"items":{"$ref":"#/components/schemas/Project"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Pagination Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"fr75wwwzt951h"}},"ProjectReq":{"description":"Model for Project Request","examples":[{"bases":[{"alias":"My Base","config":null,"inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"type":"mysql"}],"color":"#24716E","description":"This is my project description","title":"My Project"}],"properties":{"bases":{"description":"Array of Bases","items":{"$ref":"#/components/schemas/BaseReq"},"type":"array"},"color":{"description":"Primary Theme Color","example":"#24716E","maxLength":50,"type":"string"},"description":{"description":"Project Description","example":"This is my project description","type":"string"},"title":{"description":"Project Title","example":"My Project","maxLength":128,"minLength":1,"type":"string"},"status":{"$ref":"#/components/schemas/StringOrNull","description":"Project Status","example":"locked"},"type":{"type":"string","enum":["database","documentation","dashboard"]},"linked_db_project_ids":{"description":"List of Linked Database Project IDs (only used for Dashboard Projects so far)","type":"array","items":{"type":"string"}}},"required":["title"],"title":"Project Request Model","type":"object","x-stoplight":{"id":"f5k929rrvfy92"}},"ProjectUpdateReq":{"description":"Model for Project Update Request","x-stoplight":{"id":"0fq3a94qjgb5f"},"examples":[{"color":"#24716E","meta":null,"title":"My Project"}],"title":"Project Update Request Model","type":"object","properties":{"color":{"description":"Primary Theme Color","example":"#24716E","maxLength":50,"type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Project Meta","x-stoplight":{"id":"m05w9sbwqgul3"}},"title":{"description":"Project Title","example":"My Project","maxLength":128,"minLength":1,"type":"string"},"status":{"$ref":"#/components/schemas/StringOrNull","description":"Project Status","example":"locked"},"linked_db_project_ids":{"description":"List of Linked Database Project IDs (only used for Dashboard Projects so far)","type":"array","items":{"type":"string"}}}},"ProjectUserReq":{"description":"Model for Project User Request","examples":[{"email":"user@example.com","roles":"owner"}],"title":"Project User Request Model","type":"object","properties":{"email":{"format":"email","type":"string","description":"Project User Email"},"roles":{"enum":["no-access","commenter","editor","guest","owner","viewer","creator"],"type":"string","description":"Project User Role"}},"required":["email","roles"],"x-stoplight":{"id":"3bvgqk9tn16ur"}},"ProjectUserMetaReq":{"description":"Model for Project User Meta Request","examples":[{"starred":true,"order":1,"hidden":true}],"title":"Project User Meta Request Model","type":"object","properties":{"starred":{"$ref":"#/components/schemas/Bool","description":"Star Project"},"order":{"type":"number","description":"The order among the projects","example":1},"hidden":{"$ref":"#/components/schemas/Bool"}}},"Rollup":{"description":"Model for Rollup","examples":[{"id":"rl_kc19pbdkij8wly","fk_column_id":"cl_588b63mneri2yi","fk_relation_column_id":"cl_c09q6eu6hsvn4s","fk_rollup_column_id":"cl_m62i1vyl23n8co","rollup_function":"count"}],"title":"Rollup Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"fk_relation_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign to Relation Column"},"fk_rollup_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign to Rollup Column"},"rollup_function":{"type":"string","description":"Rollup Function","example":"count","enum":["count","min","max","avg","countDistinct","sumDistinct","avgDistinct"]}},"x-stoplight":{"id":"imknmkksc8bqk"}},"RollupColumnReq":{"description":"Model for Rollup Column Request","examples":[{"fk_relation_column_id":"cl_c09q6eu6hsvn4s","fk_rollup_column_id":"cl_m62i1vyl23n8co","title":"Rollup Column","rollup_function":"avg","uidt":"Rollup"}],"title":"Rollup Column Request Model","type":"object","properties":{"fk_relation_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Relation Column"},"fk_rollup_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Rollup Column"},"title":{"maxLength":255,"type":"string","description":"Rollup Column Title"},"rollup_function":{"enum":["avg","avgDistinct","count","countDistinct","max","min","sum","sumDistinct"],"type":"string","description":"Rollup Function"},"uidt":{"enum":["Rollup"],"type":"string","description":"UI DataType"}},"x-stoplight":{"id":"ayjjv1pfxmvlv"}},"SelectOption":{"description":"Model for SelectOption","examples":[{"id":"sl_hvfeuagqtlzzbk","title":"Option A","fk_column_id":"cl_35zmvi2tezfipw","color":"#cfdffe","order":1}],"title":"SelectOption Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"title":{"type":"string","description":"Option Title\\n","example":"Option A"},"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"color":{"type":"string","description":"Option Color","example":"#cfdffe"},"order":{"type":"number","description":"The order among the options","example":1}},"x-stoplight":{"id":"y9gglydcl3zjr"}},"SelectOptions":{"description":"Model for SelectOptions","examples":[{"options":[{"id":"sl_hvfeuagqtlzzbk","title":"Option A","fk_column_id":"cl_35zmvi2tezfipw","color":"#cfdffe","order":1}]}],"title":"SelectOptions Model","type":"object","properties":{"options":{"type":"array","description":"Array of select options","items":{"$ref":"#/components/schemas/SelectOption"}}},"required":["options"],"x-stoplight":{"id":"3rx8jyy2ufbc3"}},"SharedBaseReq":{"description":"Model for Shared Base Request","examples":[{"password":"password123","roles":"editor"}],"title":"Shared Base Request Model","type":"object","properties":{"password":{"minLength":8,"type":"string","description":"Password to protect the base","example":"password123"},"roles":{"enum":["commenter","editor","viewer"],"type":"string","description":"The role given the target user","example":"editor"}},"x-stoplight":{"id":"4jvab8fa8ibxv"}},"SharedView":{"$ref":"#/components/schemas/View","description":"Model for Shared View","title":"SharedView","examples":[{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"x-stoplight":{"id":"gagdto3i3c0fb"}},"SharedViewList":{"description":"Model for Shared View List","examples":[{"list":[{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Shared View List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"minItems":1,"type":"array","uniqueItems":true,"description":"List of shared view objects","items":{"$ref":"#/components/schemas/SharedView"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"5gnbbmgal3om3"}},"SharedViewReq":{"description":"Model for Shared View Request","examples":[{"meta":{},"password":"123456789"}],"title":"Shared View Request Model","type":"object","properties":{"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data passing to Shared View such as if download is allowed or not."},"password":{"$ref":"#/components/schemas/StringOrNull","description":"Password to restrict access"}},"x-stoplight":{"id":"hbj6j87gyi7ap"}},"SignInReq":{"description":"Model for Signin Request","examples":[{"email":"user@example.com","password":"string"}],"properties":{"email":{"description":"Email address of the user","format":"email","type":"string"},"password":{"description":"Password of the user","type":"string"}},"required":["email","password"],"title":"Signin Request Model","type":"object","x-stoplight":{"id":"efb2gvnypydy9"}},"SignUpReq":{"description":"Model for Signup Request","examples":[{"email":"user@example.com","password":"password123456789","firstname":"Alice","lastname":"Smith","token":null,"ignore_subscribe":0}],"title":"Signup Request Model","type":"object","properties":{"email":{"description":"Email address of the user","example":"user@example.com","format":"email","type":"string"},"password":{"description":"Password of the user","example":"password123456789","minLength":8,"type":"string"},"firstname":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"lblivgs8wcsm1"}},"lastname":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"d4341r35tucq3"}},"token":{"$ref":"#/components/schemas/StringOrNull","x-stoplight":{"id":"otw9jgnr9n7c4"},"description":"Sign Up Token. Used for invitation."},"ignore_subscribe":{"$ref":"#/components/schemas/Bool","x-stoplight":{"id":"g7ge6mc6vdsds"},"description":"Ignore Subscription"}},"required":["email","password"],"x-stoplight":{"id":"6ia1chyii9w48"}},"Sort":{"description":"Model for Sort","examples":[{"id":"so_xd4t51uv60ghzl","fk_column_id":"cl_l11b769pe2j1ce","fk_model_id":"md_ehn5izr99m7d45","base_id":"ds_3l9qx8xqksenrl","direction":"desc","order":1,"project_id":"p_9sx43moxhqtjm3"}],"title":"Sort Model","type":"object","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"fk_column_id":{"$ref":"#/components/schemas/Id"},"fk_model_id":{"$ref":"#/components/schemas/Id"},"base_id":{"type":"string","description":"Base ID","example":"ds_3l9qx8xqksenrl","readOnly":true},"direction":{"type":"string","description":"Sort direction","enum":["asc","desc"],"example":"desc"},"order":{"type":"number","example":1},"project_id":{"type":"string","description":"Project ID","example":"p_9sx43moxhqtjm3","readOnly":true}},"x-stoplight":{"id":"25fm97zsmwf6h"}},"SortList":{"description":"Model for Sort List","examples":[{"list":[{"id":"so_xd4t51uv60ghzl","fk_column_id":"cl_l11b769pe2j1ce","fk_model_id":"md_ehn5izr99m7d45","base_id":"ds_3l9qx8xqksenrl","direction":"desc","order":1,"project_id":"p_9sx43moxhqtjm3"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Sort List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"gjqqc8ciqg947"},"description":"List of Sort Objects","items":{"$ref":"#/components/schemas/Sort","x-stoplight":{"id":"usnfa1kbovpmb"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"i75wcejfp5mnq"}}},"required":["list","pageInfo"],"x-stoplight":{"id":"us9qfo1go142f"}},"SortReq":{"description":"Model for Sort Request","examples":[{"direction":"asc","fk_column_id":"cl_l11b769pe2j1ce"}],"minProperties":1,"title":"Sort Request Model","type":"object","properties":{"fk_column_id":{"$ref":"#/components/schemas/Id","description":"Foreign Key to Column"},"direction":{"description":"Sort direction","enum":["asc","desc"],"type":"string"}},"x-stoplight":{"id":"8v8qzwm3w4v11"}},"StringOrNull":{"description":"Model for StringOrNull","examples":["string"],"oneOf":[{"maxLength":255,"type":"string"},{"type":"null"}],"title":"StringOrNull Model","x-stoplight":{"id":"p1g7xrgdsn540"}},"Table":{"description":"Model for Table","examples":[{"base_id":"ds_g4ccx6e77h1dmi","columns":[{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},{"ai":1,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}],"columnsById":{"cl_c5knoi4xs4sfpt":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":"45","column_name":"title","cop":"2","created_at":"2023-03-02 17:04:06","csn":"utf8mb4","ct":"varchar(45)","deleted":null,"dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_c5knoi4xs4sfpt","meta":null,"np":null,"ns":null,"order":2,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":1,"rqd":0,"system":0,"title":"Title","uidt":"SingleLineText","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_jpl0qu4gj4rexq":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP","clen":null,"column_name":"created_at","cop":"3","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_jpl0qu4gj4rexq","meta":null,"np":null,"ns":null,"order":3,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"CreatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_m4wkaqgqqjzoeh":{"ai":0,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","clen":null,"column_name":"updated_at","cop":"4","created_at":"2023-03-02 17:04:06","csn":null,"ct":"timestamp","deleted":null,"dt":"timestamp","dtx":"specificType","dtxp":"0","dtxs":null,"fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_m4wkaqgqqjzoeh","meta":null,"np":null,"ns":null,"order":4,"pk":0,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":0,"system":0,"title":"UpdatedAt","uidt":"DateTime","un":0,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null},"cl_phvuuwjrzcdo0g":{"ai":1,"au":0,"base_id":"ds_g4ccx6e77h1dmi","cc":"","cdf":null,"clen":null,"column_name":"id","cop":"1","created_at":"2023-03-02 17:04:06","csn":null,"ct":"int unsigned","deleted":null,"dt":"int","dtx":"specificType","dtxp":"","dtxs":"0","fk_model_id":"md_rsu68aqjsbyqtl","id":"cl_phvuuwjrzcdo0g","meta":null,"np":"10","ns":"0","order":1,"pk":1,"project_id":"p_xm3thidrblw4n7","pv":null,"rqd":1,"system":0,"title":"Id","uidt":"ID","un":1,"unique":0,"updated_at":"2023-03-02 17:04:06","validate":null,"virtual":null}},"created_at":"2023-03-02 17:04:06","deleted":null,"enabled":1,"id":"md_rsu68aqjsbyqtl","meta":null,"mm":0,"order":1,"pinned":null,"project_id":"p_xm3thidrblw4n7","schema":null,"table_name":"nc_vm5q___Table1","tags":null,"title":"Table1","type":"table","updated_at":"2023-03-02 17:04:08","views":[{"_ptn":"Table1","_tn":"Table1","base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","disabled":{"commenter":false,"creator":false,"editor":false,"guest":false,"owner":false,"viewer":false},"fk_model_id":"md_rsu68aqjsbyqtl","id":"vw_p2jcatxz4mvcfw","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","ptn":"nc_vm5q___Table1","ptype":"table","show":1,"show_system_fields":null,"table_meta":null,"title":"Table1","tn":"Table1","type":3,"updated_at":"2023-03-02 17:04:06","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:04:06","fk_view_id":"vw_p2jcatxz4mvcfw","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:04:06","uuid":null}}]}],"title":"Table Model","type":"object","properties":{"base_id":{"description":"Unique Base ID","type":"string"},"columns":{"description":"The columns included in this table","type":"array","items":{"$ref":"#/components/schemas/Column"}},"columnsById":{"description":"Column Models grouped by IDs","type":"object"},"deleted":{"$ref":"#/components/schemas/Bool"},"enabled":{"$ref":"#/components/schemas/Bool","description":"Is this table enabled?"},"id":{"description":"Unique Table ID","type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta Data"},"mm":{"$ref":"#/components/schemas/Bool","description":"Is this table used for M2M"},"order":{"description":"The order of the list of tables","type":"number"},"pinned":{"$ref":"#/components/schemas/Bool","description":"Currently not in use"},"project_id":{"description":"Unique Project ID","type":"string"},"table_name":{"description":"Table Name. Prefix will be added for XCDB projects.","type":"string"},"tags":{"$ref":"#/components/schemas/StringOrNull","description":"Currently not in use"},"title":{"description":"Table Title","type":"string"},"type":{"description":"Table Type","type":"string"}},"required":["table_name","title"],"x-stoplight":{"id":"dkfoyjcny5am9"}},"TableList":{"description":"Model for Table List","examples":[{"list":[{"alias":"string","base_id":"string","column":[{"alias":"string","auto_increment":true,"auto_update_timestamp":true,"base_id":"string","character_maximum_length":"string","character_set_name":"string","colOptions":{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true},"column_comment":"string","column_default":"string","column_ordinal_position":"string","column_type":"string","data_type":"string","data_type_x":"string","data_type_x_precision":"string","data_type_x_scale":"string","deleted":true,"fk_model_id":"string","id":"string","numeric_precision":"string","numeric_scale":"string","order":0,"primary_key":true,"primary_value":true,"rqd":"string","title":"string","ui_data_type":"string","un":"string","unique":true,"visible":true}],"columnByIds":{},"deleted":true,"enabled":true,"id":"string","order":0,"parent_id":"string","pinned":true,"project_id":"string","show_as":"string","tags":"string","title":"string","type":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"Table List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"minItems":1,"type":"array","uniqueItems":true,"description":"List of table objects","items":{"$ref":"#/components/schemas/Table"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"urwk2euatlkjl"}},"TableReq":{"description":"Model for Table Request","examples":[{"columns":[{"ai":false,"altered":1,"cdf":"CURRENT_TIMESTAMP on update CURRENT_TIMESTAMP","ck":false,"clen":45,"column_name":"updated_at","ct":"varchar(45)","dt":"timestamp","dtx":"specificType","dtxp":"","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"UpdatedAt","uicn":"","uidt":"DateTime","uip":"","un":false},{"ai":false,"altered":1,"cdf":"CURRENT_TIMESTAMP","ck":false,"clen":45,"column_name":"created_at","ct":"varchar(45)","dt":"timestamp","dtx":"specificType","dtxp":"","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"CreatedAt","uicn":"","uidt":"DateTime","uip":"","un":false},{"ai":false,"altered":1,"cdf":null,"ck":false,"clen":45,"column_name":"title","ct":"varchar(45)","dt":"varchar","dtx":"specificType","dtxp":"45","dtxs":"","np":null,"nrqd":true,"ns":null,"pk":false,"rqd":false,"title":"Title","uicn":"","uidt":"SingleLineText","uip":"","un":false},{"ai":true,"altered":1,"cdf":null,"ck":false,"clen":null,"column_name":"id","ct":"int(11)","dt":"int","dtx":"integer","dtxp":"11","dtxs":"","np":11,"nrqd":false,"ns":0,"pk":true,"rqd":true,"title":"Id","uicn":"","uidt":"ID","uip":"","un":true}],"table_name":"Sheet-1","title":"Sheet-1"}],"properties":{"columns":{"description":"The column models in this table","items":{"$ref":"#/components/schemas/NormalColumnRequest"},"type":"array"},"meta":{"$ref":"#/components/schemas/Meta","description":"the meta data for this table"},"order":{"description":"The order of table list","example":1,"type":"number"},"table_name":{"description":"Table name","example":"my_table","maxLength":255,"minLength":1,"type":"string"},"title":{"description":"Table title","example":"My Table","maxLength":255,"minLength":0,"type":"string"}},"required":["columns","table_name"],"title":"Table Request Model","type":"object","x-stoplight":{"id":"sv3junrrevn31"}},"User":{"description":"Model for User","examples":[{"id":"142","user_name":"jaysmith","display_name":"Jay Smith","email":"jay.smith@gmail.com","emailVerified":true,"roles":"org-level-creator,super","bio":"foo","location":"Istanbul","created_at":"2019-08-24","avatar":"https://dummyimage.com/300.png"}],"title":"User Model","type":"object","x-internal":false,"properties":{"id":{"type":"string","description":"Unique identifier for the given user."},"email":{"type":"string","format":"email"},"roles":{"type":"string"},"email_verified":{"type":"boolean","description":"Set to true if the user\'s email has been verified."},"created_at":{"type":"string","format":"date","description":"The date that the user was created."},"updated_at":{"type":"string","format":"date","description":"The date that the user was created."},"display_name":{"type":"string"},"user_name":{"type":"string"},"bio":{"type":"string"},"location":{"type":"string"},"website":{"type":"string"},"avatar":{"type":"string"},"token_version":{"description":"Access token version","type":"string"}},"required":["id","email","email_verified"],"x-stoplight":{"id":"hcruzlenrwb2x"}},"UserInfo":{"description":"Model for User Info","examples":[{"email":"user@example.com","email_verified":true,"firstname":"string","id":"string","lastname":"string","roles":null}],"properties":{"email":{"description":"User Email","format":"email","type":"string"},"email_verified":{"description":"Set to true if the user\'s email has been verified.","type":"boolean"},"firstname":{"description":"The firstname of the user","type":"string"},"id":{"description":"User ID","type":"string"},"lastname":{"description":"The lastname of the user","type":"string"},"roles":{"description":"The roles of the user"},"project_roles":{"description":"The project roles of the user"},"workspace_roles":{"description":"The workspace roles of the user"}},"title":"User Info Model","type":"object","x-stoplight":{"id":"mzqg7tcf4hglo"}},"UserList":{"description":"Model for User List","examples":[{"list":[{"email":"user@example.com","email_verified":true,"firstname":"Alice","id":"us_8kugj628ebjngs","lastname":"Smith","roles":"org-level-viewer"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"User List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","x-stoplight":{"id":"8o7v47q3e67ef"},"description":"List of user objects","items":{"$ref":"#/components/schemas/User","x-stoplight":{"id":"kwqzxwea9r5er"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"0d98n6sfxfvft"},"description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"32mz06s4tgptq"}},"View":{"description":"Model for View","examples":[{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"title":"View Model","type":"object","properties":{"base_id":{"$ref":"#/components/schemas/Id","description":"Unique Base ID"},"fk_model_id":{"$ref":"#/components/schemas/Id","description":"Unique Model ID"},"id":{"$ref":"#/components/schemas/Id","description":"Unique ID for View"},"lock_type":{"description":"Lock Type of the view","enum":["collaborative","locked","personal"],"type":"string"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta data for this view"},"order":{"description":"The rder of the list of views","type":"number"},"password":{"$ref":"#/components/schemas/StringOrNull","description":"Password for protecting the view"},"project_id":{"$ref":"#/components/schemas/Id","description":"Unique Project ID"},"show":{"$ref":"#/components/schemas/Bool","description":"If this view is shown?"},"show_system_fields":{"$ref":"#/components/schemas/Bool","description":"Should show system fields in this view?"},"is_default":{"$ref":"#/components/schemas/Bool","description":"Is this view default view for the model?"},"title":{"description":"View Title","type":"string"},"type":{"description":"View Type","type":"number"},"uuid":{"$ref":"#/components/schemas/StringOrNull","description":"UUID of the view"},"view":{"anyOf":[{"$ref":"#/components/schemas/Form"},{"$ref":"#/components/schemas/Gallery"},{"$ref":"#/components/schemas/Grid"},{"$ref":"#/components/schemas/Kanban"},{"$ref":"#/components/schemas/Map"}],"description":"Associated View Model"}},"required":["fk_model_id","show","title","type"],"x-stoplight":{"id":"nobjewdlhxrkq"}},"ViewList":{"description":"Model for View List","examples":[{"list":[{"alias":"string","column":[{"alias":"string","auto_increment":true,"auto_update_timestamp":true,"base_id":"string","character_maximum_length":"string","character_set_name":"string","colOptions":{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true},"column_comment":"string","column_default":"string","column_ordinal_position":"string","column_type":"string","data_type":"string","data_type_x":"string","data_type_x_precision":"string","data_type_x_scale":"string","deleted":true,"fk_model_id":"string","id":"string","numeric_precision":"string","numeric_scale":"string","order":0,"primary_key":true,"primary_value":true,"rqd":"string","title":"string","ui_data_type":"string","un":"string","unique":true,"visible":true}],"columnByIds":{},"deleted":true,"enabled":true,"fk_base_id":"string","fk_project_id":"string","id":"string","order":0,"parent_id":"string","pinned":true,"show_as":"string","tags":"string","title":"string","type":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"View List Model","type":"object","x-examples":{"example-1":{"bases":{"list":[{"alias":"string","database":"string","host":"string","id":"string","params":"string","password":"string","port":0,"project_id":"string","ssl":"string","type":"string","url":"string","username":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"pageSize":0,"sort":"string","totalRows":0}}}},"properties":{"list":{"type":"array","description":"List of view objects","items":{"$ref":"#/components/schemas/View"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Paginated Info"}},"required":["list","pageInfo"],"x-stoplight":{"id":"a1f99jvpiuugl"}},"ViewCreateReq":{"type":"object","x-stoplight":{"id":"zvdo4i7c70jmo"},"title":"ViewCreateReq","description":"Model for View Create Request","examples":[{"title":"My Grid View","type":3,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null},{"title":"My Gallery View","type":2,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null},{"title":"My Form View","type":1,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":null},{"title":"My Kanban View","type":4,"copy_from_id":null,"fk_grp_col_id":"cl_g0a89q9xdry3lu","fk_geo_data_col_id":null},{"title":"My Map View","type":5,"copy_from_id":null,"fk_grp_col_id":null,"fk_geo_data_col_id":"cl_uu1meolj00tlrq"}],"properties":{"title":{"type":"string","description":"View Title","example":"My View"},"type":{"type":"number","description":"View Type"},"copy_from_id":{"$ref":"#/components/schemas/StringOrNull","description":"ID of view to be copied from. Used in Copy View."},"fk_grp_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Grouping Column. Used in creating Kanban View."},"fk_geo_data_col_id":{"$ref":"#/components/schemas/StringOrNull","description":"Foreign Key to Geo Data Column. Used in creating Map View."}},"required":["title"]},"ViewUpdateReq":{"description":"Model for View Update Request","x-stoplight":{"id":"7inf594lhs8mh"},"examples":[{"title":"Grid View 1","uuid":"e2457bbf-e29c-4fec-866e-fe3b01dba57f","password":"password123","lock_type":"collaborative","meta":"{\\"allowCSVDownload\\":true}","order":1,"show_system_fields":0}],"title":"View Update Request Model","type":"object","properties":{"title":{"maxLength":255,"type":"string","description":"View Title","example":"Grid View 1"},"uuid":{"maxLength":255,"type":"string","x-stoplight":{"id":"vlhs7xs644u8l"},"description":"View UUID. Used in Shared View.","example":"e2457bbf-e29c-4fec-866e-fe3b01dba57f"},"password":{"maxLength":255,"type":"string","x-stoplight":{"id":"vlhs7xs644u8l"},"description":"View Password. Used in Shared View.","example":"password123"},"lock_type":{"enum":["collaborative","locked","personal"],"type":"string","description":"Lock type of View.","example":"collaborative"},"meta":{"$ref":"#/components/schemas/Meta","description":"Meta info used in View."},"order":{"type":"number","description":"The order of the list of views.","example":1,"minimum":0},"show_system_fields":{"$ref":"#/components/schemas/Bool","description":"Should this view show system fields?"}}},"ViewColumnUpdateReq":{"description":"Model for View Column Update Request","x-stoplight":{"id":"7xso36z6hvh43"},"examples":[{"show":0,"order":1}],"title":"View Column Update Request Model","type":"object","properties":{"show":{"$ref":"#/components/schemas/Bool","description":"View Title","x-stoplight":{"id":"coxius73ejq5x"}},"order":{"type":"number","description":"The order of the list of views.","example":1,"minimum":0}}},"ViewColumnReq":{"description":"Model for View Column Request","x-stoplight":{"id":"ofapz0gzl35z2"},"examples":[{"fk_column_id":"cl_5jestblzneb649","show":0,"order":1}],"title":"View Column Request Model","type":"object","properties":{"fk_column_id":{"$ref":"#/components/schemas/Id","x-stoplight":{"id":"rxd07wvp9hf6s"},"description":"Foreign Key to Column"},"show":{"$ref":"#/components/schemas/Bool","description":"View Title","x-stoplight":{"id":"coxius73ejq5x"}},"order":{"type":"number","description":"The order of the list of views.","example":1,"minimum":0}}},"VisibilityRuleReq":{"description":"Model for Visibility Rule Request","examples":[[{"disabled":{"commenter":true,"creator":true,"editor":true,"guest":true,"owner":true,"viewer":true}}]],"items":{"properties":{"id":{"oneOf":[{"type":"string"},{"type":"null"}]},"disabled":{"properties":{"commenter":{"$ref":"#/components/schemas/Bool"},"creator":{"$ref":"#/components/schemas/Bool"},"editor":{"$ref":"#/components/schemas/Bool"},"guest":{"$ref":"#/components/schemas/Bool"},"owner":{"$ref":"#/components/schemas/Bool"},"viewer":{"$ref":"#/components/schemas/Bool"}},"type":"object"}},"type":"object"},"title":"Visibility Rule Request Model","type":"array","x-stoplight":{"id":"xu5zgt0fc3ms9"}},"Webhook":{"properties":{"id":{"type":"string"},"title":{"type":"string"},"type":{"type":"string"}},"title":"Webhook","type":"object"},"ProjectInviteEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user who receives the project invite"},"type":{"type":"string","description":"The type of event, which should be set to \'PROJECT_INVITE\'"},"body":{"type":"object","properties":{"id":{"type":"string","description":"The ID of the project being invited to"},"title":{"type":"string","description":"The title of the project being invited to"},"type":{"type":"string","description":"The type of the project being invited to"},"invited_by":{"type":"string","description":"The email address of the user who invited the recipient"}},"required":["id","title","type","invited_by"]}},"required":["fk_user_id","type","body"]},"ProjectEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user"},"type":{"type":"string"},"body":{"type":"object","properties":{"id":{"type":"string","description":"The ID of the project"},"title":{"type":"string","description":"The title of the project"},"type":{"type":"string","description":"The type of the project"}},"required":["id","title","type"]}},"required":["fk_user_id","type","body"]},"WelcomeEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user receiving the welcome message"},"type":{"type":"string","description":"The type of event, which should be set to \'WELCOME\'"},"body":{"type":"object","description":"An empty object"}},"required":["fk_user_id","type","body"]},"SortEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user who created sort"},"type":{"type":"string"},"body":{"type":"object"}},"required":["fk_user_id","type","body"]},"FilterEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user who created filter"},"type":{"type":"string"},"body":{"type":"object"}},"required":["fk_user_id","type","body"]},"TableEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user who triggered the event"},"type":{"type":"string","description":"The type of the event"},"body":{"type":"object","properties":{"title":{"type":"string","description":"The title of the table associated with the event"},"project_id":{"type":"string","description":"The ID of the project that the table belongs to"},"base_id":{"type":"string","description":"The ID of the base that the table belongs to"},"id":{"type":"string","description":"The ID of the table associated with the event"}},"required":["title","project_id","base_id","id"]}},"required":["fk_user_id","type","body"]},"ViewEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user who triggered the event"},"type":{"type":"string","description":"The type of the event"},"body":{"type":"object","properties":{"title":{"type":"string","description":"The title of the view associated with the event"},"project_id":{"type":"string","description":"The ID of the project that the view belongs to"},"base_id":{"type":"string","description":"The ID of the base that the view belongs to"},"id":{"type":"string","description":"The ID of the view associated with the event"},"fk_model_id":{"type":"string","description":"The ID of the model that the view is based on"}},"required":["title","project_id","base_id","id","fk_model_id"]}},"required":["fk_user_id","type","body"]},"ColumnEvent":{"type":"object","properties":{"fk_user_id":{"type":"string","description":"The ID of the user who triggered the event"},"type":{"type":"string","description":"The type of the event"},"body":{"type":"object","properties":{"title":{"type":"string","description":"The title of the column associated with the event"},"project_id":{"type":"string","description":"The ID of the project that the column belongs to"},"base_id":{"type":"string","description":"The ID of the base that the column belongs to"},"id":{"type":"string","description":"The ID of the column associated with the event"},"fk_model_id":{"type":"string","description":"The ID of the model that the column belongs to"}},"required":["title","project_id","base_id","id","fk_model_id"]}},"required":["fk_user_id","type","body"]},"Notification":{"allOf":[{"description":"","properties":{"id":{"$ref":"#/components/schemas/Id","description":"Unique ID"},"is_read":{"type":"boolean","description":"Whether the notification has been read by the user"},"is_deleted":{"type":"boolean","description":"Whether the notification has been deleted by the user"},"type":{"type":"string","description":"Type of notification"},"updated_at":{},"created_at":{}},"title":"Notification","type":"object"},{"oneOf":[{"$ref":"#/components/schemas/ProjectInviteEvent"},{"$ref":"#/components/schemas/ProjectEvent"},{"$ref":"#/components/schemas/TableEvent"},{"$ref":"#/components/schemas/ViewEvent"},{"$ref":"#/components/schemas/ColumnEvent"},{"$ref":"#/components/schemas/WelcomeEvent"},{"$ref":"#/components/schemas/SortEvent"},{"$ref":"#/components/schemas/FilterEvent"}]}]},"NotificationList":{"description":"Model for Notification List","examples":[{"list":[{"body":{},"type":"invite","is_read":false,"is_deleted":false,"id":"1","updated_at":"2020-05-20T12:00:00.000000Z","created_at":"2020-05-20T12:00:00.000000Z","fk_user_id":"us_b3xo2i44nx5y9l"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}],"title":"API Token List Model","type":"object","properties":{"list":{"type":"array","description":"List of notification objects","items":{"$ref":"#/components/schemas/Notification"}},"pageInfo":{"$ref":"#/components/schemas/Paginated","description":"Model for Paginated"}},"required":["list","pageInfo"]},"NotificationUpdate":{"type":"object","properties":{"is_read":{"type":"boolean"}}}},"responses":{"ProjectList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectList"},"examples":{"example-1":{"value":{"list":[{"bases":[{"alias":"string","config":null,"created_at":"2023-03-01 14:27:36","enabled":true,"id":"string","inflection_column":"camelize","inflection_table":"camelize","is_meta":true,"order":1,"project_id":"string","type":"mysql2","updated_at":"2023-03-01 14:27:36"}],"color":"#24716E","created_at":"2023-03-01 14:27:36","deleted":true,"description":"This is my project description","id":"p_124hhlkbeasewh","is_meta":true,"meta":{},"order":0,"prefix":"nc_vm5q__","status":"string","title":"my-project","updated_at":"2023-03-01 14:27:36"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"BaseList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BaseList"},"examples":{"example-1":{"value":{"list":[{"id":"ds_krsappzu9f8vmo","project_id":"p_01clqvzik3izk6","alias":null,"config":"<ENCRYPTED>","meta":null,"is_meta":1,"type":"mysql2","inflection_column":"camelize","inflection_table":"camelize","created_at":"2023-03-01 16:31:49","updated_at":"2023-03-02 11:28:17","enabled":1,"order":1},{"id":"ds_btbdt19zde0gj9","project_id":"p_01clqvzik3izk6","alias":"sakila","config":"<ENCRYPTED>","meta":null,"is_meta":null,"type":"mysql2","inflection_column":"camelize","inflection_table":"camelize","created_at":"2023-03-02 11:28:17","updated_at":"2023-03-02 11:28:17","enabled":1,"order":2}],"pageInfo":{"totalRows":2,"page":1,"pageSize":2,"isFirstPage":true,"isLastPage":true}}}}}}},"TableList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TableList"},"examples":{"Example 1":{"value":{"list":[{"id":"md_5hua2iqloqirhd","base_id":"ds_jxuewivwbxeum2","project_id":"p_tbhl1hnycvhe5l","table_name":"nc_b84e___Sheet-1","title":"Sheet-1","type":"table","meta":null,"schema":null,"enabled":true,"mm":false,"tags":null,"pinned":null,"deleted":null,"order":1,"created_at":"2023-03-11T09:11:45.907Z","updated_at":"2023-03-11T09:11:45.907Z"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"ColumnList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ColumnList"}}}},"FilterList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FilterList"}}}},"SortList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SortList"},"examples":{}}}},"ViewList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ViewList"},"examples":{"Example 1":{"value":{"list":[{"alias":"string","column":[{"alias":"string","auto_increment":true,"auto_update_timestamp":true,"base_id":"string","character_maximum_length":"string","character_set_name":"string","colOptions":{"deleted":"string","dr":"string","fk_child_column_id":"string","fk_column_id":"string","fk_index_name":"string","fk_mm_child_column_id":"string","fk_mm_model_id":"string","fk_mm_parent_column_id":"string","fk_parent_column_id":"string","id":"string","order":"string","type":"string","ur":"string","virtual":true},"column_comment":"string","column_default":"string","column_ordinal_position":"string","column_type":"string","data_type":"string","data_type_x":"string","data_type_x_precision":"string","data_type_x_scale":"string","deleted":true,"fk_model_id":"string","id":"string","numeric_precision":"string","numeric_scale":"string","order":0,"primary_key":true,"primary_value":true,"rqd":"string","title":"string","ui_data_type":"string","un":"string","unique":true,"visible":true}],"columnByIds":{},"deleted":true,"enabled":true,"fk_base_id":"string","fk_project_id":"string","id":"string","order":0,"parent_id":"string","pinned":true,"show_as":"string","tags":"string","title":"string","type":"string"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"SharedViewList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SharedViewList"},"examples":{"Example 1":{"value":{"list":[{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_model_id":"md_mhs9z4r2ak98x0","id":"vw_lg052cnc1c26kf","is_default":1,"lock_type":"collaborative","meta":{},"order":1,"password":null,"project_id":"p_xm3thidrblw4n7","show":1,"show_system_fields":null,"title":"Sheet-1","type":3,"updated_at":"2023-03-02 17:46:31","uuid":null,"view":{"base_id":"ds_g4ccx6e77h1dmi","created_at":"2023-03-02 17:46:31","fk_view_id":"vw_lg052cnc1c26kf","meta":null,"project_id":"p_xm3thidrblw4n7","row_height":null,"updated_at":"2023-03-02 17:46:31","uuid":null}}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"HookList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HookList"}}}},"UserList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserList"},"examples":{"Example 1":{"value":{"list":[{"email":"user@example.com","email_verified":true,"firstname":"Alice","id":"us_8kugj628ebjngs","lastname":"Smith","roles":"org-level-viewer"}],"pageInfo":{"isFirstPage":true,"isLastPage":true,"page":1,"pageSize":10,"totalRows":1}}}}}}},"APITokenList":{"description":"Example response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApiTokenList"},"examples":{}}},"type":"object","properties":{"list":{"type":"array","x-stoplight":{"id":"uukp6v55zfp7i"},"items":{"$ref":"#/components/schemas/ApiToken","x-stoplight":{"id":"9zqpoqfkdxy0y"}}},"pageInfo":{"$ref":"#/components/schemas/Paginated","x-stoplight":{"id":"6unr17jyisial"}}}},"BadRequest":{"description":"BadReqeust","content":{"application/json":{"schema":{"type":"object","properties":{"msg":{"type":"string","x-stoplight":{"id":"p9mk4oi0hbihm"},"example":"BadRequest [Error]: <ERROR MESSAGE>"}},"required":["msg"]},"examples":{"Example 1":{"value":{"msg":"BadRequest [Error]: <ERROR MESSAGE>"}}}}},"headers":{}}},"securitySchemes":{"xc-auth":{"name":"Auth Token ","type":"apiKey","in":"header","description":"Auth Token is a JWT Token generated based on the logged-in user. By default, the token is only valid for 10 hours. However, you can change the value by defining it using environment variable `NC_JWT_EXPIRES_IN`."},"xc-shared-base-id":{"name":"Shared Base ID","type":"apiKey","in":"header","description":"Shared base uuid"},"xc-shared-erd-id":{"name":"Shared ERD ID","type":"apiKey","in":"header","description":"Shared ERD uuid"}},"parameters":{"xc-auth":{"name":"xc-auth","in":"header","required":false,"schema":{"type":"string"},"description":"Auth Token is a JWT Token generated based on the logged-in user. By default, the token is only valid for 10 hours. However, you can change the value by defining it using environment variable NC_JWT_EXPIRES_IN."}}}}')},14233:e=>{e.exports=JSON.parse('{"openapi":"3.0.0","info":{"title":"nocodb","version":"1.0"},"servers":[{"url":"http://localhost:8080"}],"paths":{},"components":{"schemas":{"Paginated":{"title":"Paginated","type":"object","properties":{"pageSize":{"type":"integer"},"totalRows":{"type":"integer"},"isFirstPage":{"type":"boolean"},"isLastPage":{"type":"boolean"},"page":{"type":"number"}}},"Attachment":{"title":"Attachment","type":"object","properties":{"mimetype":{"type":"string"},"size":{"type":"integer"},"title":{"type":"string"},"url":{"type":"string"},"icon":{"type":"string"}}},"Groupby":{"title":"Groupby","type":"object","properties":{"count":{"type":"number","description":"count"},"column_name":{"type":"string","description":"the value of the given column"}}}},"securitySchemes":{"xcAuth":{"type":"apiKey","in":"header","name":"xc-auth","description":"JWT access token"},"xcToken":{"type":"apiKey","in":"header","name":"xc-token","description":"API token"}}},"security":[{"xcAuth":[]},{"xcToken":[]}]}')}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(a.exports,a,a.exports,__webpack_require__),a.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__(48848);return __webpack_exports__})()));