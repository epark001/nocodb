import{h as G,Z as H,r as s,$ as i,aq as q,i as I,cd as Q,cI as W,E as a,o as d,C as f,w as c,c as Z,cF as p,a as n,b,H as h,W as g,aV as J,d as X,t as V,Q as Y,R as ee,L as oe}from"./entry.51f4e399.js";import{_ as te}from"./Icon.vue.1162f18b.js";import{g as ae,M as ne,A as se,b as ie,R as le,d as re}from"./index.5263eb1d.js";import{a as de}from"./useKanbanViewStore.7f9b2a7a.js";import{u as ce}from"./index.f7e0da2d.js";import{f as pe}from"./useMetas.ba7abae7.js";import{u as me}from"./useViewColumns.96f2a704.js";import{D as ue}from"./index.252dc7b4.js";import{_ as _e}from"./index.5e746f62.js";import"./deepCompare.d32ec333.js";import"./dataUtils.edecace3.js";import"./useSmartsheetStore.1784ce8b.js";import"./views.28a76d89.js";import"./useSharedView.0db5f32b.js";import"./index.b9981e09.js";import"./index.9e760c64.js";import"./Dropdown.dc69c0a4.js";import"./RightOutlined.90e8180f.js";import"./toArray.06afb623.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./SearchOutlined.dec109ce.js";import"./FormItemContext.e001cd7c.js";const fe=Y(()=>ee(()=>import("./EditOrAddProvider.4cd8efcf.js"),["./EditOrAddProvider.4cd8efcf.js","./EditOrAddProvider.vue.09b12d8b.js","./entry.51f4e399.js","./entry.0f786d51.css","./Icon.vue.1162f18b.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./useBetaFeatureToggle.5dbba600.js","./index.5263eb1d.js","./index.e5ddde08.js","./validation.6db726f3.js","./useMetas.ba7abae7.js","./index.de92142d.js","./FormItem.cda40628.js","./identity.dd5da9ba.js","./_getPrototype.ec1165af.js","./Col.88cfabc0.js","./responsiveObserve.501a6cf9.js","./toArray.06afb623.js","./FormItemContext.e001cd7c.js","./useSize.3b3f469f.js","./_flatRest.ff2d3d5c.js","./isPlainObject.ecf52d25.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.dec109ce.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./index.0d6d8ba8.js","./Checkbox.a529f1e6.js","./createForOfIteratorHelper.12419aa5.js","./index.5e746f62.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./EditOrAddProvider.44ca9c5b.css"],import.meta.url).then(m=>m.default||m)),be={class:"nc-kanban-btn"},ge={class:"flex items-center gap-1"},ve={class:"text-capitalize !text-sm"},we={class:"font-bold ml-0.25"},ke=n("div",null,"Select a field to stack records by",-1),ye={class:"nc-fields-list py-2"},Ce={class:"grouping-field"},Ie={class:"mt-4 border-1 px-4 pt-4 pb-3 border-gray-50 rounded-2xl"},he=n("div",{class:"text-base font-medium mb-2"},"Options",-1),Ye=G({__name:"StackedBy",setup(m){H(ae,s(!0));const v=i(ne,s()),l=i(se,s()),x=i(ie,s(!1)),D=i(le),S=i(re,s(!1)),{fields:B,loadViewColumns:j,metaColumnById:F}=me(l,v,()=>D.trigger()),{kanbanMetaData:w,loadKanbanMeta:k,loadKanbanData:y,updateKanbanMeta:M,groupingField:E,groupingFieldColumn:K}=de(),{addUndo:O,defineViewScope:R}=pe(),t=s(!1);ce(t),q(()=>{var o;return(o=l.value)==null?void 0:o.id},async(o,e)=>{o!==e&&v.value&&await j()},{immediate:!0});const u=async o=>{var e;await M({fk_grp_col_id:o}),await k(),await y(),((e=l.value)==null?void 0:e.view).fk_grp_col_id=o},_=I({get:()=>w.value.fk_grp_col_id,set:async o=>{o&&(O({undo:{fn:await u,args:[w.value.fk_grp_col_id]},redo:{fn:await u,args:[o]},scope:R({view:l.value})}),await u(o))}}),A=I(()=>{var o;return(o=B.value)==null?void 0:o.filter(e=>e.fk_column_id&&F.value[e.fk_column_id].uidt===Q.SingleSelect).map(e=>({value:e.fk_column_id,label:e.title}))}),L=async()=>{t.value=!1,await k(),await y()},P=()=>{t.value=!1};return(o,e)=>{const C=te,U=oe,$=_e,N=fe,T=ue,z=W("e");return a(x)?g("",!0):(d(),f(T,{key:0,visible:a(t),"onUpdate:visible":e[6]||(e[6]=r=>h(t)?t.value=r:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu"},{overlay:c(()=>[a(t)?(d(),Z("div",{key:0,class:"p-6 w-90 bg-white shadow-lg nc-table-toolbar-menu !border-1 border-gray-50 rounded-2xl",onClick:e[5]||(e[5]=p(()=>{},["stop"]))},[ke,n("div",ye,[n("div",Ce,[b($,{value:a(_),"onUpdate:value":e[0]||(e[0]=r=>h(_)?_.value=r:null),class:"w-full nc-kanban-grouping-field-select",options:a(A),placeholder:"Select a Grouping Field",onChange:P,onClick:e[1]||(e[1]=p(()=>{},["stop"]))},{suffixIcon:c(()=>[b(C,{icon:"arrowDown",class:"text-gray-700"})]),_:1},8,["value","options"])])]),n("div",Ie,[he,a(t)?(d(),f(N,{key:0,column:a(K),"embed-mode":"","column-label":o.$t("general.changes"),"hide-title":"","hide-type":"","hide-additional-options":"",onCancel:e[2]||(e[2]=r=>t.value=!1),onSubmit:L,onClick:e[3]||(e[3]=p(()=>{},["stop"])),onKeydown:e[4]||(e[4]=p(()=>{},["stop"]))},null,8,["column","column-label"])):g("",!0)])])):g("",!0)]),default:c(()=>[n("div",be,[J((d(),f(U,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn",disabled:a(S)},{default:c(()=>[n("div",ge,[b(C,{icon:"layers",class:"mr-0.5"}),n("span",ve,[X(V(o.$t("activity.kanban.stackedBy"))+" ",1),n("span",we,V(a(E)),1)])])]),_:1},8,["disabled"])),[[z,["c:kanban:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{Ye as default};
