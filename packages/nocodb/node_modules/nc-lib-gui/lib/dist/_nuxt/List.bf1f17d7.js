import{M as E}from"./index.5263eb1d.js";import{h as O,A as j,r as W,$ as P,k as S,cI as J,o as r,c as v,a as i,t as a,E as p,aV as K,C as d,w as s,d as u,b as m,D as f,F as b,cF as T,W as R,I as Y,J as h,K as y,P as Z,L as q,_ as G,f as Q}from"./entry.51f4e399.js";import{p as F}from"./useMetas.ba7abae7.js";import{_ as U}from"./index.2b3cfde3.js";import{b as X,_ as oo,a as to}from"./index.5a908291.js";import"./index.0db47614.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isSymbol.b53bd26f.js";import"./index.09b19c06.js";import"./LeftOutlined.3bb8aa17.js";import"./RightOutlined.90e8180f.js";import"./index.5e746f62.js";import"./toArray.06afb623.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./SearchOutlined.dec109ce.js";import"./FormItemContext.e001cd7c.js";import"./useBreakpoint.a91853f1.js";import"./responsiveObserve.501a6cf9.js";import"./Col.88cfabc0.js";import"./eagerComputed.6062ac13.js";const eo={class:""},ao={class:"mb-2"},so={class:"float-left font-bold text-xl mt-2 mb-4"},io={key:0,class:""},no={class:"uppercase"},co={class:"text-xl normal-case"},lo={class:"text-gray-400 text-sm"},ro={class:"px-2"},po={class:"mr-2"},_o={class:"float-right pt-2 pr-1"},mo={key:1,class:"min-h-[75vh]"},uo=i("div",{class:"p-4 bg-gray-100 text-gray-600"}," Webhooks list is empty, create new webhook by clicking 'Create webhook' button. ",-1),ho=[uo],Jo=O({__name:"List",emits:["edit","add"],setup(ko,{emit:g}){const{t:N}=j(),{$api:_,$e:w}=Q(),n=W([]),x=P(E,W());async function D(){var t;try{const o=(await _.dbTableWebhook.list((t=x.value)==null?void 0:t.id)).list;n.value=o.map(c=>(c.notification=F(c.notification),c))}catch(o){h.error(await y(o))}}async function M(t,o){Z.confirm({title:`Do you want to delete '${t.title}'?`,wrapClassName:"nc-modal-hook-delete",okText:"Yes",okType:"danger",cancelText:"No",async onOk(){try{t.id&&await _.dbTableWebhook.delete(t.id),n.value.splice(o,1),h.success(N("msg.success.webhookDeleted")),n.value.length||(n.value=[])}catch(c){h.error(await y(c))}w("a:webhook:delete")}})}async function V(t){try{const o=await _.dbTableWebhook.create(t.fk_model_id,{...t,title:`${t.title} - Copy`,active:!1});if(o){w("a:webhook:copy");const c=(await _.dbTableWebhookFilter.read(t.id,{})).list;for(const l of c)await _.dbTableWebhookFilter.create(o.id,{comparison_op:l.comparison_op,comparison_sub_op:l.comparison_sub_op,fk_column_id:l.fk_column_id,fk_parent_id:l.fk_parent_id,is_group:l.is_group,logical_op:l.logical_op,value:l.value});o.notification=F(o.notification),n.value=[o,...n.value]}}catch(o){h.error(await y(o))}}return S(()=>{D()}),(t,o)=>{var $;const c=q,l=U,B=X,C=G,I=oo,H=to,L=J("e");return r(),v("div",eo,[i("div",ao,[i("div",so,a(($=p(x))==null?void 0:$.title)+" : Webhooks",1),K((r(),d(c,{class:"float-right !rounded-md nc-btn-create-webhook",type:"primary",size:"middle",onClick:o[0]||(o[0]=e=>g("add"))},{default:s(()=>[u(a(t.$t("activity.addWebhook")),1)]),_:1})),[[L,["c:webhook:add"]]])]),m(l),p(n).length?(r(),v("div",io,[m(H,{"item-layout":"horizontal","data-source":p(n),class:"cursor-pointer scrollbar-thin-primary"},{renderItem:s(({item:e,index:z})=>[m(I,{class:"p-2 nc-hook",onClick:k=>g("edit",e)},{extra:s(()=>{var k;return[i("div",null,[i("div",po,a(t.$t("labels.notifyVia"))+" : "+a((k=e==null?void 0:e.notification)==null?void 0:k.type),1),i("div",_o,[e.version==="v2"?(r(),d(C,{key:0,placement:"left"},{title:s(()=>[u(a(t.$t("activity.copyWebhook")),1)]),default:s(()=>[(r(),d(f(p(b).copy),{class:"text-xl nc-hook-copy-icon",onClick:T(A=>V(e),["stop"])},null,8,["onClick"]))]),_:2},1024)):R("",!0),m(C,{placement:"left"},{title:s(()=>[u(a(t.$t("activity.deleteWebhook")),1)]),default:s(()=>[(r(),d(f(p(b).delete),{class:"text-xl nc-hook-delete-icon",onClick:T(A=>M(e,z),["stop"])},null,8,["onClick"]))]),_:2},1024)])])]}),default:s(()=>[m(B,null,{description:s(()=>[i("span",no,a(e.event)+" "+a(e.operation.replace(/[A-Z]/g," $&")),1)]),title:s(()=>[i("div",co,[i("span",lo," ("+a(e.version)+") ",1),u(" "+a(e.title),1)])]),avatar:s(()=>[i("div",ro,[(r(),d(f(p(b).hook),{class:"text-xl"}))]),i("div",{class:Y(["px-2 text-white rounded",{"bg-green-500":e.active,"bg-gray-500":!e.active}])},a(e.active?"ON":"OFF"),3)]),_:2},1024)]),_:2},1032,["onClick"])]),_:1},8,["data-source"])])):(r(),v("div",mo,ho))])}}});export{Jo as default};
