import{h as J,A as K,r as b,cj as d,i as $,o as c,C as f,w as r,a as s,b as t,d as G,t as i,E as l,c as k,D as C,F as T,cA as H,I as Q,J as p,K as W,O as X,L as Y,P as Z,f as ee}from"./entry.13466615.js";import{g as se}from"./validation.5ed31fc1.js";import{u as oe}from"./useCopy.a0671815.js";import{u as te}from"./useDashboard.34dd8f64.js";import{_ as le}from"./send-outline.95d535cb.js";import{F as j}from"./index.6f605a00.js";import"./index.a8ef1b7e.js";import{I as ae}from"./Input.16966097.js";import{_ as re}from"./Title.f7235aba.js";import{_ as ie}from"./index.2c1df8bc.js";import{_ as ne}from"./FormItem.fe59dafe.js";import{S as ce,_ as me}from"./index.4385a501.js";import"./useSize.dec45296.js";import"./identity.b813b76e.js";import"./isSymbol.b9109ae5.js";import"./_flatRest.037bf8e3.js";import"./debounce.dbc9bf77.js";import"./toNumber.7aa6a805.js";import"./isPlainObject.4c0f42f1.js";import"./_getPrototype.00be30f0.js";import"./FormItemContext.27b2e5db.js";import"./SearchOutlined.c1eed30a.js";import"./TextArea.1bd4034f.js";import"./antInputDirective.8ac36ea7.js";import"./Password.d7b16461.js";import"./CheckOutlined.80115d65.js";import"./useMergedState.1cc2a884.js";import"./Col.23d910dc.js";import"./responsiveObserve.9209e727.js";import"./toArray.f6fa5a71.js";import"./isMobile.e2e89480.js";import"./useMemo.4991ab9d.js";import"./useState.a6853ebd.js";import"./DownOutlined.9cfe3e0c.js";const de={class:"flex flex-col"},pe={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 w-full"},ue={class:"px-2 mt-1.5"},_e={key:0,class:"flex flex-col mt-1 pb-5"},ve={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},fe=s("div",{class:"text-xs ml-0.5 mt-0.5"},"Copy Invite Token",-1),xe={class:"flex flex-row justify-between items-center py-1"},ge={class:"flex pl-2 text-green-700 text-xs"},ye={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2"},he={class:"flex flex-row justify-end mt-4 ml-2"},we={class:"flex flex-row justify-center items-center space-x-0.5"},be={class:"text-xs text-gray-600"},$e={key:1,class:"flex flex-col pb-4"},ke={class:"border-1 py-3 px-4 rounded-md mt-1"},Ce={class:"flex flex-row space-x-4"},Te={class:"flex flex-col w-3/4"},je={class:"ml-1 mb-1 text-xs text-gray-500"},Ue={class:"flex flex-col w-2/4"},Le={class:"ml-1 mb-1 text-xs text-gray-500"},Ve={class:"text-gray-500 text-xs whitespace-normal"},Be={class:"text-gray-500 text-xs whitespace-normal"},Ie={class:"flex flex-row justify-end"},Me={class:"flex flex-row justify-center items-center space-x-1.5"},vs=J({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(Re,{emit:u}){const{t:x}=K(),{$api:U,$e:_}=ee(),{copy:L}=oe(),{dashboardUrl:V}=te(),o=b({emails:"",role:d.OrgLevelViewer,invitationToken:void 0}),g=b(),B=j.useForm,I=$(()=>({emails:[se]})),{validateInfos:M}=B(o.value,I),R=async()=>{var e;_("a:org-user:invite",{role:o.value.role}),await((e=g.value)==null?void 0:e.validateFields());try{const a=await U.orgUsers.add({roles:o.value.role,email:o.value.emails});o.value.invitationToken=a.invite_token,u("reload"),p.success(x("msg.success.userAdded"))}catch(a){console.error(a),p.error(await W(a))}},v=$(()=>o.value.invitationToken?`${V.value}#/signup/${o.value.invitationToken}`:null),S=async()=>{if(v.value){try{await L(v.value),p.success(x("msg.success.shareableURLCopied"))}catch(e){p.error(e.message)}_("c:shared-base:copy-url")}},F=()=>{_("c:user:invite-more"),o.value.invitationToken=void 0,o.value.role=d.OrgLevelViewer,o.value.emails=""},O=e=>e==null?void 0:e.focus();return(e,a)=>{const D=re,N=X,m=Y,A=ie,y=le,E=ae,h=ne,w=ce,P=me,q=j,z=Z;return c(),f(z,{class:Q({active:e.show}),footer:null,centered:"",visible:e.show,closable:!1,width:"max(50vw, 44rem)","wrap-class-name":"nc-modal-invite-user",onCancel:a[3]||(a[3]=n=>u("closed"))},{default:r(()=>[s("div",de,[s("div",pe,[t(D,{class:"select-none",level:4},{default:r(()=>[G(i(e.$t("activity.inviteUser")),1)]),_:1}),t(m,{type:"text",class:"!rounded-md mr-1 -mt-1.5",onClick:a[0]||(a[0]=n=>u("closed"))},{icon:r(()=>[t(N,{"data-testid":"nc-root-user-invite-modal-close",class:"flex mx-auto"})]),_:1})]),s("div",ue,[l(o).invitationToken?(c(),k("div",_e,[s("div",ve,[(c(),f(C(l(T).account))),fe]),t(A,{class:"!mt-2",type:"success","show-icon":""},{message:r(()=>[s("div",xe,[s("div",ge,i(l(v)),1),t(m,{type:"text",class:"!rounded-md -mt-0.5",onClick:S},{icon:r(()=>[(c(),f(C(l(T).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),s("div",ye,i(e.$t("msg.info.userInviteNoSMTP"))+" "+i(l(o).invitationToken&&l(o).emails),1),s("div",he,[t(m,{size:"middle",outlined:"",onClick:F},{default:r(()=>[s("div",we,[t(y,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),s("div",be,i(e.$t("activity.inviteMore")),1)])]),_:1})])])):(c(),k("div",$e,[s("div",ke,[t(q,{ref_key:"formRef",ref:g,"validate-on-rule-change":!1,model:l(o),"validate-trigger":"onBlur",onFinish:R},{default:r(()=>[s("div",Ce,[s("div",Te,[t(h,H(l(M).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:"Please input email"}]}),{default:r(()=>[s("div",je,i(e.$t("datatype.Email"))+":",1),t(E,{ref:O,value:l(o).emails,"onUpdate:value":a[1]||(a[1]=n=>l(o).emails=n),size:"middle","validate-trigger":"onBlur",placeholder:e.$t("labels.email")},null,8,["value","placeholder"])]),_:1},16)]),s("div",Ue,[t(h,{name:"role",rules:[{required:!0,message:"Role required"}]},{default:r(()=>[s("div",Le,i(e.$t("labels.selectUserRole")),1),t(P,{value:l(o).role,"onUpdate:value":a[2]||(a[2]=n=>l(o).role=n),class:"nc-user-roles","dropdown-class-name":"nc-dropdown-user-role"},{default:r(()=>[t(w,{class:"nc-role-option",value:l(d).OrgLevelCreator,label:e.$t("objects.roleType.orgLevelCreator")},{default:r(()=>[s("div",null,i(e.$t("objects.roleType.orgLevelCreator")),1),s("span",Ve,i(e.$t("msg.info.roles.orgCreator")),1)]),_:1},8,["value","label"]),t(w,{class:"nc-role-option",value:l(d).OrgLevelViewer,label:e.$t("objects.roleType.orgLevelViewer")},{default:r(()=>[s("div",null,i(e.$t("objects.roleType.orgLevelViewer")),1),s("span",Be,i(e.$t("msg.info.roles.orgViewer")),1)]),_:1},8,["value","label"])]),_:1},8,["value"])]),_:1})])]),s("div",Ie,[t(m,{type:"primary",class:"!rounded-md","html-type":"submit"},{default:r(()=>[s("div",Me,[t(y,{class:"flex h-[0.8rem]"}),s("div",null,i(e.$t("activity.invite")),1)])]),_:1})])]),_:1},8,["model"])])]))])])]),_:1},8,["class","visible"])}}});export{vs as default};
