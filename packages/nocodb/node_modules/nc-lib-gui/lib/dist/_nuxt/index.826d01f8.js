var Pn=Object.defineProperty;var Fn=(v,w,l)=>w in v?Pn(v,w,{enumerable:!0,configurable:!0,writable:!0,value:l}):v[w]=l;var no=(v,w,l)=>(Fn(v,typeof w!="symbol"?w+"":w,l),l);import{z as On,cb as Ko,$ as ke,i as ge,r as x,cg as $t,fC as co,aq as Nt,ap as Wt,cd as G,fW as vt,fX as Fo,h as Yt,Z as dt,o as r,c as D,V as Gn,E as e,J as De,cq as Ye,A as To,S as Bn,B as ao,b4 as ut,cf as qt,fP as Oo,eX as Jt,fY as Hn,cW as Wn,f4 as Yn,K as jn,f3 as st,dg as qo,fZ as Un,f_ as Kn,a as _,T as uo,al as lo,c4 as Tn,f$ as qn,c1 as Jn,fp as Xn,k as Jo,g0 as Xt,l as po,cI as Go,b as ie,dD as Bo,w as I,C as S,aV as Fe,D as Dt,F as Et,d as Xe,W as ae,t as he,eW as Ho,I as xe,aj as We,cp as ct,H as pt,cF as Kt,bN as Wo,b5 as ot,g1 as Yo,fa as Zn,eV as Qn,fb as ea,Q as wt,R as ht,fD as Zt,M as ta,N as oa,c5 as na,p as Xo,e as Zo,f as aa,fI as Tt,g as la,cc as ra,d6 as ro}from"./entry.51f4e399.js";import{M as eo,b as Qo,R as jt,q as ia,m as sa,A as fo,F as en,f as ca,d as ua,r as tn,O as da,s as on,t as pa,c as fa,u as ma,l as va,v as wa,w as ha}from"./index.5263eb1d.js";import{e as Vt}from"./dataUtils.edecace3.js";import{a as mo}from"./useSmartsheetStore.1784ce8b.js";import{a as ga,u as _a}from"./useViewData.d5cf5dca.js";import{u as ya}from"./useSharedView.0db5f32b.js";import{a as nn}from"./useGridViewColumn.377be28c.js";import{u as an}from"./index.9e760c64.js";import{a as ln,p as Qt,u as rn,f as ba}from"./useMetas.ba7abae7.js";import{_ as xa}from"./Icon.vue.1162f18b.js";import{u as ka,_ as Ra}from"./EditOrAddProvider.vue.09b12d8b.js";import{i as io}from"./index.e5ddde08.js";import{u as Sa}from"./useCopy.3e897b55.js";import{u as Da}from"./views.28a76d89.js";import{S as $a}from"./index.c7116bd2.js";import{C as Ma}from"./index.0d6d8ba8.js";import{D as Ca,_ as Aa}from"./index.252dc7b4.js";import{S as Ea}from"./index.0db47614.js";import{_ as sn}from"./_plugin-vue_export-helper.c27b6911.js";import{_ as Na,C as Va}from"./index.9194faf6.js";import{_ as za}from"./index.d05e87a9.js";import"./index.b9981e09.js";import"./virtualCell.4dce1393.js";import"./Button.vue.793bcd1d.js";import"./useBetaFeatureToggle.5dbba600.js";import"./validation.6db726f3.js";import"./index.de92142d.js";import"./FormItem.cda40628.js";import"./identity.dd5da9ba.js";import"./isSymbol.b53bd26f.js";import"./_getPrototype.ec1165af.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./toArray.06afb623.js";import"./toNumber.9dc54e53.js";import"./FormItemContext.e001cd7c.js";import"./useSize.3b3f469f.js";import"./_flatRest.ff2d3d5c.js";import"./debounce.7d32c110.js";import"./isPlainObject.ecf52d25.js";import"./index.e760d172.js";import"./Input.7cb175ff.js";import"./antInputDirective.8ac36ea7.js";import"./SearchOutlined.dec109ce.js";import"./TextArea.442a25cb.js";import"./Password.d493e47a.js";import"./index.5e746f62.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./Input.c36cd06d.js";import"./Checkbox.a529f1e6.js";import"./createForOfIteratorHelper.12419aa5.js";import"./Dropdown.dc69c0a4.js";import"./RightOutlined.90e8180f.js";const La=(v,w)=>{const{api:l}=On(),{project:p}=Ko(ln()),{sharedView:R,fetchSharedViewData:W}=ya(),z=ke(eo),{gridViewCols:Re}=nn(),m=ge(()=>{const c=[];return Object.values(Re.value).forEach(s=>{var h;if(s.group_by){const $=(h=z==null?void 0:z.value.columns)==null?void 0:h.find(T=>T.id===s.fk_column_id);$&&c.push({column:$,sort:s.group_by_sort||"asc",order:s.group_by_order||1})}}),c.sort((s,h)=>(s.order??1/0)-(h.order??1/0)),c}),g=ge(()=>!!m.value.length),{isUIAllowed:B}=an(),{sorts:V,nestedFilters:L}=mo(),se=ke(Qo,x(!1)),ve=ke(jt,$t()),Y=10,k=x({key:"root",color:"root",count:0,column:{},nestedIn:[],paginationData:{page:1,pageSize:Y},nested:!0,children:[],root:!0});async function ne(c,s){s=s||k.value,s&&(s.paginationData.page=c,await A({offset:(c-1)*(s.paginationData.pageSize||Y)},s))}const pe=c=>c.map(s=>({row:{...s},oldRow:{...s},rowMeta:{}})),P=(c,s)=>s.uidt===G.Checkbox?c?vt.TRUE:vt.FALSE:c??vt.NULL,X=x(co.light),M=x(X.value[0]),J=()=>{const c=M.value,s=X.value.indexOf(M.value);return s===X.value.length-1?M.value=X.value[0]:M.value=X.value[s+1],c},F=(c,s)=>{var h,$;if(s)switch(s.uidt){case G.MultiSelect:{const T=(c==null?void 0:c.split(","))||[],Z=[];for(const ze of T){const ce=(h=s.colOptions.options)==null?void 0:h.find(it=>it.title===ze);ce&&Z.push(ce.color)}return Z.join(",")}case G.SingleSelect:{const T=($=s.colOptions.options)==null?void 0:$.find(Z=>Z.title===c);return T?T.color||J():"gray"}case G.Checkbox:return c?Fo.success:Fo.error;default:return c?J():"gray"}return c?J():"gray"},n=(c,s="")=>c.reduce((h,$)=>($.key===vt.NULL?h+=`${h.length?"~and":""}(${$.title},blank)`:$.column_uidt===G.Checkbox?h+=`${h.length?"~and":""}(${$.title},${$.key===vt.TRUE?"checked":"notchecked"})`:[G.Date,G.DateTime].includes($.column_uidt)?h+=`${h.length?"~and":""}(${$.title},eq,exactDate,${$.key})`:h+=`${h.length?"~and":""}(${$.title},eq,${$.key})`,h),s);async function A(c={},s){var ce,it,gt,et,_t;if(s=s||k.value,!((ce=p==null?void 0:p.value)!=null&&ce.id)||!((it=v.value)!=null&&it.id)||!((gt=v.value)!=null&&gt.fk_model_id)||!s)return;if(m.value.length===0){s.children=[];return}if(s.nestedIn.length>m.value.length)return;s.nestedIn.length===0&&(M.value=X.value[0]);const h=m.value[s.nestedIn.length],$=n(s.nestedIn,w==null?void 0:w.value);if(!h||!h.column.column_name||se.value&&!((et=R.value)!=null&&et.uuid))return;const T=se.value?await l.public.dataGroupBy(R.value.uuid,{offset:((s.paginationData.page??0)-1)*(s.paginationData.pageSize??Y),limit:s.paginationData.pageSize??Y,...c,where:$,sort:`${h.sort==="desc"?"-":""}${h.column.title}`,column_name:h.column.column_name,sortsArr:V.value,filtersArr:L.value}):await l.dbViewRow.groupBy("noco",p.value.id,v.value.fk_model_id,v.value.id,{offset:((s.paginationData.page??0)-1)*(s.paginationData.pageSize??Y),limit:s.paginationData.pageSize??Y,...c,...B("sortSync")?{}:{sortArrJson:JSON.stringify(V.value)},...B("filterSync")?{}:{filterArrJson:JSON.stringify(L.value)},where:`${$}`,sort:`${h.sort==="desc"?"-":""}${h.column.title}`,column_name:h.column.column_name}),Z=T.list.reduce((te,ue)=>{const Q=te.find(a=>a.key===P(ue[h.column.column_name],h.column));return Q?(Q.count+=+ue.count,Q.paginationData={page:1,pageSize:Y,totalRows:Q.count},te):(h.column.title&&h.column.column_name&&h.column.uidt&&te.push({key:P(ue[h.column.column_name],h.column),column:h.column,count:+ue.count,color:F(ue[h.column.column_name],h.column),nestedIn:[...s.nestedIn,{title:h.column.title,column_name:h.column.column_name,key:P(ue[h.column.column_name],h.column),column_uidt:h.column.uidt}],paginationData:{page:1,pageSize:Y,totalRows:+ue.count},nested:s.nestedIn.length<m.value.length-1}),te)},[]);s.children||(s.children=[]);for(const te of Z){const ue=(_t=s.children)==null?void 0:_t.find(Q=>Q.key===te.key);if(ue){te.paginationData={page:ue.paginationData.page||te.paginationData.page,pageSize:ue.paginationData.pageSize||te.paginationData.pageSize,totalRows:te.count},te.color=ue.color,Object.assign(ue,te);continue}s.children.push(te)}s.children=s.children.filter(te=>Z.find(ue=>ue.key===te.key)),s.count<=(s.paginationData.pageSize??Y)&&s.children.sort((te,ue)=>{const Q=Z.findIndex(u=>u.key===te.key),a=Z.findIndex(u=>u.key===ue.key);return Q-a}),s.paginationData=T.pageInfo;const ze=Math.max(1,Math.ceil(s.paginationData.totalRows/s.paginationData.pageSize));ze<s.paginationData.page&&await ne(ze,s)}async function i(c,s=!1){var Z,ze,ce;if(!((Z=p==null?void 0:p.value)!=null&&Z.id)||!((ze=v.value)!=null&&ze.id)||!((ce=v.value)!=null&&ce.fk_model_id)||c.children&&!s)return;c.paginationData||(c.paginationData={page:1,pageSize:Y});const h=n(c.nestedIn,w==null?void 0:w.value),$={offset:((c.paginationData.page??0)-1)*(c.paginationData.pageSize??Y),limit:c.paginationData.pageSize??Y,where:`${h}`},T=se.value?await W({sortsArr:V.value,filtersArr:L.value,...$}):await l.dbViewRow.list("noco",p.value.id,v.value.fk_model_id,v.value.id,{...$,...B("sortSync")?{}:{sortArrJson:JSON.stringify(V.value)},...B("filterSync")?{}:{filterArrJson:JSON.stringify(L.value)}});c.count=T.pageInfo.totalRows??0,c.rows=pe(T.list),c.paginationData=T.pageInfo}const Ze=async(c,s)=>{c.paginationData||(c.paginationData={page:1,pageSize:Y}),c.paginationData.page=s,await i(c,!0)},Qe=(c,s=0)=>{if(c=c||k.value,!!c&&(s<m.value.length?c.nested=!0:c.nested=!1,c.nested?c!=null&&c.rows&&(c.rows=[]):c!=null&&c.children&&(c.children=[]),!(s>m.value.length)))for(const h of c.children||[])Qe(h,s+1)};Nt(()=>m.value.length,async()=>{m.value.length>0&&(k.value.paginationData={page:1,pageSize:Y},k.value.column={},await A(),Qe(),Wt(()=>ve==null?void 0:ve.trigger()))},{immediate:!0});const Ne=(c,s,h=0)=>{var T;if(s=s||k.value,h>=c.length)return s;const $=(T=s.children)==null?void 0:T.find(Z=>Z.key===c[h].key);return $?$.nested?Ne(c,$,h+1):$:s},Ve=c=>Ne(c.nestedIn.slice(0,-1)),je=(c,s)=>{var h;if(c){if(c.count+=s,c.count===0){const $=Ve(c);$&&($.children=(h=$.children)==null?void 0:h.filter(T=>T.key!==c.key))}c.root||je(Ve(c),s)}},nt=(c,s,h=0)=>{var $;if(s=s||k.value,s.nested){const T=($=s.children)==null?void 0:$.find(Z=>{if(m.value[h].column.title)return Z.key===P(c.row[m.value[h].column.title],m.value[h].column)});return T?nt(c,T,h+1):{found:!1,group:s}}return{found:!0,group:s}},Ue=c=>{var s;c=c||k.value,c&&(!c.nested&&c.rows?c.rows.forEach(h=>{var T,Z,ze,ce;const $=nt(h);$.found?$.group!==c&&($.group&&((T=$.group.rows)==null||T.push(h),je($.group,1)),c&&((Z=c.rows)==null||Z.splice(c.rows.indexOf(h),1),je(c,-1))):(c&&((ze=c.rows)==null||ze.splice(c.rows.indexOf(h),1),je(c,-1)),(ce=$.group)!=null&&ce.children&&A({},$.group))}):(s=c.children)==null||s.forEach(h=>Ue(h)))};return{rootGroup:k,groupBy:m,isGroupBy:g,loadGroups:A,loadGroupData:i,loadGroupPage:Ze,groupWrapperChangePage:ne,redistributeRows:Ue}},Ia=Yt({__name:"TableDataCell",setup(v,{expose:w}){const l=x(),p=$t();return dt(ia,p),dt(sa,l),w({el:l}),(R,W)=>(r(),D("td",{ref_key:"el",ref:l,class:"select-none",onClick:W[0]||(W[0]=z=>e(p).trigger(z))},[Gn(R.$slots,"default")],512))}});class jo{constructor(w=null,l=null){no(this,"_start");no(this,"_end");this._start=w,this._end=l??this._start}isEmpty(){return this._start==null||this._end==null}isSingleCell(){var w,l,p,R;return!this.isEmpty()&&((w=this._start)==null?void 0:w.col)===((l=this._end)==null?void 0:l.col)&&((p=this._start)==null?void 0:p.row)===((R=this._end)==null?void 0:R.row)}isSingleRow(){var w,l;return!this.isEmpty()&&((w=this._start)==null?void 0:w.row)===((l=this._end)==null?void 0:l.row)}isCellInRange(w){return!this.isEmpty()&&w.row>=this.start.row&&w.row<=this.end.row&&w.col>=this.start.col&&w.col<=this.end.col}isRowInRange(w){return!this.isEmpty()&&w>=this.start.row&&w<=this.end.row}isColInRange(w){return!this.isEmpty()&&w>=this.start.col&&w<=this.end.col}get start(){var w,l,p,R;return{row:Math.min(((w=this._start)==null?void 0:w.row)??NaN,((l=this._end)==null?void 0:l.row)??NaN),col:Math.min(((p=this._start)==null?void 0:p.col)??NaN,((R=this._end)==null?void 0:R.col)??NaN)}}get end(){var w,l,p,R;return{row:Math.max(((w=this._start)==null?void 0:w.row)??NaN,((l=this._end)==null?void 0:l.row)??NaN),col:Math.max(((p=this._start)==null?void 0:p.col)??NaN,((R=this._end)==null?void 0:R.col)??NaN)}}startRange(w){this._start=w,this._end=w}endRange(w){this._end=w}clear(){this._start=null,this._end=null}}function Ht(v,w=!1,l=!1){var Re;const{to:p,value:R,column:W}=v,z=w?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ";if(R==="")return null;switch(p){case G.Number:{const m=Number(R);if(isNaN(m)){if(l)return null;throw new TypeError(`Cannot convert '${R}' to number`)}return m}case G.Rating:{const m=Number(R??0);if(isNaN(m)){if(l)return null;throw new TypeError(`Cannot convert '${R}' to rating`)}return m}case G.Checkbox:if(typeof R=="boolean")return R;if(typeof R=="string"){const m=R.trim().toLowerCase();if(m==="true"||m==="1")return!0;if(m==="false"||m==="0"||m==="")return!1}return null;case G.Date:{const m=Ye(R);if(!m.isValid()){if(l)return null;throw new Error("Not a valid date")}return m.format("YYYY-MM-DD")}case G.DateTime:{const m=Ye(R);if(!m.isValid()){if(l)return null;throw new Error("Not a valid datetime value")}return m.utc().format("YYYY-MM-DD HH:mm:ssZ")}case G.Time:{let m=Ye(R);if(m.isValid()||(m=Ye(R,"HH:mm:ss")),m.isValid()||(m=Ye(`1999-01-01 ${R}`)),!m.isValid()){if(l)return null;throw new Error("Not a valid time value")}return m.format(z)}case G.Year:{if(/^\d+$/.test(R))return+R;const m=Ye(R);if(m.isValid())return m.format("YYYY");if(l)return null;throw new Error("Not a valid year value")}case G.Attachment:{let m;try{m=Qt(R),m=Array.isArray(m)?m:[m]}catch{if(l)return null;throw new Error("Invalid attachment data")}if(m.some(L=>L&&!(L.url||L.data||L.path)))return null;const B={...{...v.appInfo.ee&&{maxNumberOfAttachments:Math.max(1,+v.appInfo.ncMaxAttachmentsAllowed||50)||50,maxAttachmentSize:Math.max(1,+v.appInfo.ncMaxAttachmentsAllowed||20)||20,supportedAttachmentMimeTypes:["*"]}},...Qt(W==null?void 0:W.meta)},V=[];for(const L of m){if(v.appInfo.ee){if(m.length>B.maxNumberOfAttachments){De.error(`You can only upload at most ${B.maxNumberOfAttachments} file${B.maxNumberOfAttachments>1?"s":""} to this cell.`);return}if(L.size>B.maxAttachmentSize*1024*1024){De.error(`The size of ${L.name} exceeds the maximum file size ${B.maxAttachmentSize} MB.`);continue}if(!B.supportedAttachmentMimeTypes.includes("*")&&!B.supportedAttachmentMimeTypes.includes(L.type)&&!B.supportedAttachmentMimeTypes.includes(L.type.split("/")[0])){De.error(`${L.name} has the mime type ${L.type} which is not allowed in this column.`);continue}}V.push(L)}return JSON.stringify(V)}case G.SingleSelect:case G.MultiSelect:{if(R==="")return null;const m=(((Re=W.colOptions)==null?void 0:Re.options)||[]).map(V=>V.title),B=R.split(",").filter(V=>m.includes(V));return B.length===0?null:B.join(",")}case G.LinkToAnotherRecord:case G.Lookup:case G.Rollup:case G.Formula:case G.QrCode:{if(l)return;throw new Error(`Unsupported conversion for ${p}`)}default:return R}}const so=0;function Pa(v,w,l,p,R,W,z,Re,m,g,B,V,L,se){const ve=x(v),{t:Y}=To(),{copy:k}=Sa(),{getMeta:ne}=rn(),{appInfo:pe}=Bn(),{isMysql:P,isPg:X}=ln(),M=x(p),J=x(!1),F=x(!1),n=ao(new jo),A=ao(new jo),i=ao({row:null,col:null}),Ze=ge(()=>{var a;return(a=e(w))==null?void 0:a.length}),Qe=ge(()=>!(i.row===null||i.col===null||isNaN(i.row)||isNaN(i.col)));function Ne(a,u){i.row===a&&i.col===u||(M.value=!1,i.row=a,i.col=u)}function Ve(a){const u=je(a),d=nt(a);return`${u} ${d}`}function je(a){var u;return((u=Qt(a==null?void 0:a.meta))==null?void 0:u.date_format)??Un[0]}function nt(a){var u;return((u=Qt(a==null?void 0:a.meta))==null?void 0:u.time_format)??Kn[0]}const Ue=(a,u)=>{let d=u.title&&a.row[u.title]||"";if(u.uidt===G.Checkbox&&(d=!!d),typeof d=="object"&&(d=JSON.stringify(d)),u.uidt===G.Formula&&(d=d.replace(/\b(\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}[+-]\d{2}:\d{2})\b/g,E=>Ye(E).utc().local().format("YYYY-MM-DD HH:mm"))),u.uidt===G.DateTime){d=d.replace(/["']/g,"");const E=P(u.base_id);let oe=Ye(d);if(oe.isValid()||(oe=Ye(d,E?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),d=oe.format(Ve(u)),!Ye(d).isValid())return""}if(u.uidt===G.Time){d=d.replace(/["']/g,"");const E=P(u.base_id),oe=X(u.base_id);let ee=Ye(d);if(ee.isValid()||(ee=Ye(d,E?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ssZ")),ee.isValid()||(ee=E||oe?Ye(d,"HH:mm:ss"):Ye(d)),!ee.isValid())return"";d=ee.format(nt(u))}return u.uidt===G.LongText&&(d=`"${d.replace(/\"/g,'""')}"`),d},c=(a,u)=>{let d="<table>",E="";const oe=[];return a.forEach((ee,Le)=>{let $e="<tr>";const Ke=[];u.forEach((Be,q)=>{const H=Ue(ee,Be);$e+=`<td>${H}</td>`,E=`${E}${H}${u.length-1!==q?"	":""}`,Ke.push(Be.uidt===G.LongText?H.replace(/^"/,"").replace(/"$/,"").replace(/""/g,'"'):H)}),d+=`${$e}</tr>`,a.length-1!==Le&&(E=`${E}
`),oe.push(Ke)}),d+="</table>",{html:d,text:E,json:oe}},s=async(a,u)=>{const{html:d,text:E}=c(a,u),oe=new Blob([d],{type:"text/html"}),ee=new Blob([E],{type:"text/plain"});return navigator.clipboard.write([new ClipboardItem({[oe.type]:oe,[ee.type]:ee})])};async function h(a){try{if(n.start!==null&&n.end!==null&&!n.isSingleCell()){const u=e(l).slice(n.start.row,n.end.row+1),d=e(w).slice(n.start.col,n.end.col+1);await s(u,d),De.success(Y("msg.info.copiedToClipboard"))}else{const u=(a==null?void 0:a.row)??i.row,d=(a==null?void 0:a.col)??i.col;if(u!=null&&d!=null){const E=e(l)[u],oe=e(w)[d],ee=Ue(E,oe);await k(ee),De.success(Y("msg.info.copiedToClipboard"))}}}catch{De.error(Y("msg.error.copyToClipboardError"))}}function $(a,u){return i.col===u&&i.row===a?!0:n.isCellInRange({row:a,col:u})}function T(a,u){return A._start===null||A._end===null||n.isCellInRange({row:a,col:u})?!1:A.isCellInRange({row:a,col:u})}const Z=(a,u,d=!1)=>!a||!u?(d&&De.info("Please select a cell to paste"),!1):st(u)||qo(u)?(d&&De.info(Y("msg.info.pasteNotSupported")),!1):u.ai?(d&&De.info(Y("msg.info.autoIncFieldNotEditable")),!1):u.pk&&!a.rowMeta.new?(d&&De.info(Y("msg.info.editingPKnotSupported")),!1):!0;function ze(a,u,d){if(F.value){const E=e(l)[u];if(!n._start||!n._end||E.rowMeta.new)return;A.endRange({row:u,col:n._end.col}),g==null||g(u,d);return}J.value&&(n.endRange({row:u,col:d}),g==null||g(u,d),a.preventDefault())}function ce(a,u,d){if(!(((a==null?void 0:a.button)!==so||(a==null?void 0:a.button)===so&&a.ctrlKey)&&$(u,d))){if(M.value||(J.value=!0),W.value=!1,a.preventDefault(),a.shiftKey){(i.col===null||i.row===null)&&n.startRange({row:u,col:d}),n.endRange({row:u,col:d});return}n.startRange({row:u,col:d}),(i.row!==u||i.col!==d)&&(i.row=null,i.col=null)}}const it=(a,u,d)=>{(!a.shiftKey||i.col===null||i.row===null)&&Ne(u,d),g==null||g(u,d)},gt=a=>{var u;if(F.value){if(F.value=!1,A._start===null||A._end===null)return;if(n._start!==null&&n._end!==null){const d={row:n._start.row,col:n._start.col},E=e(l).slice(n.start.row,n.end.row+1),oe=e(w).slice(n.start.col,n.end.col+1),ee=c(E,oe).json,Le=A._start.row<=A._end.row?1:-1;let $e=Le===1?0:ee.length-1;const Ke=[],Be=[];for(let q=A._start.row;Le===1?q<=A._end.row:q>=A._end.row;q+=Le){if($(q,n.start.col))continue;const H=e(l)[q];let le=0;for(let Ce=A.start.col;Ce<=A.end.col;Ce++){const re=e(w)[Ce];if(!Z(H,re)){le++;continue}Be.push(re.title);const Ae=Ht({value:ee[$e][le],to:re.uidt,column:re,appInfo:e(pe)},P((u=ve.value)==null?void 0:u.base_id),!0);Ae!==void 0&&(H.row[re.title]=Ae,Ke.push(H)),le++}Le===1?$e=$e<ee.length-1?$e+1:0:$e=$e>=1?$e-1:ee.length-1}L==null||L(Ke,Be).then(()=>{A._start===null||A._end===null||(n.startRange(d),n.endRange(A._end),Ne(d.row,d.col),A.clear())})}else A.clear();return}J.value&&(J.value=!1,setTimeout(()=>{n._start&&(i.row!==n._start.row||i.col!==n._start.col)&&Ne(n._start.row,n._start.col)},0))},et=async a=>{var d,E,oe,ee,Le,$e,Ke,Be,q,H,le,Ce,re,Ae,He,Oe,Ie,Pe,fe,Ge,yt,Mt,_e,Lt,at,kt,Se,It,Pt,Ft,Rt,Ot;if(await(B==null?void 0:B(a)))return!0;if(!Qe.value||i.row===null||i.col===null)return;const u=qt()?a.metaKey:a.ctrlKey;switch(a.key){case"Tab":a.preventDefault(),n.clear(),a.shiftKey?i.col>0?(i.col--,M.value=!1):i.row>0&&(i.row--,i.col=e(Ze.value)-1,M.value=!1):i.col<e(Ze.value)-1?(i.col++,M.value=!1):i.row<e(l).length-1&&(i.row++,i.col=0,M.value=!1),g==null||g();break;case"Enter":a.preventDefault(),n.clear(),m(e(l)[i.row],e(w)[i.col]);break;case"Delete":a.preventDefault(),n.isSingleCell()?(n.clear(),await z(i)):await Re();break;case"ArrowRight":a.preventDefault(),a.shiftKey?u?(M.value=!1,n.endRange({row:((d=n._end)==null?void 0:d.row)??i.row,col:e(Ze.value)-1}),g==null||g((E=n._end)==null?void 0:E.row,(oe=n._end)==null?void 0:oe.col)):(((ee=n._end)==null?void 0:ee.col)??i.col)<e(Ze.value)-1&&(M.value=!1,n.endRange({row:((Le=n._end)==null?void 0:Le.row)??i.row,col:((($e=n._end)==null?void 0:$e.col)??i.col)+1}),g==null||g((Ke=n._end)==null?void 0:Ke.row,(Be=n._end)==null?void 0:Be.col)):(n.clear(),i.col<e(Ze.value)-1&&(i.col++,n.startRange({row:i.row,col:i.col}),g==null||g(),M.value=!1));break;case"ArrowLeft":a.preventDefault(),a.shiftKey?u?(M.value=!1,n.endRange({row:((q=n._end)==null?void 0:q.row)??i.row,col:0}),g==null||g((H=n._end)==null?void 0:H.row,(le=n._end)==null?void 0:le.col)):(((Ce=n._end)==null?void 0:Ce.col)??i.col)>0&&(M.value=!1,n.endRange({row:((re=n._end)==null?void 0:re.row)??i.row,col:(((Ae=n._end)==null?void 0:Ae.col)??i.col)-1}),g==null||g((He=n._end)==null?void 0:He.row,(Oe=n._end)==null?void 0:Oe.col)):(n.clear(),i.col>0&&(i.col--,n.startRange({row:i.row,col:i.col}),g==null||g(),M.value=!1));break;case"ArrowUp":a.preventDefault(),a.shiftKey?u?(M.value=!1,n.endRange({row:0,col:((Ie=n._end)==null?void 0:Ie.col)??i.col}),g==null||g((Pe=n._end)==null?void 0:Pe.row,(fe=n._end)==null?void 0:fe.col)):(((Ge=n._end)==null?void 0:Ge.row)??i.row)>0&&(M.value=!1,n.endRange({row:(((yt=n._end)==null?void 0:yt.row)??i.row)-1,col:((Mt=n._end)==null?void 0:Mt.col)??i.col}),g==null||g((_e=n._end)==null?void 0:_e.row,(Lt=n._end)==null?void 0:Lt.col)):(n.clear(),i.row>0&&(i.row--,n.startRange({row:i.row,col:i.col}),g==null||g(),M.value=!1));break;case"ArrowDown":a.preventDefault(),a.shiftKey?u?(M.value=!1,n.endRange({row:e(l).length-1,col:((at=n._end)==null?void 0:at.col)??i.col}),g==null||g((kt=n._end)==null?void 0:kt.row,(Se=n._end)==null?void 0:Se.col)):(((It=n._end)==null?void 0:It.row)??i.row)<e(l).length-1&&(M.value=!1,n.endRange({row:(((Pt=n._end)==null?void 0:Pt.row)??i.row)+1,col:((Ft=n._end)==null?void 0:Ft.col)??i.col}),g==null||g((Rt=n._end)==null?void 0:Rt.row,(Ot=n._end)==null?void 0:Ot.col)):(n.clear(),i.row<e(l).length-1&&(i.row++,n.startRange({row:i.row,col:i.col}),g==null||g(),M.value=!1));break;default:{const Gt=e(l)[i.row],ft=e(w)[i.col];if((!e(M)||!Oo(ft))&&!Jt()&&(qt()?a.metaKey:a.ctrlKey))switch(a.keyCode){case 67:await h();break;case 65:n.startRange({row:0,col:0}),n.endRange({row:e(l).length-1,col:e(Ze.value)-1});break}if(e(M)||a.ctrlKey||a.altKey||a.metaKey)return!0;if(a.key.length===1){if(!e(R)&&!Gt.rowMeta.new)return De.info(Y("msg.info.updateNotAllowedWithoutPK"));Oo(ft)&&m(Gt,ft)&&ft.title&&(Gt.row[ft.title]="")}}break}},_t=()=>n.clear(),te=n.clear.bind(n),ue=async a=>{var d,E,oe,ee,Le,$e,Ke,Be;if(Jt()||Hn()||!Qe.value||e(M)||i.row===null||i.row===void 0||i.col===null||i.col===void 0)return;a.preventDefault();const u=((d=a.clipboardData)==null?void 0:d.getData("text/plain"))||"";try{if(u!=null&&u.includes(`
`)||u!=null&&u.includes("	")){const q=Wn.parse(u,{delimiter:"	",escapeChar:"\\"});if(q.errors.length>0)throw new Error(q.errors[0].message);const H=q.data,le=H.length,Ce=H[0].length,re=e(w).slice(i.col,i.col+Ce),Ae=e(l).slice(i.row,i.row+le),He=[];let Oe=0;for(let Ie=0;Ie<le;Ie++){const Pe=Ae[Ie];if(!Pe||Pe.rowMeta.new)break;Oe++;for(let fe=0;fe<Ce;fe++){const Ge=re[fe];if(!Z(Pe,Ge))continue;He.push(Ge.title);const yt=Ht({value:H[Ie][fe],to:Ge.uidt,column:Ge,appInfo:e(pe)},P((E=ve.value)==null?void 0:E.base_id),!0);yt!==void 0&&(Pe.row[Ge.title]=yt)}}await(L==null?void 0:L(Ae,He)),Oe>0&&(n.startRange({row:i.row,col:i.col}),n.endRange({row:i.row+Oe-1,col:i.col+Ce-1}))}else if(n.isSingleCell()){const q=e(l)[i.row],H=e(w)[i.col];if(H.uidt===G.LinkToAnotherRecord&&((oe=H.colOptions)==null?void 0:oe.type)===Yn.BELONGS_TO){const Ce=JSON.parse(u);q.row[H.title]=Ht({value:Ce,to:H.uidt,column:H,appInfo:e(pe)},P((ee=ve.value)==null?void 0:ee.base_id));const re=($e=(Le=ve.value)==null?void 0:Le.columns)==null?void 0:$e.find(He=>{var Oe;return He.id===((Oe=H.colOptions)==null?void 0:Oe.fk_child_column_id)}),Ae=await ne(H.colOptions.fk_related_model_id);return re?(q.row[re.title]=Vt(Ce,Ae.columns),await(V==null?void 0:V({...i,updatedColumnTitle:re.title}))):void 0}if(!Z(q,H,!0))return;const le=Ht({value:u,to:H.uidt,column:H,appInfo:e(pe)},P((Ke=ve.value)==null?void 0:Ke.base_id));le!==void 0&&(q.row[H.title]=le),await(V==null?void 0:V(i))}else{const q=n.start,H=n.end,le=Math.min(q.row,H.row),Ce=Math.max(q.row,H.row),re=Math.min(q.col,H.col),Ae=Math.max(q.col,H.col),He=e(w).slice(re,Ae+1),Oe=e(l).slice(le,Ce+1),Ie=[];for(const Pe of Oe)if(!(!Pe||Pe.rowMeta.new))for(const fe of He){if(!fe.title||!Z(Pe,fe))continue;Ie.push(fe.title);const Ge=Ht({value:u,to:fe.uidt,column:fe,appInfo:e(pe)},P((Be=ve.value)==null?void 0:Be.base_id),!0);Ge!==void 0&&(Pe.row[fe.title]=Ge)}await(L==null?void 0:L(Oe,Ie))}}catch(q){console.error(q),De.error(await jn(q))}};function Q(a){var u,d;(a==null?void 0:a.button)===so&&(F.value=!0,n._start&&n._end&&(A.startRange({row:(u=n._start)==null?void 0:u.row,col:n._start.col}),A.endRange({row:(d=n._end)==null?void 0:d.row,col:n._end.col})),a.preventDefault())}return ut(document,"keydown",et),ut(document,"mouseup",gt),ut(document,"paste",ue),ut(se,"mousedown",Q),{isCellActive:Qe,handleMouseDown:ce,handleMouseOver:ze,clearSelectedRange:te,copyValue:h,isCellSelected:$,activeCell:i,handleCellClick:it,resetSelectedRange:_t,selectedRange:n,makeActive:Ne,isCellInFillRange:T,isMouseDown:J,isFillMode:F}}const Fa={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Oa=_("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-6 4.1L14.1 6l1.4 1.4L16.9 6L18 7.1l-1.4 1.4L18 9.9L16.9 11l-1.4-1.4l-1.4 1.4L13 9.9l1.4-1.4L13 7.1m-6.8.6h5v1.5h-5V7.7m5.3 8.3h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2V16m6.5 1.2h-5v-1.5h5v1.5m0-2.4h-5v-1.5h5v1.5Z"},null,-1),Ga=[Oa];function Ba(v,w){return r(),D("svg",Fa,Ga)}const Ha={name:"mdi-calculator-variant",render:Ba},Wa={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ya=_("path",{fill:"currentColor",d:"M2 12a9 9 0 0 0 9 9c2.39 0 4.68-.94 6.4-2.6l-1.5-1.5A6.706 6.706 0 0 1 11 19c-6.24 0-9.36-7.54-4.95-11.95C10.46 2.64 18 5.77 18 12h-3l4 4h.1l3.9-4h-3a9 9 0 0 0-18 0Z"},null,-1),ja=[Ya];function Ua(v,w){return r(),D("svg",Wa,ja)}const Ka={name:"mdi-reload",render:Ua},Ta={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},qa=_("path",{fill:"currentColor",d:"M8.59 16.58L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.42Z"},null,-1),Ja=[qa];function Xa(v,w){return r(),D("svg",Ta,Ja)}const Za={name:"mdi-chevron-right",render:Xa},Qa={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},el=_("path",{fill:"currentColor",d:"M11 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2V2h9m-7 8v4h7v-4H4m0 6v4h7v-4H4M4 4v4h7V4H4m11 7h3V8h2v3h3v2h-3v3h-2v-3h-3v-2Z"},null,-1),tl=[el];function ol(v,w){return r(),D("svg",Qa,tl)}const nl={name:"mdi-table-column-plus-after",render:ol},al=wt(()=>ht(()=>import("./VirtualCell.44092918.js"),["./VirtualCell.44092918.js","./entry.51f4e399.js","./entry.0f786d51.css","./EditOrAddProvider.vue.09b12d8b.js","./Icon.vue.1162f18b.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./useBetaFeatureToggle.5dbba600.js","./index.5263eb1d.js","./index.e5ddde08.js","./validation.6db726f3.js","./useMetas.ba7abae7.js","./index.de92142d.js","./FormItem.cda40628.js","./identity.dd5da9ba.js","./_getPrototype.ec1165af.js","./Col.88cfabc0.js","./responsiveObserve.501a6cf9.js","./toArray.06afb623.js","./FormItemContext.e001cd7c.js","./useSize.3b3f469f.js","./_flatRest.ff2d3d5c.js","./isPlainObject.ecf52d25.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.dec109ce.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./index.0d6d8ba8.js","./Checkbox.a529f1e6.js","./createForOfIteratorHelper.12419aa5.js","./index.5e746f62.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./EditOrAddProvider.44ca9c5b.css","./virtualCell.4dce1393.js","./index.9e760c64.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./VirtualCell.23f24363.css"],import.meta.url).then(v=>v.default||v)),ll=wt(()=>ht(()=>import("./Cell.aa14ce01.js"),["./Cell.aa14ce01.js","./entry.51f4e399.js","./entry.0f786d51.css","./CellIcon.8a6080fd.js","./index.5263eb1d.js","./cell.1732684e.js","./useMetas.ba7abae7.js","./EditOrAddProvider.vue.09b12d8b.js","./Icon.vue.1162f18b.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./useBetaFeatureToggle.5dbba600.js","./index.e5ddde08.js","./validation.6db726f3.js","./index.de92142d.js","./FormItem.cda40628.js","./identity.dd5da9ba.js","./_getPrototype.ec1165af.js","./Col.88cfabc0.js","./responsiveObserve.501a6cf9.js","./toArray.06afb623.js","./FormItemContext.e001cd7c.js","./useSize.3b3f469f.js","./_flatRest.ff2d3d5c.js","./isPlainObject.ecf52d25.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.dec109ce.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./index.0d6d8ba8.js","./Checkbox.a529f1e6.js","./createForOfIteratorHelper.12419aa5.js","./index.5e746f62.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./EditOrAddProvider.44ca9c5b.css","./index.9e760c64.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./Cell.c77dfd55.css"],import.meta.url).then(v=>v.default||v)),rl=wt(()=>ht(()=>import("./VirtualCell.4b63c3ca.js"),["./VirtualCell.4b63c3ca.js","./entry.51f4e399.js","./entry.0f786d51.css","./index.5263eb1d.js","./virtualCell.4dce1393.js"],import.meta.url).then(v=>v.default||v)),il=wt(()=>ht(()=>import("./Cell.4f83cd62.js"),["./Cell.4f83cd62.js","./entry.51f4e399.js","./entry.0f786d51.css","./index.5263eb1d.js","./cell.1732684e.js","./useMetas.ba7abae7.js","./useSmartsheetRowStore.aafbb4bb.js","./deepCompare.d32ec333.js","./dataUtils.edecace3.js","./virtualCell.4dce1393.js","./index.b9981e09.js","./_plugin-vue_export-helper.c27b6911.js","./Cell.69966cf7.css"],import.meta.url).then(v=>v.default||v)),sl=wt(()=>ht(()=>import("./Row.ee5827e6.js"),["./Row.ee5827e6.js","./index.5263eb1d.js","./useSmartsheetRowStore.aafbb4bb.js","./entry.51f4e399.js","./entry.0f786d51.css","./deepCompare.d32ec333.js","./dataUtils.edecace3.js","./virtualCell.4dce1393.js","./index.b9981e09.js","./useMetas.ba7abae7.js","./useSmartsheetStore.1784ce8b.js","./views.28a76d89.js","./useSharedView.0db5f32b.js"],import.meta.url).then(v=>v.default||v)),cl=wt(()=>ht(()=>import("./Pagination.31c9fe70.js"),["./Pagination.31c9fe70.js","./entry.51f4e399.js","./entry.0f786d51.css","./index.5263eb1d.js","./sidebar.e289f4e1.js","./views.28a76d89.js","./useMetas.ba7abae7.js","./useSharedView.0db5f32b.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./FormItemContext.e001cd7c.js","./SearchOutlined.dec109ce.js","./isPlainObject.ecf52d25.js","./_getPrototype.ec1165af.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./index.09b19c06.js","./LeftOutlined.3bb8aa17.js","./RightOutlined.90e8180f.js","./index.5e746f62.js","./toArray.06afb623.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./useBreakpoint.a91853f1.js","./responsiveObserve.501a6cf9.js","./_plugin-vue_export-helper.c27b6911.js","./Pagination.9d252b04.css"],import.meta.url).then(v=>v.default||v)),zt=v=>(Xo("data-v-ca2e3234"),v=v(),Zo(),v),ul={key:0},dl={key:1,class:"nc-grid-header"},pl={class:"w-full h-full flex pl-5 pr-1 items-center","data-testid":"nc-check-all"},fl=zt(()=>_("span",{class:"flex-1"},null,-1)),ml={key:1,class:"text-gray-500"},vl=["data-col","data-title","onXcresize","onXcresizing"],wl={class:"w-full h-full flex items-center"},hl={class:"absolute top-0 left-0 h-10.25 border-b-1 border-r-1 border-gray-200 nc-grid-add-edit-column group"},gl={class:"h-full w-[60px] flex items-center justify-center"},_l={class:"flex flex-row items-center py-3"},yl=zt(()=>_("div",{class:"text-xs pl-2"},"Predict Columns",-1)),bl=["onClick"],xl={class:"text-xs pl-2"},kl={class:"text-red-500 text-xs pl-2"},Rl=zt(()=>_("div",{class:"text-xs pl-2"},"Predict Columns",-1)),Sl={class:"flex flex-row items-center py-3"},Dl=zt(()=>_("div",{class:"text-xs pl-2"},"Predict Formulas",-1)),$l=["onClick"],Ml={class:"text-xs pl-2"},Cl=zt(()=>_("div",{class:"text-xs pl-2"},"Predict Formulas",-1)),Al=["data-testid"],El=["data-testid"],Nl={class:"items-center flex gap-1 min-w-[60px]"},Vl=zt(()=>_("span",{class:"flex-1"},null,-1)),zl=["data-testid"],Ll=["onClick"],Il={key:1,class:"cursor-pointer flex items-center border-1 border-gray-100 active:ring rounded p-1 hover:bg-gray-50"},Pl={key:0,class:"w-full h-full"},Fl={class:"text-left pointer sticky left-0 !border-r-0"},Ol={class:"px-2 w-full flex items-center text-gray-500"},Gl=["colspan"],Bl={class:"nc-project-menu-item"},Hl={class:"nc-project-menu-item"},Wl={class:"nc-project-menu-item"},Yl={class:"nc-project-menu-item"},jl={class:"nc-project-menu-item"},Ul={class:"nc-project-menu-item"},Kl={class:"nc-project-menu-item text-red-600"},Tl={class:"nc-project-menu-item text-red-600"},ql={key:0,class:"flex flex-row justify-center item-center min-h-10"},Jl={key:0,class:"flex ml-1"},Xl={class:"flex items-center px-2 text-gray-600 hover:text-black"},Zl={class:"relative overflow-visible min-h-17 w-10"},Ql={class:"flex flex-row items-center justify-between w-full"},er={class:"flex flex-row items-center justify-start gap-x-3"},tr={class:"h-4 w-4 flex flex-row items-center justify-center"},or={class:"flex flex-row text-xs text-gray-400 ml-7.25"},nr={class:"flex flex-row items-center justify-between w-full"},ar={class:"flex flex-row items-center justify-start gap-x-2.5"},lr={class:"h-4 w-4 flex flex-row items-center justify-center"},rr={class:"flex flex-row text-xs text-gray-400 ml-7.05"},Uo=!1,ir=Yt({__name:"Table",props:{data:{},paginationData:{},loadData:{type:Function},changePage:{type:Function},callAddEmptyRow:{type:Function},deleteRow:{type:Function},updateOrSaveRow:{type:Function},selectedAllRecords:{type:Boolean},deleteRangeOfRows:{type:Function},rowHeight:{},expandForm:{type:Function},deleteSelectedRows:{type:Function},removeRowIfNew:{type:Function},bulkUpdateRows:{type:Function},headerOnly:{type:Boolean},hideHeader:{type:Boolean},pagination:{},disableSkeleton:{type:Boolean}},emits:["update:selectedAllRecords","bulkUpdateDlg","toggleOptimisedQuery"],setup(v,{expose:w,emit:l}){const p=v,R=uo(p,"selectedAllRecords",l),W=lo(p,"paginationData"),z=lo(p,"data"),Re=lo(p,"pagination"),{loadData:m,changePage:g,callAddEmptyRow:B,updateOrSaveRow:V,deleteRow:L,expandForm:se,deleteSelectedRows:ve,deleteRangeOfRows:Y,removeRowIfNew:k,bulkUpdateRows:ne,headerOnly:pe,hideHeader:P,disableSkeleton:X}=p,M=ke(eo,x()),J=ke(fo,x()),F=ke(en,x([])),n=ke(ca,x(!1)),A=ke(ua,x(!1)),i=ke(Qo,x(!1)),Ze=ke(tn,x(!1)),Qe=Tn(),Ne=ke(jt,$t()),Ve=ke(da,$t()),je=ke(on,x()),{isPkAvail:nt,isSqlView:Ue,eventBus:c}=mo(),{isViewDataLoading:s,isPaginationLoading:h}=Ko(Da()),{$e:$}=aa(),{t:T}=To(),{getMeta:Z}=rn(),{addUndo:ze,clone:ce,defineViewScope:it}=ba(),{predictingNextColumn:gt,predictedNextColumn:et,predictingNextFormulas:_t,predictedNextFormulas:te,predictNextColumn:ue,predictNextFormulas:Q}=ka().table,a=async()=>{await ue(M)},u=async()=>{await Q(M)},d=x(),E=x(null),oe=x(),ee=x(),Le=x(),$e=x(),Ke=x([]),Be=qn(oe),{hasRole:q}=Jn(),{isUIAllowed:H}=an(),le=ge(()=>H("xcDatatableEditable")),Ce=ge(()=>!n.value&&!A.value&&H("add-column")&&!Ue.value),re=x(!1),Ae=x(!1),He=x(!1),Oe=x(!1),Ie=x(),Pe=x(!1),fe=x(!0),Ge=x(!1),yt=x(!0),Mt=x(null),_e=x(!1),Lt=x(!1),at=ge({get:()=>Lt.value,set:t=>{le.value&&(Lt.value=t)}}),kt=x(!1),Se=x(null),It=(t,o)=>{Ue.value||(t.preventDefault(),o&&(Se.value=o))};async function Pt(t,o=!1){var U;if(!t||!le.value||!Ho(F.value[t.col])&&st(F.value[t.col]))return;if(((U=F.value[t.col])==null?void 0:U.uidt)===G.Links)return De.info("Links column clear is not supported yet");const f=z.value[t.row],O=F.value[t.col];if(st(O)){ze({undo:{fn:async(C,j,Me,ye)=>{var K,be,Te,rt;if(((K=W.value)==null?void 0:K.pageSize)===ye.pageSize){((be=W.value)==null?void 0:be.page)!==ye.page&&await(g==null?void 0:g(ye.page));const Ct=Vt(Me.row,(Te=M.value)==null?void 0:Te.columns),xt=z.value[C.row],tt=F.value[C.col];if(tt.title&&Ct===Vt(xt.row,(rt=M.value)==null?void 0:rt.columns)&&tt.id===j.id)xt.row[tt.title]=Me.row[tt.title],d.value&&(await d.value[C.row].addLTARRef(xt.row[tt.title],tt),await d.value[C.row].syncLTARRefs(xt.row)),y.col=C.col,y.row=C.row,me==null||me();else throw new Error("Record could not be found")}else throw new Error("Page size changed")},args:[ce(t),ce(O),ce(f),ce(W.value)]},redo:{fn:async(C,j,Me,ye)=>{var K,be,Te,rt;if(((K=W.value)==null?void 0:K.pageSize)===ye.pageSize){((be=W.value)==null?void 0:be.page)!==ye.page&&await(g==null?void 0:g(ye.page));const Ct=Vt(Me.row,(Te=M.value)==null?void 0:Te.columns),xt=z.value[C.row],tt=F.value[C.col];if(Ct===Vt(xt.row,(rt=M.value)==null?void 0:rt.columns)&&tt.id===j.id)d.value&&await d.value[C.row].clearLTARCell(tt),y.col=C.col,y.row=C.row,me==null||me();else throw new Error("Record could not be found")}else throw new Error("Page size changed")},args:[ce(t),ce(O),ce(f),ce(W.value)]},scope:it({view:J.value})}),d.value&&await d.value[t.row].clearLTARCell(O);return}if(O.title)switch(O.uidt){case G.Checkbox:f.row[O.title]=!1;break;case G.Rating:f.row[O.title]=0;break;default:f.row[O.title]=null;break}o||await(V==null?void 0:V(f,O.title))}function Ft(t,o){if(!(!le.value||_e.value||Uo||A.value||n.value||qo(o))){if(!nt.value&&!t.rowMeta.new){De.info(T("msg.info.updateNotAllowedWithoutPK"));return}if(o.ai){De.info(T("msg.info.autoIncFieldNotEditable"));return}if(o.pk&&!t.rowMeta.new){De.info(T("msg.info.editingPKnotSupported"));return}if(![G.SingleSelect,G.MultiSelect].includes(o.uidt))return _e.value=!0}}const Rt=ge(()=>!Uo&&!A.value&&le.value&&!Ue.value&&!i.value),Ot=ge(()=>{var t;return(t=F.value)==null?void 0:t.length}),Gt=ge(()=>{const t=[];return pe!==!0?je.value||t.push("nc-scrollbar-x-md overflow-auto"):t.push("overflow-visible"),s.value&&t.push("!overflow-hidden"),t.join(" ")}),ft=ge(()=>Array.from({length:40}).map(()=>({}))),Ut=ge(()=>X!==!0&&(s.value||h.value));function un(t){var o,f;(f=(o=ee.value)==null?void 0:o.querySelector("th:last-child"))==null||f.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{re.value=!0,Ie.value=t},500)}const wo=(t=!1)=>{Mt.value=null,re.value=!1,Ie.value={},t&&setTimeout(()=>{var f;const o=(f=ee.value)==null?void 0:f.querySelector("th:last-child");o&&o.scrollIntoView({behavior:"smooth"})},200)};async function ho(){const t=bt();t&&(se==null||se(t,void 0,!0))}const dn=()=>{A!=null&&A.value||Ve.trigger()},pn=()=>{fe.value=!0,bt()},go=()=>{fe.value=!1,dn()},_o=(t,o,f)=>{var Te,rt;const O=t.getBoundingClientRect(),U=o.getBoundingClientRect(),C=15,j=((Te=o.querySelector("thead th:nth-child(1)"))==null?void 0:Te.getBoundingClientRect().width)??0,Me=((rt=o.querySelector("thead th:nth-child(2)"))==null?void 0:rt.getBoundingClientRect().width)??0,ye=j+Me,K={top:O.top-U.top,right:O.right-U.right,bottom:O.bottom-U.bottom,left:O.left-U.left-ye},be={top:0,left:0};return be.left=K.right+((f==null?void 0:f.right)||0)>0?o.scrollLeft+K.right+((f==null?void 0:f.right)||0)+C:K.left-((f==null?void 0:f.left)||0)<0?o.scrollLeft+K.left-((f==null?void 0:f.left)||0)-C:o.scrollLeft,be.top=K.bottom+((f==null?void 0:f.bottom)||0)>0?o.scrollTop+K.bottom+((f==null?void 0:f.bottom)||0)+C:K.top-((f==null?void 0:f.top)||0)<0?o.scrollTop+K.top-((f==null?void 0:f.top)||0)-C:o.scrollTop,be},{isCellSelected:fn,activeCell:y,handleMouseDown:mn,handleMouseOver:vn,handleCellClick:wn,clearSelectedRange:lt,copyValue:hn,isCellActive:yo,resetSelectedRange:gn,makeActive:_n,selectedRange:de,isCellInFillRange:yn,isFillMode:bn}=Pa(M,F,z,_e,nt,at,Pt,ko,Ft,me,t=>{var U;if(document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active"))return t.preventDefault(),!0;if(Jt())return!0;const f=qt()?t.metaKey:t.ctrlKey,O=t.altKey;if(t.key===" "){if(yo.value&&!_e.value&&le.value&&y.row!==null){t.preventDefault();const C=z.value[y.row];return se==null||se(C),!0}}else if(t.key==="Escape"){if(_e.value)return _e.value=!1,!0}else if(t.key==="Enter"){if(t.shiftKey)return!0;if(_e.value)return _e.value=!1,!0}if(f){if(!yo.value||t.shiftKey)return;switch(t.key){case"ArrowUp":return t.preventDefault(),lt(),y.row=0,y.col=y.col??0,me==null||me(),_e.value=!1,!0;case"ArrowDown":return t.preventDefault(),lt(),y.row=z.value.length-1,y.col=y.col??0,me==null||me(),_e.value=!1,!0;case"ArrowRight":return t.preventDefault(),lt(),y.row=y.row??0,y.col=((U=F.value)==null?void 0:U.length)-1,me==null||me(),_e.value=!1,!0;case"ArrowLeft":return t.preventDefault(),lt(),y.row=y.row??0,y.col=0,me==null||me(),_e.value=!1,!0}}if(O)switch(t.keyCode){case 82:{Rt.value&&($("c:shortcut",{key:"ALT + R"}),bt(),y.row=z.value.length-1,y.col=0,gn(),Wt(()=>{var C;(C=document.querySelector("td.cell.active"))==null||C.scrollIntoView({behavior:"smooth"})}));break}case 67:{Ce.value&&($("c:shortcut",{key:"ALT + C"}),re.value=!0);break}}},async t=>{const o=z.value[t.row],f=t.col!==void 0?F.value[t.col]:null;!o||!f||!t.updatedColumnTitle&&st(f)||(z.value[t.row].rowMeta.isUpdatedFromCopyNPaste={...z.value[t.row].rowMeta.isUpdatedFromCopyNPaste,[t.updatedColumnTitle||f.title]:!0},await(V==null?void 0:V(o,t.updatedColumnTitle||f.title)))},ne,$e);function bo(t){lt(),_n(t??z.value.length-1,0),de.startRange({row:y.row,col:y.col}),me==null||me()}function bt(t){const o=B==null?void 0:B(t);return Wt().then(()=>{bo(t??z.value.length-1)}),o}const xn=t=>{try{L==null||L(t),de.isRowInRange(t)&&lt(),y.row===t&&(y.row=null,y.col=null)}catch(o){De.error(o.message)}},kn=()=>{Y==null||Y(de).then(()=>{lt(),y.row=null,y.col=null})};Xn(Le,t=>{if(Pe.value||at.value||y.row===null||y.col===null)return;const o=F.value[y.col];if(_e.value&&(st(o)||o.uidt===G.JSON)||bn.value)return;const f=document.querySelector(".nc-picker-datetime.active,.nc-dropdown-single-select-cell.active,.nc-dropdown-multi-select-cell.active,.nc-picker-date.active,.nc-picker-year.active,.nc-picker-time.active");t.target&&f&&(f===t.target||f!=null&&f.contains(t.target))||Jt()||(lt(),y.row=null,y.col=null)});const xo=t=>{if(!(y.row===null||y.col===null)){switch(_e.value=!1,lt(),t){case Zt.NEXT:y.row<z.value.length-1||bt(),y.row++;break;case Zt.PREV:y.row>0&&y.row--;break}Wt(()=>{me()})}};async function ko(){if(!le.value)return;const t=de.start,o=de.end,f=Math.min(t.row,o.row),O=Math.max(t.row,o.row),U=Math.min(t.col,o.col),C=Math.max(t.col,o.col),j=F.value.slice(U,C+1),Me=z.value.slice(f,O+1),ye=[];for(const K of Me)for(const be of j)!K||!be||!be.title||st(be)||(K.row[be.title]=null,ye.push(be.title));await(ne==null?void 0:ne(Me,ye))}const mt=ge(()=>je.value||oe.value);function me(t,o){var f,O;if(t=t??y.row,o=o??y.col,t!==null&&o!==null){const U=(f=Le.value)==null?void 0:f.querySelectorAll("tr"),C=(O=U==null?void 0:U[t])==null?void 0:O.querySelectorAll("td"),j=C==null?void 0:C[o===0?0:o+1];if(!j||!mt.value)return;const{height:Me}=ee.value.getBoundingClientRect(),ye=_o(j,mt.value,{top:Me||40,bottom:9,right:9});if(o===0&&(ye.left=0),U&&t===U.length-2){const K=U[U.length-1]||U[U.length-2],be=_o(K,mt.value,{top:Me||40,bottom:9,right:9});mt.value.scrollTo({top:be.top,left:C&&o===C.length-2?mt.value.scrollWidth:ye.left,behavior:"smooth"});return}if(C&&o===C.length-2){mt.value.scrollTo({top:ye.top,left:mt.value.scrollWidth,behavior:"smooth"});return}mt.value.scrollTo({top:ye.top,left:ye.left,behavior:"smooth"})}}const to=async(t={})=>{var f,O,U;let o=-1;for(const C of t.data||z.value){if(o++,C.rowMeta.new){const j=(O=(f=d.value)==null?void 0:f[o])==null?void 0:O.syncLTARRefs,Me=await(V==null?void 0:V(C,"",{},t));await(j==null?void 0:j(Me,t)),C.rowMeta.changed=!1;continue}if(C.rowMeta.changed){C.rowMeta.changed=!1;for(const j of((U=t.metaValue||M.value)==null?void 0:U.columns)??[])st(j)||j.uidt===G.Attachment||j.title in C.row&&C.row[j.title]!==C.oldRow[j.title]&&await(V==null?void 0:V(C,j.title,{},t))}}},{updateGridViewColumn:Rn,resizingColWidth:Sn,resizingCol:Ro}=nn(),Dn=(t,o)=>{t&&Rn(t,{width:o.detail})},$n=(t,o)=>{t&&(Ro.value=t,Sn.value=o.detail)},So=(t,o,f)=>{Ie.value={title:t,uidt:o,colOptions:f},He.value=!1},Do=x(),$o=x(),oo=()=>{Wt(()=>{const t=document.querySelector(".last-cell");if(t){const o=t.getBoundingClientRect();if(!o||!oe.value)return;Do.value=o.top+o.height-Be.top.value+oe.value.scrollTop,$o.value=o.left+o.width-Be.left.value+oe.value.scrollLeft}})},Mn=ge(()=>{var t,o;return!n.value&&!A.value&&!_e.value&&(!de.isEmpty()||y.row!==null&&y.col!==null)&&!((o=(t=z.value[(isNaN(de.end.row)?y.row:de.end.row)??-1])==null?void 0:t.rowMeta)!=null&&o.new)});Nt([()=>de.end.row,()=>de.end.col,()=>y.row,()=>y.col],([t,o,f,O],[U,C,j,Me])=>{(t!==U||o!==C||f!==j||O!==Me)&&oo()}),Jo(()=>{const t=new ResizeObserver(()=>{var o;oo(),y.row!==null&&!((o=z.value)!=null&&o[y.row])&&(lt(),y.row=null,y.col=null)});E.value&&t.observe(E.value)}),c.on(async(t,o)=>{t===Xt.FIELD_ADD&&(Mt.value=o,re.value=!0),t===Xt.CLEAR_NEW_ROW&&(k!=null&&k(o))&&(lt(),y.row=null,y.col=null)});async function Mo(t){var o,f,O;if((o=et.value)!=null&&o.length){const U=(O=(f=M.value)==null?void 0:f.columns)==null?void 0:O.map(C=>C.title);et.value=et.value.filter(C=>!(U!=null&&U.includes(C.title)))}await to(),yt.value=!!t,await(m==null?void 0:m()),yt.value=!0}ut(mt,"scroll",()=>{oo()}),ut(document,"mousedown",t=>{var o,f;(t.offsetX>((o=t.target)==null?void 0:o.clientWidth)||t.offsetY>((f=t.target)==null?void 0:f.clientHeight))&&(Pe.value=!0)}),ut(document,"mouseup",()=>{setTimeout(()=>{Pe.value=!1},100)}),ut(document,"keydown",async t=>{t.key==="Alt"&&(Ae.value=!0)}),ut(document,"keyup",async t=>{t.key==="Alt"&&(Ae.value=!1,Oe.value=!1)}),ut(document,"keydown",async t=>{const o=qt()?t.metaKey:t.ctrlKey;if(t.altKey&&!t.shiftKey&&!o)switch(t.keyCode){case 78:{Rt.value&&bt();break}}}),po(async()=>{const t=J.value,o=z.value;t&&Z(t.fk_model_id,!1,!0).then(f=>{const O=f;O&&to({metaValue:O,viewMetaValue:t,data:o})}),Ne==null||Ne.off(Mo),Ve==null||Ve.off(ho)}),Ne==null||Ne.on(Mo),Ve==null||Ve.on(ho),Nt(at,()=>{at.value?kt.value=!1:(kt.value=!0,Se.value=null)}),Nt(()=>Qe.params.viewId,()=>{s.value=!0}),Nt(J,async(t,o)=>{try{if(t&&t.id!==(o==null?void 0:o.id)&&(t.fk_model_id===Qe.params.viewId||i.value)){if(Ge.value=!0,o!=null&&o.id){const f=await Z(o.fk_model_id,!1,!0);f&&await to({viewMetaValue:o,metaValue:f,data:z.value})}s.value=!0;try{await(m==null?void 0:m())}catch(f){console.log(f),De.error("Error loading data")}finally{s.value=!1}}}catch(f){console.log(f)}finally{Ge.value=!1}},{immediate:!0}),dt(pa,Oe),w({scrollToRow:bo,openColumnCreate:un});const Co=(t,o)=>{se&&se(t,o),y.row=null,y.col=null,de.clear()};return(t,o)=>{var Ao,Eo,No;const f=$a,O=Ma,U=al,C=ll,j=xa,Me=nl,ye=Za,K=ta,be=Ka,Te=oa,rt=na,Ct=Ha,xt=Ra,tt=Ca,Cn=Ea,An=rl,En=il,Nn=Ia,Vn=sl,zn=Aa,Ln=cl,In=Go("xc-ver-resize"),qe=Go("e");return r(),D("div",{class:xe(["flex flex-col",`${e(pe)!==!0?"h-full w-full":""}`])},[_("div",{ref_key:"gridWrapper",ref:oe,class:xe(["nc-grid-wrapper min-h-0 flex-1 relative",e(Gt)])},[ie(tt,{visible:e(at),"onUpdate:visible":o[22]||(o[22]=b=>pt(at)?at.value=b:null),trigger:e(Ue)?[]:["contextmenu"],"overlay-class-name":"nc-dropdown-grid-context-menu"},Bo({default:I(()=>[_("div",{class:xe(["table-overlay",{"nc-grid-skelton-loader":e(Ut)}])},[_("table",{ref_key:"smartTable",ref:E,class:"xc-row-table nc-grid backgroundColorDefault !h-auto bg-white",onContextmenu:It},[Fe(_("thead",{ref_key:"tableHeadEl",ref:ee},[e(Ut)?(r(),D("tr",ul,[(r(!0),D(We,null,ct(e(ft),(b,N)=>(r(),D("td",{key:N,class:xe(["!bg-gray-50 h-full",{"min-w-50":N!==0,"min-w-21.25":N===0}])},[ie(f,{active:!0,title:!0,paragraph:!1,class:xe(["ml-2 -mt-2",{"max-w-32":N!==0,"max-w-5 !ml-3.5":N===0}])},null,8,["class"])],2))),128))])):(r(),D("tr",dl,[_("th",{class:"w-[85px] min-w-[85px]","data-testid":"grid-id-column",onDblclick:()=>{}},[_("div",pl,[e(n)?(r(),D("div",ml,"#")):(r(),D(We,{key:0},[_("div",{class:xe(["nc-no-label text-gray-500",{hidden:e(R)}])},"#",2),_("div",{class:xe([{hidden:!e(R),flex:e(R)},"nc-check-all w-full items-center"])},[ie(O,{checked:e(R),"onUpdate:checked":o[0]||(o[0]=b=>pt(R)?R.value=b:null)},null,8,["checked"]),fl],2)],64))])],32),(r(!0),D(We,null,ct(e(F),b=>Fe((r(),D("th",{key:b.title,"data-col":b.id,"data-title":b.title,onXcresize:N=>Dn(b.id,N),onXcresizing:N=>$n(b.title,N),onXcresized:o[1]||(o[1]=N=>Ro.value=null)},[_("div",wl,[e(st)(b)?(r(),S(U,{key:0,column:b,"hide-menu":e(n)},null,8,["column","hide-menu"])):(r(),S(C,{key:1,column:b,"hide-menu":e(n)},null,8,["column","hide-menu"]))])],40,vl)),[[In]])),128)),e(Ce)?Fe((r(),D("th",{key:0,class:"cursor-pointer !border-0 relative",style:{borderWidth:"0px !important"},onClick:o[9]||(o[9]=Kt(b=>re.value=!0,["stop"]))},[_("div",hl,[ie(tt,{visible:e(re),"onUpdate:visible":o[7]||(o[7]=b=>pt(re)?re.value=b:null),trigger:["click"],"overlay-class-name":"nc-dropdown-grid-add-column",onVisibleChange:o[8]||(o[8]=b=>He.value=e(Ae))},Bo({default:I(()=>[_("div",gl,[e(io)&&(e(Ae)||e(He))?(r(),S(j,{key:0,icon:"magic",class:"text-sm text-orange-400"})):ae("",!0),(r(),S(Dt(e(Et).plus),{class:"text-base nc-column-add text-gray-500 !group-hover:text-black"}))])]),_:2},[e(io)&&e(He)?{name:"overlay",fn:I(()=>[ie(Te,null,{default:I(()=>{var b;return[(b=e(et))!=null&&b.length?(r(),S(rt,{key:"predict-column"},{title:I(()=>[_("div",_l,[ie(Me,{class:"flex h-[1rem] text-gray-500"}),yl,ie(ye,{class:"text-gray-500 ml-2"})])]),expandIcon:I(()=>[]),default:I(()=>[ie(Te,null,{default:I(()=>[(r(!0),D(We,null,ct(e(et),N=>(r(),S(K,{key:`predict-${N.title}-${N.type}`},{default:I(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:St=>So(N.title,N.type)},[_("div",xl,he(N.title),1)],8,bl)]),_:2},1024))),128)),ie(K,null,{default:I(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:a},[_("div",kl,[ie(be),Xe(" Generate Again ")])])]),_:1})]),_:1})]),_:1})):(r(),S(K,{key:1},{default:I(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:a},[e(gt)?(r(),S(be,{key:0,class:"animate-infinite animate-spin"})):(r(),S(Me,{key:1,class:"flex h-[1rem] text-gray-500"})),Rl])]),_:1})),e(te)?(r(),S(rt,{key:"predict-formula"},{title:I(()=>[_("div",Sl,[ie(Ct,{class:"flex h-[1rem] text-gray-500"}),Dl,ie(ye,{class:"text-gray-500 ml-2"})])]),expandIcon:I(()=>[]),default:I(()=>[ie(Te,null,{default:I(()=>[(r(!0),D(We,null,ct(e(te),N=>(r(),S(K,{key:`predict-${N.title}-formula`},{default:I(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:St=>So(N.title,"Formula",{formula_raw:N.formula})},[_("div",Ml,he(N.title),1)],8,$l)]),_:2},1024))),128))]),_:1})]),_:1})):(r(),S(K,{key:3},{default:I(()=>[_("div",{class:"flex flex-row items-center py-3",onClick:u},[e(_t)?(r(),S(be,{key:0,class:"animate-infinite animate-spin"})):(r(),S(Ct,{key:1,class:"flex h-[1rem] text-gray-500"})),Cl])]),_:1}))]}),_:1})]),key:"0"}:{name:"overlay",fn:I(()=>[e(re)?(r(),S(xt,{key:0,preload:e(Ie),"column-position":e(Mt),onSubmit:o[2]||(o[2]=b=>wo(!0)),onCancel:o[3]||(o[3]=b=>wo()),onClick:o[4]||(o[4]=Kt(()=>{},["stop"])),onKeydown:o[5]||(o[5]=Kt(()=>{},["stop"])),onMounted:o[6]||(o[6]=b=>Ie.value=void 0)},null,8,["preload","column-position"])):ae("",!0)]),key:"1"}]),1032,["visible"])])])),[[qe,["c:column:add"]]]):ae("",!0)]))],512),[[Wo,e(P)!==!0]]),e(pe)!==!0?(r(),D("tbody",{key:0,ref_key:"tableBodyEl",ref:Le},[e(Ut)?(r(!0),D(We,{key:0},ct(e(ft),(b,N)=>(r(),D("tr",{key:N},[(r(!0),D(We,null,ct(e(ft),(St,At)=>(r(),D("td",{key:At,class:xe({"min-w-50":At!==0,"min-w-21.25":At===0})},null,2))),128))]))),128)):(r(!0),D(We,{key:1},ct(e(z),(b,N)=>(r(),S(Vn,{ref_for:!0,ref_key:"rowRefs",ref:d,key:N,row:b},{default:I(({state:St})=>{var At,Vo,zo,Lo;return[_("tr",{class:"nc-grid-row",style:ot({height:t.rowHeight?`${t.rowHeight*1.8}rem`:"1.8rem"}),"data-testid":`grid-row-${N}`},[_("td",{key:"row-index",class:"caption nc-grid-cell pl-5 pr-1","data-testid":`cell-Id-${N}`,onContextmenu:o[10]||(o[10]=we=>Se.value=null)},[_("div",Nl,[!e(n)||!e(A)?(r(),D("div",{key:0,class:xe(["nc-row-no text-xs text-gray-500",{toggle:!e(n),hidden:b.rowMeta.selected}])},he(((((At=e(W))==null?void 0:At.page)??1)-1)*(((Vo=e(W))==null?void 0:Vo.pageSize)??25)+N+1),3)):ae("",!0),e(n)?ae("",!0):(r(),D("div",{key:1,class:xe([{hidden:!b.rowMeta.selected,flex:b.rowMeta.selected},"nc-row-expand-and-checkbox"])},[ie(O,{checked:b.rowMeta.selected,"onUpdate:checked":we=>b.rowMeta.selected=we},null,8,["checked","onUpdate:checked"])],2)),Vl,!e(n)||e(q)("commenter",!0)||e(q)("viewer",!0)||e(q)(e(Yo).COMMENTER,!0)||e(q)(e(Yo).VIEWER,!0)?(r(),D("div",{key:2,class:xe(["nc-expand",{"nc-comment":(zo=b.rowMeta)==null?void 0:zo.commentCount}]),"data-testid":`nc-expand-${N}`},[b.rowMeta.saving?(r(),S(Cn,{key:0,class:"!flex items-center","data-testid":`row-save-spinner-${N}`},null,8,["data-testid"])):e(A)?ae("",!0):(r(),D(We,{key:1},[(Lo=b.rowMeta)!=null&&Lo.commentCount&&e(se)?(r(),D("span",{key:0,class:"py-1 px-3 rounded-full text-xs cursor-pointer select-none transform hover:scale-110",style:ot({backgroundColor:e(co).light[b.rowMeta.commentCount%e(co).light.length]}),onClick:we=>Co(b,St)},he(b.rowMeta.commentCount),13,Ll)):(r(),D("div",Il,[e(se)?Fe((r(),S(Dt(e(Et).expand),{key:0,class:"select-none transform hover:text-black hover:scale-120 nc-row-expand",onClick:we=>Co(b,St)},null,8,["onClick"])),[[qe,["c:row-expand"]]]):ae("",!0)]))],64))],10,zl)):ae("",!0)])],40,El),(r(!0),D(We,null,ct(e(F),(we,Je)=>{var Io,Po;return r(),S(Nn,{key:we.id,ref_for:!0,ref_key:"cellRefs",ref:Ke,class:xe(["cell relative nc-grid-cell",{"cursor-pointer":e(le),active:e(le)&&e(fn)(N,Je),"active-cell":e(le)&&(e(y).row===N&&e(y).col===Je||((Io=e(de)._start)==null?void 0:Io.row)===N&&((Po=e(de)._start)==null?void 0:Po.col)===Je),"last-cell":N===(isNaN(e(de).end.row)?e(y).row:e(de).end.row)&&Je===(isNaN(e(de).end.col)?e(y).col:e(de).end.col),"nc-required-cell":e(Zn)(we,b.row)&&!e(i),"align-middle":!t.rowHeight||t.rowHeight===1,"align-top":t.rowHeight&&t.rowHeight!==1,filling:e(yn)(N,Je)}]),"data-testid":`cell-${we.title}-${N}`,"data-key":`data-key-${N}-${we.id}`,"data-col":we.id,"data-title":we.title,"data-row-index":N,"data-col-index":Je,onMousedown:Ee=>e(mn)(Ee,N,Je),onMouseover:Ee=>e(vn)(Ee,N,Je),onClick:Ee=>e(wn)(Ee,N,Je),onDblclick:Ee=>Ft(b,we),onContextmenu:Ee=>It(Ee,{row:N,col:Je})},{default:I(()=>[e(Ge)?ae("",!0):(r(),D("div",Pl,[e(st)(we)&&we.title?(r(),S(An,{key:0,modelValue:b.row[we.title],"onUpdate:modelValue":Ee=>b.row[we.title]=Ee,column:we,active:e(y).col===Je&&e(y).row===N,row:b,"read-only":e(n),onNavigate:xo,onSave:Ee=>{var Bt;return(Bt=e(V))==null?void 0:Bt(b,"",St)}},null,8,["modelValue","onUpdate:modelValue","column","active","row","read-only","onSave"])):we.title?(r(),S(En,{key:1,modelValue:b.row[we.title],"onUpdate:modelValue":Ee=>b.row[we.title]=Ee,column:we,"edit-enabled":!!e(le)&&!!e(_e)&&e(y).col===Je&&e(y).row===N,"row-index":N,active:e(y).col===Je&&e(y).row===N,"read-only":e(n),"onUpdate:editEnabled":o[11]||(o[11]=Ee=>_e.value=Ee),onSave:Ee=>{var Bt;return(Bt=e(V))==null?void 0:Bt(b,we.title,St)},onNavigate:xo,onCancel:o[12]||(o[12]=Ee=>_e.value=!1)},null,8,["modelValue","onUpdate:modelValue","column","edit-enabled","row-index","active","read-only","onSave"])):ae("",!0)]))]),_:2},1032,["class","data-testid","data-key","data-col","data-title","data-row-index","data-col-index","onMousedown","onMouseover","onClick","onDblclick","onContextmenu"])}),128))],12,Al)]}),_:2},1032,["row"]))),128)),e(Rt)&&!e(Ze)?Fe((r(),D("tr",{key:2,class:xe(["text-left nc-grid-add-new-cell cursor-pointer group relative z-3",{"!border-r-2 !border-r-gray-100":e(Ot)===1}]),onMouseup:o[13]||(o[13]=Kt(()=>{},["stop"])),onClick:o[14]||(o[14]=b=>bt())},[_("td",Fl,[_("div",Ol,[(r(),S(Dt(e(Et).plus),{class:"text-pint-500 text-base ml-2 text-gray-600 group-hover:text-black"}))])]),_("td",{class:"!border-gray-100",colspan:e(Ot)},null,8,Gl)],34)),[[qe,["c:row:add:grid-bottom"]]]):ae("",!0)],512)):ae("",!0)],544),Fe(_("div",{ref_key:"fillHandle",ref:$e,class:xe(["nc-fill-handle",!e(de).isEmpty()&&e(de).end.col!==0||e(de).isEmpty()&&e(y).col!==0?"z-3":"z-4"]),style:ot({top:`${e(Do)}px`,left:`${e($o)}px`,cursor:"crosshair"})},null,6),[[Wo,e(Mn)]])],2)]),_:2},[!e(A)&&e(le)?{name:"overlay",fn:I(()=>[ie(Te,{class:"shadow !rounded !py-0",onClick:o[21]||(o[21]=b=>at.value=!1)},{default:I(()=>[e(io)&&!e(kt)&&!e(Se)&&t.data.some(b=>b.rowMeta.selected)?(r(),S(K,{key:0,onClick:o[15]||(o[15]=b=>l("bulkUpdateDlg"))},{default:I(()=>[Fe((r(),D("div",Bl,[(r(),S(Dt(e(Et).edit))),Xe(" Update Selected Rows ")])),[[qe,["a:row:update-bulk"]]])]),_:1})):ae("",!0),!e(kt)&&!e(Se)&&t.data.some(b=>b.rowMeta.selected)?(r(),S(K,{key:1,onClick:e(ve)},{default:I(()=>[Fe((r(),D("div",Hl,[(r(),S(Dt(e(Et).delete))),Xe(he(t.$t("activity.deleteSelectedRow")),1)])),[[qe,["a:row:delete-bulk"]]])]),_:1},8,["onClick"])):ae("",!0),e(Se)&&e(de).isSingleCell()?(r(),S(K,{key:2,onClick:o[16]||(o[16]=b=>bt(e(Se).row+1))},{default:I(()=>[Fe((r(),D("div",Wl,[ie(j,{icon:"plus"}),Xe(he(t.$t("activity.insertRow")),1)])),[[qe,["a:row:insert"]]])]),_:1})):ae("",!0),e(Se)?(r(),S(K,{key:3,"data-testid":"context-menu-item-copy",onClick:o[17]||(o[17]=b=>e(hn)(e(Se)))},{default:I(()=>[Fe((r(),D("div",Yl,[ie(j,{icon:"copy"}),Xe(he(t.$t("general.copy")),1)])),[[qe,["a:row:copy"]]])]),_:1})):ae("",!0),e(Se)&&e(de).isSingleCell()&&(e(Ho)(e(F)[e(Se).col])||!e(st)(e(F)[e(Se).col]))?(r(),S(K,{key:4,onClick:o[18]||(o[18]=b=>Pt(e(Se)))},{default:I(()=>[Fe((r(),D("div",jl,[ie(j,{icon:"close"}),Xe(" "+he(t.$t("general.clear")),1)])),[[qe,["a:row:clear"]]])]),_:1})):e(Se)?(r(),S(K,{key:5,onClick:o[19]||(o[19]=b=>ko())},{default:I(()=>[Fe((r(),D("div",Ul,[ie(j,{icon:"closeBox",class:"text-gray-500"}),Xe(" Clear ")])),[[qe,["a:row:clear-range"]]])]),_:1})):ae("",!0),e(Se)&&(e(de).isSingleCell()||e(de).isSingleRow())?(r(),S(K,{key:6,onClick:o[20]||(o[20]=b=>xn(e(Se).row))},{default:I(()=>[Fe((r(),D("div",Kl,[ie(j,{icon:"delete"}),Xe(he(t.$t("activity.deleteRow")),1)])),[[qe,["a:row:delete"]]])]),_:1})):e(Se)&&e(Y)?(r(),S(K,{key:7,onClick:kn},{default:I(()=>[Fe((r(),D("div",Tl,[ie(j,{icon:"delete",class:"text-gray-500 text-error"}),Xe(" Delete rows ")])),[[qe,["a:row:delete"]]])]),_:1})):ae("",!0)]),_:1})]),key:"0"}:void 0]),1032,["visible","trigger"])],2),e(Ut)&&e(pe)!==!0?(r(),D("div",ql,[ie(f,{active:!0,title:!0,paragraph:!1,class:"-mt-1 max-w-60"})])):e(pe)!==!0?(r(),S(Ln,{key:1,"pagination-data":e(W),"onUpdate:paginationData":o[24]||(o[24]=b=>pt(W)?W.value=b:null),"align-count-on-right":"","change-page":e(g),"hide-sidebars":((Ao=e(Re))==null?void 0:Ao.hideSidebars)===!0,"fixed-size":(Eo=e(Re))==null?void 0:Eo.fixedSize,"extra-style":(No=e(Re))==null?void 0:No.extraStyle},{"add-record":I(()=>[e(Rt)?(r(),D("div",Jl,[ie(zn,{class:"nc-grid-add-new-row",placement:"top",onClick:o[23]||(o[23]=b=>e(fe)?bt():go())},{overlay:I(()=>{var b;return[_("div",Zl,[_("div",{class:xe(["absolute -top-19 flex flex-col h-34.5 w-70 bg-white rounded-lg justify-start overflow-hidden",{"-left-44":!e(fe),"-left-32":e(fe)}]),style:{"box-shadow":"0px 4px 6px -2px rgba(0, 0, 0, 0.06), 0px -12px 16px -4px rgba(0, 0, 0, 0.1)"}},[Fe((r(),D("div",{class:xe([{group:!e(A),"disabled-ring":e(A)},"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer hover:bg-gray-100 text-gray-600 nc-new-record-with-grid"]),onClick:pn},[_("div",Ql,[_("div",er,[(r(),S(Dt((b=("viewIcons"in t?t.viewIcons:e(Qn))[e(ea).GRID])==null?void 0:b.icon),{class:"nc-view-icon text-inherit"})),Xe(" "+he(t.$t("activity.newRecord"))+" - "+he(t.$t("objects.viewType.grid")),1)]),_("div",tr,[e(fe)?(r(),S(j,{key:0,icon:"check"})):ae("",!0)])]),_("div",or,he(t.$t("labels.addRowGrid")),1)],2)),[[qe,["c:row:add:grid-top"]]]),Fe((r(),D("div",{class:xe([{group:!e(A),"disabled-ring":e(A)},"px-4 py-3 flex flex-col select-none gap-y-2 cursor-pointer hover:bg-gray-100 text-gray-600 nc-new-record-with-form"]),onClick:go},[_("div",nr,[_("div",ar,[ie(j,{class:"h-4.5 w-4.5",icon:"article"}),Xe(" "+he(t.$t("activity.newRecord"))+" - "+he(t.$t("objects.viewType.form")),1)]),_("div",lr,[e(fe)?ae("",!0):(r(),S(j,{key:0,icon:"check"}))])]),_("div",rr,he(t.$t("labels.addRowForm")),1)],2)),[[qe,["c:row:add:expanded-form"]]])],2)])]}),icon:I(()=>[(r(),S(Dt(e(Et).arrowUp),{class:"text-gray-600 h-4"}))]),default:I(()=>[_("div",Xl,[_("span",null,[e(fe)?(r(),D(We,{key:0},[Xe(he(t.$t("activity.newRecord")),1)],64)):(r(),D(We,{key:1},[Xe(he(t.$t("activity.newRecord"))+" - "+he(t.$t("objects.viewType.form")),1)],64))])])]),_:1})])):ae("",!0)]),_:1},8,["pagination-data","change-page","hide-sidebars","fixed-size","extra-style"])):ae("",!0)],2)}}});const vo=sn(ir,[["__scopeId","data-v-ca2e3234"]]),sr=Yt({__name:"GroupByTable",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},depth:{},maxDepth:{},rowHeight:{},expandForm:{type:Function},paginationFixedSize:{},paginationHideSidebars:{type:Boolean},scrollLeft:{},viewWidth:{},scrollable:{}},emits:["update:paginationData"],setup(v,{emit:w}){const l=v,p=uo(l,"group",w),R=ke(eo,x()),W=ke(fo,x()),z=ke(jt,$t());function Re(P,X){if(P.nested||!P.rows)return;X=X??P.rows.length;const M=P.nestedIn.reduce((J,F)=>(F.key!=="__nc_null__"&&(J[F.title]=F.key),J),{});return P.rows.splice(X,0,{row:{...M},oldRow:{},rowMeta:{new:!0}}),P.rows[X]}const m=ge(()=>!p.value.nested&&p.value.rows?p.value.rows:[]),{deleteRow:g,deleteSelectedRows:B,deleteRangeOfRows:V,updateOrSaveRow:L,bulkUpdateRows:se,selectedAllRecords:ve,removeRowIfNew:Y}=ga({meta:R,viewMeta:W,formattedData:m,paginationData:x(p.value.paginationData),callbacks:{changePage:P=>l.loadGroupPage(p.value,P),loadData:()=>l.loadGroupData(p.value,!0),globalCallback:()=>{var P;return(P=l.redistributeRows)==null?void 0:P.call(l)}}}),k=async()=>{await l.loadGroupData(p.value,!0)};po(async()=>{z==null||z.off(k)}),z==null||z.on(k),dt(tn,x(!0));const ne=ge(()=>{if(l.scrollLeft&&l.viewWidth&&l.scrollable){const P=l.scrollable.scrollWidth;return l.scrollLeft+l.viewWidth>P?P-l.viewWidth:Math.max(Math.min(P-l.viewWidth,(l.scrollLeft??0)-24),0)}return 0}),pe=ge(()=>({fixedSize:l.paginationFixedSize?l.paginationFixedSize-2:void 0,hideSidebars:l.paginationHideSidebars,extraStyle:`margin-left: ${ne.value}px;`}));return(P,X)=>e(p).rows?(r(),S(vo,{key:0,"selected-all-records":e(ve),"onUpdate:selectedAllRecords":X[0]||(X[0]=M=>pt(ve)?ve.value=M:null),class:"nc-group-table",data:e(p).rows,"pagination-data":e(p).paginationData,"load-data":async()=>{},"change-page":M=>l.loadGroupPage(e(p),M),"call-add-empty-row":M=>Re(e(p),M),"expand-form":l.expandForm,"row-height":P.rowHeight,"delete-row":e(g),"delete-selected-rows":e(B),"delete-range-of-rows":e(V),"update-or-save-row":e(L),"remove-row-if-new":e(Y),"bulk-update-rows":e(se),"hide-header":!0,pagination:e(pe),"disable-skeleton":!0},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","expand-form","row-height","delete-row","delete-selected-rows","delete-range-of-rows","update-or-save-row","remove-row-if-new","bulk-update-rows","pagination"])):ae("",!0)}}),cr=wt(()=>ht(()=>import("./Pagination.31c9fe70.js"),["./Pagination.31c9fe70.js","./entry.51f4e399.js","./entry.0f786d51.css","./index.5263eb1d.js","./sidebar.e289f4e1.js","./views.28a76d89.js","./useMetas.ba7abae7.js","./useSharedView.0db5f32b.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./FormItemContext.e001cd7c.js","./SearchOutlined.dec109ce.js","./isPlainObject.ecf52d25.js","./_getPrototype.ec1165af.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./index.09b19c06.js","./LeftOutlined.3bb8aa17.js","./RightOutlined.90e8180f.js","./index.5e746f62.js","./toArray.06afb623.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./useBreakpoint.a91853f1.js","./responsiveObserve.501a6cf9.js","./_plugin-vue_export-helper.c27b6911.js","./Pagination.9d252b04.css"],import.meta.url).then(v=>v.default||v)),ur=v=>(Xo("data-v-bf7239c3"),v=v(),Zo(),v),dr={class:"flex flex-col h-full w-full"},pr={key:0,class:"flex sticky top-0 z-5"},fr={class:"flex !sticky left-[15px]"},mr={class:"flex items-center"},vr={role:"img","aria-label":"right",class:"anticon anticon-right ant-collapse-arrow"},wr=ur(()=>_("path",{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"},null,-1)),hr=[wr],gr={class:"flex items-center"},_r={class:"flex flex-col"},yr={class:"flex gap-2"},br={class:"text-xs nc-group-column-title"},xr={class:"text-xs text-gray-400 nc-group-row-count"},kr={class:"flex mt-1"},Rr=Yt({__name:"GroupBy",props:{group:{},loadGroups:{type:Function},loadGroupData:{type:Function},loadGroupPage:{type:Function},groupWrapperChangePage:{type:Function},redistributeRows:{type:Function},viewWidth:{},scrollLeft:{},depth:{},maxDepth:{},rowHeight:{},expandForm:{type:Function}},emits:["update:paginationData"],setup(v,{emit:w}){const l=v,p=uo(l,"group",w),R=ke(jt,$t()),W=l.depth??0,z=x(),Re=x(),m=x(),g=ge(()=>m.value?Array.isArray(m.value)?m.value.map(k=>k.replace("group-panel-","")):[m.value.replace("group-panel-","")]:[]),B=x([]),V=k=>{var ne,pe;if(k=Array.isArray(k)?k:[k],k.length>0&&p.value.children&&!B.value.includes(k[k.length-1])){const P=k[k.length-1].replace("group-panel-",""),X=p.value.children[P];X&&(X.nested?(ne=X.children)!=null&&ne.length||l.loadGroups({},X):(pe=X.rows)!=null&&pe.length||l.loadGroupData(X))}B.value=k},L=()=>{p.value.nested?l.loadGroups({},p.value):l.loadGroupData(p.value,!0)};po(async()=>{R==null||R.off(L)}),R==null||R.on(L),Nt([()=>p.value.key],(k,ne)=>{k!==ne&&(p.value.nested?l.loadGroups({},p.value):l.loadGroupData(p.value,!0))},{immediate:!0}),p.value.root===!0&&dt(on,z);const se=x(),ve=ge(()=>{if(p.value.root===!0)return se.value??0;if(l.scrollLeft&&l.viewWidth&&Re.value){const k=Re.value.scrollWidth+12+12;return l.scrollLeft+l.viewWidth>k?k-l.viewWidth:Math.max(Math.min(k-l.viewWidth,(l.scrollLeft??0)-12),0)}return 0}),Y=k=>{p.value.root&&(se.value=k.target.scrollLeft)};return(k,ne)=>{const pe=za,P=Na,X=Va,M=cr;return r(),D("div",dr,[_("div",{ref_key:"wrapper",ref:z,class:"flex flex-col h-full w-full scrollbar-thin-dull overflow-auto",style:ot(`${!e(p).root&&e(p).nested?"padding-left: 12px; padding-right: 12px;":""}`),onScroll:Y},[_("div",{ref_key:"scrollable",ref:Re,class:xe(["flex flex-col h-full",{"my-2":e(p).root!==!0}]),style:ot(`${e(p).root===!0?"width: fit-content":"width: 100%"}`)},[e(p).root===!0?(r(),D("div",pr,[_("div",{class:"bumper mb-2",style:ot([{"background-color":"#f9f9fa","border-color":"#e7e7e9","border-bottom-width":"1px"},{"padding-left":`${(k.maxDepth||1)*13}px`}])},null,4),ie(vo,{class:"mb-2",data:[],"header-only":!0})])):ae("",!0),_("div",{class:xe({"px-[12px]":e(p).root===!0})},[ie(X,{activeKey:e(m),"onUpdate:activeKey":ne[0]||(ne[0]=J=>pt(m)?m.value=J:null),class:"!bg-transparent w-full nc-group-wrapper",bordered:!1,"destroy-inactive-panel":"",onChange:V},{default:I(()=>{var J;return[(r(!0),D(We,null,ct(Object.entries(((J=e(p))==null?void 0:J.children)??[]),([F,n])=>(r(),S(P,{key:`group-panel-${F}`,class:xe(["!border-1 nc-group rounded-[12px]",{"mb-4":e(p).children&&+F!==e(p).children.length-1}]),style:ot(`background: rgb(${245-e(W)*10}, ${245-e(W)*10}, ${245-e(W)*10})`),"show-arrow":!1},{header:I(()=>[_("div",fr,[_("div",mr,[_("span",vr,[(r(),D("svg",{focusable:"false","data-icon":"right",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",viewBox:"64 64 896 896",style:ot(`${e(g).includes(F)?"transform: rotate(90deg)":""}`)},hr,4))])]),_("div",gr,[_("div",_r,[_("div",yr,[_("div",br,he(n.column.title),1),_("div",xr,"(Count: "+he(n.count)+")",1)]),_("div",kr,[n.column.uidt==="MultiSelect"?(r(!0),D(We,{key:0},ct(Object.entries(n.key.split(",")),([A,i])=>(r(),S(pe,{key:`panel-tag-${n.column.id}-${i}`,class:"!py-0 !px-[12px] !rounded-[12px]",color:n.color.split(",")[+A]},{default:I(()=>[_("span",{class:"nc-group-value",style:ot({color:e(Tt).isReadable(n.color.split(",")[+A]||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Tt).mostReadable(n.color.split(",")[+A]||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},he(i in e(vt).VAR_TITLES?e(vt).VAR_TITLES[i]:i),5)]),_:2},1032,["color"]))),128)):(r(),S(pe,{key:`panel-tag-${n.column.id}-${n.key}`,class:xe(["!py-0 !px-[12px]",`${n.column.uidt==="SingleSelect"?"!rounded-[12px]":"!rounded-[6px]"}`]),color:n.color},{default:I(()=>[_("span",{class:"nc-group-value",style:ot({color:e(Tt).isReadable(n.color||"#ccc","#fff",{level:"AA",size:"large"})?"#fff":e(Tt).mostReadable(n.color||"#ccc",["#0b1d05","#fff"]).toHex8String(),"font-size":"14px","font-weight":500})},he(n.key in e(vt).VAR_TITLES?e(vt).VAR_TITLES[n.key]:n.key),5)]),_:2},1032,["class","color"]))])])])])]),default:I(()=>[!n.nested&&n.rows?(r(),S(sr,{key:0,group:n,"load-groups":k.loadGroups,"load-group-data":k.loadGroupData,"load-group-page":k.loadGroupPage,"group-wrapper-change-page":k.groupWrapperChangePage,"row-height":k.rowHeight,"redistribute-rows":k.redistributeRows,"expand-form":k.expandForm,"pagination-fixed-size":l.viewWidth,"pagination-hide-sidebars":!0,"scroll-left":l.scrollLeft||e(se),"view-width":k.viewWidth,scrollable:e(Re)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","expand-form","pagination-fixed-size","scroll-left","view-width","scrollable"])):(r(),S(cn,{key:1,group:n,"load-groups":k.loadGroups,"load-group-data":k.loadGroupData,"load-group-page":k.loadGroupPage,"group-wrapper-change-page":k.groupWrapperChangePage,"row-height":k.rowHeight,"redistribute-rows":k.redistributeRows,"expand-form":k.expandForm,"view-width":k.viewWidth,depth:e(W)+1,"scroll-left":e(ve)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","redistribute-rows","expand-form","view-width","depth","scroll-left"]))]),_:2},1032,["class","style"]))),128))]}),_:1},8,["activeKey"])],2)],6)],36),e(p).root?(r(),S(M,{key:0,"pagination-data":e(p).paginationData,"onUpdate:paginationData":ne[1]||(ne[1]=J=>e(p).paginationData=J),"align-count-on-right":"","custom-label":"groups","change-page":J=>k.groupWrapperChangePage(J,e(p)),style:ot(`${l.depth&&l.depth>0?"border-radius: 0 0 12px 12px !important;":""}`)},null,8,["pagination-data","change-page","style"])):(r(),S(M,{key:1,"pagination-data":e(p).paginationData,"onUpdate:paginationData":ne[2]||(ne[2]=J=>e(p).paginationData=J),"align-count-on-right":"","custom-label":"groups","change-page":J=>k.groupWrapperChangePage(J,e(p)),"hide-sidebars":!0,style:ot(`${l.depth&&l.depth>0?"border-radius: 0 0 12px 12px !important;":""}margin-left: ${e(ve)}px;`),"fixed-size":l.viewWidth},null,8,["pagination-data","change-page","style","fixed-size"]))])}}});const cn=sn(Rr,[["__scopeId","data-v-bf7239c3"]]),Sr=wt(()=>ht(()=>import("./index.a350d282.js").then(v=>v.i),["./index.a350d282.js","./entry.51f4e399.js","./entry.0f786d51.css","./TableIcon.vue.27fb2d8a.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./Modal.vue.b59a28af.js","./DeleteModal.7ab6f524.css","./useDashboard.fc1e1c09.js","./useViewData.d5cf5dca.js","./useMetas.ba7abae7.js","./virtualCell.4dce1393.js","./dataUtils.edecace3.js","./index.5263eb1d.js","./useSharedView.0db5f32b.js","./useSmartsheetStore.1784ce8b.js","./views.28a76d89.js","./index.b9981e09.js","./index.9e760c64.js","./useCopy.3e897b55.js","./useKanbanViewStore.7f9b2a7a.js","./deepCompare.d32ec333.js","./useSmartsheetRowStore.aafbb4bb.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./Icon.vue.1162f18b.js","./index.82c42c24.js","./chevron-down.b89ef60a.js","./index.af5eff28.js","./index.883a1693.css"],import.meta.url).then(v=>v.default||v)),Dr=wt(()=>ht(()=>import("./BulkUpdate.a7fcd9e6.js"),["./BulkUpdate.a7fcd9e6.js","./_plugin-vue_export-helper.c27b6911.js","./entry.51f4e399.js","./entry.0f786d51.css"],import.meta.url).then(v=>v.default||v)),Ni=Yt({__name:"index",setup(v,{expose:w}){const l=ke(eo,x()),p=ke(fo,x()),R=ke(jt,$t());ke(en,x([]));const W=la(),z=W.currentRoute,{xWhere:Re,eventBus:m}=mo(),g=x(!1),B=ge(()=>z.value.query),V=x(!1),L=x(),se=x(),ve=x(),{loadData:Y,paginationData:k,formattedData:ne,updateOrSaveRow:pe,changePage:P,addEmptyRow:X,deleteRow:M,deleteSelectedRows:J,selectedAllRecords:F,removeRowIfNew:n,navigateToSiblingRow:A,getExpandedRowIndex:i,deleteRangeOfRows:Ze,bulkUpdateRows:Qe,bulkUpdateView:Ne,optimisedQuery:Ve}=_a(l,p,Re),je=ge(()=>{var Q,a,u,d;if(((a=(Q=p.value)==null?void 0:Q.view)==null?void 0:a.row_height)!==void 0)switch((d=(u=p.value)==null?void 0:u.view)==null?void 0:d.row_height){case 0:return 1;case 1:return 2;case 2:return 4;case 3:return 6;default:return 1}});dt(fa,x(!1)),dt(ma,x(!1)),dt(va,x(!0)),dt(wa,je),dt(ha,R);const nt=x(!1);function Ue(Q,a,u=!1){var E;const d=Vt(Q.row,(E=l.value)==null?void 0:E.columns);d?W.push({query:{...B.value,rowId:d}}):(L.value=Q,se.value=a,V.value=!0,nt.value=!u)}w({loadData:Y,openColumnCreate:Q=>{var a;(a=ve.value)==null||a.openColumnCreate(Q)}});const s=ge({get(){return!!B.value.rowId},set(Q){Q||W.push({query:{...B.value,rowId:void 0}})}}),h=Q=>{nt.value||m.emit(Xt.CLEAR_NEW_ROW,Q)},$=()=>{Ve.value?(Ve.value=!1,De.info("Optimised query disabled")):(Ve.value=!0,De.info("Optimised query enabled"))},{rootGroup:T,groupBy:Z,isGroupBy:ze,loadGroups:ce,loadGroupData:it,loadGroupPage:gt,groupWrapperChangePage:et,redistributeRows:_t}=La(p,Re),te=x(),ue=x(0);return m.on(Q=>{Q===Xt.GROUP_BY_RELOAD&&(R==null||R.trigger())}),Jo(()=>{ra(te).toBeTruthy().then(()=>{const Q=new ResizeObserver(()=>{var a;ue.value=((a=te.value)==null?void 0:a.clientWidth)||0});te.value&&Q.observe(te.value)})}),(Q,a)=>{const u=Sr,d=Dr;return r(),D("div",{ref_key:"coreWrapperRef",ref:te,class:"relative flex flex-col h-full min-h-0 w-full nc-grid-wrapper","data-testid":"nc-grid-wrapper",style:{"background-color":"var(--nc-grid-bg)"}},[e(ze)?(r(),S(cn,{key:1,group:e(T),"load-groups":e(ce),"load-group-data":e(it),"load-group-page":e(gt),"group-wrapper-change-page":e(et),"row-height":e(je),"max-depth":e(Z).length,"redistribute-rows":e(_t),"expand-form":Ue,"view-width":e(ue)},null,8,["group","load-groups","load-group-data","load-group-page","group-wrapper-change-page","row-height","max-depth","redistribute-rows","view-width"])):(r(),S(vo,{key:0,ref_key:"tableRef",ref:ve,"selected-all-records":e(F),"onUpdate:selectedAllRecords":a[0]||(a[0]=E=>pt(F)?F.value=E:null),data:e(ne),"pagination-data":e(k),"load-data":e(Y),"change-page":e(P),"call-add-empty-row":e(X),"delete-row":e(M),"update-or-save-row":e(pe),"delete-selected-rows":e(J),"delete-range-of-rows":e(Ze),"bulk-update-rows":e(Qe),"remove-row-if-new":e(n),"expand-form":Ue,"row-height":e(je),onToggleOptimisedQuery:$,onBulkUpdateDlg:a[1]||(a[1]=E=>g.value=!0)},null,8,["selected-all-records","data","pagination-data","load-data","change-page","call-add-empty-row","delete-row","update-or-save-row","delete-selected-rows","delete-range-of-rows","bulk-update-rows","remove-row-if-new","row-height"])),(r(),S(ro,null,{default:I(()=>[e(L)&&e(V)?(r(),S(u,{key:0,modelValue:e(V),"onUpdate:modelValue":[a[2]||(a[2]=E=>pt(V)?V.value=E:null),a[3]||(a[3]=E=>h(e(L)))],row:e(L),state:e(se),meta:e(l),view:e(p)},null,8,["modelValue","row","state","meta","view"])):ae("",!0)]),_:1})),(r(),S(ro,null,{default:I(()=>[e(s)?(r(),S(u,{key:e(B).rowId,modelValue:e(s),"onUpdate:modelValue":a[4]||(a[4]=E=>pt(s)?s.value=E:null),row:{row:{},oldRow:{},rowMeta:{}},meta:e(l),"row-id":e(B).rowId,view:e(p),"show-next-prev-icons":"","first-row":e(i)()===0,"last-row":e(i)()===e(ne).length-1,onNext:a[5]||(a[5]=E=>e(A)(e(Zt).NEXT)),onPrev:a[6]||(a[6]=E=>e(A)(e(Zt).PREV))},null,8,["modelValue","meta","row-id","view","first-row","last-row"])):ae("",!0)]),_:1})),(r(),S(ro,null,{default:I(()=>[e(g)?(r(),S(d,{key:0,modelValue:e(g),"onUpdate:modelValue":a[7]||(a[7]=E=>pt(g)?g.value=E:null),"pagination-data":e(k),meta:e(l),view:e(p),"bulk-update-rows":e(Qe),"bulk-update-view":e(Ne),"selected-all-records":e(F),rows:e(ne).filter(E=>E.rowMeta.selected)},null,8,["modelValue","pagination-data","meta","view","bulk-update-rows","bulk-update-view","selected-all-records","rows"])):ae("",!0)]),_:1}))],512)}}});export{Ni as default};
