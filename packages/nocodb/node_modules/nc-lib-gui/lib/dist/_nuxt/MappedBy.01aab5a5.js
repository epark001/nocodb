import{a as U}from"./useSmartsheetStore.1784ce8b.js";import{a as R}from"./useMapViewDataStore.30741ad6.js";import{o as r,c as k,a as e,h as G,$ as n,r as l,aq as q,i as g,g0 as z,cd as W,cI as Y,E as a,C as d,w as m,cF as w,t as _,b as u,H as h,W as b,aV as Z,d as J,D as K,F as Q,L as X}from"./entry.51f4e399.js";import{M as tt,A as ot,R as et,d as at,b as st}from"./index.5263eb1d.js";import{u as it}from"./useViewColumns.96f2a704.js";import{D as nt}from"./index.252dc7b4.js";import{_ as lt}from"./index.2b3cfde3.js";import{_ as rt}from"./index.5e746f62.js";import"./views.28a76d89.js";import"./useMetas.ba7abae7.js";import"./useSharedView.0db5f32b.js";import"./index.b9981e09.js";import"./index.9e760c64.js";import"./dataUtils.edecace3.js";import"./Dropdown.dc69c0a4.js";import"./RightOutlined.90e8180f.js";import"./toArray.06afb623.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./SearchOutlined.dec109ce.js";import"./FormItemContext.e001cd7c.js";const ct={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},pt=e("path",{fill:"currentColor",d:"M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 2a8 8 0 0 1 8 8a8 8 0 0 1-8 8a8 8 0 0 1-8-8a8 8 0 0 1 8-8m-5 6l5 5l5-5H7Z"},null,-1),dt=[pt];function mt(y,f){return r(),k("svg",ct,dt)}const _t={name:"mdi-arrow-down-drop-circle-outline",render:mt},ut={class:"nc-map-btn"},ft={class:"flex items-center gap-1"},vt={class:"text-capitalize !text-sm font-weight-normal"},gt={class:"font-bold"},wt={class:"font-bold"},ht={class:"nc-fields-list py-1"},bt={class:"grouping-field"},Wt=G({__name:"MappedBy",setup(y){const{eventBus:f}=U(),v=n(tt,l()),c=n(ot,l()),D=n(et),M=n(at,l(!1)),C=n(st,l(!1)),{fields:x,loadViewColumns:B,metaColumnById:I}=it(c,v,()=>D.trigger()),{loadMapData:V,loadMapMeta:F,updateMapMeta:S,mapMetaData:j,geoDataFieldColumn:A}=R(),i=l(!1);q(()=>{var o;return(o=c.value)==null?void 0:o.id},async(o,t)=>{o!==t&&v.value&&await B()},{immediate:!0});const p=g({get:()=>j.value.fk_geo_data_col_id,set:async o=>{var t;o&&(await S({fk_geo_data_col_id:o}),await F(),await V(),((t=c.value)==null?void 0:t.view).fk_geo_data_col_id=o,f.emit(z.MAPPED_BY_COLUMN_CHANGE))}}),N=g(()=>{var o;return(o=x.value)==null?void 0:o.filter(t=>t.fk_column_id&&I.value[t.fk_column_id].uidt===W.GeoData).map(t=>({value:t.fk_column_id,label:t.title}))}),$=()=>{i.value=!1};return(o,t)=>{const E=_t,H=X,L=lt,O=rt,P=nt,T=Y("e");return a(C)?b("",!0):(r(),d(P,{key:0,visible:a(i),"onUpdate:visible":t[3]||(t[3]=s=>h(i)?i.value=s:null),trigger:["click"]},{overlay:m(()=>[a(i)?(r(),k("div",{key:0,class:"p-3 min-w-[280px] bg-gray-50 shadow-lg nc-table-toolbar-menu max-h-[max(80vh,500px)] overflow-auto !border",onClick:t[2]||(t[2]=w(()=>{},["stop"]))},[e("div",null,[e("span",wt,_(o.$t("activity.map.chooseMappingField")),1),u(L,{class:"!my-2"})]),e("div",ht,[e("div",bt,[u(O,{value:a(p),"onUpdate:value":t[0]||(t[0]=s=>h(p)?p.value=s:null),class:"w-full nc-msp-grouping-field-select",options:a(N),placeholder:"Select a Mapping Field",onChange:$,onClick:t[1]||(t[1]=w(()=>{},["stop"]))},null,8,["value","options"])])])])):b("",!0)]),default:m(()=>[e("div",ut,[Z((r(),d(H,{class:"nc-map-stacked-by-menu-btn nc-toolbar-btn",disabled:a(M)},{default:m(()=>{var s;return[e("div",ft,[u(E),e("span",vt,[J(_(o.$t("activity.map.mappedBy"))+" ",1),e("span",gt,_((s=a(A))==null?void 0:s.title),1)]),(r(),d(K(a(Q).arrowDown),{class:"text-grey"}))])]}),_:1},8,["disabled"])),[[T,["c:map:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{Wt as default};
