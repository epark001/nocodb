import{o,c as m,a as c,h as G,A as J,r as M,cb as O,i as W,k as q,t as i,b as s,w as a,E as n,H as Q,C as v,aj as X,cp as Y,W as U,D as w,F as x,J as u,K as g,L as Z,M as ee,N as ae,_ as te,f as se}from"./entry.13466615.js";import{u as oe}from"./useCopy.a0671815.js";import{u as re}from"./useDashboard.34dd8f64.js";import{a as le}from"./useMetas.223da623.js";import{D as ne}from"./index.82f05b6c.js";import{S as ce,_ as ie}from"./index.4385a501.js";import"./Dropdown.a78be736.js";import"./RightOutlined.2c092523.js";import"./toArray.f6fa5a71.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.4991ab9d.js";import"./useMergedState.1cc2a884.js";import"./useState.a6853ebd.js";import"./DownOutlined.9cfe3e0c.js";import"./CheckOutlined.80115d65.js";import"./SearchOutlined.c1eed30a.js";import"./FormItemContext.27b2e5db.js";const de={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ue=c("path",{fill:"currentColor",d:"M8.12 9.29L12 13.17l3.88-3.88a.996.996 0 1 1 1.41 1.41l-4.59 4.59a.996.996 0 0 1-1.41 0L6.7 10.7a.996.996 0 0 1 0-1.41c.39-.38 1.03-.39 1.42 0z"},null,-1),me=[ue];function pe(L,k){return o(),m("svg",de,me)}const _e={name:"ic-round-keyboard-arrow-down",render:pe},fe={class:"flex flex-col gap-2 w-full","data-testid":"nc-share-base-sub-modal"},ve={class:"flex text-xs text-gray-500 justify-start ml-1"},he={class:"flex flex-row justify-between mx-1"},ye={class:"flex flex-row rounded-md items-center space-x-2 nc-disable-shared-base"},be={key:0},we={key:1},xe={class:"flex flex-row"},ge={class:"w-full px-2 capitalize"},ke={key:0,class:"flex flex-row mt-2 bg-red-50 py-4 mx-1 px-2 items-center rounded-sm w-full justify-between"},Be={class:"flex text-xs overflow-x-hidden overflow-ellipsis text-gray-700 pl-2 nc-url"},$e={class:"flex border-l-1 pt-1 pl-1"},Ge=G({__name:"ShareBase",setup(L){const{t:k}=J(),{dashboardUrl:R}=re(),{$api:y,$e:f}=se(),t=M(null),B=M(!1),{project:d}=O(le()),{copy:$}=oe(),p=W(()=>t.value&&t.value.uuid?`${R.value}#/base/${t.value.uuid}`:null),V=async()=>{try{if(!d.value.id)return;const e=await y.project.sharedBaseGet(d.value.id);t.value={uuid:e.uuid,url:e.url,role:e.roles}}catch(e){u.error(await g(e))}},C=async(e="viewer")=>{try{if(!d.value.id)return;const r=await y.project.sharedBaseUpdate(d.value.id,{roles:e});t.value=r??{},t.value.role=e}catch(r){u.error(await g(r))}f("a:shared-base:enable",{role:e})},E=async()=>{try{if(!d.value.id)return;await y.project.sharedBaseDisable(d.value.id),t.value=null}catch(e){u.error(await g(e))}f("a:shared-base:disable")},N=async()=>{var e,r;try{if(!d.value.id)return;const _=await y.project.sharedBaseCreate(d.value.id,{roles:((e=t.value)==null?void 0:e.role)||"viewer"})||{};t.value={..._,role:(r=t.value)==null?void 0:r.role}}catch(h){u.error(await g(h))}f("a:shared-base:recreate")},I=async()=>{if(p.value){try{await $(p.value),u.success(k("msg.success.shareableURLCopied"))}catch(e){u.error(e.message)}f("c:shared-base:copy-url")}},T=()=>{p.value&&(window.open(p.value,"_blank"),f("c:shared-base:open-url"))},z=async()=>{if(p.value){try{await $(`<iframe
class="nc-embed"
src="${p.value}?embed"
frameborder="0"
width="100%"
height="700"
style="background: transparent; border: 1px solid #ddd"></iframe>`),u.success(k("msg.success.embeddableHTMLCodeCopied"))}catch(e){u.error(e.message)}f("c:shared-base:copy-embed-frame")}};return q(()=>{t.value||V()}),(e,r)=>{var j,D;const h=_e,_=Z,A=ee,F=ae,H=ne,K=ce,P=ie,b=te;return o(),m("div",fe,[c("div",ve,i(e.$t("msg.info.generatePublicShareableReadonlyBase")),1),c("div",he,[s(H,{modelValue:n(B),"onUpdate:modelValue":r[1]||(r[1]=l=>Q(B)?B.value=l:null),class:"flex","overlay-class-name":"nc-dropdown-shared-base-toggle"},{overlay:a(()=>[s(F,null,{default:a(()=>[s(A,null,{default:a(()=>{var l;return[(l=n(t))!=null&&l.uuid?(o(),m("div",{key:0,class:"py-3",onClick:E},i(e.$t("activity.shareBase.disable")),1)):(o(),m("div",{key:1,class:"py-3",onClick:r[0]||(r[0]=S=>C("viewer"))},i(e.$t("activity.shareBase.enable")),1))]}),_:1})]),_:1})]),default:a(()=>[s(_,null,{default:a(()=>{var l;return[c("div",ye,[(l=n(t))!=null&&l.uuid?(o(),m("div",be,i(e.$t("activity.shareBase.enable")),1)):(o(),m("div",we,i(e.$t("activity.shareBase.disable")),1)),s(h,{class:"h-[1rem]"})])]}),_:1})]),_:1},8,["modelValue"]),(j=n(t))!=null&&j.uuid?(o(),v(P,{key:0,value:n(t).role,"onUpdate:value":r[2]||(r[2]=l=>n(t).role=l),class:"flex nc-shared-base-role","dropdown-class-name":"nc-dropdown-share-base-role"},{suffixIcon:a(()=>[c("div",xe,[s(h,{class:"text-black -mt-0.5 h-[1rem]"})])]),default:a(()=>[(o(!0),m(X,null,Y(["editor","viewer"],(l,S)=>(o(),v(K,{key:S,value:l,"dropdown-class-name":"capitalize",onClick:Ce=>C(l)},{default:a(()=>[c("div",ge,i(l),1)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["value"])):U("",!0)]),(D=n(t))!=null&&D.uuid?(o(),m("div",ke,[c("span",Be,i(n(p)),1),c("div",$e,[s(b,{placement:"bottom"},{title:a(()=>[c("span",null,i(e.$t("general.reload")),1)]),default:a(()=>[s(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:N},{icon:a(()=>[(o(),v(w(n(x).reload),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),s(b,{placement:"bottom"},{title:a(()=>[c("span",null,i(e.$t("activity.copyUrl")),1)]),default:a(()=>[s(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:I},{icon:a(()=>[(o(),v(w(n(x).copy),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),s(b,{placement:"bottom"},{title:a(()=>[c("span",null,i(e.$t("activity.openTab")),1)]),default:a(()=>[s(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:T},{icon:a(()=>[(o(),v(w(n(x).share),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1}),s(b,{placement:"bottom"},{title:a(()=>[c("span",null,i(e.$t("activity.iFrame")),1)]),default:a(()=>[s(_,{type:"text",class:"!rounded-md mr-1 -mt-1.5 h-[1rem]",onClick:z},{icon:a(()=>[(o(),v(w(n(x).xml),{class:"flex mx-auto text-gray-600"}))]),_:1})]),_:1})])])):U("",!0)])}}});export{Ge as default};
