import{h as Z,S as z,$ as m,r as f,i as y,fZ as G,f_ as K,cq as o,aq as J,fp as Q,k as W,ac as _,dg as ee,o as te,C as ae,w as le,E as t,H as ce,I as re,eX as A}from"./entry.51f4e399.js";import{f as ie,h as oe,E as ne,d as se,C as ue,q as de}from"./index.5263eb1d.js";import{a as me,p as B}from"./useMetas.ba7abae7.js";import{u as fe}from"./index.82c42c24.js";import{D as pe}from"./dayjs.5e586ea0.js";import{_ as ve}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.f911c8dd.js";import"./createForOfIteratorHelper.12419aa5.js";import"./index.d05e87a9.js";import"./useMergedState.5e6500b1.js";import"./useMemo.b13a9257.js";import"./useState.6010d8b6.js";import"./FormItemContext.e001cd7c.js";const ke=Z({__name:"DateTimePicker",props:{modelValue:{},isPk:{type:Boolean},isUpdatedFromCopyNPaste:{}},emits:["update:modelValue"],setup(a,{emit:q}){const{isMssql:R,isXcdbBase:N}=me(),{showNull:C}=z(),S=m(ie,f(!1)),w=m(oe,f(!1)),V=m(ne,f(!1)),O=m(se,f(!1)),l=m(ue),E=f(!1),T=y(()=>{var n,s,p,v;const e=((s=B((n=l==null?void 0:l.value)==null?void 0:n.meta))==null?void 0:s.date_format)??G[0],r=((v=B((p=l==null?void 0:l.value)==null?void 0:p.meta))==null?void 0:v.time_format)??K[0];return`${e} ${r}`});let d=a.modelValue?o(a.modelValue).utc().local():void 0;const i=y({get(){var r;if(!a.modelValue)return;if(!o(a.modelValue).isValid()){E.value=!0;return}const e=N(l.value.base_id);if(l.value.title in(a.isUpdatedFromCopyNPaste??{}))return d=o(a.modelValue).utc().local(),d;if(!e)return/^\d+$/.test(a.modelValue)?o(+a.modelValue):o(a.modelValue);if(R(l.value.base_id))return o(a.modelValue);if((r=l==null?void 0:l.value)!=null&&r.cdf)return o(a.modelValue).utc().local();if(d){const n=d;return d=void 0,n}return o(a.modelValue).utc().local()},set(e){if(!e){q("update:modelValue",null);return}e.isValid()&&(d=o(e),q("update:modelValue",o(e).utc().format("YYYY-MM-DD HH:mm:ssZ")))}}),c=f(!1),P=`picker_${Math.floor(Math.random()*99999)}`;J(c,e=>{e?Q(document.querySelector(`.${P}`),()=>c.value=!1):V.value=!1},{flush:"post"});const Y=y(()=>a.modelValue===null&&C.value?"NULL":E.value?"Invalid date":"");fe(w,e=>{var r,n,s,p,v,D,x,I,g,M,j,$,F,L,U;switch(e.key){case"Enter":if(e.stopPropagation(),A())return;c.value?(r=document.querySelector(".nc-picker-datetime.active .ant-picker-ok button"))==null||r.click():c.value=!0;break;case"Escape":if(A())return;c.value&&(e.stopPropagation(),c.value=!1);break;case"ArrowLeft":if(!i.value)(n=document.querySelector(".nc-picker-datetime.active .ant-picker-header-prev-btn"))==null||n.click();else{const k=(s=document.querySelector(".nc-picker-datetime.active .ant-picker-cell-selected"))==null?void 0:s.previousElementSibling;if(k)k.click();else{const b=(D=(v=(p=document.querySelector(".nc-picker-datetime.active .ant-picker-cell-selected"))==null?void 0:p.closest("tr"))==null?void 0:v.previousElementSibling)==null?void 0:D.querySelector("td:last-child");b?b.click():(x=document.querySelector(".nc-picker-datetime.active .ant-picker-header-prev-btn"))==null||x.click()}}break;case"ArrowRight":if(!i.value)(I=document.querySelector(".nc-picker-datetime.active .ant-picker-header-next-btn"))==null||I.click();else{const k=(g=document.querySelector(".nc-picker-datetime.active .ant-picker-cell-selected"))==null?void 0:g.nextElementSibling;if(k)k.click();else{const b=($=(j=(M=document.querySelector(".nc-picker-datetime.active .ant-picker-cell-selected"))==null?void 0:M.closest("tr"))==null?void 0:j.nextElementSibling)==null?void 0:$.querySelector("td:first-child");b?b.click():(F=document.querySelector(".nc-picker-datetime.active .ant-picker-header-next-btn"))==null||F.click()}}break;case"ArrowUp":i.value||(L=document.querySelector(".nc-picker-datetime.active .ant-picker-header-super-prev-btn"))==null||L.click();break;case"ArrowDown":i.value||(U=document.querySelector(".nc-picker-datetime.active .ant-picker-header-super-next-btn"))==null||U.click();break;case";":i.value=o(new Date);break}});const u=m(de,null),h=()=>{c.value=(w.value||V.value)&&!c.value};W(()=>{u==null||u.on(h)}),_(()=>{u==null||u.on(h)});const H=()=>{u||h()},X=y(()=>ee(l.value)||S.value||i.value&&a.isPk);return(e,r)=>{const n=pe;return te(),ae(n,{value:t(i),"onUpdate:value":r[0]||(r[0]=s=>ce(i)?i.value=s:null),disabled:t(X),"show-time":!0,bordered:!1,class:re(["!w-full !px-0 !border-none",{"nc-null":e.modelValue===null&&t(C)}]),format:t(T),placeholder:t(Y),"allow-clear":!t(S)&&!t(i)&&!e.isPk,"input-read-only":!0,"dropdown-class-name":`${P} nc-picker-datetime ${t(c)?"active":""}`,open:t(S)||t(i)&&e.isPk||t(O)?!1:t(c)&&(t(w)||t(V)),onClick:H,onOk:r[1]||(r[1]=s=>c.value=!t(c))},{suffixIcon:le(()=>[]),_:1},8,["value","disabled","class","format","placeholder","allow-clear","dropdown-class-name","open"])}}});const ge=ve(ke,[["__scopeId","data-v-2562e34c"]]);export{ge as default};
