import{h as ge,o as r,C as m,w as n,V as Qe,I as we,ch as Xe,r as h,g as Ye,i as W,J as C,K as H,f as qe,c as k,a as u,A as et,z as tt,S as ot,cb as me,$ as at,B as nt,aq as ye,k as it,b as l,aV as lt,E as t,b6 as st,cF as he,eD as ct,cA as le,d as V,t as N,dh as S,di as $,aj as K,cp as J,D as se,F as ce,W as y,H as rt,_ as dt,Q as I,R as E,p as pt,e as ut}from"./entry.13466615.js";import{_ as ft}from"./Button.vue.a83cab3b.js";import{_ as _t}from"./Select.vue.140b59a5.js";import{T as mt,_ as yt}from"./index.62e3d60f.js";import{b as ve,p as re,a as ht}from"./useMetas.223da623.js";import{u as be}from"./views.3cd4bcb9.js";import{f as w}from"./validation.5ed31fc1.js";import{M as vt}from"./index.5263eb1d.js";import{F as ke}from"./index.6f605a00.js";import{_ as bt}from"./index.89133b21.js";import"./index.a8ef1b7e.js";import{I as kt}from"./Input.16966097.js";import{_ as gt}from"./TextArea.1bd4034f.js";import{C as wt}from"./index.2660048d.js";import{_ as qt}from"./FormItem.fe59dafe.js";import{S as xt}from"./index.4385a501.js";import{_ as Tt}from"./index.638acbb4.js";import{_ as Mt}from"./_plugin-vue_export-helper.c27b6911.js";const St=ge({__name:"Tabs",props:{modelValue:{},centered:{type:Boolean}},setup(i){const v=i;return(b,P)=>{const A=mt;return r(),m(A,{class:we(["nc-tabs",{centered:v.centered}])},{default:n(()=>[Qe(b.$slots,"default")]),_:3},8,["class"])}}});const Vt=Xe("webhooksStore",()=>{const i=h([]),v=h(!0),{$api:b,$e:P}=qe(),A=Ye(),L=A.currentRoute,B=W(()=>R({openCreatePage:!0})),G=W(()=>R({openMainPage:!0}));async function j(){const{activeTable:_}=ve();v.value=!0;try{const f=(await b.dbTableWebhook.list(_==null?void 0:_.id)).list;i.value=f.map(s=>(s.notification=re(s.notification),s))}catch(f){C.error(await H(f))}finally{v.value=!1}}async function Q(_){const f=i.value.findIndex(s=>s.id===_);try{_&&await b.dbTableWebhook.delete(_),i.value.splice(f,1),i.value.length||(i.value=[])}catch(s){C.error(await H(s))}}async function X(_){try{const f=await b.dbTableWebhook.create(_.fk_model_id,{..._,title:`${_.title} - Copy`,active:!1});if(f){P("a:webhook:copy");const s=(await b.dbTableWebhookFilter.read(_.id,{})).list;for(const d of s)await b.dbTableWebhookFilter.create(f.id,{comparison_op:d.comparison_op,comparison_sub_op:d.comparison_sub_op,fk_column_id:d.fk_column_id,fk_parent_id:d.fk_parent_id,is_group:d.is_group,logical_op:d.logical_op,value:d.value});f.notification=re(f.notification),i.value=[f,...i.value]}}catch(f){C.error(await H(f))}}async function U({hook:_}){const{activeTable:f}=ve();if(!f)throw new Error("activeTable is not defined");typeof _.notification=="string"&&(_.notification=JSON.parse(_.notification));let s=_;try{let d;s.id?d=await b.dbTableWebhook.update(s.id,{...s,notification:{...s.notification,payload:s.notification.payload}}):(d=await b.dbTableWebhook.create(f.id,{...s,notification:{...s.notification,payload:s.notification.payload}}),i.value.push(d)),d&&typeof d.notification=="string"&&(d.notification=JSON.parse(d.notification)),!s.id&&d&&(s={...s,...d}),i.value=i.value.map(D=>D.id===s.id?s:D)}catch(d){throw C.error(await H(d)),console.error(d),d}return P("a:webhook:add",{operation:s.operation,condition:s.condition,notification:s.notification.type}),s}function R({hookId:_,openCreatePage:f,openMainPage:s}){const{activeView:d}=be();if(!d)throw new Error("activeView is not defined");if(!s&&!f&&!_)throw new Error("hook id is not defined");return{name:"index-typeOrId-projectId-index-index-viewId-viewTitle-slugs",params:{typeOrId:L.value.params.typeOrId,projectId:L.value.params.projectId,viewId:L.value.params.viewId,viewTitle:d.id,slugs:s?["webhook"]:["webhook",f?"create":_]}}}return{hooks:i,loadHooksList:j,deleteHook:Q,copyHook:X,saveHooks:U,navigateToWebhook:async({hookId:_,openCreatePage:f,openMainPage:s})=>{const{activeView:d}=be();d&&await A.push(R({hookId:_,openCreatePage:f,openMainPage:s}))},createWebhookUrl:B,webhookMainUrl:G,isHooksLoading:v,navigateToWebhookRoute:R}}),Lt={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},$t=u("path",{fill:"currentColor",d:"M11 17V7H4v10h7m0-14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7m5.5 0h5A1.5 1.5 0 0 1 23 4.5v3A1.5 1.5 0 0 1 21.5 9H18l-3 3V4.5A1.5 1.5 0 0 1 16.5 3Z"},null,-1),Ct=[$t];function It(i,v){return r(),k("svg",Lt,Ct)}const Et={name:"mdi-cellphone-message",render:It},At={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Bt=u("path",{fill:"currentColor",d:"M12.04 2c-5.46 0-9.91 4.45-9.91 9.91c0 1.75.46 3.45 1.32 4.95L2.05 22l5.25-1.38c1.45.79 3.08 1.21 4.74 1.21c5.46 0 9.91-4.45 9.91-9.91c0-2.65-1.03-5.14-2.9-7.01A9.816 9.816 0 0 0 12.04 2m.01 1.67c2.2 0 4.26.86 5.82 2.42a8.225 8.225 0 0 1 2.41 5.83c0 4.54-3.7 8.23-8.24 8.23c-1.48 0-2.93-.39-4.19-1.15l-.3-.17l-3.12.82l.83-3.04l-.2-.32a8.188 8.188 0 0 1-1.26-4.38c.01-4.54 3.7-8.24 8.25-8.24M8.53 7.33c-.16 0-.43.06-.66.31c-.22.25-.87.86-.87 2.07c0 1.22.89 2.39 1 2.56c.14.17 1.76 2.67 4.25 3.73c.59.27 1.05.42 1.41.53c.59.19 1.13.16 1.56.1c.48-.07 1.46-.6 1.67-1.18c.21-.58.21-1.07.15-1.18c-.07-.1-.23-.16-.48-.27c-.25-.14-1.47-.74-1.69-.82c-.23-.08-.37-.12-.56.12c-.16.25-.64.81-.78.97c-.15.17-.29.19-.53.07c-.26-.13-1.06-.39-2-1.23c-.74-.66-1.23-1.47-1.38-1.72c-.12-.24-.01-.39.11-.5c.11-.11.27-.29.37-.44c.13-.14.17-.25.25-.41c.08-.17.04-.31-.02-.43c-.06-.11-.56-1.35-.77-1.84c-.2-.48-.4-.42-.56-.43c-.14 0-.3-.01-.47-.01Z"},null,-1),Ut=[Bt];function Rt(i,v){return r(),k("svg",At,Ut)}const Dt={name:"mdi-whatsapp",render:Rt},zt={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Wt=u("path",{fill:"currentColor",d:"M12 3c5.5 0 10 3.58 10 8s-4.5 8-10 8c-1.24 0-2.43-.18-3.53-.5C5.55 21 2 21 2 21c2.33-2.33 2.7-3.9 2.75-4.5C3.05 15.07 2 13.13 2 11c0-4.42 4.5-8 10-8Z"},null,-1),Ht=[Wt];function Ot(i,v){return r(),k("svg",zt,Ht)}const Pt={name:"mdi-chat",render:Ot},jt={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ft=u("path",{fill:"currentColor",d:"m22 24l-5.25-5l.63 2H4.5A2.5 2.5 0 0 1 2 18.5v-15A2.5 2.5 0 0 1 4.5 1h15A2.5 2.5 0 0 1 22 3.5V24M12 6.8c-2.68 0-4.56 1.15-4.56 1.15c1.03-.92 2.83-1.45 2.83-1.45l-.17-.17c-1.69.03-3.22 1.2-3.22 1.2c-1.72 3.59-1.61 6.69-1.61 6.69c1.4 1.81 3.48 1.68 3.48 1.68l.71-.9c-1.25-.27-2.04-1.38-2.04-1.38S9.3 14.9 12 14.9s4.58-1.28 4.58-1.28s-.79 1.11-2.04 1.38l.71.9s2.08.13 3.48-1.68c0 0 .11-3.1-1.61-6.69c0 0-1.53-1.17-3.22-1.2l-.17.17s1.8.53 2.83 1.45c0 0-1.88-1.15-4.56-1.15m-2.07 3.79c.65 0 1.18.57 1.17 1.27c0 .69-.52 1.27-1.17 1.27c-.64 0-1.16-.58-1.16-1.27c0-.7.51-1.27 1.16-1.27m4.17 0c.65 0 1.17.57 1.17 1.27c0 .69-.52 1.27-1.17 1.27c-.64 0-1.16-.58-1.16-1.27c0-.7.51-1.27 1.16-1.27Z"},null,-1),Nt=[Ft];function Kt(i,v){return r(),k("svg",jt,Nt)}const Zt={name:"mdi-discord",render:Kt},Jt={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Gt=u("path",{fill:"currentColor",d:"M19.19 8.77q-.46 0-.86-.17q-.39-.17-.69-.47q-.3-.3-.47-.69q-.17-.4-.17-.86q0-.45.17-.85q.17-.4.47-.69q.3-.3.69-.47q.4-.18.86-.17q.45-.01.85.17q.4.17.7.47q.29.29.47.69q.17.4.17.85q0 .46-.17.86q-.17.39-.47.69q-.3.3-.7.47q-.4.17-.85.17m0-3.12q-.39 0-.69.27q-.25.27-.25.66t.25.67q.3.25.69.25q.39 0 .66-.25q.28-.25.28-.67q0-.39-.28-.66q-.27-.27-.66-.27M22 10.33V15q0 .63-.24 1.2q-.26.57-.67.99q-.43.43-1 .67q-.59.25-1.21.25q-.38 0-.76-.11q-.39-.07-.71-.25q-.24.79-.71 1.44q-.47.65-1.1 1.11q-.63.46-1.39.7q-.76.27-1.58.27q-.96 0-1.81-.33q-.82-.33-1.5-.94q-.66-.57-1.09-1.36q-.44-.8-.57-1.74H2.83q-.33 0-.59-.25q-.24-.24-.24-.58V7.73q0-.34.24-.59q.26-.24.59-.24H10q-.29-.6-.29-1.25q0-.61.23-1.15q.22-.5.62-.92q.4-.39.94-.62q.5-.23 1.12-.23q.61 0 1.14.23q.53.23.93.62q.4.42.62.92q.23.54.23 1.15q0 .6-.23 1.14q-.22.53-.62.92q-.4.4-.93.63q-.53.23-1.14.23q-.15 0-.31-.02q-.15-.02-.31-.05v.9h9.06q.39 0 .67.27q.27.27.27.66M12.63 4q-.35 0-.63.11q-.33.13-.56.36q-.22.23-.35.53q-.13.31-.13.65q0 .35.13.65q.13.3.35.53q.23.22.56.36q.28.13.63.13q.34 0 .64-.13q.3-.14.53-.36q.23-.23.36-.53q.14-.3.14-.65q0-.34-.14-.65q-.13-.3-.36-.53q-.23-.23-.53-.36q-.3-.11-.64-.11m-4.85 6.18h1.88V8.62H4.34v1.56h1.88v5h1.56m8.6 1.09v-5.62H12v5.42q0 .34-.24.58q-.26.25-.59.25H8.92q.13.67.47 1.25q.34.57.82.99q.48.41 1.1.65q.61.21 1.32.21q.77 0 1.45-.27q.68-.3 1.2-.81q.51-.51.8-1.19q.3-.68.3-1.46M20.75 15v-4.35h-3.12v5.71q.25.25.57.38q.3.12.68.12q.39 0 .73-.15q.34-.15.59-.4q.26-.25.4-.6q.15-.34.15-.71Z"},null,-1),Qt=[Gt];function Xt(i,v){return r(),k("svg",Jt,Qt)}const Yt={name:"mdi-microsoft-teams",render:Xt},eo={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},to=u("path",{fill:"currentColor",d:"M6 15a2 2 0 0 1-2 2a2 2 0 0 1-2-2a2 2 0 0 1 2-2h2v2m1 0a2 2 0 0 1 2-2a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2a2 2 0 0 1-2-2v-5m2-8a2 2 0 0 1-2-2a2 2 0 0 1 2-2a2 2 0 0 1 2 2v2H9m0 1a2 2 0 0 1 2 2a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2a2 2 0 0 1 2-2h5m8 2a2 2 0 0 1 2-2a2 2 0 0 1 2 2a2 2 0 0 1-2 2h-2v-2m-1 0a2 2 0 0 1-2 2a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2a2 2 0 0 1 2 2v5m-2 8a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2v-2h2m0-1a2 2 0 0 1-2-2a2 2 0 0 1 2-2h5a2 2 0 0 1 2 2a2 2 0 0 1-2 2h-5Z"},null,-1),oo=[to];function ao(i,v){return r(),k("svg",eo,oo)}const no={name:"mdi-slack",render:ao},io=I(()=>E(()=>import("./Editor.8a50dde5.js"),["./Editor.8a50dde5.js","./Editor.vue.2426816e.js","./entry.13466615.js","./entry.0f786d51.css","./deepCompare.d32ec333.js"],import.meta.url).then(i=>i.default||i)),lo=I(()=>E(()=>import("./Params.9ca56983.js"),["./Params.9ca56983.js","./Button.vue.a83cab3b.js","./entry.13466615.js","./entry.0f786d51.css","./index.f2e6837c.js","./debounce.dbc9bf77.js","./toNumber.7aa6a805.js","./isSymbol.b9109ae5.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./index.a8ef1b7e.js","./Input.16966097.js","./antInputDirective.8ac36ea7.js","./FormItemContext.27b2e5db.js","./SearchOutlined.c1eed30a.js","./isPlainObject.4c0f42f1.js","./_getPrototype.00be30f0.js","./TextArea.1bd4034f.js","./Password.d7b16461.js","./FormItem.fe59dafe.js","./identity.b813b76e.js","./Col.23d910dc.js","./responsiveObserve.9209e727.js","./toArray.f6fa5a71.js","./Params.2525f2b5.css"],import.meta.url).then(i=>i.default||i)),so=I(()=>E(()=>import("./Headers.9acbb110.js"),["./Headers.9acbb110.js","./Button.vue.a83cab3b.js","./entry.13466615.js","./entry.0f786d51.css","./index.f2e6837c.js","./debounce.dbc9bf77.js","./toNumber.7aa6a805.js","./isSymbol.b9109ae5.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./index.2660048d.js","./Checkbox.65681aa3.js","./FormItemContext.27b2e5db.js","./createForOfIteratorHelper.37be2624.js","./index.4385a501.js","./toArray.f6fa5a71.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.4991ab9d.js","./useMergedState.1cc2a884.js","./useState.a6853ebd.js","./DownOutlined.9cfe3e0c.js","./CheckOutlined.80115d65.js","./SearchOutlined.c1eed30a.js","./index.a8ef1b7e.js","./Input.16966097.js","./isPlainObject.4c0f42f1.js","./_getPrototype.00be30f0.js","./TextArea.1bd4034f.js","./Password.d7b16461.js","./FormItem.fe59dafe.js","./identity.b813b76e.js","./Col.23d910dc.js","./responsiveObserve.9209e727.js","./Headers.105a640d.css"],import.meta.url).then(i=>i.default||i)),co=I(()=>E(()=>import("./ChannelMultiSelect.b5be9952.js"),["./ChannelMultiSelect.b5be9952.js","./entry.13466615.js","./entry.0f786d51.css","./index.4385a501.js","./toArray.f6fa5a71.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.4991ab9d.js","./useMergedState.1cc2a884.js","./useState.a6853ebd.js","./DownOutlined.9cfe3e0c.js","./CheckOutlined.80115d65.js","./SearchOutlined.c1eed30a.js","./FormItemContext.27b2e5db.js"],import.meta.url).then(i=>i.default||i)),ro=I(()=>E(()=>import("./ColumnFilter.ef938e7b.js").then(i=>i.C),["./ColumnFilter.ef938e7b.js","./entry.13466615.js","./entry.0f786d51.css","./Select.vue.140b59a5.js","./Icon.vue.e15b8911.js","./index.4385a501.js","./toArray.f6fa5a71.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.4991ab9d.js","./useMergedState.1cc2a884.js","./useState.a6853ebd.js","./DownOutlined.9cfe3e0c.js","./CheckOutlined.80115d65.js","./SearchOutlined.c1eed30a.js","./FormItemContext.27b2e5db.js","./Select.6ec8848b.css","./Button.vue.a83cab3b.js","./index.f2e6837c.js","./debounce.dbc9bf77.js","./toNumber.7aa6a805.js","./isSymbol.b9109ae5.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./FieldListAutoCompleteDropdown.vue.57a05762.js","./VirtualCellIcon.52ec82ec.js","./index.5263eb1d.js","./virtualCell.88c63e03.js","./CellIcon.8e3c7692.js","./cell.b6c2deed.js","./useMetas.223da623.js","./useViewColumns.21ea359e.js","./index.e7cf7635.js","./FieldListAutoCompleteDropdown.1cb8de15.css","./SingleSelect.8c9d295d.js","./index.a6329415.js","./index.a1080274.js","./SingleSelect.17e3da37.css","./MultiSelect.1f01b970.js","./MultiSelect.9f8ac802.css","./DatePicker.c7f24add.js","./dayjs.cc1f81b7.js","./index.93e75123.js","./createForOfIteratorHelper.37be2624.js","./DatePicker.21d7c178.css","./YearPicker.8eaafbb8.js","./YearPicker.f9c007b9.css","./TimePicker.c43bcf11.js","./TimePicker.1f0d0847.css","./Rating.vue.c0e16619.js","./useRefs.6ea70d5c.js","./Duration.58d5a3db.js","./durationUtils.4b78cf29.js","./Duration.41e88117.css","./Percent.vue.f5472f8e.js","./Currency.vue.a2ed9434.js","./Decimal.e1dfe729.js","./Decimal.623318fe.css","./Integer.4b12f09e.js","./Integer.e021bec9.css","./Float.f6e635fe.js","./Float.7f975c7f.css","./Text.vue.7449c529.js","./useSmartsheetStore.9bdf3b91.js","./views.3cd4bcb9.js","./useSharedView.746b4f21.js","./index.2a3da6a9.js","./index.2660048d.js","./Checkbox.65681aa3.js","./ColumnFilter.bbc12c74.css"],import.meta.url).then(i=>i.default||i)),po=I(()=>E(()=>import("./Test.78a7db9d.js"),["./Test.78a7db9d.js","./entry.13466615.js","./entry.0f786d51.css","./index.5263eb1d.js"],import.meta.url).then(i=>i.default||i)),uo=I(()=>E(()=>import("./CallLog.59073b5c.js"),["./CallLog.59073b5c.js","./entry.13466615.js","./entry.0f786d51.css","./useMetas.223da623.js","./index.3e3f609f.js","./Input.2c73684e.js","./index.3cc83813.js","./index.62e3d60f.js","./Dropdown.a78be736.js","./useState.a6853ebd.js","./useRefs.6ea70d5c.js","./identity.b813b76e.js","./isSymbol.b9109ae5.js","./_flatRest.037bf8e3.js","./isMobile.e2e89480.js","./useMergedState.1cc2a884.js","./index.638acbb4.js","./Col.23d910dc.js","./responsiveObserve.9209e727.js","./index.89133b21.js","./isPlainObject.4c0f42f1.js","./_getPrototype.00be30f0.js","./index.8edf0358.js","./RightOutlined.2c092523.js","./index.a0a88763.js","./isNumeric.3f69e2aa.js","./LeftOutlined.b2689280.js","./index.bc4f5185.js","./index.4385a501.js","./toArray.f6fa5a71.js","./antInputDirective.8ac36ea7.js","./useMemo.4991ab9d.js","./DownOutlined.9cfe3e0c.js","./CheckOutlined.80115d65.js","./SearchOutlined.c1eed30a.js","./FormItemContext.27b2e5db.js","./useBreakpoint.66a79637.js","./_plugin-vue_export-helper.c27b6911.js","./CallLog.070b6d31.css"],import.meta.url).then(i=>i.default||i)),O=i=>(pt("data-v-a0491cd6"),i=i(),ut(),i),fo={class:"flex nc-webhook-header pb-3 gap-x-2 items-start"},_o={class:"flex flex-1"},mo={class:"flex flex-grow px-1.5 py-0.125 items-center rounded-md border-gray-200 bg-gray-50 outline-gray-200",style:{"outline-style":"solid","outline-width":"thin"}},yo={class:"flex flex-row gap-2"},ho=O(()=>u("div",{class:"flex items-center px-1"},"Test Webhook",-1)),vo={class:"flex items-center px-1"},bo={class:"flex flex-row"},ko=O(()=>u("div",{class:"form-field-header"},"Event",-1)),go={class:"flex items-center"},wo=O(()=>u("div",null,"Action",-1)),qo=O(()=>u("div",null,"Link",-1)),xo={class:"rounded-lg border-1 p-6"},To={key:0,class:"text-gray-600"},Mo={class:"flex items-center"},So=O(()=>u("em",null,[V("Use context variable "),u("strong",null,"data"),V(" to refer the record under consideration")],-1)),Vo=O(()=>u("span",null,[u("strong",null,"data"),V(" : Row data "),u("br")],-1)),Lo={class:"my-3"},$o={href:"https://docs.nocodb.com/developer-resources/webhooks/",target:"_blank"},Co={key:0,class:"nc-webhook-calllog flex w-1/2"},Io=ge({__name:"Editor",props:{hook:{}},emits:["close","delete"],setup(i,{emit:v}){const b=i,{t:P}=et(),{$e:A}=qe(),{api:L,isLoading:B}=tt(),{appInfo:G}=ot(),{hooks:j}=me(Vt()),{project:Q}=me(ht()),X=at(vt,h()),U=h(),R=ke.useForm;let e=nt({id:"",title:"Untitled Webhook",event:void 0,operation:void 0,eventOperation:void 0,notification:{type:"URL",payload:{method:"POST",body:"{{ json data }}",headers:[{}],parameters:[{}],path:""}},condition:!1,active:!0,version:"v2"});const _=h(e.version==="v1"||e.version==="v2"&&G.value.ee),f=h(_.value?"body":"params"),s=h(),d=h(),D=h([]),Y=h([]),ee=h([]),te=h([]),oe=h(),de=h({Email:[{key:"to",label:"To Address",placeholder:"To Address",type:"SingleLineText",required:!0},{key:"subject",label:"Subject",placeholder:"Subject",type:"SingleLineText",required:!0},{key:"body",label:"Body",placeholder:"Body",type:"LongText",required:!0}],Slack:[{key:"body",label:"Body",placeholder:"Body",type:"LongText",required:!0}],"Microsoft Teams":[{key:"body",label:"Body",placeholder:"Body",type:"LongText",required:!0}],Discord:[{key:"body",label:"Body",placeholder:"Body",type:"LongText",required:!0}],Mattermost:[{key:"body",label:"Body",placeholder:"Body",type:"LongText",required:!0}],Twilio:[{key:"body",label:"Body",placeholder:"Body",type:"LongText",required:!0},{key:"to",label:"Comma separated Mobile #",placeholder:"Comma separated Mobile #",type:"LongText",required:!0}],"Whatsapp Twilio":[{key:"body",label:"Body",placeholder:"Body",type:"LongText",required:!0},{key:"to",label:"Comma separated Mobile #",placeholder:"Comma separated Mobile #",type:"LongText",required:!0}]}),pe=h(!1),ae=W(()=>!1),ue=h([{text:["After","Insert"],value:["after","insert"]},{text:["After","Update"],value:["after","update"]},{text:["After","Delete"],value:["after","delete"]},{text:["After","Bulk Insert"],value:["after","bulkInsert"]},{text:["After","Bulk Update"],value:["after","bulkUpdate"]},{text:["After","Bulk Delete"],value:["after","bulkDelete"]}]),xe=W(()=>[{type:"URL"},{type:"Email"},{type:"Slack"},{type:"Microsoft Teams"},{type:"Discord"},{type:"Mattermost"},{type:"Twilio"},{type:"Whatsapp Twilio"}]),Te=[{title:"GET"},{title:"POST"},{title:"DELETE"},{title:"PUT"},{title:"HEAD"},{title:"PATCH"}],Me=W(()=>({title:[w()],eventOperation:[w()],"notification.type":[w()],...e.notification.type==="URL"&&{"notification.payload.method":[w()],"notification.payload.path":[w()]},...e.notification.type==="Email"&&{"notification.payload.to":[w()],"notification.payload.subject":[w()],"notification.payload.body":[w()]},...["Slack","Microsoft Teams","Discord","Mattermost"].includes(e.notification.type)&&{"notification.payload.channels":[w()],"notification.payload.body":[w()]},...(e.notification.type==="Twilio"||e.notification.type==="Whatsapp Twilio")&&{"notification.payload.body":[w()],"notification.payload.to":[w()]}})),{validate:Se,validateInfos:q}=R(e,Me),Ve=W(()=>{const c=o=>{for(const p in o)if(typeof o[p]=="object"){if(!c(o[p]))return!1}else if(o&&p==="validateStatus"&&o[p]==="error")return!1;return!0};return e&&c(q)});function fe(c=!1){c&&(e.notification.payload={},["Slack","Microsoft Teams","Discord","Mattermost"].includes(e.notification.type)&&(e.notification.payload.channels=[],e.notification.payload.body="")),e.notification.type==="Slack"&&(D.value=s.value&&s.value.Slack&&s.value.Slack.parsedInput||[]),e.notification.type==="Microsoft Teams"&&(Y.value=s.value&&s.value["Microsoft Teams"]&&s.value["Microsoft Teams"].parsedInput||[]),e.notification.type==="Discord"&&(ee.value=s.value&&s.value.Discord&&s.value.Discord.parsedInput||[]),e.notification.type==="Mattermost"&&(te.value=s.value&&s.value.Mattermost&&s.value.Mattermost.parsedInput||[]),e.notification.type==="URL"&&(e.notification.payload.body=e.notification.payload.body||"{{ json data }}",e.notification.payload.parameters=e.notification.payload.parameters||[{}],e.notification.payload.headers=e.notification.payload.headers||[{}],e.notification.payload.method=e.notification.payload.method||"POST",e.notification.payload.auth=e.notification.payload.auth||"")}function Le(c){const o=c.notification;Object.assign(e,{...c,notification:{...o,payload:o.payload}}),e.version==="v1"&&(f.value="body",ue.value=[{text:["After","Insert"],value:["after","insert"]},{text:["After","Update"],value:["after","update"]},{text:["After","Delete"],value:["after","delete"]}])}function $e(){const{notification:{payload:c={},type:o={}}={}}=e;Object.assign(e,{...e,notification:{type:o,payload:c}}),e.notification.payload=c;const p=h(null);switch(e.notification.type){case"Slack":p.value=D.value;break;case"Microsoft Teams":p.value=Y.value;break;case"Discord":p.value=ee.value;break;case"Mattermost":p.value=te.value;break}p&&(e.notification.payload.webhook_url=e.notification.payload.webhook_url&&e.notification.payload.webhook_url.map(T=>{var z;return(z=p.value)==null?void 0:z.find(F=>T.webhook_url===F.webhook_url)})),e.notification.type==="URL"&&(e.notification.payload=e.notification.payload||{},e.notification.payload.parameters=e.notification.payload.parameters||[{}],e.notification.payload.headers=e.notification.payload.headers||[{}],e.notification.payload.method=e.notification.payload.method||"POST")}async function Ce(){try{const c=(await L.plugin.webhookList({query:{project_id:Q.value.id}})).list;s.value=c.reduce((o,p)=>{const T={title:"",tags:[],parsedInput:{},...p};return T.tags=p.tags?p.tags.split(","):[],T.parsedInput=re(p.input),o[T.title]=T,o},{})}catch(c){C.error(await H(c))}}async function Ie(){B.value=!0;try{await Se()}catch{C.error(P("msg.error.invalidForm")),B.value=!1;return}try{let c;e.id?c=await L.dbTableWebhook.update(e.id,{...e,notification:{...e.notification,payload:e.notification.payload}}):(c=await L.dbTableWebhook.create(X.value.id,{...e,notification:{...e.notification,payload:e.notification.payload}}),j.value.push(c)),c&&typeof c.notification=="string"&&(c.notification=JSON.parse(c.notification)),!e.id&&c&&(e={...e,...c}),oe.value&&await oe.value.applyChanges(e.id),j.value=j.value.map(o=>o.id===e.id?e:o),v("close")}catch(c){C.error(await H(c))}finally{B.value=!1}A("a:webhook:add",{operation:e.operation,condition:e.condition,notification:e.notification.type})}async function Ee(){await d.value.testWebhook()}return ye(()=>e.eventOperation,()=>{if(!e.eventOperation)return;const[c,o]=e.eventOperation.split(" ");e.event=c,e.operation=o}),ye(()=>b.hook,()=>{b.hook&&(Le(b.hook),$e())},{immediate:!0}),it(async()=>{await Ce(),e.event&&e.operation&&(e.eventOperation=`${e.event} ${e.operation}`),fe(),setTimeout(()=>{var c,o;e.id===""&&((c=U.value)==null||c.click(),(o=U.value)==null||o.select())},50)}),(c,o)=>{const p=qt,T=ft,z=xt,F=_t,g=bt,Ae=no,Be=Yt,Ue=Zt,Re=Pt,De=Dt,ze=Et,M=Tt,_e=kt,We=io,ne=yt,He=lo,Oe=so,Pe=St,Z=co,je=gt,Fe=wt,Ne=ro,Ke=dt,Ze=po,Je=ke,Ge=uo;return r(),k(K,null,[u("div",fo,[u("div",_o,[l(p,le(t(q).title,{class:"flex flex-grow"}),{default:n(()=>[u("div",mo,[lt(u("input",{ref_key:"titleDomRef",ref:U,"onUpdate:modelValue":o[0]||(o[0]=a=>t(e).title=a),class:"flex flex-grow text-lg font-medium capitalize outline-none bg-inherit nc-text-field-hook-title",placeholder:"Webhook Title",contenteditable:!0,onBlur:o[1]||(o[1]=a=>pe.value=!1),onFocus:o[2]||(o[2]=a=>pe.value=!0),onKeydown:o[3]||(o[3]=st(he(a=>{var x;return(x=t(U))==null?void 0:x.blur()},["prevent"]),["enter"]))},null,544),[[ct,t(e).title]])])]),_:1},16)]),u("div",yo,[l(T,{class:"nc-btn-webhook-test",type:"secondary",size:"small",onClick:Ee},{default:n(()=>[ho]),_:1}),l(T,{class:"nc-btn-webhook-save",type:"primary",loading:t(B),size:"small",disabled:!t(Ve),onClick:he(Ie,["prevent"])},{loading:n(()=>[V(" Saving ")]),default:n(()=>[u("div",vo,N(c.$t("general.save")),1)]),_:1},8,["loading","disabled","onClick"])])]),u("div",bo,[u("div",{class:we(["nc-webhook-form flex flex-col",{"w-1/2":t(ae),"w-full":!t(ae)}])},[l(Je,{model:t(e),name:"create-or-edit-webhook"},{default:n(()=>[l(p,null,{default:n(()=>[ko,l(M,{type:"flex",gutter:[16,16]},{default:n(()=>[l(g,{span:12},{default:n(()=>[l(p,S($(t(q).eventOperation)),{default:n(()=>[l(F,{value:t(e).eventOperation,"onUpdate:value":o[4]||(o[4]=a=>t(e).eventOperation=a),size:"large",placeholder:c.$t("general.event"),class:"nc-text-field-hook-event capitalize","dropdown-class-name":"nc-dropdown-webhook-event"},{default:n(()=>[(r(!0),k(K,null,J(t(ue),(a,x)=>(r(),m(z,{key:x,class:"capitalize",value:a.value.join(" ")},{default:n(()=>[V(N(a.text.join(" ")),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},16)]),_:1}),l(g,{span:12},{default:n(()=>[l(p,S($(t(q)["notification.type"])),{default:n(()=>[l(F,{value:t(e).notification.type,"onUpdate:value":o[5]||(o[5]=a=>t(e).notification.type=a),size:"large",class:"nc-select-hook-notification-type",placeholder:c.$t("general.notification"),"dropdown-class-name":"nc-dropdown-webhook-notification",onChange:o[6]||(o[6]=a=>fe(!0))},{default:n(()=>[(r(!0),k(K,null,J(t(xe),(a,x)=>(r(),m(z,{key:x,value:a.type},{default:n(()=>[u("div",go,[a.type==="URL"?(r(),m(se(t(ce).link),{key:0,class:"mr-2"})):y("",!0),a.type==="Email"?(r(),m(se(t(ce).email),{key:1,class:"mr-2"})):y("",!0),a.type==="Slack"?(r(),m(Ae,{key:2,class:"mr-2"})):y("",!0),a.type==="Microsoft Teams"?(r(),m(Be,{key:3,class:"mr-2"})):y("",!0),a.type==="Discord"?(r(),m(Ue,{key:4,class:"mr-2"})):y("",!0),a.type==="Mattermost"?(r(),m(Re,{key:5,class:"mr-2"})):y("",!0),a.type==="Whatsapp Twilio"?(r(),m(De,{key:6,class:"mr-2"})):y("",!0),a.type==="Twilio"?(r(),m(ze,{key:7,class:"mr-2"})):y("",!0),V(" "+N(a.type),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},16)]),_:1})]),_:1}),t(e).notification.type==="URL"?(r(),m(M,{key:0,class:"mb-5",type:"flex",gutter:[16,0]},{default:n(()=>[l(g,{span:6},{default:n(()=>[wo,l(F,{value:t(e).notification.payload.method,"onUpdate:value":o[7]||(o[7]=a=>t(e).notification.payload.method=a),size:"large",class:"nc-select-hook-url-method","dropdown-class-name":"nc-dropdown-hook-notification-url-method"},{default:n(()=>[(r(),k(K,null,J(Te,(a,x)=>l(z,{key:x,value:a.title},{default:n(()=>[V(N(a.title),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1}),l(g,{span:18},{default:n(()=>[qo,l(p,S($(t(q)["notification.payload.path"])),{default:n(()=>[l(_e,{value:t(e).notification.payload.path,"onUpdate:value":o[8]||(o[8]=a=>t(e).notification.payload.path=a),size:"large",placeholder:"http://example.com",class:"nc-text-field-hook-url-path !rounded-md"},null,8,["value"])]),_:1},16)]),_:1}),l(g,{span:24},{default:n(()=>[l(Pe,{activeKey:t(f),"onUpdate:activeKey":o[12]||(o[12]=a=>rt(f)?f.value=a:null),type:"card",closeable:"false",class:"border-1 !pb-2 !rounded-lg"},{default:n(()=>[t(_)?(r(),m(ne,{key:"body",tab:"Body"},{default:n(()=>[l(We,{modelValue:t(e).notification.payload.body,"onUpdate:modelValue":o[9]||(o[9]=a=>t(e).notification.payload.body=a),"disable-deep-compare":"",validate:!1,class:"min-h-60 max-h-80"},null,8,["modelValue"])]),_:1})):y("",!0),l(ne,{key:"params",tab:"Parameters","force-render":""},{default:n(()=>[l(He,{modelValue:t(e).notification.payload.parameters,"onUpdate:modelValue":o[10]||(o[10]=a=>t(e).notification.payload.parameters=a),class:"p-4"},null,8,["modelValue"])]),_:1}),l(ne,{key:"headers",tab:"Headers",class:"nc-tab-headers"},{default:n(()=>[l(Oe,{modelValue:t(e).notification.payload.headers,"onUpdate:modelValue":o[11]||(o[11]=a=>t(e).notification.payload.headers=a),class:"!p-4"},null,8,["modelValue"])]),_:1})]),_:1},8,["activeKey"])]),_:1})]),_:1})):y("",!0),t(e).notification.type==="Slack"?(r(),m(M,{key:1,type:"flex"},{default:n(()=>[l(g,{span:24},{default:n(()=>[l(p,S($(t(q)["notification.payload.channels"])),{default:n(()=>[l(Z,{modelValue:t(e).notification.payload.channels,"onUpdate:modelValue":o[13]||(o[13]=a=>t(e).notification.payload.channels=a),"selected-channel-list":t(e).notification.payload.channels,"available-channel-list":t(D),placeholder:"Select Slack channels"},null,8,["modelValue","selected-channel-list","available-channel-list"])]),_:1},16)]),_:1})]),_:1})):y("",!0),t(e).notification.type==="Microsoft Teams"?(r(),m(M,{key:2,type:"flex"},{default:n(()=>[l(g,{span:24},{default:n(()=>[l(p,S($(t(q)["notification.payload.channels"])),{default:n(()=>[l(Z,{modelValue:t(e).notification.payload.channels,"onUpdate:modelValue":o[14]||(o[14]=a=>t(e).notification.payload.channels=a),"selected-channel-list":t(e).notification.payload.channels,"available-channel-list":t(Y),placeholder:"Select Microsoft Teams channels"},null,8,["modelValue","selected-channel-list","available-channel-list"])]),_:1},16)]),_:1})]),_:1})):y("",!0),t(e).notification.type==="Discord"?(r(),m(M,{key:3,type:"flex"},{default:n(()=>[l(g,{span:24},{default:n(()=>[l(p,S($(t(q)["notification.payload.channels"])),{default:n(()=>[l(Z,{modelValue:t(e).notification.payload.channels,"onUpdate:modelValue":o[15]||(o[15]=a=>t(e).notification.payload.channels=a),"selected-channel-list":t(e).notification.payload.channels,"available-channel-list":t(ee),placeholder:"Select Discord channels"},null,8,["modelValue","selected-channel-list","available-channel-list"])]),_:1},16)]),_:1})]),_:1})):y("",!0),t(e).notification.type==="Mattermost"?(r(),m(M,{key:4,type:"flex"},{default:n(()=>[l(g,{span:24},{default:n(()=>[l(p,S($(t(q)["notification.payload.channels"])),{default:n(()=>[l(Z,{modelValue:t(e).notification.payload.channels,"onUpdate:modelValue":o[16]||(o[16]=a=>t(e).notification.payload.channels=a),"selected-channel-list":t(e).notification.payload.channels,"available-channel-list":t(te),placeholder:"Select Mattermost channels"},null,8,["modelValue","selected-channel-list","available-channel-list"])]),_:1},16)]),_:1})]),_:1})):y("",!0),t(de)[t(e).notification.type]&&t(e).notification.payload?(r(),m(M,{key:5,type:"flex"},{default:n(()=>[(r(!0),k(K,null,J(t(de)[t(e).notification.type],(a,x)=>(r(),m(g,{key:x,span:24},{default:n(()=>[a.type==="LongText"?(r(),m(p,S(le({key:0},t(q)[`notification.payload.${a.key}`])),{default:n(()=>[l(je,{value:t(e).notification.payload[a.key],"onUpdate:value":ie=>t(e).notification.payload[a.key]=ie,placeholder:a.label,size:"large"},null,8,["value","onUpdate:value","placeholder"])]),_:2},1040)):(r(),m(p,S(le({key:1},t(q)[`notification.payload.${a.key}`])),{default:n(()=>[l(_e,{value:t(e).notification.payload[a.key],"onUpdate:value":ie=>t(e).notification.payload[a.key]=ie,placeholder:a.label,size:"large"},null,8,["value","onUpdate:value","placeholder"])]),_:2},1040))]),_:2},1024))),128))]),_:1})):y("",!0),l(M,{class:"mb-5",type:"flex"},{default:n(()=>[l(g,{span:24},{default:n(()=>[u("div",xo,[l(Fe,{checked:!!t(e).condition,class:"nc-check-box-hook-condition","onUpdate:checked":o[17]||(o[17]=a=>t(e).condition=a)},{default:n(()=>[V(" On Condition ")]),_:1},8,["checked"]),t(e).condition?(r(),m(Ne,{key:0,ref_key:"filterRef",ref:oe,class:"!p-0 mt-4","auto-save":!1,"show-loading":!1,"hook-id":t(e).id,"web-hook":!0},null,8,["hook-id"])):y("",!0)])]),_:1})]),_:1}),l(M,null,{default:n(()=>[l(g,{span:24},{default:n(()=>[t(_)?(r(),k("div",To,[u("div",Mo,[So,l(Ke,{bottom:""},{title:n(()=>[Vo]),default:n(()=>[(r(),m(se(t(ce).info),{class:"ml-2"}))]),_:1})]),u("div",Lo,[u("a",$o,N(c.$t("labels.docReference")),1)])])):y("",!0),l(Ze,{ref_key:"webhookTestRef",ref:d,hook:{...t(e),notification:{...t(e).notification,payload:t(e).notification.payload}}},null,8,["hook"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])],2),t(ae)?(r(),k("div",Co,[l(Ge,{hook:t(e)},null,8,["hook"])])):y("",!0)])],64)}}});const Eo=Mt(Io,[["__scopeId","data-v-a0491cd6"]]),Xo=Object.freeze(Object.defineProperty({__proto__:null,default:Eo},Symbol.toStringTag,{value:"Module"}));export{Xo as E,St as _,Eo as a,Vt as u};
