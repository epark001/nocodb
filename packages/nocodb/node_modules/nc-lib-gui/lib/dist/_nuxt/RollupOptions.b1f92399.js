import L from"./VirtualCellIcon.f17eeb0a.js";import{_ as $}from"./CellIcon.8a6080fd.js";import{M as E}from"./index.5263eb1d.js";import{h as N,T as U,$ as F,r as P,cb as W,i as R,eW as z,f3 as S,dg as G,k as H,o as s,c as f,a as r,b as u,w as i,E as n,aj as h,cp as w,C as b,t as c,d as C,cA as y,D as J,m as K,p as Q,e as X}from"./entry.51f4e399.js";import{a as Y}from"./EditOrAddProvider.vue.09b12d8b.js";import{a as Z,u as ee}from"./useMetas.ba7abae7.js";import{S as oe,_ as te}from"./index.5e746f62.js";import{_ as le}from"./FormItem.cda40628.js";import{_ as ne}from"./_plugin-vue_export-helper.c27b6911.js";import"./virtualCell.4dce1393.js";import"./cell.1732684e.js";import"./Icon.vue.1162f18b.js";import"./Button.vue.793bcd1d.js";import"./index.0db47614.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isSymbol.b53bd26f.js";import"./useBetaFeatureToggle.5dbba600.js";import"./index.e5ddde08.js";import"./validation.6db726f3.js";import"./index.de92142d.js";import"./useSize.3b3f469f.js";import"./identity.dd5da9ba.js";import"./_flatRest.ff2d3d5c.js";import"./isPlainObject.ecf52d25.js";import"./_getPrototype.ec1165af.js";import"./FormItemContext.e001cd7c.js";import"./index.e760d172.js";import"./Input.7cb175ff.js";import"./antInputDirective.8ac36ea7.js";import"./SearchOutlined.dec109ce.js";import"./TextArea.442a25cb.js";import"./Password.d493e47a.js";import"./index.0d6d8ba8.js";import"./Checkbox.a529f1e6.js";import"./createForOfIteratorHelper.12419aa5.js";import"./toArray.06afb623.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";const ae=m=>(Q("data-v-7a3ae070"),m=m(),X(),m),ie={class:"p-6 w-full flex flex-col border-2 mb-2 mt-4"},se={class:"w-full flex flex-row space-x-2"},ue={class:"flex flex-row h-full pb-0.5 items-center max-w-full"},re={class:"font-semibold text-xs flex-shrink flex-grow-0 truncate"},_e=ae(()=>r("div",{class:"flex-grow"},null,-1)),me={class:"text-[0.65rem] text-gray-600 nc-relation-details"},pe={class:"uppercase"},ce={class:"flex items-center -ml-1 font-semibold text-xs"},de=N({__name:"RollupOptions",props:{value:{}},emits:["update:value"],setup(m,{emit:T}){const o=U(m,"value",T),d=F(E,P()),{setAdditionalValidations:I,validateInfos:v,onDataTypeChange:x,isEdit:M}=Y(),q=Z(),{tables:k}=W(q),{metas:V}=ee();I({fk_relation_column_id:[{required:!0,message:"Required"}],fk_rollup_column_id:[{required:!0,message:"Required"}],rollup_function:[{required:!0,message:"Required"}]});const j=[{text:"count",value:"count"},{text:"min",value:"min"},{text:"max",value:"max"},{text:"avg",value:"avg"},{text:"sum",value:"sum"},{text:"countDistinct",value:"countDistinct"},{text:"sumDistinct",value:"sumDistinct"},{text:"avgDistinct",value:"avgDistinct"}];o.value.fk_relation_column_id||(o.value.fk_relation_column_id=null),o.value.fk_rollup_column_id||(o.value.fk_rollup_column_id=null),o.value.rollup_function||(o.value.rollup_function=null);const O=R(()=>!k.value||!k.value.length||!d.value||!d.value.columns?[]:d.value.columns.filter(e=>{var a;return z(e)&&e.colOptions.type!=="bt"&&!e.system&&e.base_id===((a=d.value)==null?void 0:a.base_id)}).map(e=>({col:e.colOptions,column:e,...k.value.find(a=>{var _;return a.id===((_=e.colOptions)==null?void 0:_.fk_related_model_id)})}))),D=R(()=>{const l=O.value.find(e=>e.column.id===o.value.fk_relation_column_id);return l!=null&&l.id?V.value[l.id].columns.filter(e=>!S(e.uidt)&&(!G(e)||e.pk)):[]});H(()=>{var l,e,a;M.value&&(o.value.fk_relation_column_id=(l=o.value.colOptions)==null?void 0:l.fk_relation_column_id,o.value.fk_rollup_column_id=(e=o.value.colOptions)==null?void 0:e.fk_rollup_column_id,o.value.rollup_function=(a=o.value.colOptions)==null?void 0:a.rollup_function)});const A=()=>{var l,e;o.value.fk_rollup_column_id=(e=(l=D.value)==null?void 0:l[0])==null?void 0:e.id,x()},B=l=>K(S(l)?L:$,{columnMeta:l});return(l,e)=>{const a=oe,_=te,g=le;return s(),f("div",ie,[r("div",se,[u(g,y({class:"flex w-1/2 pb-2",label:l.$t("labels.links")},n(v).fk_relation_column_id),{default:i(()=>[u(_,{value:n(o).fk_relation_column_id,"onUpdate:value":e[0]||(e[0]=t=>n(o).fk_relation_column_id=t),"dropdown-class-name":"!w-64 nc-dropdown-relation-table",onChange:A},{default:i(()=>[(s(!0),f(h,null,w(n(O),(t,p)=>(s(),b(a,{key:p,value:t.col.fk_column_id},{default:i(()=>[r("div",ue,[r("div",re,c(t.column.title),1),_e,r("div",me,[r("span",pe,c(t.col.type),1),C(" "+c(t.title||t.table_name),1)])])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16,["label"]),u(g,y({class:"flex w-1/2",label:l.$t("labels.childColumn")},n(v).fk_rollup_column_id),{default:i(()=>[u(_,{value:n(o).fk_rollup_column_id,"onUpdate:value":e[1]||(e[1]=t=>n(o).fk_rollup_column_id=t),name:"fk_rollup_column_id","dropdown-class-name":"nc-dropdown-relation-column",onChange:n(x)},{default:i(()=>[(s(!0),f(h,null,w(n(D),(t,p)=>(s(),b(a,{key:p,value:t.id},{default:i(()=>[r("div",ce,[(s(),b(J(B(t)),{"column-meta":t},null,8,["column-meta"])),C(" "+c(t.title),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange"])]),_:1},16,["label"])]),u(g,y({label:"Aggregate function"},n(v).rollup_function),{default:i(()=>[u(_,{value:n(o).rollup_function,"onUpdate:value":e[2]||(e[2]=t=>n(o).rollup_function=t),"dropdown-class-name":"nc-dropdown-rollup-function",onChange:n(x)},{default:i(()=>[(s(),f(h,null,w(j,(t,p)=>u(a,{key:p,value:t.value},{default:i(()=>[C(c(t.text),1)]),_:2},1032,["value"])),64))]),_:1},8,["value","onChange"])]),_:1},16)])}}});const so=ne(de,[["__scopeId","data-v-7a3ae070"]]);export{so as default};
