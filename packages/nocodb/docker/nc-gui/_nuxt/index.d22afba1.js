import{_ as kt}from"./QuickImport.vue.13f30a49.js";import{h as he,al as oa,T as dt,o as l,C as N,w as n,a,b as t,E as e,H as Y,p as Oe,e as ze,r as $,f as ke,cb as me,c1 as na,i as le,c as w,co as sa,t as p,W as Q,aj as Z,cp as be,d as A,cq as la,b5 as ot,V as ca,I as Te,z as pt,J as W,K as ve,B as ia,cr as ut,A as Fe,cs as ra,ct as Ke,L as Ee,S as nt,k as Le,cu as da,cv as $t,cw as ua,cx as Ct,cy as rt,cz as et,cA as de,cB as _a,G as Me,$ as vt,cC as Be,cl as z,cD as X,cE as jt,aq as we,ap as pa,cF as It,cG as Ve,D as $e,F as xe,cH as Ut,_ as We,P as _t,m as Ue,cI as va,aV as xt,cJ as oe,cc as ma,g as fa,ck as ba,Q as ya,R as ha,cK as ga,cn as wa}from"./entry.13466615.js";import{_ as $a}from"./OpenLeftSidebarBtn.vue.55bf93c3.js";import{_ as xa}from"./ProjectIcon.05001560.js";import{_ as Sa,a as ka,b as Pt,c as Ca,g as ja}from"./plus.5f5a668e.js";import{_ as He}from"./Icon.vue.e15b8911.js";import{_ as mt}from"./Modal.vue.fe6a4790.js";import{u as tt}from"./index.18c65772.js";import{_ as Pe}from"./_plugin-vue_export-helper.c27b6911.js";import{b as at,c as Ge,a as Ce,d as Ia,e as Ua}from"./useMetas.223da623.js";import{u as Nt}from"./index.e7cf7635.js";import{i as Pa}from"./domUtils.b0dc23e8.js";import{_ as Tt}from"./Select.vue.140b59a5.js";import{a as Mt,_ as ft}from"./Button.vue.a83cab3b.js";import{u as Na}from"./useCopy.a0671815.js";import{u as Ta}from"./useDashboard.34dd8f64.js";import{u as Ma}from"./index.2a3da6a9.js";import{u as Ea,K as La}from"./v3-infinite-loading.e93e94ab.js";import{M as Et}from"./chevron-down.166de573.js";import{_ as Aa}from"./send-outline.95d535cb.js";import{_ as Lt}from"./index.2c1df8bc.js";import"./index.a8ef1b7e.js";import{I as Ye}from"./Input.16966097.js";import{S as st,_ as At}from"./index.4385a501.js";import{F as Je}from"./index.6f605a00.js";import{i as St}from"./index.2ae12d3e.js";import{_ as Da}from"./DeleteModal.vue.55101b0a.js";import{D as Ra}from"./vuedraggable.umd.8d33c631.js";import{_ as Dt}from"./Editor.vue.2426816e.js";import{f as H,p as Rt,e as Bt}from"./validation.5ed31fc1.js";import{P as bt}from"./index.5263eb1d.js";import{r as Vt}from"./fileUtils.43128440.js";import{C as Ot}from"./index.3cc83813.js";import{_ as zt,C as Ft}from"./index.8edf0358.js";import{_ as Gt}from"./FormItem.fe59dafe.js";import{_ as Qt}from"./Password.d7b16461.js";import{_ as qt}from"./index.7bdf0a46.js";import{_ as Kt}from"./index.1669d181.js";import{_ as Jt}from"./TableIcon.vue.95089890.js";import{a as yt}from"./index.66af8095.js";import{_ as Ba}from"./TruncateText.vue.454bbb27.js";import{_ as Va}from"./ViewIcon.vue.8aa1efd9.js";import{C as Oa}from"./index.2660048d.js";import{_ as za}from"./View.vue.d0d00de4.js";import{_ as Fa}from"./index.bc4f5185.js";import{_ as Ga}from"./index.7677ce8f.js";import{_ as Wt,T as Ht}from"./index.62e3d60f.js";import{u as Qa}from"./tab.586445bb.js";const Ze=j=>(Oe("data-v-75456ef1"),j=j(),ze(),j),qa={class:"flex flex-col px-8 pt-6 pb-9"},Ka=Ze(()=>a("div",{class:"text-lg font-medium mb-6"},"Import",-1)),Ja={class:"row mb-10"},Wa=Ze(()=>a("div",{class:"label"},"Airtable",-1)),Ha=Ze(()=>a("div",{class:"label"},"CSV",-1)),Ya={class:"row"},Za=Ze(()=>a("div",{class:"label"},"Excel",-1)),Xa=Ze(()=>a("div",{class:"label"},"JSON",-1)),eo=he({__name:"ImportModal",props:{visible:{type:Boolean},base:{}},emits:["update:visible"],setup(j,{emit:x}){const D=j,U=oa(D,"base"),G=dt(D,"visible",x),{$e:B}=ke();function L(b){if(!b)return;B("a:actions:import-airtable");const k=$(!0),{close:c}=tt(Sa,{modelValue:k,baseId:b,"onUpdate:modelValue":u});function u(){k.value=!1,c(1e3)}}function T(b){if(!U.value.id)return;B(`a:actions:import-${b}`);const k=$(!0),{close:c}=tt(kt,{modelValue:k,importType:b,baseId:U.value.id,"onUpdate:modelValue":u});function u(){k.value=!1,c(1e3)}}const P=b=>{G.value=!1,b==="airtable"?L(U.value.id):T(b)};return(b,k)=>{const c=He,u=mt;return l(),N(u,{visible:e(G),"onUpdate:visible":k[4]||(k[4]=d=>Y(G)?G.value=d:null),width:"35rem"},{default:n(()=>[a("div",qa,[Ka,a("div",Ja,[a("div",{class:"nc-project-view-import-sub-btn",onClick:k[0]||(k[0]=d=>P("airtable"))},[t(c,{icon:"airtable"}),Wa]),a("div",{class:"nc-project-view-import-sub-btn",onClick:k[1]||(k[1]=d=>P("csv"))},[t(c,{icon:"csv"}),Ha])]),a("div",Ya,[a("div",{class:"nc-project-view-import-sub-btn",onClick:k[2]||(k[2]=d=>P("excel"))},[t(c,{icon:"excelColored"}),Za]),a("div",{class:"nc-project-view-import-sub-btn",onClick:k[3]||(k[3]=d=>P("json"))},[t(c,{icon:"code"}),Xa])])])]),_:1},8,["visible"])}}});const to=Pe(eo,[["__scopeId","data-v-75456ef1"]]),ao={class:"nc-all-tables-view"},oo={key:0,class:"flex flex-row gap-x-6 pb-3 pt-6"},no={class:"label"},so={class:"label"},lo={class:"flex flex-row w-full text-gray-400 border-b-1 border-gray-50 py-3 px-2.5"},co={class:"w-2/5"},io={class:"w-1/5"},ro={class:"w-1/5"},uo=["onClick"],_o={class:"flex flex-row w-2/5 items-center gap-x-2","data-testid":"proj-view-list__item-title"},po={class:"w-1/5 text-gray-600","data-testid":"proj-view-list__item-type"},vo={key:0,class:"ml-0.75"},mo={key:1},fo={class:"w-1/5 text-gray-400 ml-0.25","data-testid":"proj-view-list__item-created-at"},bo=he({__name:"AllTables",setup(j){const{activeTables:x}=me(at()),{openTable:D}=at(),{openedProject:U}=me(Ge()),{isUIAllowed:G}=Nt(),{allRoles:B}=na(),{$e:L}=ke(),T=$(!1),P=le(()=>{var c,u;return(u=(c=U.value)==null?void 0:c.bases)==null?void 0:u[0]}),b=le(()=>{var u,d;const c=new Map;return(d=(u=U.value)==null?void 0:u.bases)==null||d.forEach(o=>{c.set(o.id,o)}),c});function k(c){var f,I,C;L("c:table:create:navdraw");const u=$(!0);let d=(f=U.value.bases)==null?void 0:f[0].id;if(typeof c=="number"&&(d=(I=U.value.bases)==null?void 0:I[c].id),!d||!((C=U.value)!=null&&C.id))return;const{close:o}=tt(ka,{modelValue:u,baseId:d,projectId:U.value.id,onCreate:S,"onUpdate:modelValue":()=>S()});function S(r){u.value=!1,r&&(setTimeout(()=>{const v=document.querySelector(`[data-table-id="${r.id}"]`);v&&Pa(v)&&(v==null||v.scrollIntoView({behavior:"smooth"}))},1e3),o(1e3))}}return(c,u)=>{const d=He,o=Pt,S=to;return l(),w("div",ao,[e(G)("tableCreate",!1,e(sa)(e(B)))?(l(),w("div",oo,[a("div",{class:"nc-project-view-all-table-btn","data-testid":"proj-view-btn__add-new-table",onClick:u[0]||(u[0]=f=>k())},[t(d,{icon:"addOutlineBox"}),a("div",no,p(c.$t("general.new"))+" "+p(c.$t("objects.table")),1)]),a("div",{class:"nc-project-view-all-table-btn","data-testid":"proj-view-btn__import-data",onClick:u[1]||(u[1]=f=>T.value=!0)},[t(d,{icon:"download"}),a("div",so,p(c.$t("activity.import"))+" "+p(c.$t("general.data")),1)])])):Q("",!0),a("div",lo,[a("div",co,p(c.$t("objects.table")),1),a("div",io,p(c.$t("general.source")),1),a("div",ro,p(c.$t("labels.createdOn")),1)]),a("div",{class:"nc-project-view-all-table-list nc-scrollbar-md",style:ot({height:"calc(100vh - var(--topbar-height) - 18rem)"})},[(l(!0),w(Z,null,be([...e(x)].sort((f,I)=>f.base_id.localeCompare(I.base_id)*20),f=>{var I,C,r;return l(),w("div",{key:f.id,class:"py-4 flex flex-row w-full cursor-pointer hover:bg-gray-100 border-b-1 border-gray-100 px-2.25","data-testid":"proj-view-list__item",onClick:v=>e(D)(f)},[a("div",_o,[t(d,{icon:"table",class:"text-gray-700"}),A(" "+p(f==null?void 0:f.title),1)]),a("div",po,[f.base_id===((I=e(P))==null?void 0:I.id)?(l(),w("div",vo,"-")):(l(),w("div",mo,[t(o,{"base-type":(C=e(b).get(f.base_id))==null?void 0:C.type,class:"w-4 mr-1"},null,8,["base-type"]),A(" "+p((r=e(b).get(f.base_id))==null?void 0:r.alias),1)]))]),a("div",fo,p(e(la)(f==null?void 0:f.created_at).fromNow()),1)],8,uo)}),128))],4),e(P)?(l(),N(S,{key:1,visible:e(T),"onUpdate:visible":u[2]||(u[2]=f=>Y(T)?T.value=f:null),base:e(P)},null,8,["visible","base"])):Q("",!0)])}}});const yo=Pe(bo,[["__scopeId","data-v-0cf38c60"]]),Yt=he({__name:"Badge",props:{color:{}},setup(j){const x=j;return(D,U)=>(l(),w("div",{class:Te(["border-1 h-6 rounded-md px-1",{"border-purple-500 bg-purple-100":x.color==="purple","border-blue-500 bg-blue-100":x.color==="blue","border-green-500 bg-green-100":x.color==="green","border-orange-500 bg-orange-100":x.color==="orange","border-yellow-500 bg-yellow-100":x.color==="yellow","border-gray-300":!x.color}])},[ca(D.$slots,"default")],2))}});const[ho,go]=Ma(()=>{const{api:j}=pt(),{project:x}=me(Ce()),{$e:D}=ke(),{formStatus:U,invitationUsersData:G}=me(Ea()),B=$(1),L=$(10),T=$(""),P=$(null),b=$(null),k=$(0),c=$(!1),u=le(()=>!P.value||!b.value?[]:P.value.filter(f=>{var C;const I=(C=b.value)==null?void 0:C.find(r=>r.id===f.id);return I?f.roles!==I.roles:!1})),d=async(f=B.value,I=L.value)=>{var C,r;try{if(!((C=x.value)!=null&&C.id))return;const v=await j.auth.projectUserList((r=x.value)==null?void 0:r.id,{query:{limit:I,offset:(f-1)*I,query:T.value}});if(!v.users)return;const E=v.users.list.filter(R=>!R.roles);k.value=(v.users.pageInfo.totalRows??0)-Number(E==null?void 0:E.length),P.value?P.value=[...P.value,...v.users.list.filter(R=>R.roles)]:P.value=v.users.list.filter(R=>R.roles),b.value=JSON.parse(JSON.stringify(P.value))}catch(v){W.error(await ve(v))}};return{loadUsers:d,inviteUser:async f=>{var C;let I;U.value="project-collaborateSaving";try{if(!((C=x.value)!=null&&C.id))return;I=await j.auth.projectUserAdd(x.value.id,{...f,project_id:x.value.id,projectName:x.value.title}),G.value.invitationToken=I.invite_token,B.value=1,P.value=[],await d()}catch(r){W.error(await ve(r)),U.value="collaborate";return}return U.value="project-collaborateSaved",D("a:user:add"),I},users:P,totalUsers:k,searchText:T,currentPage:B,currentLimit:L,editedUsers:u,updateEditedUsers:async f=>{var I,C;f=f||u.value,c.value=!0;try{await Promise.all(f.filter(r=>r.roles!=="No access").map(async r=>{var E;await j.auth.projectUserUpdate(x.value.id,r.id,{email:r.email,roles:r.roles,project_id:x.value.id,projectName:x.value.title});const v=(E=P.value)==null?void 0:E.find(R=>R.id===r.id);v&&(v.roles=r.roles)})),await Promise.all(f.filter(r=>r.roles==="No access").map(async r=>{await j.auth.projectUserRemove(x.value.id,r.id)})),P.value=((I=P.value)==null?void 0:I.filter(r=>r.roles!=="No access"))??[],k.value=((C=P.value)==null?void 0:C.length)??0,b.value=JSON.parse(JSON.stringify(P.value))}catch(r){W.error(await ve(r))}finally{c.value=!1}},isBatchUpdating:c}},"useManageUsers");function wo(){const j=go();return j||ho()}const Zt=j=>(Oe("data-v-6d22d90e"),j=j(),ze(),j),$o={class:"my-2 pt-3 ml-2","data-testid":"invite"},xo={key:0,class:"flex flex-col mt-4 border-b-1 pb-5"},So=Zt(()=>a("div",{class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},[a("div",{class:"text-xs ml-0.5 mt-0.5"},"Copy Invite Token")],-1)),ko={class:"flex flex-row justify-between items-center py-1"},Co={class:"flex pl-2 text-green-700 text-xs","data-testid":"invite-modal-invitation-url"},jo={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2"},Io={class:"flex flex-row justify-start mt-4 ml-2"},Uo={class:"flex flex-row justify-center items-center space-x-0.5"},Po={class:"text-xs text-gray-600"},No=Zt(()=>a("div",{class:"text-xl mb-4"},"Invite",-1)),To={class:"flex gap-2"},Mo={class:"badge-text"},Eo={class:"badge-text"},Lo={class:"badge-text"},Ao={class:"badge-text"},Do={class:"badge-text"},Ro={class:"flex flex-row items-center gap-x-2 pr-1"},Bo=he({__name:"InviteProjectCollabSection",emits:["invited"],setup(j,{emit:x}){const D=ia({email:"",roles:ut.VIEWER});Ce();const{dashboardUrl:U}=Ta(),{inviteUser:G}=wo(),{$e:B}=ke(),L=$(),T=$(!1),P=async()=>{if(!T.value){T.value=!0;try{L.value=await G(D),L.roles=D.roles,L.value&&(W.success("Invitation sent successfully"),D.email="",x("invited"))}catch(d){W.error(await ve(d))}T.value=!1}},b=le(()=>{var d;return(d=L.value)!=null&&d.invite_token?`${U.value}#/signup/${L.value.invite_token}`:null}),{copy:k}=Na(!0),{t:c}=Fe(),u=async()=>{if(b.value){try{await k(b.value),W.success(c("msg.success.shareableURLCopied"))}catch(d){W.error(d.message)}B("c:shared-base:copy-url")}};return(d,o)=>{const S=He,f=Ee,I=Lt,C=Aa,r=Ye,v=Et,E=Yt,R=st,q=Tt,ce=Mt,ne=Ca,pe=Je;return l(),w("div",$o,[e(L)&&e(L).invite_token?(l(),w("div",xo,[So,t(I,{class:"mt-1",type:"success","show-icon":""},{message:n(()=>[a("div",ko,[a("div",Co,p(e(b)),1),t(f,{type:"text",class:"!rounded-md -mt-0.5",onClick:u},{icon:n(()=>[t(S,{icon:"copy",class:"nc-view-icon"})]),_:1})])]),_:1}),a("div",jo,p(d.$t("msg.info.userInviteNoSMTP"))+" "+p(e(L).invite_token&&e(L).emails),1),a("div",Io,[t(f,{size:"small",outlined:"",onClick:o[0]||(o[0]=ee=>L.value=null)},{default:n(()=>[a("div",Uo,[t(C,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),a("div",Po,p(d.$t("activity.inviteMore")),1)])]),_:1})])])):(l(),w(Z,{key:1},[No,t(pe,null,{default:n(()=>{var ee;return[a("div",To,[t(r,{id:"email",value:e(D).email,"onUpdate:value":o[1]||(o[1]=O=>e(D).email=O),placeholder:"Enter emails to send invitation",class:"!max-w-130 !rounded"},null,8,["value"]),t(q,{value:e(D).roles,"onUpdate:value":o[2]||(o[2]=O=>e(D).roles=O),class:"min-w-30 !rounded px-1","data-testid":"roles"},{suffixIcon:n(()=>[t(v)]),default:n(()=>[(l(!0),w(Z,null,be("projectRoles"in d?d.projectRoles:e(ra),(O,te)=>(l(),N(R,{key:te,value:O,class:"nc-role-option"},{default:n(()=>[O===("ProjectRole"in d?d.ProjectRole:e(Ke)).Owner?(l(),N(E,{key:0,color:"purple"},{default:n(()=>[a("p",Mo,p(O),1)]),_:2},1024)):Q("",!0),O===("ProjectRole"in d?d.ProjectRole:e(Ke)).Creator?(l(),N(E,{key:1,color:"blue"},{default:n(()=>[a("p",Eo,p(O),1)]),_:2},1024)):Q("",!0),O===("ProjectRole"in d?d.ProjectRole:e(Ke)).Editor?(l(),N(E,{key:2,color:"green"},{default:n(()=>[a("p",Lo,p(O),1)]),_:2},1024)):Q("",!0),O===("ProjectRole"in d?d.ProjectRole:e(Ke)).Commenter?(l(),N(E,{key:3,color:"orange"},{default:n(()=>[a("p",Ao,p(O),1)]),_:2},1024)):Q("",!0),O===("ProjectRole"in d?d.ProjectRole:e(Ke)).Viewer?(l(),N(E,{key:4,color:"yellow"},{default:n(()=>[a("p",Do,p(O),1)]),_:2},1024)):Q("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),t(f,{type:"primary",class:"!rounded-md",disabled:!((ee=e(D).email)!=null&&ee.length)||e(T),onClick:P},{default:n(()=>[a("div",Ro,[e(T)?(l(),N(ce,{key:0,class:"flex"})):(l(),N(ne,{key:1})),A(" "+p(e(T)?"Adding":"Add")+" User/s ",1)])]),_:1},8,["disabled"])])]}),_:1})],64))])}}});const Vo=Pe(Bo,[["__scopeId","data-v-6d22d90e"]]),Oo={class:"nc-icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em"},zo=a("path",{fill:"currentColor",d:"M232.49 215.51L185 168a92.12 92.12 0 1 0-17 17l47.53 47.54a12 12 0 0 0 17-17ZM44 112a68 68 0 1 1 68 68a68.07 68.07 0 0 1-68-68Z"},null,-1),Fo=[zo];function Go(j,x){return l(),w("svg",Oo,Fo)}const Qo={name:"ph-magnifying-glass-bold",render:Go},lt=j=>(Oe("data-v-8e078e59"),j=j(),ze(),j),qo={class:"nc-collaborator-table-container mt-4 nc-access-settings-view"},Ko={key:0,class:"nc-collaborators-list items-center justify-center"},Jo={class:"w-full flex flex-row justify-between items-baseline mt-6.5 mb-2 pr-0.25 ml-2"},Wo={key:0,class:"nc-collaborators-list items-center justify-center"},Ho={key:1,class:"nc-collaborators-list w-full h-full flex flex-col items-center justify-center mt-36"},Yo={key:2,class:"nc-collaborators-list nc-scrollbar-md"},Zo=_a('<div class="nc-collaborators-list-header" data-v-8e078e59><div class="flex w-1/5" data-v-8e078e59>Users</div><div class="flex w-1/5" data-v-8e078e59>Date Joined</div><div class="flex w-1/5" data-v-8e078e59>Access</div><div class="flex w-1/5" data-v-8e078e59></div><div class="flex w-1/5" data-v-8e078e59></div></div>',1),Xo={class:"flex flex-col nc-scrollbar-md"},en={class:"!py-0 w-1/5 email"},tn={class:"flex items-center gap-2"},an={class:"text-gray-500 text-xs w-1/5 created-at"},on={class:"w-1/5 roles"},nn={class:"nc-collaborator-role-select"},sn={class:"badge-text"},ln={class:"badge-text"},cn={class:"badge-text"},rn=lt(()=>a("p",{class:"badge-text"},"Inherit",-1)),dn=lt(()=>a("div",{class:"w-1/5"},null,-1)),un=lt(()=>a("div",{class:"w-1/5"},null,-1)),_n={class:"flex flex-row w-full justify-center mt-2"},pn=lt(()=>a("span",null,null,-1)),vn=he({__name:"AccessSettings",setup(j){const{user:x}=nt(),D=Ge(),{getProjectUsers:U,createProjectUser:G,updateProjectUser:B,removeProjectUser:L}=D,{activeProjectId:T}=me(D),P=$([]),b=$(0),k=$(""),c=$(0),u=$(!1),d=$(!1),o=async()=>{try{c.value+=1;const{users:v,totalRows:E}=await U({projectId:T.value,page:c.value,...k.value?{searchText:k.value}:{},limit:20});b.value=E,P.value=[...P.value,...v.map(R=>{var q;return{...R,projectRoles:R.roles,roles:R.roles??((q=et[R.workspace_roles])==null?void 0:q.toLowerCase())??ut.NO_ACCESS}})]}catch(v){W.error(await ve(v))}},S=async v=>{var R,q,ce;const E=((R=P.value)==null?void 0:R.length)||0;if(((q=P.value)==null?void 0:q.length)===b.value){v.complete();return}if(v.loading(),await o(),E===((ce=P.value)==null?void 0:ce.length)){v.complete();return}v.loaded()};Le(async()=>{u.value=!0;try{await o()}catch(v){W.error(await ve(v))}finally{u.value=!1}});const f=async(v,E)=>{try{!E||E==="inherit"||E===ut.NO_ACCESS&&!St?(await L(T.value,v),v.projectRoles=null):v.projectRoles?await B(T.value,v):(await G(T.value,v),v.projectRoles=E)}catch(R){W.error(await ve(R))}};da(k,async()=>{d.value=!0,c.value=0,b.value=0,P.value=[];try{await o()}catch(v){W.error(await ve(v))}finally{d.value=!1}},{debounce:300,maxWait:600}),$(!0);const I=async()=>{c.value=0,P.value=[],await o()},C=le(()=>{var E;const v=(E=P.value)==null?void 0:E.find(R=>{var q;return R.id===((q=x.value)==null?void 0:q.id)});return v==null?void 0:v.projectRoles}),r=le(()=>{const v=$t.findIndex(E=>E===C.value);return v===-1?[]:$t.slice(v+1)});return(v,E)=>{var J;const R=Vo,q=Mt,ce=Qo,ne=Ye,pe=Me,ee=Et,O=Yt,te=st,ye=Tt;return l(),w("div",qo,[t(R,{onInvited:I}),e(u)?(l(),w("div",Ko,[t(q,{size:"xlarge"})])):(l(),w(Z,{key:1},[a("div",Jo,[t(ne,{value:e(k),"onUpdate:value":E[0]||(E[0]=F=>Y(k)?k.value=F:null),class:"!max-w-90 !rounded-md",placeholder:"Search collaborators"},{prefix:n(()=>[t(ce,{class:"!h-3.5 text-gray-500"})]),_:1},8,["value"])]),e(d)?(l(),w("div",Wo,[t(q,{size:"xlarge"})])):(J=e(P))!=null&&J.length?(l(),w("div",Yo,[Zo,a("div",Xo,[(l(!0),w(Z,null,be(e(P),(F,ae)=>{var M,m;return l(),w("div",{key:ae,class:"relative w-full nc-collaborators nc-collaborators-list-row"},[a("div",en,[a("div",tn,[a("span",{class:"color-band",style:ot({backgroundColor:e(ua)(F.email)})},p((M=F==null?void 0:F.email)==null?void 0:M.slice(0,2)),5),A(p(F.email)+" ",1)])]),a("div",an,p(e(Ct)(F.created_at)),1),a("div",on,[a("div",nn,[t(ye,{value:F.roles,"onUpdate:value":ie=>F.roles=ie,class:"w-35 !rounded px-1",virtual:!0,placeholder:v.$t("labels.noAccess"),disabled:F.id===((m=e(x))==null?void 0:m.id)||F.roles&&!e(r).includes(F.roles),onChange:ie=>f(F,ie)},{suffixIcon:n(()=>[t(ee)]),default:n(()=>{var ie;return[F.id===((ie=e(x))==null?void 0:ie.id)?(l(),N(te,{key:0,value:e(C)},{default:n(()=>[t(O,{color:e(rt)[e(C)]},{default:n(()=>[a("p",sn,p(e(et)[e(C)]),1)]),_:1},8,["color"])]),_:1},8,["value"])):Q("",!0),F.roles&&!e(r).includes(F.roles)?(l(),N(te,{key:1,value:F.roles},{default:n(()=>[t(O,{color:e(rt)[F.roles]},{default:n(()=>[a("p",ln,p(e(et)[F.roles]),1)]),_:2},1032,["color"])]),_:2},1032,["value"])):Q("",!0),(l(!0),w(Z,null,be(e(r),se=>(l(),N(te,{key:`role-option-${se}`,value:se},{default:n(()=>[t(O,{color:e(rt)[se]},{default:n(()=>[a("p",cn,p(e(et)[se]),1)]),_:2},1032,["color"])]),_:2},1032,["value"]))),128)),e(St)?(l(),N(te,{key:2,value:"inherit"},{default:n(()=>[t(O,{color:"white"},{default:n(()=>[rn]),_:1})]),_:1})):Q("",!0)]}),_:2},1032,["value","onUpdate:value","placeholder","disabled","onChange"])])]),dn,un])}),128)),t(e(La),de(v.$attrs,{onInfinite:S}),{spinner:n(()=>[a("div",_n,[t(q)])]),complete:n(()=>[pn]),_:1},16)])])):(l(),w("div",Ho,[t(pe,{description:"No collaborators found"})]))],64))])}}});const mn=Pe(vn,[["__scopeId","data-v-8e078e59"]]),fn={};function bn(j,x){return l(),w("span")}const yn=Pe(fn,[["render",bn]]),Xt=j=>(Oe("data-v-404794dc"),j=j(),ze(),j),hn={class:"flex flex-col h-full p-8"},gn={class:"text-lg font-semibold self-start mb-4"},wn={class:"flex gap-x-2 mt-5 ml-7 pt-2.5 justify-end"},$n={class:"create-base bg-white relative flex flex-col justify-center gap-2 w-full"},xn={class:"prose-2xl font-bold self-start mb-4 flex items-center gap-2"},Sn=Xt(()=>a("span",{class:"flex-grow"},null,-1)),kn={class:"nc-scrollbar-md",style:{maxHeight:"60vh"}},Cn={class:"flex items-right justify-end gap-2"},jn={class:"flex gap-2"},In={class:"flex py-1 items-center gap-1"},Un=Xt(()=>a("span",null,":",-1)),Pn={class:"flex items-center justify-center"},Nn={class:"flex justify-end"},Tn={class:"flex justify-end gap-2"},Mn={class:"flex flex-col h-full p-8"},En={class:"text-lg font-semibold self-start mb-4"},Ln={class:"flex gap-x-2 mt-5 ml-7 pt-2.5 justify-end"},An=he({__name:"CreateBase",props:{connectionType:{}},emits:["baseCreated","close"],setup(j,{emit:x}){const D=Ce(),{loadProject:U}=Ge(),{project:G}=me(D),{loadProjectTables:B}=at(),L=vt(bt,void 0),T=le(()=>{var i;return(L==null?void 0:L.value)??((i=G.value)==null?void 0:i.id)}),P=Je.useForm,b=$(!1),k=$(),{api:c}=pt(),{$e:u}=ke(),{t:d}=Fe(),o=$({title:"",dataSource:{...Be(z.MYSQL)},inflection:{inflectionColumn:"camelize",inflectionTable:"camelize"},sslUse:X.No,extraParameters:[]}),S=$({title:"",dataSource:{...Be(z.MYSQL)},inflection:{inflectionColumn:"camelize",inflectionTable:"camelize"},sslUse:X.No,extraParameters:[]}),f=le(()=>jt.filter(i=>i.value!==z.SNOWFLAKE)),I=le(()=>{let i={"dataSource.connection.host":[H()],"dataSource.connection.port":[H()],"dataSource.connection.user":[H()],"dataSource.connection.password":[H()],"dataSource.connection.database":[H()]};switch(o.value.dataSource.client){case z.SQLITE:i={"dataSource.connection.connection.filename":[H()]};break;case z.SNOWFLAKE:i={"dataSource.connection.account":[H()],"dataSource.connection.username":[H()],"dataSource.connection.password":[H()],"dataSource.connection.warehouse":[H()],"dataSource.connection.database":[H()],"dataSource.connection.schema":[H()]};break;case z.PG:case z.MSSQL:i["dataSource.searchPath.0"]=[H()];break}return{title:[{required:!0,message:"Base name is required"},Rt],extraParameters:[Bt],"dataSource.client":[H()],...i}}),{validate:C,validateInfos:r}=P(o.value,I),v=i=>{o.value.dataSource.connection.database=`${i.trim()}_noco`},E=()=>{o.value.dataSource={...Be(o.value.dataSource.client)},v(o.value.title)},R=i=>{if(o.value.dataSource.client!==z.SQLITE){const s=o.value.dataSource.connection;switch(i){case X.No:delete s.ssl;break;case X.Allowed:s.ssl="true";break;default:s.ssl={ca:"",cert:"",key:""};break}}},q=()=>{if(o.value.dataSource.client!==z.SQLITE){const i=o.value.dataSource.connection;i.ssl?typeof i.ssl=="string"?o.value.sslUse=X.Allowed:o.value.sslUse=X.Preferred:o.value.sslUse=X.No}},ce=()=>{o.value.extraParameters.push({key:"",value:""})},ne=i=>{o.value.extraParameters.splice(i,1)},pe=["camelize","none"],ee=$(""),O=$(!1),te=$(!1),ye=$(),J=$(),F=$(),ae=(i,s)=>{s&&Vt(s,K=>{"ssl"in o.value.dataSource.connection&&typeof o.value.dataSource.connection.ssl=="object"&&(o.value.dataSource.connection.ssl[i]=K??"")})},M=le(()=>!!o.value.sslUse&&o.value.sslUse!==X.No&&o.value.sslUse!==X.Allowed);function m(){const i=Object.fromEntries(new Map(o.value.extraParameters.map(K=>[K.key,K.value]))),s={...o.value.dataSource.connection,...i};return"ssl"in s&&s.ssl&&(o.value.sslUse===X.No||typeof s.ssl=="object"&&Object.values(s.ssl).every(K=>K==null))&&delete s.ssl,s}const ie=()=>{var i,s,K,fe,Ae;(Ae=(fe=(K=(s=(i=k.value)==null?void 0:i.$el.querySelector(".ant-form-item-explain-error"))==null?void 0:s.parentNode)==null?void 0:K.parentNode)==null?void 0:fe.querySelector("input"))==null||Ae.focus()},se=$(!1),je=async()=>{try{await C(),se.value=!1}catch{ie(),se.value=!1;return}try{if(!T.value)return;const i=m(),s={...o.value.dataSource,connection:i};await c.base.create(T.value,{alias:o.value.title,type:o.value.dataSource.client,config:s,inflection_column:o.value.inflection.inflectionColumn,inflection_table:o.value.inflection.inflectionTable}),u("a:base:create:extdb"),await U(T.value,!0),await B(T.value,!0),x("baseCreated"),x("close")}catch(i){W.error(await ve(i))}},ue=async()=>{try{await C()}catch{ie();return}u("a:base:create:extdb:test-connection",[]);try{if(o.value.dataSource.client===z.SQLITE)b.value=!0;else{const i=m();i.database=Ut(o.value.dataSource);const s={...o.value.dataSource,connection:i},K=await c.utils.testConnection(s);K.code===0?(b.value=!0,se.value=!0):(b.value=!1,W.error(`${d("msg.error.dbConnectionFailed")} ${K.message}`))}}catch(i){b.value=!1,W.error(await ve(i))}},y=async()=>{if(!ee.value||ee.value==="")return;const i=await c.utils.urlToConfig({url:ee.value});i?(o.value.dataSource.client=i.client,o.value.dataSource.connection={...i.connection}):W.error(d("msg.error.invalidURL")),te.value=!1,q()},_=()=>{S.value={...o.value},O.value=!0},V=()=>{o.value={...S.value},O.value=!1,q()};return we(()=>o.value.dataSource,()=>b.value=!1,{deep:!0}),we(()=>o.value.title,i=>v(i)),Le(async()=>{o.value.title=await ja(),pa(()=>{setTimeout(()=>{var s,K;const i=(K=(s=k.value)==null?void 0:s.$el)==null?void 0:K.querySelector("input[type=text]");i==null||i.setSelectionRange(0,o.value.title.length),i==null||i.focus()},500)})}),we(()=>j.connectionType,i=>{o.value.dataSource.client=i,E()},{immediate:!0}),(i,s)=>{const K=ft,fe=mt,Ae=yn,_e=Ye,re=Gt,Ne=st,De=At,ct=Qt,it=qt,Ie=Ee,Qe=We,qe=Kt,g=Ot,ge=zt,Re=Ft,ta=Je,aa=Dt,wt=_t;return l(),w(Z,null,[t(fe,{visible:e(se),"onUpdate:visible":s[1]||(s[1]=h=>Y(se)?se.value=h:null),class:"!w-[25rem]"},{default:n(()=>[a("div",hn,[a("div",gn,p(e(d)("msg.info.dbConnected")),1),a("div",wn,[t(K,{key:"back",type:"secondary",onClick:s[0]||(s[0]=h=>se.value=!1)},{default:n(()=>[A(p(i.$t("general.cancel")),1)]),_:1}),t(K,{key:"submit",type:"primary",onClick:je},{default:n(()=>[A("Ok & Add Base")]),_:1})])])]),_:1},8,["visible"]),a("div",$n,[a("h1",xn,[A(" New Base "),t(Ae),Sn]),t(ta,{ref_key:"form",ref:k,model:e(o),name:"external-project-create-form",layout:"horizontal","no-style":"","label-col":{span:8}},{default:n(()=>[a("div",kn,[t(re,de({label:"Base Name"},e(r).title),{default:n(()=>[t(_e,{value:e(o).title,"onUpdate:value":s[2]||(s[2]=h=>e(o).title=h),class:"nc-extdb-proj-name"},null,8,["value"])]),_:1},16),t(re,de({label:i.$t("labels.dbType")},e(r)["dataSource.client"]),{default:n(()=>[t(De,{value:e(o).dataSource.client,"onUpdate:value":s[3]||(s[3]=h=>e(o).dataSource.client=h),class:"nc-extdb-db-type","dropdown-class-name":"nc-dropdown-ext-db-type",onChange:E},{default:n(()=>[(l(!0),w(Z,null,be(e(f),h=>(l(),N(Ne,{key:h.value,value:h.value},{default:n(()=>[A(p(h.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16,["label"]),e(o).dataSource.client===e(z).SQLITE?(l(),N(re,de({key:0,label:i.$t("labels.sqliteFile")},e(r)["dataSource.connection.connection.filename"]),{default:n(()=>[t(_e,{value:e(o).dataSource.connection.connection.filename,"onUpdate:value":s[4]||(s[4]=h=>e(o).dataSource.connection.connection.filename=h)},null,8,["value"])]),_:1},16,["label"])):(e(o).dataSource.client,e(z).SNOWFLAKE,l(),w(Z,{key:2},[t(re,de({label:i.$t("labels.hostAddress")},e(r)["dataSource.connection.host"]),{default:n(()=>[t(_e,{value:e(o).dataSource.connection.host,"onUpdate:value":s[11]||(s[11]=h=>e(o).dataSource.connection.host=h),class:"nc-extdb-host-address"},null,8,["value"])]),_:1},16,["label"]),t(re,de({label:i.$t("labels.port")},e(r)["dataSource.connection.port"]),{default:n(()=>[t(it,{value:e(o).dataSource.connection.port,"onUpdate:value":s[12]||(s[12]=h=>e(o).dataSource.connection.port=h),class:"!w-full nc-extdb-host-port"},null,8,["value"])]),_:1},16,["label"]),t(re,de({label:i.$t("labels.username")},e(r)["dataSource.connection.user"]),{default:n(()=>[t(_e,{value:e(o).dataSource.connection.user,"onUpdate:value":s[13]||(s[13]=h=>e(o).dataSource.connection.user=h),class:"nc-extdb-host-user"},null,8,["value"])]),_:1},16,["label"]),t(re,{label:i.$t("labels.password")},{default:n(()=>[t(ct,{value:e(o).dataSource.connection.password,"onUpdate:value":s[14]||(s[14]=h=>e(o).dataSource.connection.password=h),class:"nc-extdb-host-password"},null,8,["value"])]),_:1},8,["label"]),t(re,de({label:i.$t("labels.database")},e(r)["dataSource.connection.database"]),{default:n(()=>[t(_e,{value:e(o).dataSource.connection.database,"onUpdate:value":s[15]||(s[15]=h=>e(o).dataSource.connection.database=h),placeholder:i.$t("labels.dbCreateIfNotExists"),class:"nc-extdb-host-database"},null,8,["value","placeholder"])]),_:1},16,["label"]),[e(z).MSSQL,e(z).PG].includes(e(o).dataSource.client)&&e(o).dataSource.searchPath?(l(),N(re,de({key:0,label:i.$t("labels.schemaName")},e(r)["dataSource.searchPath.0"]),{default:n(()=>[t(_e,{value:e(o).dataSource.searchPath[0],"onUpdate:value":s[16]||(s[16]=h=>e(o).dataSource.searchPath[0]=h)},null,8,["value"])]),_:1},16,["label"])):Q("",!0),a("div",Cn,[t(Ie,{class:"nc-extdb-btn-import-url !rounded-md",onClick:s[17]||(s[17]=It(h=>te.value=!0,["stop"]))},{default:n(()=>[A(p(i.$t("activity.useConnectionUrl")),1)]),_:1})]),t(Re,{ghost:"","expand-icon-position":"right",class:"!mt-6"},{default:n(()=>[t(ge,{key:"1"},{header:n(()=>[a("span",null,p(i.$t("title.advancedParameters")),1)]),default:n(()=>[t(re,{label:"SSL mode"},{default:n(()=>[t(De,{value:e(o).sslUse,"onUpdate:value":s[18]||(s[18]=h=>e(o).sslUse=h),"dropdown-class-name":"nc-dropdown-ssl-mode",onSelect:R},{default:n(()=>[(l(!0),w(Z,null,be(Object.values(e(X)),h=>(l(),N(Ne,{key:h,value:h},{default:n(()=>[A(p(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(re,{label:"SSL keys"},{default:n(()=>[a("div",jn,[t(Qe,{placement:"top"},{title:n(()=>[a("span",null,p(i.$t("tooltip.clientCert")),1)]),default:n(()=>[t(Ie,{disabled:!e(M),class:"shadow",onClick:s[19]||(s[19]=h=>{var Se;return(Se=e(F))==null?void 0:Se.click()})},{default:n(()=>[A(p(i.$t("labels.clientCert")),1)]),_:1},8,["disabled"])]),_:1}),t(Qe,{placement:"top"},{title:n(()=>[a("span",null,p(i.$t("tooltip.clientKey")),1)]),default:n(()=>[t(Ie,{disabled:!e(M),class:"shadow",onClick:s[20]||(s[20]=h=>{var Se;return(Se=e(J))==null?void 0:Se.click()})},{default:n(()=>[A(p(i.$t("labels.clientKey")),1)]),_:1},8,["disabled"])]),_:1}),t(Qe,{placement:"top"},{title:n(()=>[a("span",null,p(i.$t("tooltip.clientCA")),1)]),default:n(()=>[t(Ie,{disabled:!e(M),class:"shadow",onClick:s[21]||(s[21]=h=>{var Se;return(Se=e(ye))==null?void 0:Se.click()})},{default:n(()=>[A(p(i.$t("labels.serverCA")),1)]),_:1},8,["disabled"])]),_:1})])]),_:1}),a("input",{ref_key:"caFileInput",ref:ye,type:"file",class:"!hidden",onChange:s[22]||(s[22]=h=>ae(e(Ve).ca,e(ye)))},null,544),a("input",{ref_key:"certFileInput",ref:F,type:"file",class:"!hidden",onChange:s[23]||(s[23]=h=>ae(e(Ve).cert,e(F)))},null,544),a("input",{ref_key:"keyFileInput",ref:J,type:"file",class:"!hidden",onChange:s[24]||(s[24]=h=>ae(e(Ve).key,e(J)))},null,544),t(qe),t(re,de({class:"mb-2",label:i.$t("labels.extraConnectionParameters")},e(r).extraParameters),{default:n(()=>[t(g,null,{default:n(()=>[(l(!0),w(Z,null,be(e(o).extraParameters,(h,Se)=>(l(),w("div",{key:Se},[a("div",In,[t(_e,{value:h.key,"onUpdate:value":Xe=>h.key=Xe},null,8,["value","onUpdate:value"]),Un,t(_e,{value:h.value,"onUpdate:value":Xe=>h.value=Xe},null,8,["value","onUpdate:value"]),(l(),N($e(e(xe).close),{style:{"font-size":"1.5em",color:"red"},onClick:Xe=>ne(Se)},null,8,["onClick"]))])]))),128)),t(Ie,{type:"dashed",class:"w-full caption mt-2",onClick:ce},{default:n(()=>[a("div",Pn,[(l(),N($e(e(xe).plus)))])]),_:1})]),_:1})]),_:1},16,["label"]),t(qe),t(re,{label:i.$t("labels.inflection.tableName")},{default:n(()=>[t(De,{value:e(o).inflection.inflectionTable,"onUpdate:value":s[25]||(s[25]=h=>e(o).inflection.inflectionTable=h),"dropdown-class-name":"nc-dropdown-inflection-table-name"},{default:n(()=>[(l(),w(Z,null,be(pe,h=>t(Ne,{key:h,value:h},{default:n(()=>[A(p(h),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["label"]),t(re,{label:i.$t("labels.inflection.columnName")},{default:n(()=>[t(De,{value:e(o).inflection.inflectionColumn,"onUpdate:value":s[26]||(s[26]=h=>e(o).inflection.inflectionColumn=h),"dropdown-class-name":"nc-dropdown-inflection-column-name"},{default:n(()=>[(l(),w(Z,null,be(pe,h=>t(Ne,{key:h,value:h},{default:n(()=>[A(p(h),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["label"]),a("div",Nn,[t(Ie,{type:"primary",class:"!rounded-md",onClick:s[27]||(s[27]=h=>_())},{default:n(()=>[A(p(i.$t("activity.editConnJson")),1)]),_:1})])]),_:1})]),_:1})],64))]),t(re,{class:"flex justify-end !mt-5"},{default:n(()=>[a("div",Tn,[t(Ie,{type:"primary",class:"nc-extdb-btn-test-connection !rounded-md",onClick:ue},{default:n(()=>[A(p(i.$t("activity.testDbConn")),1)]),_:1}),t(Ie,{type:"primary",disabled:!e(b),class:"nc-extdb-btn-submit !rounded-md",onClick:je},{default:n(()=>[A(p(i.$t("general.submit")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"]),t(wt,{visible:e(O),"onUpdate:visible":s[29]||(s[29]=h=>Y(O)?O.value=h:null),title:i.$t("activity.editConnJson"),width:"600px","wrap-class-name":"nc-modal-edit-connection-json",onOk:V},{default:n(()=>[e(O)?(l(),N(aa,{key:0,modelValue:e(S),"onUpdate:modelValue":s[28]||(s[28]=h=>Y(S)?S.value=h:null),class:"h-[400px] w-full"},null,8,["modelValue"])):Q("",!0)]),_:1},8,["visible","title"]),t(wt,{visible:e(te),"onUpdate:visible":s[31]||(s[31]=h=>Y(te)?te.value=h:null),title:i.$t("activity.useConnectionUrl"),width:"500px","ok-text":i.$t("general.ok"),"cancel-text":i.$t("general.cancel"),"wrap-class-name":"nc-modal-connection-url",onOk:y},{default:n(()=>[t(_e,{value:e(ee),"onUpdate:value":s[30]||(s[30]=h=>Y(ee)?ee.value=h:null)},null,8,["value"])]),_:1},8,["visible","title","ok-text","cancel-text"]),t(fe,{visible:e(se),"onUpdate:visible":s[33]||(s[33]=h=>Y(se)?se.value=h:null),class:"!w-[25rem]"},{default:n(()=>[a("div",Mn,[a("div",En,p(e(d)("msg.info.dbConnected")),1),a("div",Ln,[t(K,{key:"back",type:"secondary",onClick:s[32]||(s[32]=h=>se.value=!1)},{default:n(()=>[A(p(i.$t("general.cancel")),1)]),_:1}),t(K,{key:"submit",type:"primary",onClick:je},{default:n(()=>[A("Ok & Add Base")]),_:1})])])]),_:1},8,["visible"])])],64)}}});const Dn=Pe(An,[["__scopeId","data-v-404794dc"]]),ht=j=>(Oe("data-v-5814076f"),j=j(),ze(),j),Rn={class:"edit-base bg-white relative flex flex-col justify-start gap-2 w-full p-2"},Bn=ht(()=>a("h1",{class:"prose-2xl font-bold self-start"},"Edit Base",-1)),Vn={class:"nc-scrollbar-md",style:{maxHeight:"60vh"}},On={class:"flex justify-end gap-2"},zn={class:"flex items-center gap-2"},Fn={class:"flex gap-2"},Gn={class:"flex py-1 items-center gap-1"},Qn=ht(()=>a("span",null,":",-1)),qn={class:"flex items-center justify-center"},Kn={class:"flex justify-end"},Jn={class:"flex justify-end gap-2"},Wn={class:"w-full flex items-center mt-2 text-[#e65100]"},Hn=ht(()=>a("div",null,"Please make sure database you are trying to connect is valid! This operation can cause schema loss!!",-1)),Yn=he({__name:"EditBase",props:{baseId:{}},emits:["baseUpdated","close"],setup(j,{emit:x}){const D=j,U=Ce(),G=Ge(),{project:B}=me(U),L=vt(bt,void 0),T=le(()=>{var y;return(L==null?void 0:L.value)??((y=B.value)==null?void 0:y.id)}),P=Je.useForm,b=$(!1),k=$(),{api:c}=pt(),{$e:u}=ke(),{t:d}=Fe(),o=$({title:"",dataSource:{...Be(z.MYSQL)},inflection:{inflectionColumn:"camelize",inflectionTable:"camelize"},sslUse:X.No,extraParameters:[]}),S=$({title:"",dataSource:{...Be(z.MYSQL)},inflection:{inflectionColumn:"camelize",inflectionTable:"camelize"},sslUse:X.No,extraParameters:[]}),f=le(()=>({title:[Rt],extraParameters:[Bt],"dataSource.client":[H()],...o.value.dataSource.client===z.SQLITE?{"dataSource.connection.connection.filename":[H()]}:o.value.dataSource.client===z.SNOWFLAKE?{"dataSource.connection.account":[H()],"dataSource.connection.username":[H()],"dataSource.connection.password":[H()],"dataSource.connection.warehouse":[H()],"dataSource.connection.database":[H()],"dataSource.connection.schema":[H()]}:{"dataSource.connection.host":[H()],"dataSource.connection.port":[H()],"dataSource.connection.user":[H()],"dataSource.connection.password":[H()],"dataSource.connection.database":[H()],...[z.PG,z.MSSQL].includes(o.value.dataSource.client)?{"dataSource.searchPath.0":[H()]}:{}}})),{validate:I,validateInfos:C}=P(o,f),r=()=>{o.value.dataSource={...Be(o.value.dataSource.client)}},v=y=>{if(o.value.dataSource.client!==z.SQLITE){const _=o.value.dataSource.connection;switch(y){case X.No:delete _.ssl;break;case X.Allowed:_.ssl="true";break;default:_.ssl={ca:"",cert:"",key:""};break}}},E=()=>{if(o.value.dataSource.client!==z.SQLITE){const y=o.value.dataSource.connection;y.ssl?typeof y.ssl=="string"?o.value.sslUse=X.Allowed:o.value.sslUse=X.Preferred:o.value.sslUse=X.No}},R=()=>{o.value.extraParameters.push({key:"",value:""})},q=y=>{o.value.extraParameters.splice(y,1)},ce=["camelize","none"],ne=$(""),pe=$(!1),ee=$(!1),O=$(),te=$(),ye=$(),J=(y,_)=>{_&&Vt(_,V=>{"ssl"in o.value.dataSource.connection&&typeof o.value.dataSource.connection.ssl=="object"&&(o.value.dataSource.connection.ssl[y]=V??"")})},F=le(()=>!!o.value.sslUse&&o.value.sslUse!==X.No&&o.value.sslUse!==X.Allowed);function ae(){const y=Object.fromEntries(new Map(o.value.extraParameters.map(V=>[V.key,V.value]))),_={...o.value.dataSource.connection,...y};return"ssl"in _&&_.ssl&&(o.value.sslUse===X.No||typeof _.ssl=="object"&&Object.values(_.ssl).every(V=>V==null))&&delete _.ssl,_}const M=()=>{var y,_,V,i,s;(s=(i=(V=(_=(y=k.value)==null?void 0:y.$el.querySelector(".ant-form-item-explain-error"))==null?void 0:_.parentNode)==null?void 0:V.parentNode)==null?void 0:i.querySelector("input"))==null||s.focus()},m=async()=>{var y,_;try{await I()}catch{M();return}try{if(!((y=B.value)!=null&&y.id))return;const V=ae(),i={...o.value.dataSource,connection:V};await c.base.update((_=B.value)==null?void 0:_.id,D.baseId,{alias:o.value.title,type:o.value.dataSource.client,config:i,inflection_column:o.value.inflection.inflectionColumn,inflection_table:o.value.inflection.inflectionTable}),u("a:base:edit:extdb"),await G.loadProject(T.value,!0),x("baseUpdated"),x("close")}catch(V){W.error(await ve(V))}},ie=async()=>{try{await I()}catch{M();return}u("a:base:edit:extdb:test-connection",[]);try{if(o.value.dataSource.client===z.SQLITE)b.value=!0;else{const y=ae();y.database=Ut(o.value.dataSource);const _={...o.value.dataSource,connection:y},V=await c.utils.testConnection(_);V.code===0?(b.value=!0,_t.confirm({title:d("msg.info.dbConnected"),icon:null,type:"success",okText:"Ok & Edit Base",okType:"primary",cancelText:d("general.cancel"),onOk:m,style:"top: 30%!important"})):(b.value=!1,W.error(`${d("msg.error.dbConnectionFailed")} ${V.message}`))}}catch(y){b.value=!1,W.error(await ve(y))}},se=async()=>{if(!ne.value||ne.value==="")return;const y=await c.utils.urlToConfig({url:ne.value});y?(o.value.dataSource.client=y.client,o.value.dataSource.connection={...y.connection}):W.error(d("msg.error.invalidURL")),ee.value=!1,E()},je=()=>{S.value=o.value,pe.value=!0},ue=()=>{o.value=S.value,pe.value=!1,E()};return we(()=>o.value.dataSource,()=>b.value=!1,{deep:!0}),Le(async()=>{var y,_;if((y=B.value)!=null&&y.id){const V=["host","port","user","password","database"],i=await c.base.read((_=B.value)==null?void 0:_.id,D.baseId),s=Object.entries(i.config.connection).filter(([K])=>!V.includes(K)).map(([K,fe])=>({key:K,value:fe}));o.value={title:i.alias||"",dataSource:i.config,inflection:{inflectionColumn:i.inflection_column,inflectionTable:i.inflection_table},extraParameters:s,sslUse:X.No},E()}}),(y,_)=>{const V=Ye,i=Gt,s=st,K=At,fe=Qt,Ae=qt,_e=Ee,re=We,Ne=Kt,De=Ot,ct=zt,it=Ft,Ie=Je,Qe=Dt,qe=_t;return l(),w("div",Rn,[Bn,t(Ie,{ref_key:"form",ref:k,model:e(o),name:"external-project-create-form",layout:"horizontal","no-style":"","label-col":{span:8}},{default:n(()=>[a("div",Vn,[t(i,de({label:"Base Name"},e(C).title),{default:n(()=>[t(V,{value:e(o).title,"onUpdate:value":_[0]||(_[0]=g=>e(o).title=g),class:"nc-extdb-proj-name"},null,8,["value"])]),_:1},16),t(i,de({label:y.$t("labels.dbType")},e(C)["dataSource.client"]),{default:n(()=>[t(K,{value:e(o).dataSource.client,"onUpdate:value":_[1]||(_[1]=g=>e(o).dataSource.client=g),class:"nc-extdb-db-type","dropdown-class-name":"nc-dropdown-ext-db-type",onChange:r},{default:n(()=>[(l(!0),w(Z,null,be(e(jt),g=>(l(),N(s,{key:g.value,value:g.value},{default:n(()=>[A(p(g.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16,["label"]),e(o).dataSource.client===e(z).SQLITE?(l(),N(i,de({key:0,label:y.$t("labels.sqliteFile")},e(C)["dataSource.connection.connection.filename"]),{default:n(()=>[t(V,{value:e(o).dataSource.connection.connection.filename,"onUpdate:value":_[2]||(_[2]=g=>e(o).dataSource.connection.connection.filename=g)},null,8,["value"])]),_:1},16,["label"])):(e(o).dataSource.client,e(z).SNOWFLAKE,l(),w(Z,{key:2},[t(i,de({label:y.$t("labels.hostAddress")},e(C)["dataSource.connection.host"]),{default:n(()=>[t(V,{value:e(o).dataSource.connection.host,"onUpdate:value":_[9]||(_[9]=g=>e(o).dataSource.connection.host=g),class:"nc-extdb-host-address"},null,8,["value"])]),_:1},16,["label"]),t(i,de({label:y.$t("labels.port")},e(C)["dataSource.connection.port"]),{default:n(()=>[t(Ae,{value:e(o).dataSource.connection.port,"onUpdate:value":_[10]||(_[10]=g=>e(o).dataSource.connection.port=g),class:"!w-full nc-extdb-host-port"},null,8,["value"])]),_:1},16,["label"]),t(i,de({label:y.$t("labels.username")},e(C)["dataSource.connection.user"]),{default:n(()=>[t(V,{value:e(o).dataSource.connection.user,"onUpdate:value":_[11]||(_[11]=g=>e(o).dataSource.connection.user=g),class:"nc-extdb-host-user"},null,8,["value"])]),_:1},16,["label"]),t(i,{label:y.$t("labels.password")},{default:n(()=>[t(fe,{value:e(o).dataSource.connection.password,"onUpdate:value":_[12]||(_[12]=g=>e(o).dataSource.connection.password=g),class:"nc-extdb-host-password"},null,8,["value"])]),_:1},8,["label"]),t(i,de({label:y.$t("labels.database")},e(C)["dataSource.connection.database"]),{default:n(()=>[t(V,{value:e(o).dataSource.connection.database,"onUpdate:value":_[13]||(_[13]=g=>e(o).dataSource.connection.database=g),placeholder:y.$t("labels.dbCreateIfNotExists"),class:"nc-extdb-host-database"},null,8,["value","placeholder"])]),_:1},16,["label"]),[e(z).MSSQL,e(z).PG].includes(e(o).dataSource.client)&&e(o).dataSource.searchPath?(l(),N(i,de({key:0,label:y.$t("labels.schemaName")},e(C)["dataSource.searchPath.0"]),{default:n(()=>[t(V,{value:e(o).dataSource.searchPath[0],"onUpdate:value":_[14]||(_[14]=g=>e(o).dataSource.searchPath[0]=g)},null,8,["value"])]),_:1},16,["label"])):Q("",!0),a("div",On,[t(_e,{type:"primary",class:"nc-extdb-btn-import-url !rounded-md",onClick:_[15]||(_[15]=It(g=>ee.value=!0,["stop"]))},{default:n(()=>[A(p(y.$t("activity.useConnectionUrl")),1)]),_:1})]),t(it,{ghost:"","expand-icon-position":"right",class:"!mt-6"},{default:n(()=>[t(ct,{key:"1"},{header:n(()=>[a("div",zn,[a("span",null,p(y.$t("title.advancedParameters")),1)])]),default:n(()=>[t(i,{label:"SSL mode"},{default:n(()=>[t(K,{value:e(o).sslUse,"onUpdate:value":_[16]||(_[16]=g=>e(o).sslUse=g),"dropdown-class-name":"nc-dropdown-ssl-mode",onSelect:v},{default:n(()=>[(l(!0),w(Z,null,be(Object.values(e(X)),g=>(l(),N(s,{key:g,value:g},{default:n(()=>[A(p(g),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(i,{label:"SSL keys"},{default:n(()=>[a("div",Fn,[t(re,{placement:"top"},{title:n(()=>[a("span",null,p(y.$t("tooltip.clientCert")),1)]),default:n(()=>[t(_e,{disabled:!e(F),class:"shadow",onClick:_[17]||(_[17]=g=>{var ge;return(ge=e(ye))==null?void 0:ge.click()})},{default:n(()=>[A(p(y.$t("labels.clientCert")),1)]),_:1},8,["disabled"])]),_:1}),t(re,{placement:"top"},{title:n(()=>[a("span",null,p(y.$t("tooltip.clientKey")),1)]),default:n(()=>[t(_e,{disabled:!e(F),class:"shadow",onClick:_[18]||(_[18]=g=>{var ge;return(ge=e(te))==null?void 0:ge.click()})},{default:n(()=>[A(p(y.$t("labels.clientKey")),1)]),_:1},8,["disabled"])]),_:1}),t(re,{placement:"top"},{title:n(()=>[a("span",null,p(y.$t("tooltip.clientCA")),1)]),default:n(()=>[t(_e,{disabled:!e(F),class:"shadow",onClick:_[19]||(_[19]=g=>{var ge;return(ge=e(O))==null?void 0:ge.click()})},{default:n(()=>[A(p(y.$t("labels.serverCA")),1)]),_:1},8,["disabled"])]),_:1})])]),_:1}),a("input",{ref_key:"caFileInput",ref:O,type:"file",class:"!hidden",onChange:_[20]||(_[20]=g=>J(e(Ve).ca,e(O)))},null,544),a("input",{ref_key:"certFileInput",ref:ye,type:"file",class:"!hidden",onChange:_[21]||(_[21]=g=>J(e(Ve).cert,e(ye)))},null,544),a("input",{ref_key:"keyFileInput",ref:te,type:"file",class:"!hidden",onChange:_[22]||(_[22]=g=>J(e(Ve).key,e(te)))},null,544),t(Ne),t(i,de({class:"mb-2",label:y.$t("labels.extraConnectionParameters")},e(C).extraParameters),{default:n(()=>[t(De,null,{default:n(()=>[(l(!0),w(Z,null,be(e(o).extraParameters,(g,ge)=>(l(),w("div",{key:ge},[a("div",Gn,[t(V,{value:g.key,"onUpdate:value":Re=>g.key=Re},null,8,["value","onUpdate:value"]),Qn,t(V,{value:g.value,"onUpdate:value":Re=>g.value=Re},null,8,["value","onUpdate:value"]),(l(),N($e(e(xe).close),{style:{"font-size":"1.5em",color:"red"},onClick:Re=>q(ge)},null,8,["onClick"]))])]))),128)),t(_e,{type:"dashed",class:"w-full caption mt-2",onClick:R},{default:n(()=>[a("div",qn,[(l(),N($e(e(xe).plus)))])]),_:1})]),_:1})]),_:1},16,["label"]),t(Ne),t(i,{label:y.$t("labels.inflection.tableName")},{default:n(()=>[t(K,{value:e(o).inflection.inflectionTable,"onUpdate:value":_[23]||(_[23]=g=>e(o).inflection.inflectionTable=g),"dropdown-class-name":"nc-dropdown-inflection-table-name"},{default:n(()=>[(l(),w(Z,null,be(ce,g=>t(s,{key:g,value:g},{default:n(()=>[A(p(g),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["label"]),t(i,{label:y.$t("labels.inflection.columnName")},{default:n(()=>[t(K,{value:e(o).inflection.inflectionColumn,"onUpdate:value":_[24]||(_[24]=g=>e(o).inflection.inflectionColumn=g),"dropdown-class-name":"nc-dropdown-inflection-column-name"},{default:n(()=>[(l(),w(Z,null,be(ce,g=>t(s,{key:g,value:g},{default:n(()=>[A(p(g),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["label"]),a("div",Kn,[t(_e,{type:"primary",class:"!rounded-md",onClick:_[25]||(_[25]=g=>je())},{default:n(()=>[A(p(y.$t("activity.editConnJson")),1)]),_:1})])]),_:1})]),_:1})],64))]),t(i,{class:"flex justify-end !mt-5"},{default:n(()=>[a("div",Jn,[t(_e,{type:"secondary",class:"nc-extdb-btn-test-connection !rounded-md",onClick:ie},{default:n(()=>[A(p(y.$t("activity.testDbConn")),1)]),_:1}),t(_e,{type:"primary",disabled:!e(b),class:"nc-extdb-btn-submit !rounded-md",onClick:m},{default:n(()=>[A(p(y.$t("general.submit")),1)]),_:1},8,["disabled"])])]),_:1}),a("div",Wn,[(l(),N($e(e(xe).warning),{class:"mr-2 mb-5.9"})),Hn])]),_:1},8,["model"]),t(qe,{visible:e(pe),"onUpdate:visible":_[27]||(_[27]=g=>Y(pe)?pe.value=g:null),title:y.$t("activity.editConnJson"),width:"600px","wrap-class-name":"nc-modal-edit-connection-json",onOk:ue},{default:n(()=>[e(pe)?(l(),N(Qe,{key:0,modelValue:e(S),"onUpdate:modelValue":_[26]||(_[26]=g=>Y(S)?S.value=g:null),class:"h-[400px] w-full"},null,8,["modelValue"])):Q("",!0)]),_:1},8,["visible","title"]),t(qe,{visible:e(ee),"onUpdate:visible":_[29]||(_[29]=g=>Y(ee)?ee.value=g:null),title:y.$t("activity.useConnectionUrl"),width:"600px","ok-text":y.$t("general.ok"),"cancel-text":y.$t("general.cancel"),"wrap-class-name":"nc-modal-connection-url",onOk:se},{default:n(()=>[t(V,{value:e(ne),"onUpdate:value":_[28]||(_[28]=g=>Y(ne)?ne.value=g:null)},null,8,["value"])]),_:1},8,["visible","title","ok-text","cancel-text"])])}}});const Zn=Pe(Yn,[["__scopeId","data-v-5814076f"]]),Xn={class:"flex flex-col w-full"},es={class:"flex flex-col"},ts={class:"flex flex-row justify-between items-center w-full mb-4"},as={class:"flex"},os={key:0},ns={class:"flex items-center gap-2"},ss={key:1},ls={class:"flex items-center gap-2 text-gray-600 font-light"},cs={class:"max-h-600px overflow-y-auto"},is={key:0},rs={class:"flex items-center gap-1"},ds={class:"min-w-5 flex items-center justify-center"},us={class:"overflow-ellipsis min-w-0 shrink-1"},_s=a("div",{class:"flex place-content-center item-center"},null,-1),ps=he({__name:"Metadata",props:{baseId:{}},emits:["baseSynced"],setup(j,{emit:x}){const D=j,{$api:U}=ke(),G=Ce(),{loadTables:B}=G,{project:L}=me(G),{t:T}=Fe(),P=$(!1),b=$(!1),k=$([]);async function c(){var S,f,I;try{if(!((S=L.value)!=null&&S.id))return;P.value=!0,b.value=!1,k.value=await U.base.metaDiffGet((f=L.value)==null?void 0:f.id,D.baseId);for(const C of k.value)((I=C.detectedChanges)==null?void 0:I.length)>0&&(C.syncState=C.detectedChanges.map(r=>r==null?void 0:r.msg).join(", "),b.value=!0)}catch(C){console.error(C)}finally{P.value=!1}}async function u(){var S,f;try{if(!((S=L.value)!=null&&S.id)||!b.value)return;P.value=!0,await U.base.metaDiffSync((f=L.value)==null?void 0:f.id,D.baseId),W.info(T("msg.info.metaDataRecreated")),await B(),await c(),x("baseSynced")}catch(I){W.error(await ve(I))}finally{P.value=!1}}Le(async()=>{k.value.length===0&&await c()});const d=S=>()=>Ue("div",{class:"text-gray-500"},S),o=[{title:d(T("labels.models")),key:"table_name"},{title:d(T("labels.syncState")),dataIndex:"syncState",key:"syncState",customRender:S=>Ue("div",{style:{color:S.text?"red":"gray"}},S.text||T("msg.info.metaNoChange"))}];return(S,f)=>{const I=Ee,C=Lt,r=Me,v=Jt,E=yt,R=va("e");return l(),w("div",Xn,[a("div",es,[a("div",ts,[a("div",as,[e(b)?(l(),w("div",os,[xt((l(),N(I,{class:"nc-btn-metasync-sync-now",type:"primary",onClick:u},{default:n(()=>[a("div",ns,[(l(),N($e(e(xe).databaseSync))),A(" "+p(S.$t("activity.metaSync")),1)])]),_:1})),[[R,["a:proj-meta:meta-data:sync"]]])])):(l(),w("div",ss,[a("span",null,[t(C,{message:S.$t("msg.info.tablesMetadataInSync"),type:"success","show-icon":""},null,8,["message"])])]))]),xt((l(),N(I,{class:"self-start !rounded-md nc-btn-metasync-reload",onClick:c},{default:n(()=>[a("div",ls,[(l(),N($e(e(xe).reload),{class:Te({"animate-infinite animate-spin !text-success":e(P)})},null,8,["class"])),A(" "+p(S.$t("general.reload")),1)])]),_:1})),[[R,["a:proj-meta:meta-data:reload"]]])]),a("div",cs,[t(E,{class:"w-full",size:"small","custom-row":q=>({class:`nc-metasync-row nc-metasync-row-${q.table_name}`}),"data-source":e(k)??[],columns:o,pagination:!1,loading:e(P),bordered:""},{emptyText:n(()=>[t(r,{image:e(Me).PRESENTED_IMAGE_SIMPLE,description:S.$t("labels.noData")},null,8,["image","description"])]),bodyCell:n(({record:q,column:ce})=>[ce.key==="table_name"?(l(),w("div",is,[a("div",rs,[a("div",ds,[t(v,{meta:q,class:"text-gray-500"},null,8,["meta"])]),a("span",us,p(q.title||q.table_name),1)])])):Q("",!0)]),_:1},8,["custom-row","data-source","loading"])])]),_s])}}}),vs={class:"flex flex-row w-full items-center justify-center"},ms={class:"flex flex-col w-[900px]"},fs={class:"mb-4 first-letter:capital font-bold"},bs={class:"flex flex-row items-center w-full mb-4 gap-2 justify-between"},ys={class:"flex"},hs={class:"flex items-center gap-2 text-gray-600 font-light"},gs={class:"flex flex-row items-center w-full gap-x-1"},ws=a("div",{class:"flex"},"Save",-1),$s={class:"max-h-600px overflow-y-auto"},xs={key:0},Ss={class:"flex items-center gap-1"},ks={class:"min-w-5 flex items-center justify-center"},Cs={class:"overflow-ellipsis min-w-0 shrink-1"},js={key:1},Is={class:"flex items-center gap-1"},Us={class:"min-w-5 flex items-center justify-center"},Ps={class:"overflow-ellipsis min-w-0 shrink-1"},Ns={key:0},Ts={key:0},Ms={key:1},ea=he({__name:"UIAcl",props:{baseId:{}},setup(j){const x=j,{t:D}=Fe(),{$api:U,$e:G}=ke(),{project:B}=me(Ce()),L=vt(bt,$()),T=le(()=>{var r;return L.value??((r=B.value)==null?void 0:r.id)}),{includeM2M:P}=nt(),b=$(["editor","commenter","viewer"]),k=$(!1),c=$([]),u=$(""),d=le(()=>c.value.filter(r=>(r==null?void 0:r.base_id)===x.baseId&&(typeof(r==null?void 0:r._ptn)=="string"&&r._ptn.toLowerCase().includes(u.value.toLowerCase())||typeof(r==null?void 0:r.title)=="string"&&r.title.toLowerCase().includes(u.value.toLowerCase()))));async function o(){try{if(!T.value)return;k.value=!0,c.value=await U.project.modelVisibilityList(T.value,{includeM2M:P.value})}catch(r){console.error(r)}finally{k.value=!1}}async function S(){try{if(!T.value)return;await U.project.modelVisibilitySet(T.value,c.value.filter(r=>r.edited)),W.success(D("msg.success.updatedUIACL"))}catch(r){W.error(await ve(r))}G("a:proj-meta:ui-acl")}const f=(r,v)=>{r.disabled[v]=!r.disabled[v],r.edited=!0};Le(async()=>{c.value.length===0&&await o()});const I=r=>()=>Ue("div",{class:"text-gray-500"},r),C=[{title:I("Table name"),name:"table_name"},{title:I("View name"),name:"view_name"},{title:I("Editor"),name:"editor",width:120},{title:I("Commenter"),name:"commenter",width:120},{title:I("Viewer"),name:"viewer",width:120}];return(r,v)=>{const E=Ye,R=Ee,q=ft,ce=Me,ne=Jt,pe=Ba,ee=Va,O=Oa,te=We,ye=yt;return l(),w("div",vs,[a("div",ms,[a("span",fs," UI ACL : "+p(e(B).title),1),a("div",bs,[t(E,{value:e(u),"onUpdate:value":v[0]||(v[0]=J=>Y(u)?u.value=J:null),placeholder:"Search models",class:"nc-acl-search !w-[400px]"},{prefix:n(()=>[(l(),N($e(e(xe).search)))]),_:1},8,["value"]),a("div",ys,[t(R,{type:"text",ghost:"",class:"self-start !rounded-md nc-acl-reload",onClick:o},{default:n(()=>[a("div",hs,[(l(),N($e(e(xe).reload),{class:Te({"animate-infinite animate-spin !text-success":e(k)})},null,8,["class"])),A(" Reload ")])]),_:1}),t(q,{size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:S},{default:n(()=>[a("div",gs,[(l(),N($e(e(xe).save))),ws])]),_:1})])]),a("div",$s,[t(ye,{class:"w-full",size:"small","data-source":e(d),columns:C,pagination:!1,loading:e(k),sticky:"",bordered:"","custom-row":J=>({class:`nc-acl-table-row nc-acl-table-row-${J.title}`})},{emptyText:n(()=>[t(ce,{image:e(Me).PRESENTED_IMAGE_SIMPLE,description:r.$t("labels.noData")},null,8,["image","description"])]),bodyCell:n(({record:J,column:F})=>[F.name==="table_name"?(l(),w("div",xs,[a("div",Ss,[a("div",ks,[t(ne,{meta:{meta:J.table_meta,type:J.ptype},class:"text-gray-500"},null,8,["meta"])]),t(pe,null,{default:n(()=>[a("span",Cs,p(J._ptn),1)]),_:2},1024)])])):Q("",!0),F.name==="view_name"?(l(),w("div",js,[a("div",Is,[a("div",Us,[t(ee,{meta:J,class:"text-gray-500"},null,8,["meta"])]),a("span",Ps,p(J.title),1)])])):Q("",!0),(l(!0),w(Z,null,be(e(b),ae=>(l(),w("div",{key:ae},[F.name===ae?(l(),w("div",Ns,[t(te,null,{title:n(()=>[J.disabled[ae]?(l(),w("span",Ts," Click to make '"+p(J.title)+"' visible for role:"+p(ae)+" in UI dashboard",1)):(l(),w("span",Ms,"Click to hide '"+p(J.title)+"' for role:"+p(ae)+" in UI dashboard",1))]),default:n(()=>[t(O,{checked:!J.disabled[ae],class:Te(`nc-acl-${J.title}-${ae}-chkbox`),onChange:M=>f(J,ae)},null,8,["checked","class","onChange"])]),_:2},1024)])):Q("",!0)]))),128))]),_:1},8,["data-source","loading","custom-row"])])])])}}}),Es={class:"w-full h-full !p-0"},Ls=he({__name:"Erd",props:{baseId:{}},setup(j){const x=j;return(D,U)=>{const G=za;return l(),w("div",Es,[t(G,{"base-id":x.baseId},null,8,["base-id"])])}}}),As={class:"flex flex-col gap-4 w-full"},Ds={key:0,class:"text-red-500"},Rs={class:"flex flex-row justify-between items-center"},Bs={class:"mb-4 first-letter:capital font-bold"},Vs={class:"flex items-center gap-2 text-gray-600 font-light"},Os={class:"flex flex-row justify-center items-center"},zs=he({__name:"BaseAudit",props:{baseId:{}},setup(j){const x=j,D=Ce(),{project:U}=me(D),{$api:G}=ke(),{t:B}=Fe(),L=$(!1),T=$(null),P=$(0),b=$(1),k=$(25),{appInfo:c}=nt();async function u(S=b.value,f=k.value){try{if(!x.baseId)return;L.value=!0;const{list:I,pageInfo:C}=await G.project.auditList(U.value.id,{offset:f*(S-1),limit:f,baseId:x.baseId});T.value=I,P.value=C.totalRows??0}catch(I){console.error(I)}finally{L.value=!1}}Le(async()=>{T.value===null&&await u(b.value,k.value)});const d=S=>()=>Ue("div",{class:"text-gray-500"},S),o=[{title:d(B("labels.operationType")),dataIndex:"op_type",key:"op_type",width:120},{title:d(B("labels.operationSubType")),dataIndex:"op_sub_type",key:"op_sub_type",width:160},{title:d(B("labels.description")),dataIndex:"description",key:"description",customRender:S=>Ue("pre",{},S.text),width:350},{title:d(B("objects.user")),dataIndex:"user",key:"user",customRender:S=>Ue("div",{},S.text||"Shared base"),width:200},{title:d(B("labels.created")),dataIndex:"created_at",key:"created_at",sort:"desc",customRender:S=>Ue(We,{placement:"bottom",title:Ue("span",{},S.text)},()=>Ct(S.text)),width:"13%"}];return(S,f)=>{const I=Ee,C=Me,r=yt,v=Fa;return l(),w("div",As,[e(c).auditEnabled?Q("",!0):(l(),w("div",Ds,"Audit logs are currently disabled by administrators.")),a("div",Rs,[a("h6",Bs,"Audit : "+p(e(U).title),1),t(I,{class:"self-start !rounded-md",onClick:u},{default:n(()=>[a("div",Vs,[(l(),N($e(e(xe).reload),{class:Te({"animate-infinite animate-spin !text-success":e(L)})},null,8,["class"])),A(" "+p(S.$t("general.reload")),1)])]),_:1})]),t(r,{class:"nc-audit-table w-full",size:"small","data-source":e(T)??[],columns:o,pagination:!1,loading:e(L),"data-testid":"audit-tab-table"},{emptyText:n(()=>[t(C,{image:e(Me).PRESENTED_IMAGE_SIMPLE,description:S.$t("labels.noData")},null,8,["image","description"])]),_:1},8,["data-source","loading"]),a("div",Os,[t(v,{current:e(b),"onUpdate:current":f[0]||(f[0]=E=>Y(b)?b.value=E:null),"page-size":e(k),"onUpdate:pageSize":f[1]||(f[1]=E=>Y(k)?k.value=E:null),total:+e(P),"show-less-items":"",onChange:u},null,8,["current","page-size","total"])])])}}});const Fs={class:"flex flex-row w-full h-full nc-data-sources-view"},Gs={class:"flex flex-col w-full overflow-auto"},Qs={class:"flex flex-row w-full justify-end mt-6 mb-5"},qs={class:"flex flex-row items-center w-full gap-x-1"},Ks=a("div",{class:"flex"},"New Source",-1),Js={class:"ds-table-head"},Ws={class:"ds-table-row"},Hs=a("div",{class:"ds-table-col ds-table-name"},"Name",-1),Ys=a("div",{class:"ds-table-col ds-table-type"},"Type",-1),Zs=a("div",{class:"ds-table-col ds-table-actions pl-2"},"Actions",-1),Xs=a("div",{class:"ds-table-col ds-table-crud"},null,-1),el={class:"ds-table-body"},tl={key:0,class:"ds-table-row border-gray-200"},al={class:"ds-table-col ds-table-enabled"},ol={class:"flex items-center gap-1 cursor-pointer"},nl=a("div",{class:"ds-table-col ds-table-name font-medium"},[a("div",{class:"flex items-center gap-1"}," Default ")],-1),sl=a("div",{class:"ds-table-col ds-table-type"},[a("div",{class:"flex items-center gap-1"},"-")],-1),ll={class:"ds-table-col ds-table-actions"},cl={class:"flex items-center gap-2"},il={class:"flex items-center gap-2 text-gray-600"},rl={class:"flex items-center gap-2 text-gray-600"},dl={class:"flex items-center gap-2 text-gray-600"},ul={class:"flex items-center gap-2 text-gray-600"},_l={class:"ds-table-col ds-table-crud"},pl={key:0,class:"ds-table-row border-gray-200"},vl={class:"ds-table-col ds-table-enabled"},ml={class:"flex items-center gap-1 cursor-pointer"},fl={class:"ds-table-col ds-table-name font-medium"},bl={key:1},yl={key:2,class:"flex items-center gap-1"},hl={class:"ds-table-col ds-table-type"},gl={class:"flex items-center gap-2"},wl={class:"text-gray-700 capitalize"},$l={class:"ds-table-col ds-table-actions"},xl={class:"flex items-center gap-2"},Sl={class:"flex items-center gap-2 text-gray-600"},kl={class:"flex items-center gap-2 text-gray-600"},Cl={class:"flex items-center gap-2 text-gray-600"},jl={class:"ds-table-col ds-table-crud justify-end gap-x-1"},Il={class:"py-6 px-8"},Ul={class:"p-6",style:{height:"80vh"}},Pl={class:"p-6"},Nl={class:"p-6"},Tl={class:"p-6"},Ml={class:"p-6"},El={key:0,class:"flex flex-row items-center py-2 px-3.25 bg-gray-50 rounded-lg text-gray-700 mb-4"},Ll={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-3",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Al=he({__name:"DataSources",props:{state:{},reload:{type:Boolean}},emits:["update:state","update:reload","awaken"],setup(j,{emit:x}){const D=j,U=dt(D,"state",x),G=dt(D,"reload",x),{$api:B,$e:L}=ke(),{loadProject:T}=Ge(),P=Ce(),{project:b}=me(P),{refreshCommandPalette:k}=Ia(),c=$([]),u=$(""),d=$([]),o=$(z.MYSQL),S=$(!1),f=$(!1),I=$(!1),C=$(!1),r=$();async function v(M){try{M&&k(),await ma(()=>!!b.value.id).toBeTruthy(),S.value=!0,G.value=!0;const m=await B.base.list(b.value.id);m.list&&m.list.length&&(c.value=m.list),await E()}catch(m){console.error(m)}finally{G.value=!1,S.value=!1}}async function E(){var M;try{d.value=[];const m=await B.project.metaDiffGet(b.value.id);for(const ie of m)((M=ie.detectedChanges)==null?void 0:M.length)>0&&d.value.push(ie.base_id)}catch(m){console.error(m)}}const R=(M,m)=>{M&&(u.value=M,U.value=m||"")},q=M=>{L("c:base:delete"),C.value=!0,r.value=M},ce=async()=>{if(r.value)try{await B.base.delete(r.value.project_id,r.value.id),L("a:base:delete"),c.value.splice(c.value.indexOf(r.value),1),await T(b.value.id,!0)}catch(M){W.error(await ve(M))}},ne=async(M,m)=>{try{if(!m&&c.value.filter(ie=>ie.enabled).length<2){W.info("There should be at least one enabled base!");return}M.enabled=m,await B.base.update(M.project_id,M.id,{id:M.id,project_id:M.project_id,enabled:M.enabled}),await T(b.value.id,!0)}catch(ie){W.error(await ve(ie))}},pe=async M=>{try{if(M.oldIndex===M.newIndex)return;const m=c.value[M.newIndex];m&&(m.order?await B.base.update(m.project_id,m.id,{id:m.id,project_id:m.project_id,order:M.newIndex+1}):(await B.base.update(m.project_id,m.id,{id:m.id,project_id:m.project_id}),W.info("Bases are migrated. Please try again."))),await T(b.value.id,!0),await v()}catch(m){W.error(await ve(m))}},ee=()=>{f.value=!f.value,I.value=f.value,x("awaken",f.value)};Le(async()=>{c.value.length===0&&v()}),we(()=>D.reload,async M=>{M&&!S.value&&await v()}),we(()=>c.value.length,M=>{M>1&&!f.value?(I.value=!1,x("awaken",!1)):(I.value=!0,x("awaken",!0))},{immediate:!0}),we(U,async M=>{switch(c.value.length||await v(),M){case z.MYSQL:o.value=z.MYSQL,U.value=oe.New;break;case z.PG:o.value=z.PG,U.value=oe.New;break;case z.SQLITE:o.value=z.SQLITE,U.value=oe.New;break;case z.MSSQL:o.value=z.MSSQL,U.value=oe.New;break;case z.SNOWFLAKE:o.value=z.SNOWFLAKE,U.value=oe.New;break;case oe.New:c.value.length>1&&!f.value&&(U.value="");break}},{immediate:!0});const O=le({get:()=>[oe.New].includes(U.value),set:M=>{M||(U.value="")}}),te=le({get:()=>[oe.ERD].includes(U.value),set:M=>{M||(U.value="")}}),ye=le({get:()=>[oe.Metadata].includes(U.value),set:M=>{M||(U.value="")}}),J=le({get:()=>[oe.UIAcl].includes(U.value),set:M=>{M||(U.value="")}}),F=le({get:()=>[oe.Audit].includes(U.value),set:M=>{M||(U.value="")}}),ae=le({get:()=>[oe.Edit].includes(U.value),set:M=>{M||(U.value="")}});return(M,m)=>{const ie=ft,se=Ga,je=We,ue=He,y=Ee,_=Pt,V=mt,i=Da;return l(),w("div",Fs,[a("div",Gs,[a("div",Qs,[e(I)?(l(),N(ie,{key:0,size:"large",class:"z-10 !rounded-lg !px-2 mr-2.5",type:"primary",onClick:m[0]||(m[0]=s=>U.value=e(oe).New)},{default:n(()=>[a("div",qs,[(l(),N($e(("iconMap"in M?M.iconMap:e(xe)).plus))),Ks])]),_:1})):Q("",!0)]),a("div",{class:"overflow-y-auto nc-scrollbar-md",style:ot({maxHeight:"calc(100vh - 200px)"})},[a("div",Js,[a("div",Ws,[a("div",{class:"ds-table-col ds-table-enabled cursor-pointer",onDblclick:ee},"Visibility",32),Hs,Ys,Zs,Xs])]),a("div",el,[t(e(Ra),{list:e(c),"item-key":"id",handle:".ds-table-handle",onEnd:pe},{header:n(()=>[e(c)[0]?(l(),w("div",tl,[a("div",al,[a("div",ol,[t(je,null,{title:n(()=>[e(c)[0].enabled?(l(),w(Z,{key:0},[A("Hide in UI")],64)):(l(),w(Z,{key:1},[A("Show in UI")],64))]),default:n(()=>[t(se,{checked:!!e(c)[0].enabled,size:"default",onChange:m[1]||(m[1]=s=>ne(e(c)[0],s))},null,8,["checked"])]),_:1})])]),nl,sl,a("div",ll,[a("div",cl,[!e(c)[0].is_meta&&!e(c)[0].is_local?(l(),N(y,{key:0,class:"nc-action-btn cursor-pointer outline-0",type:"text",onClick:m[2]||(m[2]=s=>R(e(c)[0].id,e(oe).Metadata))},{default:n(()=>[a("div",il,[e(d).includes(e(c)[0].id)?(l(),N(je,{key:0},{title:n(()=>[A("Out of sync")]),default:n(()=>[t(ue,{icon:"warning",class:"group-hover:text-accent text-primary"})]),_:1})):(l(),N(ue,{key:1,icon:"sync",class:"group-hover:text-accent"})),A(" Sync Metadata ")])]),_:1})):Q("",!0),t(y,{class:"nc-action-btn cursor-pointer outline-0",type:"text",onClick:m[3]||(m[3]=s=>R(e(c)[0].id,e(oe).ERD))},{default:n(()=>[a("div",rl,[t(ue,{icon:"erd",class:"group-hover:text-accent"}),A(" Relations ")])]),_:1}),t(y,{class:"nc-action-btn cursor-pointer outline-0",type:"text",onClick:m[4]||(m[4]=s=>R(e(c)[0].id,e(oe).UIAcl))},{default:n(()=>[a("div",dl,[t(ue,{icon:"acl",class:"group-hover:text-accent"}),A(" UI ACL ")])]),_:1}),t(y,{class:"nc-action-btn cursor-pointer outline-0",type:"text",onClick:m[5]||(m[5]=s=>R(e(c)[0].id,e(oe).Audit))},{default:n(()=>[a("div",ul,[t(ue,{icon:"book",class:"group-hover:text-accent"}),A(" Audit ")])]),_:1})])]),a("div",_l,[!e(c)[0].is_meta&&!e(c)[0].is_local?(l(),N(y,{key:0,class:"nc-action-btn cursor-pointer outline-0 !w-8 !px-1 !rounded-lg",type:"text",onClick:m[6]||(m[6]=s=>R(e(c)[0].id,e(oe).Edit))},{default:n(()=>[t(ue,{icon:"edit",class:"text-gray-600"})]),_:1})):Q("",!0)])])):Q("",!0)]),item:n(({element:s,index:K})=>[K!==0?(l(),w("div",pl,[a("div",vl,[a("div",ml,[t(je,null,{title:n(()=>[s.enabled?(l(),w(Z,{key:0},[A("Hide in UI")],64)):(l(),w(Z,{key:1},[A("Show in UI")],64))]),default:n(()=>[t(se,{checked:!!s.enabled,onChange:fe=>ne(s,fe)},null,8,["checked","onChange"])]),_:2},1024)])]),a("div",fl,[e(c).length>2?(l(),N(ue,{key:0,icon:"dragVertical",small:"",class:"ds-table-handle"})):Q("",!0),s.is_meta||s.is_local?(l(),w("div",bl,"-")):(l(),w("div",yl,p(s.is_meta||s.is_local?"BASE":s.alias),1))]),a("div",hl,[e(c).length>2?(l(),N(ue,{key:0,icon:"dragVertical",small:"",class:"ds-table-handle"})):Q("",!0),a("div",gl,[t(_,{"base-type":s.type},null,8,["base-type"]),a("span",wl,p(s.type),1)])]),a("div",$l,[a("div",xl,[t(y,{class:"nc-action-btn cursor-pointer outline-0",type:"text",onClick:fe=>R(s.id,e(oe).ERD)},{default:n(()=>[a("div",Sl,[t(ue,{icon:"erd",class:"group-hover:text-accent"}),A(" Relations ")])]),_:2},1032,["onClick"]),t(y,{type:"text",class:"nc-action-btn cursor-pointer outline-0",onClick:fe=>R(s.id,e(oe).UIAcl)},{default:n(()=>[a("div",kl,[t(ue,{icon:"acl",class:"group-hover:text-accent"}),A(" UI ACL ")])]),_:2},1032,["onClick"]),!s.is_meta&&!s.is_local?(l(),N(y,{key:0,type:"text",class:"nc-action-btn cursor-pointer outline-0",onClick:fe=>R(s.id,e(oe).Metadata)},{default:n(()=>[a("div",Cl,[e(d).includes(s.id)?(l(),N(je,{key:0},{title:n(()=>[A("Out of sync")]),default:n(()=>[t(ue,{icon:"warning",class:"group-hover:text-accent text-primary"})]),_:1})):(l(),N(ue,{key:1,icon:"sync",class:"group-hover:text-accent"})),A(" Sync Metadata ")])]),_:2},1032,["onClick"])):Q("",!0)])]),a("div",jl,[!s.is_meta&&!s.is_local?(l(),N(y,{key:0,class:"nc-action-btn cursor-pointer outline-0 !w-8 !px-1 !rounded-lg mt-0.5",type:"text",onClick:fe=>R(s.id,e(oe).Edit)},{default:n(()=>[t(ue,{icon:"edit",class:"text-gray-600 -mt-0.5"})]),_:2},1032,["onClick"])):Q("",!0),!s.is_meta&&!s.is_local?(l(),N(y,{key:1,class:"nc-action-btn cursor-pointer outline-0 !w-8 !px-1 !rounded-lg mt-0.5",type:"text",onClick:fe=>q(s)},{default:n(()=>[t(ue,{icon:"delete",class:"text-red-500 -mt-0.5"})]),_:2},1032,["onClick"])):Q("",!0)])])):Q("",!0)]),_:1},8,["list"])])],4),t(V,{visible:e(O),"onUpdate:visible":m[9]||(m[9]=s=>Y(O)?O.value=s:null),size:"medium"},{default:n(()=>[a("div",Il,[t(Dn,{"connection-type":e(o),onBaseCreated:m[7]||(m[7]=s=>v(!0)),onClose:m[8]||(m[8]=s=>O.value=!1)},null,8,["connection-type"])])]),_:1},8,["visible"]),t(V,{visible:e(te),"onUpdate:visible":m[10]||(m[10]=s=>Y(te)?te.value=s:null),size:"large"},{default:n(()=>[a("div",Ul,[t(Ls,{"base-id":e(u)},null,8,["base-id"])])]),_:1},8,["visible"]),t(V,{visible:e(ye),"onUpdate:visible":m[12]||(m[12]=s=>Y(ye)?ye.value=s:null),size:"medium"},{default:n(()=>[a("div",Pl,[t(ps,{"base-id":e(u),onBaseSynced:m[11]||(m[11]=s=>v(!0))},null,8,["base-id"])])]),_:1},8,["visible"]),t(V,{visible:e(J),"onUpdate:visible":m[13]||(m[13]=s=>Y(J)?J.value=s:null),class:"!w-[60rem]"},{default:n(()=>[a("div",Nl,[t(ea,{"base-id":e(u)},null,8,["base-id"])])]),_:1},8,["visible"]),t(V,{visible:e(ae),"onUpdate:visible":m[16]||(m[16]=s=>Y(ae)?ae.value=s:null),size:"medium"},{default:n(()=>[a("div",Tl,[t(Zn,{"base-id":e(u),onBaseUpdated:m[14]||(m[14]=s=>v(!0)),onClose:m[15]||(m[15]=s=>ae.value=!1)},null,8,["base-id"])])]),_:1},8,["visible"]),t(V,{visible:e(F),"onUpdate:visible":m[18]||(m[18]=s=>Y(F)?F.value=s:null),class:"!w-[70rem]"},{default:n(()=>[a("div",Ml,[t(zs,{"base-id":e(u),onClose:m[17]||(m[17]=s=>F.value=!1)},null,8,["base-id"])])]),_:1},8,["visible"]),t(i,{visible:e(C),"onUpdate:visible":m[19]||(m[19]=s=>Y(C)?C.value=s:null),"entity-name":"base","on-delete":ce},{"entity-preview":n(()=>[e(r)?(l(),w("div",El,[t(_,{"base-type":e(r).type},null,8,["base-type"]),a("div",Ll,p(e(r).alias),1)])):Q("",!0)]),_:1},8,["visible"])])])}}});const Dl={key:0},Rl={class:"tab-title","data-testid":"proj-view-tab__all-tables"},Bl={class:"capitalize"},Vl=he({__name:"UIAclTabs",setup(j){const{project:x}=me(Ce());return(D,U)=>{const G=ea,B=Wt,L=Ht;return!e(x)||!e(x).bases?(l(),w("div",Dl)):e(x).bases.length===1?(l(),N(G,{key:1,"base-id":e(x).bases[0].id,class:"mt-6"},null,8,["base-id"])):(l(),N(L,{key:2,class:"w-full"},{default:n(()=>[(l(!0),w(Z,null,be(e(x).bases,T=>(l(),N(B,{key:T.id},{tab:n(()=>[a("div",Rl,[a("div",Bl,p(T.alias??"Default"),1)])]),default:n(()=>[t(G,{"base-id":T.id,class:"mt-6"},null,8,["base-id"])]),_:2},1024))),128))]),_:1}))}}}),Ol={class:"nc-icon",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},zl=a("path",{d:"M12.6667 2H3.33333C2.59695 2 2 2.59695 2 3.33333V12.6667C2 13.403 2.59695 14 3.33333 14H12.6667C13.403 14 14 13.403 14 12.6667V3.33333C14 2.59695 13.403 2 12.6667 2Z",stroke:"currentColor","stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Fl=a("path",{d:"M6 14V6",stroke:"currentColor","stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Gl=a("path",{d:"M2 6H14",stroke:"currentColor","stroke-width":"1.33333","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),Ql=[zl,Fl,Gl];function ql(j,x){return l(),w("svg",Ol,Ql)}const Kl={name:"nc-icons-layout",render:ql},Jl=ya(()=>ha(()=>import("./ShareProject.9848bdcc.js"),["./ShareProject.9848bdcc.js","./entry.13466615.js","./entry.0f786d51.css","./Button.vue.a83cab3b.js","./index.f2e6837c.js","./debounce.dbc9bf77.js","./toNumber.7aa6a805.js","./isSymbol.b9109ae5.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./v3-infinite-loading.e93e94ab.js","./useMetas.223da623.js","./index.e7cf7635.js","./ShareProject.ab701241.css"],import.meta.url).then(j=>j.default||j)),gt=j=>(Oe("data-v-df577107"),j=j(),ze(),j),Wl={class:"h-full nc-project-view"},Hl={class:"flex flex-row items-center gap-x-4"},Yl={class:"flex font-medium text-base capitalize"},Zl={class:"tab-title","data-testid":"proj-view-tab__all-tables"},Xl=gt(()=>a("div",null,"All tables",-1)),ec={class:"tab-title","data-testid":"proj-view-tab__access-settings"},tc=gt(()=>a("div",null,"Collaborator",-1)),ac={class:"tab-title","data-testid":"proj-view-tab__data-sources"},oc=gt(()=>a("div",null,"Data sources",-1));const nc=he({__name:"View",setup(j){const{openedProject:x}=me(Ge()),{activeTables:D}=me(at()),{activeWorkspace:U}=me(Ua()),{navigateToProjectPage:G}=Ce(),L=fa().currentRoute,{isUIAllowed:T}=Nt(),{isMobileMode:P}=nt(),b=$("allTable"),k=$("");return we(()=>{var c;return(c=L.value.query)==null?void 0:c.page},(c,u)=>{c&&c!==u&&(c==="collaborator"?b.value="collaborator":c==="data-source"?b.value="data-source":b.value="allTable")},{immediate:!0}),we(b,()=>{b.value&&G({page:b.value})}),we(()=>{var c;return(c=x.value)==null?void 0:c.title},()=>{var c,u;ba(`${((c=x.value)==null?void 0:c.title)??((u=U.value)==null?void 0:u.title)??"NocoDB"}`)}),(c,u)=>{var q,ce;const d=$a,o=xa,S=Jl,f=yo,I=Wt,C=He,r=mn,v=Al,E=Vl,R=Ht;return l(),w("div",Wl,[a("div",{class:Te(["flex flex-row pl-2 pr-2 border-b-1 border-gray-200 justify-between w-full",{"nc-table-toolbar-mobile":e(P),"h-[var(--topbar-height)]":!e(P)}])},[a("div",Hl,[t(d),t(o,{type:(q=e(x))==null?void 0:q.type},null,8,["type"]),a("div",Yl,p((ce=e(x))==null?void 0:ce.title),1)]),t(S)],2),a("div",{class:"flex mx-12 my-8 nc-project-view-tab",style:ot({height:"calc(100% - var(--topbar-height))"})},[t(R,{activeKey:e(b),"onUpdate:activeKey":u[1]||(u[1]=ne=>Y(b)?b.value=ne:null),class:"w-full"},{default:n(()=>[t(I,{key:"allTable"},{tab:n(()=>[a("div",Zl,[t(e(Kl)),Xl,a("div",{class:Te(["flex pl-1.25 px-1.5 py-0.75 rounded-md text-xs",{"bg-primary-selected":e(b)==="allTable","bg-gray-50":e(b)!=="allTable"}])},p(e(D).length),3)])]),default:n(()=>[t(f)]),_:1}),e(T)("shareProject")?(l(),N(I,{key:"collaborator"},{tab:n(()=>[a("div",ec,[t(C,{icon:"users",class:"!h-3.5 !w-3.5"}),tc])]),default:n(()=>[t(r)]),_:1})):Q("",!0),e(T)("createBase")?(l(),N(I,{key:"data-source"},{tab:n(()=>[a("div",ac,[t(C,{icon:"database"}),oc])]),default:n(()=>[t(v,{state:e(k),"onUpdate:state":u[0]||(u[0]=ne=>Y(k)?k.value=ne:null)},null,8,["state"])]),_:1})):Q("",!0),Q("",!0)]),_:1},8,["activeKey"])],4)])}}});const sc=Pe(nc,[["__scopeId","data-v-df577107"]]),lc=he({__name:"index",setup(j){const x=Ce(),{project:D}=me(x),{files:U,reset:G}=ga(),{bases:B}=me(x),{$e:L}=ke(),T=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.spreadsheet-template","text/csv","application/json","text/json"];we(U,c=>c&&P(c),{flush:"post"});function P(c){if(!c)return;const u=Array.from(c).map(d=>d);b(u)}function b(c){if(!c)return;if(c.length>1)return W.error({content:"Only one file can be imported at a time.",duration:2});let u=null;const d=T.some(o=>{const S=c[0].type===o;if(S){const f=c[0].name.split(".").pop();u=f==="csv"||f==="json"?f:"excel"}return S});if(!d)return W.error({content:"Invalid file type",duration:2});u&&d&&k(u,c[0])}function k(c,u){var I,C,r,v;L(`a:actions:import-${c}`);const d=$(!0),{close:o,vNode:S}=tt(kt,{modelValue:d,importType:c,"onUpdate:modelValue":f,baseId:(I=B.value)==null?void 0:I.filter(E=>E.enabled)[0].id});(v=(r=(C=S.value)==null?void 0:C.component)==null?void 0:r.exposed)==null||v.handleChange({file:{uid:`${c}-${u.name}-${Math.random().toString(36).substring(2)}`,name:u.name,type:u.type,status:"done",fileName:u.name,lastModified:u.lastModified,size:u.size,originFileObj:u},event:{percent:100}});function f(){d.value=!1,o(1e3),G()}}return we(()=>D.value.id,()=>{var c;if((c=D.value)!=null&&c.id&&D.value.type==="database"){const{addTab:u}=Qa();u({id:D.value.id,title:D.value.title,type:wa.DB,projectId:D.value.id})}}),(c,u)=>{const d=sc;return l(),N(d)}}}),ti=Object.freeze(Object.defineProperty({__proto__:null,default:lc},Symbol.toStringTag,{value:"Module"}));export{ti as i,wo as u};
