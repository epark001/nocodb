import{o as l,c as f,a as c,h as X,cd as p,$ as V,r as v,i as g,S as ee,aq as oe,cI as te,C as h,w as a,I as G,E as t,cF as y,aj as $,cp as E,b as _,t as w,W as I,aV as ne,H as re,Q as se,R as ie,g0 as le,J as F,L as ae,_ as ce}from"./entry.51f4e399.js";import{_ as ue}from"./Select.vue.e482f984.js";import{_ as de}from"./Icon.vue.1162f18b.js";import{_ as me}from"./Button.vue.793bcd1d.js";import{_ as _e}from"./Dropdown.vue.97a9d1a0.js";import{a as pe}from"./useGridViewColumn.377be28c.js";import{M as fe,A as ve,d as ge}from"./index.5263eb1d.js";import{g as ye}from"./sortUtils.e8487dc1.js";import{u as be}from"./index.f7e0da2d.js";import{a as he}from"./useSmartsheetStore.1784ce8b.js";import{S as we}from"./index.5e746f62.js";import{_ as ke}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.0db47614.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isSymbol.b53bd26f.js";import"./index.252dc7b4.js";import"./Dropdown.dc69c0a4.js";import"./RightOutlined.90e8180f.js";import"./index.b9981e09.js";import"./useMetas.ba7abae7.js";import"./index.9e760c64.js";import"./views.28a76d89.js";import"./useSharedView.0db5f32b.js";import"./toArray.06afb623.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./SearchOutlined.dec109ce.js";import"./FormItemContext.e001cd7c.js";const xe={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Be=c("path",{fill:"currentColor",d:"M5 5v14h2v2H3V3h4v2H5m15 2H7v2h13V7m0 4H7v2h13v-2m0 4H7v2h13v-2Z"},null,-1),Ce=[Be];function Se(b,M){return l(),f("svg",xe,Ce)}const Ve={name:"mdi-format-list-group",render:Se},Ge=se(()=>ie(()=>import("./FieldListAutoCompleteDropdown.3c89ff3b.js"),["./FieldListAutoCompleteDropdown.3c89ff3b.js","./FieldListAutoCompleteDropdown.vue.6ac3ad51.js","./VirtualCellIcon.f17eeb0a.js","./index.5263eb1d.js","./entry.51f4e399.js","./entry.0f786d51.css","./virtualCell.4dce1393.js","./CellIcon.8a6080fd.js","./cell.1732684e.js","./useMetas.ba7abae7.js","./Select.vue.e482f984.js","./Icon.vue.1162f18b.js","./index.5e746f62.js","./toArray.06afb623.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./SearchOutlined.dec109ce.js","./FormItemContext.e001cd7c.js","./Select.6ec8848b.css","./useViewColumns.96f2a704.js","./index.9e760c64.js","./FieldListAutoCompleteDropdown.1cb8de15.css"],import.meta.url).then(b=>b.default||b)),$e={class:"flex items-center gap-2"},Ie={key:0,class:"text-capitalize !text-sm font-medium"},Me={key:1,class:"nc-count-badge"},De={class:"flex"},Le=X({__name:"GroupByMenu",setup(b){const M=[p.SingleSelect,p.MultiSelect,p.Checkbox,p.Date,p.SingleLineText,p.Number],D=V(fe,v()),N=V(ve,v()),j=V(ge,v(!1)),{gridViewCols:k,updateGridViewColumn:L}=pe(),n=v([]),x=g(()=>{const o=[];return Object.values(k.value).forEach(e=>{e.group_by&&o.push({fk_column_id:e.fk_column_id,sort:e.group_by_sort||"asc",order:e.group_by_order||1})}),o.sort((e,r)=>e.order-r.order),o}),u=g(()=>x.value.map(o=>o.fk_column_id).filter(o=>o)),{eventBus:z}=he(),{isMobileMode:A}=ee(),O=g(()=>{var e;return(((e=D.value)==null?void 0:e.columns)||[]).filter(r=>M.includes(r.uidt))}),H=g(()=>{var o;return((o=D.value)==null?void 0:o.columns)||[]}),R=g(()=>H.value.reduce((o,e)=>(o[e.id]=e,o),{})),P=o=>{var e;return o&&((e=R.value[o])==null?void 0:e.uidt)||""},d=v(!1);be(d);const B=async()=>{var o;if((o=N.value)!=null&&o.id)try{for(const e of n.value){if(!e.fk_column_id)continue;const r=k.value[e.fk_column_id];r&&(!r.group_by||r.group_by_order!==e.order||r.group_by_sort!==e.sort)&&await L(e.fk_column_id,{group_by:!0,group_by_order:e.order,group_by_sort:e.sort})}for(const e of x.value){if(!e.fk_column_id||n.value.find(S=>S.fk_column_id===e.fk_column_id))continue;const r=k.value[e.fk_column_id];r&&r.group_by&&await L(e.fk_column_id,{group_by:!1,group_by_order:void 0,group_by_sort:void 0})}z.emit(le.GROUP_BY_RELOAD)}catch{F.error("There was an error while updating view!")}else F.error("View not found!!!")},C=async()=>{n.value.push({fk_column_id:void 0,sort:"asc",order:n.value.length+1})},q=async o=>{if(u.value.length===0){d.value=!1;return}n.value.splice(+o,1),await B(),n.value.length===0&&C()};return oe(d,()=>{d.value&&(n.value=[...x.value],n.value.length===0&&C())}),(o,e)=>{const r=ae,S=Ge,J=we,Q=ue,T=de,U=me,W=ce,Y=_e,Z=te("e");return l(),h(Y,{visible:t(d),"onUpdate:visible":e[4]||(e[4]=m=>re(d)?d.value=m:null),"offset-y":"",trigger:["click"],"overlay-class-name":"nc-dropdown-group-by-menu nc-toolbar-dropdown"},{overlay:a(()=>[c("div",{class:G([{" min-w-[400px]":t(n).length},"flex flex-col bg-white shadow-lg rounded-md overflow-auto border-1 border-gray-50 menu-filter-dropdown max-h-[max(80vh,500px)] py-6 pl-6"]),"data-testid":"nc-group-by-menu"},[c("div",{class:"group-by-grid pb-1 mb-2 max-h-100 nc-scrollbar-md pr-5",onClick:e[2]||(e[2]=y(()=>{},["stop"]))},[(l(!0),f($,null,E(Object.entries(t(n)),([m,s])=>(l(),f($,{key:`grouped-by-${s.fk_column_id}`},[_(S,{modelValue:s.fk_column_id,"onUpdate:modelValue":i=>s.fk_column_id=i,class:"caption nc-sort-field-select",columns:t(O).filter(i=>i.id&&!t(u).includes(i.id)||i.id===s.fk_column_id),"allow-empty":!0,onChange:B,onClick:e[0]||(e[0]=y(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns"]),_(Q,{ref_for:!0,ref:"",value:s.sort,"onUpdate:value":i=>s.sort=i,class:"shrink grow-0 nc-sort-dir-select",label:o.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir",disabled:!s.fk_column_id,onChange:B,onClick:e[1]||(e[1]=y(()=>{},["stop"]))},{default:a(()=>[(l(!0),f($,null,E(t(ye)(P(s.fk_column_id)),(i,K)=>(l(),h(J,{key:K,value:i.value},{default:a(()=>[c("span",null,w(i.text),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","label","disabled"]),_(W,{placement:"right",title:"Remove"},{default:a(()=>[_(U,{class:"nc-group-by-item-remove-btn",size:"small",type:"text",onClick:y(i=>q(m),["stop"])},{default:a(()=>[_(T,{icon:"delete",class:""})]),_:2},1032,["onClick"])]),_:2},1024)],64))),128))]),t(O).length>t(n).length&&t(n).length<3?(l(),h(U,{key:0,class:"nc-add-group-btn",style:{width:"fit-content"},size:"small",type:"text",disabled:t(u).length<t(n).length,onClick:e[3]||(e[3]=y(m=>C(),["stop"]))},{default:a(()=>[c("div",{class:G(["flex gap-1 items-center",{"text-brand-500":t(u).length>=t(n).length}])},[c("div",De,w(o.$t("activity.addSubGroup")),1),_(T,{icon:"plus"})],2)]),_:1},8,["disabled"])):I("",!0)],2)]),default:a(()=>{var m;return[c("div",{class:G({"nc-badge nc-active-btn":(m=t(u))==null?void 0:m.length})},[ne((l(),h(r,{class:"nc-group-by-menu-btn nc-toolbar-btn",disabled:t(j)},{default:a(()=>{var s;return[c("div",$e,[_(t(Ve),{class:"h-4 w-4"}),t(A)?I("",!0):(l(),f("span",Ie,w(o.$t("activity.groupBy")),1)),(s=t(u))!=null&&s.length?(l(),f("span",Me,w(t(u).length),1)):I("",!0)])]}),_:1},8,["disabled"])),[[Z,["c:group-by"]]])],2)]}),_:1},8,["visible"])}}});const fo=ke(Le,[["__scopeId","data-v-c45c60df"]]);export{fo as default};
