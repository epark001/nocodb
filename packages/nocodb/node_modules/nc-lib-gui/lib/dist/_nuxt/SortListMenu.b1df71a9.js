import{_ as me}from"./Icon.vue.b79d4fb6.js";import{h as Z,at as ve,r as i,$,i as U,cd as k,dg as ee,eW as te,f4 as oe,aq as K,k as fe,o as r,c,a as f,aV as ne,eD as _e,E as t,H as P,W as N,aj as R,cp as Q,I as E,b,t as B,b6 as G,cF as h,cB as he,S as ke,g0 as we,cI as ge,C as y,w as v,D as X,F as Y,d as ye,L as be}from"./entry.51f4e399.js";import{A as se,M as re,d as Se,R as xe}from"./index.5263eb1d.js";import{u as ae}from"./useViewColumns.96f2a704.js";import{u as le}from"./useViewSorts.b2d2a7e1.js";import{_ as Ce}from"./FieldListAutoCompleteDropdown.vue.6ac3ad51.js";import{_ as $e}from"./Select.vue.e482f984.js";import{_ as Me}from"./Button.vue.793bcd1d.js";import{_ as Le}from"./Dropdown.vue.97a9d1a0.js";import{g as Oe}from"./sortUtils.e8487dc1.js";import{u as Ve}from"./index.f7e0da2d.js";import{a as De}from"./useSmartsheetStore.1784ce8b.js";import{S as Ie}from"./index.5e746f62.js";import{_ as Be}from"./_plugin-vue_export-helper.c27b6911.js";import"./VirtualCellIcon.f17eeb0a.js";import"./virtualCell.4dce1393.js";import"./CellIcon.8a6080fd.js";import"./cell.1732684e.js";import"./useMetas.ba7abae7.js";import"./index.9e760c64.js";import"./useSharedView.0db5f32b.js";import"./Icon.vue.1162f18b.js";import"./index.0db47614.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isSymbol.b53bd26f.js";import"./index.252dc7b4.js";import"./Dropdown.dc69c0a4.js";import"./RightOutlined.90e8180f.js";import"./views.28a76d89.js";import"./index.b9981e09.js";import"./toArray.06afb623.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./SearchOutlined.dec109ce.js";import"./FormItemContext.e001cd7c.js";const Te=["onKeydown"],je={class:"flex pb-3 px-4 border-b-1 border-gray-100"},Ue={class:"flex-col w-full max-h-100 nc-scrollbar-md !overflow-y-auto"},Ne={key:0,class:"flex text-gray-500 px-4 py-2.25"},Re=["onClick"],Ee=Z({__name:"CreateSort",props:{isParentOpen:{type:Boolean}},emits:["created"],setup(F,{emit:M}){const L=F,{isParentOpen:T}=ve(L),S=i(),w=i(""),s=i(-1),x=$(se,i()),O=$(re,i()),{showSystemFields:H,metaColumnById:V}=ae(x,O),{sorts:A}=le(x),_=U(()=>{var d,p;return((p=(d=O.value)==null?void 0:d.columns)==null?void 0:p.filter(a=>{var n;return a.uidt===k.Links?!0:ee((n=V==null?void 0:V.value)==null?void 0:n[a.id])?H.value:a.uidt===k.QrCode||a.uidt===k.Barcode||a.uidt===k.ID?!1:!(te(a)&&a.colOptions.type!==oe.BELONGS_TO)}).filter(a=>!A.value.find(n=>n.fk_column_id===a.id)).filter(a=>{var n;return(n=a.title)==null?void 0:n.toLowerCase().includes(w.value.toLowerCase())}))??[]}),u=d=>{M("created",d)};K(T,()=>{T.value&&setTimeout(()=>{var d;(d=S.value)==null||d.focus()},100)},{immediate:!0}),fe(()=>{w.value="",s.value=-1});const z=()=>{s.value=Math.min(s.value+1,_.value.length-1)},D=()=>{s.value=Math.max(s.value-1,0)};return(d,p)=>{const a=me;return r(),c("div",{class:"flex flex-col w-full pt-4 pb-2 min-w-64 nc-sort-create-modal",onKeydown:[G(h(z,["prevent"]),["arrow-down"]),G(h(D,["prevent"]),["arrow-up"]),p[1]||(p[1]=G(h(n=>u(t(_)[t(s)]),["prevent"]),["enter"]))]},[f("div",je,[ne(f("input",{ref_key:"inputRef",ref:S,"onUpdate:modelValue":p[0]||(p[0]=n=>P(w)?w.value=n:null),class:"w-full focus:outline-none",placeholder:"Select Field to Sort"},null,512),[[_e,t(w)]])]),f("div",Ue,[t(_).length?N("",!0):(r(),c("div",Ne,"Empty")),(r(!0),c(R,null,Q(t(_),(n,I)=>(r(),c("div",{key:I,class:E(["flex flex-row h-10 items-center gap-x-1.5 px-2.5 hover:bg-gray-100 cursor-pointer nc-sort-column-search-item",{"bg-gray-100":t(s)===I}]),onClick:o=>u(n)},[b(a,{column:n},null,8,["column"]),f("div",null,B(n.title),1)],10,Re))),128))])],40,Te)}}}),Fe={class:"nc-icon",stroke:"currentColor",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},He=he('<path d="M5.3335 12H14.0002" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2 12H2.00667" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5.3335 8H14.0002" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2 8H2.00667" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5.3335 4H14.0002" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2 4H2.00667" stroke="currentColor" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"></path>',6),Ae=[He];function ze(F,M){return r(),c("svg",Fe,Ae)}const Ge={name:"nc-icons-list",render:ze},Ke={class:"flex items-center gap-2"},Pe={key:0,class:"text-capitalize !text-sm font-medium"},Qe={key:1,class:"nc-count-badge"},We={class:"flex gap-1 items-center"},qe=Z({__name:"SortListMenu",setup(F){const M=$(re,i()),L=$(se,i()),T=$(Se,i(!1)),S=$(xe),{eventBus:w}=De(),{sorts:s,saveOrUpdate:x,loadSorts:O,addSort:H,deleteSort:V}=le(L,()=>S==null?void 0:S.trigger()),{showSystemFields:A,metaColumnById:_}=ae(L,M);i();const u=i(!1),{isMobileMode:z}=ke();w.on(o=>{o===we.SORT_RELOAD&&O()});const D=U(()=>{var o;return((o=M.value)==null?void 0:o.columns)||[]}),d=U(()=>D.value.reduce((o,e)=>(o[e.id]=e,o),{})),p=U(()=>{var o;return(o=D.value)==null?void 0:o.filter(e=>{var C;return e.uidt===k.Links?!0:ee((C=_==null?void 0:_.value)==null?void 0:C[e.id])?A.value:e.uidt===k.QrCode||e.uidt===k.Barcode||e.uidt===k.ID?!1:!(te(e)&&e.colOptions.type!==oe.BELONGS_TO)}).filter(e=>!s.value.find(C=>C.fk_column_id===e.id))}),a=o=>{var e;return o&&((e=d.value[o])==null?void 0:e.uidt)||""};K(()=>{var o;return(o=L.value)==null?void 0:o.id},o=>{o&&O()},{immediate:!0});const n=i(!1);Ve(n);const I=o=>{H(!0,o);const e=s.value[s.value.length-1];x(e,s.value.length-1),u.value=!1};return K(n,()=>{n.value||(u.value=!1)}),(o,e)=>{const C=be,W=Ee,ie=Ce,ce=Ie,ue=$e,q=Me,J=Le,de=ge("e");return r(),y(J,{visible:t(n),"onUpdate:visible":e[5]||(e[5]=g=>P(n)?n.value=g:null),trigger:["click"],"overlay-class-name":"nc-dropdown-sort-menu nc-toolbar-dropdown"},{overlay:v(()=>{var g;return[t(s).length?(r(),c("div",{key:1,class:E([{" min-w-102":t(s).length},"py-6 pl-6 nc-filter-list max-h-[max(80vh,30rem)]"]),"data-testid":"nc-sorts-menu"},[f("div",{class:E(["sort-grid max-h-120 nc-scrollbar-md",{"pb-3 pr-3.5":(g=t(s))==null?void 0:g.length,"!pb-0":!t(p).length}]),onClick:e[2]||(e[2]=h(()=>{},["stop"]))},[(r(!0),c(R,null,Q(t(s),(l,j)=>(r(),c(R,{key:j},[b(ie,{modelValue:l.fk_column_id,"onUpdate:modelValue":[m=>l.fk_column_id=m,m=>t(x)(l,j)],class:"flex caption nc-sort-field-select min-w-40 flex-grow",columns:t(D),"is-sort":"",onClick:e[0]||(e[0]=h(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue","columns"]),b(ue,{value:l.direction,"onUpdate:value":m=>l.direction=m,class:"shrink grow-0 nc-sort-dir-select",label:o.$t("labels.operation"),"dropdown-class-name":"sort-dir-dropdown nc-dropdown-sort-dir",onClick:e[1]||(e[1]=h(()=>{},["stop"])),onSelect:m=>t(x)(l,j)},{default:v(()=>[(r(!0),c(R,null,Q(t(Oe)(a(l.fk_column_id)),(m,pe)=>(r(),y(ce,{key:pe,value:m.value},{default:v(()=>[f("span",null,B(m.text),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","label","onSelect"]),b(q,{type:"text",size:"small",class:"nc-sort-item-remove-btn !max-w-8",onClick:h(m=>t(V)(l,j),["stop"])},{default:v(()=>[(r(),y(X(t(Y).deleteListItem)))]),_:2},1032,["onClick"])],64))),128))],2),t(p).length?(r(),y(J,{key:0,visible:t(u),"onUpdate:visible":e[4]||(e[4]=l=>P(u)?u.value=l:null),trigger:["click"],"overlay-class-name":"nc-toolbar-dropdown"},{overlay:v(()=>[b(W,{"is-parent-open":t(u),onCreated:I},null,8,["is-parent-open"])]),default:v(()=>[b(q,{class:"!text-brand-500",type:"text",size:"small",onClick:e[3]||(e[3]=h(l=>u.value=!0,["stop"]))},{default:v(()=>[f("div",We,[(r(),y(X(t(Y).plus))),ye(B(o.$t("activity.addSort")),1)])]),_:1})]),_:1},8,["visible"])):N("",!0)],2)):(r(),y(W,{key:0,"is-parent-open":t(n),onCreated:I},null,8,["is-parent-open"]))]}),default:v(()=>{var g;return[f("div",{class:E({"nc-badge nc-active-btn":(g=t(s))==null?void 0:g.length})},[ne((r(),y(C,{class:"nc-sort-menu-btn nc-toolbar-btn",disabled:t(T)},{default:v(()=>{var l;return[f("div",Ke,[b(t(Ge),{class:"h-4 w-4"}),t(z)?N("",!0):(r(),c("span",Pe,B(o.$t("activity.sort")),1)),(l=t(s))!=null&&l.length?(r(),c("span",Qe,B(t(s).length),1)):N("",!0)])]}),_:1},8,["disabled"])),[[de,["c:sort"]]])],2)]}),_:1},8,["visible"])}}});const Nt=Be(qe,[["__scopeId","data-v-047ce64a"]]);export{Nt as default};
