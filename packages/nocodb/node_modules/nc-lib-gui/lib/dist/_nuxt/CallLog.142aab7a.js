import{h as D,z as J,r as w,S as Q,i as X,gm as b,e4 as Y,E as o,o as s,C as O,c as a,b as R,w as d,W as p,H as T,aj as Z,cp as $,a as n,t as i,cx as L,I as ee,d as I,J as te,K as se,G as ae,p as oe,e as ne}from"./entry.51f4e399.js";import{p as g}from"./useMetas.ba7abae7.js";import{S as ie}from"./index.c7116bd2.js";import{C as re}from"./index.680937e8.js";import{_ as pe,C as ce}from"./index.9194faf6.js";import{a as le,c as _e,_ as de}from"./index.69bbd6c7.js";import{_ as me}from"./index.09b19c06.js";import{_ as ue}from"./_plugin-vue_export-helper.c27b6911.js";import"./Input.c36cd06d.js";import"./index.c4aafe5c.js";import"./Dropdown.dc69c0a4.js";import"./useState.6010d8b6.js";import"./useRefs.154aa2be.js";import"./identity.dd5da9ba.js";import"./isSymbol.b53bd26f.js";import"./_flatRest.ff2d3d5c.js";import"./isMobile.e2e89480.js";import"./useMergedState.5e6500b1.js";import"./index.529d8b39.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./index.fbcca285.js";import"./isPlainObject.ecf52d25.js";import"./_getPrototype.ec1165af.js";import"./RightOutlined.90e8180f.js";import"./isNumeric.3f69e2aa.js";import"./LeftOutlined.3bb8aa17.js";import"./index.5e746f62.js";import"./toArray.06afb623.js";import"./antInputDirective.8ac36ea7.js";import"./useMemo.b13a9257.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./SearchOutlined.dec109ce.js";import"./FormItemContext.e001cd7c.js";import"./useBreakpoint.a91853f1.js";const E=m=>(oe("data-v-89a29d13"),m=m(),ne(),m),ye={key:1},fe={key:0},ve={key:1},xe={key:2},he={key:0},we={key:1},be=E(()=>n("span",null,[I(" For additional configuration options, please refer the documentation "),n("a",{href:"https://docs.nocodb.com/developer-resources/webhooks#call-log",target:"_blank"},"here"),I(". ")],-1)),Re={key:0},Ee={class:"w-full cursor-pointer"},Oe={class:"font-weight-medium flex"},ge={class:"flex-1"},Ce={key:0},Ae={key:0,class:"mx-1 px-2 py-1 text-white rounded text-xs bg-red-500"},Te={key:1,class:"mx-1 px-2 py-1 text-white rounded text-xs bg-green-500"},Ie={key:0},Ne={class:"font-weight-medium text-primary"},Fe={key:0,class:"mb-4"},Se={key:1},Ue={key:0,class:"nc-hook-log-request"},Ke=E(()=>n("div",{class:"nc-hook-pre-title"},"Request",-1)),Ve={class:"nc-hook-pre"},ze={key:1,class:"nc-hook-log-response"},Be=E(()=>n("div",{class:"nc-hook-pre-title"},"Response",-1)),Ge={class:"nc-hook-pre"},Me={key:2,class:"nc-hook-log-payload"},Pe=E(()=>n("div",{class:"nc-hook-pre-title"},"Payload",-1)),ke={class:"nc-hook-pre"},He={key:2},qe={key:0,class:"nc-hook-log-payload"},We=E(()=>n("div",{class:"nc-hook-pre-title"},"Payload",-1)),je={class:"nc-hook-pre"},De=D({__name:"CallLog",props:{hook:{}},setup(m){const K=m,{api:V,isLoading:z}=J(),C=w([]),A=w(),{appInfo:l}=Q(),N=w(0),u=w(1),y=w(10),F=X(()=>!(l.value.automationLogLevel===b.OFF||l.value.automationLogLevel===b.ALL&&!l.value.ee));async function S(_=u.value,r=y.value){try{_=_||1;const{list:c,pageInfo:t}=await V.dbTableWebhookLogs.list(K.hook.id,{offset:r*(_-1),limit:r});C.value=B(c),N.value=t.totalRows??0}catch(c){te.error(await se(c))}}function B(_){var r,c;for(const t of _)t!=null&&t.response&&(t.response=g(t.response)),(c=(r=t==null?void 0:t.response)==null?void 0:r.config)!=null&&c.data&&(t.response.config.data=g(t.response.config.data)),t!=null&&t.payload&&(t.payload=g(t.payload)),t!=null&&t.notification&&(t.notification=g(t.notification));return _}return Y(async()=>{F.value&&await S(u.value,y.value)}),(_,r)=>{const c=ie,t=re,G=ae,M=pe,P=ce,k=le,H=me,q=_e,W=de;return o(z)?(s(),O(c,{key:0})):(s(),a("div",ye,[R(t,{class:"!mb-[20px]","body-style":{padding:"10px"}},{default:d(()=>[o(l).automationLogLevel===o(b).OFF?(s(),a("span",fe," The NC_AUTOMATION_LOG_LEVEL is set to “OFF”, no logs will be displayed. ")):p("",!0),o(l).automationLogLevel===o(b).ERROR?(s(),a("span",ve," The NC_AUTOMATION_LOG_LEVEL is set to “ERROR”, only error logs will be displayed. ")):p("",!0),o(l).automationLogLevel===o(b).ALL?(s(),a("span",xe,[o(l).ee?(s(),a("span",he," The NC_AUTOMATION_LOG_LEVEL is set to “ALL”, both error and success logs will be displayed. ")):(s(),a("span",we," Upgrade to Enterprise Edition to show all the logs. "))])):p("",!0),be]),_:1}),o(F)?(s(),a("div",Re,[o(C).length?(s(),O(W,{key:1},{default:d(()=>[R(k,null,{default:d(()=>[R(P,{activeKey:o(A),"onUpdate:activeKey":r[0]||(r[0]=e=>T(A)?A.value=e:null),class:"nc-hook-log-collapse"},{default:d(()=>[(s(!0),a(Z,null,$(o(C),(e,j)=>(s(),O(M,{key:j},{header:d(()=>{var f,v,x,h;return[n("div",Ee,[n("div",Oe,[n("div",ge,i(e.type)+": records."+i(e.event)+"."+i(e.operation)+" ("+i(o(L)(e.created_at))+") ",1),e.type==="Email"?(s(),a("div",Ce,[e.error_message?(s(),a("div",Ae,"ERROR")):(s(),a("div",Te,"OK"))])):(s(),a("div",{key:1,class:ee(["mx-1 px-2 py-1 text-white rounded bg-red-500 text-xs",{"!bg-green-500":((f=e.response)==null?void 0:f.status)===200}])},i((v=e.response)==null?void 0:v.status)+" "+i(((x=e.response)==null?void 0:x.statusText)||(((h=e.response)==null?void 0:h.status)===200?"OK":"ERROR")),3))]),e.type==="URL"?(s(),a("div",Ie,[n("span",Ne,i(e.payload.method),1),I(" "+i(e.payload.path),1)])):p("",!0)])]}),default:d(()=>{var f,v,x,h,U;return[e.error_message?(s(),a("div",Fe,i(e.error_message),1)):p("",!0),e.type!=="Email"?(s(),a("div",Se,[(v=(f=e==null?void 0:e.response)==null?void 0:f.config)!=null&&v.headers?(s(),a("div",Ue,[Ke,n("pre",Ve,i(e.response.config.headers),1)])):p("",!0),(x=e==null?void 0:e.response)!=null&&x.headers?(s(),a("div",ze,[Be,n("pre",Ge,i(e.response.headers),1)])):p("",!0),(U=(h=e==null?void 0:e.response)==null?void 0:h.config)!=null&&U.data?(s(),a("div",Me,[Pe,n("pre",ke,i(e.response.config.data),1)])):p("",!0)])):(s(),a("div",He,[e!=null&&e.payload?(s(),a("div",qe,[We,n("pre",je,i(e.payload),1)])):p("",!0)]))]}),_:2},1024))),128))]),_:1},8,["activeKey"])]),_:1}),R(q,{class:"!bg-white text-center"},{default:d(()=>[R(H,{current:o(u),"onUpdate:current":r[1]||(r[1]=e=>T(u)?u.value=e:null),"page-size":o(y),"onUpdate:pageSize":r[2]||(r[2]=e=>T(y)?y.value=e:null),total:+o(N),"show-less-items":"",onChange:S},null,8,["current","page-size","total"])]),_:1})]),_:1})):(s(),O(G,{key:0}))])):p("",!0)]))}}});const It=ue(De,[["__scopeId","data-v-89a29d13"]]);export{It as default};
