import{ch as h,g as x,r as o,i as n,cb as y,aq as k,f as S}from"./entry.13466615.js";import{b as m}from"./useMetas.223da623.js";import{u as L}from"./useSharedView.746b4f21.js";const q=h("viewsStore",()=>{const{$api:g}=S(),d=x(),a=d.currentRoute,t=o([]),s=o(!0),c=o(!0),I=n(()=>{var e;return(e=a.value.meta)==null?void 0:e.public}),{activeTable:f}=y(m()),u=n(()=>{var e;return(e=a.value.params.viewTitle)!=null&&e.length?a.value.params.viewTitle:t.value.length?t.value[0].id:void 0}),b=n(()=>{var e,i;return!((e=a.value.params)!=null&&e.slugs)||((i=a.value.params.slugs)==null?void 0:i.length)===0?"view":a.value.params.slugs[0]==="webhook"?"webhook":a.value.params.slugs[0]==="field"?"field":a.value.params.slugs[0]==="api"?"api":a.value.params.slugs[0]==="relation"?"relation":"view"}),{sharedView:l}=L(),p=n({get(){if(l.value)return l.value;if(f.value&&u.value)return t.value.find(e=>e.id===u.value)??t.value.find(e=>e.title===u.value)},set(e){if(l.value){l.value=e;return}if(!f.value||!e)return;const i=t.value.findIndex(r=>r.id===u.value)??t.value.findIndex(r=>r.title===u.value);i!==-1&&(t.value[i]=e)}}),T=o(!1),v=m(),w=async()=>{if(v.activeTableId){s.value=!0;const e=(await g.dbView.list(v.activeTableId)).list;e&&(t.value=e.sort((i,r)=>i.order-r.order)),s.value=!1}},V=e=>{d.push({name:"index-typeOrId-projectId-index-index-viewId-viewTitle-slugs",params:{typeOrId:a.value.params.typeOrId,projectId:a.value.params.projectId,viewId:a.value.params.viewId,viewTitle:u.value,slugs:[e]}})};return k(()=>v.activeTableId,async(e,i)=>{if(e!==i){if(I.value){s.value=!1;return}s.value=!0,c.value=!0;try{await w()}catch(r){console.error(r)}finally{s.value=!1}}},{immediate:!0}),{isLockedView:n(()=>{var e;return((e=p.value)==null?void 0:e.lock_type)==="locked"}),isViewsLoading:s,isViewDataLoading:c,isPaginationLoading:T,loadViews:w,views:t,activeView:p,openedViewsTab:b,onViewsTabChange:V,sharedView:l}});export{q as u};
