import{h as ne,T as re,$ as T,r as h,aq as P,i as ie,cd as pe,f4 as V,o as p,C as _,w as L,a as d,b as K,E as o,cF as ue,D as me,F as ce,d as I,t as de,W as M,c as q,aj as Q,cp as _e,I as Y,G as j,d6 as fe,H as G,Q as ve,R as ye,L as ke,P as we,p as ge,e as xe,gE as he}from"./entry.51f4e399.js";import{_ as Ie}from"./ItemChip.14d602dd.js";import{C as be,b as Re,k as Ee}from"./index.5263eb1d.js";import{a as Le}from"./useLTARStore.3d98e502.js";import{u as Ce}from"./index.82c42c24.js";import{a as Ae}from"./useSmartsheetRowStore.aafbb4bb.js";import"./index.e760d172.js";import{I as De}from"./Input.7cb175ff.js";import{C as Se}from"./index.680937e8.js";import{_ as Te}from"./index.09b19c06.js";import{_ as Pe}from"./_plugin-vue_export-helper.c27b6911.js";import"./index.9e760c64.js";import"./cell.1732684e.js";import"./index.8b8de496.js";import"./index.b9981e09.js";import"./useMetas.ba7abae7.js";import"./useSharedView.0db5f32b.js";import"./deepCompare.d32ec333.js";import"./dataUtils.edecace3.js";import"./virtualCell.4dce1393.js";import"./SearchOutlined.dec109ce.js";import"./isPlainObject.ecf52d25.js";import"./_getPrototype.ec1165af.js";import"./TextArea.442a25cb.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.e001cd7c.js";import"./Password.d493e47a.js";import"./index.c4aafe5c.js";import"./Dropdown.dc69c0a4.js";import"./useState.6010d8b6.js";import"./useRefs.154aa2be.js";import"./identity.dd5da9ba.js";import"./isSymbol.b53bd26f.js";import"./_flatRest.ff2d3d5c.js";import"./isMobile.e2e89480.js";import"./useMergedState.5e6500b1.js";import"./index.529d8b39.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./index.fbcca285.js";import"./LeftOutlined.3bb8aa17.js";import"./RightOutlined.90e8180f.js";import"./index.5e746f62.js";import"./toArray.06afb623.js";import"./useMemo.b13a9257.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./useBreakpoint.a91853f1.js";const Ve=ve(()=>ye(()=>import("./index.a350d282.js").then(n=>n.i),["./index.a350d282.js","./entry.51f4e399.js","./entry.0f786d51.css","./TableIcon.vue.27fb2d8a.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./Modal.vue.b59a28af.js","./DeleteModal.7ab6f524.css","./useDashboard.fc1e1c09.js","./useViewData.d5cf5dca.js","./useMetas.ba7abae7.js","./virtualCell.4dce1393.js","./dataUtils.edecace3.js","./index.5263eb1d.js","./useSharedView.0db5f32b.js","./useSmartsheetStore.1784ce8b.js","./views.28a76d89.js","./index.b9981e09.js","./index.9e760c64.js","./useCopy.3e897b55.js","./useKanbanViewStore.7f9b2a7a.js","./deepCompare.d32ec333.js","./useSmartsheetRowStore.aafbb4bb.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./Icon.vue.1162f18b.js","./index.82c42c24.js","./chevron-down.b89ef60a.js","./index.af5eff28.js","./index.883a1693.css"],import.meta.url).then(n=>n.default||n)),H=n=>(ge("data-v-d7e26034"),n=n(),xe(),n),Me={class:"h-[min(max(calc(100vh_-_300px)_,350px),540px)] flex flex-col py-6"},ze={class:"flex mb-4 items-center gap-2 px-12"},Oe=H(()=>d("div",{class:"flex-1"},null,-1)),Ne={class:"flex-1 overflow-auto min-h-0 scrollbar-thin-dull px-12"},Ue={class:"flex justify-center mt-6"},$e=H(()=>d("div",{class:"text-xs text-gray-400 text-center px-2 mt-4 pb-0"},[I(" * Use "),d("kbd",null,"ALT"),I(" / "),d("kbd",null,"OPT"),I(" + "),d("kbd",null,"Click"),I(" to select multiple records ")],-1)),Be=ne({__name:"ListItems",props:{modelValue:{type:Boolean},column:{}},emits:["update:modelValue","addNewRecord"],setup(n,{emit:W}){const z=n,u=re(z,"modelValue",W),g=T(be),C=h(),{childrenExcludedList:m,loadChildrenExcludedList:A,childrenExcludedListPagination:a,relatedTableDisplayValueProp:J,link:X,relatedTableMeta:b,meta:Z,row:f}=Le(),{addLTARRef:ee,isNew:R}=Ae(),te=T(Re,h(!1)),oe=T(Ee,()=>{}),c=h(0),D=h(!1),O=async e=>{var t,r;(r=(t=m.value)==null?void 0:t.list)==null||r.splice(c.value,1),R.value?(ee(e,g==null?void 0:g.value),oe()):await X(e),D.value?R.value||A():u.value=!1};P(u,(e,t)=>{e&&!t&&(a.query="",a.page=1,A(),c.value=0)});const x=h(!1),ae=ie(()=>{var v,y,k,w;if(R.value)return{};const e=(v=g==null?void 0:g.value)==null?void 0:v.colOptions,t=(k=(y=b==null?void 0:b.value)==null?void 0:y.columns)==null?void 0:k.find(i=>{if(i.uidt!==pe.LinkToAnotherRecord)return!1;const l=i==null?void 0:i.colOptions;return(l==null?void 0:l.fk_related_model_id)!==Z.value.id?!1:e.type===V.MANY_TO_MANY&&(l==null?void 0:l.type)===V.MANY_TO_MANY?e.fk_parent_column_id===l.fk_child_column_id&&e.fk_child_column_id===l.fk_parent_column_id:e.fk_parent_column_id===l.fk_parent_column_id&&e.fk_child_column_id===l.fk_child_column_id});if(!t)return{};const r=t==null?void 0:t.colOptions;return r?r.type===V.BELONGS_TO?{[t.title]:(w=f==null?void 0:f.value)==null?void 0:w.row}:{[t.title]:(f==null?void 0:f.value)&&[f.value.row]}:{}});P(x,e=>{!e&&!R.value&&(u.value=!1)}),Ce(u,e=>{var t,r,v,y,k,w;switch(e.key){case"ArrowLeft":e.stopPropagation(),e.preventDefault(),a.page>1&&a.page--;break;case"ArrowRight":e.stopPropagation(),e.preventDefault(),(t=m.value)!=null&&t.pageInfo&&a.page<(m.value.pageInfo.totalRows||1)/a.size&&a.page++;break;case"ArrowUp":c.value=Math.max(0,c.value-1),e.stopPropagation(),e.preventDefault();break;case"ArrowDown":c.value=Math.min(((v=(r=m.value)==null?void 0:r.list)==null?void 0:v.length)-1,c.value+1),e.stopPropagation(),e.preventDefault();break;case"Enter":{const i=(k=(y=m.value)==null?void 0:y.list)==null?void 0:k[c.value];i&&(O(i),e.stopPropagation(),e.preventDefault())}break;default:((w=C.value)==null?void 0:w.$el)&&!he()&&C.value.$el.focus()}});const le=e=>{var t;(t=e==null?void 0:e.$el)==null||t.scrollIntoView({block:"nearest",inline:"nearest"})},N=e=>{D.value=e.altKey},U=e=>{D.value=e.altKey};return P(u,e=>{e?(document.addEventListener("keydown",N),document.addEventListener("keyup",U)):(document.removeEventListener("keydown",N),document.removeEventListener("keyup",U))}),(e,t)=>{const r=De,v=ke,y=Ie,k=Se,w=Te,i=j,l=Ve,se=we;return p(),_(se,{visible:o(u),"onUpdate:visible":t[6]||(t[6]=E=>G(u)?u.value=E:null),class:Y({active:o(u)}),footer:null,title:e.$t("activity.linkRecord"),"body-style":{padding:0},"wrap-class-name":"nc-modal-link-record"},{default:L(()=>{var E,$,B,F;return[d("div",Me,[d("div",ze,[K(r,{ref_key:"filterQueryRef",ref:C,value:o(a).query,"onUpdate:value":t[0]||(t[0]=s=>o(a).query=s),placeholder:e.$t("placeholder.filterQuery"),class:"max-w-[200px]",size:"small",onKeydownCapture:t[1]||(t[1]=ue(()=>{},["stop"]))},null,8,["value","placeholder"]),Oe,(p(),_(me(o(ce).reload),{class:"cursor-pointer text-gray-500 nc-reload",onClick:o(A)},null,8,["onClick"])),o(te)?M("",!0):(p(),_(v,{key:0,type:"primary",size:"small",onClick:t[2]||(t[2]=s=>x.value=!0)},{default:L(()=>[I(de(e.$t("activity.addNewRecord")),1)]),_:1}))]),($=(E=o(m))==null?void 0:E.pageInfo)!=null&&$.totalRows?(p(),q(Q,{key:0},[d("div",Ne,[(p(!0),q(Q,null,_e(((B=o(m))==null?void 0:B.list)??[],(s,S)=>(p(),_(k,{key:S,ref_for:!0,ref:o(c)===S?le:null,class:Y(["nc-nested-list-item !my-2 cursor-pointer !hover:bg-gray-200/50 hover:shadow-md group",{"nc-selected-row":o(c)===S}]),onClick:Fe=>O(s)},{default:L(()=>[K(y,{item:s,value:s[o(J)],column:z.column,"show-unlink-button":!1,border:!1,readonly:""},null,8,["item","value","column"])]),_:2},1032,["class","onClick"]))),128))]),d("div",Ue,[(F=o(m))!=null&&F.pageInfo?(p(),_(w,{key:0,current:o(a).page,"onUpdate:current":t[3]||(t[3]=s=>o(a).page=s),"page-size":o(a).size,"onUpdate:pageSize":t[4]||(t[4]=s=>o(a).size=s),class:"mt-2 !text-xs",size:"small",total:+o(m).pageInfo.totalRows,"show-less-items":""},null,8,["current","page-size","total"])):M("",!0)]),$e],64)):(p(),_(i,{key:1,class:"my-10",image:o(j).PRESENTED_IMAGE_SIMPLE},null,8,["image"])),(p(),_(fe,null,{default:L(()=>[o(x)?(p(),_(l,{key:0,modelValue:o(x),"onUpdate:modelValue":t[5]||(t[5]=s=>G(x)?x.value=s:null),meta:o(b),row:{row:{},oldRow:{},rowMeta:{new:!0}},state:o(ae),"use-meta-fields":""},null,8,["modelValue","meta","state"])):M("",!0)]),_:1}))])]}),_:1},8,["visible","class","title"])}}});const Ot=Pe(Be,[["__scopeId","data-v-d7e26034"]]);export{Ot as default};
