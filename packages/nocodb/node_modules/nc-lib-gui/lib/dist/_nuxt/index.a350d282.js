import{z as Je,A as Ke,r as x,cb as Qe,$ as be,cg as $e,i as Ve,cd as Ie,cq as le,J as W,fb as he,f9 as ke,K as Ze,f as Xe,h as Ae,c4 as et,b4 as tt,cf as Be,cI as ot,o as n,c as _,a as k,b as f,b5 as at,E as e,aj as _e,d as U,t as D,W as A,w as m,C as d,D as re,F as ie,aV as ce,H as He,_ as Ye,M as nt,N as st,p as qe,e as Ge,cp as De,al as Ue,g as lt,Z as xe,gA as rt,dg as je,eI as Ne,aq as it,T as ct,k as ut,P as Se,I as ge,f3 as pe,bN as Fe,eW as Pe,Q as we,R as fe,L as dt}from"./entry.51f4e399.js";import{_ as mt}from"./TableIcon.vue.27fb2d8a.js";import{_ as pt}from"./Button.vue.793bcd1d.js";import{_ as vt}from"./Modal.vue.b59a28af.js";import{u as _t}from"./useDashboard.fc1e1c09.js";import{u as wt}from"./useViewData.d5cf5dca.js";import{A as ft,w as Ce,q as yt,g as ht,M as xt,c as gt,x as bt,F as Rt}from"./index.5263eb1d.js";import{u as kt}from"./useCopy.3e897b55.js";import{u as Le}from"./index.9e760c64.js";import{e as ve,p as $t,r as Ct}from"./dataUtils.edecace3.js";import{u as It}from"./index.b9981e09.js";import{a as St}from"./useKanbanViewStore.7f9b2a7a.js";import{a as Vt,f as Dt,u as At}from"./useMetas.ba7abae7.js";import{u as Lt,a as Et}from"./useSmartsheetRowStore.aafbb4bb.js";import{u as Ot}from"./useSharedView.0db5f32b.js";import{a as Mt,u as Tt}from"./useSmartsheetStore.1784ce8b.js";import{D as Ut}from"./index.252dc7b4.js";import{_ as Ee}from"./_plugin-vue_export-helper.c27b6911.js";import{_ as jt}from"./Icon.vue.1162f18b.js";import{u as Nt}from"./index.82c42c24.js";import{e as ze}from"./virtualCell.4dce1393.js";import{M as Ft}from"./chevron-down.b89ef60a.js";import{S as Pt}from"./index.0db47614.js";import{_ as zt}from"./index.af5eff28.js";const[Kt,Bt]=It((o,r)=>{const{loadKanbanData:$,addOrEditStackRow:j}=St(),{$e:c,$state:ee,$api:C}=Xe(),{api:u,isLoading:J,error:F}=Je(),{t:ue}=Ke(),I=x(!0),te=x([]),O=x(""),L=x(!0),N=x(0),K=x(new Set),{project:y}=Qe(Vt()),B=Lt(o,r),g=be(ft,x()),{sharedView:S}=Ot(),{addUndo:Q,clone:oe,defineViewScope:ae}=Dt(),l=be(Ce,$e()),{isUIAllowed:p}=Le(),b=Ve(()=>{var i,t,s,w;if((i=r==null?void 0:r.value)!=null&&i.row){const V=(s=(t=o==null?void 0:o.value)==null?void 0:t.columns)==null?void 0:s.find(E=>E.pv);if(!V)return;const v=(w=r.value.row)==null?void 0:w[V.title],Y=V.uidt;if(Y===Ie.Date)return(/^\d+$/.test(v)?le(+v):le(v)).format("YYYY-MM-DD");if(Y===Ie.DateTime)return(/^\d+$/.test(v)?le(+v):le(v)).format("YYYY-MM-DD HH:mm");if(Y===Ie.Time){let E=le(v);return E.isValid()||(E=le(v,"HH:mm:ss")),E.isValid()||(E=le(`1999-01-01 ${v}`)),E.isValid()?E.format("HH:mm:ss"):v}return v}}),ne=Ve(()=>ve(r.value.row,o.value.columns)),H=async()=>{var t,s;if(!p("commentList")||!r.value)return;const i=ve(r.value.row,o.value.columns);i&&(te.value=((s=(t=(await u.utils.commentList({row_id:i,fk_model_id:o.value.id,comments_only:I.value})).list)==null?void 0:t.reverse)==null?void 0:s.call(t))||[])};return{...B,commentsOnly:I,loadCommentsAndLogs:H,commentsAndLogs:te,isCommentsLoading:J,commentsError:F,saveComment:async()=>{var i;try{if(!r.value||!O.value)return;const t=ve(r.value.row,o.value.columns);if(!t)return;await u.utils.commentRow({fk_model_id:(i=o.value)==null?void 0:i.id,row_id:t,description:`The following comment has been created: ${O.value}`}),O.value="",await H()}catch(t){W.error(t.message)}c("a:row-expand:comment")},comment:O,isYou:i=>{var t,s;return((s=(t=ee.user)==null?void 0:t.value)==null?void 0:s.email)===i},commentsDrawer:L,row:r,displayValue:b,save:async(i={},t=!1)=>{var w,V,v,Y,E,ye;let s;try{const se=((w=r.value.rowMeta)==null?void 0:w.new)??!1;if(se){const{getMeta:X}=At(),{missingRequiredColumns:T,insertObj:q}=await $t({meta:o.value,ltarState:i,getMeta:X,row:r.value.row,throwError:!0});if(T.size)return;if(s=await C.dbTableRow.create("noco",y.value.id,o.value.id,q),Object.assign(r.value,{row:s,rowMeta:{},oldRow:{...s}}),!t){const P=ve(s,(V=o.value)==null?void 0:V.columns),z=Ct(r.value.row,(v=o.value)==null?void 0:v.columns);Q({redo:{fn:async a=>{var G;await C.dbTableRow.create("noco",y.value.id,o.value.id,{...z,...a}),((G=g.value)==null?void 0:G.type)===he.KANBAN&&await $(),l==null||l.trigger()},args:[oe(q)]},undo:{fn:async a=>{var R,Me,Te;const G=await C.dbViewRow.delete("noco",y.value.id,(R=o.value)==null?void 0:R.id,(Me=g.value)==null?void 0:Me.id,encodeURIComponent(a));if(G.message)throw new Error(G.message);((Te=g.value)==null?void 0:Te.type)===he.KANBAN&&await $(),l==null||l.trigger()},args:[P]},scope:ae({view:g.value})})}}else{const X=[...K.value].reduce((T,q)=>(T[q]=r.value.row[q],T),{});if(Object.keys(X).length){const T=ve(r.value.row,o.value.columns);if(!T)return W.info("Update not allowed for table which doesn't have primary Key");if(await C.dbTableRow.update(ke,y.value.id,o.value.id,encodeURIComponent(T),X),!t){const q=[...K.value].reduce((P,z)=>(P[z]=r.value.oldRow[z],P),{});Q({redo:{fn:async(P,z)=>{var a;await C.dbTableRow.update(ke,y.value.id,o.value.id,encodeURIComponent(P),z),((a=g.value)==null?void 0:a.type)===he.KANBAN&&await $(),l==null||l.trigger()},args:[T,oe(X)]},undo:{fn:async(P,z)=>{var a;await C.dbTableRow.update(ke,y.value.id,o.value.id,encodeURIComponent(P),z),((a=g.value)==null?void 0:a.type)===he.KANBAN&&await $(),l==null||l.trigger()},args:[T,oe(q)]},scope:ae({view:g.value})})}L.value&&await H()}else{W.info(ue("msg.info.noColumnsToUpdate"));return}}((Y=g.value)==null?void 0:Y.type)===he.KANBAN&&j(r.value,se);const Re=b.value&&((E=b.value)==null?void 0:E.length)>20?`${(ye=b.value)==null?void 0:ye.substring(0,20)}...`:b.value;W.success(`${Re||"Row"} updated successfully.`),K.value=new Set}catch(se){W.error(`${ue("msg.error.rowUpdateFailed")}: ${await Ze(se)}`)}return c("a:row-expand:add"),s},changedColumns:K,loadRow:async i=>{var s,w,V;const t=await C.dbTableRow.read(ke,((s=y==null?void 0:y.value)==null?void 0:s.id)||((V=(w=S.value)==null?void 0:w.view)==null?void 0:V.project_id),o.value.id,encodeURIComponent(i??ve(r.value.row,o.value.columns)),{getHiddenColumn:!0});Object.assign(r.value,{row:t,oldRow:{...t},rowMeta:{}})},primaryKey:ne,saveRowAndStay:N,updateComment:async(i,t)=>await C.utils.commentUpdate(i,t)}},"expanded-form-store");function Ht(){const o=Bt();if(o==null)throw new Error("Please call `useExpandedFormStore` on the appropriate parent component");return o}const Oe=o=>(qe("data-v-8e1edf13"),o=o(),Ge(),o),Yt={class:"flex p-2 items-center gap-2 p-4 nc-expanded-form-header"},qt={class:"text-lg font-weight-medium flex items-center gap-1 mb-0 min-w-0 overflow-x-hidden truncate"},Gt=Oe(()=>k("div",{class:"flex-1"},null,-1)),Wt=Oe(()=>k("div",{class:"text-center w-full"},"Copy record URL",-1)),Jt={class:"text-center w-full"},Qt={class:"py-2 flex gap-2 items-center"},Zt={class:"py-2 flex gap-2 a"},Xt={class:"py-2 flex gap-2 items-center"},eo={class:"py-2 flex gap-2 items-center"},to=Oe(()=>k("div",{class:"p-4"},[k("div",{class:"prose-xl font-bold self-center"},"Delete row ?"),k("div",{class:"mt-4"},"Are you sure you want to delete this row?")],-1)),oo={class:"flex flex-row gap-x-2 mt-1 pt-1.5 justify-end p-4"},ao="#1890ff",no=Ae({__name:"Header",props:{view:{}},emits:["cancel","duplicateRow"],setup(o,{emit:r}){const $=o,j=et(),{meta:c,isSqlView:ee}=Mt(),{commentsDrawer:C,displayValue:u,primaryKey:J,save:F,loadRow:ue}=Ht(),{isNew:I,syncLTARRefs:te,state:O}=Et(),{isUIAllowed:L}=Le(),N=be(Ce,$e()),K=async()=>{if(I.value){const l=await F(O.value);await te(l),N==null||N.trigger()}else await F(),N==null||N.trigger()},{dashboardUrl:y}=_t(),{copy:B}=kt(),g=()=>{var l;B(encodeURI(`${y==null?void 0:y.value}#/${j.params.typeOrId}/${j.params.projectId}/${(l=c.value)==null?void 0:l.id}${$.view?`/${$.view.title}`:""}?rowId=${J.value}`)),W.success("Copied to clipboard")};tt(document,"keydown",async l=>{if(Be()?l.metaKey:l.ctrlKey)switch(l.key){case"Enter":L("tableRowUpdate")&&await K()}});const S=x(!1),{deleteRowById:Q}=wt(c,x($.view)),oe=()=>{S.value=!0},ae=async()=>{S.value=!1,await Q(J.value),N.trigger(),r("cancel"),W.success("Row deleted")};return(l,p)=>{const b=mt,ne=Ye,H=pt,Z=nt,de=st,h=Ut,me=vt,M=ot("e");return n(),_("div",Yt,[k("h5",qt,[f(b,{style:at({color:ao}),meta:e(c),class:"mx-2"},null,8,["style","meta"]),e(c)?(n(),_(_e,{key:0},[U(D(e(c).title),1)],64)):A("",!0),e(u)?(n(),_(_e,{key:1},[U(": "+D(e(u)),1)],64)):A("",!0)]),Gt,f(ne,{placement:"bottom"},{title:m(()=>[Wt]),default:m(()=>[e(I)?A("",!0):(n(),d(re(e(ie).link),{key:0,class:"nc-icon-transition cursor-pointer select-none text-gray-500 mx-1 nc-copy-row-url min-w-4",onClick:g}))]),_:1}),e(ee)?A("",!0):(n(),d(ne,{key:0,placement:"bottom"},{title:m(()=>[k("div",Jt,D(l.$t("activity.toggleCommentsDraw")),1)]),default:m(()=>[e(L)("commentList")&&!e(I)?ce((n(),d(re(e(ie).comment),{key:0,class:"nc-icon-transition cursor-pointer select-none nc-toggle-comments text-gray-500 mx-1 min-w-4",onClick:p[0]||(p[0]=i=>C.value=!e(C))},null,512)),[[M,["c:row-expand:comment-toggle"]]]):A("",!0)]),_:1})),f(H,{class:"nc-expand-form-save-btn !w-[60px]",type:"primary",size:"small",disabled:!e(L)("tableRowUpdate"),onClick:K},{default:m(()=>[U(D(l.$t("general.save")),1)]),_:1},8,["disabled"]),f(h,null,{overlay:m(()=>[f(de,null,{default:m(()=>[e(I)?A("",!0):(n(),d(Z,{key:0,onClick:p[1]||(p[1]=i=>e(ue)())},{default:m(()=>[ce((n(),_("div",Qt,[(n(),d(re(e(ie).reload),{class:"nc-icon-transition cursor-pointer select-none text-gray-500 mx-1 min-w-4 text-primary"})),U(" "+D(l.$t("general.reload")),1)])),[[M,["c:row-expand:reload"]]])]),_:1})),e(L)("xcDatatableEditable")&&!e(I)?(n(),d(Z,{key:1,onClick:p[2]||(p[2]=i=>!e(I)&&r("duplicateRow"))},{default:m(()=>[ce((n(),_("div",Zt,[(n(),d(re(e(ie).copy),{class:"nc-icon-transition cursor-pointer select-none nc-duplicate-row text-gray-500 mx-1 min-w-4 text-primary"})),U(" "+D(l.$t("activity.duplicateRow")),1)])),[[M,["c:row-expand:duplicate"]]])]),_:1})):A("",!0),e(L)("xcDatatableEditable")&&!e(I)?(n(),d(Z,{key:2,onClick:p[3]||(p[3]=i=>!e(I)&&oe())},{default:m(()=>[ce((n(),_("div",Xt,[(n(),d(re(e(ie).delete),{class:"nc-icon-transition cursor-pointer select-none nc-delete-row text-gray-500 mx-1 min-w-4 text-primary"})),U(" "+D(l.$t("activity.deleteRow")),1)])),[[M,["c:row-expand:delete"]]])]),_:1})):A("",!0),f(Z,{onClick:p[4]||(p[4]=i=>r("cancel"))},{default:m(()=>[ce((n(),_("div",eo,[(n(),d(re(e(ie).close),{class:"nc-icon-transition cursor-pointer select-none nc-delete-row text-gray-500 mx-1 min-w-4 text-primary"})),U(" "+D(l.$t("general.close")),1)])),[[M,["c:row-expand:delete"]]])]),_:1})]),_:1})]),default:m(()=>[(n(),d(re(e(ie).threeDotVertical),{class:"nc-icon-transition nc-expand-form-more-actions hover:cursor-pointer"}))]),_:1}),f(me,{visible:e(S),"onUpdate:visible":p[6]||(p[6]=i=>He(S)?S.value=i:null),class:"!w-[25rem]"},{default:m(()=>[to,k("div",oo,[f(H,{type:"secondary",onClick:p[5]||(p[5]=i=>S.value=!1)},{default:m(()=>[U(D(l.$t("general.cancel")),1)]),_:1}),f(H,{onClick:ae},{default:m(()=>[U(D(l.$t("general.confirm")),1)]),_:1})])]),_:1},8,["visible"])])}}});const so=Ee(no,[["__scopeId","data-v-8e1edf13"]]),lo={class:"nc-shortcut-label-wrapper"},ro=Ae({__name:"ShortcutLabel",props:{keys:{}},setup(o){const r=o,$=Be(),j=c=>{if($)switch(c.toLowerCase()){case"alt":return"⌥";case"shift":return"⇧";case"meta":return"⌘";case"control":case"ctrl":return"⌃";case"enter":return"↩"}switch(c.toLowerCase()){case"arrowup":return"↑";case"arrowdown":return"↓";case"arrowleft":return"←";case"arrowright":return"→"}return c};return(c,ee)=>(n(),_("div",lo,[(n(!0),_(_e,null,De(r.keys,(C,u)=>(n(),_("div",{key:u,class:"nc-shortcut-label"},[k("span",null,D(j(C)),1)]))),128))]))}});const io=Ee(ro,[["__scopeId","data-v-11bd7968"]]),co=we(()=>fe(()=>import("./VirtualCell.44092918.js"),["./VirtualCell.44092918.js","./entry.51f4e399.js","./entry.0f786d51.css","./EditOrAddProvider.vue.09b12d8b.js","./Icon.vue.1162f18b.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./useBetaFeatureToggle.5dbba600.js","./index.5263eb1d.js","./index.e5ddde08.js","./validation.6db726f3.js","./useMetas.ba7abae7.js","./index.de92142d.js","./FormItem.cda40628.js","./identity.dd5da9ba.js","./_getPrototype.ec1165af.js","./Col.88cfabc0.js","./responsiveObserve.501a6cf9.js","./toArray.06afb623.js","./FormItemContext.e001cd7c.js","./useSize.3b3f469f.js","./_flatRest.ff2d3d5c.js","./isPlainObject.ecf52d25.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.dec109ce.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./index.0d6d8ba8.js","./Checkbox.a529f1e6.js","./createForOfIteratorHelper.12419aa5.js","./index.5e746f62.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./EditOrAddProvider.44ca9c5b.css","./virtualCell.4dce1393.js","./index.9e760c64.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./VirtualCell.23f24363.css"],import.meta.url).then(o=>o.default||o)),uo=we(()=>fe(()=>import("./Cell.aa14ce01.js"),["./Cell.aa14ce01.js","./entry.51f4e399.js","./entry.0f786d51.css","./CellIcon.8a6080fd.js","./index.5263eb1d.js","./cell.1732684e.js","./useMetas.ba7abae7.js","./EditOrAddProvider.vue.09b12d8b.js","./Icon.vue.1162f18b.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./useBetaFeatureToggle.5dbba600.js","./index.e5ddde08.js","./validation.6db726f3.js","./index.de92142d.js","./FormItem.cda40628.js","./identity.dd5da9ba.js","./_getPrototype.ec1165af.js","./Col.88cfabc0.js","./responsiveObserve.501a6cf9.js","./toArray.06afb623.js","./FormItemContext.e001cd7c.js","./useSize.3b3f469f.js","./_flatRest.ff2d3d5c.js","./isPlainObject.ecf52d25.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.dec109ce.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./index.0d6d8ba8.js","./Checkbox.a529f1e6.js","./createForOfIteratorHelper.12419aa5.js","./index.5e746f62.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./EditOrAddProvider.44ca9c5b.css","./index.9e760c64.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./Cell.c77dfd55.css"],import.meta.url).then(o=>o.default||o)),mo=we(()=>fe(()=>import("./VirtualCell.4b63c3ca.js"),["./VirtualCell.4b63c3ca.js","./entry.51f4e399.js","./entry.0f786d51.css","./index.5263eb1d.js","./virtualCell.4dce1393.js"],import.meta.url).then(o=>o.default||o)),po=we(()=>fe(()=>import("./Cell.4f83cd62.js"),["./Cell.4f83cd62.js","./entry.51f4e399.js","./entry.0f786d51.css","./index.5263eb1d.js","./cell.1732684e.js","./useMetas.ba7abae7.js","./useSmartsheetRowStore.aafbb4bb.js","./deepCompare.d32ec333.js","./dataUtils.edecace3.js","./virtualCell.4dce1393.js","./index.b9981e09.js","./_plugin-vue_export-helper.c27b6911.js","./Cell.69966cf7.css"],import.meta.url).then(o=>o.default||o)),vo=we(()=>fe(()=>import("./DivDataCell.806c1c42.js"),["./DivDataCell.806c1c42.js","./index.5263eb1d.js","./entry.51f4e399.js","./entry.0f786d51.css"],import.meta.url).then(o=>o.default||o)),_o=we(()=>fe(()=>import("./Comments.d67e1975.js"),["./Comments.d67e1975.js","./index.9e760c64.js","./entry.51f4e399.js","./entry.0f786d51.css","./useCopy.3e897b55.js","./index.c7116bd2.js","./Input.c36cd06d.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./FormItemContext.e001cd7c.js","./SearchOutlined.dec109ce.js","./isPlainObject.ecf52d25.js","./_getPrototype.ec1165af.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./index.0d6d8ba8.js","./Checkbox.a529f1e6.js","./createForOfIteratorHelper.12419aa5.js","./_plugin-vue_export-helper.c27b6911.js","./TableIcon.vue.27fb2d8a.js","./Button.vue.793bcd1d.js","./index.0db47614.js","./debounce.7d32c110.js","./toNumber.9dc54e53.js","./isSymbol.b53bd26f.js","./Button.95d2a5ed.css","./Modal.vue.b59a28af.js","./DeleteModal.7ab6f524.css","./useDashboard.fc1e1c09.js","./useViewData.d5cf5dca.js","./useMetas.ba7abae7.js","./virtualCell.4dce1393.js","./dataUtils.edecace3.js","./index.5263eb1d.js","./useSharedView.0db5f32b.js","./useSmartsheetStore.1784ce8b.js","./views.28a76d89.js","./index.b9981e09.js","./useKanbanViewStore.7f9b2a7a.js","./deepCompare.d32ec333.js","./useSmartsheetRowStore.aafbb4bb.js","./Icon.vue.1162f18b.js","./index.82c42c24.js","./chevron-down.b89ef60a.js","./index.af5eff28.js","./Comments.6e2fdfd6.css"],import.meta.url).then(o=>o.default||o)),We=o=>(qe("data-v-94859624"),o=o(),Ge(),o),wo={class:"flex h-full nc-form-wrapper items-stretch min-h-[max(70vh,100%)]"},fo={class:"flex-1 overflow-auto scrollbar-thin-dull nc-form-fields-container relative"},yo={class:"w-[500px] mx-auto"},ho={key:0,class:"flex items-center justify-center h-[100px]"},xo=["data-testid"],go={key:2,class:"my-4"},bo={class:"flex items-center py-4"},Ro=We(()=>k("div",{class:"flex-grow h-px mr-1 bg-gray-100"},null,-1)),ko=We(()=>k("div",{class:"flex-grow ml-1 h-px bg-gray-100"},null,-1)),$o=["data-testid"],Co={class:"h-full"},Io={name:"ExpandedForm"},So=Ae({...Io,props:{modelValue:{type:Boolean},row:{},state:{},meta:{},loadRow:{type:Boolean},useMetaFields:{type:Boolean},rowId:{},view:{},showNextPrevIcons:{type:Boolean},firstRow:{type:Boolean},lastRow:{type:Boolean}},emits:["update:modelValue","cancel","next","prev"],async setup(o,{emit:r}){var i;let $,j;const c=o,ee=x(0),{t:C}=Ke(),u=x(c.row),J=Ue(c,"state"),F=Ue(c,"meta"),ue=lt(),{isUIAllowed:I}=Le();xe(yt,void 0);const te=rt(Rt,t=>c.useMetaFields?(F.value.columns??[]).filter(s=>!je(s)):(t==null?void 0:t.value)??[]),O=Ve(()=>(F.value.columns??[]).filter(t=>{var s;return!((s=te.value)!=null&&s.includes(t))}).filter(t=>!je(t))),L=x(!1),N=()=>{L.value=!L.value},K=be(ht,x(!1));xe(xt,F);const{commentsDrawer:y,changedColumns:B,state:g,isNew:S,loadRow:Q,saveRowAndStay:oe,syncLTARRefs:ae,save:l}=Kt(F,u),p=x(!1);if(c.loadRow&&([$,j]=Ne(()=>Q()),await $,j()),c.rowId)try{[$,j]=Ne(()=>Q(c.rowId)),await $,j()}catch(t){if(((i=t.response)==null?void 0:i.status)===404)W.error("Record not found"),ue.replace({query:{}});else throw t}Tt(x({}),F),xe(gt,x(!0)),it(J,()=>{J.value?g.value=J.value:g.value={}},{immediate:!0});const b=ct(c,"modelValue",r,{defaultValue:!1}),ne=()=>{var t,s;(s=(t=u.value)==null?void 0:t.rowMeta)!=null&&s.new&&r("cancel"),b.value=!1},H=()=>{p.value=!0;const t={...u.value.row};delete t.ncRecordId;const s=Object.assign({},{row:t,oldRow:{},rowMeta:{new:!0}});setTimeout(async()=>{u.value=s,p.value=!1,W.success(C("msg.success.rowDuplicatedWithoutSavedYet"))},500)},Z=async()=>{B.value.size>0?await Se.confirm({title:"Do you want to save the changes?",okText:"Save",cancelText:"Discard",onOk:async()=>{await l(),r("next")},onCancel:()=>{r("next")}}):r("next")},de=be(Ce,$e()),h=$e();if(h.on(()=>{de==null||de.trigger(!1),!S.value&&Q()}),xe(Ce,h),K.value)for(const[t,s]of Object.entries(u.value.row))s&&B.value.add(t);xe(bt,b);const me=x();ut(()=>{setTimeout(()=>{var t,s,w;(w=(s=(t=me.value)==null?void 0:t.$el)==null?void 0:s.querySelector("input,select,textarea"))==null||w.focus()},300)});const M=()=>{setTimeout(async()=>{u.value={row:{},oldRow:{},rowMeta:{new:!0}},g.value={},ee.value++,b.value=!0},500)};return Nt(b,async t=>{var s,w,V;if(t.altKey)if(t.key==="ArrowLeft")t.stopPropagation(),r("prev");else if(t.key==="ArrowRight")t.stopPropagation(),Z();else if(t.code==="KeyS"){if((s=document.activeElement)==null||s.blur(),t.stopPropagation(),S.value){const v=await l(g.value);await ae(v),h==null||h.trigger(null)}else await l(),h==null||h.trigger(null);oe.value||ne()}else t.code==="KeyN"&&((V=(w=document.activeElement)==null?void 0:w.blur)==null||V.call(w),B.value.size>0?await Se.confirm({title:"Do you want to save the changes?",okText:"Save",cancelText:"Discard",onOk:async()=>{await l(),h==null||h.trigger(null),M()},onCancel:()=>{M()}}):S.value?await Se.confirm({title:"Do you want to save the record?",okText:"Save",cancelText:"Discard",onOk:async()=>{const v=await l(g.value);await ae(v),h==null||h.trigger(null),M()},onCancel:()=>{M()}}):M())},{immediate:!0}),(t,s)=>{const w=so,V=io,v=jt,Y=Ye,E=Pt,ye=co,se=uo,Re=mo,X=po,T=vo,q=dt,P=_o,z=zt;return n(),d(z,{visible:e(b),"onUpdate:visible":s[1]||(s[1]=a=>He(b)?b.value=a:null),footer:null,width:e(y)&&e(I)("commentList")?"min(90vw,900px)":"min(90vw,700px)","body-style":{padding:0,display:"flex","flex-direction":"column"},closable:!1,class:ge(["nc-drawer-expanded-form",{active:e(b)}])},{default:m(()=>[f(w,{view:c.view,onCancel:ne,onDuplicateRow:H},null,8,["view"]),(n(),_("div",{key:e(ee),class:"!bg-gray-50 rounded flex-1"},[k("div",wo,[k("div",fo,[c.showNextPrevIcons?(n(),_(_e,{key:0},[c.firstRow?A("",!0):(n(),d(Y,{key:0,placement:"bottom"},{title:m(()=>[U(D(t.$t("labels.prevRow"))+" ",1),f(V,{class:"justify-center",keys:["Alt","←"]})]),default:m(()=>[f(v,{icon:"chevronLeft",class:"cursor-pointer nc-prev-arrow",onClick:s[0]||(s[0]=a=>t.$emit("prev"))})]),_:1})),c.lastRow?A("",!0):(n(),d(Y,{key:1,placement:"bottom"},{title:m(()=>[U(D(t.$t("labels.nextRow"))+" ",1),f(V,{class:"justify-center",keys:["Alt","→"]})]),default:m(()=>[f(v,{icon:"chevronRight",class:"cursor-pointer nc-next-arrow",onClick:Z})]),_:1}))],64)):A("",!0),k("div",yo,[e(p)?(n(),_("div",ho,[f(E,{size:"large"})])):(n(!0),_(_e,{key:1},De(e(te),(a,G)=>ce((n(),_("div",{key:a.title,class:ge(["mt-2 py-2",`nc-expand-col-${a.title}`]),"data-testid":`nc-expand-col-${a.title}`},[e(pe)(a)?(n(),d(ye,{key:0,column:a},null,8,["column"])):(n(),d(se,{key:1,column:a},null,8,["column"])),a.title?(n(),d(T,{key:2,ref_for:!0,ref:G?null:R=>me.value=R,class:"!bg-white rounded px-1 min-h-[35px] flex items-center mt-2 relative"},{default:m(()=>[e(pe)(a)?(n(),d(Re,{key:0,modelValue:e(u).row[a.title],"onUpdate:modelValue":R=>e(u).row[a.title]=R,row:e(u),column:a},null,8,["modelValue","onUpdate:modelValue","row","column"])):(n(),d(X,{key:1,modelValue:e(u).row[a.title],"onUpdate:modelValue":[R=>e(u).row[a.title]=R,R=>e(B).add(a.title)],column:a,"edit-enabled":!0,active:!0},null,8,["modelValue","onUpdate:modelValue","column"]))]),_:2},1536)):A("",!0)],10,xo)),[[Fe,("isFormula"in t?t.isFormula:e(ze))(a)||!e(pe)(a)||!e(S)||e(Pe)(a)]])),128)),e(O).length>0?(n(),_("div",go,[k("div",bo,[Ro,f(q,{class:"!rounded-md flex items-center flex-shrink-1 focus:!border-[#d9d9d9] focus:!text-gray-500 hover:text-blue",onClick:N},{default:m(()=>[U(D(e(L)?`Hide ${e(O).length} hidden`:`Show ${e(O).length} hidden`)+" "+D(e(O).length>1?"fields":"field")+" ",1),f(e(Ft),{class:ge(["ml-1",e(L)?"transform rotate-180":""])},null,8,["class"])]),_:1}),ko]),(n(!0),_(_e,null,De(e(O),(a,G)=>ce((n(),_("div",{key:a.title,class:ge(["mt-2 py-2",`nc-expand-col-${a.title}`]),"data-testid":`nc-expand-col-${a.title}`},[e(pe)(a)?(n(),d(ye,{key:0,column:a},null,8,["column"])):(n(),d(se,{key:1,column:a},null,8,["column"])),f(T,{ref_for:!0,ref:G?null:R=>me.value=R,class:"!bg-white rounded px-1 min-h-[35px] flex items-center mt-2 relative"},{default:m(()=>[e(pe)(a)?(n(),d(Re,{key:0,modelValue:e(u).row[a.title],"onUpdate:modelValue":R=>e(u).row[a.title]=R,row:e(u),column:a},null,8,["modelValue","onUpdate:modelValue","row","column"])):(n(),d(X,{key:1,modelValue:e(u).row[a.title],"onUpdate:modelValue":[R=>e(u).row[a.title]=R,R=>e(B).add(a.title)],column:a,"edit-enabled":!0,active:!0},null,8,["modelValue","onUpdate:modelValue","column"]))]),_:2},1536)],10,$o)),[[Fe,(("isFormula"in t?t.isFormula:e(ze))(a)||!e(pe)(a)||!e(S)||e(Pe)(a))&&e(L)]])),128))])):A("",!0)])]),e(S)?A("",!0):(n(),_("div",{key:0,class:ge(["nc-comments-drawer min-w-0 min-h-full max-h-full",{active:e(y)&&e(I)("commentList")}])},[k("div",Co,[e(y)&&e(I)("commentList")?(n(),d(P,{key:0})):A("",!0)])],2))])]))]),_:1},8,["visible","width","class"])}}});const Vo=Ee(So,[["__scopeId","data-v-94859624"]]),ea=Object.freeze(Object.defineProperty({__proto__:null,default:Vo},Symbol.toStringTag,{value:"Module"}));export{ea as i,Ht as u};
