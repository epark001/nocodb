import{h as A,$,r as u,A as P,c4 as L,g as U,cb as G,S as J,i as w,cd as _,aq as K,o as m,c as C,b as p,w as g,a as h,C as W,D as z,E as l,F as H,t as y,W as x,aV as X,bN as Y,f9 as Z,J as k,L as ee,P as oe,f as te}from"./entry.51f4e399.js";import{M as ne,A as ae}from"./index.5263eb1d.js";import{a as se}from"./useMetas.ba7abae7.js";import{e as re}from"./dataUtils.edecace3.js";import{S as le}from"./StreamBarcodeReader.1af98aa0.js";import{_ as ie}from"./index.5e746f62.js";import{_ as ce}from"./FormItem.cda40628.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./toArray.06afb623.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./SearchOutlined.dec109ce.js";import"./FormItemContext.e001cd7c.js";import"./identity.dd5da9ba.js";import"./isSymbol.b53bd26f.js";import"./_getPrototype.ec1165af.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./toNumber.9dc54e53.js";const ue={class:"flex items-center gap-1"},de={key:0,class:"!text-xs font-weight-normal"},me={class:"relative flex flex-col h-full"},pe={class:"text-left text-wrap mt-2 text-xl mb-4"},fe={key:0,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},ve={key:1,class:"text-left text-wrap mt-2 text-[#e65100] text-xs"},Ae=A({__name:"QrScannerButton",setup(we){const s=$(ne,u()),{t:B}=P(),O=L(),I=U(),{$api:T}=te(),{project:M}=G(se()),{isMobileMode:q}=J(),N=$(ae,u()),S=w(()=>{var o;return((o=s==null?void 0:s.value)==null?void 0:o.columns.filter(e=>e.uidt&&[_.QrCode,_.Barcode].includes(e.uidt)).map(e=>({value:e.id,label:e.title})))||[]}),j=o=>{var c,v,a,R;const e=(v=(c=s.value)==null?void 0:c.columns)==null?void 0:v.find(b=>b.id===o);if(!e)throw new Error("QrCode or BarCode Column not found");let r;if(e.uidt===_.QrCode)r=e.colOptions.fk_qr_value_column_id;else if(e.uidt===_.Barcode)r=e.colOptions.fk_barcode_value_column_id;else throw new Error("Column to scan for is not of supported type");const t=(R=(a=s.value)==null?void 0:a.columns)==null?void 0:R.find(b=>b.id===r);if(!t)throw new Error("Column to search for not found");return t},i=u(!1),n=u(""),d=u("");K(S,()=>{var o;(o=S.value)!=null&&o.every(e=>e.value!==n.value)&&(n.value="")});const f=u(!1),D=async()=>{f.value=!0},F=w(()=>f.value&&n.value!==""),E=w(()=>!n.value),Q=w(()=>!!n.value&&!f.value),V=async o=>{if(!(!F.value||o===d.value))try{const e=j(n.value),r=`(${e==null?void 0:e.title},eq,${o})`,t=(await T.dbViewRow.list(Z,M.value.id,s.value.id,N.value.title,{where:r})).list;if(t.length!==1){i.value=!0,d.value=o,setTimeout(()=>{d.value=""},4e3),t.length===0&&k.info(B("msg.info.codeScanner.noRowFoundForCode")),t.length>1&&(k.warn(B("msg.info.codeScanner.moreThanOneRowFoundForCode")),i.value=!1,d.value="");return}i.value=!1,d.value="";const c=re(t[0],s.value.columns);I.push({query:{...O.query,rowId:c}})}catch(e){console.error(e)}};return(o,e)=>{const r=ee,t=ie,c=ce,v=oe;return m(),C("div",null,[p(r,{class:"nc-btn-find-row-by-scan nc-toolbar-btn",onClick:e[0]||(e[0]=a=>i.value=!0)},{default:g(()=>[h("div",ue,[(m(),W(z(l(H).qrCode))),l(q)?x("",!0):(m(),C("span",de,y(o.$t("activity.findRowByCodeScan")),1))])]),_:1}),p(v,{visible:i.value,"onUpdate:visible":e[2]||(e[2]=a=>i.value=a),class:"nc-overlay-find-row-by-scan",closable:!1,width:"28rem",centered:"",footer:null,"wrap-class-name":"nc-modal-generate-token","destroy-on-close":"",onCancel:e[3]||(e[3]=a=>f.value=!1)},{default:g(()=>[h("div",me,[h("div",pe,y(o.$t("title.findRowByScanningCode")),1),p(c,{label:o.$t("labels.columnToScanFor"),class:"nc-dropdown-scanner-column-id"},{default:g(()=>[p(t,{value:n.value,"onUpdate:value":e[1]||(e[1]=a=>n.value=a),class:"w-full",options:l(S)},null,8,["value","options"])]),_:1},8,["label"]),h("div",null,[X(p(l(le),{onDecode:V,onLoaded:D},null,512),[[Y,l(F)]]),l(E)?(m(),C("div",fe,y(o.$t("msg.info.codeScanner.selectColumn")),1)):x("",!0),l(Q)?(m(),C("div",ve,y(o.$t("msg.info.codeScanner.loadingScanner")),1)):x("",!0)])])]),_:1},8,["visible"])])}}});export{Ae as default};
