import{h as te,z as se,A as oe,r as _,B as ae,o as i,c as b,a as s,b as o,E as n,H as V,b6 as ne,C as u,D as v,F as y,w as a,d as le,G as A,t as c,cj as B,aj as ie,W as re,Q as ce,R as pe,J as r,K as C,L as de,M as ue,N as me,f as _e}from"./entry.51f4e399.js";import{_ as ve}from"./Icon.vue.1162f18b.js";import{_ as ye}from"./DeleteModal.vue.909e0964.js";import{u as fe}from"./useCopy.3e897b55.js";import{u as ge}from"./useDashboard.fc1e1c09.js";import{_ as we}from"./index.e760d172.js";import{D as xe}from"./index.252dc7b4.js";import{_ as he,a as ke}from"./index.714e2a51.js";import{S as be,_ as Ce}from"./index.5e746f62.js";import"./Button.vue.793bcd1d.js";import"./index.0db47614.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isSymbol.b53bd26f.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./Modal.vue.b59a28af.js";import"./Input.7cb175ff.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.e001cd7c.js";import"./SearchOutlined.dec109ce.js";import"./isPlainObject.ecf52d25.js";import"./_getPrototype.ec1165af.js";import"./TextArea.442a25cb.js";import"./Password.d493e47a.js";import"./Dropdown.dc69c0a4.js";import"./RightOutlined.90e8180f.js";import"./eagerComputed.6062ac13.js";import"./useState.6010d8b6.js";import"./index.09b19c06.js";import"./LeftOutlined.3bb8aa17.js";import"./useBreakpoint.a91853f1.js";import"./responsiveObserve.501a6cf9.js";import"./toArray.06afb623.js";import"./DownOutlined.db6f6406.js";import"./index.a3117839.js";import"./useMergedState.5e6500b1.js";import"./index.0d6d8ba8.js";import"./Checkbox.a529f1e6.js";import"./createForOfIteratorHelper.12419aa5.js";import"./index.2a1a64ce.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./CheckOutlined.ef30fafc.js";const $e=ce(()=>pe(()=>import("./UsersModal.ac838280.js"),["./UsersModal.ac838280.js","./entry.51f4e399.js","./entry.0f786d51.css","./validation.6db726f3.js","./useCopy.3e897b55.js","./useDashboard.fc1e1c09.js","./send-outline.f2f3f49c.js","./index.de92142d.js","./FormItem.cda40628.js","./identity.dd5da9ba.js","./isSymbol.b53bd26f.js","./_getPrototype.ec1165af.js","./Col.88cfabc0.js","./responsiveObserve.501a6cf9.js","./toArray.06afb623.js","./toNumber.9dc54e53.js","./FormItemContext.e001cd7c.js","./useSize.3b3f469f.js","./_flatRest.ff2d3d5c.js","./debounce.7d32c110.js","./isPlainObject.ecf52d25.js","./index.e760d172.js","./Input.7cb175ff.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.dec109ce.js","./TextArea.442a25cb.js","./Password.d493e47a.js","./Title.e76f8bdd.js","./CheckOutlined.ef30fafc.js","./useMergedState.5e6500b1.js","./index.7230021b.js","./index.5e746f62.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js"],import.meta.url).then(U=>U.default||U)),Ue={"data-testid":"nc-super-user-list"},Re={class:"max-w-[900px] mx-auto"},Le=s("div",{class:"text-xl my-4 text-left font-weight-bold"},"User Management",-1),Ee={class:"py-2 flex gap-4 items-center"},De=s("div",{class:"flex-grow"},null,-1),Ie={class:"flex items-center gap-1"},Se={key:0,class:"font-weight-bold"},Me={class:"text-gray-500 text-xs whitespace-normal"},ze={class:"text-gray-500 text-xs whitespace-normal"},Te={key:0,class:"flex items-center gap-2"},Ve={class:"flex flex-row items-center"},Ae={class:"flex flex-row items-center h-[1.2rem]"},Be=["onClick"],Pe={class:"text-xs pl-2"},je=["onClick"],Ne={class:"text-xs pl-2"},Ke=["onClick"],Oe={class:"text-xs pl-2"},Ge={class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700 mb-4"},qe={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Fe={class:"text-xs pl-2"},He={key:1},At=te({__name:"UserList",setup(U){const{api:f,isLoading:P}=se(),{$e:g}=_e(),{t:w}=oe(),{dashboardUrl:j}=ge(),{copy:D}=fe(),I=_([]),S=_(1),N=_(10),R=_(!1),M=_(0),x=_(!1),h=_(""),L=ae({total:0,pageSize:10,position:["bottomCenter"]}),m=async(e=S.value,t=N.value)=>{S.value=e;try{const p=await f.orgUsers.list({query:{limit:t,offset:h.value.length===0?(e-1)*t:0,query:h.value}});if(!p)return;L.total=p.pageInfo.totalRows??0,L.pageSize=10,I.value=p.list}catch(p){r.error(await C(p))}};m();const K=async(e,t)=>{try{await f.orgUsers.update(e,{roles:t}),r.success(w("msg.success.roleUpdated")),g("a:org-user:role-updated",{role:t})}catch(p){r.error(await C(p))}},O=async e=>{try{await f.orgUsers.delete(e),r.success(w("msg.success.userDeleted")),await m(),g("a:org-user:user-deleted")}catch(t){r.error(await C(t))}x.value=!1},G=async e=>{try{await f.orgUsers.resendInvite(e.id),r.success(w("msg.success.inviteEmailSent")),await m()}catch(t){r.error(await C(t))}g("a:org-user:resend-invite")},q=async e=>{if(e.invite_token){try{await D(`${j.value}#/signup/${e.invite_token}`),r.success(w("msg.success.inviteURLCopied"))}catch(t){r.error(t.message)}g("c:user:copy-url")}},F=async e=>{try{const{reset_password_url:t}=await f.orgUsers.generatePasswordResetToken(e.id);await D(t),r.success(w("msg.success.passwordResetURLCopied")),g("c:user:copy-url")}catch(t){r.error(await C(t))}};return(e,t)=>{const p=we,z=de,H=A,E=he,T=be,J=Ce,$=ue,Q=ve,W=ye,X=me,Y=xe,Z=ke,ee=$e;return i(),b("div",Ue,[s("div",Re,[Le,s("div",Ee,[o(p,{value:n(h),"onUpdate:value":t[0]||(t[0]=l=>V(h)?h.value=l:null),size:"middle",class:"max-w-[300px]",placeholder:"Search Users",onBlur:m,onKeydown:ne(m,["enter"])},null,8,["value","onKeydown"]),De,(i(),u(v(n(y).reload),{class:"cursor-pointer",onClick:m})),o(z,{"data-testid":"nc-super-user-invite",size:"middle",class:"!rounded-md",type:"primary",onClick:t[1]||(t[1]=()=>{R.value=!0,M.value++})},{default:a(()=>[s("div",Ie,[(i(),u(v(n(y).plus))),le(" Invite new user ")])]),_:1})]),o(Z,{"row-key":l=>l.id,"data-source":n(I),pagination:n(L),loading:n(P),size:"small",onChange:t[4]||(t[4]=l=>m(l.current))},{emptyText:a(()=>[o(H,{image:("Empty"in e?e.Empty:n(A)).PRESENTED_IMAGE_SIMPLE,description:e.$t("labels.noData")},null,8,["image","description"])]),default:a(()=>[o(E,{key:"email",title:e.$t("labels.email"),"data-index":"email"},{default:a(({text:l})=>[s("div",null,c(l),1)]),_:1},8,["title"]),o(E,{key:"roles",title:e.$t("objects.role"),"data-index":"roles"},{default:a(({record:l})=>[s("div",null,[l.roles.includes("super")?(i(),b("div",Se,"Super Admin")):(i(),u(J,{key:1,value:l.roles,"onUpdate:value":d=>l.roles=d,class:"w-[220px] nc-user-roles","dropdown-match-select-width":!1,onChange:d=>K(l.id,l.roles)},{default:a(()=>[o(T,{class:"nc-users-list-role-option",value:n(B).OrgLevelCreator,label:e.$t("objects.roleType.orgLevelCreator")},{default:a(()=>[s("div",null,c(e.$t("objects.roleType.orgLevelCreator")),1),s("span",Me,c(e.$t("msg.info.roles.orgCreator")),1)]),_:1},8,["value","label"]),o(T,{class:"nc-users-list-role-option",value:n(B).OrgLevelViewer,label:e.$t("objects.roleType.orgLevelViewer")},{default:a(()=>[s("div",null,c(e.$t("objects.roleType.orgLevelViewer")),1),s("span",ze,c(e.$t("msg.info.roles.orgViewer")),1)]),_:1},8,["value","label"])]),_:2},1032,["value","onUpdate:value","onChange"]))])]),_:1},8,["title"]),o(E,{key:"id",title:e.$t("labels.actions"),"data-index":"id"},{default:a(({text:l,record:d})=>[d.roles.includes("super")?(i(),b("span",He)):(i(),b("div",Te,[o(Y,{trigger:["click"],class:"flex",placement:"bottomRight","overlay-class-name":"nc-dropdown-user-mgmt"},{overlay:a(()=>[o(X,null,{default:a(()=>[d.invite_token?(i(),b(ie,{key:0},[o($,null,{default:a(()=>[s("div",{class:"flex flex-row items-center py-3",onClick:k=>G(d)},[(i(),u(v(n(y).email),{class:"flex h-[1rem] text-gray-500"})),s("div",Pe,c(e.$t("activity.resendInvite")),1)],8,Be)]),_:2},1024),o($,null,{default:a(()=>[s("div",{class:"flex flex-row items-center py-3",onClick:k=>q(d)},[(i(),u(v(n(y).copy),{class:"flex h-[1rem] text-gray-500"})),s("div",Ne,c(e.$t("activity.copyInviteURL")),1)],8,je)]),_:2},1024)],64)):re("",!0),o($,null,{default:a(()=>[s("div",{class:"flex flex-row items-center py-3",onClick:k=>F(d)},[(i(),u(v(n(y).copy),{class:"flex h-[1rem] text-gray-500"})),s("div",Oe,c(e.$t("activity.copyPasswordResetURL")),1)],8,Ke)]),_:2},1024),o($,null,{default:a(()=>[s("div",{class:"flex flex-row items-center py-3",onClick:t[3]||(t[3]=k=>x.value=!0)},[o(W,{visible:n(x),"onUpdate:visible":t[2]||(t[2]=k=>V(x)?x.value=k:null),"entity-name":"User","on-delete":()=>O(l)},{"entity-preview":a(()=>[s("span",null,[s("div",Ge,[o(Q,{icon:"account",class:"nc-view-icon"}),s("div",qe,c(d.email),1)])])]),_:2},1032,["visible","on-delete"]),(i(),u(v(n(y).delete),{"data-testid":"nc-super-user-delete",class:"flex h-[1rem] text-gray-500"})),s("div",Fe,c(e.$t("general.delete")),1)])]),_:2},1024)]),_:2},1024)]),default:a(()=>[s("div",Ve,[o(z,{type:"text",class:"!px-0"},{default:a(()=>[s("div",Ae,[(i(),u(v(n(y).threeDotHorizontal),{class:"nc-user-row-action"}))])]),_:1})])]),_:2},1024)]))]),_:1},8,["title"])]),_:1},8,["row-key","data-source","pagination","loading"]),(i(),u(ee,{key:n(M),show:n(R),onClosed:t[5]||(t[5]=l=>R.value=!1),onReload:m},null,8,["show"]))])])}}});export{At as default};
