import{_ as Ce}from"./Icon.vue.e15b8911.js";import{_ as he}from"./CellIcon.8e3c7692.js";import{_ as be}from"./DeleteModal.vue.55101b0a.js";import{h as se,T as ae,$ as E,r as j,S as ke,o as a,C as c,w as p,E as t,c as x,b as w,a as N,t as b,W as O,H,eW as ne,f4 as ie,J as P,K as le,f as re,al as De,A as Le,cI as Ie,D as M,F as S,d as I,aV as F,cd as h,aj as oe,b5 as xe,cF as Oe,g0 as A,gp as Me,M as Se,N as $e}from"./entry.13466615.js";import{C as de,M as ce,R as Ae,A as Ee,d as Ve}from"./index.5263eb1d.js";import{u as ue,a as Re,f as Te}from"./useMetas.223da623.js";import{u as Fe}from"./useViewSorts.b3ae049e.js";import{a as Be}from"./useSmartsheetStore.9bdf3b91.js";import{D as Ne}from"./index.82f05b6c.js";import{_ as je}from"./index.1669d181.js";import{_ as Ue}from"./_plugin-vue_export-helper.c27b6911.js";import"./cell.b6c2deed.js";import"./Button.vue.a83cab3b.js";import"./index.f2e6837c.js";import"./debounce.dbc9bf77.js";import"./toNumber.7aa6a805.js";import"./isSymbol.b9109ae5.js";import"./Modal.vue.fe6a4790.js";import"./useSharedView.746b4f21.js";import"./index.e7cf7635.js";import"./views.3cd4bcb9.js";import"./index.2a3da6a9.js";import"./Dropdown.a78be736.js";import"./RightOutlined.2c092523.js";const Ge={key:0,class:"flex flex-row items-center py-2 px-3 bg-gray-50 rounded-lg text-gray-700 mb-4"},Pe={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.5",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},ze=se({__name:"DeleteColumnModal",props:{visible:{type:Boolean}},emits:["update:visible"],setup(z,{emit:B}){const V=ae(z,"visible",B),{$api:m,$e:k}=re(),e=E(de),g=E(ce,j()),{getMeta:l}=ue(),{includeM2M:v}=ke(),{loadTables:Y}=Re(),U=j(!1),_=async()=>{var R,C,D,$,T;if(e!=null&&e.value){U.value=!0;try{await m.dbTableColumn.delete((R=e==null?void 0:e.value)==null?void 0:R.id),await l((C=g==null?void 0:g.value)==null?void 0:C.id,!0),ne(e==null?void 0:e.value)&&((D=e.value)!=null&&D.colOptions)&&(await l((($=e.value)==null?void 0:$.colOptions).fk_related_model_id,!0),v.value&&((T=e.value)==null?void 0:T.colOptions).type===ie.MANY_TO_MANY&&Y()),k("a:column:delete"),V.value=!1}catch(q){P.error(await le(q))}finally{U.value=!1}}};return(R,C)=>{const D=he,$=be;return a(),c($,{visible:t(V),"onUpdate:visible":C[0]||(C[0]=T=>H(V)?V.value=T:null),"entity-name":R.$t("objects.column"),"on-delete":_},{"entity-preview":p(()=>[t(e)?(a(),x("div",Ge,[w(D,{class:"nc-view-icon"}),N("div",Pe,b(t(e).title),1)])):O("",!0)]),_:1},8,["visible","entity-name"])}}}),We={class:"nc-column-edit nc-header-menu-item"},Ye={class:"nc-column-insert-before nc-header-menu-item my-0.5"},qe={class:"nc-column-set-primary nc-header-menu-item item my-0.5"},He={class:"nc-column-insert-after nc-header-menu-item"},Je={class:"nc-column-insert-before nc-header-menu-item"},Ke={class:"nc-column-duplicate nc-header-menu-item my-0.5"},Qe={class:"nc-column-insert-after nc-header-menu-item"},Xe={class:"nc-column-insert-before nc-header-menu-item"},Ze={class:"nc-column-delete nc-header-menu-item my-0.75 text-red-600"},et=se({__name:"Menu",props:{virtual:{type:Boolean},isOpen:{type:Boolean}},emits:["edit","addColumn","update:isOpen"],setup(z,{emit:B}){const W=z,V=De(W,"virtual"),m=ae(W,"isOpen",B),{eventBus:k}=Be(),e=E(de),g=E(Ae),l=E(ce,j()),v=E(Ee,j()),{insertSort:Y}=Fe(v,()=>g==null?void 0:g.trigger()),U=E(Ve),{$api:_,$e:R}=re(),{t:C}=Le(),{getMeta:D}=ue(),{addUndo:$,defineModelScope:T,defineViewScope:q}=Te(),G=j(!1),me=async()=>{var r,o,n,s,d;try{const f=(o=(r=l==null?void 0:l.value)==null?void 0:r.columns)==null?void 0:o.find(i=>i.pv);m.value=!1,await _.dbTableColumn.primaryColumnSet((n=e==null?void 0:e.value)==null?void 0:n.id),await D((s=l==null?void 0:l.value)==null?void 0:s.id,!0),k.emit(A.FIELD_RELOAD),R("a:column:set-primary"),$({redo:{fn:async i=>{var u;await _.dbTableColumn.primaryColumnSet(i),await D((u=l==null?void 0:l.value)==null?void 0:u.id,!0),k.emit(A.FIELD_RELOAD)},args:[(d=e==null?void 0:e.value)==null?void 0:d.id]},undo:{fn:async i=>{var u;await _.dbTableColumn.primaryColumnSet(i),await D((u=l==null?void 0:l.value)==null?void 0:u.id,!0),k.emit(A.FIELD_RELOAD)},args:[f==null?void 0:f.id]},scope:T({model:l.value})})}catch{P.error(C("msg.error.primaryColumnUpdateFailed"))}},J=async r=>{await Y({column:e.value,direction:r,reloadDataHook:g})},pe=async()=>{var n,s,d,f;let r={};const o=Me(`${e.value.title}_copy`,l.value.columns);switch(e==null?void 0:e.value.uidt){case h.LinkToAnotherRecord:case h.Links:case h.Lookup:case h.Rollup:case h.Formula:return P.info("Not available at the moment");case h.SingleSelect:case h.MultiSelect:r={...e.value,title:o,column_name:o,id:void 0,order:void 0,colOptions:{options:((s=(n=e.value.colOptions)==null?void 0:n.options)==null?void 0:s.map(i=>({...i,id:void 0})))??[]}};break;default:r={...e.value,...e.value.colOptions??{},title:o,column_name:o,id:void 0,colOptions:void 0,order:void 0};break}try{const i=(await _.dbViewColumn.list((d=v.value)==null?void 0:d.id)).list,u=i.findIndex(L=>L.fk_column_id===e.value.id);let y;u===i.length-1?y=i[u].order+1:y=(i[u].order+i[u+1].order)/2,await _.dbTableColumn.create(l.value.id,{...r,pv:!1,column_order:{order:y,view_id:(f=v.value)==null?void 0:f.id}}),await D(l.value.id,!0),k.emit(A.FIELD_RELOAD),g==null||g.trigger()}catch(i){P.error(await le(i))}m.value=!1},K=async(r=!1)=>{var d,f,i,u;const o=(await _.dbViewColumn.list((d=v.value)==null?void 0:d.id)).list,n=o.findIndex(y=>y.fk_column_id===e.value.id);let s;r?n===0?s=o[n].order/2:s=(o[n].order+((f=o[n-1])==null?void 0:f.order))/2:n===o.length-1?s=o[n].order+1:s=(o[n].order+((i=o[n+1])==null?void 0:i.order))/2,B("addColumn",{column_order:{order:s,view_id:(u=v.value)==null?void 0:u.id}})},ve=async()=>{var n;const o=(await _.dbViewColumn.list((n=v.value)==null?void 0:n.id)).list.find(s=>s.fk_column_id===e.value.id);await _.dbViewColumn.update(v.value.id,o.id,{show:!1}),k.emit(A.FIELD_RELOAD),$({redo:{fn:async function(d){await _.dbViewColumn.update(v.value.id,d,{show:!1}),k.emit(A.FIELD_RELOAD)},args:[o.id]},undo:{fn:async function(d){await _.dbViewColumn.update(v.value.id,d,{show:!0}),k.emit(A.FIELD_RELOAD)},args:[o.id]},scope:q({view:v.value})})},_e=()=>{m.value=!1,G.value=!0},fe=()=>{m.value=!1,B("edit")},ye=()=>{m.value=!1,K(!0)},we=()=>{m.value=!1,K()};return(r,o)=>{const n=Ce,s=Se,d=je,f=$e,i=Ne,u=ze,y=Ie("e");return a(),x(oe,null,[t(U)?O("",!0):(a(),c(i,{key:0,visible:t(m),"onUpdate:visible":o[2]||(o[2]=L=>H(m)?m.value=L:null),trigger:["click"],placement:"bottomRight","overlay-class-name":"nc-dropdown-column-operations",onClick:o[3]||(o[3]=Oe(L=>m.value=!t(m),["stop"]))},{overlay:p(()=>[w(f,{class:"shadow bg-white nc-column-options"},{default:p(()=>{var L,Q,X,Z,ee,te;return[w(s,{onClick:fe},{default:p(()=>[N("div",We,[(a(),c(M(t(S).edit),{class:"text-gray-700 mx-0.65 my-0.75"})),I(b(r.$t("general.edit")),1)])]),_:1}),(L=t(e))!=null&&L.pv?O("",!0):(a(),c(d,{key:0,class:"!my-0"})),(Q=t(e))!=null&&Q.pv?O("",!0):(a(),c(s,{key:1,onClick:ve},{default:p(()=>[F((a(),x("div",Ye,[(a(),c(M(t(S).eye),{class:"text-gray-700 mx-0.75 !w-3.75 !h-3.75 ml-0.75 mr-0.5"})),I(b(r.$t("general.hideField")),1)])),[[y,["a:field:hide"]]])]),_:1})),(!t(V)||((X=t(e))==null?void 0:X.uidt)===t(h).Formula)&&!((Z=t(e))!=null&&Z.pv)?(a(),c(s,{key:2,onClick:me},{default:p(()=>[N("div",qe,[w(n,{icon:"star",class:"text-gray-700 !w-4.25 !h-4.25 ml-0.5 mr-0.25 -mt-0.5"}),I(b(r.$t("activity.setDisplay")),1)])]),_:1})):O("",!0),w(d,{class:"!my-0"}),!t(ne)(t(e))||t(e).colOptions.type!==t(ie).BELONGS_TO?(a(),x(oe,{key:3},[w(s,{onClick:o[0]||(o[0]=ge=>J("asc"))},{default:p(()=>[F((a(),x("div",He,[(a(),c(M(t(S).sortDesc),{class:"text-gray-700 !rotate-180 !w-4.25 !h-4.25 ml-0.5 mr-0.25",style:xe({transform:"rotate(180deg)"})},null,8,["style"])),I(b(r.$t("general.sortAsc")),1)])),[[y,["a:field:sort",{dir:"asc"}]]])]),_:1}),w(s,{onClick:o[1]||(o[1]=ge=>J("desc"))},{default:p(()=>[F((a(),x("div",Je,[(a(),c(M(t(S).sortDesc),{class:"text-gray-700 !w-4.25 !h-4.25 ml-0.5 mr-0.25"})),I(b(r.$t("general.sortDesc")),1)])),[[y,["a:field:sort",{dir:"desc"}]]])]),_:1})],64)):O("",!0),w(d,{class:"!my-0"}),t(e).uidt!==t(h).LinkToAnotherRecord&&t(e).uidt!==t(h).Lookup&&!t(e).pk?(a(),c(s,{key:4,onClick:pe},{default:p(()=>[F((a(),x("div",Ke,[(a(),c(M(t(S).duplicate),{class:"text-gray-700 mx-0.75"})),I(b(t(C)("general.duplicate")),1)])),[[y,["a:field:duplicate"]]])]),_:1})):O("",!0),w(s,{onClick:we},{default:p(()=>[F((a(),x("div",Qe,[(a(),c(M(t(S).colInsertAfter),{class:"text-gray-700 !w-4.5 !h-4.5 ml-0.75"})),I(b(t(C)("general.insertAfter")),1)])),[[y,["a:field:insert:after"]]])]),_:1}),(ee=t(e))!=null&&ee.pv?O("",!0):(a(),c(s,{key:5,onClick:ye},{default:p(()=>[F((a(),x("div",Xe,[(a(),c(M(t(S).colInsertBefore),{class:"text-gray-600 !w-4.5 !h-4.5 mr-1.5 -ml-0.75"})),I(b(t(C)("general.insertBefore")),1)])),[[y,["a:field:insert:before"]]])]),_:1})),w(d,{class:"!my-0"}),(te=t(e))!=null&&te.pv?O("",!0):(a(),c(s,{key:6,onClick:_e},{default:p(()=>[N("div",Ze,[(a(),c(M(t(S).delete),{class:"ml-0.75 mr-1"})),I(b(r.$t("general.delete")),1)])]),_:1}))]}),_:1})]),default:p(()=>[N("div",null,[w(n,{icon:"arrowDown",class:"text-grey h-full text-grey nc-ui-dt-dropdown cursor-pointer outline-0 mr-2"})])]),_:1},8,["visible"])),w(u,{visible:t(G),"onUpdate:visible":o[4]||(o[4]=L=>H(G)?G.value=L:null)},null,8,["visible"])],64)}}});const Lt=Ue(et,[["__scopeId","data-v-2ae4b089"]]);export{Lt as default};
