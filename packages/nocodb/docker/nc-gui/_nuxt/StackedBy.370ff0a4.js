import{h as G,Z as H,r as s,$ as i,aq as q,i as I,cd as Q,cI as W,E as a,o as d,C as f,w as c,c as Z,cF as p,a as n,b,H as h,W as g,aV as J,d as X,t as V,Q as Y,R as ee,L as oe}from"./entry.13466615.js";import{_ as te}from"./Icon.vue.e15b8911.js";import{g as ae,M as ne,A as se,b as ie,R as le,d as re}from"./index.5263eb1d.js";import{a as de}from"./useKanbanViewStore.d73f4042.js";import{u as ce}from"./index.f13259f4.js";import{f as pe}from"./useMetas.223da623.js";import{u as me}from"./useViewColumns.21ea359e.js";import{D as ue}from"./index.82f05b6c.js";import{_ as _e}from"./index.4385a501.js";import"./deepCompare.d32ec333.js";import"./dataUtils.31dbfaee.js";import"./useSmartsheetStore.9bdf3b91.js";import"./views.3cd4bcb9.js";import"./useSharedView.746b4f21.js";import"./index.2a3da6a9.js";import"./index.e7cf7635.js";import"./Dropdown.a78be736.js";import"./RightOutlined.2c092523.js";import"./toArray.f6fa5a71.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.4991ab9d.js";import"./useMergedState.1cc2a884.js";import"./useState.a6853ebd.js";import"./DownOutlined.9cfe3e0c.js";import"./CheckOutlined.80115d65.js";import"./SearchOutlined.c1eed30a.js";import"./FormItemContext.27b2e5db.js";const fe=Y(()=>ee(()=>import("./EditOrAddProvider.14f9bfd7.js"),["./EditOrAddProvider.14f9bfd7.js","./EditOrAddProvider.vue.9fbafb18.js","./entry.13466615.js","./entry.0f786d51.css","./Icon.vue.e15b8911.js","./Button.vue.a83cab3b.js","./index.f2e6837c.js","./debounce.dbc9bf77.js","./toNumber.7aa6a805.js","./isSymbol.b9109ae5.js","./_plugin-vue_export-helper.c27b6911.js","./Button.95d2a5ed.css","./useBetaFeatureToggle.52c326cd.js","./index.5263eb1d.js","./index.2ae12d3e.js","./validation.5ed31fc1.js","./useMetas.223da623.js","./index.6f605a00.js","./FormItem.fe59dafe.js","./identity.b813b76e.js","./_getPrototype.00be30f0.js","./Col.23d910dc.js","./responsiveObserve.9209e727.js","./toArray.f6fa5a71.js","./FormItemContext.27b2e5db.js","./useSize.dec45296.js","./_flatRest.037bf8e3.js","./isPlainObject.4c0f42f1.js","./index.a8ef1b7e.js","./Input.16966097.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.c1eed30a.js","./TextArea.1bd4034f.js","./Password.d7b16461.js","./index.2660048d.js","./Checkbox.65681aa3.js","./createForOfIteratorHelper.37be2624.js","./index.4385a501.js","./isMobile.e2e89480.js","./useMemo.4991ab9d.js","./useMergedState.1cc2a884.js","./useState.a6853ebd.js","./DownOutlined.9cfe3e0c.js","./CheckOutlined.80115d65.js","./EditOrAddProvider.44ca9c5b.css"],import.meta.url).then(m=>m.default||m)),be={class:"nc-kanban-btn"},ge={class:"flex items-center gap-1"},ve={class:"text-capitalize !text-sm"},we={class:"font-bold ml-0.25"},ke=n("div",null,"Select a field to stack records by",-1),ye={class:"nc-fields-list py-2"},Ce={class:"grouping-field"},Ie={class:"mt-4 border-1 px-4 pt-4 pb-3 border-gray-50 rounded-2xl"},he=n("div",{class:"text-base font-medium mb-2"},"Options",-1),Ye=G({__name:"StackedBy",setup(m){H(ae,s(!0));const v=i(ne,s()),l=i(se,s()),x=i(ie,s(!1)),D=i(le),S=i(re,s(!1)),{fields:B,loadViewColumns:j,metaColumnById:F}=me(l,v,()=>D.trigger()),{kanbanMetaData:w,loadKanbanMeta:k,loadKanbanData:y,updateKanbanMeta:M,groupingField:E,groupingFieldColumn:K}=de(),{addUndo:O,defineViewScope:R}=pe(),t=s(!1);ce(t),q(()=>{var o;return(o=l.value)==null?void 0:o.id},async(o,e)=>{o!==e&&v.value&&await j()},{immediate:!0});const u=async o=>{var e;await M({fk_grp_col_id:o}),await k(),await y(),((e=l.value)==null?void 0:e.view).fk_grp_col_id=o},_=I({get:()=>w.value.fk_grp_col_id,set:async o=>{o&&(O({undo:{fn:await u,args:[w.value.fk_grp_col_id]},redo:{fn:await u,args:[o]},scope:R({view:l.value})}),await u(o))}}),A=I(()=>{var o;return(o=B.value)==null?void 0:o.filter(e=>e.fk_column_id&&F.value[e.fk_column_id].uidt===Q.SingleSelect).map(e=>({value:e.fk_column_id,label:e.title}))}),L=async()=>{t.value=!1,await k(),await y()},P=()=>{t.value=!1};return(o,e)=>{const C=te,U=oe,$=_e,N=fe,T=ue,z=W("e");return a(x)?g("",!0):(d(),f(T,{key:0,visible:a(t),"onUpdate:visible":e[6]||(e[6]=r=>h(t)?t.value=r:null),trigger:["click"],"overlay-class-name":"nc-dropdown-kanban-stacked-by-menu"},{overlay:c(()=>[a(t)?(d(),Z("div",{key:0,class:"p-6 w-90 bg-white shadow-lg nc-table-toolbar-menu !border-1 border-gray-50 rounded-2xl",onClick:e[5]||(e[5]=p(()=>{},["stop"]))},[ke,n("div",ye,[n("div",Ce,[b($,{value:a(_),"onUpdate:value":e[0]||(e[0]=r=>h(_)?_.value=r:null),class:"w-full nc-kanban-grouping-field-select",options:a(A),placeholder:"Select a Grouping Field",onChange:P,onClick:e[1]||(e[1]=p(()=>{},["stop"]))},{suffixIcon:c(()=>[b(C,{icon:"arrowDown",class:"text-gray-700"})]),_:1},8,["value","options"])])]),n("div",Ie,[he,a(t)?(d(),f(N,{key:0,column:a(K),"embed-mode":"","column-label":o.$t("general.changes"),"hide-title":"","hide-type":"","hide-additional-options":"",onCancel:e[2]||(e[2]=r=>t.value=!1),onSubmit:L,onClick:e[3]||(e[3]=p(()=>{},["stop"])),onKeydown:e[4]||(e[4]=p(()=>{},["stop"]))},null,8,["column","column-label"])):g("",!0)])])):g("",!0)]),default:c(()=>[n("div",be,[J((d(),f(U,{class:"nc-kanban-stacked-by-menu-btn nc-toolbar-btn",disabled:a(S)},{default:c(()=>[n("div",ge,[b(C,{icon:"layers",class:"mr-0.5"}),n("span",ve,[X(V(o.$t("activity.kanban.stackedBy"))+" ",1),n("span",we,V(a(E)),1)])])]),_:1},8,["disabled"])),[[z,["c:kanban:change-grouping-field"]]])])]),_:1},8,["visible"]))}}});export{Ye as default};
