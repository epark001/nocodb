import{_ as Le}from"./Icon.vue.1162f18b.js";import{_ as Xe}from"./Button.vue.793bcd1d.js";import{_ as fo}from"./Modal.vue.d8394846.js";import{h as ie,cZ as vo,T as De,cb as se,r as M,B as $t,i as Q,ad as Ct,ap as Tt,o as s,C as P,w as r,a as u,b as n,d as I,t as S,E as e,dh as _o,di as bo,b6 as Be,H as W,ck as It,J as ne,K as me,f as fe,z as Dt,U as Ye,aV as ge,bN as Pt,I as J,al as pe,$ as xe,c as h,W as j,aj as ae,fw as Mt,fo as yo,M as et,c5 as go,cd as xo,dg as ko,m as Vt,cn as wo,y as Ee,c4 as jo,cF as ce,fQ as ho,fR as St,N as Et,Q as Bt,R as Ut,p as $o,e as Co,cI as Ot,cp as tt,fS as wt,fI as To,b2 as Io,g as Nt,S as Do,A as Po,fT as Mo,aq as Ze,dD as Vo,eD as So,D as Eo,F as Bo,fl as Ue,dk as Oe,_ as Uo,L as Oo,Z as We,V as No,b4 as jt,cf as Lo,eX as Ro}from"./entry.51f4e399.js";import{u as Lt,b as de,a as Pe,d as Re,f as Ao,c as Ne,e as Ho}from"./useMetas.ba7abae7.js";import{u as he}from"./tab.da86c3fb.js";import{c as zo}from"./validation.6db726f3.js";import{F as ht}from"./index.de92142d.js";import"./index.e760d172.js";import{I as Fo}from"./Input.7cb175ff.js";import{_ as Go}from"./FormItem.cda40628.js";import{_ as qo,u as Rt,a as At,c as Ko,b as Jo}from"./plus.21827b47.js";import{_ as Ht}from"./Modal.vue.b59a28af.js";import{C as zt}from"./index.0d6d8ba8.js";import{_ as Ft}from"./index.2b3cfde3.js";import{_ as ot}from"./ProjectIcon.92319bff.js";import{_ as Zo}from"./QuickImport.vue.b0890f2c.js";import{u as Ae}from"./index.9e760c64.js";import{n as He,o as at,p as Gt,a as Wo}from"./index.5263eb1d.js";import{u as je}from"./index.277e21b7.js";import{S as Qo}from"./sortable.esm.9c3c89c5.js";import{_ as Xo}from"./Tooltip.vue.f55045dc.js";import{_ as Yo}from"./TableIcon.vue.27fb2d8a.js";import{_ as qt}from"./DeleteModal.vue.909e0964.js";import{_ as ea}from"./Tooltip.vue.3be5e05d.js";import{D as Kt}from"./index.252dc7b4.js";import{_ as nt}from"./_plugin-vue_export-helper.c27b6911.js";import{u as ta}from"./useCopy.3e897b55.js";import{i as Qe}from"./domUtils.b0dc23e8.js";import{o as oa}from"./urlUtils.a77f6d4a.js";import{i as aa}from"./index.e5ddde08.js";import{S as na}from"./index.0db47614.js";import{_ as sa,C as la}from"./index.9194faf6.js";import{_ as Jt}from"./index.f64fb2c8.js";import"./useSize.3b3f469f.js";import"./identity.dd5da9ba.js";import"./isSymbol.b53bd26f.js";import"./_flatRest.ff2d3d5c.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isPlainObject.ecf52d25.js";import"./_getPrototype.ec1165af.js";import"./FormItemContext.e001cd7c.js";import"./SearchOutlined.dec109ce.js";import"./TextArea.442a25cb.js";import"./antInputDirective.8ac36ea7.js";import"./Password.d493e47a.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./toArray.06afb623.js";import"./index.529d8b39.js";import"./index.680937e8.js";import"./index.c4aafe5c.js";import"./Dropdown.dc69c0a4.js";import"./useState.6010d8b6.js";import"./useRefs.154aa2be.js";import"./isMobile.e2e89480.js";import"./useMergedState.5e6500b1.js";import"./index.fbcca285.js";import"./Checkbox.a529f1e6.js";import"./createForOfIteratorHelper.12419aa5.js";import"./CheckOutlined.ef30fafc.js";import"./index.181e79e4.js";import"./DownOutlined.db6f6406.js";import"./RightOutlined.90e8180f.js";import"./256x256.3b34edca.js";import"./sidebar.e289f4e1.js";import"./Input.c36cd06d.js";import"./index.c7116bd2.js";import"./nuxt-link.b37e7c69.js";import"./Dropdown.vue.97a9d1a0.js";import"./index.ad7bdb4a.js";const ia={class:"flex flex-row items-center gap-x-2"},ra={class:"mt-2"},ca={class:"flex flex-row justify-end gap-x-2 mt-6"},da=ie({__name:"TableRename",props:{modelValue:{type:Boolean},tableMeta:{},baseId:{}},emits:["update:modelValue","updated"],setup(f,{emit:N}){const m=vo(f,["tableMeta","baseId"]),{$e:c,$api:v}=fe(),{setMeta:k}=Lt(),_=De(m,"modelValue",N),{updateTab:A}=he(),{loadProjectTables:$}=de(),t=Pe(),{loadTables:d,isMysql:l,isMssql:B,isPg:V}=t,{tables:H,project:T}=se(t),{refreshCommandPalette:p}=Re(),{addUndo:D,defineProjectScope:F}=Ao(),Z=M(),L=M(!1),G=ht.useForm,y=$t({title:""}),g=Q(()=>({title:[zo,{validator:(R,o)=>new Promise((b,C)=>{var q;let w=255;if(l(f.baseId)?w=64:V(f.baseId)?w=63:B(f.baseId)&&(w=128),((((q=T==null?void 0:T.value)==null?void 0:q.prefix)||"")+o).length>w)return C(new Error(`Table name exceeds ${w} characters`));b()})},{validator:(R,o)=>new Promise((b,C)=>{if(/^\s+|\s+$/.test(o))return C(new Error("Leading or trailing whitespace not allowed in table name"));if(!((H==null?void 0:H.value)||[]).every(w=>w.id===f.tableMeta.id||w.title.toLowerCase()!==(o||"").toLowerCase()))return C(new Error("Duplicate table alias"));b()})}]})),{validateInfos:E}=G(y,g);Ct(()=>{var R;(R=f.tableMeta)!=null&&R.title&&(y.title=`${f.tableMeta.title}`),Tt(()=>{var b;const o=(b=Z.value)==null?void 0:b.$el;o&&(o.setSelectionRange(0,y.title.length),o.focus())})},{flush:"post"});const U=async(R=!1,o)=>{var b;if(f.tableMeta&&!(y.title===f.tableMeta.title&&!o)){L.value=!0;try{await v.dbTable.update(f.tableMeta.id,{project_id:f.tableMeta.project_id,table_name:y.title,title:y.title}),_.value=!1,await $(f.tableMeta.project_id,!0),R||D({redo:{fn:w=>{y.title=w,U(!0,!0)},args:[y.title]},undo:{fn:w=>{y.title=w,U(!0,!0)},args:[f.tableMeta.title]},scope:F({model:f.tableMeta})}),await d();const C=await v.dbTable.read(f.tableMeta.id);await k(C),A({id:f.tableMeta.id},{title:C.title}),p(),c("a:table:rename"),It(`${(b=T.value)==null?void 0:b.title}: ${C==null?void 0:C.title}`),_.value=!1}catch(C){ne.error(await me(C))}L.value=!1}};return(R,o)=>{const b=Le,C=Fo,w=Go,z=ht,q=Xe,K=fo;return s(),P(K,{visible:e(_),"onUpdate:visible":o[4]||(o[4]=ee=>W(_)?_.value=ee:null),size:"small"},{header:r(()=>[u("div",ia,[n(b,{icon:"table"}),I(" "+S(R.$t("activity.renameTable")),1)])]),default:r(()=>[u("div",ra,[n(z,{model:e(y),name:"create-new-table-form"},{default:r(()=>[n(w,_o(bo(e(E).title)),{default:r(()=>[n(C,{ref_key:"inputEl",ref:Z,value:e(y).title,"onUpdate:value":o[0]||(o[0]=ee=>e(y).title=ee),class:"nc-input-md","hide-details":"",size:"large",placeholder:R.$t("msg.info.enterTableName"),onKeydown:o[1]||(o[1]=Be(()=>U(),["enter"]))},null,8,["value","placeholder"])]),_:1},16)]),_:1},8,["model"]),u("div",ca,[n(q,{type:"secondary",onClick:o[2]||(o[2]=ee=>_.value=!1)},{default:r(()=>[I(S(R.$t("general.cancel")),1)]),_:1}),n(q,{key:"submit",type:"primary",disabled:e(E).title.validateStatus==="error"||e(y).title===R.tableMeta.title,label:"Rename Table","loading-label":"Renaming Table",loading:e(L),onClick:o[3]||(o[3]=()=>U())},{loading:r(()=>[I(" Renaming Table ")]),default:r(()=>[I(" Rename Table ")]),_:1},8,["disabled","loading"])])])]),_:1},8,["visible"])}}}),ua={class:"mt-4"},pa={class:"prose-md self-center text-gray-500 mt-4"},ma={class:"text-xs p-2"},fa={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},va=ie({__name:"TableDuplicate",props:{modelValue:{type:Boolean},table:{},onOk:{type:Function}},emits:["update:modelValue"],setup(f,{emit:N}){const m=f,{api:c}=Dt(),v=De(m,"modelValue",N),k=M({includeData:!0,includeViews:!0,includeHooks:!0}),_=Q(()=>{const{includeData:d,includeViews:l,includeHooks:B}=k.value;return{excludeData:!d,excludeViews:!l,excludeHooks:!B}}),A=M(!1),$=async()=>{try{A.value=!0;const d=await c.dbTable.duplicate(m.table.project_id,m.table.id,{options:_.value});m.onOk(d)}catch(d){ne.error(await me(d))}finally{A.value=!1,v.value=!1}};Ye("Enter",()=>{v.value&&$()});const t=M(!1);return(d,l)=>{const B=Ft,V=zt,H=Xe,T=Ht;return s(),P(T,{visible:e(v),"onUpdate:visible":l[5]||(l[5]=p=>W(v)?v.value=p:null),class:J([{active:e(v)},"!w-[30rem]"]),centered:"","wrap-class-name":"nc-modal-table-duplicate",footer:null,closable:!1,onKeydown:l[6]||(l[6]=Be(p=>v.value=!1,["esc"]))},{default:r(()=>[u("div",null,[u("div",{class:"prose-xl font-bold self-center",onDblclick:l[0]||(l[0]=p=>t.value=!e(t))},S(d.$t("general.duplicate"))+" "+S(d.$t("objects.table")),33),u("div",ua,"Are you sure you want to duplicate the `"+S(d.table.title)+"` table?",1),u("div",pa,S(d.$t("title.advancedSettings")),1),n(B,{class:"!m-0 !p-0 !my-2"}),u("div",ma,[n(V,{checked:e(k).includeData,"onUpdate:checked":l[1]||(l[1]=p=>e(k).includeData=p)},{default:r(()=>[I("Include data")]),_:1},8,["checked"]),n(V,{checked:e(k).includeViews,"onUpdate:checked":l[2]||(l[2]=p=>e(k).includeViews=p)},{default:r(()=>[I("Include views")]),_:1},8,["checked"]),ge(n(V,{checked:e(k).includeHooks,"onUpdate:checked":l[3]||(l[3]=p=>e(k).includeHooks=p)},{default:r(()=>[I("Include webhooks")]),_:1},8,["checked"]),[[Pt,e(t)]])])]),u("div",fa,[n(H,{key:"back",type:"secondary",onClick:l[4]||(l[4]=p=>v.value=!1)},{default:r(()=>[I(S(d.$t("general.cancel")),1)]),_:1}),n(H,{key:"submit",type:"primary",loading:e(A),onClick:$},{default:r(()=>[I(S(d.$t("general.confirm")),1)]),_:1},8,["loading"])])]),_:1},8,["visible","class"])}}}),_a={class:"nc-project-menu-item group"},ba={class:"-ml-0.5"},ya={class:"color-transition nc-project-menu-item group"},ga={class:"color-transition nc-project-menu-item group"},xa={class:"color-transition nc-project-menu-item group"},ka={class:"color-transition nc-project-menu-item group"},wa=ie({__name:"BaseOptions",props:{base:{},project:{}},setup(f){const m=pe(f,"base"),{isUIAllowed:c}=Ae(),v=xe(He),{$e:k}=fe();function _($){if(!$)return;k("a:actions:import-airtable");const t=M(!0),{close:d}=je(qo,{modelValue:t,baseId:$,"onUpdate:modelValue":l});function l(){t.value=!1,d(1e3)}}function A($){var B;if(!((B=m.value)!=null&&B.id))return;k(`a:actions:import-${$}`);const t=M(!0),{close:d}=je(Zo,{modelValue:t,importType:$,baseId:m.value.id,"onUpdate:modelValue":l});function l(){t.value=!1,d(1e3)}}return($,t)=>{const d=Mt,l=Le,B=yo,V=et,H=go;return s(),h(ae,null,[n(d,{class:"my-0"}),n(H,{class:"py-0"},{title:r(()=>[u("div",_a,[n(l,{icon:"download",class:"-ml-0.25"}),u("div",ba,S($.$t("title.quickImportFrom")),1),n(B,{class:"transform group-hover:scale-115 group-hover:text-accent text-xl text-gray-400"})])]),expandIcon:r(()=>[]),default:r(()=>[e(c)("airtableImport",!1,e(v))?(s(),P(V,{key:"quick-import-airtable",onClick:t[0]||(t[0]=T=>_(e(m).id))},{default:r(()=>[u("div",ya,[n(l,{icon:"airtable",class:"group-hover:text-black"}),I(" Airtable ")])]),_:1})):j("",!0),e(c)("csvImport",!1,e(v))?(s(),P(V,{key:"quick-import-csv",onClick:t[1]||(t[1]=T=>A("csv"))},{default:r(()=>[u("div",ga,[n(l,{icon:"csv",class:"group-hover:text-black"}),I(" CSV file ")])]),_:1})):j("",!0),e(c)("jsonImport",!1,e(v))?(s(),P(V,{key:"quick-import-json",onClick:t[2]||(t[2]=T=>A("json"))},{default:r(()=>[u("div",xa,[n(l,{icon:"code",class:"group-hover:text-black"}),I(" JSON file ")])]),_:1})):j("",!0),e(c)("excelImport",!1,e(v))?(s(),P(V,{key:"quick-import-excel",onClick:t[3]||(t[3]=T=>A("excel"))},{default:r(()=>[u("div",ka,[n(l,{icon:"excel",class:"group-hover:text-black"}),I(" Microsoft Excel ")])]),_:1})):j("",!0)]),_:1}),j("",!0)],64)}}}),ja={key:0,class:"flex flex-row items-center py-2.25 px-2.5 bg-gray-50 rounded-lg text-gray-700 mb-4"},ha={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Zt=ie({__name:"TableDelete",props:{visible:{type:Boolean},tableId:{},projectId:{}},emits:["update:visible"],setup(f,{emit:N}){const m=f,c=De(m,"visible",N),{$e:v,$api:k}=fe(),{closeTab:_}=he(),{getMeta:A,removeMeta:$}=Lt(),{loadTables:t,projectUrl:d,isXcdbBase:l}=Pe(),{refreshCommandPalette:B}=Re(),{projectTables:V,activeTable:H}=se(de()),{openTable:T}=de(),p=Q(()=>V.value.get(m.projectId)??[]),D=Q(()=>p.value.find(L=>L.id===m.tableId)),F=M(!1),Z=async()=>{var y,g;if(!D.value)return;const L=JSON.parse(JSON.stringify(D.value)),G=(y=H.value)==null?void 0:y.id;F.value=!0;try{const E=await A(L.id,!0),U=(g=E==null?void 0:E.columns)==null?void 0:g.filter(o=>o.uidt===xo.LinkToAnotherRecord&&!ko(o));if(U!=null&&U.length&&!l(L.base_id)){const o=await Promise.all(U.map(async(b,C)=>{var z;const w=await A((z=b==null?void 0:b.colOptions)==null?void 0:z.fk_related_model_id);return`${C+1}. ${b.title} is a LinkToAnotherRecord of ${w&&w.title||b.title}`}));ne.info(Vt("div",{innerHTML:`<div style="padding:10px 4px">Unable to delete tables because of the following.
              <br><br>${o.join("<br>")}<br><br>
              Delete them & try again</div>`}));return}await k.dbTable.delete(L.id),await _({type:wo.TABLE,id:L.id,title:L.title}),await t(),$(L.id),B(),v("a:table:delete"),G===L.id&&(p.value.length===0?await Ee(d({id:m.projectId,type:"database"})):await T(p.value[0]));const R=p.value.findIndex(o=>o.id===L.id);R>-1&&p.value.splice(R,1),c.value=!1}catch(E){ne.error(await me(E))}finally{F.value=!1}};return(L,G)=>{const y=Yo,g=qt;return s(),P(g,{visible:e(c),"onUpdate:visible":G[0]||(G[0]=E=>W(c)?c.value=E:null),"entity-name":L.$t("objects.table"),"on-delete":Z},{"entity-preview":r(()=>[e(D)?(s(),h("div",ja,[n(y,{meta:e(D),class:"nc-view-icon"},null,8,["meta"]),u("div",ha,S(e(D).title),1)])):j("",!0)]),_:1},8,["visible","entity-name"])}}}),$a={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ca=u("path",{fill:"currentColor",d:"M12 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5a5 5 0 0 1 5-5a5 5 0 0 1 5 5a5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"},null,-1),Ta=[Ca];function Ia(f,N){return s(),h("svg",$a,Ta)}const Da={name:"mdi-eye",render:Ia},Pa=Bt(()=>Ut(()=>import("./EmojiPicker.4ea4095e.js"),["./EmojiPicker.4ea4095e.js","./entry.51f4e399.js","./entry.0f786d51.css","./ViewIcon.vue.9fe867dc.js","./ViewIcon.fd2d300a.css","./_plugin-vue_export-helper.c27b6911.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./EmojiPicker.6d557f4e.css"],import.meta.url).then(f=>f.default||f)),Ma=f=>($o("data-v-298dda74"),f=f(),Co(),f),Va=["data-order","data-id","data-testid","data-table-id"],Sa=["data-testid"],Ea=Ma(()=>u("div",{class:"flex flex-grow h-full"},null,-1)),Ba=["data-testid"],Ua=["data-testid"],Oa={class:"nc-project-menu-item text-red-600"},Na=ie({__name:"TableNode",props:{project:{},table:{},baseIndex:{default:0}},setup(f){const N=f,m=pe(N,"project"),c=pe(N,"table"),v=pe(N,"baseIndex"),k=jo(),{isUIAllowed:_}=Ae(),A=he(),{updateTab:$}=A,{$e:t,$api:d}=fe();Rt({projectId:m.value.id});const l=xe(He),{setMenuContext:B,openRenameTableDialog:V,duplicateTable:H}=xe(at),{projectTables:T}=se(de()),p=Q(()=>T.value.get(m.value.id)??[]),D=Q(()=>k.params.viewId),F=M(!1),Z=async(y,g)=>{try{g.meta={...g.meta||{},icon:y},p.value.splice(p.value.indexOf(g),1,{...g}),$({id:g.id},{meta:g.meta}),await d.dbTable.update(g.id,{meta:g.meta}),t("a:table:icon:navdraw",{icon:y})}catch(E){ne.error(await me(E))}},{isSharedBase:L}=Pe(),G=Q(()=>_("tableIconCustomisation",!1,l==null?void 0:l.value));return(y,g)=>{const E=ho,U=Da,R=Xo,o=Pa,b=St,C=Le,w=et,z=Et,q=Kt,K=Zt,ee=ea;return s(),h("div",{class:J(["nc-tree-item text-sm cursor-pointer group select-none",[`nc-project-tree-tbl nc-project-tree-tbl-${e(c).title}`,{active:e(D)===e(c).id}]]),"data-order":e(c).order,"data-id":e(c).id,"data-testid":`tree-view-table-${e(c).title}`,"data-table-id":e(c).id},[n(ee,{class:J(["pl-11 pr-0.75 mb-0.25 rounded-md h-7.1",{"hover:bg-gray-200":e(D)!==e(c).id,"pl-17.75":e(v)!==0,"pl-12.25":e(v)===0}]),"modifier-key":"Alt"},{title:r(()=>[I(S(e(c).table_name),1)]),default:r(()=>{var ke,ue,ve;return[u("div",{class:"table-context flex items-center gap-1 h-full",onContextmenu:g[6]||(g[6]=le=>e(B)("table",e(c)))},[u("div",{class:"flex w-auto","data-testid":`tree-view-table-draggable-handle-${e(c).title}`},[u("div",{class:J(["flex items-center nc-table-icon",{"pointer-events-none":!e(G)}]),onClick:g[1]||(g[1]=ce(()=>{},["stop"]))},[(s(),P(o,{key:(ke=e(c).meta)==null?void 0:ke.icon,emoji:(ue=e(c).meta)==null?void 0:ue.icon,size:"small",readonly:!e(G),onEmojiSelected:g[0]||(g[0]=le=>Z(le,e(c)))},{default:r(()=>[n(R,{class:"flex",placement:"topLeft","hide-on-click":"",disabled:!e(G)},{title:r(()=>[I(S("Change icon"))]),default:r(()=>[e(c).type==="table"?(s(),P(E,{key:0,class:J(["flex w-5 !text-gray-500 text-sm",{"group-hover:text-gray-500":e(_)("treeview-drag-n-drop",!1,e(l)),"!text-black":e(D)===e(c).id}])},null,8,["class"])):(s(),P(U,{key:1,class:J(["flex w-5 !text-gray-500 text-sm",{"group-hover:text-gray-500":e(_)("treeview-drag-n-drop",!1,e(l)),"!text-black":e(D)===e(c).id}])},null,8,["class"]))]),_:1},8,["disabled"])]),_:1},8,["emoji","readonly"]))],2)],8,Sa),u("span",{class:J(["nc-tbl-title capitalize text-ellipsis overflow-hidden select-none",{"text-black !font-semibold":e(D)===e(c).id}]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},S(e(c).title),3),Ea,!e(L)&&(e(_)("table-rename",!1,e(l))||e(_)("table-delete",!1,e(l)))?(s(),P(q,{key:0,trigger:["click"],onClick:g[5]||(g[5]=ce(()=>{},["stop"]))},{overlay:r(()=>[n(z,{class:"!py-0 rounded text-sm"},{default:r(()=>{var le;return[e(_)("table-rename",!1,e(l))?(s(),P(w,{key:0,onClick:g[2]||(g[2]=_e=>e(V)(e(c),e(m).bases[e(v)].id))},{default:r(()=>[u("div",{class:"nc-project-menu-item","data-testid":`sidebar-table-rename-${e(c).title}`},[n(C,{icon:"edit",class:"text-gray-700"}),I(" "+S(y.$t("general.rename")),1)],8,Ba)]),_:1})):j("",!0),e(_)("table-duplicate")&&((le=e(m).bases)!=null&&le[e(v)])&&(e(m).bases[e(v)].is_meta||e(m).bases[e(v)].is_local)?(s(),P(w,{key:1,onClick:g[3]||(g[3]=_e=>e(H)(e(c)))},{default:r(()=>[u("div",{class:"nc-project-menu-item","data-testid":`sidebar-table-duplicate-${e(c).title}`},[n(C,{icon:"duplicate",class:"text-gray-700"}),I(" "+S(y.$t("general.duplicate")),1)],8,Ua)]),_:1})):j("",!0),e(_)("table-delete",!1,e(l))?(s(),P(w,{key:2,"data-testid":`sidebar-table-delete-${e(c).title}`,onClick:g[4]||(g[4]=_e=>F.value=!0)},{default:r(()=>[u("div",Oa,[n(C,{icon:"delete"}),I(" "+S(y.$t("general.delete")),1)])]),_:1},8,["data-testid"])):j("",!0)]}),_:1})]),default:r(()=>[n(b,{class:J(["min-w-5.75 min-h-5.75 mt-0.2 mr-0.25 px-0.5 transition-opacity opacity-0 group-hover:opacity-100 nc-tbl-context-menu outline-0 rounded-md hover:bg-gray-500 hover:bg-opacity-15 !hover:text-black",{"!text-gray-600":e(D)!==e(c).id,"!text-black":e(D)===e(c).id}])},null,8,["class"])]),_:1})):j("",!0)],32),e(c).id&&((ve=e(m))!=null&&ve.id)?(s(),P(K,{key:0,visible:e(F),"onUpdate:visible":g[7]||(g[7]=le=>W(F)?F.value=le:null),"table-id":e(c).id,"project-id":e(m).id},null,8,["visible","table-id","project-id"])):j("",!0)]}),_:1},8,["class"])],10,Va)}}});const La=nt(Na,[["__scopeId","data-v-298dda74"]]),Ra={class:"border-none sortable-list"},Aa=["nc-base"],Ha=ie({__name:"TableList",props:{project:{},baseIndex:{default:0}},setup(f){const N=f,m=pe(N,"project"),c=pe(N,"baseIndex"),v=Q(()=>{var T,p;return(p=(T=m.value)==null?void 0:T.bases)==null?void 0:p[c.value]}),{projectTables:k}=se(de()),_=Q(()=>k.value.get(m.value.id)??[]),{$api:A}=fe(),{openTable:$}=Rt({projectId:m.value.id}),t=Q(()=>_.value.reduce((T,p)=>(T[p.id]=p,T),{})),d=M({}),l=M(),B={},V=T=>{const p=T.getAttribute("nc-base");p&&(B[p]&&B[p].destroy(),Qo.create(T,{onEnd:async D=>{var b,C;const F=_.value.findIndex(w=>w.base_id===p),{newIndex:Z=0,oldIndex:L=0}=D;if(Z===L)return;const G=D.item,y=t.value[G.dataset.id],g=D.to.children;if(g.length<2)return;const E=g[Z-1],U=g[Z+1],R=E&&t.value[E.dataset.id],o=U&&t.value[U.dataset.id];g.length-1===D.newIndex?y.order=R.order+1:Z===0?y.order=o.order/2:y.order=(R.order+o.order)/2,(C=_.value)==null||C.splice(Z+F,0,...(b=_.value)==null?void 0:b.splice(L+F,1)),d.value[p]?d.value[p]=d.value[p]+1:d.value[p]=1,await A.dbTable.reorder(y.id,{order:y.order})},animation:150,setData(D,F){D.setData("text/json",JSON.stringify({id:F.dataset.id,title:F.dataset.title,type:F.dataset.type,baseId:F.dataset.baseId}))},revertOnSpill:!0}))};Ct(()=>{l.value&&(l.value instanceof HTMLElement?V(l.value):l.value.forEach(T=>V(T)))});const H=Q(()=>_.value.filter(T=>{var p,D;return T.base_id===((D=(p=m.value)==null?void 0:p.bases)==null?void 0:D[c.value].id)}));return(T,p)=>{var F,Z,L,G,y,g;const D=Ot("e");return s(),h("div",Ra,[e(m)?(s(),h(ae,{key:0},[e(H).length===0?(s(),h("div",{key:0,class:J(["py-0.5 text-gray-500",{"ml-13.55":e(c)===0,"ml-19.25":e(c)!==0}])}," Empty ",2)):j("",!0),(F=e(m).bases)!=null&&F[e(c)]&&e(m).bases[e(c)].enabled?(s(),h("div",{ref_key:"menuRefs",ref:l,key:`sortable-${(Z=e(v))==null?void 0:Z.id}-${(L=e(v))!=null&&L.id&&((G=e(v))==null?void 0:G.id)in e(d)?e(d)[(y=e(v))==null?void 0:y.id]:"0"}`,"nc-base":(g=e(v))==null?void 0:g.id},[(s(!0),h(ae,null,tt(e(H),E=>{var U;return ge((s(),P(La,{key:E.id,class:"nc-tree-item text-sm cursor-pointer group","data-order":E.order,"data-id":E.id,"data-testid":`tree-view-table-${E.title}`,table:E,project:e(m),"base-index":e(c),"data-title":E.title,"data-base-id":(U=e(v))==null?void 0:U.id,"data-type":E.type,onClick:R=>e($)(E)},null,8,["data-order","data-id","data-testid","table","project","base-index","data-title","data-base-id","data-type","onClick"])),[[D,["a:table:open"]]])}),128))],8,Aa)):j("",!0)],64)):j("",!0)])}}}),za={key:0,class:"flex flex-row items-center py-2 px-2.25 bg-gray-50 rounded-lg text-gray-700 mb-4"},Fa={class:"capitalize text-ellipsis overflow-hidden select-none w-full pl-1.75",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},Ga=ie({__name:"ProjectDelete",props:{visible:{type:Boolean},projectId:{}},emits:["update:visible"],setup(f,{emit:N}){const m=f,c=De(m,"visible",N),{closeTab:v}=he(),k=Ne(),{deleteProject:_,navigateToFirstProjectOrHome:A}=k,{projects:$}=se(k),{refreshCommandPalette:t}=Re(),d=Q(()=>$.value.get(m.projectId)),l=M(!1);se(k);const B=async()=>{if(!d.value)return;const V=JSON.parse(JSON.stringify(d.value));l.value=!0;try{await _(V.id),await v(V.id),t(),c.value=!1,V.id===k.activeProjectId&&await A()}catch(H){ne.error(await me(H))}finally{l.value=!1}};return(V,H)=>{const T=ot,p=qt;return s(),P(p,{visible:e(c),"onUpdate:visible":H[0]||(H[0]=D=>W(c)?c.value=D:null),"entity-name":V.$t("objects.project"),"on-delete":B},{"entity-preview":r(()=>[e(d)?(s(),h("div",za,[n(T,{type:e(d).type,class:"nc-view-icon px-1.5"},null,8,["type"]),u("div",Fa,S(e(d).title),1)])):j("",!0)]),_:1},8,["visible","entity-name"])}}}),qa={class:"mt-4"},Ka={class:"prose-md self-center text-gray-500 mt-4"},Ja={class:"text-xs p-2"},Za={class:"flex flex-row gap-x-2 mt-2.5 pt-2.5 justify-end"},Wa=ie({__name:"ProjectDuplicate",props:{modelValue:{type:Boolean},project:{},onOk:{type:Function}},emits:["update:modelValue"],setup(f,{emit:N}){const m=f,{api:c}=Dt(),v=De(m,"modelValue",N),k=M({includeData:!0,includeViews:!0,includeHooks:!0}),_=Q(()=>{const{includeData:d,includeViews:l,includeHooks:B}=k.value;return{excludeData:!d,excludeViews:!l,excludeHooks:!B}}),A=M(!1),$=async()=>{try{A.value=!0;const d=wt[Math.floor(Math.random()*1e3)%wt.length],B=To(d).complement(),V=await c.project.duplicate(m.project.id,{options:_.value,project:{fk_workspace_id:m.project.fk_workspace_id,type:m.project.type,color:d,meta:JSON.stringify({theme:{primaryColor:d,accentColor:B.toHex8String()}})}});m.onOk(V)}catch(d){ne.error(await me(d))}finally{A.value=!1,v.value=!1}};Ye("Enter",()=>{v.value&&$()});const t=M(!1);return(d,l)=>{const B=Ft,V=zt,H=Xe,T=Ht;return d.project?(s(),P(T,{key:0,visible:e(v),"onUpdate:visible":l[5]||(l[5]=p=>W(v)?v.value=p:null),class:"!w-[30rem]","wrap-class-name":"nc-modal-project-duplicate"},{default:r(()=>[u("div",null,[u("div",{class:"prose-xl font-bold self-center",onDblclick:l[0]||(l[0]=p=>t.value=!e(t))},S(d.$t("general.duplicate"))+" "+S(d.$t("objects.project")),33),u("div",qa,"Are you sure you want to duplicate the `"+S(d.project.title)+"` project?",1),u("div",Ka,S(d.$t("title.advancedSettings")),1),n(B,{class:"!m-0 !p-0 !my-2"}),u("div",Ja,[n(V,{checked:e(k).includeData,"onUpdate:checked":l[1]||(l[1]=p=>e(k).includeData=p)},{default:r(()=>[I("Include data")]),_:1},8,["checked"]),n(V,{checked:e(k).includeViews,"onUpdate:checked":l[2]||(l[2]=p=>e(k).includeViews=p)},{default:r(()=>[I("Include views")]),_:1},8,["checked"]),ge(n(V,{checked:e(k).includeHooks,"onUpdate:checked":l[3]||(l[3]=p=>e(k).includeHooks=p)},{default:r(()=>[I("Include webhooks")]),_:1},8,["checked"]),[[Pt,e(t)]])])]),u("div",Za,[n(H,{key:"back",type:"secondary",onClick:l[4]||(l[4]=p=>v.value=!1)},{default:r(()=>[I(S(d.$t("general.cancel")),1)]),_:1}),n(H,{key:"submit",loading:e(A),onClick:$},{default:r(()=>[I(S(d.$t("general.confirm")),1)]),_:1},8,["loading"])])]),_:1},8,["visible"])):j("",!0)}}}),Qa={class:"nc-icon",viewBox:"0 0 256 256",width:"1.2em",height:"1.2em"},Xa=u("path",{fill:"currentColor",d:"M236.78 211.81A24.34 24.34 0 0 1 215.45 224H40.55a24.34 24.34 0 0 1-21.33-12.19a23.51 23.51 0 0 1 0-23.72l87.43-151.87a24.76 24.76 0 0 1 42.7 0l87.45 151.87a23.51 23.51 0 0 1-.02 23.72Z"},null,-1),Ya=[Xa];function en(f,N){return s(),h("svg",Qa,Ya)}const tn={name:"ph-triangle-fill",render:en},on=Bt(()=>Ut(()=>import("./EmojiPicker.4ea4095e.js"),["./EmojiPicker.4ea4095e.js","./entry.51f4e399.js","./entry.0f786d51.css","./ViewIcon.vue.9fe867dc.js","./ViewIcon.fd2d300a.css","./_plugin-vue_export-helper.c27b6911.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./EmojiPicker.6d557f4e.css"],import.meta.url).then(f=>f.default||f)),an=["data-testid","data-project-id"],nn=["data-testid"],sn={class:"flex items-center select-none w-6 h-full"},ln=["onKeyup"],rn={class:"nc-project-menu-item group"},cn=["onClick"],dn={class:"nc-menu-item-wrapper"},un={class:"nc-project-menu-item group"},pn={class:"nc-project-menu-item group text-red-500"},mn=["onClick"],fn={key:0,class:"flex flex-row items-center"},vn={key:0,class:"flex-1"},_n={class:"transition-height duration-200"},bn={key:1,class:"transition-height duration-200"},yn={class:"border-none sortable-list"},gn={class:"flex flex-row items-center -mt-2"},xn={class:"min-w-20 w-full flex flex-row"},kn=["onContextmenu"],wn=["onContextmenu"],jn=["data-testid"],hn={key:2,class:"flex flex-row items-center gap-x-0.25 w-12.25"},$n={class:"nc-project-menu-item group"},Cn=["onClick"],Tn=["nc-base"],In={class:"nc-project-menu-item"},Dn={class:"nc-project-menu-item"},Pn={class:"nc-project-menu-item text-red-600"},Mn={class:"nc-project-menu-item"},Vn=ie({__name:"ProjectNode",setup(f,{expose:N}){const m=Vt(Io,{class:"!text-gray-400",style:{fontSize:"0.85rem"},spin:!0}),v=Nt().currentRoute,{setMenuContext:k,openRenameTableDialog:_,duplicateTable:A,contextMenuTarget:$}=xe(at),t=xe(Gt),d=Ne(),{loadProject:l,loadProjects:B,createProject:V,updateProject:H,getProjectMetaInfo:T}=d,{projects:p}=se(d),{loadProjectTables:D}=de(),{activeTable:F}=se(de()),{appInfo:Z,navigateToProject:L}=Do();he();const G=M(!1),y=M(""),{t:g}=Po(),E=M(),{isUIAllowed:U}=Ae(),R=xe(He),{activeProjectId:o}=se(Ne()),{projectUrl:b}=Pe(),C=xe(Wo,()=>{}),{$e:w}=fe(),z=M(!1),q=M({}),K=M([]),[ee]=Mo(),ke=M(""),ue=M({}),ve=M(!1),le=M(!1),_e=Q(()=>{var O;const i=String((O=v.value)==null?void 0:O.name).split("projectId-index-index");if(i.length<=1)return!1;const a=i[i.length-1];return a.split("-").length===2||a.split("-").length===1}),st=()=>{G.value=!0,y.value=t.value.title,Tt(()=>{var i,a,O;(i=E.value)==null||i.focus(),(a=E.value)==null||a.select(),(O=E.value)==null||O.scrollIntoView()})},ze=async()=>{var i;if(y.value)try{await H(t.value.id,{title:y.value}),G.value=!1,y.value="",w("a:project:rename"),It(`${(i=t.value)==null?void 0:i.title}`)}catch(a){ne.error(await me(a))}},{copy:Wt}=ta(!0),Qt=async()=>{try{await Wt(Object.entries(await T(t.value.id)).map(([i,a])=>`${i}: **${a}**`).join(`
`))&&ne.info(g("msg.info.copiedToClipboard"))}catch(i){console.error(i),ne.error(i.message)}};N({enableEditMode:st});const Xt=async(i,a)=>{try{const O={...a.meta||{},icon:i};d.updateProject(a.id,{meta:JSON.stringify(O)}),w("a:project:icon:navdraw",{icon:i})}catch(O){ne.error(await me(O))}};function lt(i){var we,Ce,X;w("c:table:create:navdraw");const a=M(!0);let O=(we=t.value.bases)==null?void 0:we[0].id;if(typeof i=="number"&&(O=(Ce=t.value.bases)==null?void 0:Ce[i].id),!O||!((X=t.value)!=null&&X.id))return;const{close:te}=je(At,{modelValue:a,baseId:O,projectId:t.value.id,onCreate:be,"onUpdate:modelValue":()=>be()});function be(Y){a.value=!1,Y&&(t.value.isExpanded=!0,(!K.value||!K.value.includes(`collapse-${O}`))&&K.value.push(`collapse-${O}`),setTimeout(()=>{const ye=document.querySelector(`[data-table-id="${Y.id}"]`);ye&&Qe(ye)&&(ye==null||ye.scrollIntoView({behavior:"smooth"}))},1e3),te(1e3))}}const $e=M(!1),Yt=async()=>{if($e.value)return;$e.value=!0,!d.isProjectPopulated(t.value.id)&&t.value.type===Ue.DB&&D(t.value.id);try{lt(),!t.value.isExpanded&&t.value.type!==Ue.DB&&(t.value.isExpanded=!0)}finally{$e.value=!1}},Fe=M(!1),Me=async(i,a,O)=>{if(!i)return;O?i.isExpanded=!i.isExpanded:i.isExpanded=!0;const te=d.isProjectPopulated(i.id);let be=!1;if(v.value.params.typeOrId==="base"&&(be=!0),te||(i.isLoading=!0),a||await Ee(b({id:i.id,type:"database",isSharedBase:be})),te||await D(i.id),!te){const we=p.value.get(i.id);we.isLoading=!1}};function eo(i){Ee(`/nc/${i.project_id}/erd/${i.id}`)}async function to(i){var te;if(!i.id)return;d.isProjectPopulated(i.id)||await l(i.id);const a=p.value.get(i.id),O=(te=a==null?void 0:a.bases)==null?void 0:te[0];O&&Ee(`/nc/${O.project_id}/erd/${O.id}`)}const oo=async()=>{w("a:table:refresh:navdraw")},it=Q(()=>{var i,a;if($.type==="base")return $.value;if($.type==="table"){const O=(a=(i=t.value)==null?void 0:i.bases)==null?void 0:a.find(te=>te.id===$.value.base_id);if(O)return O}return null});Ze(()=>{var i;return(i=F.value)==null?void 0:i.id},async()=>{if(!F.value)return;const i=F.value.base_id;i&&(K.value.includes(`collapse-${i}`)||K.value.push(`collapse-${i}`))},{immediate:!0}),Ye("Escape",()=>{z.value&&(z.value=!1);for(const i of Object.keys(q.value))q.value[i]=!1});const Ve=M(!1),Ge=M(),ao=i=>{Ge.value=i,Ve.value=!0},{$jobs:no}=fe(),so=async i=>{await B("workspace"),no.subscribe({id:i.id},void 0,async a=>{if(a===Oe.COMPLETED){await B("workspace");const O=p.value.get(i.project_id);O&&await L({projectId:O.id,type:O.type})}else a===Oe.FAILED&&(ne.error("Failed to duplicate project"),await B("workspace"))}),w("a:project:duplicate")};return(i,a)=>{var ut,pt,mt,ft,vt;const O=tn,te=na,be=ot,we=on,Ce=St,X=Le,Y=et,ye=Mt,rt=wa,qe=Et,Ke=Kt,lo=Ko,ct=Ha,dt=Jo,io=Uo,ro=sa,co=la,uo=Zt,po=Ga,mo=Wa,Je=Ot("e");return s(),h(ae,null,[n(Ke,{trigger:["contextmenu"],"overlay-class-name":"nc-dropdown-tree-view-context-menu"},Vo({default:r(()=>{var re,Te,Ie,_t,bt,yt,gt,xt,kt;return[u("div",{class:J(["mx-1 nc-project-sub-menu rounded-md",{active:e(t).isExpanded}]),"data-testid":`nc-sidebar-project-${e(t).title}`,"data-project-id":e(t).id},[u("div",{class:"flex items-center gap-0.75 py-0.25 cursor-pointer",onContextmenu:a[16]||(a[16]=x=>e(k)("project",e(t)))},[u("div",{ref:"projectNodeRefs",class:J([{"bg-primary-selected active":e(o)===e(t).id&&e(_e),"hover:bg-gray-200":!(e(o)===e(t).id&&e(_e))},"project-title-node h-7.25 flex-grow rounded-md group flex items-center w-full"]),"data-testid":`nc-sidebar-project-title-${e(t).title}`},[u("div",{class:"nc-sidebar-expand ml-0.75 min-h-5.75 min-w-5.75 px-1.5 text-gray-500 hover:hover:bg-gray-500 hover:hover:bg-opacity-15 !hover:text-black rounded-md relative",onClick:a[0]||(a[0]=x=>Me(e(t),!0,!0))},[n(O,{class:J(["absolute top-2.25 left-2 group-hover:visible cursor-pointer transform transition-transform duration-500 h-1.5 w-1.75 rotate-90",{"!rotate-180":e(t).isExpanded,"!visible":e(z)}])},null,8,["class"])]),u("div",{class:"flex items-center mr-1",onClick:a[2]||(a[2]=x=>Me(e(t)))},[u("div",sn,[e(t).isLoading?(s(),P(te,{key:0,class:"nc-sidebar-icon !flex !flex-row !items-center !my-0.5 !mx-1.5 w-8",indicator:e(m)},null,8,["indicator"])):j("",!0),(s(),P(we,{key:(re=e(t).meta)==null?void 0:re.icon,emoji:(Te=e(t).meta)==null?void 0:Te.icon,readonly:!0,size:"small",onEmojiSelected:a[1]||(a[1]=x=>Xt(x,e(t)))},{default:r(()=>[n(be,{type:e(t).type},null,8,["type"])]),_:1},8,["emoji"]))])]),e(G)?ge((s(),h("input",{key:0,ref_key:"input",ref:E,"onUpdate:modelValue":a[3]||(a[3]=x=>W(y)?y.value=x:null),class:J(["flex-grow leading-1 outline-0 ring-none capitalize !text-inherit !bg-transparent w-4/5",{"text-black font-semibold":e(o)===e(t).id&&e(_e)}]),onClick:a[4]||(a[4]=ce(()=>{},["stop"])),onKeyup:[Be(ze,["enter"]),Be(ze,["esc"])],onBlur:ze},null,42,ln)),[[So,e(y)]]):(s(),h("span",{key:1,class:J(["capitalize text-ellipsis overflow-hidden select-none",{"text-black font-semibold":e(o)===e(t).id&&e(_e)}]),style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"},onClick:a[5]||(a[5]=x=>Me(e(t)))},S(e(t).title),3)),u("div",{class:J({"flex flex-grow h-full":!e(G)}),onClick:a[6]||(a[6]=x=>Me(e(t)))},null,2),e(U)("tableCreate",!1,e(R))?(s(),P(Ke,{key:2,visible:e(z),"onUpdate:visible":a[15]||(a[15]=x=>W(z)?z.value=x:null),trigger:"click"},{overlay:r(()=>[n(qe,{class:"nc-scrollbar-md",style:{maxHeight:"70vh",overflow:"overlay"},onClick:a[14]||(a[14]=x=>z.value=!1)},{default:r(()=>[e(Fe)?j("",!0):(s(),h(ae,{key:0},[n(Y,{onClick:st},{default:r(()=>[u("div",rn,[n(X,{icon:"edit",class:"group-hover:text-black"}),I(" "+S(i.$t("general.rename")),1)])]),_:1}),("isEeUI"in i?i.isEeUI:e(aa))?j("",!0):(s(),P(Y,{key:"copy"},{default:r(()=>[ge((s(),h("div",{class:"nc-project-menu-item group",onClick:ce(Qt,["stop"])},[n(X,{icon:"copy",class:"group-hover:text-black"}),I(" "+S(i.$t("activity.account.projInfo")),1)],8,cn)),[[Je,["c:navbar:user:copy-proj-info"]]])]),_:1})),e(U)("duplicateProject",!0,e(R))?(s(),P(Y,{key:1,onClick:a[8]||(a[8]=x=>ao(e(t)))},{default:r(()=>[u("div",dn,[n(X,{icon:"duplicate",class:"text-gray-700"}),I(" "+S(i.$t("general.duplicate")),1)])]),_:1})):j("",!0),j("",!0),n(Y,{key:"erd",onClick:a[9]||(a[9]=x=>to(e(t)))},{default:r(()=>[u("div",un,[n(X,{icon:"erd"}),I(" Relations ")])]),_:1}),n(Y,{key:"api"},{default:r(()=>[e(U)("apiDocs")?ge((s(),h("div",{key:0,class:"nc-project-menu-item group",onClick:a[10]||(a[10]=ce(x=>e(oa)(`/api/v1/db/meta/projects/${e(t).id}/swagger`,e(Z).ncSiteUrl),["stop"]))},[n(X,{icon:"snippet",class:"group-hover:text-black"}),I(" "+S(i.$t("activity.account.swagger")),1)])),[[Je,["e:api-docs"]]]):j("",!0)]),_:1})],64)),n(Y,{key:"teamAndSettings"},{default:r(()=>[e(U)("settings")?ge((s(),h("div",{key:0,class:"nc-project-menu-item group",onClick:a[11]||(a[11]=x=>e(C)(!0,"teamAndAuth",void 0,e(t).id))},[n(X,{icon:"settings",class:"group-hover:text-black"}),I(" "+S(i.$t("activity.settings")),1)])),[[Je,["c:navdraw:project-settings"]]]):j("",!0)]),_:1}),e(t).bases&&e(t).bases[0]?(s(),h(ae,{key:1},[n(rt,{project:e(t),"onUpdate:project":a[12]||(a[12]=x=>W(t)?t.value=x:null),base:e(t).bases[0]},null,8,["project","base"]),n(ye)],64)):j("",!0),j("",!0),e(U)("projectDelete",!1,e(R))?(s(),P(Y,{key:3,onClick:a[13]||(a[13]=x=>le.value=!0)},{default:r(()=>[u("div",pn,[n(X,{icon:"delete"}),I(" "+S(i.$t("general.delete")),1)])]),_:1})):j("",!0)]),_:1})]),default:r(()=>[n(Ce,{class:J(["min-w-5.75 min-h-5.75 px-0.5 py-0.5 mr-0.25 !ring-0 focus:!ring-0 !focus:border-0 !focus:outline-0 opacity-0 group-hover:opacity-100 hover:text-black text-gray-600 rounded-md hover:bg-gray-500 hover:bg-opacity-15",{"!text-black !opacity-100":e(z)}]),"data-testid":"nc-sidebar-context-menu",onClick:a[7]||(a[7]=ce(()=>{},["stop"]))},null,8,["class"])]),_:1},8,["visible"])):j("",!0),e(U)("tableCreate",!1,e(R))?(s(),h("div",{key:3,class:J(["min-h-5.75 min-w-5.75 mr-1 flex flex-row items-center justify-center gap-x-2 cursor-pointer hover:text-black text-gray-600 text-sm invisible !group-hover:visible rounded-md hover:bg-gray-500 hover:bg-opacity-15",{"!text-black !visible":e($e),"!visible":e(z)}]),"data-testid":"nc-sidebar-add-project-entity",onClick:ce(Yt,["stop"])},[e($e)?(s(),h("div",fn,[n(te,{class:"!flex !flex-row !items-center !my-0.5",indicator:e(m)},null,8,["indicator"])])):(s(),P(lo,{key:1,class:"min-w-5 min-h-5 py-0.25"}))],10,mn)):j("",!0)],10,nn)],32),e(t).id&&!e(t).isLoading?(s(),h("div",{key:"g1",class:J(["overflow-x-hidden transition-max-height",{"max-h-0":!e(t).isExpanded}])},[e(t)&&((Ie=e(t))!=null&&Ie.bases)?(s(),h("div",{key:0,class:J(["flex-1 overflow-y-auto overflow-x-hidden flex flex-col",{"mb-[20px]":e(Fe)}])},[(yt=(bt=(_t=e(t))==null?void 0:_t.bases)==null?void 0:bt[0])!=null&&yt.enabled?(s(),h("div",vn,[u("div",_n,[n(ct,{project:e(t),"base-index":0},null,8,["project"])])])):j("",!0),(kt=(xt=(gt=e(t))==null?void 0:gt.bases)==null?void 0:xt.slice(1).filter(x=>x.enabled))!=null&&kt.length?(s(),h("div",bn,[u("div",yn,[(s(!0),h(ae,null,tt(e(t).bases,(x,Se)=>(s(),h("div",{key:`base-${x.id}`},[Se===0?(s(),h(ae,{key:0},[],64)):x&&x.enabled?(s(),P(co,{key:1,activeKey:e(K),"onUpdate:activeKey":a[18]||(a[18]=oe=>W(K)?K.value=oe:null),class:J(["!mx-0 !px-0 nc-sidebar-base-node",[{hidden:e(ee)&&!!e(ke)}]]),"expand-icon-position":"left",bordered:!1,ghost:""},{expandIcon:r(({isActive:oe})=>[u("div",gn,[n(O,{class:J(["nc-sidebar-base-node-btns -mt-0.75 invisible cursor-pointer transform transition-transform duration-500 h-1.5 w-1.5 text-gray-500 rotate-90",{"!rotate-180":oe}])},null,8,["class"])])]),default:r(()=>[(s(),P(ro,{key:`collapse-${x.id}`},{header:r(()=>[u("div",xn,[Se===0?(s(),h("div",{key:0,class:"base-context flex items-center gap-2 text-gray-800",onContextmenu:oe=>e(k)("base",x)},[n(dt,{"base-type":x.type},null,8,["base-type"]),I(" Default ")],40,kn)):(s(),h("div",{key:1,class:"base-context flex flex-grow items-center gap-1.75 text-gray-800 min-w-1/20 max-w-full",onContextmenu:oe=>e(k)("base",x)},[n(dt,{"base-type":x.type,class:"min-w-4"},null,8,["base-type"]),u("div",{"data-testid":`nc-sidebar-project-${x.alias}`,class:"flex capitalize text-ellipsis overflow-hidden select-none",style:{wordBreak:"keep-all",whiteSpace:"nowrap",display:"inline"}},S(x.alias||""),9,jn),n(io,null,{title:r(()=>[I("External DB")]),default:r(()=>[u("div",null,[n(X,{icon:"info",class:"text-gray-400 -mt-0.5 hover:text-gray-700 mr-1"})])]),_:1})],40,wn)),e(U)("tableCreate",!1,e(R))?(s(),h("div",hn,[n(Ke,{visible:e(q)[x.id],trigger:"click","onUpdate:visible":oe=>e(q)[x.id]=oe},{overlay:r(()=>[n(qe,{class:"nc-scrollbar-md",style:{maxHeight:"70vh",overflow:"overlay"},onClick:oe=>e(q)[x.id]=!1},{default:r(()=>[n(Y,{key:"erd",onClick:oe=>eo(x)},{default:r(()=>[u("div",$n,[n(X,{icon:"erd"}),I(" Relations ")])]),_:2},1032,["onClick"]),n(rt,{project:e(t),"onUpdate:project":a[17]||(a[17]=oe=>W(t)?t.value=oe:null),base:x},null,8,["project","base"])]),_:2},1032,["onClick"])]),default:r(()=>[n(Ce,{class:J(["min-w-6 min-h-6 mt-0.15 invisible nc-sidebar-base-node-btns !ring-0 focus:!ring-0 !focus:border-0 !focus:outline-0 hover:text-black py-0.25 px-0.5 rounded-md text-gray-600 hover:bg-gray-400 hover:bg-opacity-20",{"!text-black !opacity-100":e(q)[x.id]}]),onClick:ce(oe=>e(q)[x.id]=!e(q)[x.id],["stop"])},null,8,["class","onClick"])]),_:2},1032,["visible","onUpdate:visible"]),e(U)("tableCreate",!1,e(R))?(s(),h("div",{key:0,class:"flex invisible nc-sidebar-base-node-btns !focus:outline-0 text-gray-600 hover:text-black px-0.35 rounded-md hover:bg-gray-500 hover:bg-opacity-15 min-h-6 mt-0.15 min-w-6",onClick:ce(oe=>lt(Se),["stop"])},[(s(),P(Eo(("iconMap"in i?i.iconMap:e(Bo)).plus),{class:"text-inherit mt-0.25 h-5.5 w-5.5 py-0.5 !focus:outline-0"}))],8,Cn)):j("",!0)])):j("",!0)])]),default:r(()=>[(s(),h("div",{ref_for:!0,ref:"menuRefs",key:`sortable-${x.id}-${x.id&&x.id in e(ue)?e(ue)[x.id]:"0"}`,"nc-base":x.id},[n(ct,{project:e(t),"base-index":Se},null,8,["project","base-index"])],8,Tn))]),_:2},1024))]),_:2},1032,["activeKey","class"])):j("",!0)]))),128))])])):j("",!0)],2)):j("",!0)],2)):j("",!0)],10,an)]}),_:2},[e(Fe)?void 0:{name:"overlay",fn:r(()=>[n(qe,{class:"!py-0 rounded text-sm"},{default:r(()=>{var re,Te;return[e($).type==="project"&&e(t).type==="database"?(s(),h(ae,{key:0},[],64)):e($).type==="base"?(s(),h(ae,{key:1},[],64)):e($).type==="table"?(s(),h(ae,{key:2},[e(U)("table-rename")?(s(),P(Y,{key:0,onClick:a[19]||(a[19]=Ie=>e(_)(e($).value,!0))},{default:r(()=>[u("div",In,[n(X,{icon:"edit",class:"text-gray-700"}),I(" "+S(i.$t("general.rename")),1)])]),_:1})):j("",!0),e(U)("table-duplicate")&&((re=e(it))!=null&&re.is_meta||(Te=e(it))!=null&&Te.is_local)?(s(),P(Y,{key:1,onClick:a[20]||(a[20]=Ie=>e(A)(e($).value))},{default:r(()=>[u("div",Dn,[n(X,{icon:"duplicate",class:"text-gray-700"}),I(" "+S(i.$t("general.duplicate")),1)])]),_:1})):j("",!0),e(U)("table-delete")?(s(),P(Y,{key:2,onClick:a[21]||(a[21]=Ie=>ve.value=!0)},{default:r(()=>[u("div",Pn,[n(X,{icon:"delete"}),I(" "+S(i.$t("general.delete")),1)])]),_:1})):j("",!0)],64)):(s(),P(Y,{key:3,onClick:oo},{default:r(()=>[u("div",Mn,S(i.$t("general.reload")),1)]),_:1}))]}),_:1})]),key:"0"}]),1024),(ut=e($).value)!=null&&ut.id&&((pt=e(t))!=null&&pt.id)?(s(),P(uo,{key:0,visible:e(ve),"onUpdate:visible":a[22]||(a[22]=re=>W(ve)?ve.value=re:null),"table-id":(mt=e($).value)==null?void 0:mt.id,"project-id":(ft=e(t))==null?void 0:ft.id},null,8,["visible","table-id","project-id"])):j("",!0),n(po,{visible:e(le),"onUpdate:visible":a[23]||(a[23]=re=>W(le)?le.value=re:null),"project-id":(vt=e(t))==null?void 0:vt.id},null,8,["visible","project-id"]),e(Ge)?(s(),P(mo,{key:1,modelValue:e(Ve),"onUpdate:modelValue":a[24]||(a[24]=re=>W(Ve)?Ve.value=re:null),project:e(Ge),"on-ok":so},null,8,["modelValue","project"])):j("",!0)],64)}}});const Sn=nt(Vn,[["__scopeId","data-v-d29c2cc9"]]),En={class:"nc-icon",stroke:"currentColor",width:"49",height:"48",viewBox:"0 0 49 48",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Bn=["id"],Un=u("rect",{x:"0.5",width:"48",height:"48",fill:"currentColor"},null,-1),On=[Un],Nn=["mask"],Ln=u("path",{d:"M11.25 40C10.4833 40 9.83333 39.7333 9.3 39.2C8.76667 38.6667 8.5 38.0167 8.5 37.25V10.75C8.5 9.98333 8.76667 9.33333 9.3 8.8C9.83333 8.26667 10.4833 8 11.25 8H37.75C38.5167 8 39.1667 8.26667 39.7 8.8C40.2333 9.33333 40.5 9.98333 40.5 10.75V37.25C40.5 38.0167 40.2333 38.6667 39.7 39.2C39.1667 39.7333 38.5167 40 37.75 40H11.25ZM11.25 38.45H37.75C38.0833 38.45 38.3667 38.3333 38.6 38.1C38.8333 37.8667 38.95 37.5833 38.95 37.25V31.3H31.2C30.5333 32.6333 29.5917 33.65 28.375 34.35C27.1583 35.05 25.8667 35.4 24.5 35.4C23.1333 35.4 21.8417 35.05 20.625 34.35C19.4083 33.65 18.4667 32.6333 17.8 31.3H10.05V37.25C10.05 37.5833 10.1667 37.8667 10.4 38.1C10.6333 38.3333 10.9167 38.45 11.25 38.45ZM24.5 33.85C25.6 33.85 26.6333 33.575 27.6 33.025C28.5667 32.475 29.3 31.6833 29.8 30.65C29.9667 30.3167 30.2333 30.0917 30.6 29.975C30.9667 29.8583 31.3333 29.8 31.7 29.8H38.95V10.75C38.95 10.4167 38.8333 10.1333 38.6 9.9C38.3667 9.66667 38.0833 9.55 37.75 9.55H11.25C10.9167 9.55 10.6333 9.66667 10.4 9.9C10.1667 10.1333 10.05 10.4167 10.05 10.75V29.8H17.3C17.6667 29.8 18.0333 29.8583 18.4 29.975C18.7667 30.0917 19.0333 30.3167 19.2 30.65C19.7 31.6833 20.4333 32.475 21.4 33.025C22.3667 33.575 23.4 33.85 24.5 33.85ZM11.25 38.45H10.05H38.95H37.75H11.25Z",fill:"#1C1B1F"},null,-1),Rn=[Ln];function An(f,N){return s(),h("svg",En,[u("mask",{id:f.idMap.mask0_81_24829,style:{"mask-type":"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"49",height:"48"},On,8,Bn),u("g",{mask:"url(#"+f.idMap.mask0_81_24829+")"},Rn,8,Nn)])}const Hn={name:"nc-icons-inbox",render:An,data(){return{idMap:{mask0_81_24829:"uicons-"+(()=>Math.random().toString(36).substr(2,10))()}}}},zn={class:"flex items-center justify-center h-full"},Fn={class:"flex flex-col gap-4 items-center text-gray-500"},Gn=u("div",{class:"font-weight-medium"},"No Projects",-1),qn=u("div",{class:"text-xs"},"Create Project",-1),Kn={class:"flex gap-2 justify mt-1"},Jn={class:"flex gap-2 items-center justify-center text-xs"},Zn=ie({__name:"EmptyPlaceholder",props:{buttons:{type:Boolean}},setup(f){const N=f,m=M(!1),c=M(),v=k=>{c.value=k,m.value=!0};return(k,_)=>{const A=Hn,$=ot,t=Oo,d=Jt;return s(),h("div",zn,[u("div",Fn,[n(A),Gn,N.buttons?(s(),h(ae,{key:0},[qn,u("div",Kn,[n(t,{class:"flex-1 nc-btn",onClick:_[0]||(_[0]=l=>v(e(Ue).DB))},{default:r(()=>[u("div",Jn,[n($,{type:e(Ue).DB,class:"text-[#2824FB] text-lg"},null,8,["type"]),I(" New Database Project ")])]),_:1})]),n(d,{modelValue:e(m),"onUpdate:modelValue":_[1]||(_[1]=l=>W(m)?m.value=l:null),type:e(c)},null,8,["modelValue","type"])],64)):j("",!0)])])}}}),Wn=ie({__name:"ProjectWrapper",props:{projectRole:{},project:{}},setup(f){const N=f,m=pe(N,"projectRole"),c=pe(N,"project");return We(He,m),We(Gt,c),(v,k)=>No(v.$slots,"default")}}),Qn={class:"nc-treeview-container flex flex-col justify-between select-none"},Xn={mode:"inline",class:"nc-treeview pb-0.5 flex-grow min-h-50 overflow-x-hidden"},Yn=ie({__name:"index",setup(f){const{isUIAllowed:N}=Ae(),{addTab:m}=he(),{$e:c,$jobs:v}=fe(),k=Nt(),_=k.currentRoute,A=Ne(),{projects:$,projectsList:t,activeProjectId:d}=se(A),{isWorkspaceLoading:l}=se(Ho()),{openTable:B}=de(),V=M(!1),H=Pe(),{loadTables:T}=H,{tables:p}=se(H),{activeTable:D}=se(de()),{refreshCommandPalette:F}=Re(),Z=$t({}),L=(o,b)=>{Z.type=o,Z.value=b};function G(o,b=!1){if(!o||!o.base_id)return;c(b?"c:table:rename:navdraw:right-click":"c:table:rename:navdraw:options");const C=M(!0),{close:w}=je(da,{modelValue:C,tableMeta:o,baseId:o.base_id,"onUpdate:modelValue":z});function z(){C.value=!1,w(1e3)}}function y(o,b){if(!o&&!(b||t.value[0].id))return;c("c:table:create:navdraw");const C=M(!0),{close:w}=je(At,{modelValue:C,baseId:o,projectId:b||t.value[0].id,"onUpdate:modelValue":z});function z(){C.value=!1,w(1e3)}}const g=async o=>{if(!o||!o.id||!o.project_id)return;const b=M(!0),{close:C}=je(va,{modelValue:b,table:o,onOk:async z=>{v.subscribe({id:z.id},void 0,async(q,K)=>{if(q===Oe.COMPLETED){await T(),F();const ee=p.value.find(ke=>{var ue;return ke.id===((ue=K==null?void 0:K.result)==null?void 0:ue.id)});ee&&m({title:ee.title,id:ee.id,type:ee.type}),B(ee)}else q===Oe.FAILED&&(ne.error("Failed to duplicate table"),await T())}),c("a:table:duplicate")},"onUpdate:modelValue":w});function w(){b.value=!1,C(1e3)}},E=Q(()=>N("table-create")&&_.value.name!=="index"&&_.value.name!=="index-index"&&_.value.name!=="index-index-create"&&_.value.name!=="index-index-create-external"&&_.value.name!=="index-user-index");jt(document,"keydown",async o=>{var C;const b=Lo()?o.metaKey:o.ctrlKey;if(o.altKey&&!o.shiftKey&&!b)switch(o.keyCode){case 84:{if(E.value&&!Ro()){o.preventDefault(),c("c:shortcut",{key:"ALT + T"});const w=d.value,z=w?$.value.get(w):void 0;if(!z)return;w&&y((C=z.bases)==null?void 0:C[0].id,w)}break}case 76:{_.value.params.projectId&&k.push({query:{..._.value.query,clear:_.value.query.clear==="1"?void 0:"1"}});break}case 68:{o.stopPropagation(),V.value=!0;break}}});const U=o=>{var b;(b=document.querySelector(".base-context, .table-context"))!=null&&b.contains(o.target)||L("main")};We(at,{setMenuContext:L,duplicateTable:g,openRenameTableDialog:G,contextMenuTarget:Z}),jt(document,"contextmenu",U,!0);const R=()=>{var b;const o=document.querySelector(`.nc-treeview [data-table-id="${(b=D.value)==null?void 0:b.id}"]`);o&&Qe(o)&&(o==null||o.scrollIntoView({behavior:"smooth"}))};return Ze(()=>{var o;return(o=D.value)==null?void 0:o.id},()=>{var o;(o=D.value)!=null&&o.id&&setTimeout(()=>{R()},1e3)},{immediate:!0}),Ze(d,()=>{const o=document.querySelector(`.nc-treeview [data-project-id="${d.value}"]`);o&&Qe(o)&&(o==null||o.scrollIntoView({behavior:"smooth"}))},{immediate:!0}),(o,b)=>{var q;const C=Sn,w=Zn,z=Jt;return s(),h("div",Qn,[u("div",Xn,[(q=e(t))!=null&&q.length?(s(!0),h(ae,{key:0},tt(e(t),K=>(s(),P(Wn,{key:K.id,"project-role":K.project_role,project:K},{default:r(()=>[n(C)]),_:2},1032,["project-role","project"]))),128)):e(l)?j("",!0):(s(),P(w,{key:1}))]),n(z,{modelValue:e(V),"onUpdate:modelValue":b[0]||(b[0]=K=>W(V)?V.value=K:null)},null,8,["modelValue"])])}}});const yl=nt(Yn,[["__scopeId","data-v-d2135bb7"]]);export{yl as default};
