import{u as j}from"./index.b9981e09.js";import{b as I}from"./index.5263eb1d.js";import{u as _,f as O}from"./useMetas.ba7abae7.js";import{fB as S,r as c,$ as g,i as A,aq as $,f as T}from"./entry.51f4e399.js";import{u as k}from"./index.9e760c64.js";const[N,q]=j((n,b=!1)=>{const{css:h,load:p,unload:G}=S(""),{isUIAllowed:P}=k(),{$api:V}=T(),{metas:x}=_(),{addUndo:y,defineViewScope:C}=O(),a=c({}),r=c(""),t=c("200px"),m=g(I,c(b)),d=A(()=>{var e,u,o;return((o=(u=x.value)==null?void 0:u[(e=n.value)==null?void 0:e.fk_model_id])==null?void 0:o.columns)||[]});$([a,r,t],()=>{var u,o;let e="";for(const s of(d==null?void 0:d.value)||[]){const l=((o=(u=a==null?void 0:a.value)==null?void 0:u[s==null?void 0:s.id])==null?void 0:o.width)||"200px";l&&s.title!==(r==null?void 0:r.value)?e+=`[data-col="${s.id}"]{min-width:${l};max-width:${l};width: ${l};}`:e+=`[data-col="${s.id}"]{min-width:${t==null?void 0:t.value};max-width:${t==null?void 0:t.value};width: ${t==null?void 0:t.value};}`}h.value=e},{deep:!0,immediate:!0});const f=async()=>{var u,o;if(!((u=n.value)!=null&&u.id)&&!m.value)return;const e=(m.value?(o=n.value)==null?void 0:o.columns:await V.dbView.gridColumnsList(n.value.id))??[];a.value=e.reduce((s,l)=>({...s,[l.fk_column_id]:l}),{}),p()};$([()=>{var e;return(e=d.value)==null?void 0:e.length},()=>{var e;return(e=n.value)==null?void 0:e.id}],async e=>{e[1]&&await f()},{immediate:!0});const v=async(e,u,o=!1)=>{var s,l;if(!o){const U=Object.keys(u).reduce((i,w)=>(a.value[e][w]&&(i[w]=a.value[e][w]),i),{});y({redo:{fn:i=>v(e,i,!0),args:[u]},undo:{fn:i=>v(e,i,!0),args:[U]},scope:C({view:n.value})})}!m.value&&P("gridColUpdate")&&((s=a.value[e])!=null&&s.id)&&await V.dbView.gridColumnUpdate(a.value[e].id,{...u}),(l=a.value)!=null&&l[e]?Object.assign(a.value[e],{...a.value[e],...u}):await f()};return{loadGridViewColumns:f,updateGridViewColumn:v,resizingCol:r,resizingColWidth:t,gridViewCols:a,loadCss:p,unloadCss:G}},"useGridViewColumn");function R(){const n=q();if(n==null)throw new Error("Please call `useProvideGridViewColumn` on the appropriate parent component");return n}export{R as a,N as u};
