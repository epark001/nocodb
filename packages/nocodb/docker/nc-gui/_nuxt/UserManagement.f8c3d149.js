import{o as a,c as h,a as s,h as pe,A as me,z as _e,cb as fe,r as p,e4 as ve,cu as xe,cI as ye,E as l,b as r,C as i,w as n,d as F,t as d,H as M,I as he,aV as L,D as x,F as y,W as g,aj as q,cp as we,b5 as O,gn as W,go as H,J as m,K as S,L as ge,P as ke,_ as $e,M as be,N as Ce,Q as Ue,R as je,f as Ie}from"./entry.13466615.js";import{u as Re}from"./useCopy.a0671815.js";import{u as ze}from"./useDashboard.34dd8f64.js";import{a as De}from"./useMetas.223da623.js";import{u as Me}from"./index.e7cf7635.js";import{_ as Se}from"./baseline-more-vert.e69a9b42.js";import{_ as Ae}from"./round-edit.0a696304.js";import{S as Ee}from"./index.f2e6837c.js";import"./index.a8ef1b7e.js";import{I as Pe}from"./Input.16966097.js";import{D as Te}from"./index.82f05b6c.js";import{_ as Le}from"./index.bc4f5185.js";import"./debounce.dbc9bf77.js";import"./toNumber.7aa6a805.js";import"./isSymbol.b9109ae5.js";import"./SearchOutlined.c1eed30a.js";import"./isPlainObject.4c0f42f1.js";import"./_getPrototype.00be30f0.js";import"./TextArea.1bd4034f.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.27b2e5db.js";import"./Password.d7b16461.js";import"./Dropdown.a78be736.js";import"./RightOutlined.2c092523.js";import"./LeftOutlined.b2689280.js";import"./index.4385a501.js";import"./toArray.f6fa5a71.js";import"./isMobile.e2e89480.js";import"./useMemo.4991ab9d.js";import"./useMergedState.1cc2a884.js";import"./useState.a6853ebd.js";import"./DownOutlined.9cfe3e0c.js";import"./CheckOutlined.80115d65.js";import"./useBreakpoint.66a79637.js";import"./responsiveObserve.9209e727.js";const Be={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ne=s("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0c.41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14z"},null,-1),Ve=[Ne];function Fe(U,k){return a(),h("svg",Be,Ve)}const qe={name:"ic-round-search",render:Fe},Oe=Ue(()=>je(()=>import("./UsersModal.159053fe.js"),["./UsersModal.159053fe.js","./entry.13466615.js","./entry.0f786d51.css","./Modal.vue.fe6a4790.js","./DeleteModal.7ab6f524.css","./validation.5ed31fc1.js","./index.a6329415.js","./useCopy.a0671815.js","./useDashboard.34dd8f64.js","./useMetas.223da623.js","./send-outline.95d535cb.js","./index.6f605a00.js","./FormItem.fe59dafe.js","./identity.b813b76e.js","./isSymbol.b9109ae5.js","./_getPrototype.00be30f0.js","./Col.23d910dc.js","./responsiveObserve.9209e727.js","./toArray.f6fa5a71.js","./toNumber.7aa6a805.js","./FormItemContext.27b2e5db.js","./useSize.dec45296.js","./_flatRest.037bf8e3.js","./debounce.dbc9bf77.js","./isPlainObject.4c0f42f1.js","./index.a8ef1b7e.js","./Input.16966097.js","./antInputDirective.8ac36ea7.js","./SearchOutlined.c1eed30a.js","./TextArea.1bd4034f.js","./Password.d7b16461.js","./index.2c1df8bc.js","./index.4385a501.js","./isMobile.e2e89480.js","./useMemo.4991ab9d.js","./useMergedState.1cc2a884.js","./useState.a6853ebd.js","./DownOutlined.9cfe3e0c.js","./CheckOutlined.80115d65.js"],import.meta.url).then(U=>U.default||U)),We={key:0,class:"h-full w-full flex items-center justify-center"},He={key:1,class:"flex flex-col w-full px-6"},Je={class:"flex flex-col h-full"},Ke=s("div",{class:"flex flex-row justify-center mt-2 text-center w-full text-base"}," This action will remove this user from this project ",-1),Qe={class:"flex mt-6 justify-end space-x-2"},Ge={class:"flex flex-row mb-4 mx-4 justify-between pb-2"},Xe={class:"flex w-1/3"},Ye={class:"flex flex-row space-x-1"},Ze={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},et={class:"text-gray-500"},tt={class:"flex flex-row justify-center items-center caption capitalize space-x-1"},st={class:"px-5"},ot={class:"flex flex-row border-b-1 pb-2 px-2"},at={class:"flex flex-row w-3/6 space-x-1 items-center pl-1"},lt={class:"text-gray-600 text-xs space-x-1"},nt={class:"flex flex-row justify-start w-2/6 space-x-1 items-center pl-1"},it={class:"text-gray-600 text-xs"},rt={class:"flex flex-row w-1/6 justify-end items-center pl-1"},ct={class:"text-gray-600 text-xs"},dt={class:"flex w-3/6 flex-wrap nc-user-email"},ut={class:"flex w-2/6 justify-start gap-2 flex-wrap ml-4"},pt={class:"flex w-1/6 flex-wrap justify-end"},mt={class:"flex flex-row items-center"},_t={class:"flex flex-row items-center h-[1.2rem]"},ft=["onClick"],vt={class:"text-xs pl-2"},xt=["onClick"],yt={class:"text-xs pl-2"},es=pe({__name:"UserManagement",setup(U){const{t:k}=me(),{$e:j}=Ie(),{api:I}=_e(),{project:_}=fe(De()),{copy:J}=Re(),{isUIAllowed:K}=Me(),{dashboardUrl:Q}=ze(),A=p(null),w=p(null),$=p(!1),f=p(!1),E=p(!1),B=p(0),b=p(1),R=p(10),C=p(""),v=async(e=b.value,t=R.value)=>{var u,z;try{if(!((u=_.value)!=null&&u.id))return;const c=await I.auth.projectUserList((z=_.value)==null?void 0:z.id,{query:{limit:t,offset:(e-1)*t,query:C.value}});if(!c.users)return;B.value=c.users.pageInfo.totalRows??0,A.value=c.users.list}catch(c){m.error(await S(c))}},G=async e=>{var t;try{if(!((t=_.value)!=null&&t.id))return;e.roles||(e.roles="editor"),await I.auth.projectUserAdd(_.value.id,e),m.success(k("msg.success.userAddedToProject")),await v()}catch(u){m.error(await S(u))}j("a:user:add")},X=async()=>{var e,t;try{if(!((e=_.value)!=null&&e.id)||!((t=w.value)!=null&&t.id))return;await I.auth.projectUserRemove(_.value.id,w.value.id),m.success(k("msg.success.userDeletedFromProject")),await v(),f.value=!1}catch(u){m.error(await S(u))}finally{f.value=!1}j("a:user:delete")},Y=e=>{w.value=e,$.value=!0},Z=()=>{w.value=null,$.value=!0},ee=e=>{w.value=e,f.value=!0},te=async e=>{var t;if((t=_.value)!=null&&t.id){try{await I.auth.projectUserResendInvite(_.value.id,e.id),m.success(k("msg.success.inviteEmailSent")),await v()}catch(u){m.error(await S(u))}j("a:user:resend-invite")}},se=async e=>{if(e.invite_token){try{await J(`${Q.value}#/signup/${e.invite_token}`),m.success(k("msg.success.inviteURLCopied"))}catch(t){m.error(t.message)}j("c:user:copy-url")}};ve(async()=>{A.value||(E.value=!0,await v(),E.value=!1)}),xe(C,()=>{b.value=1,v()},{debounce:300,maxWait:600});const N=e=>{var t;return(t=e.main_roles)==null?void 0:t.split(",").includes(H.SUPER_ADMIN)};return(e,t)=>{const u=Ee,z=Oe,c=ge,oe=ke,ae=qe,le=Pe,ne=Ae,P=$e,ie=Se,V=be,re=Ce,ce=Te,de=Le,T=ye("e");return l(E)?(a(),h("div",We,[r(u,{size:"large"})])):(a(),h("div",He,[(a(),i(z,{key:`${l($)}`,show:l($),"selected-user":l(w),onClosed:t[0]||(t[0]=o=>$.value=!1),onReload:t[1]||(t[1]=o=>v())},null,8,["show","selected-user"])),r(oe,{visible:l(f),"onUpdate:visible":t[3]||(t[3]=o=>M(f)?f.value=o:null),class:he([{active:l(f)},"!rounded-md"]),closable:!1,width:"28rem",centered:"",footer:null,"wrap-class-name":"nc-modal-delete-user"},{default:n(()=>[s("div",Je,[Ke,s("div",Qe,[r(c,{class:"!rounded-md",onClick:t[2]||(t[2]=o=>f.value=!1)},{default:n(()=>[F(d(e.$t("general.cancel")),1)]),_:1}),r(c,{class:"!rounded-md",type:"primary",danger:"",onClick:X},{default:n(()=>[F(d(e.$t("general.confirm")),1)]),_:1})])])]),_:1},8,["visible","class"]),s("div",Ge,[s("div",Xe,[r(le,{value:l(C),"onUpdate:value":t[4]||(t[4]=o=>M(C)?C.value=o:null),placeholder:e.$t("placeholder.filterByEmail")},{prefix:n(()=>[r(ae,{class:"text-gray-400"})]),_:1},8,["value","placeholder"])]),s("div",Ye,[L((a(),i(c,{size:"middle",type:"text",onClick:t[5]||(t[5]=o=>v())},{default:n(()=>[s("div",Ze,[(a(),i(x(l(y).reload),{class:"text-gray-500"})),s("div",et,d(e.$t("general.reload")),1)])]),_:1})),[[T,["a:user:reload"]]]),l(K)("newUser")?L((a(),i(c,{key:0,size:"middle",type:"primary",class:"nc-invite-team !rounded-md",onClick:Z},{default:n(()=>[s("div",tt,[(a(),i(x(l(y).accountPlus),{class:"mr-1"})),s("div",null,d(e.$t("activity.inviteTeam")),1)])]),_:1})),[[T,["c:user:invite"]]]):g("",!0)])]),s("div",st,[s("div",ot,[s("div",at,[(a(),i(x(l(y).email),{class:"flex text-gray-500 -mt-0.5"})),s("div",lt,d(e.$t("labels.email")),1)]),s("div",nt,[(a(),i(x(l(y).role),{class:"flex text-gray-500 -mt-0.5"})),s("div",it,d(e.$t("objects.role")),1)]),s("div",rt,[s("div",ct,d(e.$t("labels.actions")),1)])]),(a(!0),h(q,null,we(l(A),(o,ue)=>(a(),h("div",{key:ue,class:"flex flex-row items-center border-b-1 py-2 px-2 nc-user-row"},[s("div",dt,d(o.email),1),s("div",ut,[N(o)?(a(),h("div",{key:0,class:"rounded-full px-3 py-1 nc-user-role",style:O({backgroundColor:l(W)[l(H).SUPER_ADMIN]})}," Super Admin ",4)):g("",!0),o.roles?(a(),h("div",{key:1,class:"rounded-full px-3 py-1 nc-user-role",style:O({backgroundColor:l(W)[o.roles]})},d(e.$t(`objects.roleType.${o.roles}`)),5)):g("",!0)]),s("div",pt,[N(o)?g("",!0):(a(),h(q,{key:0},[o.project_id?(a(),i(P,{key:0,placement:"bottom"},{title:n(()=>[s("span",null,d(e.$t("activity.editUser")),1)]),default:n(()=>[r(c,{type:"text",class:"!rounded-md nc-user-edit",onClick:D=>Y(o)},{icon:n(()=>[r(ne,{class:"flex mx-auto h-[1rem] text-gray-500"})]),_:2},1032,["onClick"])]),_:2},1024)):g("",!0),o.project_id?(a(),i(P,{key:2,placement:"bottom"},{title:n(()=>[s("span",null,d(e.$t("activity.deleteUser")),1)]),default:n(()=>[L((a(),i(c,{type:"text",class:"!rounded-md nc-user-delete",onClick:D=>ee(o)},{icon:n(()=>[(a(),i(x(l(y).delete),{class:"flex mx-auto h-[1.1rem] text-gray-500"}))]),_:2},1032,["onClick"])),[[T,["c:user:delete"]]])]),_:2},1024)):(a(),i(P,{key:1,placement:"bottom"},{title:n(()=>[s("span",null,d(e.$t("activity.addUserToProject")),1)]),default:n(()=>[r(c,{type:"text",class:"!rounded-md nc-user-invite",onClick:D=>G(o)},{icon:n(()=>[(a(),i(x(l(y).plus),{class:"flex mx-auto h-[1.1rem] text-gray-500"}))]),_:2},1032,["onClick"])]),_:2},1024)),o.invite_token?(a(),i(ce,{key:3,trigger:["click"],class:"flex",placement:"bottomRight","overlay-class-name":"nc-dropdown-user-mgmt"},{overlay:n(()=>[r(re,null,{default:n(()=>[r(V,null,{default:n(()=>[s("div",{class:"flex flex-row items-center py-3",onClick:D=>te(o)},[(a(),i(x(l(y).sendEmail),{class:"flex h-[1rem] text-gray-500"})),s("div",vt,d(e.$t("activity.resendInvite")),1)],8,ft)]),_:2},1024),r(V,null,{default:n(()=>[s("div",{class:"flex flex-row items-center py-3",onClick:D=>se(o)},[(a(),i(x(l(y).copy),{class:"flex h-[1rem] text-gray-500"})),s("div",yt,d(e.$t("activity.copyInviteURL")),1)],8,xt)]),_:2},1024)]),_:2},1024)]),default:n(()=>[s("div",mt,[r(c,{type:"text",class:"!px-0"},{default:n(()=>[s("div",_t,[r(ie)])]),_:1})])]),_:2},1024)):g("",!0)],64))])]))),128)),r(de,{current:l(b),"onUpdate:current":t[6]||(t[6]=o=>M(b)?b.value=o:null),"page-size":l(R),"onUpdate:pageSize":t[7]||(t[7]=o=>M(R)?R.value=o:null),"hide-on-single-page":"",class:"mt-4",total:+l(B),"show-less-items":"",onChange:v},null,8,["current","page-size","total"])])]))}}});export{es as default};
