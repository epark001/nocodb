import{h as X,A as Y,cb as Z,S as ee,r as h,ct as g,i as b,k as te,aq as se,ap as oe,o as r,C as _,w as i,a as t,E as a,c as u,t as c,W as B,D as w,F as k,b as l,cA as ae,aj as le,cp as ie,cs as re,b5 as ne,gn as ce,d as U,Q as de,R as me,J as f,K as ue,L as pe,f as _e}from"./entry.51f4e399.js";import{_ as fe}from"./Modal.vue.b59a28af.js";import{g as ve}from"./validation.6db726f3.js";import{u as ye}from"./index.82c42c24.js";import{u as xe}from"./useCopy.3e897b55.js";import{u as he}from"./useDashboard.fc1e1c09.js";import{a as ge}from"./useMetas.ba7abae7.js";import{_ as be}from"./send-outline.f2f3f49c.js";import{F}from"./index.de92142d.js";import"./index.e760d172.js";import{I as we}from"./Input.7cb175ff.js";import{_ as ke}from"./index.7230021b.js";import{_ as Ue}from"./FormItem.cda40628.js";import{S as je,_ as Ce}from"./index.5e746f62.js";import"./useSize.3b3f469f.js";import"./identity.dd5da9ba.js";import"./isSymbol.b53bd26f.js";import"./_flatRest.ff2d3d5c.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isPlainObject.ecf52d25.js";import"./_getPrototype.ec1165af.js";import"./FormItemContext.e001cd7c.js";import"./SearchOutlined.dec109ce.js";import"./TextArea.442a25cb.js";import"./antInputDirective.8ac36ea7.js";import"./Password.d493e47a.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./toArray.06afb623.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";const $e=de(()=>me(()=>import("./ShareBase.338e5635.js"),["./ShareBase.338e5635.js","./entry.51f4e399.js","./entry.0f786d51.css","./useCopy.3e897b55.js","./useDashboard.fc1e1c09.js","./useMetas.ba7abae7.js","./index.252dc7b4.js","./Dropdown.dc69c0a4.js","./RightOutlined.90e8180f.js","./index.5e746f62.js","./toArray.06afb623.js","./antInputDirective.8ac36ea7.js","./isMobile.e2e89480.js","./useMemo.b13a9257.js","./useMergedState.5e6500b1.js","./useState.6010d8b6.js","./DownOutlined.db6f6406.js","./CheckOutlined.ef30fafc.js","./SearchOutlined.dec109ce.js","./FormItemContext.e001cd7c.js"],import.meta.url).then(n=>n.default||n)),Te={class:"flex flex-col p-6","data-testid":"invite-user-and-share-base-modal"},Me={class:"flex flex-row justify-between items-center pb-1.5 mb-2 border-b-1 border-gray-100 w-full"},Re={key:0,class:"select-none font-medium"},Se={class:"px-2 mt-1.5"},Be={key:0,class:"flex flex-col mt-1 border-b-1 pb-5"},Fe={class:"flex flex-row items-center pl-1.5 pb-1 h-[1.1rem]"},Ve=t("div",{class:"text-xs ml-0.5 mt-0.5"},"Copy Invite Token",-1),Ie={class:"flex flex-row justify-between items-center py-1"},Ae={class:"flex pl-2 text-green-700 text-xs","data-testid":"invite-modal-invitation-url"},De={class:"flex text-xs text-gray-500 mt-2 justify-start ml-2"},Ee={class:"flex flex-row justify-start mt-4 ml-2"},Ne={class:"flex flex-row justify-center items-center space-x-0.5"},Pe={class:"text-xs text-gray-600"},ze={key:1,class:"flex flex-col pb-4"},Le={key:0,class:"flex flex-row items-center pl-2 pb-1 h-[1rem]"},qe={class:"text-xs ml-0.5 mt-0.5"},Oe={class:"border-1 py-3 px-4 rounded-md mt-1"},Ge={class:"flex flex-row space-x-4"},Ke={class:"flex flex-col w-3/4"},Je={class:"ml-1 mb-1 text-xs text-gray-500"},Qe={class:"flex flex-col w-1/4"},We={class:"ml-1 mb-1 text-xs text-gray-500"},He={class:"flex flex-row h-full justify-start items-center"},Xe={class:"flex flex-row justify-end"},Ye={key:0},Ze={key:1,class:"flex flex-row justify-center items-center space-x-1.5"},et={class:"flex"},tt={class:"flex flex-row justify-end gap-x-2 border-t-1 border-gray-100 pt-3"},Et=X({__name:"UsersModal",props:{show:{type:Boolean},selectedUser:{}},emits:["closed","reload"],setup(n,{emit:j}){const{t:C}=Y(),{project:p}=Z(ge()),{isMobileMode:V}=ee(),{$api:$,$e:v}=_e(),{copy:I}=xe(),{dashboardUrl:A}=he(),s=h({emails:void 0,role:g.Viewer,invitationToken:void 0}),T=h(),D=F.useForm,E=b(()=>({emails:[ve]})),{validateInfos:N}=D(s.value,E);te(()=>{var e;!s.value.emails&&((e=n.selectedUser)!=null&&e.email)&&(s.value.emails=n.selectedUser.email,s.value.role=n.selectedUser.roles)});const y=()=>{j("closed"),s.value={role:g.Viewer}},P=async()=>{var e,d;if(v("a:user:invite",{role:s.value.role}),!!p.value.id){await((e=T.value)==null?void 0:e.validateFields());try{if((d=n.selectedUser)!=null&&d.id)await $.auth.projectUserUpdate(p.value.id,n.selectedUser.id,{roles:s.value.role,email:n.selectedUser.email,project_id:p.value.id,projectName:p.value.title}),y();else{const o=await $.auth.projectUserAdd(p.value.id,{roles:s.value.role,email:s.value.emails});s.value.invitationToken=o==null?void 0:o.invite_token}j("reload"),f.success(C("msg.success.userDetailsUpdated"))}catch(o){console.error(o),f.error(await ue(o))}}},x=b(()=>s.value.invitationToken?`${A.value}#/signup/${s.value.invitationToken}`:null),z=async()=>{if(x.value){try{await I(x.value),f.success(C("msg.success.shareableURLCopied"))}catch(e){f.error(e.message)}v("c:shared-base:copy-url")}},L=()=>{v("c:user:invite-more"),s.value.invitationToken=void 0,s.value.role=g.Viewer,s.value.emails=void 0},M=h();return ye(b(()=>n.show),e=>{e.key==="Escape"&&y()},{immediate:!0}),se(()=>n.show,async e=>{var d,o;e&&(await oe(),(o=(d=M.value)==null?void 0:d.$el)==null||o.focus())},{immediate:!0}),(e,d)=>{const o=pe,q=ke,R=be,O=we,S=Ue,G=je,K=Ce,J=F,Q=$e,W=fe;return r(),_(W,{centered:"",visible:e.show,onCancel:y},{default:i(()=>[t("div",Te,[t("div",Me,[a(V)?B("",!0):(r(),u("div",Re,c(e.$t("activity.share")),1))]),t("div",Se,[a(s).invitationToken?(r(),u("div",Be,[t("div",Fe,[(r(),_(w(a(k).account))),Ve]),l(q,{class:"mt-1",type:"success","show-icon":""},{message:i(()=>[t("div",Ie,[t("div",Ae,c(a(x)),1),l(o,{type:"text",class:"!rounded-md -mt-0.5",onClick:z},{icon:i(()=>[(r(),_(w(a(k).copy),{class:"flex mx-auto text-green-700 h-[1rem]"}))]),_:1})])]),_:1}),t("div",De,c(e.$t("msg.info.userInviteNoSMTP"))+" "+c(a(s).invitationToken&&a(s).emails),1),t("div",Ee,[l(o,{size:"small",outlined:"",onClick:L},{default:i(()=>[t("div",Ne,[l(R,{class:"flex mx-auto text-gray-600 h-[0.8rem]"}),t("div",Pe,c(e.$t("activity.inviteMore")),1)])]),_:1})])])):(r(),u("div",ze,[e.selectedUser?(r(),u("div",Le,[(r(),_(w(a(k).account))),t("div",qe,c(e.selectedUser?e.$t("activity.editUser"):e.$t("activity.inviteTeam")),1)])):B("",!0),l(J,{ref_key:"formRef",ref:T,"validate-on-rule-change":!1,model:a(s),"validate-trigger":"onBlur",onFinish:P},{default:i(()=>[t("div",Oe,[t("div",Ge,[t("div",Ke,[l(S,ae(a(N).emails,{"validate-trigger":"onBlur",name:"emails",rules:[{required:!0,message:"Please input email"}]}),{default:i(()=>[t("div",Je,c(e.$t("datatype.Email"))+":",1),l(O,{ref_key:"emailField",ref:M,value:a(s).emails,"onUpdate:value":d[0]||(d[0]=m=>a(s).emails=m),size:"middle","validate-trigger":"onBlur",placeholder:e.$t("labels.email"),disabled:!!e.selectedUser},null,8,["value","placeholder","disabled"])]),_:1},16)]),t("div",Qe,[l(S,{name:"role",rules:[{required:!0,message:"Role required"}]},{default:i(()=>[t("div",We,c(e.$t("labels.selectUserRole")),1),l(K,{value:a(s).role,"onUpdate:value":d[1]||(d[1]=m=>a(s).role=m),size:"middle",class:"nc-user-roles !rounded-md","dropdown-class-name":"nc-dropdown-user-role"},{default:i(()=>[(r(!0),u(le,null,ie(a(re),(m,H)=>(r(),_(G,{key:H,value:m,class:"nc-role-option"},{default:i(()=>[t("div",He,[t("div",{class:"px-3 py-1 flex rounded-full text-xs",style:ne({backgroundColor:a(ce)[m]})},c(m),5)])]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})])]),t("div",Xe,[l(o,{type:"primary","html-type":"submit",class:"!rounded-md"},{default:i(()=>[e.selectedUser?(r(),u("div",Ye,c(e.$t("general.save")),1)):(r(),u("div",Ze,[l(R,{class:"flex h-[0.8rem]"}),t("div",null,c(e.$t("activity.invite")),1)]))]),_:1})])])]),_:1},8,["model"])])),t("div",et,[l(Q)])]),t("div",tt,[l(o,{key:"back",class:"!rounded-md",onClick:e.cancel},{default:i(()=>[U("Cancel")]),_:1},8,["onClick"]),l(o,{class:"!rounded-md"},{default:i(()=>[U("Manage project access")]),_:1}),l(o,{key:"submit",class:"!rounded-md",type:"primary",loading:e.loading},{default:i(()=>[U("Share")]),_:1},8,["loading"])])])]),_:1},8,["visible"])}}});export{Et as default};
