import{_ as Z}from"./Button.vue.a83cab3b.js";import{h as R,r as k,A as D,k as ee,E as t,o as l,c as n,b as f,a as i,I as te,W as S,t as U,w as m,aj as h,cp as g,d as P,C as p,D as E,F as M,cA as se,O as le,L as ae,f as oe,J as x,K as T}from"./entry.13466615.js";import{S as re}from"./index.f2e6837c.js";import"./index.a8ef1b7e.js";import{I as ne}from"./Input.16966097.js";import{F as ie}from"./index.6f605a00.js";import{_ as pe}from"./Password.d7b16461.js";import{_ as ce}from"./TextArea.1bd4034f.js";import{_ as ue}from"./index.7677ce8f.js";import{_ as de}from"./FormItem.fe59dafe.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./debounce.dbc9bf77.js";import"./toNumber.7aa6a805.js";import"./isSymbol.b9109ae5.js";import"./SearchOutlined.c1eed30a.js";import"./isPlainObject.4c0f42f1.js";import"./_getPrototype.00be30f0.js";import"./antInputDirective.8ac36ea7.js";import"./FormItemContext.27b2e5db.js";import"./useSize.dec45296.js";import"./identity.b813b76e.js";import"./_flatRest.037bf8e3.js";import"./Col.23d910dc.js";import"./responsiveObserve.9209e727.js";import"./toArray.f6fa5a71.js";const _e={key:0,class:"flex flex-row w-full justify-center items-center h-52"},ye={key:1,class:"flex flex-col"},fe={class:"w-full relative"},me={class:"flex flex-row justify-center pb-4 mb-2 border-b-1 w-full gap-x-1"},ve=["alt","src"],ke={class:"font-semibold text-lg"},he={class:"absolute -right-2 -top-0.5"},ge={key:0,class:"flex flex-row justify-center"},xe={class:"text-center font-normal mb-2"},be={key:0,class:"text-red-600"},we={key:4,class:"absolute flex flex-col justify-start mt-2 -right-6 top-0"},Ce=["colspan"],Se={class:"flex flex-row space-x-4 justify-center mt-4"},Ze=R({__name:"AppInstall",props:{id:{}},emits:["saved","close"],setup($,{emit:N}){const{$api:b}=oe(),j=k(),{t:w}=D(),a=k(null),r=k({}),C=k(!0),y=k(null),V={labelCol:{span:14,pull:4},wrapperCol:{span:20,pull:4}},z=()=>r.value.push({}),K=async()=>{var o,u;y.value="save";try{await((o=j.value)==null?void 0:o.validateFields()),await b.plugin.update($.id,{input:JSON.stringify(r.value),active:!0}),N("saved"),x.success(((u=a.value)==null?void 0:u.formDetails.msgOnInstall)||w("msg.success.pluginSettingsSaved"))}catch(v){x.error(await T(v))}finally{y.value=null}},W=async()=>{y.value="test";try{a.value&&(await b.plugin.test({input:JSON.stringify(r.value),title:a.value.title,category:a.value.category})?x.success(w("msg.success.pluginTested")):x.info(w("msg.info.invalidCredentials")))}catch(o){x.error(await T(o))}finally{y.value=null}},G=async o=>{switch(o){case"save":await K();break;case"test":await W();break}},H=async()=>{try{C.value=!0;const o=await b.plugin.read($.id),u=JSON.parse(o.input_schema??"{}"),v=u.array?[{}]:{},_=typeof o.input=="string"?JSON.parse(o.input):v;"secure"in _&&typeof _.secure=="string"&&(_.secure=_.secure==="true"),a.value={...o,formDetails:u,parsedInput:_},r.value=a.value.parsedInput}catch(o){console.log(o)}finally{C.value=!1}},Q=o=>r.value.splice(o,1);return ee(async()=>{a.value||await H()}),(o,u)=>{var J;const v=re,_=le,q=ae,F=pe,A=ce,B=ue,I=ne,O=de,X=Z,Y=ie;return t(C)?(l(),n("div",_e,[f(v,{size:"large"})])):(l(),n("div",ye,[i("div",fe,[i("div",me,[t(a).logo?(l(),n("div",{key:0,class:te(["mr-1 flex items-center justify-center",[t(a).title==="SES"?"p-2 bg-[#242f3e]":""]])},[i("img",{alt:t(a).title||"plugin",src:`/${t(a).logo}`,class:"h-6"},null,8,ve)],2)):S("",!0),i("span",ke,U(t(a).formDetails.title),1)]),i("div",he,[f(q,{type:"text",class:"!rounded-md mr-1",onClick:u[0]||(u[0]=e=>N("close"))},{icon:m(()=>[f(_,{class:"flex mx-auto"})]),_:1})])]),f(Y,se({ref_key:"formRef",ref:j},(J=t(a))!=null&&J.formDetails.array?{}:V,{model:t(r),class:"mx-4 mt-3"}),{default:m(()=>[t(a).formDetails.array?(l(),n("div",ge,[i("table",null,[i("thead",null,[i("tr",null,[(l(!0),n(h,null,g(t(a).formDetails.items,(e,c)=>(l(),n("th",{key:c},[i("div",xe,[P(U(e.label)+" ",1),e.required?(l(),n("span",be,"*")):S("",!0)])]))),128))])]),i("tbody",null,[(l(!0),n(h,null,g(t(a).parsedInput,(e,c)=>(l(),n("tr",{key:c},[(l(!0),n(h,null,g(t(a).formDetails.items,(s,L)=>(l(),n("td",{key:L,class:"px-2"},[f(O,{class:"relative mb-3",name:[`${c}`,s.key],rules:[{required:s.required,message:`${s.label} is required`}]},{default:m(()=>[s.type==="Password"?(l(),p(F,{key:0,value:e[s.key],"onUpdate:value":d=>e[s.key]=d,placeholder:s.placeholder},null,8,["value","onUpdate:value","placeholder"])):s.type==="LongText"?(l(),p(A,{key:1,value:e[s.key],"onUpdate:value":d=>e[s.key]=d,placeholder:s.placeholder},null,8,["value","onUpdate:value","placeholder"])):s.type==="Checkbox"?(l(),p(B,{key:2,value:e[s.key],"onUpdate:value":d=>e[s.key]=d,placeholder:s.placeholder},null,8,["value","onUpdate:value","placeholder"])):(l(),p(I,{key:3,value:e[s.key],"onUpdate:value":d=>e[s.key]=d,placeholder:s.placeholder},null,8,["value","onUpdate:value","placeholder"])),c!==0&&L===t(a).formDetails.items.length-1?(l(),n("div",we,[(l(),p(E(t(M).delete),{class:"hover:text-red-400 cursor-pointer",onClick:d=>Q(c)},null,8,["onClick"]))])):S("",!0)]),_:2},1032,["name","rules"])]))),128))]))),128))]),i("tr",null,[i("td",{colspan:t(a).formDetails.items.length,class:"text-center"},[f(q,{type:"default",class:"!bg-gray-100 rounded-md border-none mr-1",onClick:z},{icon:m(()=>[(l(),p(E(t(M).plus),{class:"flex mx-auto"}))]),_:1})],8,Ce)])])])):(l(!0),n(h,{key:1},g(t(a).formDetails.items,(e,c)=>(l(),p(O,{key:c,label:e.label,name:e.key,rules:[{required:e.required,message:`${e.label} is required`}]},{default:m(()=>[e.type==="Password"?(l(),p(F,{key:0,value:t(r)[e.key],"onUpdate:value":s=>t(r)[e.key]=s,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="LongText"?(l(),p(A,{key:1,value:t(r)[e.key],"onUpdate:value":s=>t(r)[e.key]=s,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.type==="Checkbox"?(l(),p(B,{key:2,checked:t(r)[e.key],"onUpdate:checked":s=>t(r)[e.key]=s,placeholder:e.placeholder},null,8,["checked","onUpdate:checked","placeholder"])):(l(),p(I,{key:3,value:t(r)[e.key],"onUpdate:value":s=>t(r)[e.key]=s,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"]))]),_:2},1032,["label","name","rules"]))),128)),i("div",Se,[(l(!0),n(h,null,g(t(a).formDetails.actions,(e,c)=>(l(),p(X,{key:c,class:"!px-5",loading:t(y)===e.key,type:e.key==="save"?"primary":"default",disabled:!!t(y),onClick:s=>G(e.key)},{default:m(()=>[P(U(e.label),1)]),_:2},1032,["loading","type","disabled","onClick"]))),128))])]),_:1},16,["model"])]))}}});export{Ze as default};
