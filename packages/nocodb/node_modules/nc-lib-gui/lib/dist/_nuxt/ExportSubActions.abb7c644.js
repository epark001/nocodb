import{h as X,A as B,$ as c,r as m,cb as T,cI as q,o as i,c as f,b as V,w as j,aV as y,E as u,gF as n,C as $,D as h,F as I,d as k,t as D,aj as K,R as N,J as v,K as z,M as G,f as H}from"./entry.51f4e399.js";import{u as Q}from"./useSharedView.0db5f32b.js";import{b as U,F as W,M as Y,A as Z}from"./index.5263eb1d.js";import{a as ee}from"./useMetas.ba7abae7.js";import{a as te}from"./useSmartsheetStore.1784ce8b.js";import"./views.28a76d89.js";import"./index.b9981e09.js";const ue=X({__name:"ExportSubActions",setup(se){const{t:_}=B(),L=c(U,m(!1)),w=c(W,m([])),M=ee(),{project:P}=T(M),{$api:R}=H(),p=c(Y,m()),d=c(Z),{sorts:x,nestedFilters:E}=te(),b=async t=>{var S,g,F,A;let e=0,o=1;const r=t===n.EXCEL?"base64":"blob",l=await N(()=>import("./xlsx.6ed613d4.js"),[],import.meta.url),J=await N(()=>import("./FileSaver.min.14856950.js").then(s=>s.F),["./FileSaver.min.14856950.js","./entry.51f4e399.js","./entry.0f786d51.css"],import.meta.url);try{for(;!isNaN(e)&&e>-1;){let s;if(L.value){const{exportFile:a}=Q();s=await a(w.value,e,t,r,{sortsArr:x.value,filtersArr:E.value})}else s=await R.dbViewRow.export("noco",(S=P.value)==null?void 0:S.id,(g=p.value)==null?void 0:g.id,d==null?void 0:d.value.id,t,{responseType:r,query:{fields:w.value.map(a=>a.title),offset:e,sortArrJson:JSON.stringify(x.value),filterArrJson:JSON.stringify(E.value)}});const{data:C,headers:O}=s;if(t===n.EXCEL){const a=l.read(C,{type:"base64"});l.writeFile(a,`${(F=p.value)==null?void 0:F.title}_exported_${o++}.xlsx`)}else if(t===n.CSV){const a=new Blob([C],{type:"text/plain;charset=utf-8"});J.saveAs(a,`${(A=p.value)==null?void 0:A.title}_exported_${o++}.csv`)}e=+O["nc-export-offset"],e>-1?v.info(_("msg.info.downloadingMoreFiles")):v.success(_("msg.success.tableDataExported"))}}catch(s){v.error(await z(s))}};return(t,e)=>{const o=G,r=q("e");return i(),f(K,null,[V(o,null,{default:j(()=>[y((i(),f("div",{class:"nc-project-menu-item",onClick:e[0]||(e[0]=l=>b(u(n).CSV))},[(i(),$(h(u(I).csv),{class:"text-gray-500"})),k(D(t.$t("activity.downloadCSV")),1)])),[[r,["a:actions:download-csv"]]])]),_:1}),V(o,null,{default:j(()=>[y((i(),f("div",{class:"nc-project-menu-item",onClick:e[1]||(e[1]=l=>b(u(n).EXCEL))},[(i(),$(h(u(I).excel),{class:"text-gray-500"})),k(D(t.$t("activity.downloadExcel")),1)])),[[r,["a:actions:download-excel"]]])]),_:1})],64)}}});export{ue as default};
