import{o as p,c as g,a as f,h as et,T as lt,cb as at,r as m,fC as st,$ as nt,k as it,aq as rt,b as _,w as $,I as S,E as a,C as x,D,F as V,W as E,b5 as ct,b6 as ut,cF as pt,t as dt,Q as mt,R as vt,cd as _t,L as ft,p as ht,e as gt}from"./entry.51f4e399.js";import{_ as wt}from"./Icon.vue.1162f18b.js";import{a as yt}from"./useMetas.ba7abae7.js";import{a as Ct,u as bt}from"./EditOrAddProvider.vue.09b12d8b.js";import{g as Ot}from"./index.5263eb1d.js";import{i as $t}from"./index.e5ddde08.js";import{D as xt}from"./vuedraggable.umd.f8ba38de.js";import{D as kt}from"./index.252dc7b4.js";import"./index.e760d172.js";import{I as It}from"./Input.7cb175ff.js";import{_ as Mt}from"./_plugin-vue_export-helper.c27b6911.js";import"./Button.vue.793bcd1d.js";import"./index.0db47614.js";import"./debounce.7d32c110.js";import"./toNumber.9dc54e53.js";import"./isSymbol.b53bd26f.js";import"./useBetaFeatureToggle.5dbba600.js";import"./validation.6db726f3.js";import"./index.de92142d.js";import"./FormItem.cda40628.js";import"./identity.dd5da9ba.js";import"./_getPrototype.ec1165af.js";import"./Col.88cfabc0.js";import"./responsiveObserve.501a6cf9.js";import"./toArray.06afb623.js";import"./FormItemContext.e001cd7c.js";import"./useSize.3b3f469f.js";import"./_flatRest.ff2d3d5c.js";import"./isPlainObject.ecf52d25.js";import"./index.0d6d8ba8.js";import"./Checkbox.a529f1e6.js";import"./createForOfIteratorHelper.12419aa5.js";import"./index.5e746f62.js";import"./antInputDirective.8ac36ea7.js";import"./isMobile.e2e89480.js";import"./useMemo.b13a9257.js";import"./useMergedState.5e6500b1.js";import"./useState.6010d8b6.js";import"./DownOutlined.db6f6406.js";import"./CheckOutlined.ef30fafc.js";import"./SearchOutlined.dec109ce.js";import"./Dropdown.dc69c0a4.js";import"./RightOutlined.90e8180f.js";import"./TextArea.442a25cb.js";import"./Password.d493e47a.js";const St={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Dt=f("path",{fill:"currentColor",d:"M20 10.5a6.5 6.5 0 0 1-6.5 6.5H7.83l3.09 3.09L9.5 21.5L4 16l5.5-5.5l1.41 1.41L7.83 15h5.67c2.5 0 4.5-2 4.5-4.5S16 6 13.5 6H6V4h7.5a6.5 6.5 0 0 1 6.5 6.5Z"},null,-1),Vt=[Dt];function Et(r,k){return p(),g("svg",St,Vt)}const Ut={name:"mdi-arrow-u-left-bottom",render:Et},At={class:"nc-icon",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Bt=f("path",{fill:"currentColor",d:"M12 2a10 10 0 0 1 10 10a10 10 0 0 1-10 10A10 10 0 0 1 2 12A10 10 0 0 1 12 2m-5 8l5 5l5-5H7Z"},null,-1),Lt=[Bt];function Nt(r,k){return p(),g("svg",At,Lt)}const Pt={name:"mdi-arrow-down-drop-circle",render:Nt},Rt=mt(()=>vt(()=>import("./ColorPicker.96c4dcbf.js"),["./ColorPicker.96c4dcbf.js","./entry.51f4e399.js","./entry.0f786d51.css","./Icon.vue.1162f18b.js","./Tooltip.vue.3be5e05d.js","./index.680937e8.js","./index.c4aafe5c.js","./Dropdown.dc69c0a4.js","./useState.6010d8b6.js","./useRefs.154aa2be.js","./identity.dd5da9ba.js","./isSymbol.b53bd26f.js","./_flatRest.ff2d3d5c.js","./isMobile.e2e89480.js","./useMergedState.5e6500b1.js","./index.529d8b39.js","./Col.88cfabc0.js","./responsiveObserve.501a6cf9.js","./index.fbcca285.js","./isPlainObject.ecf52d25.js","./_getPrototype.ec1165af.js","./_plugin-vue_export-helper.c27b6911.js","./ColorPicker.effd5480.css"],import.meta.url).then(r=>r.default||r)),Kt=r=>(ht("data-v-8a028d44"),r=r(),gt(),r),Tt={class:"w-full"},zt={class:"max-h-[250px] overflow-x-auto scrollbar-thin-dull"},jt={class:"flex py-1 items-center nc-select-option"},Ht=["data-testid"],qt=["data-testid","onClick"],Ft={key:0,class:"text-error text-[10px] mb-1 mt-2"},Gt={class:"flex items-center"},Zt=Kt(()=>f("span",{class:"flex-auto"},"Add option",-1)),Qt=et({__name:"SelectOptions",props:{value:{}},emits:["update:value"],setup(r,{emit:k}){const o=lt(r,"value",k),{formState:T,setAdditionalValidations:z,validateInfos:U,isPg:j,isMysql:H}=Ct(),{project:q}=at(yt()),{loadMagic:F,optionsMagic:G}=bt(),s=m([]),d=m([]),w=m(null),I=m(null),y=m({}),C=m(st.light),b=m(),v=m(),Z=nt(Ot,m(!1));z({...{colOptions:[{type:"object",fields:{options:{validator:(t,e)=>new Promise((l,n)=>{for(const h of s.value)if(h.status!=="remove"){if(!h.title.length)return n(new Error("Select options can't be null"));if(o.value.uidt===_t.MultiSelect&&h.title.includes(","))return n(new Error("MultiSelect columns can't have commas(',')"));if(s.value.filter(O=>O.title===h.title&&O.status!=="remove").length>1)return n(new Error("Select options can't have duplicates"))}l()})}}}]}}),it(()=>{var e;(e=o.value.colOptions)!=null&&e.options||(o.value.colOptions={options:[]}),s.value=o.value.colOptions.options,d.value=[...s.value];for(const l of s.value.filter(n=>n.order===null))l.title=l.title.replace(/^'/,"").replace(/'$/,"");o.value.cdf&&(j.value&&(o.value.cdf=o.value.cdf.substring(o.value.cdf.indexOf("'")+1,o.value.cdf.lastIndexOf("'"))),H.value||(o.value.cdf=o.value.cdf.replace(/''/g,"'")));const t=s.value.find(l=>l.title===o.value.cdf);t&&(v.value=t)});const Q=t=>{var e;t&&t===((e=v.value)==null?void 0:e.id)&&(o.value.cdf=v.value.title)},A=()=>{let t=C.value[0];if(s.value.length&&s.value[s.value.length-1].color){const e=C.value.indexOf(s.value[s.value.length-1].color);t=C.value[(e+1)%C.value.length]}return t},B=()=>{const t={title:"",color:A()};d.value.push(t),s.value.push(t)},W=async()=>{await G(q,T,A,s.value,d.value)},M=()=>{o.value.colOptions.options=d.value.filter(t=>t.status!=="remove")},J=t=>{var l,n;d.value[t].status="remove",M(),((l=d.value[t])==null?void 0:l.id)===((n=v.value)==null?void 0:n.id)&&(w.value={...v.value},I.value=o.value.cdf,v.value=null,o.value.cdf=null)},X=t=>{var l,n;d.value[t].status=void 0,M(),((l=d.value[t])==null?void 0:l.id)===((n=w.value)==null?void 0:n.id)&&(v.value={...w.value},o.value.cdf=I.value,w.value=null,I.value=null)};return rt(b,()=>{var t;(t=b.value)!=null&&t.$el&&b.value.$el.focus()}),(t,e)=>{var L,N,P,R;const l=Rt,n=Pt,h=kt,O=It,Y=Ut,tt=ft,ot=wt;return p(),g("div",Tt,[f("div",zt,[_(a(xt),{list:a(d),"item-key":"id",handle:".nc-child-draggable-icon",onChange:M},{item:$(({element:i,index:c})=>[f("div",jt,[f("div",{class:S(["flex items-center w-full",{removed:i.status==="remove"}]),"data-testid":`select-column-option-${c}`},[a(Z)?E("",!0):(p(),x(D(a(V).dragVertical),{key:0,small:"",class:"nc-child-draggable-icon handle","data-testid":`select-option-column-handle-icon-${i.title}`},null,8,["data-testid"])),_(h,{visible:a(y)[c],"onUpdate:visible":u=>a(y)[c]=u,trigger:["click"],"overlay-class-name":"nc-dropdown-select-color-options"},{overlay:$(()=>[_(l,{modelValue:i.color,"onUpdate:modelValue":[u=>i.color=u,u=>a(y)[c]=!1],"pick-button":!0},null,8,["modelValue","onUpdate:modelValue"])]),default:$(()=>[_(n,{class:S(["mr-2 text-[1.5em] outline-0 hover:!text-[1.75em]",{"text-[1.75em]":a(y)[c]}]),style:ct({color:i.color})},null,8,["class","style"])]),_:2},1032,["visible","onUpdate:visible"]),_(O,{ref_key:"inputs",ref:b,value:i.title,"onUpdate:value":u=>i.title=u,class:"caption !rounded-lg","data-testid":`select-column-option-input-${c}`,disabled:i.status==="remove",onKeydown:ut(pt(u=>{var K;return((K=i.title)==null?void 0:K.trim())&&B()},["prevent"]),["enter"]),onChange:u=>Q(i.id)},null,8,["value","onUpdate:value","data-testid","disabled","onKeydown","onChange"])],10,Ht),i.status!=="remove"?(p(),g("div",{key:0,"data-testid":`select-column-option-remove-${c}`,class:"ml-1 hover:!text-black-500 text-gray-500 cursor-pointer hover:bg-gray-50 py-1 px-1.5 rounded-md",onClick:u=>J(c)},[(p(),x(D(a(V).close),{class:"-mt-0.25"}))],8,qt)):(p(),x(Y,{key:1,class:"ml-2 hover:!text-black-500 text-gray-500 cursor-pointer","data-testid":`select-column-option-remove-undo-${c}`,onClick:u=>X(c)},null,8,["data-testid","onClick"]))])]),_:1},8,["list"])]),(R=(P=(N=(L=a(U))==null?void 0:L.colOptions)==null?void 0:N.help)==null?void 0:P[0])!=null&&R[0]?(p(),g("div",Ft,dt(a(U).colOptions.help[0][0]),1)):E("",!0),_(tt,{type:"dashed",class:"w-full caption mt-2",onClick:e[0]||(e[0]=i=>B())},{default:$(()=>[f("div",Gt,[(p(),x(D(a(V).plus))),Zt])]),_:1}),a($t)?(p(),g("div",{key:1,class:"w-full cursor-pointer",onClick:e[1]||(e[1]=i=>W())},[_(ot,{icon:"magic",class:S([{"nc-animation-pulse":a(F)},"w-full flex mt-2 text-orange-400"])},null,8,["class"])])):E("",!0)])}}});const Ho=Mt(Qt,[["__scopeId","data-v-8a028d44"]]);export{Ho as default};
