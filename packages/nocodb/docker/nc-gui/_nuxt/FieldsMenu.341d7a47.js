import Ie from"./VirtualCellIcon.52ec82ec.js";import{_ as Ce}from"./CellIcon.8e3c7692.js";import{_ as Ae}from"./Icon.vue.e15b8911.js";import{h as ae,T as me,o as n,C as y,w as m,V as _e,E as t,H as b,$ as F,r as Y,S as Ve,g0 as re,aq as Ne,i as H,fb as r,cd as Fe,cI as Le,a as i,cF as S,c as p,b as h,W as w,t as L,dD as De,D as oe,F as Se,aV as le,I as Be,aj as ue,d as pe,m as Ee,f3 as Ue,L as $e,_ as je,p as Me,e as Re,f as Ge}from"./entry.13466615.js";import{_ as Oe}from"./index.7677ce8f.js";import{C as Ye}from"./index.2660048d.js";import{_ as He}from"./Dropdown.vue.be6ede75.js";import{M as Ke,A as Te,R as ze,e as Pe,F as qe,d as Qe,b as We}from"./index.5263eb1d.js";import{u as Je}from"./index.f13259f4.js";import{a as Xe}from"./useSmartsheetStore.9bdf3b91.js";import{f as Ze}from"./useMetas.223da623.js";import{u as et}from"./useViewColumns.21ea359e.js";import{D as tt}from"./vuedraggable.umd.8d33c631.js";import"./index.a8ef1b7e.js";import{I as st}from"./Input.16966097.js";import{_ as ot}from"./index.4385a501.js";import{_ as lt}from"./_plugin-vue_export-helper.c27b6911.js";import"./virtualCell.88c63e03.js";import"./cell.b6c2deed.js";import"./FormItemContext.27b2e5db.js";import"./Checkbox.65681aa3.js";import"./createForOfIteratorHelper.37be2624.js";import"./index.82f05b6c.js";import"./Dropdown.a78be736.js";import"./RightOutlined.2c092523.js";import"./views.3cd4bcb9.js";import"./useSharedView.746b4f21.js";import"./index.2a3da6a9.js";import"./index.e7cf7635.js";import"./SearchOutlined.c1eed30a.js";import"./isPlainObject.4c0f42f1.js";import"./_getPrototype.00be30f0.js";import"./TextArea.1bd4034f.js";import"./antInputDirective.8ac36ea7.js";import"./Password.d7b16461.js";import"./toArray.f6fa5a71.js";import"./isMobile.e2e89480.js";import"./useMemo.4991ab9d.js";import"./useMergedState.1cc2a884.js";import"./useState.a6853ebd.js";import"./DownOutlined.9cfe3e0c.js";import"./CheckOutlined.80115d65.js";const at=ae({__name:"Switch",props:{checked:{type:Boolean},disabled:{type:Boolean}},emits:["change","update:checked"],setup(g,{emit:x}){const o=g,_=me(o,"checked",x),I=f=>{x("change",f)};return(f,C)=>{const B=Oe;return n(),y(B,{checked:t(_),"onUpdate:checked":C[0]||(C[0]=E=>b(_)?_.value=E:null),disabled:o.disabled,class:"nc-switch",size:"small",onChange:I},{default:m(()=>[_e(f.$slots,"default")]),_:3},8,["checked","disabled"])}}}),nt=ae({__name:"Checkbox",props:{checked:{type:Boolean},size:{default:"default"},disabled:{type:Boolean,default:!1}},emits:["change","update:checked"],setup(g,{emit:x}){const o=g,_=me(o,"checked",x),I=f=>{x("change",f,_.value)};return(f,C)=>{const B=Ye;return n(),y(B,{checked:t(_),"onUpdate:checked":C[0]||(C[0]=E=>b(_)?_.value=E:null),class:"nc-checkbox",disabled:o.disabled,onChange:I},{default:m(()=>[_e(f.$slots,"default")]),_:3},8,["checked","disabled"])}}});const it=""+new URL("search.5f0c9bbf.svg",import.meta.url).href,K=g=>(Me("data-v-d92ed900"),g=g(),Re(),g),dt={class:"flex items-center gap-2"},ct={key:2,class:"text-capitalize text-sm font-medium"},rt={key:3,class:"nc-count-badge"},ut={key:0,class:"flex flex-col gap-y-2 pr-6 mb-6"},pt=K(()=>i("div",{class:"flex text-sm select-none"},"Select cover image field",-1)),mt=K(()=>i("img",{src:it,class:"h-3.5 w-3.5 mr-1"},null,-1)),_t={key:1,class:"pl-8 pr-2 mr-6 mt-3 py-2 justify-between flex flex-row items-center border-1 rounded-lg mb-2 border-gray-100 bg-gray-50"},ft={class:"ml-0.25 select-none"},vt={key:2,class:"pr-6"},ht=K(()=>i("div",{class:"pt-0.25 w-full bg-gray-50"},null,-1)),wt=[ht],yt={class:"flex flex-col nc-scrollbar-md max-h-[35vh] pt-1 pr-5"},gt={class:"nc-fields-list py-1"},kt={key:0,class:"px-0.5 py-2 text-gray-500"},bt=["data-testid"],xt={class:"flex flex-row items-center justify-between w-full ml-1"},It={class:"flex items-center -ml-0.75"},Ct=K(()=>i("div",{class:"flex-1"},null,-1)),At=["data-testid"],Vt={class:"flex flex-row items-center justify-between w-full"},Nt={class:"flex"},Ft=K(()=>i("span",{class:"text-sm"},"Display Value",-1)),Lt={class:"flex items-center"},Dt={class:"select-none"},St=ae({__name:"FieldsMenu",setup(g){const x=F(Ke,Y()),o=F(Te,Y()),_=F(ze),I=F(Pe,void 0),f=F(qe),{isMobileMode:C}=Ve(),B=F(Qe,Y(!1)),E=F(We,Y(!1)),{$api:ne,$e:fe}=Ge(),{showSystemFields:U,sortedAndFilteredFields:ve,fields:d,filteredFieldList:A,filterQuery:v,showAll:W,hideAll:J,saveOrUpdate:he,metaColumnById:T,loadViewColumns:ie,toggleFieldVisibility:we}=et(o,x,()=>_.trigger()),{eventBus:ye}=Xe(),{addUndo:$,defineViewScope:j}=Ze();ye.on(e=>{(e===re.FIELD_RELOAD||e===re.MAPPED_BY_COLUMN_CHANGE)&&ie()}),Ne(ve,e=>{f&&(f.value=e||[])},{immediate:!0});const X=H(()=>{var e,s;return(s=(e=A.value)==null?void 0:e.filter(l=>!l.show))==null?void 0:s.length}),z=H(()=>{var s,l,c;if(((s=o.value)==null?void 0:s.type)!==r.GRID)return null;const e=(l=Object.values(T.value))==null?void 0:l.find(u=>u==null?void 0:u.pv);return(c=A.value)==null?void 0:c.find(u=>u.fk_column_id===(e==null?void 0:e.id))}),Z=(e,s=!1)=>{d.value&&(s||$({undo:{fn:()=>{if(!d.value)return;const l=d.value[e.moved.newIndex];d.value[e.moved.newIndex]=d.value[e.moved.oldIndex],d.value[e.moved.oldIndex]=l,Z({moved:{newIndex:e.moved.oldIndex,oldIndex:e.moved.newIndex}},!0)},args:[]},redo:{fn:()=>{if(!d.value)return;const l=d.value[e.moved.oldIndex];d.value[e.moved.oldIndex]=d.value[e.moved.newIndex],d.value[e.moved.newIndex]=l,Z(e,!0)},args:[]},scope:j({view:o.value})}),!(d.value.length<2)&&(d.value.forEach((l,c)=>{l.order!==c+1&&(l.order=c+1,he(l,c))}),fe("a:fields:reorder")))},de=H(()=>{var s;const e=((s=d.value)==null?void 0:s.filter(l=>l.fk_column_id&&T.value[l.fk_column_id].uidt===Fe.Attachment).map(l=>({value:l.fk_column_id,label:l.title})))??[];return[{value:null,label:"No Image"},...e]}),ee=async e=>{var s,l,c,u,V,k,q,Q;(((s=o.value)==null?void 0:s.type)===r.GALLERY||((l=o.value)==null?void 0:l.type)===r.KANBAN)&&((c=o.value)!=null&&c.id)&&((u=o.value)!=null&&u.view)&&(((V=o.value)==null?void 0:V.type)===r.GALLERY?(await ne.dbView.galleryUpdate((k=o.value)==null?void 0:k.id,{fk_cover_image_col_id:e}),o.value.view.fk_cover_image_col_id=e):((q=o.value)==null?void 0:q.type)===r.KANBAN&&(await ne.dbView.kanbanUpdate((Q=o.value)==null?void 0:Q.id,{fk_cover_image_col_id:e}),o.value.view.fk_cover_image_col_id=e),I==null||I.trigger())},M=H({get:()=>{var s,l,c,u,V;const e=(((s=o.value)==null?void 0:s.type)===r.GALLERY||((l=o.value)==null?void 0:l.type)===r.KANBAN)&&((c=o.value)!=null&&c.view)?((u=o.value)==null?void 0:u.view).fk_cover_image_col_id:void 0;return(V=de.value)!=null&&V.find(k=>k.value===e)?e:null},set:async e=>{e!==M.value&&($({undo:{fn:await ee,args:[M.value]},redo:{fn:await ee,args:[e]},scope:j({view:o.value})}),await ee(e))}}),ge=()=>{$({undo:{fn:async()=>{await J()},args:[]},redo:{fn:async()=>{await W()},args:[]},scope:j({view:o.value})}),W()},ke=()=>{$({undo:{fn:async()=>{await W()},args:[]},redo:{fn:async()=>{await J()},args:[]},scope:j({view:o.value})}),J()},te=H({get:()=>{var e;return(e=A.value)==null?void 0:e.every(s=>s.show)},set:async e=>{e?await ge():await ke()}}),ce=e=>Ee(Ue(e)?Ie:Ce,{columnMeta:e}),P=Y(!1),be=e=>{$({undo:{fn:s=>{U.value=!s},args:[e]},redo:{fn:s=>{U.value=s},args:[e]},scope:j({view:o.value})})};return Je(P),(e,s)=>{const l=Ae,c=$e,u=ot,V=st,k=at,q=je,Q=nt,xe=He,se=Le("e");return n(),y(xe,{visible:t(P),"onUpdate:visible":s[12]||(s[12]=N=>b(P)?P.value=N:null),trigger:["click"],"overlay-class-name":"nc-dropdown-fields-menu nc-toolbar-dropdown"},{overlay:m(()=>{var N,R,G,O;return[i("div",{class:"p-6 pr-0 bg-white w-90 rounded-2xl nc-table-toolbar-menu","data-testid":"nc-fields-menu",onClick:s[11]||(s[11]=S(()=>{},["stop"]))},[!t(v)&&(((N=t(o))==null?void 0:N.type)===t(r).GALLERY||((R=t(o))==null?void 0:R.type)===t(r).KANBAN)?(n(),p("div",ut,[pt,h(u,{value:t(M),"onUpdate:value":s[0]||(s[0]=a=>b(M)?M.value=a:null),class:"w-full",options:t(de),"dropdown-class-name":"nc-dropdown-cover-image",onClick:s[1]||(s[1]=S(()=>{},["stop"]))},{suffixIcon:m(()=>[h(l,{icon:"arrowDown",class:"text-gray-700"})]),_:1},8,["value","options"])])):w("",!0),i("div",{class:"pr-6",onClick:s[3]||(s[3]=S(()=>{},["stop"]))},[h(V,{value:t(v),"onUpdate:value":s[2]||(s[2]=a=>b(v)?v.value=a:null),placeholder:e.$t("placeholder.searchFields"),class:"!rounded-lg"},{prefix:m(()=>[mt]),_:1},8,["value","placeholder"])]),t(v)?w("",!0):(n(),p("div",_t,[i("div",ft,L(e.$t("general.showAll"))+" "+L(e.$t("objects.fields").toLowerCase()),1),h(k,{checked:t(te),"onUpdate:checked":s[4]||(s[4]=a=>b(te)?te.value=a:null)},null,8,["checked"])])),t(v)?w("",!0):(n(),p("div",vt,wt)),i("div",yt,[i("div",gt,[(G=t(d))!=null&&G.filter(a=>a.title.includes(t(v))).length?w("",!0):(n(),p("div",kt," Empty ")),h(t(tt),{modelValue:t(d),"onUpdate:modelValue":s[7]||(s[7]=a=>b(d)?d.value=a:null),"item-key":"id",onChange:s[8]||(s[8]=a=>Z(a))},De({item:m(({element:a,index:Bt})=>[t(A).filter(D=>D!==t(z)&&D.title.includes(t(v))).includes(a)?(n(),p("div",{key:a.id,class:"px-2 py-2 flex flex-row items-center border-1 rounded-lg mb-2 border-gray-100","data-testid":`nc-fields-menu-${a.title}`,onClick:s[5]||(s[5]=S(()=>{},["stop"]))},[(n(),y(oe(t(Se).drag),{class:"cursor-move !h-3.75 text-gray-600 mr-1"})),i("div",xt,[i("div",It,[(n(),y(oe(ce(t(T)[a.fk_column_id])))),i("div",null,L(a.title),1)]),le(h(k,{checked:a.show,"onUpdate:checked":D=>a.show=D,disabled:a.isViewEssentialField,onChange:D=>t(we)(D,a)},null,8,["checked","onUpdate:checked","disabled","onChange"]),[[se,["a:fields:show-hide"]]])]),Ct],8,bt)):w("",!0)]),_:2},[((O=t(o))==null?void 0:O.type)===t(r).GRID?{name:"header",fn:m(()=>[t(z)&&t(A)[0].title.includes(t(v))?(n(),p("div",{key:`pv-${t(z).id}`,class:"pl-7.5 pr-2.1 py-2 flex flex-row items-center border-1 rounded-lg mb-2 border-gray-100","data-testid":`nc-fields-menu-${t(z).title}`,onClick:s[6]||(s[6]=S(()=>{},["stop"]))},[i("div",Vt,[i("div",Nt,[h(q,{placement:"bottom"},{title:m(()=>[Ft]),_:1}),i("div",Lt,[(n(),y(oe(ce(t(T)[t(A)[0].fk_column_id])))),i("span",null,L(t(A)[0].title),1)])]),le(h(k,{checked:!0,disabled:!0},null,512),[[se,["a:fields:show-hide"]]])])],8,At)):w("",!0)]),key:"0"}:void 0]),1032,["modelValue"]),!t(E)&&!t(v)?(n(),p("div",{key:1,class:"mt-4 p-2 py-1 flex nc-fields-show-system-fields !text-base",onClick:s[10]||(s[10]=S(()=>{},["stop"]))},[h(Q,{checked:t(U),"onUpdate:checked":s[9]||(s[9]=a=>b(U)?U.value=a:null),onChange:be},{default:m(()=>[i("span",Dt,L(e.$t("activity.showSystemFields")),1)]),_:1},8,["checked"])])):w("",!0)])])])]}),default:m(()=>[i("div",{class:Be({"nc-active-btn":t(X)})},[le((n(),y(c,{class:"nc-fields-menu-btn nc-toolbar-btn",disabled:t(B)},{default:m(()=>{var N,R,G,O;return[i("div",dt,[((N=t(o))==null?void 0:N.type)===t(r).KANBAN||((R=t(o))==null?void 0:R.type)===t(r).GALLERY?(n(),y(l,{key:0,icon:"creditCard",class:"h-4 w-4"})):(n(),y(l,{key:1,icon:"eye",class:"h-4 w-4"})),t(C)?w("",!0):(n(),p("span",ct,[((G=t(o))==null?void 0:G.type)===t(r).KANBAN||((O=t(o))==null?void 0:O.type)===t(r).GALLERY?(n(),p(ue,{key:0},[pe(" Edit Cards ")],64)):(n(),p(ue,{key:1},[pe(L(e.$t("objects.fields")),1)],64))])),t(X)?(n(),p("span",rt,L(t(X)),1)):w("",!0)])]}),_:1},8,["disabled"])),[[se,["c:fields"]]])],2)]),_:1},8,["visible"])}}});const bs=lt(St,[["__scopeId","data-v-d92ed900"]]);export{bs as default};
